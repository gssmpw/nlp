\vspace{-6px}
\begin{algorithm}[htb]
\small
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\caption{Relation Graph Evaluation Metrics $\text{mR}_g$@$T_{R}$ and $\text{mAP}_g$@$T_{R}$ for gDSA Task}
\label{alg:metric}
\begin{algorithmic}[1]
    \Require Predicted instances $I_{out}$, ground truth instances $I_{gt}$, predicted relations $R$, ground truth relations $R_{gt}$, IoU threshold $T_{IoU}$, relation score threshold $T_{R}$
    \Ensure Mean Recall $\text{mR}_g$@$T_{R}$, Mean Average Precision $\text{mAP}_g$@$T_{R}$
    \algnotext{EndIf}
    \algnotext{EndFor}
    \State \textbf{Step 1: Instance Matching}
    \State Initialize mapping $M[x] = \text{null}$ for each $x \in I_{gt}$
    \ForAll{$i \in I_{out}$}
        \State Find $x \gets \arg\max_{g \in I_{gt}, \, \text{label}(g) = \text{label}(i)} \text{IoU}(g, i)$
        \If{$x \neq \text{null}$ and $\text{IoU}(x, i) > T_{IoU}$ and ($M[x] = \text{null}$ or $\text{IoU}(x, i) > \text{IoU}(x, M[x])$)}
            \State $M[x] \gets i$
        \EndIf
    \EndFor
    \State $L \gets$ inverse mapping of $M$
    
    \State \textbf{Step 2: Relation Evaluation}
    \State $G \gets \{(x_s, p, x_o) \in R_{gt} \mid x_s, x_o \in I_{gt}\}$ 
    \State $X_T \gets \{(i_s, p, i_o, s_p) \in R \mid s_p > T_{R} \text{ and } L(i_s), L(i_o) \neq \text{null}\}$ 
    
    \State $\text{mR}_g$@$T_{R} \gets f_{\text{mR}}(X_T, G)$ \Comment{Calculate mean recall at threshold $T_{R}$}
    \State $\text{mAP}_g$@$T_{R} \gets f_{\text{mAP}}(X_T, G)$ \Comment{Calculate mean average precision at threshold $T_{R}$}
    
    \State \Return $\text{mR}_g$@$T_{R}$, $\text{mAP}_g$@$T_{R}$
\end{algorithmic}
\end{algorithm}
\vspace{-20px}