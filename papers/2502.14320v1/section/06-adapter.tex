\section{Adapter}
\label{sec:adapter}
\begin{algorithm}[!t]
    
	\caption{Adapt resource online \jing{(necessary?)}}
 	\LinesNumbered    
    \KwIn{$\mathbf{F}= \left\langle f_1,\dots,f_N \right\rangle$: (sub-)workflow}
    \KwIn{$\mathbf{U}, T$: hints table and time budget/slack}
    \KwOut{$k$: CPU cores for head function}
	\SetKwFunction{FMain}{\texttt{adapt}}
    \SetKwProg{Fn}{Function}{:}{}
    
    \Fn{\FMain{$\mathbf{F},\mathbf{U}, T$}}{
    $ i \leftarrow \mathbf{U}.$\texttt{index}($T$)\\
    \If{$i=\emptyset$}
    {
    $\mathbf{K} \leftarrow $\texttt{generate}($\mathbf{F},T, \emptyset$) \\
    $\mathbf{U} \leftarrow $\texttt{condense}($\{\left \langle T, \mathbf{K}\right\rangle\}$)\\
    }
    \Else{
    $\mathbf{K} \leftarrow \mathbf{U}[i]$
    }
    \text{return}~$\mathbf{K}[0]$
    }
\label{alg:adapt}
\end{algorithm}

Having demonstrated how to offline synthesize and condense hints, we now focus on utilizing the hints table to accomplish online adaptation.

As outlined in \S~\ref{sec:system-overview},  after each function's execution, adapter re-evaluates the available time budget for the remaining functions while adapting the head function's size accordingly.
The procedure of adapter is listed in Algorithm~\ref{alg:adapt}.
Specifically, it first accesses the sub-workflow's hints table $\mathbf{U}$ to figure out the proper hint that can well meet the required time budget $T$ with the minimum resource consumption (Line 2).
Notably, if the above searching suffers a miss hit, due to the dynamics at runtime (detailed in~\S~\ref{sec:bg:worst-case}), adapter will revoke synthesizer to generate the proper hint on spot while updating it into the table (Line 3--5).
Moreover, adapter continuously counts the above miss. 
When it exceeds a predefined threshold, adapter argues that execution latency distribution may change, when adapter will trigger a holistic update of both profiler and synthesizer, for maintaining adaptation's accuracy.

\begin{algorithm}[!t]
    \caption{Adapt resource online \label{alg:janus:adapt}}
    \LinesNumbered    
    \KwIn{$\mathbf{F}= \left\langle f_1,\dots,f_N \right\rangle$: (sub-)workflow}
    \KwIn{$\mathbf{U}, T$: hints table and time budget/slack}
    \KwOut{$k$: CPU cores for head function}
	\SetKwFunction{FMain}{\texttt{adapt}}
    \SetKwProg{Fn}{Function}{:}{}
    
    \Fn{\FMain{$\mathbf{F},\mathbf{U}, T$}}{
    $ i \leftarrow \mathbf{U}.$\texttt{index}($T$)\\
    \If{$i=\emptyset$}
    {
    $\mathbf{K} \leftarrow $\texttt{generate}($\mathbf{F},T, \emptyset$) \\
    $\mathbf{U} \leftarrow $\texttt{condense}($\{\left \langle T, \mathbf{K}\right\rangle\}$)\\
    }
    \Else{
    $\mathbf{K} \leftarrow \mathbf{U}[i]$
    }
    \text{return}~$\mathbf{K}[0]$
    }

\end{algorithm}