\tikzstyle{interface} = [rectangle, rounded corners, minimum width=2cm, minimum height=.6cm,text centered, draw=black, fill=red!20]
\tikzstyle{io} = [trapezium, trapezium left angle=85, trapezium right angle=95, minimum width=.5cm, minimum height=.6cm, text centered, draw=black, fill=gray!20]
\tikzstyle{process} = [rectangle, minimum width=1.5cm, minimum height=.6cm, text centered, draw=blue, fill=blue!20]
\tikzstyle{ext} = [rectangle, minimum width=1.5cm, minimum height=.6cm, text centered, draw=black]
\tikzstyle{arrow} = [thick,->,>=stealth]
\tikzstyle{doublearrow} = [thick,<->,>=stealth]

\begin{center}

\begin{tikzpicture}[scale=0.75, node distance=2cm]
\node (issycomp) [process, text width=1.5cm] {\issy compiler};
\node (llissyprob) [io, text width=1.65cm, below of = issycomp, yshift=.7cm] {\phantom{aa} \llissy \newline specification};
\node (llissypars) [process, text width=1.5cm, below of = llissyprob, yshift=.7cm] {\llissy parser};

\node (spec) [io, text width=3.6cm, right of = llissypars, xshift=1.6cm] {Specification: Formula$_1,\ldots,$ Formula$_m$ Game$_1,\ldots,$ Game$_n$};
\node (gameprod) [process, text width=2cm, right of = spec, xshift=3cm] {Game product construction};
\node (enhgame) [io, text width=2.25cm, above of = gameprod, yshift=-.7cm, xshift=-.5cm] {Enhanced game};
\node (otfprod) [process, text width=2cm, above of = enhgame, yshift=-.5cm,xshift=.5cm,yshift=-.2cm] {On-the-fly product construction};

\node (formgame) [io, text width=.8cm,  above left of = otfprod, xshift=-1cm,yshift=-.6cm] {Game};
\node (monitor) [io, text width=1cm,  below left of = otfprod, xshift=-1cm, yshift=1.3cm] {Monitor};

\node (directconstr) [process, text width=2cm, left of = formgame, xshift=-1.5cm] {Formulas to games};
\node (monconstr) [process, text width=2cm, left of = monitor, xshift=-.5cm, yshift=0cm] {Formulas to monitors};

\node (game) [io, text width=1.5cm, below of = gameprod, yshift=.6cm, xshift=0cm] {Symbolic game};

\node (gameinterface) [interface, text width=4cm, left of = game, xshift=-1.5cm] {Game-solving interface};

\node (rpg) [io, text width=.5cm, left of = gameinterface, xshift=-1.25cm] {RPG};
\node (rpgpars) [ext, text width=1.5cm, above left of = rpg, xshift=-.5cm, yshift=-1cm] {RPG parser};
\node (tslmttorpg) [ext, text width=1.5cm, below left of = rpg, xshift=-.5cm, yshift=.85cm] {\tslmtrpg};

\node (solver) [process, text width=1.5cm, below of = gameinterface,  yshift=.4cm] {Game solver};

\node (result) [text width=2.5cm, below of =solver, xshift=-1cm, yshift=0cm] {\textbf{Realizable/Unrealizable}};

\node (attracc) [process, text width=2.5cm, right of = solver,  xshift = 1cm] {Attractor acceleration};
\node (solveacc) [process, text width=2.5cm, below of =attracc, yshift=1cm] {Outer fixpoint acceleration};

\node (extract) [process, text width=2cm, left of = solver,  xshift = -.5cm] {Program extraction};
\node (absprog) [io, text width=1.4cm, left of = extract,  xshift = -.7cm] {Abstract reactive program};
\node (genc) [process, text width=2cm, below of =absprog, yshift=.6cm] {C program construction};


\draw [arrow] (issycomp) -- (llissyprob);
\draw [arrow] (llissyprob) -- (llissypars);
\draw [arrow] (llissypars) -- (spec);
\draw [arrow] ($(spec.north) - (2cm,0) $) -- ($(directconstr.south) - (.8cm,0) $);
\draw [arrow] ($(spec.north) + (0.13cm,0) $) -- (monconstr);
\draw [arrow] (monconstr) -- (monitor);
\draw [arrow] (directconstr) -- (formgame);
\draw [arrow] (monitor) -- (otfprod);
\draw [arrow] (formgame) -- (otfprod);
\draw [arrow] (otfprod) -- ($(enhgame.north) + (.65,0)$);
\draw [arrow] ($(enhgame.south) + (.65,0)$) -- (gameprod);
\draw [arrow] ($(spec.east) - (0.1,0.5)$) -- ($(gameprod.west) - (0,0.5)$);
\draw [arrow] (gameprod) -- (game);
\draw [arrow] (game) -- (gameinterface);


\draw [arrow] (rpgpars) -- (rpg);
\draw [arrow] (tslmttorpg) -- (rpg);
\draw [arrow] (rpg) -- (gameinterface);

\draw [arrow] (gameinterface) -- (solver);
\draw [doublearrow] (solver) -- (attracc);
\draw [doublearrow] (solver) -- (solveacc);


\draw [arrow] (solver) -- ($(result.north) + (1.35cm,0) $);

\draw [arrow] (solver) -- (extract);
\draw [arrow] (extract) -- (absprog);
\draw [arrow] (absprog) -- (genc);

\node (formulastogame) [draw=blue,very thick,rounded corners,fit = (directconstr) (monconstr) (formgame) (monitor) (otfprod), inner sep=3pt] {};
\begin{scope}[on background layer]
\node (symbgameconstruction) [draw=blue,very thick,rounded corners,fit = (formulastogame) (spec) (gameprod),inner sep=3pt,fill=blue!10] {};
\end{scope}


\begin{scope}[on background layer]
\node (synthesisengine) [draw=blue,very thick,rounded corners,fit = (solver) (extract) (attracc) (solveacc), inner sep=3pt,fill=blue!10] {};
\end{scope}

\node (issyf) [above of=issycomp,text width=.5cm,yshift=-.7cm] {\scalebox{1.9}{\faFile*[regular]}\newline \textbf{.issy}};
\draw [arrow] (issyf) -- (issycomp);

\node (llissyf) [left of=llissypars,text width=.5cm, xshift=.4cm] {\scalebox{1.9}{\faFile*[regular]}\newline \textbf{.llissy}};
\draw [arrow] (llissyf) -- (llissypars);

\node (rpgf) [left of=rpgpars,text width=.5cm, xshift=.4cm] {\scalebox{1.9}{\faFile*[regular]}\newline \textbf{.rpg}};
\draw [arrow] (rpgf) -- (rpgpars);

\node (tslmtf) [left of=tslmttorpg,text width=.5cm, xshift=.4cm] {\scalebox{1.9}{\faFile*[regular]}\newline \textbf{.tslmt}};
\draw [arrow] (tslmtf) -- (tslmttorpg);

\node (cf) [left of=genc,text width=.5cm, xshift=.3cm] {\scalebox{1.9}{\faFile*[regular]}\newline \textbf{.c}};
\draw [arrow] (genc) -- (cf);

\node [above of = otfprod,   xshift=-1.6cm, yshift=-.2cm] {\textcolor{blue}{\textbf{Translation to symbolic game} (Sec.~\ref{sec:to-game})}};

\node [above of = attracc,   yshift=-1.1cm,xshift=-1cm] {\textcolor{blue}{\textbf{Acceleration-based solver} (Sec.~\ref{sec:solver})}};
\end{tikzpicture}

\end{center}
