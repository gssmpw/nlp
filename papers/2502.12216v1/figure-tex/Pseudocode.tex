\begin{algorithm}[h]
\caption{Estimating Token Budget via Distribution Fitting}
\label{alg:token_selection}
\begin{algorithmic}[1]
\STATE \textbf{Input:} Token sequence unpacking from sorted clusters $\{x_1, x_2, \dots, x_n\}$, query $Q$, weight percentage threshold $P$, initial token count $N$, head dimension $d$
\STATE \textbf{Output:} Token budget $K$
\STATE
\STATE Compute $\mu_1$ and $\mu_2$ as the means of $\exp(x_i \cdot Q/ \sqrt{d})$ within fixed windows around $p_1$ and $p_2$. Solve for parameters $a$ and $b$ in $y = a/x + b$ the two data points.
\STATE
\STATE Initialize array $w_i$ to store the simulated attention scores for all tokens
\FOR{$i = 1$ to $n$} 
    \STATE \quad If $i \leq N$, $w_i = \exp(x_i \cdot Q/ \sqrt{d})$
    \STATE \quad Else, $w_i = a/i + b$
\ENDFOR
\STATE Compute the minimal $k$ such that the cumulative sum $\sum_{1}^k w_i \geq P \cdot \sum^{n}_{1}{w_i}$.
\STATE
\STATE \textbf{return} $k$
\end{algorithmic}
\end{algorithm}
