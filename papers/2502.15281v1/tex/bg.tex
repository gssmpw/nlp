\section{Background and Motivation} \label{s:bg}
\subsection{TEE Data Interaction} \label{s:params}
As shown in Fig.~\ref{fig:datacom}, the normal world and TEE are two independent environments, separated to ensure the security of sensitive functions and data. In this architecture, the communication between TEE and the normal world involves three types of parameters: input, output, and shared memory~\cite{s20041090}.

\begin{figure}[t]
    \centering
    \includegraphics[width=0.5\linewidth]{figures/Fig_2.drawio.pdf}
    \caption{Data communication between TEE and the normal world.}
    \label{fig:datacom}
\end{figure}

Input parameters are used to transfer data from the normal side to TEE, while outputs handle the results or send processed data back. Inputs and outputs are simple mechanisms that allow users to temporarily transfer small amounts of data between the normal world and TEE. However, temporary inputs/outputs realize data transfer through memory copying, slightly lowering the performance of TEE applications due to additional memory copy. They are mainly used to transmit lightweight data, such as user commands and data for cryptographic operations.

Shared memory provides a zero-copy memory block to exchange larger data sets (\eg, multimedia files or bulk data) between two sides~\cite{optee}. It allows both sides to access the same memory space efficiently, which avoids frequent memory copying. Shared memory can also remain valid across different TEE invocation sessions, making it suitable for scenarios that require data to be reused multiple times.

Moreover, an SDK is responsible for managing these parameters and communication in the normal side. For example, TrustZone-based OP-TEE uses \texttt{TEEC\_InvokeCommand()} function to execute the in-TEE code, enabling the shared memory or temporary buffers to transfer data between the two sides~\cite{8684292}. 
Then, OP-TEE can handle these interactions through its internal APIs, which process incoming requests, perform secure computations, and return responses to the normal world.
Similarly, Intel SGX utilizes the ECALL and OCALL interfaces to achieve these functionalities~\cite{10632129}. ECALLs allow the normal world to securely invoke functions within the SGX enclave, passing data into the trusted environment for processing, while OCALLs enable the enclave to request services or share results with the untrusted normal world.

Table~\ref{tbl:comp_params} illustrates some differences between input/output parameters and shared memory. It is important to note that, while the normal side cannot directly access the memory copies of input and output parameters in TEE, an attacker with the permissions of the normal world can still tamper with the inputs before they are transmitted to TEE or intercept and read the outputs after they are returned from TEE~\cite{9925569, 10477533}.
Additionally, since shared memory relies on address-based data transfer between the two sides, any modifications made to the data on one side will be instantly mirrored on the other opposing side.
Therefore, data interactions controlled by the normal world code are the root cause of the bad partitioning issues in TEE applications.

\begin{table}[t]
    \caption{Comparison of input/output parameters and shared memory.}
    \label{tbl:comp_params}
    % \renewcommand{\arraystretch}{1.3}
    % \footnotesize
    \setlength{\tabcolsep}{3mm}
    \centering
	\begin{tabular}{lp{4.5cm}p{4.5cm}}
		\toprule
		\textbf{Feature} & \textbf{Input/Output} & \textbf{Shared Memory} \\
		\midrule
            Data Size & Small & Big  \\
            Efficiency & Low, memory copying required & High, no need of additional memory copy\\
            Life-time & Temporary, valid for a single TEE invocation & Valid for a long time and shared among several TEE invocations \\
            Privilege & The normal world cannot reach memory copy in TEE & Both the normal world and TEE can access at the same time \\
		\bottomrule
	\end{tabular}
\end{table}
