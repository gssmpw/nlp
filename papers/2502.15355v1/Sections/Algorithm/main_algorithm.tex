

\begin{algorithm}[t]
\small{
    \caption{The Learning Algorithm of MEC} 
    \label{algo: algorithm}
    \LinesNumbered
    \DontPrintSemicolon
    \KwIn{Input features $\mathbf{x}$, embedding layer of auxiliary CTR model $F_{\text{Emb}}$, iteration round $I_1, I_2$, hyperparameter of regularization loss $\alpha$ and hyperparameter of contrastive loss $\beta$.}
    \KwOut{Click-through rate probability $\hat{y}$.}
    $// ~~ \texttt{Stage 1: Embedding Layer Quantization}~(\S~\ref{subsubsec:stage1})$ \\
    \For{$i=1$ to $I_1$}{
        Generate origin embedding vectors $\mathbf{e}$ using Eq.~(\ref{eq:embedding})\; \\
        Initialize quantization method $\phi$\;
        Generate reconstruction loss $\mathcal{L}_{\text{recon}}$ using Eq.~(\ref{eq:loss_recon}) \;
        $// ~~ \texttt{Popularity-Weighted Regularization}~(\S~\ref{subsec:reg})$ \\
        Generate regularization loss $\mathcal{L}_{\text{reg}}$ using Eq.~(\ref{eq:loss_reg}) \;
        $// ~~ \texttt{Contrastive Product Quantization}~(\S~\ref{subsec:cons})$ \\
        Generate contrastive loss $\mathcal{L}_{\text{con}}$ using Eq.~(\ref{eq:loss_con})\;
        % $// ~~ \texttt{Fuse the losses of PQ stage}$ \\
        % $\mathcal{L}_{\text{total}} = \mathcal{L}_{\text{recon}} + \alpha \mathcal{L}_{\text{reg}} + \beta \mathcal{L}_{\text{con}}$ \\
        $\phi' \leftarrow \phi - (\nabla_{\phi}\mathcal{L}_{\text{recon}} + \alpha \nabla_{\phi} \mathcal{L}_{\text{reg}} + \beta \nabla_{\phi} \mathcal{L}_{\text{con}})$ \;
        \If{$|\phi'-\phi|<\epsilon$}{
            Break\;
        }
        Update $\phi \leftarrow \phi'$ \;
    }
    $// ~~ \texttt{Stage 2: Memory-Efficient CTR Prediction.}~(\S~\ref{subsubsec:stage2})$ \\
    \For{$i=1$ to $I_2$}{
        % $\mathbf{x} \leftarrow \phi(\mathbf{x})$ \;
        Transform $\mathbf{x}$ into compressed $\mathbf{e}$ through fixed $\phi$ using Eq.~(\ref{eq:compress_emb}) \;
        Initialize downstream CTR model $\psi$ \;
        Generate binary loss $\mathcal{L}_{\text{binary}}$ using Eq.~(\ref{eq:binary}) \;
        $\psi' \leftarrow \psi - \nabla_{\psi}\mathcal{L}_{\text{binary}}$ \;
        \If{$\mathcal{L}_{\text{binary}}<\epsilon$}{
            Break
        }
        Update $\psi \leftarrow \psi'$ \;
    }
    \Return{$\phi, \psi$}
}
\end{algorithm}