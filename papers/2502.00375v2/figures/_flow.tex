\usetikzlibrary{shapes.geometric}

\begin{tikzpicture}[square/.style={regular polygon,regular polygon sides=4}]

\draw[->] (-3.5,0) -- (3.5,0) node[right] {$x$};
\draw[->] (0,-3.5) -- (0,3.5) node[above] {$y$};

\node at (-0, 5.5) {\LARGE Stored Features};

\foreach \i in {-10,...,15} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{3*cos(\t)};
\pgfmathsetmacro{\y}{3*sin(\t)};
\fill[red] (\x, \y) circle (0.03);}

\foreach \i in {25,...,45} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{3*cos(\t)};
\pgfmathsetmacro{\y}{3*sin(\t)};
\fill[blue] (\x, \y) circle (0.03);}

\foreach \i in {55,...,70} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{3*cos(\t)};
\pgfmathsetmacro{\y}{3*sin(\t)};
\fill[green] (\x, \y) circle (0.03);}

\foreach \i in {85,...,105} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{3*cos(\t)};
\pgfmathsetmacro{\y}{3*sin(\t)};
\fill[yellow] (\x, \y) circle (0.03);}

\foreach \i in {135,...,165} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{3*cos(\t)};
\pgfmathsetmacro{\y}{3*sin(\t)};
\fill[purple] (\x, \y) circle (0.03);}

\draw[->] (-8,0) -- (-4.5,0) node[midway, above] {\LARGE k-Nearest Neighbor};


\node at (-11, 5.5) {\LARGE Extracted Features};

\node[fill=red] at (-10,4.33) [square,draw] {};
\node[fill=red] at (-10,4) [square,draw] {};
\node[fill=red] at (-10,3.66) [square,draw] {};

\node[fill=red] at (-11,4.33) [square,draw] {};
\node[fill=red] at (-11,4) [square,draw] {};
\node[fill=red] at (-11,3.66) [square,draw] {};

\node[fill=red] at (-12,4.33) [square,draw] {};
\node[fill=red] at (-12,4) [square,draw] {};
\node[fill=red] at (-12,3.66) [square,draw] {};

\draw[red] (-11,4) ellipse (2cm and 0.7cm);

\node[fill=blue] at (-10,2.33) [square,draw] {};
\node[fill=blue] at (-10,2) [square,draw] {};
\node[fill=blue] at (-10,1.66) [square,draw] {};

\node[fill=blue] at (-11,2.33) [square,draw] {};
\node[fill=blue] at (-11,2) [square,draw] {};
\node[fill=blue] at (-11,1.66) [square,draw] {};

\node[fill=blue] at (-12,2.33) [square,draw] {};
\node[fill=blue] at (-12,2) [square,draw] {};
\node[fill=blue] at (-12,1.66) [square,draw] {};

\draw[blue] (-11,2) ellipse (2cm and 0.7cm);

\node[fill=purple] at (-10,0.33) [square,draw] {};
\node[fill=purple] at (-10,-0) [square,draw] {};
\node[fill=purple] at (-10,-0.33) [square,draw] {};

\node[fill=purple] at (-11,0.33) [square,draw] {};
\node[fill=purple] at (-11,-0) [square,draw] {};
\node[fill=purple] at (-11,-0.33) [square,draw] {};

\node[fill=purple] at (-12,0.33) [square,draw] {};
\node[fill=purple] at (-12,-0) [square,draw] {};
\node[fill=purple] at (-12,-0.33) [square,draw] {};

\draw[purple] (-11,-0) ellipse (2cm and 0.7cm);

\node[fill=green] at (-10,-2.33) [square,draw] {};
\node[fill=green] at (-10,-2) [square,draw] {};
\node[fill=green] at (-10,-1.66) [square,draw] {};

\node[fill=green] at (-11,-2.33) [square,draw] {};
\node[fill=green] at (-11,-2) [square,draw] {};
\node[fill=green] at (-11,-1.66) [square,draw] {};

\node[fill=green] at (-12,-2.33) [square,draw] {};
\node[fill=green] at (-12,-2) [square,draw] {};
\node[fill=green] at (-12,-1.66) [square,draw] {};

\draw[green] (-11,-2) ellipse (2cm and 0.7cm);

\node[fill=yellow] at (-10,-4.33) [square,draw] {};
\node[fill=yellow] at (-10,-4) [square,draw] {};
\node[fill=yellow] at (-10,-3.66) [square,draw] {};

\node[fill=yellow] at (-11,-4.33) [square,draw] {};
\node[fill=yellow] at (-11,-4) [square,draw] {};
\node[fill=yellow] at (-11,-3.66) [square,draw] {};

\node[fill=yellow] at (-12,-4.33) [square,draw] {};
\node[fill=yellow] at (-12,-4) [square,draw] {};
\node[fill=yellow] at (-12,-3.66) [square,draw] {};

\draw[yellow] (-11,-4) ellipse (2cm and 0.7cm);

\node[inner sep=0pt] (russell) at (-34,4)
    {\includegraphics[width=0.04\textwidth]{images/midjourney_1.jpg}};
    
\node[inner sep=0pt] (russell) at (-33,4)
    {\includegraphics[width=0.04\textwidth]{images/midjourney_2.jpg}};
    
\node[inner sep=0pt] (russell) at (-32,4)
    {\includegraphics[width=0.04\textwidth]{images/midjourney_3.jpg}};

\draw[red] (-33,4) ellipse (2cm and 0.7cm);
\node[below] at (-37, 4.33) {\LARGE midjourney};

\node[inner sep=0pt] (russell) at (-34,2)
    {\includegraphics[width=0.04\textwidth]{images/dalle_1.jpg}};
    
\node[inner sep=0pt] (russell) at (-33,2)
    {\includegraphics[width=0.04\textwidth]{images/dalle_2.jpg}};
    
\node[inner sep=0pt] (russell) at (-32,2)
    {\includegraphics[width=0.04\textwidth]{images/dalle_3.jpg}};
    
\draw[blue] (-33,2) ellipse (2cm and 0.7cm);
\node[below] at (-37, 2.33) {\LARGE dalle};

\node[inner sep=0pt] (russell) at (-34,0)
    {\includegraphics[width=0.04\textwidth]{images/real_1.jpg}};
    
\node[inner sep=0pt] (russell) at (-33,0)
    {\includegraphics[width=0.04\textwidth]{images/real_2.jpg}};
    
\node[inner sep=0pt] (russell) at (-32,0)
    {\includegraphics[width=0.04\textwidth]{images/real_3.jpg}};
    
\draw[purple] (-33,0) ellipse (2cm and 0.7cm);
\node[below] at (-37, 0.33) {\LARGE real};

\node[inner sep=0pt] (russell) at (-34,-2)
    {\includegraphics[width=0.04\textwidth]{images/sdxl_1.jpg}};
    
\node[inner sep=0pt] (russell) at (-33,-2)
    {\includegraphics[width=0.04\textwidth]{images/sdxl_2.jpg}};
    
\node[inner sep=0pt] (russell) at (-32,-2)
    {\includegraphics[width=0.04\textwidth]{images/sdxl_3.jpg}};
    
\draw[green] (-33,-2) ellipse (2cm and 0.7cm);
\node[below] at (-37, -1.66) {\LARGE sdxl};

\node[inner sep=0pt] (russell) at (-34,-4)
    {\includegraphics[width=0.04\textwidth]{images/sd21_1.jpg}};
    
\node[inner sep=0pt] (russell) at (-33,-4)
    {\includegraphics[width=0.04\textwidth]{images/sd21_2.jpg}};
    
\node[inner sep=0pt] (russell) at (-32,-4)
    {\includegraphics[width=0.04\textwidth]{images/sd21_3.jpg}};
    
\draw[yellow] (-33,-4) ellipse (2cm and 0.7cm);
\node[below] at (-37, -3.66) {\LARGE sd21};

\node at (-34.5, 5.5) {\LARGE Input Training Images};


\draw[->] (-16,0) -- (-14,0) node[midway, above] {};

\draw[] (-16,0) -- (-16,-3.2) node[midway, above] {};
\draw[->] (-16,-3.2) -- (-30,-3.2) node[midway, above] {};
\node at (-27,-3.8) {\LARGE Pseudo-labeling};
\draw[] (-38.8, -4.8, 0) rectangle ++(8.5,10,0) node[midway] {};
    
\draw[->] (-30,0) -- (-28,0) node[midway, above] {};

\draw[fill=cyan] (-26, -2, 0) rectangle ++(0.2,4,0) node[midway] {};
\draw[fill=cyan] (-25, -1.5, 0) rectangle ++(0.2,3,0) node[midway] {};
\draw[fill=cyan] (-24, -1, 0) rectangle ++(0.2,2,0) node[midway] {};
\draw[fill=cyan] (-23, -0.5, 0) rectangle ++(0.2,1,0) node[midway] {};

\draw[] (-27, -2.5, 0) rectangle ++(5.2,5,0) node[midway] {};
\node at (-24.5, 5.5) {\LARGE Backbone Model};


\draw[->] (-21,0) -- (-20,0) node[midway, above] {};

\draw[->] (-18,-1.5) -- (-18,1.5) node[above] {$W_{y_i}$};

\pgfmathsetmacro{\t}{37 * 1.8};
\pgfmathsetmacro{\x}{-18 + 3*cos(\t)};
\pgfmathsetmacro{\y}{-1.5 + 3*sin(\t)};

\draw[orange] (-18,-1.5) -- (\x, \y) node[above] {$x_i$};
\draw[orange] (-18,-1.5) ++(\t:0.5) arc[start angle=0, end angle=89, radius=0.2];
\node at (-17.7, -0.2) {$\theta_{y_i}$};


\pgfmathsetmacro{\t}{63 * 1.8};
\pgfmathsetmacro{\x}{-18 + 3*cos(\t)};
\pgfmathsetmacro{\y}{-1.5 + 3*sin(\t)};

\draw[orange] (-18,-1.5) -- (\x, \y) node[above] {};


\foreach \i in {30,...,70} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{-18 + 3*cos(\t)};
\pgfmathsetmacro{\y}{-1.5 + 3*sin(\t)};
\fill[lime] (\x, \y) circle (0.03);}

\pgfmathsetmacro{\t}{70 * 1.8};
\pgfmathsetmacro{\x}{-18 + 3*cos(\t)};
\pgfmathsetmacro{\y}{-1.5 + 3*sin(\t)};

\draw[lime] (-18,-1.5) -- (\x, \y) node[above] {};


\pgfmathsetmacro{\t}{30 * 1.8};
\pgfmathsetmacro{\x}{-18 + 3*cos(\t)};
\pgfmathsetmacro{\y}{-1.5 + 3*sin(\t)};

\draw[lime] (-18,-1.5) -- (\x, \y) node[above] {};
\draw[lime] (-18,-1.5) ++(\t:0.8) arc[start angle=0, end angle=45, radius=0.3];
\node at (-17.2, -0.1) {m};

\node at (-18, 5.5) {\LARGE ArcFace Loss};


\draw[fill=cyan, opacity=0.1] (-39, -4.9, 0) rectangle ++(43,11,0) node[midway] {};
\node[blue] at (-19, -4.5) {\huge Training Phase};




\draw[fill=cyan, opacity=0.1] (-39, -14, 0) rectangle ++(43,8.9,0) node[midway] {};
\node[blue] at (-19, -13.7) {\huge New Label Adaptation};

\node at (-34.5, -5.6) {\LARGE New Label Inputs};

\node[inner sep=0pt] (russell) at (-34,-10)
    {\includegraphics[width=0.04\textwidth]{images/sd3_1.jpg}};
    
\node[inner sep=0pt] (russell) at (-33,-10)
    {\includegraphics[width=0.04\textwidth]{images/sd3_2.jpg}};
    
\node[inner sep=0pt] (russell) at (-32,-10)
    {\includegraphics[width=0.04\textwidth]{images/sd3_3.jpg}};

\draw[pink] (-33,-10) ellipse (2cm and 0.7cm);
\node[below] at (-37, -9.66) {\LARGE sd3};

\draw[->] (-30,-10) -- (-28,-10) node[midway, above] {};

\draw[fill=cyan] (-26, -12, 0) rectangle ++(0.2,4,0) node[midway] {};
\draw[fill=cyan] (-25, -11.5, 0) rectangle ++(0.2,3,0) node[midway] {};
\draw[fill=cyan] (-24, -11, 0) rectangle ++(0.2,2,0) node[midway] {};
\draw[fill=cyan] (-23, -10.5, 0) rectangle ++(0.2,1,0) node[midway] {};

\draw[] (-27, -12.5, 0) rectangle ++(5.2,5,0) node[midway] {};
\node at (-24.5, -5.6) {\LARGE Trained Model};

\draw[->] (-21,-10) -- (-14,-10) node[midway, above] {};

\node[fill=pink] at (-10,-10.33) [square,draw] {};
\node[fill=pink] at (-10,-10) [square,draw] {};
\node[fill=pink] at (-10,-9.66) [square,draw] {};

\node[fill=pink] at (-11,-10.33) [square,draw] {};
\node[fill=pink] at (-11,-10) [square,draw] {};
\node[fill=pink] at (-11,-9.66) [square,draw] {};

\node[fill=pink] at (-12,-10.33) [square,draw] {};
\node[fill=pink] at (-12,-10) [square,draw] {};
\node[fill=pink] at (-12,-9.66) [square,draw] {};

\draw[pink] (-11,-10) ellipse (2cm and 0.7cm);

\node at (-11, -5.6) {\LARGE New Label's Features};

\draw[->] (-8,-10) -- (-4.5,-10) node[midway, below] {\LARGE k-Nearest Neighbor};
\draw[] (-0.8,-3.7) -- (-6,-10) node[midway, above] {};

\draw[->] (-3.5,-10) -- (3.5,-10) node[right] {$x$};
\draw[->] (0,-13.5) -- (0,-6.5) node[above] {$y$};

\foreach \i in {-10,...,15} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{3*cos(\t)};
\pgfmathsetmacro{\y}{3*sin(\t)-10};
\fill[red] (\x, \y) circle (0.03);}

\foreach \i in {25,...,45} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{3*cos(\t)};
\pgfmathsetmacro{\y}{3*sin(\t)-10};
\fill[blue] (\x, \y) circle (0.03);}

\foreach \i in {55,...,70} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{3*cos(\t)};
\pgfmathsetmacro{\y}{3*sin(\t)-10};
\fill[green] (\x, \y) circle (0.03);}

\foreach \i in {85,...,105} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{3*cos(\t)};
\pgfmathsetmacro{\y}{3*sin(\t)-10};
\fill[yellow] (\x, \y) circle (0.03);}

\foreach \i in {135,...,165} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{3*cos(\t)};
\pgfmathsetmacro{\y}{3*sin(\t)-10};
\fill[purple] (\x, \y) circle (0.03);}

\foreach \i in {120,...,115} {
\pgfmathsetmacro{\t}{\i * 1.8};
\pgfmathsetmacro{\x}{3*cos(\t)};
\pgfmathsetmacro{\y}{3*sin(\t)-10};
\fill[pink] (\x, \y) circle (0.03);}

\node at (-0, -5.6) {\LARGE Stored Features};

\draw[black, dashed] (-2.5,-11.55) ellipse (0.3cm and 0.5cm);


\draw[fill=cyan, opacity=0.1] (-39, -22.2, 0) rectangle ++(43,8,0) node[midway] {};
\node[blue] at (-19, -21.4) {\huge Inference Phase};

\node at (-34.5, -14.8) {\LARGE Input Testing Images};

\node[inner sep=0pt] (russell) at (-34,-17)
    {\includegraphics[width=0.04\textwidth]{images/test_1_1.jpg}};
    
\node[inner sep=0pt] (russell) at (-33,-17)
    {\includegraphics[width=0.04\textwidth]{images/test_1_2.jpg}};
    
\node[inner sep=0pt] (russell) at (-32,-17)
    {\includegraphics[width=0.04\textwidth]{images/test_1_3.jpg}};
    
    
\node[inner sep=0pt] (russell) at (-34,-19)
    {\includegraphics[width=0.04\textwidth]{images/test_2_1.jpg}};
    
\node[inner sep=0pt] (russell) at (-33,-19)
    {\includegraphics[width=0.04\textwidth]{images/test_2_2.jpg}};
    
\node[inner sep=0pt] (russell) at (-32,-19)
    {\includegraphics[width=0.04\textwidth]{images/test_2_3.jpg}};
    
\draw[gray] (-33,-18) ellipse (2cm and 2.5cm);

\node[below] at (-37, -17.66) {\LARGE Test};

\draw[->] (-30,-18) -- (-28,-18) node[midway, above] {};

\draw[fill=cyan] (-26, -20, 0) rectangle ++(0.2,4,0) node[midway] {};
\draw[fill=cyan] (-25, -19.5, 0) rectangle ++(0.2,3,0) node[midway] {};
\draw[fill=cyan] (-24, -19, 0) rectangle ++(0.2,2,0) node[midway] {};
\draw[fill=cyan] (-23, -18.5, 0) rectangle ++(0.2,1,0) node[midway] {};

\draw[] (-27, -20.5, 0) rectangle ++(5.2,5,0) node[midway] {};
\node at (-24.5, -14.8) {\LARGE Trained Model};

\draw[->] (-21,-18) -- (-14,-18) node[midway, above] {};

\node[fill=gray] at (-10,-18.33) [square,draw] {};
\node[fill=gray] at (-10,-18) [square,draw] {};
\node[fill=gray] at (-10,-17.66) [square,draw] {};

\node[fill=gray] at (-11,-18.33) [square,draw] {};
\node[fill=gray] at (-11,-18) [square,draw] {};
\node[fill=gray] at (-11,-17.66) [square,draw] {};

\node[fill=gray] at (-12,-18.33) [square,draw] {};
\node[fill=gray] at (-12,-18) [square,draw] {};
\node[fill=gray] at (-12,-17.66) [square,draw] {};

\node at (-11, -14.8) {\LARGE Testing's Features};

\draw[->] (-8,-18) -- (-4.5,-18) node[midway, below] {\LARGE k-Nearest Neighbor};
\draw[] (-0.8,-13.7) -- (-6,-18) node[midway, above] {};

\draw[] (-2.5, -19, 0) rectangle ++(5,2,0) node[midway] {};
\node at (0, -18) {\LARGE Output predictions};

\end{tikzpicture}