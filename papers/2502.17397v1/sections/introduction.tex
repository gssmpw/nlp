In magnetic confinement fusion, the energy confinement time of the plasma is one of the key parameters for maximizing fusion performance. This quantity is known to scale with various plasma parameters, for example the plasma shape, the particle density or the strength of the magnetic field, among others~\cite{itpascaling1990}. However, distinct operating regimes have been discovered that provide better-than-expected scaling, which fall under the umbrella term of high-confinement mode (H-mode) regimes~\cite{hmode1982}. Operating in these high-performance regimes is crucial to maximize the performance of current-day and future devices~\cite{hmodeiter2008}.

To accelerate large-scale analysis of confinement states, or for real time control-scenarios, we need automatic confinement state detection algorithms. This task becomes difficult near state transitions or in marginal scenarios, however, much success has been achieved with data-driven models. Past works have developed methods for full-discharge confinement state identification on Alcator C-Mod~\cite{mathews2019}, COMPASS~\cite{zorek2022}, DIII-D~\cite{orozco2022,gill2024}, EAST~\cite{yang2024}, HL-2A~\cite{he2024}, KSTAR~\cite{shin2018,shin2020}, JET~\cite{meakins2010,gonzalez2012}, and TCV~\cite{matoslhd2020,matoslhd2021}. 

Still, these methods generally do not consider two key aspects. For one, predictions are generally provided as point estimates, giving no information about the associated prediction uncertainty. This additional dimension is critical to identify when model predictions can be trusted, for example in control scenarios or to ensure high-quality analyses. Additionally, the ability to deal with missing and/or broken input signals is generally not addressed. To enable wide-range applicability, models must be robust to these failure modes. Notably, some related works do incorporate a notion of uncertainty~\cite{gonzalez2012,verdoolaege2012,verdoolaege2012ppcf}, however, not in the full discharge setting or with expressive models such as neural networks (NNs). 

To incorporate the notions of \textit{uncertainty quantification} and \textit{model robustness}, we propose the use of ensembled data-driven methods. We combine methods on two axes: different types of models, and different sets of input signals. The former allows us to incorporate different inductive biases, i.e. varying the assumptions made by the algorithm. As a consequence we expect to reduce failure modes connected to model properties~\cite{strauss2018,kariyappa2019}. The latter decreases the sensitivity to overfitting on patterns identified in signals. We exploit the fact that one can measure the confinement state in various different ways, reducing the dependence on specific signals, and allow for easily handling missing and/or corrupted data. Collectively, the use of different models and inputs enables for better confidence estimates by examining variability in the individual predictions~\cite{lakshminarayanan2017,rahaman2021uncertainty}.

The problem is formulated as a supervised classification task with model confidence, along with the ability to deal with missing and/or broken input signals. We incorporate neural network-based methods for exploiting sequential patterns and use decision tree-based methods for static predictions. The former further develops works on neural network-based classification for confinement states~\cite{mathews2019,zorek2022,orozco2022,gill2024,yang2024,he2024,shin2020,meakins2010,matoslhd2020,matoslhd2021}, using the Fourier Neural Operator (FNO)~\cite{li2021} with a recurrent structure~\cite{hochreiter1997}, whereas the latter is implemented with gradient-boosted decision trees (GBDT) using XGBoost~\cite{xgboost2016}. On the feature axis we define input feature sets both categorized by their approximate `domain' and combinations thereof, and use both raw diagnostic measurements and engineer physically meaningful features. The model+input combinations are fit using multiple data-splits that cover varying (mutually exclusive) groups of experimental topics to encourage model generalization. Individual configurations are empirically calibrated to ensure meaningful uncertainties, and are combined through a weighted linear combination, allowing for robust classification with uncertainty quantification.

The model is developed for the Tokamak Ã  Configuration Variable (TCV). We aim to distinguish between the aforementioned low confinement mode (L-mode) and high confinement mode (H-mode), and an `in-between', dithering phase (D). A dataset of 302 fully labeled discharges---a confinement state label at each timestep---is used to fit and evaluate our proposed method. We publicly release the labels for this `TCV confinement state database', encouraging the community to build upon this work.

Evaluations are carried out to validate the method's prediction accuracy, the soundness of the provided confidence estimates, and the ability to deal with bad/missing data. We consider the Cohen's kappa coefficient and Expected Calibration Error as quantitative metrics covering accuracy and uncertainty. Qualitatively, we provide an extensive evaluation covering specific use-cases: ITER Baseline Scenario (IBL) plasmas~\cite{labit2024}, extrapolation to out-of-distribution regimes ($\delta_{\text{top}} > 0.3$ and $\beta_N > 1.7$), quasi-continuous exhaust (QCE) regimes~\cite{labit2019}, and unusual scenarios such as negative triangularity configurations~\cite{coda2022}. In short, our contributions can be summarized as follows:
\begin{itemize}
\item We create a dataset of confinement states for 302 TCV discharges, covering a wide variety of plasma regimes. This dataset is publicly available at~{[\textsc{released upon publication}]}.
\item We develop a method for robust confinement state classification with uncertainty quantification, using ensembles of different models and different feature sets. We use NN- and random forest-based models along with varying input sets including both raw measurements and engineered features. Through an ensembling procedure we can predict the confinement state with a meaningful prediction confidence and can deal with missing/corrupt signals.
\item We extensively evaluate the proposed method both quantitatively and qualitatively. Metrics are evaluated both for prediction accuracy and uncertainty calibration. We explore performance on a variety of plasma scenarios, consider extrapolation to out-of-distribution regimes, and extensively evaluate model robustness and the behavior of the confidence estimates.
\end{itemize}







