\section{Appendix}
\label{appendix}

\subsection{Action Space Details}
Here, we provide a more comprehensive explanation of the action space design. To ensure stable control and efficient learning, we define the action space over a short time horizon of 0.5 seconds. The ego vehicle's movement is modeled using discrete displacements in both the lateral and longitudinal directions.

\paragraph{Lateral Displacement.} 
The lateral displacement, denoted as $a^x$, represents the vehicle's movement in the lateral direction over the $0.5$-second horizon. We discretize this dimension into $N_x$ options, symmetrically distributed around zero to allow leftward and rightward movements, with an additional option to maintain the current trajectory. The set of possible lateral displacements is:
\begin{equation}
    a^x \in \{d^x_{\text{min}}, \dots, 0, \dots, d^x_{\text{max}}\}.
\end{equation}
In our implementation, we use $N_x = 61$, with $d^x_{\text{min}} = -0.75$ m, $d^x_{\text{max}} = 0.75$ m, and intermediate values sampled uniformly.

\paragraph{Longitudinal Displacement.} 
The longitudinal displacement, denoted as $a^y$, represents the vehicle's movement in the forward direction over the $0.5$-second horizon. Similar to the lateral component, we discretize this dimension into $N_y$ options, covering a range of forward displacements, including an option to maintain the current position:
\begin{equation}
    a^y \in \{0, \dots, d^y_{\text{max}}\}.
\end{equation}
In our setup, we use $N_y = 61$, with $d^y_{\text{max}} = 15$m, and intermediate values sampled uniformly.


\subsection{Implementation Details}
In this section, we summarize the training settings, configurations, and hyperparameters used in our approach.

\boldparagraph{Planning Pre-Training.}
The action space is discretized using predefined anchors $\mathcal{A} = \{(a^x_i, a^y_j)\}_{i=1,j=1}^{N_x,N_y}$. Each anchor corresponds to a specific steering-speed combination within the 0.5-second planning horizon. Given the ground truth vehicle position at $t=0.5\ \text{s}$ denoted as $p_\text{gt} = (p_\text{gt}^x, p_\text{gt}^y)$, we implement normalized nearest-neighbor matching over predefined anchor positions:
\begin{equation}
\begin{aligned}
\hat{i} &= \argmin_{i} \left\| \frac{\mathbf{a}^x_i - d^x_{\text{min}}}{d^x_{\text{max}}-d^x_{\text{min}}} - \frac{p_\text{gt}^x - d^x_{\text{min}}}{d^x_{\text{max}}-d^x_{\text{min}}} \right\|_2 ,\\
\hat{j} &= \argmin_{j} \left\| \frac{\mathbf{a}^y_j - 0}{d^y_{\text{max}}-0} - \frac{p_\text{gt}^y - 0}{d^y_{\text{max}}-0} \right\|_2 .
\end{aligned}
\label{eq:anchor_matching}
\end{equation}
Based on the matched anchor indices $(\hat{i}, \hat{j})$, we formulate the imitation learning objective as a dual focal loss~\cite{lin2017focal}:
\begin{equation}
\mathcal{L}_\text{IL} = \mathcal{L}_\text{focal}(\pi(a^x\mid s), \hat{i}_t) + \mathcal{L}_\text{focal}(\pi(a^y\mid s), \hat{j}_t) ,
\end{equation}
where $\mathcal{L}_\text{focal}$ is focal loss for discrete action classification, and $\pi(a^x\mid s)$ and $\pi(a^y\mid s)$ are predicted action distributions from Eq.~\ref{eq:action distribution}.

\boldparagraph{Training configurations.} We provide detailed hyperparameters for the two main stages, Planning Pre-Training and Reinforced Post-Training, in Tab.~\ref{tab:Planning Pre-Training stage} and Tab.~\ref{tab:Planning Post-Training stage}, respectively.

\begin{table}[h]
\centering
\tablestyle{8pt}{1.2}
\begin{tabular}{l|c}
config &Planning Pre-Training \\
\shline
learning rate & 1e-4 \\
learning rate schedule & cosine decay \\
optimizer & AdamW~\cite{adam,Loshchilov2019adamw} \\
optimizer hyper-parameters & $\beta_1$, $\beta_2$, $\epsilon$ = 0.9, 0.999, 1e-8 \\
weight decay & 1e-4 \\
batch size & 512 \\
training steps & 30k \\
planning head dim & 256 \\
\end{tabular}
\caption{Hyperparameters used in \thename{} Planning Pre-Training stage.}
\label{tab:Planning Pre-Training stage}    
\end{table}

\begin{table}[h]
\centering
\tablestyle{8pt}{1.2}
\begin{tabular}{l|c}
config &Reinforced Post-Training \\
\shline
learning rate & 5e-6 \\
learning rate schedule & cosine decay \\
optimizer & AdamW~\cite{adam,Loshchilov2019adamw} \\
optimizer hyper-parameters & $\beta_1$, $\beta_2$, $\epsilon$ = 0.9, 0.999, 1e-8 \\
weight decay & 1e-4 \\
RL worker number & 32 \\
RL batch size & 32 \\
IL batch size & 128 \\
GAE parameter & $\gamma=0.9$, $\lambda=0.95$ \\
clipping thresholds & $\epsilon_x=0.1$, $\epsilon_y=0.2$ \\
deviation threshold  & $d_{\text{max}}=2.0m$, $\psi_{\text{max}}=40^\circ$ \\
planning head dim & 256 \\
value function dim & 256 \\
\end{tabular}
\caption{Hyperparameters used in \thename{} Reinforced Post-Training stage.}
\label{tab:Planning Post-Training stage}    
\end{table}

\subsection{Metric Details}
We evaluate the performance of the autonomous driving policy using eight key metrics.  

\boldparagraph{Dynamic Collision Ratio (DCR).} DCR quantifies the frequency of collisions with dynamic obstacles. It is defined as: 
\begin{equation}
DCR = \frac{N_{dc}}{N_{total}},
\end{equation}
where \( N_{dc} \) is the number of clips in which collisions with dynamic obstacles occur, and \( N_{total} \) is the total number of clips.  

\boldparagraph{Static Collision Ratio (SCR).} SCR measures the frequency of collisions with static obstacles and is defined as:  
\begin{equation}
SCR = \frac{N_{sc}}{N_{total}},
\end{equation}
where \( N_{sc} \) is the number of clips with static obstacle collisions.  

\boldparagraph{Collision Ratio (CR).} CR represents the total collision frequency, given by:  
\begin{equation}
CR = DCR + SCR.
\end{equation}

\boldparagraph{Positional Deviation Ratio (PDR).} PDR evaluates the ego vehicleâ€™s adherence to the expert trajectory in terms of position. It is defined as:  
\begin{equation}
PDR = \frac{N_{pd}}{N_{total}},
\end{equation}
where \( N_{pd} \) is the number of clips in which the positional deviation exceeds a predefined threshold.  

\boldparagraph{Heading Deviation Ratio (HDR).} HDR assesses orientation accuracy by computing the proportion of clips where heading deviations surpass a predefined threshold:  
\begin{equation}
HDR = \frac{N_{hd}}{N_{total}},
\end{equation}
where \( N_{hd} \) is the number of clips where the heading deviation exceeds the threshold.  

\boldparagraph{Deviation Ratio (DR).} captures the overall deviation from the expert trajectory, given by:  
\begin{equation}
DR = PDR + HDR.
\end{equation}

\boldparagraph{Average Deviation Distance (ADD).} ADD quantifies the mean closest distance between the ego vehicle and the expert trajectory during time steps when no collisions or deviations occur. It is defined as:  
\begin{equation}
ADD = \frac{1}{T_{safe}} \sum_{t=1}^{T_{safe}} d_{min}(t),
\end{equation}
where \( T_{safe} \) represents the total number of time steps in which the ego vehicle operates without collisions or deviations, and \( d_{min}(t) \) denotes the minimum distance between the ego vehicle and the expert trajectory at time step \( t \).  

Finally, \textbf{Longitudinal Jerk (Long. Jerk)} and \textbf{Lateral Jerk (Lat. Jerk)} quantify the smoothness of vehicle motion by measuring acceleration changes. Longitudinal jerk is defined as:  
\begin{equation}
J_{long} = \frac{d^2 v_{long}}{dt^2},
\end{equation}
where \( v_{long} \) represents the longitudinal velocity. Similarly, lateral jerk is defined as:  
\begin{equation}
J_{lat} = \frac{d^2 v_{lat}}{dt^2},
\end{equation}
where \( v_{lat} \) is the lateral velocity. These metrics collectively capture abrupt changes in acceleration and steering, providing a comprehensive measure of passenger comfort and driving stability.

\subsection{More Qualitative Results}
This section presents additional qualitative comparisons across various driving scenarios, including detours, crawling in dense traffic, traffic congestion, and U-turn maneuvers. The results highlight the effectiveness of our approach in generating smoother trajectories, enhancing collision avoidance, and improving adaptability in complex environments.

\begin{figure*}[h]
\centering
\vspace{1mm}
\includegraphics[width=0.98\textwidth]{fig/vs2-2.pdf} 
\vspace{2mm}
\caption{
\textbf{More Qualitative Results.} Comparison between the IL-only policy and \thename{} in various driving scenarios: Detour (Rows 1-2), Crawl in Dense Traffic (Rows 3-4), Traffic Congestion (Rows 5-6), and U-turn(Rows 7-8).
}
\label{fig:more-vis}
\end{figure*}