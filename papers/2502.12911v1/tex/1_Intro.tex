\section{Introduction}
\label{sec:introduction}

\begin{figure}[!h]
	\centering
        \includegraphics[width=1.0\linewidth]{fig/intro-figure_schema-linking.pdf}
        \caption{In text-to-SQL tasks, commonly used schema linking metrics such as Recall and Precision fail to accurately capture the true performance of schema linking when relevant schema elements are missing.} 
        \label{fig:motivation}
\end{figure}

\begin{figure*}[!h]
	\centering
        \includegraphics[width=1.0\linewidth]{fig/main_figure.pdf}
        \caption{Overall framework of proposed knapsack optimization-based schema linking agent (KaSLA) with column linking as an example. Traditional schema linking models often struggle with both missing relevant elements and the inclusion of redundant ones. KaSLA addresses this challenge by maximizing the total estimated relevance while maintaining total redundancy within a specified tolerance using knapsack optimization. Serving as a general model, KaSLA enhances the SQL generation of text-to-SQL models by replacing their existing schema linking processes.} 
        \label{fig: KaSLA main figure}
\end{figure*}


With the advent of large language models (LLMs)~\citep{achiam2023gpt,dubey2024llama3}, LLM-based text-to-SQL is emerging as the next-generation interface for database users~\citep{hong2024next}. Typically, text-to-SQL frameworks employ a two-step process: first linking database schema elements (tables and columns) to user queries, then generating the corresponding SQL statements. However, the accurate SQL generation requires the linking to the correct schema elements, meaning that errors in early stages are inevitably propagated to later SQL generation. For instance, inaccurate schema linking---such as overlooking relevant schema elements or linking to irrelevant ones---will lead to incorrect SQL statements.

Recent state-of-the-art text-to-SQL models tend to focus primarily on final SQL generation while employing relatively simplistic schema linking strategies or neglecting it.
DTS-SQL~\citep{pourreza2024dtssql} finetunes a local LLM to select relevant tables based on user queries. Solid-SQL~\citep{liu-etal-2025-solid} present a data augmentation method for the finetuning of Schema linking method. Chess~\citep{talaei2024chess} and CodeS~\citep{li2024codes} use semantic-based retrieval models to enhance the schema linking process by retrieving relevant information from databases. RSL-SQL~\citep{cao2024rsl} introduces a bidirectional approach to simplify the full schema. E-SQL~\citep{qu2024before} and \citep{maamari2024death} assert that schema linking remains challenging for current LLMs and thus directly use the full schema as input for SQL generation.

Even though schema linking is crucial, current widely used metrics, such as Precision and Recall~\citep{li2023resdsql,li2024codes,qu2024before}, cannot adequately evaluate instances when relevant elements are missing. As demonstrated in Figure~\ref{fig:motivation}, missing a single relevant table or column can significantly decrease the accuracy of SQL generation, yet still result in high Recall and Precision scores. Because Recall does not significantly penalize the model as long as the majority of the relevant elements are identified, allowing it to achieve an artificially high score, even when crucial elements are missing.
Similarly, regardless of the severity of the missing, as long as the number of correctly linked elements is proportionally high compared to the total predicted relevant elements, the model can achieve an unreasonably high Precision score. This discrepancy distorts the assessment of a schema linking modelâ€™s effectiveness, potentially hindering progress in text-to-SQL development.

To address this, we firstly design a tailored schema linking metrics that accurately assess linking performance with \textbf{a restricted element missing indicator}.
Additionally, we propose the \textbf{\underline{K}n\underline{a}psack optimization-based \underline{S}chema \underline{L}inking \underline{A}gent (KaSLA)}, designed to link the most relevant and minimally redundant schema elements according to the given queries.
KaSLA introduces a binary-probabilistic score function to predict a robust relevance score of each element. Additionally, KaSLA identifies redundancy of each element and the upper redundancy tolerance for each query based on its most similar queries in the training dataset, effectively minimizing the inclusion of redundant elements.
Finally, KaSLA links tables and columns with an hierarchical strategy to reduce the column linking candidate space for efficiency and employs a 0-1 knapsack optimization approach to select the most relevant element set under the upper redundancy tolerance to reduce the redundant linking. Extensive experiments demonstrate that KaSLA can improve SQL generation accuracy by reducing missing and redundant information in the schema linking.

In summary, our contributions are as follows:
\begin{itemize}[leftmargin=2em]
\item We introduce an enhanced schema linking metric, which can accurately capture the missing of relevant elements and reflect the actual linking performance aligning with the SQL generation performance.
\item We propose the \underline{K}n\underline{a}psack optimization-based \underline{S}chema \underline{L}inking \underline{A}gent (KaSLA) to ensure the linking of relevant schema elements and minimizing the inclusion of redundant ones.
\item KaSLA can serve as a general agent to enhance LLM-based text-to-SQL framework by provide optimal linking results. Extensive experiments demonstrate improved performance in the SOTA text-to-SQL models when using KaSLA for schema linking.
\end{itemize}
