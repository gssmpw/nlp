\begin{algorithm}
\caption{SPARC Pipeline}
\label{alg:sparc}
\begin{algorithmic}
\STATE \textbf{Input:} Images $\mathcal{I}$, Class Names $\mathcal{C}$
\STATE \textbf{Output:} Final scores $\zeta^t_i$ for each image $t$ and class $i$
\STATE $P \gets \text{GenerateCompoundPrompts}(\mathcal{C})$ \hfill \textit{(Details in Supp.)}
\FOR{$t \in \mathcal{I}$}
   \STATE $s^t_i \gets \text{GetVLMScores}(t, i)$ \hfill\textit{(Singleton scores)}
   \STATE $\forall p \in P,$ $s^t_p \gets \text{GetVLMScores}(t, p)$ \hfill\textit{(Compound scs.)}
   \STATE // \textit{(Debias scores (Eqs.~\ref{eqn:debias_images},\ref{eqn:debias_classes}))}
   \STATE $\tilde{s}^t_i \gets \text{ImageDebias}(s^t_i)$, $\tilde{s}^t_p \gets \text{ImageDebias}(s^t_p)$
   \STATE $\bar{s}^t_i \gets \text{PromptDebias}(\tilde{s}^t_i)$,
   $\bar{s}^t_p \gets \text{PromptDebias}(\tilde{s}^t_p)$
   \FOR{$i \in \mathcal{C}$}
       \STATE $r^t_{i,k} \gets \text{GetOrderStatistics}(\{\bar{s}^t_p: i \in p\})$
       \STATE $w^{i*} \gets \text{MaxVarDirection}([\bar{s}_i^t, r^t_{i,k}])$ \hfill 
 \textit{(Eq.~\ref{eq:maxVariance})}
       \STATE $\tilde{\zeta}^t_i \gets w^{i*}_0 \bar{s}^t_i + \sum_k w^{i*}_k r^t_{i,k}$ \hfill \textit{(Eq.~\ref{eqn:pca_projection})}
       \STATE $\zeta^t_i \gets \bar{s}^t_i + \tilde{\zeta}^t_i$  \hfill \textit{(Eq.~\ref{eq:merge})}
   \ENDFOR
\ENDFOR
\RETURN $\{\zeta^t_i\}$
\end{algorithmic}
\end{algorithm}
