\documentclass[12pt]{article}

% Required packages
\usepackage{amsmath} % For mathematical symbols and align environment
\usepackage{amssymb} % For additional math symbols
\usepackage{amsthm} % For theorem, remark environments
\usepackage{graphicx} % For including graphics (if needed)
\usepackage{hyperref} % For hyperlinks in the document
\usepackage{xcolor} % For colored text (optional)
\usepackage{geometry} % To adjust page layout
\geometry{a4paper, margin=1in} % Set page margins

% Custom commands (optional)
\newcommand{\R}{\mathbb{R}} % Example: for real numbers symbol
\newcommand{\circled}[1]{\overset{\circ}{#1}} % For the Hadamard product notation

% Title and author (optional, adjust as needed)
\title{Line Search Algorithm for Fused-PGW}
\author{}
\date{} % Leave blank for no date

\begin{document}

\maketitle

\section{Line search algorithm}
The line search for Fused-GW is defined as 
\begin{align}
\min_{\alpha\in[0,1]}\mathcal{L}((1-\alpha)\gamma^{(k-1)}+\alpha\gamma^{(k)}{'}) \label{eq:line_search_prob_fpgw},
\end{align}
where $\mathcal{L}(\gamma)=(1-\text{reg})\langle C,\gamma \rangle+\text{reg}\langle M,\gamma^{\otimes2} \rangle$, $M=[|C^X_{i,i'}-C^Y_{j,j'}|]_{i,i'\in[1:n],j,j'\in[1:m]}\in \mathbb{R}^{n\times m\times n\times m},(1-\text{reg}),\text{reg}\in[0,1]$ with $(1-\text{reg})+\text{reg}=1$. 

Let $\delta\gamma=\gamma^{(k)}{'}-\gamma^{(k-1)}$. The above problem is essentially a quadratic problem with respect to $\alpha$: 
\begin{align}
&\mathcal{L}((1-\alpha)\gamma^{(k-1)}+\alpha\gamma^{(k)}{'})\nonumber\\
&=\mathcal{L}(\gamma^{(k-1)}+\alpha\delta\gamma)\nonumber\\
&=(1-\text{reg}) \langle C,(\gamma^{(k-1)}+\alpha\delta\gamma) \rangle+\text{reg}\langle M\circ (\gamma^{(k-1)}+\alpha\delta\gamma),(\gamma^{(k-1)}+\alpha\delta\gamma) \rangle \nonumber\\
&=\alpha^2\underbrace{\text{reg}\langle M\circ \delta\gamma,\delta\gamma\rangle}_{a}+\alpha \underbrace{\langle 2\text{reg}M\circ \gamma^{(k-1)}+(1-\text{reg})C,\delta\gamma\rangle}_{b}+\underbrace{\langle \text{reg} M\circ\gamma^{(k-1)}+(1-\text{reg})C,\gamma^{(k-1)}\rangle}_c \nonumber 
\end{align}
where $M\circ \gamma=[\sum_{i',j'}M_{i,j,i',j'}\gamma_{i',j'}]_{i\in[1:n,j\in[1:m]]}$, 
and $\alpha^*$ is given by 
\begin{align}
\alpha^*=\begin{cases}
    1 &\text{if } a\leq 0, a+b\leq 0, \\
    0 &\text{if }a\leq 0, a+b>0\\
    \text{clip}(\frac{-b}{2a},[0,1]), &\text{if }a>0 
\end{cases}\label{eq:line_search_sol_1}. 
\end{align}

Next, we further simplify $a$ and $b$.

We first introduce some fundamental results:  
Let $f_1(r_1) = r_1^2$, $f_2(r_2) = r_2^2$, $h_1(r_1) = 2r_1$, and $h_2(r_2) = r_2$. Then, we have:  
$$
|r_1 - r_2|^2 = f_1(r_1) + f_2(r_2) - h_1(r_1)h_2(r_2).
$$
Therefore, for all $\gamma \in \mathbb{R}^{n \times m}$, we have:  
$$
M \circ \gamma = f_1(C^X)\gamma 1_m 1_m^\top + 1_n (\gamma^\top 1_n)^\top f_2(C^Y)^\top - h_1(C^X)\gamma h_2(C^Y)^\top.
$$

Since $\delta \gamma = \gamma^{(k)}{'} - \gamma^{(k)}$ and $\gamma^{(k)}, \gamma^{(k)}{'} \in \Gamma(p, q) := \{\gamma \in \mathbb{R}^{n \times m} : \gamma 1_m = p, \gamma^\top 1_n = q\}$, it follows that:  
$$
\delta \gamma 1_m = 0_n, \quad \delta \gamma^\top 1_n = 0_m.
$$

Thus, we have:  
$$
M \circ \delta \gamma = -2 C^X \delta \gamma (C^Y)^\top := -2\text{dot},
$$
and therefore:  
$$
a = -2\text{reg}\langle\text{dot},\delta\gamma \rangle. \label{eq:a}
$$

Similarly,  
\begin{align}
b &= \langle 2\text{reg} M \circ \gamma^{(k-1)} + (1-\text{reg}) C, \delta \gamma \rangle \nonumber \\
  &= (1-\text{reg}) \langle C, \delta \gamma \rangle + 2\text{reg} \langle M \circ \delta \gamma, \gamma^{(k-1)} \rangle \nonumber \\
  &= (1-\text{reg}) \langle C, \delta \gamma \rangle + 2\text{reg} \langle -2\text{dot}, \gamma^{(k-1)} \rangle \nonumber \\
  &= \langle (1-\text{reg}) C, \delta \gamma \rangle - 4\text{reg} \langle \text{dot}, \gamma^{(k-1)} \rangle. \nonumber
\end{align}






\end{document}
