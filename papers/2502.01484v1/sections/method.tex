\section{Free Workspace Exploration}
\label{sec:freeWorkspaceExploration}
\noindent This section describes the entire pipeline for modeling the constraints imposed by static obstacles in the robot cell environment.
It is based on the robot's exploratory motions without the use of any additional sensor.
Our pipeline consists of four main steps (see \refFig{fig:pipeline}), 
which will be detailed in the following subsections: 
1)~sweep through free space,
2)~swept volume,
3)~volume decimation, and
4)~obstacle representation.
The outcome is a mesh describing the boundary of the explored collision-free space. 
It can then be utilized within established collision-free trajectory planning and control methods to generate safe robot motions. 
Steps 1\,--\,3 can optionally be repeated to cover more space and improve the results.


\begin{figure*}[!t]
	\centering
	\input{./figures/pipeline.tex}
	\caption{The proposed pipeline consists of 4 steps. % (the dashed frames represent the optional steps). 
	First, exploratory robot motions %(e.g., through hand guidance, teleoperation, jogging, or automatic strategies) 
	sweeps the free space of the constrained robot cell. 
	The recorded joint trajectories $\jointConfTime$ are utilized to compute the robot link poses and, thus, 
	the corresponding link swept volumes $\volume{i}$. 
	These 3D meshes can optionally be decimated to obtain a simplified volume $\decimatedVolume{i}$ while preserving the overall shape. 
	We obtain a representation of the unexplored and potentially occupied space $\volume{O}$
	by carving out the link swept volumes from a bounding volume that covers the entire robot workspace.
	Steps 1\,--\,3 can be optionally repeated in additional exploration sessions to improve the representation of $\volume{O}$. 
	The 3D mesh associated with $\volume{O}$ can subsequently be utilized 
	within established methods for a collision-free trajectory planning and control.
	}
	\label{fig:pipeline}
\end{figure*}

\textbf{Assumptions:}
The approach considers a robot with $\numLinks$~non-static rigid links connected by joints, 
potentially including tools temporarily attached. 
The configuration-dependent position and orientation of all links must be accessible.
We assume that accurate meshes for all links and tools are provided.
Furthermore, 
the robot cell must be static,
i.e., 
there are no moving obstacles or humans entering the workspace.
Notice that these are reasonable assumptions for many industrial production sites.
Our approach is solely based on data gathered through exploratory motions within few minutes and does not require any external perception.

In this letter,
we are focusing on fixed-base manipulators in confined spaces, 
but the approach applies identically to floating-base systems such as legged and mobile robots.
To illustrate the pipeline steps throughout this section,
we chose an ideal planar robot manipulator with $\numLinks=3$ non-static links as a running example (\refFig{fig:snake_robot}). 
\refSec{sec:experiments} reports results obtained with a KUKA LBR iisy collaborative robot. % and $\numLinks=6$ non-static links.

\subsection{Sweep through Free Space} %Robot hand guidance
\label{subsec:sweepFreeSpace}
The novel idea is to utilize the robot swept volume (SV) resulting from exploratory motions 
to identify the collision-free space within the constrained robot cell.
During this exploratory phase, 
the robot's volume may be intentionally modified, 
i.e., 
by mounting an additional rigid body on the robot flange.
Increasing the robot's overall shape allows for exploring more space in the same amount of time 
or the same space in less time without changing the robot's velocity.
A suitable modification also supports industrial scenarios requiring robot tool changes to satisfy the desired task scenario.

\subsubsection{Exploratory Robot Motion}
The exploration of the constrained workspace can be performed by a human operator through hand guidance, tele-operation, jogging, or other means.
Alternatively,
the robot may also explore its cell autonomously,
i.e., 
it moves (randomly) through free space and reverts its direction of motion upon contact detection.
The robot's velocity during this exploratory phase does not affect the subsequent steps of our pipeline 
as the robot's SV only depends on the joint configurations. 
The recorded joint trajectories $\jointConfTime$ %\inR{\numLinks} 
of the exploratory motions are continuous and smooth. %are recorded in the time interval $t \in \timeInterval{0}{T}$.


\subsubsection{Exploration Tool}
The end-effector tool(s) required for the actual task scenario can be used in the exploratory phase. 
However, the CAD models of such tools are typically very detailed, 
even when simplified, 
thus leading to high computation times and, 
possibly, 
to numerical instabilities during the subsequent steps of our pipeline.
Therefore, in the exploratory phase, 
the robot's shape may be modified by mounting an exploration tool on the flange, 
which increases the robot's overall volume and speeds up the exploration process.
Such an exploration tool can be customized for the exploratory motion phase.
For its design, we recommend simple geometric shapes made of lightweight material without any electronics involved.
Furthermore, 
choosing a form that encloses the tools 
(e.g., gripper or pneumatic suction cup) used later to achieve the actual task may be beneficial.
The dimensions of the exploration tool may also be determined by considering the specific robot cell setup.
If, 
for example, 
narrower gaps are of interest,
the dimensions of the exploration tool should be designed accordingly. 
Moreover, 
the exploratory phase may also involve multiple exploration tools.
Note that modern tool change systems allow users to quickly and flexibly switch between different tools.
In the future, 
robot manufacturers might deliver new manipulators together with a set of such exploration tools that are cheap to produce.

\subsection{Swept Volume} %for Robot Manipulators
\label{subsec:sweptVolume}
The swept volume is the space a rigid body occupies as it moves. 
By definition, 
it encompasses all points within the object at any given moment of the motion.
Given a rigid body $B$ moving on a path in the time interval $\timeInterval{0}{T}$,
its swept volume $\volume{S}$ is %defined as
\begin{equation}
	\label{eq:sweptVol}
	\volume{S} = 
	\bigcup_{t\thinspace\in\thinspace\timeInterval{0}{T}}
	\volumeWithDepArg{B}{{\transfMat{t}}},
\end{equation}
where $\volume{B}\subsetOfR{3}$ is the volume occupied by the rigid body,  whose pose along the path is described by the homogeneous transformation matrix $\transfMat{t}$. %\inR{4\times4}.

Given the joint trajectories $\jointConfTime$ recorded in the previous step,
the corresponding $i$-th robot link pose $\transfMatLinkTime{i}$ at time~$t$ is obtained 
by utilizing the robot kinematic model.
This allows computing the swept volume $\volume{i}$ of the $i$-th non-static robot link using~\eqref{eq:sweptVol}. 
The computation can be performed for all $\numLinks$ non-static links 
in parallel improving computational efficiency\footnote{Note that the base link of a fixed-base manipulator does not move, 
and, 
hence, 
its swept volume is identical to its body shape.}.
Note that the SV computation is not negatively affected by clustered or heterogeneously distributed data 
(e.g., same or similar joint configurations recorded in the exploration phase).

A volume can generally be represented through a 3D mesh, 
whose faces can be triangles, 
quadrilaterals, or polygons.
In the following, we will consider a triangle mesh to represent a volume without loss of generality.

\Crefrange{fig:snake_sv_l1}{fig:snake_sv_l3} show the highly non-convex swept volumes associated with the three links of a planar robot, 
representing altogether the collision-free space discovered during the exploratory phase. 
%Notice that the operation described in~\eqref{eq:sweptVol} has been performed exactly $\numJoints$ times, 
%as the robot has no fixed base. 
No exploration tool has been used.

\begin{figure*}
	\centering
	\begin{minipage}{.49\linewidth}
		\begin{subfigure}[t]{.49\linewidth}
			\centering
			\includegraphics[width=\textwidth]{figures/snake_setup_8k}
			\caption{Constrained environment.}
			\label{fig:snake_robot}
		\end{subfigure}
		\hfill
		\begin{subfigure}[t]{.49\linewidth}
			\centering
			\includegraphics[width=\textwidth]{figures/snake_sv_l1_8k}
			\caption{SV of the first link.}
			\label{fig:snake_sv_l1}
		\end{subfigure} \\
		\begin{subfigure}[t]{.49\linewidth}
			\centering
			\includegraphics[width=\textwidth]{figures/snake_sv_l2_8k}
			\caption{SV of the second link.}
			\label{fig:snake_sv_l2}
		\end{subfigure}
		\hfill
		\begin{subfigure}[t]{.49\linewidth}
			\centering
			\includegraphics[width=\textwidth]{figures/snake_sv_l3_8k}
			\caption{SV of the third link.}
			\label{fig:snake_sv_l3}
		\end{subfigure}		
	\end{minipage}
	\hfill
	\begin{minipage}{.49\linewidth}
		\begin{subfigure}[t]{\linewidth}
			\centering
			\includegraphics[width=\textwidth,height=9.24cm]{figures/snake_obstacle_8k}
			\caption{Obstacle representation (in green) with overlapping environment.}
			\label{fig:snake_obstacle_space}
		\end{subfigure}
	\end{minipage}
	\caption{Results obtained with step 2 and 4 of our proposed pipeline for a planar robot (in red) with three non-static links.}
	\label{fig:snake_experiment}
\end{figure*}

\subsection{Volume Decimation (Optional)}
\label{subsec:volumeDecimation}
The usage of complex mesh representations in the context of computer graphics and 
3D modeling has encouraged research into new techniques
to (conservatively) simplify and reduce the size of a given mesh. 
This has resulted in the development of several decimation algorithms~\cite{cignoni1998comparison}.
These methods modify the 3D model by reducing the number of vertices, 
edges, 
and/or faces without (or conservatively) altering its overall shape and volume. 
This is achieved by identifying elements not strictly necessary to describe the object mesh.
Decimation algorithms iterate until a user-specified termination condition is met,
typically defined as a face reduction percentage.
In the following, 
the decimated volume of the $i$-th link SV is referred to as $\decimatedVolume{i}$.
This step is optional within our pipeline 
and often beneficial to reduce overall computation times (see \refSec{subsec:roleOfVolDeci}).

\subsection{Obstacle Representation}
\label{subsec:obstacleRepresentation}
Next, we compute a representation of the unexplored and (potentially) occupied volume $\volume{O}$.
%Therefore, 
%unexplored regions will be considered as obstacles.
%The obstacle representation is complementary to the robot SV representation.
It is obtained through
\begin{equation}
	\label{eq:obstacleSpace}
	\volume{O}=
	\left(
	\left(  
	\left(
	\volume{BV}
	~\backslash~
	\volume{1}
	\right)
	~\backslash~
	\volume{2}
	\right)
	~\backslash~
	\ldots~
	\right)
	~\backslash~
	\volume{\numLinks},
\end{equation}
where $\volume{BV}$ denotes a bounding volume covering the entire robot workspace.
An intuitive choice for the bounding volume in the case of a robot manipulator could be a sphere or cube parameterized according to the robot size.
The sequential operations in~\eqref{eq:obstacleSpace} are performed using the Boolean difference operator.
Initially defined in the Boolean algebra, 
Boolean operations have extended to computer graphics and 3D modeling.
%Several solid shapes can be obtained by combining two or more solids.
The Boolean difference of two solid models 
$\mathcal{A},\mathcal{B}\subsetOfR{3}$ 
%$\mathcal{A}\subsetOfR{3}$ and $\mathcal{B}\subsetOfR{3}$ 
is defined as
$ %\begin{equation}
	\mathcal{A}\,\backslash\,\mathcal{B} \coloneq
	\left\{
	\bm{x} \inR{3} 
	\mid 
	\bm{x} \in \mathcal{A}
	~\mathrm{and}~
	\bm{x} \notin \mathcal{B}
	\right\}.
$ %\end{equation}
Given $\numLinks$ swept volumes associated with the non-static robot links, 
the Boolean difference operation in~\eqref{eq:obstacleSpace} is performed $\numLinks$ times\footnote{The 
static base link of a fixed-base manipulator is not considered in~\eqref{eq:obstacleSpace}.}.
The resulting volume~$\volume{O}$ %obtained from~\eqref{eq:obstacleSpace} 
corresponds to the bounding volume~$\volume{BV}$
without a portion of the inner part.
Hence, 
$\volume{O}$~can be interpreted as a conservative mesh representation including all obstacles and unexplored areas in the confined workspace.
The robot is guaranteed to be collision-free as long as it does not penetrate~$\volume{O}$.

\refFig{fig:snake_obstacle_space} shows the unexplored and potentially occupied space 
obtained by considering the link swept volumes of the planar robot previously mentioned.

%Note that if some regions of the free workspace have not been properly explored, 
%and hence not swept by the robot,
%they will also be present in the obstacle representation and 
%considered as obstacles by the collision-free motion planner.

\subsection{Repeat (Optional)}
\label{subsec:repeatStep}
Suboptimal explorations can occur when the robot only partially sweeps the free workspace of interest.
Hence, 
unexplored areas will automatically be considered obstacles in the representation $\volume{O}$~obtained from~\eqref{eq:obstacleSpace},
negatively affecting the subsequent motion planning and control.
Therefore, 
after inspecting $\volume{O}$
(e.g., potentially using Augmented Reality glasses), 
the operator can perform additional exploration sessions (steps 1\,--\,3).
This way, 
the volume $\volume{O}$ will be further reduced, 
facilitating the collision-free motion planning.

\subsection{Discussion on Formal Guarantees}
Our approach is closely related to~\cite{Seidel2014}, 
describing a purely data-driven technique to environment modeling.
Given similar exploratory robot motions, 
a neural network for collision-free inverse kinematics is trained
and a graph representation in the task-space is built.
Each node in the graph represents a collision-free configuration.
Edges are introduced based on heuristics to connect neighboring nodes,
however, 
this process is not supported by any formal guarantee of a collision-free transition between nodes\footnote{Refer 
also to the figures 4 and 5 in~\cite{Seidel2014}.}.
Therefore, 
the authors suggest not to collect training data in proximity of the obstacles.
Furthermore, 
the method relies on a non-trivial distance metric that integrates both task- and joint-space information,
and requires the tuning of several hyper-parameters.
Together, 
the neural network and graph, 
implicitly form an environment model, 
which is utilized for autonomous motion planning.
It is, 
however, 
not suitable for reactive control.

In contrast, 
our approach explicitly generates an accurate environment model represented as a mesh, 
thus providing formal guarantees: 
as long as the robot moves within the previously explored space, 
collision-free motions are guaranteed.
This is achieved through algorithms for computing SVs and boolean operations that produce correct or conservative results.
Another advantage of our mesh representation is that it can be integrated with state-of-the-art optimization techniques 
to ensure proven collision-free trajectory planning and control, 
which is crucial for safety-critical industrial applications.