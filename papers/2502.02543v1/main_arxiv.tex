\documentclass[11pt]{article}

\usepackage{amssymb,amsmath,amsthm,amsfonts,dsfont}

% fonts
\usepackage[T1]{fontenc}
\usepackage[tt=false, type1=true]{libertine}
\usepackage[varqu]{zi4}
\usepackage[libertine]{newtxmath}

\usepackage[margin=1in]{geometry}
% \setlength{\parindent}{5pt}
\setlength{\parskip}{2pt}

% Space saving tricks
\usepackage{enumitem}
\usepackage{mathtools}
\setlist{nosep,topsep=0pt,leftmargin=*}

% \usepackage{xspace,nicefrac,graphicx,tcolorbox,xifthen,thm-restate,tikz,hyperref}
\usepackage{hyperref}
\hypersetup{
    colorlinks,
    allcolors=myblue
}

\usepackage[sortcites,sorting=nyt,style=alphabetic]{biblatex}
\addbibresource{ref.bib}

\input{commands}

\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}
\newtheorem{lemma}{Lemma}
\newtheorem{claim}{Claim}
\newtheorem{remark}{Remark}
\newtheorem{proposition}{Proposition}
\newtheorem{assumption}{Assumption}

\newtheorem{lettereddef}{Definition}
\renewcommand{\thelettereddef}{\Alph{lettereddef}}
\newtheorem{letteredthm}{Theorem}
\renewcommand{\theletteredthm}{\Alph{letteredthm}}
\newtheorem{letteredcor}{Corollary}
\renewcommand{\theletteredcor}{\Alph{letteredcor}}
\newtheorem{letteredprop}{Proposition}
\renewcommand{\theletteredprop}{\Alph{letteredprop}}
\newtheorem{letteredlemma}{Lemma}
\renewcommand{\theletteredlemma}{\Alph{letteredlemma}}

\theoremstyle{definition}
\newtheorem{example}{Example}
\newtheorem{definition}{Definition}


\newcommand{\citet}[1]{\textcite{#1}}

\renewcommand\qedsymbol{$\blacksquare$}

\title{Posted Price Mechanisms for Online Allocation with Diseconomies of Scale}

\author{
    Hossein Nekouyan Jazi\thanks{University of Alberta. Email: \texttt{nekouyan@ualberta.ca}}\\
    \and
    Bo Sun\thanks{University of Waterloo. Email:
    \texttt{bo.sun@uwaterloo.ca}}\\
    \and 
    Raouf Boutaba\thanks{University of Waterloo. Email:
    \texttt{rboutaba@uwaterloo.ca}}\\
    \and
    Xiaoqi Tan\thanks{University of Alberta. 
    Email: \texttt{xiaoqi.tan@ualberta.ca}}
}

\date{\vspace{-25pt}}

\begin{document}

\maketitle

\begin{abstract}
This paper addresses the online $k$-selection problem with diseconomies of scale (\OSDoS), where a seller seeks to maximize social welfare by optimally pricing items for sequentially arriving buyers, accounting for increasing marginal production costs. Previous studies have investigated deterministic dynamic pricing mechanisms for such settings. However, significant challenges remain, particularly in achieving optimality with small or finite inventories and developing effective randomized posted price mechanisms. To bridge this gap, we propose a novel randomized dynamic pricing mechanism for \OSDoS, providing a tighter lower bound on the competitive ratio compared to prior work. Our approach ensures optimal performance in small inventory settings (i.e., when $k$ is small) and surpasses existing online mechanisms in large inventory settings (i.e., when $k$ is large), leading to the best-known posted price mechanism for optimizing online selection and allocation with diseconomies of scale across varying inventory sizes.
\end{abstract}


\section{Introduction}
Online resource allocation has been widely studied in recent years and finds a broad range of applications in cloud computing~\cite{Zhang2017,XZhang_2015}, network routing~\cite{cao2022online,awerbuch1993throughput,buchbinder2009online}, and various other online, market-based Internet platforms. In this problem, most existing studies assume that the seller has a finite inventory of resources before a stream of online buyers arrives, with the goal of maximizing social welfare or profit from these resources. However, in real-world applications, sellers often face diseconomies of scale in providing resources—meaning they incur increasing marginal costs for supplying each additional unit of resource.
For instance, in cloud computing systems, the power cost of servers increases superlinearly as the utilization of computing resources grows~\cite{diseconomy_cost}. Similarly, in network routing, congestion costs (e.g., end-to-end delay) increase significantly with the rise in traffic intensity brought by users.  

In this work, we study online resource allocation with increasing marginal production costs. In particular, we frame it as an online $k$-selection with diseconomies of scale (\OSDoS) in a posted price mechanism: A seller offers a certain item to buyers arriving one at a time in an online manner. Each buyer has a private valuation $v_t$ for one unit of the item. The seller can produce $k$ units of the item in total; however, the marginal cost of producing each unit increases as more units are produced. When the $t$-th buyer arrives, the seller posts a price $p_t$ to the buyer, provided that fewer than $k$ units have already been produced and allocated. If the buyer’s valuation $v_t$ exceeds $p_t$, the buyer accepts the price and takes one unit of the item. The objective is to maximize social welfare, defined as the sum of the utilities of all the buyers and the revenue of the seller.

The incorporation of increasing marginal production costs in online resource allocation was first introduced by \cite{Blum_2011} and later studied by \cite{Huang_2019} in online combinatorial auctions. Variants of \OSDoS have since been explored, including online convex packing and covering \cite{Azar_2016_convex_packing_covering_FOCS}, online knapsack with packing costs \cite{Tan_ORA_2020}, and online selection with convex costs \cite{Tan2023}. A key challenge in these problems is balancing pricing strategies. Setting prices too low early on may allocate many items to low-value buyers, increasing production costs and lowering social welfare. Conversely, overly high prices can result in missed opportunities to sell. Thus, pricing for $k$ units must carefully account for early-stage decisions to avoid rapid growth in marginal production costs while maximizing efficiency.

To address this challenge, Huang et al. \cite{Huang_2019} developed optimal \textit{deterministic dynamic pricing} mechanisms for fractional online combinatorial auctions with production costs and infinite capacity ($k = \infty$). They extended this to the integral case using fractional pricing functions, achieving a competitive ratio close to the fractional setting but with a nonzero additive loss. However, as the competitive ratio approaches the fractional lower bound, the additive loss grows unbounded, which is undesirable. To overcome this, Tan et al. \cite{Tan2023} studied online selection with convex costs and limited supply ($k < \infty$), establishing a lower bound for the integral setting without additive loss. They further showed that the competitive ratio of their deterministic posted price mechanism asymptotically converges to the lower bound as k grows large. Recently, Sun et al.~\cite{sun2024static} proposed a \textit{randomized static pricing} algorithm, which samples a static price from a pre-determined distribution for \OSDoS. This randomization improves performance over the deterministic approach in small inventory settings but is not asymptotically optimal and fails to converge to the lower bound from \cite{Tan2023} as $k \to \infty$.

Despite previous efforts, two questions remain unresolved:  First, how to derive a tight lower bound for \OSDoS in small inventory settings?
Second, it remains an open question how to develop randomized algorithms to solve \OSDoS with tight guarantees, especially for settings when $k$ is small. 

In this paper, we address these questions by deriving a new tight lower bound for the \OSDoS problem, achieving the best-known results in both small and asymptotically large inventory settings. Building on this, we propose a novel \textit{randomized dynamic pricing} algorithm that uses up to $k$ randomized prices. We show that this algorithm is optimal for small inventories and outperforms existing designs from \cite{Tan2023} and \cite{sun2024static} in large inventory settings.


\subsection{Overview of Main Results and Techniques} 
The primary contribution of this paper is the development of novel posted price mechanisms using randomized dynamic pricing schemes that extend the results in \cite{Blum_2011, Huang_2019, Tan2023, sun2024static}. The proposed scheme, \rDynamic, sequentially updates the item’s price as new units are produced and sold. Specifically, as the marginal production cost increases with each additional unit, \rDynamic utilizes a different cumulative distribution function (CDF) to independently randomize the price for each unit. The main lower bound result is as follows:

\begin{theorem}[Informal Statement of Theorem \ref{lower-bound-main-theorem}]
\label{thm:informal-lb}
Assume that buyers' valuations are bounded within the range $[L, U]$ and the cumulative cost of production up to the $i$-th unit is given by $f(i)$. The seller can produce a total of $k$ units. For any given $k \geq 1$,  $U \geq L \geq 1$, and a cumulative production cost function $f$, no online algorithm can be $(\alpha_{\mathcal{S}}^*(k) - \epsilon)$-competitive for any $ \epsilon > 0 $, where $\mathcal{S}:=\{L,U,f\}$.
\end{theorem}

We note that \cite{Tan2023} also established a lower bound for the competitive ratio of online algorithms for \OSDoS, but it was derived by connecting the integral selection problem to its fractional counterpart. This approach requires the cumulative production cost function  $f$  to be defined not only at discrete points but also for all fractional values in  $[0, k]$, leading to two issues: (i) assuming the availability of a continuous cost function  $f$  may be impractical for an inherently integral problem, and (ii) the lower bound is only tight in large inventory settings, as it assumes  $k \to \infty$. 
 
In this paper, we address these two issues by deriving the lower bound $\alpha_{\mathcal{S}}^*(k)$ via a totally different approach. In particular, we do not rely on results in the fractional setting and only need to assume that the cost function $ f(i) $ is defined at discrete points for $ i \in \{1, 2, \cdots, k\} $, leading to the tight lower bound $ \alpha_{\mathcal{S}}^*(k) $ for all $ k\geq 1$.


\begin{figure}
\centering
\includegraphics[scale = 0.45]{Figures/crcomparison.pdf}%
\caption{The blue curve (i.e., \rDynamic) corresponds to the competitive ratio of Algorithm \ref{alg:kselection-cost} that uses randomized dynamic pricing. The red curve (i.e., \dDynamic) and the yellow curve (i.e., \rStatic) correspond to the competitive ratios of the deterministic dynamic pricing mechanism developed by \cite{Tan2023} and the static randomized pricing mechanism by \cite{sun2024static}. In this figure, we set $L=1$, $U=10$, and $f(i)=\frac{i^{2}}{59}$.}
\label{figure:comparisonwithTan2023}
\end{figure}


\begin{theorem}[Informal Statement of Theorem \ref{upper-bound-large-inventory-cr}]\label{theorem:upper_bound_informal}
For any given $k \geq 1$,  $U \geq L \geq 1$, and a cumulative production cost function $f$, there exists a randomized dynamic price mechanism (\rDynamic) that achieves a competitive ratio of $ \alpha_{\mathcal{S}}^*(k)\cdot \exp(\frac{\crlb}{k}) $. In addition, when $ k =  2$, \rDynamic is $\alpha_{\mathcal{S}}^*(2)$-competitive.
\end{theorem}


Due to the arbitrary nature of the cost function  $f$, neither our work nor \cite{Tan2023} can derive a closed-form expression for the competitive ratio, preventing a direct comparison between our \rDynamic and the deterministic dynamic pricing mechanism (\dDynamic) in \cite{Tan2023}. In Figure~\ref{figure:comparisonwithTan2023}, we compare the asymptotic performance of \rDynamic with \dDynamic from \cite{Tan2023} and the randomized static pricing mechanism (\rStatic) in \cite{sun2024static}. The results show that \rDynamic significantly outperforms both \dDynamic and \rStatic, converging faster to the lower bound as  $k \to \infty$. Notably, for small $ k $, \rDynamic achieves the lower bound when $ k = 2$. Beyond its strong theoretical guarantees, empirical results (Section~\ref{sec:emprical-rdynamics}) further confirm that \rDynamic consistently outperforms both \dDynamic and \rStatic, highlighting its superiority over existing designs.


The key technical component in deriving the above lower and upper bounds is a new \textit{representative function}-based approach, which models the dynamics of any randomized online algorithm using a sequence of $k$ probability functions, $\{\psi_i\}_{i \in [k]}$. We design a family of hard instances and characterize the performance of any $\alpha$-competitive algorithm on these instances through a set of differential equations involving $\{\psi_i\}_{i \in [k]}$. To determine the lower bound $\alpha_{\mathcal{S}}^*(k)$ in Theorem \ref{thm:informal-lb}, we compute the minimum $\alpha$ for which these equations have a feasible solution, namely valid probability functions $\{\psi_i\}_{i \in [k]}$. By reverse engineering the equations, we derive inverse probability functions, $\{\phi_i\}_{i \in [k]}$, for pricing each unit, which leads to \rDynamic in Theorem \ref{theorem:upper_bound_informal}.


\subsection{Other Related Work}
Online resource allocation—the process of assigning limited resources to a sequence of online requests to maximize social welfare or profit—has been a central topic in computer science and operations research. In addition to the previously mentioned related work, readers are referred to the survey by Gupta and Singla on the secretary problem \cite{Gupta_2020_survey_ROM} for a detailed discussion of online allocation and selection in random-order models. Significant advancements have also been made in studying the prophet inequality through the lens of posted price mechanisms \cite{Lucier_2017_Survey_PI,Correa_2019_Survey_PI} and in online matching with applications to Internet advertising (e.g., \cite{Mehta2013,Huang_2024_Survey}). Beyond the stochastic i.i.d. model in the prophet inequality, recent work explores the correlated arrival model based on a Markov chain~\cite{jia2023online}. However, these studies focus on variants of online allocation and selection without considering production costs. In contrast, our work primarily examines the impact of increasing marginal production costs on online $k$-selection.

Recent years have seen efforts to study online allocation problems with various forms of production costs in stochastic settings (e.g., \cite{Blum_2015_WINE}, \cite{Gupta_2018_ICALP}, \cite{Barman_2012_secretary_with_costs_ICALP}, \cite{Sekar_2016_IJCAI}). For instance, \cite{Blum_2015_WINE} examined online allocation with economies of scale (decreasing marginal costs), proposing a constant-competitive strategy for unit-demand customers with valuations sampled i.i.d. from an unknown distribution. In contrast, \cite{Sekar_2016_IJCAI} addressed Bayesian online allocation with convex production costs (diseconomies of scale), developing posted price mechanisms with  $O(1)$-approximation for fractionally subadditive buyers and logarithmic approximations for subadditive buyers. Our study differs by focusing on \OSDoS in adversarial settings, assuming no knowledge of the arrival sequence beyond the finite support of valuations, making these results not directly comparable to ours.

On the applied side, allocating limited resources under diseconomies of scale is common across various online platforms. For example, in online cloud resource allocation \cite{XZhang_2015}, convex server costs model energy consumption based on CPU utilization, while in online electric vehicle charging \cite{bo2018}, electricity generation costs are often modeled as nonlinear, typically quadratic.



\section{Problem Statement and Assumptions}
\label{section_OSCC_statement}
We formally define online $k$-selection with diseconomies of scale (\OSDoS) as follows. Consider an online market operating under posted price mechanisms. On the supply side, a seller can produce a total of $k$ units of an item, with increasing (or at least non-decreasing) marginal production costs.  Let $\boldsymbol{c} := \{c_i\}_{\forall i\in[k]}$ represent the \textit{marginal production cost}, where $c_i$ denotes the cost of producing the $i$-th unit, and $c_1 \leq c_2 \leq \dots \leq c_k $. Define $f(i) = \sum_{j=1}^i c_{j}$ as the \textit{cumulative production cost} of the first $i$ units. On the demand side, $T$ buyers arrive sequentially, each demanding one unit of the item. Let $v_t$ denote the private valuation of the $t$-th buyer. Once buyer $t$ arrives, a price $p_t$ is posted, and then the buyer decides to accept the price and make a purchase if a non-negative utility is gained $v_t - p_t \ge 0$, and reject it otherwise. 

Let $x_t \in \{0,1\}$ represent the decision of buyer $t$, where $x_t = 1$ indicates a purchase and $x_t = 0$ otherwise. Then buyer $t$ obtains a utility $(v_t - p_t)x_t $ and the seller collects a total revenue of $\sum_{t \in [T]} p_t x_t - f(\sum_{t \in [T]} x_t)$ from all buyers. The goal of the online market is to determine the posted prices $\{p_t\}_{\forall t\in[T]}$ to maximize the social welfare, which is the sum of utilities of all the buyers and the revenue of the producer, i.e., $\sum_{t \in [T]}x_t \cdot (v_t - p_t) + \sum_{t \in [T]} x_t \cdot p_t - f(\sum_{t \in [T]} x_t)= \sum_{t \in [T]}  v_t x_t - f(\sum_{t \in [T]} x_t)$.

Let $ \mathcal{I} = \{v_1, \cdots, v_T\} $ denote an arrival instance of buyers. An optimal offline algorithm that knows all the information of $ \mathcal{I} $ can obtain the optimal social welfare $\OPT(\mathcal{I})$ by solving the following optimization problem
\begin{align*}
\OPT(\mathcal{I}) = \max_{x_t\in\{0,1\}} \sum\nolimits_{t\in[T]} v_t x_t  - f\left(\sum\nolimits_{t\in[T]}x_{t}\right),  \qquad \text{s.t. } \sum\nolimits_{t\in[T]} x_{t} \leq k.
\end{align*} 
However, in the online market, the posted price $p_t$ is determined without knowing the valuations of future buyers $\{v_\tau\}_{\tau > t}$. We aim to design an online mechanism to determine the posted prices such that the social welfare achieved by the online mechanism, denoted by $\ALG(\mathcal{I})$, is competitive compared to $\OPT(\mathcal{I})$. Specifically, an online algorithm is $\alpha $-competitive if for any input instance $ \mathcal{I} $, the following inequality holds:
%\vspace{-0.1cm}
	\begin{align*}
		\alpha \ge  \frac{\OPT(\mathcal{I})}{\mathbb{E}[\ALG(\mathcal{I})]},
	\end{align*}
where the expectation of $\mathbb{E}[\ALG(\mathcal{I})]$ is taken with respect to the randomness of the online algorithm. To attain a bounded competitive ratio, we consider a constrained adversary model~\cite{online_selection_constrained_adversary_ICML_2021,Tan2023}, where the buyers' valuations are assumed to be bounded.
\begin{assumption}
Buyers' valuations are bounded in $[L,U]$, i.e., $v_t \in [L,U], \forall t\in[T]$.
\end{assumption}
The interval $[L,U]$ can be considered as the prediction interval that covers the valuations of all buyers~\cite{online_selection_constrained_adversary_ICML_2021}, and is known to the online algorithm.  As shown in \cite{Tan2023}, the competitive analysis of online algorithms for \OSDoS depends on the relationship between buyers' valuations and the production cost function. For simplicity, we focus on the case where the production cost is always smaller than the buyer’s valuation ($c_k < L$) and derive lower and upper bounds in Sections~\ref{section_threshold_policies} and \ref{sec:upper-bound}, respectively. In Appendices \ref{appendix-lower-bound-extension-general-cost-function} and \ref{appendix:upper-bound-general-cost-function}, we show that this assumption is without loss of generality, as our results extend naturally to the general case.



\section{Lower Bound for \OSDoS: Hardness of Allocation with Diseconomies of Scale}
\label{section_threshold_policies}

We first derive a tight lower bound for \OSDoS, which informs the design of \rDynamic (Algorithm \ref{alg:kselection-cost}) in Section \ref{sec:upper-bound}.


\subsection{Lower Bound $\alpha_{\mathcal{S}}^*(k)$}
Theorem \ref{lower-bound-main-theorem} below formally states the lower bound $\alpha_{\mathcal{S}}^*(k)$ for the competitive ratio of any online algorithm  for \OSDoS.
\begin{theorem}[Lower Bound]
\label{lower-bound-main-theorem}
Given $\mathcal{S} = \{L, U, f\} $ for the \OSDoS problem with $k \ge 1$, no online algorithm, including those with randomization, can achieve a competitive ratio smaller than $\crlb$, where $\crlb$ is the solution to the following equation of $\alpha$:
\begin{align}
\label{eq:lower-bound-alpha-star-equation}
U = \left(L-c_{\ubar{k}}\right) \cdot e^{\frac{\alpha}{k} \cdot (k+1-\ubar{k} -\xi )} + c_{\ubar{k}} \cdot e^{\frac{\alpha}{k} \cdot (k-\ubar{k})} + c_{\ubar{k}+1} \cdot \left(1-e^{\frac{\alpha}{k}}\right) \cdot e^{\frac{\alpha}{k} \cdot (k-1-\ubar{k})} + \cdots + c_{k} \cdot \left( 1- e^{\frac{\alpha}{k}}\right).  
\end{align}
In Eq. \eqref{eq:lower-bound-alpha-star-equation}, $ \ubar{k} \in [k] $ denotes the smallest natural number such that 
\begin{align}\label{eq:def-h}
    \sum\nolimits_{i=1}^{\ubar{k}} (L-c_{i}) \ge \frac{1}{\alpha} \cdot \Big(k L - \sum\nolimits_{i=1}^{k} c_{i}\Big),
\end{align}
and $ \xi \in (0,1] $ denotes the unique solution to the following equation 
\begin{align}\label{eq:def-u}
\xi = \frac{\frac{1}{\alpha}\cdot(k L - \sum_{i=1}^{k}c_{i})-\sum_{i=1}^{\ubar{k}-1} (L-c_{i})}{L - c_{\ubar{k}}}.
\end{align}
\end{theorem}

Theorem \ref{lower-bound-main-theorem} is our main result concerning the hardness of \OSDoS. To prove Theorem~\ref{lower-bound-main-theorem}, a key step is to establish a set of necessary conditions that any $\alpha$-competitive online algorithm must satisfy. A formal proof will be provided in Section \ref{sec:proof_of_theorem_lower_bound}. Below, we offer several remarks to clarify the key intuitions. 
\begin{itemize}[leftmargin=*]
    \item By the definition of $\ubar{k}$ in Eq. \eqref{eq:def-h}, $\ubar{k}$ represents the minimum number of units that any $\alpha$-competitive deterministic algorithm, denoted by $ \ALG_{\textsf{d}} $, must sell when faced with an arrival instance of $k$ identical buyers with valuation $L$, denoted by $\mathcal{I}_{iden}^{(L)} = \{L, \cdots, L\}$. Under the instance $\mathcal{I}_{iden}^{(L)}$, the maximum social welfare achievable by the offline optimal algorithm is $kL - \sum_{i=1}^{k} c_{i}$. Therefore, $ \ALG_{\textsf{d}} $ must sell at least $\ubar{k}$ units to ensure $\alpha$-competitiveness, implying that $\ubar{k}$ is well-defined for all values of $\alpha \geq 1 $.

    \item Eq. \eqref{eq:def-u} demonstrates that $\xi$ is defined as the fraction of the $\ubar{k}$-th unit required to make Eq. \eqref{eq:def-h} binding. We argue that $\xi \in (0, 1]$ is well-defined and always exists as long as there is an $\alpha$-competitive randomized algorithm, denoted as $ \ALG_{\textsf{r}} $. Specifically, if a randomized algorithm $ \ALG_{\textsf{r}} $ is run on the same instance $\mathcal{I}_{iden}^{(L)}$, $ \ALG_{\textsf{r}} $ must sell at least $\ubar{k} - 1$ units plus a fraction $\xi$ of the $\ubar{k}$-th unit of the item, in expectation. 

    \item Note that, in general, a closed-form expression for the lower bound $\alpha_{\mathcal{S}}^*(k)$ cannot be derived. This is expected due to the arbitrary nature of the sequence of marginal production costs. However, because of the monotonicity of $\ubar{k}$, $\xi$, and the right-hand side of Eq. \eqref{eq:lower-bound-alpha-star-equation} with respect to $\alpha$, $\alpha_{\mathcal{S}}^*(k)$ can be easily computed by solving Eq. \eqref{eq:lower-bound-alpha-star-equation} numerically using binary search.
\end{itemize}

In the next subsection, we construct a family of hard instances and introduce a novel representative function-based approach to derive a system of differential equations, which are crucial to proving the lower bound result in Theorem \ref{lower-bound-main-theorem}.


\subsection{Representing Worst-Case Performance by (Probabilistic) Allocation Functions} 
\label{sec:nec-cond}

\subsubsection{\bfseries Hard Instances $ \{\mathcal{I}_{v}^{(\epsilon)} \}_{\forall v\in [L, U]}$}
We introduce a family of hard instances based on the instance $\mathcal{I}^{(\epsilon)}$ defined as follows.

\begin{definition}[Instance $\mathcal{I}^{(\epsilon)}$]\label{def:hard_instance}
For any given value of $\epsilon > 0$, the instance $\mathcal{I}^{(\epsilon)}$ begins with $k$ identical buyers, each having a valuation of $L$ during the initial stage. This is followed by a series of stages, each consisting of $k$ identical buyers, with valuations incrementally increasing by $\epsilon$, starting from $L + \epsilon$ and reaching the upper bound $L + \left\lfloor \frac{U-L}{\epsilon} \right\rfloor \cdot \epsilon$. The instance $\mathcal{I}^{(\epsilon)}$ is mathematically defined as:
\begin{align*}
\Bigg\{\underbrace{L,\dots,L}_{k \text{ buyers}}, & \underbrace{L + \epsilon, \dots, L + \epsilon}_{k \text{ buyers}}, \dots,  \underbrace{L + j\cdot \epsilon, \dots, L + j\cdot \epsilon}_{k \text{ buyers in stage } L + j\cdot \epsilon}, \dots,\underbrace{ L + \left\lfloor \frac{U-L}{\epsilon} \right\rfloor \cdot \epsilon, \dots,  L + \left\lfloor \frac{U-L}{\epsilon} \right\rfloor \cdot \epsilon}_{k \text{ buyers}}\Bigg\},
\end{align*}
where $j$ ranges from 1 to $\left\lfloor (U-L)/\epsilon \right\rfloor$. Furthmore, let us define the set $V^{(\epsilon)} = \{L, L + \epsilon, \dots, L + \left\lfloor (U-L)/\epsilon \right\rfloor \cdot \epsilon\}$ to contain all the possible valuations that buyers in the instance $\mathcal{I}^{(\epsilon)}$ may possess.
\end{definition}

We refer to the $k$ buyers with valuation $v \in V^{(\epsilon)}$ as \textit{stage-$v$} arrivals in $\mathcal{I}^{(\epsilon)}$.
For any $v \in V^{(\epsilon)}$, let $\mathcal{I}_{v}^{(\epsilon)}$ denote all the buyers in $\mathcal{I}^{(\epsilon)}$ from the beginning up to \textit{stage-$v$}. For instance, if $v = L + 2\epsilon$, then $\mathcal{I}_{v}^{(\epsilon)}$ includes the first $3k$ buyers in $\mathcal{I}^{(\epsilon)}$ with valuations $L$, $L + \epsilon$, and $L + 2\epsilon$. Due to the online nature of the problem, we emphasize that $\mathcal{I}^{(\epsilon)}$ may terminate at any stage $v$. In other words, there exists a family of hard instances, $\{\mathcal{I}_{v}^{(\epsilon)}\}_{\forall v \in V^{(\epsilon)}}$, induced by $\mathcal{I}^{(\epsilon)}$. Here, $\mathcal{I}_{v}^{(\epsilon)}$ denotes the arrival instance of $\mathcal{I}^{(\epsilon)}$ that terminates at stage-$v$. Henceforth, we will use ``\textit{instance $\mathcal{I}_{v}^{(\epsilon)}$}" and ``\textit{instance $\mathcal{I}^{(\epsilon)}$ by the end of stage-$v$}" interchangeably.


Given any $\alpha$-competitive algorithm \ALG, an arbitrary instance from $\{\mathcal{I}_{v}^{(\epsilon)}\}_{\forall v \in V^{(\epsilon)}}$ may be the one that \ALG processes. Thus, for any $v \in V^{(\epsilon)}$, by the end of stage-$v$ of $\mathcal{I}^{(\epsilon)}$, \ALG must achieve at least a $1/\alpha$ fraction of the optimal social welfare, $k v - \sum\nolimits_{i=1}^k c_i$, which is attained by rejecting all previous buyers except for the last $k$ buyers with valuation $v$. Consequently, an $\alpha$-competitive algorithm must ensure
\begin{align} \label{lower-bound-system-kselection-cost}
\ALG\left(\mathcal{I}_{v}^{(\epsilon)}\right)  \ge \frac{1}{\alpha} \cdot \left(k v - \sum\nolimits_{i=1}^k c_{i}\right), \quad \forall v \in V^{(\epsilon)},
\end{align}
where $ \ALG(\mathcal{I}_{v}^{(\epsilon)}) $ denotes the \textit{expected} performance of \ALG under the instance $ \mathcal{I}_{v}^{(\epsilon)} $.


\subsubsection{\bfseries Representing $ \ALG(\mathcal{I}_{v}^{(\epsilon)}) $ by Allocation Functions} 
For any randomized algorithm, we define $k+1$ states, $ \{q_i\}_{\forall i \in {\{0, \cdots, k\}}} $, which represent the allocation behavior of the online algorithm at any stage of instance $\mathcal{I}^{(\epsilon)}$, as follows:
\begin{itemize}[leftmargin=*]
    \item State $q_{0}$ corresponds to the situation where the online algorithm has not allocated any units.
    \item For all $ i \in [k]$, state $q_i$ represents that the online algorithm has allocated \textit{at least} $i$ units of the item.
\end{itemize}

For all $v \in V^{(\epsilon)}$ and $i \in \{0, \cdots, k\}$, we define $\Psi_i(v): V^{(\epsilon)} \rightarrow \{0, 1\}$ such that $\Psi_i(v) = 1$ if the algorithm is in state $q_i$ after processing all the buyers in $\mathcal{I}_v^{(\epsilon)}$, and $\Psi_i(v) = 0$ otherwise. Specifically, $\Psi_i(v) = 1$ if the online algorithm allocates at least $i$ units of the item at the end of stage $v$ in $\mathcal{I}^{(\epsilon)}$, which occurs with some probability depending on the algorithm’s randomness. Since the instance $\mathcal{I}^{(\epsilon)}$ is deterministically defined, $\Psi_i(v)$ is a binary random variable whose distribution depends solely on the algorithm’s randomness. This leads to the definition of $\boldsymbol{\psi} = \{\psi_i\}_{\forall i \in [k]}$ below.

\begin{definition}[Allocation Functions]
For any randomized online algorithm, let $ \boldsymbol{\psi} = \{\psi_i\}_{\forall i\in [k]}$ and $\psi_i:V^{(\epsilon)}\rightarrow [0,1]$ represent the functions where $\psi_{i}(v) = \mathbb{E}[\Psi_i(v)] $, with the expectation taken over the randomness of the algorithm.
\end{definition}

Based on the definition above, we have $\psi_{i}(v) = \Pr( \Psi_i(v) = 1)$, where $\Psi_i(v) = 1$ indicates that the algorithm is in state $q_i$ (i.e., at least $i$ units of the item have been allocated) after processing all buyers in $\mathcal{I}_v^{(\epsilon)}$ (i.e., by the end of stage $v$ of instance $\mathcal{I}^{(\epsilon)}$). In this context, $\psi_{i}(v)$ represents the probability that the online algorithm has allocated at least $i$ units of the item by the end of stage $v$ in instance $\mathcal{I}^{(\epsilon)}$. Therefore, the term \textit{probabilistic allocation functions} is used or simply \textit{allocation functions} for brevity. We show that $\psi_i(v)$ is monotonic in $i\in[k]$.


\begin{lemma}[Monotonicity]\label{lem:continuity_of_psi}
For any randomized online algorithm, $ \psi_{i}(v) \geq \psi_{i+1}(v) $ holds for all $  i\in [k] $ and $ v\in [L, U]$.
\end{lemma}

The proof of the above lemma is given in Appendix \ref{apx:lemma-continuitiy}. 
Lemma \ref{lem:continuity_of_psi} implies that it suffices to focus on randomized algorithms whose allocation functions are from the following set
\begin{align*} 
\Omega = \Big\{ \boldsymbol{\psi} \big |  & \psi_{i}(v) \in [0,1], \psi_{i}(v) \ge \psi_{i+1}(v),  \psi_{i}(v) \leq \psi_{i}(v'),  \forall i\in [k], v, v'\in V^{(\epsilon)}, \text{ and } v < v' \Big\}.
\end{align*}


Next, we analyze how the allocation level of an $\alpha$-competitive algorithm should evolve as new buyers with higher valuations arrive in $\mathcal{I}^{(\epsilon)}$. We argue that the expected performance of any online algorithm under the instance $\mathcal{I}^{(\epsilon)}$ can be fully represented by the $k$ allocation functions $\{{\psi_{i}(v)}\}_{\forall i \in [k]}$. Let $ \ALG(\mathcal{I}_{v}^{(\epsilon)}) $ denote the expected objective value of the algorithm under instance $ \mathcal{I}_v^{(\epsilon)} $. Then $ \ALG(\mathcal{I}_{v}^{(\epsilon)}) $ can be framed using $ \boldsymbol{\psi} = \{{\psi_{i}(v)}\}_{\forall i \in [k]}$ as follows. 

\begin{proposition}[Representation based on $ \boldsymbol{\psi}$]
\label{lemma:lower-bound-algorithm-performance} 
For any randomized algorithm \ALG under the family of hard instances $ \{\mathcal{I}_{v}^{(\epsilon)} \}_{\forall v\in V^{(\epsilon)}}$, its expected performance can be represented by its allocation functions $\{{\psi_{i}(v)}\}_{\forall i \in [k]} \in \Omega $ as follows:
\begin{align*}
& \ALG\left(\mathcal{I}_{L}^{(\epsilon)}\right) = \sum_{i=1}^{k} \psi_i^{(L)} \cdot (L - c_i), \\
& \ALG\left(\mathcal{I}_{L+ j\cdot \epsilon}^{(\epsilon)}\right) = \ALG\left(\mathcal{I}_{L}^{(\epsilon)}\right) + \sum_{i=1}^{k} \sum_{m=1}^{\left\lceil \frac{U - L}{\epsilon} \right\rceil} \Big[ (L + m \cdot \epsilon) \cdot  \Big(\psi_i(L + m \cdot \epsilon) - \psi_i(L + (m-1) \cdot \epsilon)\Big) \Big], \\
&\hspace{12cm}\forall j = 1, 2, \ldots, \big\lfloor \frac{U - L}{\epsilon} \big\rfloor.
\end{align*}
\end{proposition}
The above proposition relates the expected performance of an online algorithm to the set of allocation functions $\{{\psi_{i}(v)}\}_{\forall i \in [k]}$ that capture its dynamics under hard instances  $ \{\mathcal{I}_{v}^{(\epsilon)} \}_{\forall v\in V^{(\epsilon)}}$. The detailed proof can be found in Appendix \ref{appendix:lemma:proof-lower-bound-algorithm-performance}.

Combining Proposition \ref{lemma:lower-bound-algorithm-performance} and Eq. \eqref{lower-bound-system-kselection-cost} gives the lemma below.
\begin{lemma}[Necessary Conditions]
\label{lemma:nec-cond}
If there exists an $\alpha$-competitive algorithm for \emph{OSDoS}, then there exists $k$ allocation functions $\{\psi_i\}_{i\in[k]} \in \Omega$, where each function $\psi_i: [L,U] \rightarrow [0,1]$ is continuous within its range and also satisfies the following equation:
\begin{align}
    \sum_{i=1}^{k} \psi_i(L) \cdot (L - c_i) + \sum_{i=1}^{k} \int_{\eta = L}^{v} (\eta - c_i) d\psi_i(\eta)  \ge \frac{1}{\alpha} \cdot \left(k v - \sum_{i=1}^k c_i \right), \quad \forall  v \in [L,U]. \label{eq:lb-system-ineq}
\end{align}
\end{lemma}
The above result is derived based on the family of instances $ \{\mathcal{I}_{v}^{(\epsilon)} \}_{\forall v\in V^{(\epsilon)}}$ when $\epsilon$ approaches to zero. 
The proof is given in Appendix~\ref{apx:lb-system-ode}.
The lemma above provides a set of necessary conditions for the allocation functions $\{\psi_i\}_{\forall i\in[k]}$ induced by any $\alpha$-competitive algorithm. Therefore, determining a tight lower bound for \OSDoS is equivalent to finding the lowest $\alpha$ such that there exists a set of allocation functions in $ \Omega $ that satisfy Eq. \eqref{eq:lb-system-ineq}.
\subsection{Proof of Theorem \ref{lower-bound-main-theorem}}
\label{sec:proof_of_theorem_lower_bound}
We now move on to prove Theorem \ref{lower-bound-main-theorem}. Based on the necessary conditions in Lemma \ref{lemma:nec-cond}, the lower bound can be defined as
\begin{align*} 
\alpha_{\mathcal{S}}^*(k) = \inf \Big\{ &  \alpha \ge 1 \big | \text{there exist a set of } k \text{ allocation}\ \text{functions } {\{\psi_{i}(v)\}}_{\forall i \in [k]}  \in \Omega \text{ that satisfy Eq. \eqref{eq:lb-system-ineq}} \Big \}.
\end{align*}
Next, we show that it is possible to find a tight design of $\{\psi_{i}\}_{\forall i \in [k]}$ that satisfies the necessary conditions in Eq. \eqref{eq:lb-system-ineq} by equality, ultimately leading to Eq. \eqref{eq:lower-bound-alpha-star-equation} in Theorem \ref{lower-bound-main-theorem}.

For any $ \alpha \ge \alpha_{\mathcal{S}}^*(k) $, let $\Gamma^{(\alpha)}$ denote the superset of the set of functions ${\{\psi_{i}\}}_{\forall i \in [k] } \in \Omega$ that satisfy Eq. \eqref{eq:lb-system-ineq}. Note that $\Gamma^{(\alpha)} \subset \Omega $ holds for all $ \alpha \geq  \alpha_{\mathcal{S}}^*(k)$. Define $\chi^{(\alpha)}(v):[L,U] \rightarrow [0,k] $ as
 \begin{align} 
 \label{lower-bound-proof-define-chi-function}
   \chi^{(\alpha)}(v) =   \inf \left\{\sum\nolimits_{i=1}^{k} \psi_{i}(v) \big | \ \{\psi_{i}(v)\}_{\forall i \in [k]} \in \Gamma^{(\alpha)} \right\}.
 \end{align} 
Based on the definition of $\chi^{(\alpha)} $, we construct a set of allocation functions ${\{\psi^{(\alpha)}_{i}(v)\}}_{\forall i \in [k]}$ as follows:
\begin{align}
\label{lower-bound-optimal-functions-design}
    \psi^{(\alpha)}_{i}(v) = \left( \chi^{(\alpha)}(v) - (i-1)\right) \cdot \mathds{1}_{\{i-1 \leq   \chi^{(\alpha)}(v) \leq i\}} + \mathds{1}_{\{ \chi^{(\alpha)}(v) > i\}},  
    \forall v\in [L,U], \quad \forall i \in [k],
\end{align}
where $ \mathds{1}_{\{A\}} $ is the standard indicator function, equal to 1 if $ A $ is true and 0 otherwise.  In the following lemma, we argue that the set of functions ${\{\psi^{(\alpha)}_{i}(v)\}}_{\forall i \in [k]}$ is a feasible solution to Eq. \eqref{eq:lb-system-ineq} and satisfies it as an equality. 
\begin{lemma}\label{lemma:lb:tightness}
    For any $\alpha \ge \alpha_{\mathcal{S}}^*(k) $, the functions ${\{\psi^{(\alpha)}_{i}\}}_{\forall i \in [k]}$ satisfy Eq. \eqref{eq:lb-system-ineq} as an equality. 
\end{lemma}
% \notebo{what is $\phi^*_i$ in the propo?}
The detailed proof for the above lemma is in Appendix \ref{appendix:lemma:lb:tightness}. Following the definition of ${\{\psi^{(\alpha)}_{i}(v)\}}_{\forall i \in [k]}$, we observe that these functions exhibit the following property:
\begin{lemma}
\label{property-1}
For any $i \in [k]$ and $v \in [L, U]$, if $ \psi^{(\alpha)}_{i}(v) \in (0, 1) $ holds, then $\psi^{(\alpha)}_{j}(v) = 1 $ for all $ j = 1, \cdots,  i - 1 $ and $\psi^{(\alpha)}_{j}(v) = 0$ for all $ j =  i+1, \cdots, k$.
\end{lemma}

Lemma \ref{property-1} asserts that if the online algorithm inducing $\{\psi^{(\alpha)}\}_{\forall i}$ begins allocating unit $i$ with some positive probability to buyers in stage-$v$ of $\mathcal{I}^{(\epsilon)}$, then the algorithm must have already allocated all units $j < i$ with probability one to buyers arriving at or before stage-$v$ of $\mathcal{I}^{(\epsilon)}$. Furthermore, if the algorithm has not allocated unit $i$ with probability one by the end of stage-$v$, then all units $j > i$ remain in the system with probability one at the end of stage-$v$. Given that the marginal cost for each additional unit of resource increases, the algorithm should only produce and allocate a new unit once all previously produced units have been fully allocated.

According to Lemma \ref{lemma:lb:tightness}, the inequality in Eq. \eqref{eq:lb-system-ineq} can be replaced with an equality. By combining Lemma \ref{lemma:lb:tightness} with Lemma \ref{property-1}, we conclude that there exists a unique set of functions that satisfy Eq. \eqref{eq:lb-system-ineq} as an equality and also fulfill the property stated in Lemma \ref{property-1}. Proposition \ref{prop:lower-bound-psi-star-design} below formally states this result.

\begin{proposition}
\label{prop:lower-bound-psi-star-design}
For any $\alpha \ge \alpha_{\mathcal{S}}^*(k) $, there exist a set of allocation functions ${\{\psi^{(\alpha)}_{i}\}}_{\forall i \in [k]} \in \Omega$ that satisfy Eq. \eqref{eq:lb-system-ineq} by equality:
\begin{align*}
    &\psi^{(\alpha)}_{i}(v) = 1, \quad    i = 1, \dots, \ubar{k}-1, \\
    &\psi^{(\alpha)}_{\ubar{k}}(v) =
    \begin{cases}
         \xi + \frac{k}{\alpha} \cdot \ln\left(\frac{v - c_{\ubar{k}}}{L - c_{\ubar{k}}}\right) &  v \in [L,u_{\ubar{k}}], \\
         1 & v > u_{\ubar{k}}, 
         \end{cases}\\
    & \psi^{(\alpha)}_{i}(v) = \begin{cases} 0 & v \leq \ell_{i}, \\
        \frac{k}{\alpha} \cdot \ln\left(\frac{v - c_{i}}{\ell_{i} - c_{i}}\right) &  v \in [\ell_{i},u_{i}], \\
        1 & v \ge u_{i},
        \end{cases} \quad  i = \ubar{k}+1,\dots, k-1, \\
    &    \psi^{(\alpha)}_{k}(v) = \begin{cases} 0 & v \leq \ell_{k}, \\
        \frac{k}{\alpha} \cdot \ln\left(\frac{v - c_{k}}{\ell_{k} - c_{k}}\right) &  v \in [\ell_{k},U],
        \end{cases} 
\end{align*}
where the intervals $ \{[\ell_i, u_i ]\}_{\forall i} $ are specified by
\begin{align}
    \label{lower-bound-U-h-computation}
    & u_{\ubar{k}} = \ell_{\ubar{k}+1} = (L-c_{\ubar{k}})\cdot e^{(1-\xi) \cdot \frac{\alpha}{k}} + c_{\ubar{k}},
     \\
     \label{lower-bound-other-U-computation}
    &  u_{i} = \ell_{i+1} = (\ell_{i} - c_{i}) \cdot e^{\alpha/k} + c_{i} \quad \forall i = \ubar{k}+1, \dots, k.
\end{align}    
\end{proposition}

Recall that the parameters $\ubar{k}$ and $\xi$ are defined in Eq.~\eqref{eq:def-h} and Eq.~\eqref{eq:def-u}, respectively. Once $ \alpha $ is given, both  $\ubar{k}$ and $\xi$  can be uniquely determined. Therefore, the set of allocation functions ${\{\psi^{(\alpha)}_{i}\}}_{\forall i \in [k]}  $ given in Proposition \ref{prop:lower-bound-psi-star-design} can also be explicitly computed once $\alpha $ is given. The full proof of how to derive the explicit designs of ${\{\psi^{(\alpha)}_{i}\}}_{\forall i \in [k]}$ is given in Appendix \ref{appendix:lower-bound-proof-lemma-function-design-psi-star}. 

Putting together Eq. \eqref{lower-bound-U-h-computation} and Eq. \eqref{lower-bound-other-U-computation}, we have
\begin{align*}
    u_{k} = (L-c_{\ubar{k}}) \cdot e^{\frac{\alpha}{k} \cdot (k+1-\ubar{k} -\xi)} + c_{\ubar{k}} \cdot e^{\frac{\alpha}{k} \cdot (k-\ubar{k})} + c_{\ubar{k}+1} \cdot (1-e^{\frac{\alpha}{k}}) \cdot e^{\frac{\alpha}{k} \cdot (k-1-\ubar{k})} + \cdots + c_{k} \cdot ( 1- e^{\frac{\alpha}{k}}).
\end{align*}
Note that the right-hand side of the equation above is increasing in $\alpha$. Therefore, as $\alpha$ decreases, the value of $u_{k}$ also decreases and will eventually fall below $U$ for a specific value of $\alpha$. Consequently, according to the definition of $\psi^{(\alpha)}_{k}$ in Proposition \ref{prop:lower-bound-psi-star-design}, $\psi^{(\alpha)}_{k}(U)$ will exceed $1$ (since $\psi^{(\alpha)}_{k}(U) > \psi^{(\alpha)}_{k}(u_{k})$, and based on Eq.~\eqref{lower-bound-other-U-computation}, $\psi^{(\alpha)}_{k}(u_{k})$ is equal to one).  However, this will generate an infeasible allocation function $\psi_{k}^{(\alpha)}$, as  we require that $\psi_{k}^{(\alpha)}(v) \leq 1$ holds for all $v \in [L,U]$. As a result, for those values of $\alpha$ where $u_{k} < U$, the set of $k$ allocation functions $\{\psi^{(\alpha)}_{i}\}_{\forall i \in [k]}$ obtained in Proposition \ref{prop:lower-bound-psi-star-design} becomes infeasible, meaning that $\alpha$ must be less than $ \alpha_{\mathcal{S}}^*(k) $. Therefore, $\alpha_{\mathcal{S}}^*(k)$ is the value of $\alpha$ for which $u_{k} = U$, and this gives Eq.~\eqref{eq:lower-bound-alpha-star-equation} in Theorem \ref{lower-bound-main-theorem}. 
Thus, we complete the proof of Theorem \ref{lower-bound-main-theorem}.


\section{\rDynamic: A Randomized Dynamic Posted Price Mechanisms}
\label{sec:upper-bound}
We propose a randomized dynamic pricing mechanism (\rDynamic), as described in Algorithm~\ref{alg:kselection-cost}, to solve the \OSDoS problem. Before the buyers arrive, \rDynamic samples $k$ independent random prices $\{P_i\}_{\forall i\in[k]}$, where $P_i$ is the price for the $i$-th unit of the item. Specifically, for each unit $i \in [k]$, a random seed $s_i$ is drawn from the uniform distribution $\text{Unif}(0,1)$, and the random price is set as $P_i = \phi_i(s_i)$, where $\phi_i(s_i)$ is the \textit{pricing function} designed for the $i$-th unit. \rDynamic then posts the price of the available unit with the smallest index from $\{P_i\}_{\forall i\in[k]}$ to the online arriving buyers.

For all $i \in [k]$, the pricing function $\phi_i: [0,1] \rightarrow [L_i, U_i]$ is constructed such that the $k$ \textit{price intervals} $\{[L_i, U_i]\}_{\forall i\in[k]}$ span the entire range of $[L, U]$, where $L = L_1 \leq U_1 = L_2 \leq U_2 \leq \cdots \leq U_{k-1} = L_k \leq U_k = U$. That is, the upper boundary of $\phi_i$ (i.e., the maximum price of $P_i$) is the lower boundary of $\phi_{i+1}$ (i.e., the minimum price of $P_{i+1}$). As a result, the posted prices will always be non-decreasing (i.e., $P_1 \leq P_2 \leq \cdots \leq P_k$), regardless of the realization of the random seeds $\{s_i\}_{\forall i\in[k]}$. This design ensures that units with higher production costs are sold at higher prices, which is consistent with the natural pricing scheme where more expensive units reflect higher production costs.


\begin{algorithm}[t]
\caption{Randomized Dynamic Pricing (\rDynamic) for \OSDoS} 
\label{alg:kselection-cost}
\begin{algorithmic}[1] 
\State \textbf{Input:} pricing functions ${\{\phi_i\}}_{\forall i \in [k]}$;
\State \textbf{Initiate:} index of the unit to be sold $\kappa_1 = 1$; %$x_t = 0$ for all $ t $. 
\State Generate a random seed vector $\boldsymbol{s} = \{s_i\}_{\forall i \in [k]}$, each element sampled independently from uniform distribution $\text{Unif}(0,1)$; \label{line_P_vector}
\State{Set a price vector $\mathbf{P}= \{P_i\}_{\forall i \in [k]}$, where $P_{i} = \phi_{i}(s_{i})$};
\While{buyer $t$ arrives}
	\If{$\kappa_t \leq k$}:
		\State Post the price $p_t = P_{\kappa_t} $ to buyer $t$;
		\If{buyer $t$ accepts the price}
			\State One unit is sold and set $x_t = 1$; 
		\EndIf
	\EndIf
		\State Update $ \kappa_{t+1} = \kappa_t + x_t$. \Comment{{\color{gray}$ x_t = 0 $ if buyer $ t $ declines $ p_t $.}}
\EndWhile
\end{algorithmic}
\end{algorithm}


\subsection{Asymptotic Optimality of \rDynamic}
%\vspace{-0.2cm}
% Next, in below theorem, we give the design of the CDF functions that the randomized dynamic pricing scheme in the above algorithm uses to
We show that by carefully designing the pricing functions, \rDynamic
achieves an asymptotically optimal competitive ratio.
\begin{theorem} 
    \label{upper-bound-large-inventory-cr}
    Given $\mathcal{S} = \{L, U, f\} $ for the \OSDoS problem with $k \ge 1$, \rDynamic is $\alpha_{\mathcal{S}}^*(k)\cdot \exp(\frac{\alpha_{\mathcal{S}}^*(k)}{k})$-competitive when the pricing functions are given by
    \begin{align*}
       & \phi_{i}(s) = L, \quad \forall s \in [0,1], i \in [\ubar{k}^*-1],\\
       & \phi_{\ubar{k}^*}(s)  = \begin{cases} L & s \in [0, \xi^{*}], \\
        (L-c_{\ubar{k}^*})\cdot e^{(s- \xi^{*})\cdot {\alpha_{\mathcal{S}}^*(k)}/{k}}+c_{\ubar{k}^*} & s \in [\xi^{*},1],
        \end{cases}\\
        & \phi_{i}(s)  = (L_{i}-c_{i})\cdot e^{s \cdot {\alpha_{\mathcal{S}}^*(k)}/{k}}+c_{i},  \quad \forall s \in [0,1], i = \ubar{k}^*+1, \dots, k, 
    \end{align*}
where $\ubar{k}^* $ and $ \xi^{*} $ are respectively the values of $  \ubar{k} $ and $ \xi $ defined in Theorem~\ref{lower-bound-main-theorem}, corresponding to $ \alpha = \alpha_{\mathcal{S}}^*(k) $, and the price intervals $ \{[L_i, U_i]\}_{\forall i\in [k]} $ are given as follows:  
\begin{align}
\label{upper-bound-main-theorem-design_U_L_h}
    &  U_{\ubar{k}^*} =  L_{\ubar{k}^*+1} = (L-c_{\ubar{k}^*})\cdot e^{(1-\xi^{*}) \cdot {\alpha_{\mathcal{S}}^*(k)}/{k}} + c_{\ubar{k}^*},
     \\
    & U_{i} = L_{i+1} = (L_{i} - c_{i}) \cdot e^{\alpha_{\mathcal{S}}^*(k)/k} + c_{i}, \quad \forall i = \ubar{k}^*+1, \dots, k.
\end{align}
\end{theorem}

We provide a proof sketch of Theorem \ref{upper-bound-large-inventory-cr} in Section \ref{sec:proof_theorem_upper_bound}. At a high level, the design of the pricing functions $\{\phi_{i}(s)\}_{\forall i \in [k]}$ is inspired by the dynamics of an $\alpha_{\mathcal{S}}^*(k)$-competitive algorithm on the arrival instance $\mathcal{I}^{(\epsilon)}$ studied in the lower bound section. Essentially, the inverse of the pricing function $\phi_{i}(s)$, defined as $ \phi_{i}^{-1}(v)=\sup\{s : \phi_{i}(s) \leq v\}$, follows the same design as $\psi^{(\alpha)}_{i}(v)$ in Proposition \ref{prop:lower-bound-psi-star-design} when $\alpha = \alpha_{\mathcal{S}}^*(k)$, namely, $ \psi^{(\alpha_{\mathcal{S}}^*(k))}_{i}(v) =\sup\{s: \phi_{i}(s) \leq v\}$.  

\textbf{Asymptotic optimality of \rDynamic in general settings.} Previous studies (e.g., \cite{Huang_2019, Tan2023}) have shown that $\alpha_{\mathcal{S}}^*(k)$ remains bounded by a constant as $k \rightarrow \infty $. Thus, the competitive ratio of \rDynamic approaches $ \alpha_{\mathcal{S}}^*(k)$  as $k$ goes to infinity, meaning that \rDynamic is asymptotically optimal. 
 
\textbf{Exact optimality of \rDynamic when $ k= 2 $}. For the small inventory case of $k=2$, a tighter analysis shows that \rDynamic is $\alpha_{\mathcal{S}}^*(2)$-competitive using the same design of pricing functions in Theorem \ref{upper-bound-large-inventory-cr},  where $\alpha_{\mathcal{S}}^*(2)$ is the lower bound obtained in Theorem \ref{lower-bound-main-theorem} for $ k = 2 $. This indicates that \rDynamic is not just asymptotically optimal, but also optimal in the small inventory setting when $ k = 2 $. The corollary below formalizes this result.

\begin{corollary}\label{corrolary:upper-bound-small-inventory-optimality}
Given $\mathcal{S} = \{L, U, f\} $ for the \OSDoS problem with $k = 2$, \rDynamic is $\alpha_{\mathcal{S}}^*(2)$-competitive when $\phi_{1}:[0,1]\rightarrow [L_{1},U_{1}]$ and $\phi_{2}:[0,1]\rightarrow [L_{2},U_{2}]$  are designed as follows:
\begin{itemize}[leftmargin=*]
    \item If  $  \alpha_{\mathcal{S}}^*(2) \geq \frac{2L - c_1 - c_2}{L - c_{1}}$,  then:
    \begin{align*}
            & \phi_{1}(s)  =
            \begin{cases} L & s \in [0,\xi^*], \\
            (L-c_{1})\cdot e^{(s-\xi^*)\cdot {\alpha_{\mathcal{S}}^*(2)}/{2}}+c_{1} & s \in [\xi^*,1],
            \end{cases} \\
            & \phi_{2}(s)  = (L_{2}-c_{2})\cdot e^{s \cdot {\alpha_{\mathcal{S}}^*(2)}/{2}}+c_{2}  \qquad\quad  \forall s \in [0,1].
    \end{align*}
    In this case, the price intervals and $ \xi^* $ are given by
    \begin{align*}
      & L_{1} = L,  U_{1} = L_{2} = (L-c_{1})\cdot e^{(1-\xi^*) \cdot {\alpha_{\mathcal{S}}^*(2)}/{2}} + c_{1}, U_{2} = U,\\
      & \xi^* =\frac{1}{\alpha_{\mathcal{S}}^*(2)}\cdot \frac{ (2 L - c_1-c_2)}{L - c_{1}}.
    \end{align*}
    
    \item If $  \alpha_{\mathcal{S}}^*(2) < \frac{2L - c_1 - c_2}{L - c_{1}}$, then: 
    \begin{align*}
        & \phi_{1}(s) = L, \qquad  \forall s \in [0,1],\\
        & \phi_{2}(s)  =
        \begin{cases} L & s \in [0,\xi^*], \\
        (L-c_{2})\cdot e^{(s-\xi^*)\cdot {\alpha_{\mathcal{S}}^*(2)}/{2}}+c_{2} & s \in [\xi^*,1].
        \end{cases}
        \end{align*}
    In this case, the price intervals and $ \xi^* $ are given by
    \begin{align*}
      & L_{1} = U_{1} = L_{2} = L, \quad U_{2} = U, \\
      & \xi^* =\frac{(2 L - c_1-c_2)/\alpha_{\mathcal{S}}^*(2)- (L-c_{1})}{L - c_{2}}.
    \end{align*}
\end{itemize}
\end{corollary}

The proof of the corollary above is given in Appendix \ref{appendix:proof-corrolary:upper-bound-small-inventory-optimality}. 
In the following two subsections, we first evaluate the empirical performance of \rDynamic and then provide a proof sketch of Theorem \ref{upper-bound-large-inventory-cr} to show the asymptotic optimality of \rDynamic. 

\begin{figure*}[t]
    \centering
    \begin{subfigure}{0.3\textwidth}
        \label{fig:empiricala}
    \includegraphics[width=\linewidth]{Figures/emperical1.pdf}
        \caption{\textsf{\bfseries Instance-Sorted}}
    \end{subfigure} 
    \quad
    \begin{subfigure}{0.3\textwidth}
    \label{fig:empiricalb}
    \includegraphics[width=\linewidth]{Figures/emperical2.pdf}
        \caption{\textsf{\bfseries Instance-Low2High}}
    \end{subfigure}
    \quad
    \begin{subfigure}{0.3\textwidth}
    \label{fig:empiricalc}
    \includegraphics[width=\linewidth]{Figures/emperical3.pdf}
        \caption{\textsf{\bfseries Instance-IID}}
    \end{subfigure}
    \vspace{-0.1cm}
    \caption{CDF plots of empirical competitive ratios of  \rDynamic (Algorithm \ref{alg:kselection-cost}), \dDynamic  \cite{Tan2023} and \rStatic \cite{sun2024static}.}
    \label{fig:empirical}
    \vspace{-0.1cm}
\end{figure*}


\subsection{Empirical Performance of \rDynamic}
\label{sec:emprical-rdynamics}
We perform three experiments to evaluate the empirical performance of \rDynamic and compare its performance to two other algorithms, \dDynamic \cite{Tan2023} and \rStatic \cite{sun2024static}. Throughout the three experiments, the setup $\mathcal{S}$ is fixed to be $\{L=1,U=30,f(i) = i^2/16\}$ and $k=10$. To stimulate different arrival patterns of buyers, we consider the following three types of instances: 
\begin{itemize}[leftmargin=*]
    \item \textsf{\bfseries Instance-IID}: We generate the valuations of $1000$ buyers using the truncated normal distribution $N(15,15)_{[1,30]}$.
    \item \textsf{\bfseries Instance-Sorted}: We generate $1000$ buyers using the same approach as \textsf{\bfseries Instance-IID}, and sort these buyers in increasing order by their valuations. This instance mimics the hard instance $\mathcal{I}^{(\epsilon)}$.
    \item \textsf{\bfseries Instance-Low2High}: We generate the valuations of $500$ buyers using truncated normal distribution $N(7.5,7.5)_{[1,30]}$. Following these 500 buyers, we generate another $500$ buyers using distribution $N(22.5,7.5)_{[1,30]}$.  
\end{itemize}
Figure \ref{fig:empirical} presents the CDF plot of the empirical competitive ratios for the three algorithms \rDynamic, \dDynamic, and \rStatic, evaluated on 300 instances from each type of instance. In Figure \ref{fig:empirical}(a), \rDynamic significantly outperforms the other two algorithms under \textsf{\bfseries Instance-Sorted}. This is because the valuations of online arrivals are increasing, similar to the hard instance $\mathcal{I}^{(\epsilon)}$ defined in Section \ref{sec:nec-cond}. This result confirms the superior performance of \rDynamic under difficult instances compared to the other algorithms. Additionally, Figure \ref{fig:empirical}(a) demonstrates that \rDynamic's performance is very close to the lower bound $\alpha^{*}_{\mathcal{S}}(10)$, suggesting that \rDynamic may not only be asymptotically optimal in the large $k$ regime but also near-optimal in the small $k$ regime. In Figure \ref{fig:empirical}(b), \textsf{\bfseries Instance-Low2High} consists of two phases: low-valued buyers arriving first, followed by high-valued buyers. This instance is simpler than \textsf{\bfseries Instance-Sorted}, and the performance of all three algorithms improves, with \rDynamic continuing to outperform the others. Finally, in Figure \ref{fig:empirical}(c), under \textsf{\bfseries Instance-IID}, all algorithms achieve a competitive ratio close to 1, with \rDynamic and \dDynamic performing similarly. These results indicate that \rDynamic's advantage is most evident on more challenging instances, particularly when low-valued buyers arrive before high-valued ones.


\subsection{Proof Sketch of Theorem \ref{upper-bound-large-inventory-cr}}
\label{sec:proof_theorem_upper_bound}
For an arbitrary arrival instance $\mathcal{I} = \{v_t\}_{\forall t \in [T]}$, we prove that $ \rDynamic $ is $\alpha_{\mathcal{S}}^*(k)\cdot \exp(\frac{\alpha_{\mathcal{S}}^*(k)}{k})$-competitive if the pricing functions $\{\phi_i\}_{\forall i \in [k]}$ are designed according to Theorem \ref{upper-bound-large-inventory-cr}. 

Recall that $\mathbf{P} = \{P_i\}_{i\in[k]}$ is generated using the pricing functions $\{\phi_i\}_{\forall i \in [k]}$ at the start of \rDynamic (line \ref{line_P_vector} of Algorithm \ref{alg:kselection-cost}). Hereafter, we will refer to Algorithm \ref{alg:kselection-cost} as $\rDynamic(\mathbf{P})$ to indicate that the algorithm is executed with the random price vector $\mathbf{P}$. Based on the design of  $\{\phi_{i}\}_{\forall i \in [k]}$ in Theorem \ref{upper-bound-large-inventory-cr}, the first $ \ubar{k}^* - 1 $ prices in $ \mathbf{P} $ are all $ L $'s (i.e., $ P_1 = \cdots = P_{\ubar{k}^* - 1} =  L $), the $ \ubar{k}^*$-th price $ P_{\ubar{k}^*} $ is a random variable within $ [L, U_{\ubar{k}^*}]$, and for all $ i \in \{\ubar{k}^*+1, \cdots, k]$, the $ i $-th price $ P_i $ is a random variable within $ [L_i, U_i] $. Here, the values of $\ubar{k}^* $ and $ \{[L_i,U_i]\}_{\forall i} $ are all defined in Theorem \ref{upper-bound-large-inventory-cr}. 

Let $\mathcal{P}$ denote the support of all possible values of the random price vector $\mathbf{P}$:
\begin{align*}
    \mathcal{P} = \{L\}^{\ubar{k}^*-1} \times [L,U_{\ubar{k}^*}] \times \prod_{i \in\{\ubar{k}^*+1,\cdots, k\}} [L_{i}, U_{i}].
\end{align*}
Given a price vector $\mathbf{P} \in \mathcal{P}$, let $W(\mathbf{P})$ represent the total number of items allocated by $\rDynamic(\mathbf{P})$ under the input instance $\mathcal{I}$. Since $\mathbf{P}$ is a random variable, $W(\mathbf{P})$ is also a random variable. For clarity, we will sometimes omit the price vector and refer to it simply as $W$ whenever the context is clear.

Let $\omega$ be the maximum value in the support of the random variable $ W $ (i.e., $ \omega $ is the maximum possible value of $ W(\mathbf{P}) $ for all $ \mathbf{P}\in\mathcal{P}$). Thus, $\omega$ is a deterministic value that depends only on the input instance $\mathcal{I}$. In addition, let $\boldsymbol{\pi} \in \mathcal{P}$ be a price vector such that $\rDynamic(\boldsymbol{\pi})$ allocates the $\omega$-th item earlier than any other price vector in the set $\mathcal{P}$. That is, for all $ \mathbf{P}\in \mathcal{P}$, $\rDynamic(\mathbf{P})$ allocates the $\omega$-th item no earlier than that of $\rDynamic(\boldsymbol{\pi})$. Let us define the set $\{\tau_{i}\}_{\forall i\in [\omega]}$ so that $\tau_{i}$ is the arrival time of the buyer in the instance $ \mathcal{I} $ to whom $\rDynamic(\boldsymbol{\pi})$ allocates the $i$-th unit. Note that for all $ i \in \{1, \cdots, \omega\} $,  $ \tau_i $ is a deterministic value once $ \boldsymbol{\pi}$ and $ \mathcal{I} $ are given. Let the random variable $W^{\tau_{\omega}}(\mathbf{P}) $ denote the total number of items allocated by $\rDynamic(\mathbf{P})$ after the arrival of buyer $\tau_{\omega}$ in the instance $\mathcal{I}$. The lemma below shows that the random variable $ W^{\tau_{\omega}}(\mathbf{P}) $ is always lower bounded by $ \omega - 1$.

\begin{lemma}\label{lem:omega-1}
Given instance $ \mathcal{I} $, $ W^{\tau_{\omega}}(\mathbf{P}) \geq \omega - 1$ holds for all $ \boldsymbol{P} \in \mathcal{P} $.
\end{lemma}

Lemma \ref{lem:omega-1} greatly simplifies the analysis of \rDynamic since it implies that the support of the random variable $ W^{\tau_{\omega}} $ consists only of two values: $\omega-1$ and $\omega$ (note that all $ W $'s are upper bounded by $\omega $). The intuition behind Lemma \ref{lem:omega-1} is as follows. For all $ i \in \{1, \cdots, \omega\} $, recall that  $\tau_{i}$ denotes the arrival time of the buyer in the instance $ \mathcal{I} $ who receives the $ i$-th unit under $\rDynamic(\boldsymbol{\pi})$. Upon the arrival of buyer $\tau_{i}$, if the number of items allocated by $\rDynamic(\mathbf{P})$ is less than $i-1$, then the current $\tau_{i}$-th buyer will definitely accept the price offered to her, ensuring that one more unit will be sold. As a result, at least $\omega - 1$ items will be allocated by the end of time $\tau_{\omega}$. Lemma \ref{lem:omega-1} thus follows.

The following two lemmas help us  lower bound the expected performance of\rDynamic on input instance $\mathcal{I}$ and upper bound the objective of the offline optimal algorithm, respectively. 


\begin{lemma}\label{lem:main:claim3-upper-bound-kselection-cost}
    If a buyer in instance $\mathcal{I}$ arrives before time $\tau_{\omega}$ with a valuation within $[L_{\omega}, U]$, then for all $\mathbf{P} \in \mathcal{P}$, $ \rDynamic(\mathbf{P}) $ will allocate one unit of the item to that buyer.
\end{lemma}

Lemma \ref{lem:main:claim3-upper-bound-kselection-cost} can be proved as follows. By definition, $\tau_{\omega}$ is the earliest time across all possible price vectors in $\mathcal{P}$ that the production level exceeds $\omega-1$, causing the posted price to exceed $U_{\omega-1}$. Thus, for all possible realization of $\mathbf{P} \in \mathcal{P}$, the posted prices by \rDynamic remain below $U_{\omega-1}$ before the arrival of buyer at time $\tau_{\omega}$. Consequently, when a buyer with a valuation within $[L_{\omega}, U]$ arrives before time $\tau_{\omega}$, the buyer accepts the price posted to him (since $ L_{\omega} \ge U_{\omega-1} $) and a unit of item will thus be allocated to this buyer.

\begin{lemma}
\label{lem:main:claim2-kselection-production-cost}
    There are no buyers in instance $\mathcal{I}$ with a valuation within $[U_{\omega}, U]$ arriving after time $\tau_{\omega}$, namely, the valuations of all buyers arrive after $\tau_{\omega}$ are less than $ U_{\omega}$.
\end{lemma}
The above lemma can be proved by contradiction. If there exists a buyer arriving after time $\tau_{\omega}$ with a valuation within $[U_{\omega}, U]$, then there must exist a price vector in $\mathcal{P}$, say $ \mathbf{P}' $, such that $ \rDynamic(\mathbf{P}') $ will allocate more than $\omega$ units, contradicting the definition of $\omega$. 

Applying Lemma \ref{lem:main:claim3-upper-bound-kselection-cost} and observing that \rDynamic sells at least $\omega-1$ units, we can derive a lower bound on the expected performance of \rDynamic. Conversely, using the lemma \ref{lem:main:claim2-kselection-production-cost} and the fact that for all $\mathbf{P} \in \mathcal{P}$, the allocation level of \rDynamic never exceeds $\omega$, we can upper bound the objective of the offline optimal algorithm. The combination of these two bounds yields the final competitive ratio of \rDynamic. For the full proof of Theorem \ref{upper-bound-large-inventory-cr}, refer to Appendix~\ref{appendix:proof-upper-bound-large-inventory-cr}.


\section{Conclusions and Future Work}
In this paper, we studied online $k$-selection with production costs that exhibit diseconomies of scale (\OSDoS) and developed novel randomized dynamic pricing mechanisms with the best-known competitive ratios. Specifically, our randomized dynamic pricing scheme provides tight guarantees in both the small and large inventory settings (i.e., small and large $k$), addressing the gap left by \cite{Tan2023}. These findings advance the theoretical understanding of \OSDoS and offer practical insights for designing randomized dynamic pricing mechanisms in online resource allocation problems with increasing marginal production costs.

This work highlights several promising directions for future research. First, we conjecture that our proposed randomized pricing mechanism is optimal for all $k \geq 1$. However, a more refined analysis is required to establish or refute its optimality for $k \geq 3$. Additionally, extending our results to multi-resource or combinatorial settings could reveal new insights into online resource allocation with diseconomies of scale in more complex environments. Furthermore, it would be valuable to explore other metrics, such as risk and fairness, in online allocation and selection to ensure that the developed randomized pricing mechanisms not only maximize efficiency but also promote reliable and equitable outcomes.

\section*{Acknowledgments}
Hossein Nekouyan Jazi and Xiaoqi Tan acknowledge support from the Alberta Machine Intelligence Institute (Amii), the Alberta Major Innovation Fund, and the NSERC Discovery Grant RGPIN-2022-03646. Bo Sun and Raouf Boutaba acknowledge support from the NSERC Grant RGPIN-2019-06587.

\printbibliography{}

%\newpage
\appendix
%{\Large{\textbf{Appendix}}}

\input{appendix}

\end{document}