\begin{algorithm}[t]
% \scriptsize
    \caption{GetOutNeighbors}
    \label{alg:get_nbr}
    \KwIn{
        Vertex $v$, set of $k$DPs $B$, original graph $G$, \{$P$\}
        % \textit{\color{gray} // \{$P$\}: represented by $prehops$, $nexthops$, $isPinner$, $isS$ and $isT$.}
    }
    \KwOut{\{($u$, $B'$)\} \textit{\color{gray} // $u$: a neighbor of $v$, $B'$: corresponding $k$DP subset.}}
    $S = \emptyset$ \\ % newline
    \uIf{$v$ is $new_{in}$ \textit{\color{gray} // $v$ is $v_{in}$.}}
    {
        \ForEach{$u$ in $prehops_v$ \textit{\color{gray} // Reversed edges: $v$'s prehops.}}
        {
            Add ($u$, $B \cap prehops_{v, u}$) to $S$ 
            % \textit{\color{gray} // $k$DPs where $u$ is $v$'s $prehop$.}
        }
    }
    \Else(\textit{\color{gray} // $v$ is $v_{out}$ or $v$.})
    {
        \ForEach{$u$ in out-neighbors of $G$}
       {
            $haveset = B \setminus nexthops_{v, u}$ \textit{\color{gray} // Excluding reversed edges.}\\
            % \textit{\color{gray} // Edges not in any $P$ of $haveset$.} \\
            Add ($u^{in}$, $haveset \cap isPinner_u$) to $S$ \textit{\color{gray} // Edges to $P$-$inner$ vertices are redirected to $new^{in}$.} \\
            Add ($u$, $haveset \setminus isPinner_u$) to $S$ 
            \textit{\color{gray} // Otherwise no redirecting.} 
            % \textit{\color{gray} // Edges to non-$P$-$inner$ vertices.} 
            \\
        }
        Add ($v^{in}$, $B \cap isPinner_v$) to $S$ 
        \textit{\color{gray} // The edge from $v^{out}$ to $v^{in}$}
        % \textit{\color{gray} // $v^{out}$ has an out-going edge to $v^{in}$}
        \\
    }
    \Return $S$\\
    % \vspace{-2pt}
\end{algorithm}

