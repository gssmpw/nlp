\providecommand{\mycolorbar}[8]
{  
    \foreach \x [count=\c] in {#3}{ \xdef\numcolo{\c}}
    \pgfmathsetmacro{\pieceheight}{#1/(\numcolo-1)}
    \xdef\lowcolo{}
    \foreach \x [count=\c] in {#3}
    {   \ifthenelse{\c = 1}
        {}
        {   
            \fill[bottom color=\lowcolo,top color=\x] 
            (#7,{#8+(\c-2)*\pieceheight}) rectangle (#7+#2,{#8+(\c-1)*\pieceheight});
        }
        \xdef\lowcolo{\x}
    }
    \draw (#7,#8) rectangle (#7+#2,#8+#1);
    \pgfmathsetmacro{\secondlabel}{#4+#6}
    \pgfmathsetmacro{\lastlabel}{#5+0.01}
    \pgfkeys{/pgf/number format/.cd,fixed,precision=2}
    \foreach \x in {#4,\secondlabel,...,\lastlabel}{
        \draw (#7+#2,{(\x-#4)/(#5-#4)*#1+#8}) -- ++ (0.05,0.) node[right, font=\tiny] {
            \pgfmathprintnumber{\x}
        };
    }
}

\begin{tikzpicture}[scale=0.5]
    \pgfplotstableread[col sep=comma]{data/heatmap_spatial_location.csv}\datatable
    
    \pgfplotstablegetrowsof{\datatable}
    \pgfmathsetmacro{\numrows}{\pgfplotsretval}
    \pgfplotstablegetcolsof{\datatable}
    \pgfmathsetmacro{\numcols}{\pgfplotsretval}
    
    \pgfmathsetmacro{\numrowsi}{\numrows-1}
    \pgfmathsetmacro{\numcolsi}{\numcols-1}
    
    \pgfmathsetmacro{\cellspacing}{2.0}
    \pgfmathsetmacro{\cellsize}{10mm}
    \pgfmathsetmacro{\maxValue}{0.509}
    \pgfmathsetmacro{\minValue}{0}

    \pgfmathsetmacro{\height}{\cellspacing*\numrows-0.1}



    \foreach \y in {0,...,\numrowsi} {
        \foreach \x in {0,...,\numcolsi} {
          \pgfplotstablegetelem{\y}{\x}\of{\datatable}
          \let\cellvalue\pgfplotsretval
    
          \pgfmathsetmacro{\cellColorValue}{((\cellvalue-\minValue)/(\maxValue-\minValue)*100}
          \colorlet{cellColor}{yellow!\cellColorValue!black}    
          \node[fill=cellColor, draw=black, minimum size=\cellsize] at (\x*\cellspacing+1, -\y*\cellspacing-1) {};
        };
    }

\end{tikzpicture}