
\pgfplotsset{every tick label/.append style={font=\scriptsize}}

\newcommand{\addFilling}[4]{
    \addplot [
        fill=gray, fill opacity=0.1, draw=none,
    ] coordinates {
        ({#1}, 100)
        ({#2}, 100)
        ({#2}, -1)
        ({#1}, -1)
    } -- cycle;
}

\begin{tikzpicture}
\begin{axis}[
    width=1.05\linewidth,
    height=0.282\linewidth,
    ymin=0, ymax=80,
    ytick={10,30,50,70,90}, 
    ylabel={mAP@1k},
    ylabel style={yshift=-5pt},
    yticklabel style={font=\scriptsize,xshift=2pt},
    xtick=data,
    xticklabel style={rotate=45, anchor=east, font=\scriptsize, yshift=-2pt, xshift=2pt, name=xlabel\ticknum},
    symbolic x coords=\xcoords,
    symbolic x coords={
        art       - paper model   (22),
        art       - digital       (11),
        art       - craft         (10),
        art       - sculpture     (59),
        art       - painting      (58),
        art       - textile       (8),
        test,
        landmark  - architecture  (32),
        landmark  - public art    (110),
        landmark  - sign          (20),
        test,
        toy       - stuffed       (36),
        toy       - playset       (15),
        toy       - action figure (38),
        toy       - boardgame     (10),
        toy       - other         (13),
        toy       - trading       (29),
        toy       - vehicle       (8),
        toy       - sport         (6),
        test,
        fashion   - footwear      (14),
        fashion   - outwear       (38),
        fashion   - tattoo        (9),
        fashion   - other         (2),
        fashion   - accessory     (46),
        fashion   - jewelry       (34),
        test,
        household - light         (13),
        household - container     (18),
        household - accessory     (14),
        household - decor         (19),
        household - textile       (5),
        household - other         (5),
        household - tableware     (25),
        test,
        technology- appliances    (21),
        technology- automation    (30),
        technology- multimedia    (18),
        technology- other         (3),
        technology- gadget        (7),
        technology- gaming        (8),
        technology- peripheral    (10),
        test,
        media     - other         (4),
        media     - book          (48),
        media     - recording     (7),
        media     - stamp         (12),
        media     - sticker       (22),
        test,
        product   - perfume       (8),
        product   - writing tool  (10),
        product   - other         (3),
        product   - hygiene       (10),
        product   - food          (21),
        product   - drink         (31),
    },
    xticklabels={
         paper model   (22),
         digital       (11),
         craft         (10),
         sculpture     (59),
         painting      (58),
         textile       (8),
         architecture  (32),
         public art    (110),
         sign          (20),
         stuffed       (36),
         playset       (15),
         action figure (38),
         boardgame     (10),
         other         (13),
         trading       (29),
         vehicle       (8),
         sport         (6),
         footwear      (14),
         outwear       (38),
         tattoo        (9),
         other         (2),
         accessory     (46),
         jewelry       (34),
         light         (13),
         container     (18),
         accessory     (14),
         decor         (19),
         textile       (5),
         other         (5),
         tableware     (25),
         appliances    (21),
         automation    (30),
         multimedia    (18),
         other         (3),
         gadget        (7),
         gaming        (8),
         peripheral    (10),
         other         (4),
         book          (48),
         recording     (7),
         stamp         (12),
         sticker       (22),
         perfume       (8),
         writing tool  (10),
         other         (3),
         hygiene       (10),
         food          (21),
         drink         (31),
    },
    grid=major,
    grid style={color=lightgray!60, dash pattern=on 2pt off 2pt},
    enlarge x limits={abs=0.2cm},
    legend style={
        at={(0.5,0.805)}, 
        anchor=south, 
        legend columns=-1,  
        /tikz/every even column/.append style={column sep=0.2cm}, 
        font=\footnotesize,
        inner sep=1pt,  
        outer sep=1pt 
    },
    legend cell align={left},
    name=dist,
]

\pgfplotstableread[col sep=comma]{data/performance_per_subdomain.csv}\loadeddata

\addplot+[
    only marks, 
    mark=*, 
    mark options={fill=appleblue, draw=black}, 
] table [
    x=subdomain, 
    y=avg_ap_ames_siglip_384,
    col sep=comma
] {\loadeddata};
\addlegendentry{SigLIP$^\dagger$+AMES}

\addplot+[
    only marks, 
    mark=*, 
    color=appleteal, 
    mark options={fill=appleteal, draw=black}, 
] table [
    x=subdomain, 
    y=avg_ap_siglip_384_proj,
    col sep=comma
] {\loadeddata};
\addlegendentry{SigLIP$^\dagger$}

\addplot+[
    only marks, 
    mark=*, 
    color=applemustard, 
    mark options={fill=applemustard, draw=black}, 
] table [
    x=subdomain, 
    y=avg_ap_siglip_384_nw,
    col sep=comma
] {\loadeddata};
\addlegendentry{SigLIP}

\addplot+[
    only marks, 
    mark=*, 
    color=applepurple, 
    mark options={fill=applepurple, draw=black}, 
] table [
    x=subdomain, 
    y=avg_ap_siglip_384_text,
    col sep=comma
] {\loadeddata};
\addlegendentry{SigLIP-text}

\addplot+[
    only marks, 
    mark=*, 
    color=appleorange,
    mark options={fill=appleorange, draw=black},
] table [
    x=subdomain, 
    y=avg_ap_dinov2_vitl14,
    col sep=comma
] {\loadeddata};
\addlegendentry{DINOv2$^\dagger$}

\addplot [
    fill=gray, fill opacity=0.1,draw=none,
] coordinates {
    ({art       - paper model   (22)}, 100)
    ({art         - textile      (8)}, 100)
    ({art         - textile      (8)}, -1)
    ({art       - paper model   (22)}, -1)
} -- cycle;

\addplot [
    fill=gray, fill opacity=0.1,  draw=none,
] coordinates {
    ({landmark    - architecture (32)}, 100)
    ({landmark    - sign         (20)}, 100)
    ({landmark    - sign         (20)}, -1)
    ({landmark    - architecture (32)}, -1)
} -- cycle;

\addplot [
    fill=gray, fill opacity=0.15,draw=none,
] coordinates {
    ({toy       - stuffed         (36)}, 100)
    ({toy       - sport       (6)}, 100)
    ({toy       - sport       (6)}, -1)
    ({toy       - stuffed         (36)}, -1)
} -- cycle;

\addplot [
    fill=gray, fill opacity=0.1, draw=none,
] coordinates {
    ({fashion     - footwear     (14)}, 100)
    ({fashion     - jewelry      (34)}, 100)
    ({fashion     - jewelry      (34)}, -1)
    ({fashion     - footwear     (14)}, -1)
} -- cycle;

\addplot [
    fill=gray, fill opacity=0.1,draw=none,
] coordinates {
    ({household - light     (13)}, 100)
    ({household - tableware         (25)}, 100)
    ({household - tableware         (25)}, -1)
    ({household - light     (13)}, -1)
} -- cycle;

\addplot [
    fill=gray, fill opacity=0.1,draw=none,
] coordinates {
    ({technology- appliances    (21)}, 100)
    ({technology- peripheral        (10)}, 100)
    ({technology- peripheral        (10)}, -1)
    ({technology- appliances    (21)}, -1)
} -- cycle;

\addplot [
    fill=gray, fill opacity=0.1,draw=none,
] coordinates {
    ({media     - other         (4)}, 100)
    ({media     - sticker         (22)}, 100)
    ({media     - sticker         (22)}, -1)
    ({media     - other         (4)}, -1)
} -- cycle;

\addplot [
    fill=gray, fill opacity=0.1,draw=none,
] coordinates {
    ({product   - perfume       (8)}, 100)
    ({product   - drink         (31)}, 100)
    ({product   - drink         (31)}, -1)
    ({product   - perfume       (8)}, -1)
} -- cycle;

\end{axis}

\foreach \X/\value in {0.96/art, 2.64/landmark, 4.60/toys, 7.02/fashion, 9.30/decor, 11.72/technology,  13.83/media,  15.8/product} {
    \node[anchor=north, font=\footnotesize] at (\X,3.70cm) {\scalebox{1.}{\value}};
}
\end{tikzpicture}