\newcommand{\imagebox}[9]{%
    \begin{tikzpicture}
        \node[inner sep=0pt, draw, line width=1mm, draw=#5, name=instance] (img) {
            \adjustbox{width=0.097\linewidth, height=0.097\linewidth}{
                \includegraphics{#1}
            }
        };
        \pgfmathsetmacro{\imgType}{#4}
        \pgfmathsetmacro{\rankText}{#4 == 2 ? "rank #2": (#4 == 3 ? "rank #2" : "AP: #3")}
        \pgfmathsetmacro{\shiftText}{#4 == 2 ? -0.8cm : (#4 == 3 ? -0.8cm : -0.8cm)}
        \pgfmathsetmacro{\isBold}{#4 < 2 ? 1 : 0}
        \node[anchor=west, text=black, font=\tiny, yshift=0.93cm, xshift=\shiftText, align=left] at (img) {{\ifnum\isBold=1 \textbf{\rankText} \else \textbf{\rankText} \fi}};
    \end{tikzpicture}
}

% 
\begin{subfigure}{0.9\textwidth}
    \hspace{-35pt}
    \setlength{\tabcolsep}{0pt}
    \renewcommand{\arraystretch}{1.2} 
     \begin{tikzpicture}[remember picture]
     \node[anchor=north west, inner sep=0pt](tablepos) {
            \begin{tabular}{c@{\hspace{0.1cm}} *{3}{c} c@{\hspace{0.4cm}} c@{\hspace{0.1cm}} *{4}{c}} 
            % \vspace{0.2cm}
            
            \imagebox{data/images/difficult/laskazak-landscape-2022-query-Q00488.jpg}{-1}{0}{1}{lightblue}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/8_2080c7b71afafab98f8ab55a8a1d.jpg}{8}{0}{2}{lightred}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/13_eae08d8fe451486eb99faf8651a0e2.jpg}{13}{0}{2}{lightred}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/laskazak-landscape-2022-pos-P01698.jpg}{$>$1000}{0}{3}{lightgreen}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/laskazak-landscape-2022-pos-P01697.jpg}{$>$1000}{0}{3}{lightgreen}{0}{0}{0}{0} &


            \imagebox{data/images/test/sumapave-caesar-2018-query-Q00832.jpg}{-1}{19.1}{1}{lightblue}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/sumapave-caesar-2018_2_P03246.jpg.jpg}{2}{19.1}{3}{lightgreen}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/sumapave-caesar-2018_8_fd2df1cee2e6de8b5cbc6b1df81878.jpg}{8}{19.1}{2}{lightred}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/sumapave-caesar-2018_25_f2c825dcfb15d2ccb1ae85a9f7c9fc2a.jpg}{25}{19.1}{2}{lightred}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/sumapave-caesar-2018-pos-P03236.jpg}{$>$1000}{19.1}{3}{lightgreen}{0}{0}{0}{0.0} \\
            


            \imagebox{data/images/difficult/toliageo-decor-vase-fish-query-Q00997.jpg}{-1}{0.1}{1}{lightblue}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/4_877cc67e813d5f3741a1ef89a92da25.jpg}{15}{0.1}{2}{lightred}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/45_8df9cb928a833ae5d6d92485351bab2.jpg}{47}{0.1}{2}{lightred}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/toliageo-decor-vase-fish-pos-P03885.jpg}{352}{0.1}{3}{lightgreen}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/toliageo-decor-vase-fish-pos-P03884.jpg}{$>$1000}{0.1}{3}{lightgreen}{0}{0}{0}{0} &
            
            \imagebox{data/images/test/kordogeo-abstract-painting1-query-Q00201.jpg}{-1}{38.3}{1}{lightblue}{0}{0}{0}{0} &
            \imagebox{data/images/test/kordogeo-abstract-painting1_2_P00735.jpg.jpg}{2}{38.3}{2}{lightgreen}{0}{0}{0}{0} &
            \imagebox{data/images/test/kordogeo-abstract-painting1_4_fb643b843ef41e5d5e495a977a8ed0.jpg}{4}{87.7}{2}{lightred}{0}{0}{0}{0} &
            \imagebox{data/images/test/kordogeo-abstract-painting1_32_53b6762946bb4c4fe1afb10b6a035.jpg}{32}{38.3}{3}{lightred}{0}{0}{0}{0} &
            \imagebox{data/images/test/kordogeo-abstract-painting1-pos-P00733.jpg}{$>$1000}{38.3}{3}{lightgreen}{0}{0}{0}{0} \\

            \imagebox{data/images/test/stojnvla-the-god-machine-2022-query-Q00795.jpg}{-1}{2.2}{1}{lightblue}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/stojnvla-the-god-machine-2022_4_e96c1f1893f9f48f52e789fa6dcbae19.jpg}{4}{2.2}{2}{lightred}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/stojnvla-the-god-machine-2022_16_543a248d32ed41dcc06562a1b3136.jpg}{16}{2.2}{2}{lightred}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/stojnvla-the-god-machine-2022_22_36c82fca738edbe995bb69aa6327744f.jpg}{22}{2.2}{2}{lightred}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/stojnvla-the-god-machine-2022-pos-P03067.jpg}{333}{2.2}{3}{lightgreen}{0}{0}{0}{0.0} & 
            
            \imagebox{data/images/test/mankoann-bag-medicine-prymachenko-2022-v0912-query-Q00525.jpg}{-1}{56.1}{1}{lightblue}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/mankoann-bag-medicine-prymachenko-2022-v0912_2_P01780.jpg.jpg}{2}{56.1}{3}{lightgreen}{0}{0}{0}{0} &
            \imagebox{data/images/test/mankoann-bag-medicine-prymachenko-2022-v0912_3_f3269a01253f34edb9ee5e1744ee486.jpg}{3}{56.1}{3}{lightred}{0}{0}{0}{0} &
            \imagebox{data/images/test/mankoann-bag-medicine-prymachenko-2022-v0912_7_P01777.jpg.jpg}{7}{56.1}{3}{lightgreen}{0}{0}{0}{0} &
            \imagebox{data/images/test/mankoann-bag-medicine-prymachenko-2022-v0912_9_5b6d365df7cf9da9e8a9044233456.jpg}{9}{56.1}{3}{lightred}{0}{0}{0}{0} \\



            \imagebox{data/images/test/kordogeo-espresso-coffee-machine-2015-query-Q00259.jpg}{-1}{10.3}{1}{lightblue}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/kordogeo-espresso-coffee-machine-2015_3_P00946.jpg.jpg}{3}{10.3}{2}{lightgreen}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/kordogeo-espresso-coffee-machine-2015_6_8de1b01d423299aeae973ad7a5d2b55.jpg}{6}{10.3}{2}{lightred}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/79_f9aa269b6cb24bc7297f87dd50652452.jpg}{79}{10.3}{2}{lightred}{0}{0}{0}{0.0} &
            \imagebox{data/images/test/kordogeo-espresso-coffee-machine-2015-pos-P00947.jpg}{299}{10.3}{3}{lightgreen}{0}{0}{0}{0.0} &


            \imagebox{data/images/difficult/kordogeo-organs-without-bodies-2024-query-Q00365.jpg}{-1}{76.8}{1}{lightblue}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/kordogeo-organs-without-bodies-2024-pos-P01321.jpg}{1}{76.8}{3}{lightgreen}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/kordogeo-organs-without-bodies-2024-pos-P01323.jpg}{2}{76.8}{3}{lightgreen}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/0_456d2dfda0871933c1ae5f46722d23b.jpg}{6}{76.8}{2}{lightred}{0}{0}{0}{0} &
            \imagebox{data/images/difficult/2_1590c1264b8e2bc72492aef05332b9b.jpg}{24}{76.8}{2}{lightred}{0}{0}{0}{0} \\

            
            
            \end{tabular}        
        };
    \end{tikzpicture}
    \begin{tikzpicture}[remember picture,overlay]
        \draw[line width=0.01pt, color=lightblue]
        ($(tablepos.north)+(0cm,0cm)$)--($(tablepos.south)+(0cm,0.2cm)$);
        
    \end{tikzpicture}
\end{subfigure}