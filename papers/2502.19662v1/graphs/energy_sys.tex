\begin{tikzpicture}

% Define a pattern with a rotated grid
%\fill[pattern color=black!70, pattern=custom grid] (0,0) rectangle (5,5);

% Define the custom grid pattern rotated by 45 degrees
\makeatletter
\pgfdeclarepatternformonly{custom grid}{\pgfqpoint{0cm}{0cm}}{\pgfqpoint{2pt}{2pt}}{\pgfqpoint{2pt}{2pt}}%
{
    \pgftransformrotate{45} % Rotate the grid by 45 degrees
    \pgfpathmoveto{\pgfqpoint{0cm}{0cm}}
    \pgfpathlineto{\pgfqpoint{2pt}{0cm}}
    \pgfpathmoveto{\pgfqpoint{0cm}{0cm}}
    \pgfpathlineto{\pgfqpoint{0cm}{2pt}}
    \pgfusepath{stroke}
}
\makeatother

% FP16
\begin{axis}[bar shift=-10.5pt,
    width=\columnwidth,, height=3.2cm,
    bar width=3.5pt,
    ybar stacked,
    ymin=0,
    ymax=2.2,
    ylabel={\shortstack{Normalized\\energy consumption}},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,1.05,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_sys.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod, postaction={pattern=north west lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = fp16_static,
    ]{graphs/data/energy_sys.data};

\addplot [fill=lightgray, postaction={pattern=north west lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = fp16_buffer,
    ]{graphs/data/energy_sys.data};

\addplot [fill=asparagus, postaction={pattern=north west lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = fp16_core,
    ]{graphs/data/energy_sys.data};

\end{axis}

% W8A8
\begin{axis}[bar shift=-7pt,
    width=\columnwidth,, height=3.2cm,
    bar width=3.5pt,
    ybar stacked,
    ymin=0,
    ymax=2.2,
    %ylabel={Total network Congestion (in \%)},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,1.05,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_sys.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod, postaction={pattern=horizontal lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int8_static,
    ]{graphs/data/energy_sys.data};

\addplot [fill=lightgray, postaction={pattern=horizontal lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int8_buffer,
    ]{graphs/data/energy_sys.data};
    
\addplot [fill=asparagus, postaction={pattern=horizontal lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int8_core,
    ]{graphs/data/energy_sys.data};
    
\end{axis}

% W4A8
\begin{axis}[bar shift=-3.5pt,
    width=\columnwidth,, height=3.2cm,
    bar width=3.5pt,
    ybar stacked,
    ymin=0,
    ymax=2.2,
    %ylabel={Total network Congestion (in \%)},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,1.05,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_sys.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod, postaction={pattern=grid, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int4_static,
    ]{graphs/data/energy_sys.data};

\addplot [fill=lightgray, postaction={pattern=grid, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int4_buffer,
    ]{graphs/data/energy_sys.data};
    
\addplot [fill=asparagus, postaction={pattern=grid, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int4_core,
    ]{graphs/data/energy_sys.data};
    
\end{axis}

% W3A8
\begin{axis}[bar shift=0pt,
    width=\columnwidth,, height=3.2cm,
    bar width=3.5pt,
    ybar stacked,
    ymin=0,
    ymax=2.2,
    %ylabel={Total network Congestion (in \%)},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,1.05,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_sys.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod, postaction={pattern=custom grid, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int3_static,
    ]{graphs/data/energy_sys.data};

\addplot [fill=lightgray, postaction={pattern=custom grid, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int3_buffer,
    ]{graphs/data/energy_sys.data};
    
\addplot [fill=asparagus, postaction={pattern=custom grid, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int3_core,
    ]{graphs/data/energy_sys.data};
    
\end{axis}

% Perf
\begin{axis}[bar shift=3.5pt,
    width=\columnwidth,, height=3.2cm,
    bar width=3.5pt,
    ybar stacked,
    ymin=0,
    ymax=2.2,
    %ylabel={Total network Congestion (in \%)},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,1.05,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_sys.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod, postaction={pattern=crosshatch, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = perf_static,
    ]{graphs/data/energy_sys.data};

\addplot [fill=lightgray, postaction={pattern=crosshatch, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = perf_buffer,
    ]{graphs/data/energy_sys.data};
    
\addplot [fill=asparagus, postaction={pattern=crosshatch, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = perf_core,
    ]{graphs/data/energy_sys.data};
    
\end{axis}

% Acc
\begin{axis}[bar shift=7pt,
    width=\columnwidth,, height=3.2cm,
    bar width=3.5pt,
    ybar stacked,
    ymin=0,
    ymax=2.2,
    %ylabel={Total network Congestion (in \%)},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,1.05,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_sys.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod, postaction={pattern=crosshatch dots, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = acc_static,
    ]{graphs/data/energy_sys.data};

\addplot [fill=lightgray, postaction={pattern=crosshatch dots, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = acc_buffer,
    ]{graphs/data/energy_sys.data};
    
\addplot [fill=asparagus, postaction={pattern=crosshatch dots, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = acc_core,
    ]{graphs/data/energy_sys.data};
    
\end{axis}

% Bal
\begin{axis}[bar shift=10.5pt,
    width=\columnwidth,, height=3.2cm,
    bar width=3.5pt,
    ybar stacked,
    ymin=0,
    ymax=2.2,
    %ylabel={Total network Congestion (in \%)},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,1.05,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_sys.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod, postaction={pattern=north east lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = bal_static,
    ]{graphs/data/energy_sys.data};

\addplot [fill=lightgray, postaction={pattern=north east lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = bal_buffer,
    ]{graphs/data/energy_sys.data};
    
\addplot [fill=asparagus, postaction={pattern=north east lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = bal_core,
    ]{graphs/data/energy_sys.data};

\end{axis}

% Legend
\begin{axis}[hide axis,
    width=\columnwidth,, height=2.95cm,
    ybar stacked,
    ymin=0,
    ymax=2.2,
    xtick=data,
    legend columns=4,
    legend style={fill=white, at={(0.5,1.15,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_sys.data}{Model},
]

\addplot [fill=darkgoldenrod]
table[
    x expr = \coordindex,
    y = bal_dram,
    ]{graphs/data/energy_sys.data};
\addlegendentry{\em Static};

\addplot [fill=lightgray]
table[
    x expr = 0,
    y = bal_dram,
    ]{graphs/data/energy_sys.data};
\addlegendentry{\em Buffer};

\addplot [fill=asparagus]
table[
    x expr = \coordindex,
    y = bal_dram,
    ]{graphs/data/energy_sys.data};
\addlegendentry{\em Core};
\end{axis}

% Architecture legend
\begin{axis}[hide axis,
    width=\columnwidth,, height=3cm,
    ybar stacked,
    ymin=0,
    % ymax=2.20,
    xtick=data,
    legend columns=4,
    legend style={fill=white, at={(0.5,-1.4,1.15)}, anchor=south, font=\scriptsize},
    xticklabels from table={graphs/data/energy_sys.data}{Model},
]
    \addplot [fill=white, postaction={pattern=north west lines, pattern color=black, line width=0.4pt}]
table[
    x expr = 0,
    y = bal_dram,
    ]{graphs/data/energy_sys.data};
\addlegendentry{\em FP16};

\addplot [fill=white, postaction={pattern=horizontal lines, pattern color=black, line width=0.4pt}]
table[
    x expr = 0,
    y = bal_dram,
    ]{graphs/data/energy_sys.data};
\addlegendentry{\em W8A8};

\addplot [fill=white, postaction={pattern=grid, pattern color=black, line width=0.4pt}]
table[
    x expr = 0,
    y = bal_dram,
    ]{graphs/data/energy_sys.data};
\addlegendentry{\em W4A8};

\addplot [fill=white, postaction={pattern=custom grid, pattern color=black, line width=0.4pt}]
table[
    x expr = 0,
    y = bal_dram,
    ]{graphs/data/energy_sys.data};
\addlegendentry{\em W3A8};

\addplot [fill=white, postaction={pattern=crosshatch, pattern color=black, line width=0.4pt}]
table[
    x expr = 0,
    y = bal_dram,
    ]{graphs/data/energy_sys.data};
\addlegendentry{\em HALO(perf-opt)};

\addplot [fill=white, postaction={pattern=crosshatch dots, pattern color=black, line width=0.4pt}]
table[
    x expr = 0,
    y = bal_dram,
    ]{graphs/data/energy_sys.data};
\addlegendentry{\em HALO(acc-opt)};

\addplot [fill=white, postaction={pattern=north east lines, pattern color=black, line width=0.4pt}]
table[
    x expr = 0,
    y = bal_dram,
    ]{graphs/data/energy_sys.data};
\addlegendentry{\em HALO(bal)};

\end{axis}

\end{tikzpicture}