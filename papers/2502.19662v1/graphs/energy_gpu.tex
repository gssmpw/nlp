\begin{tikzpicture}
% W8A8
\begin{axis}[bar shift=-7.5pt,
    width=\columnwidth,, height=3.2cm,
    bar width=5pt,
    ybar stacked,
    ymin=0,
    ymax=1.5,
    ylabel={\shortstack{Normalized energy\\ consumption}},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,1.05,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_gpu.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod, postaction={pattern=horizontal lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int8_const,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=asparagus, postaction={pattern=horizontal lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int8_static,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=lightgray, postaction={pattern=horizontal lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int8_l2_dram,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=lightblue, postaction={pattern=horizontal lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int8_reg_l1,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=teal, postaction={pattern=horizontal lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = int8_core,
    ]{graphs/data/energy_gpu.data};
    
\end{axis}

\begin{axis}[hide axis, bar shift=-2.5pt,
    width=\columnwidth,, height=3.2cm,
    bar width=5pt,
    ybar stacked,
    ymin=0,
    ymax=1.5,
    %ylabel={Total network Congestion (in \%)},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,1.05,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_gpu.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod, postaction={pattern=crosshatch, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = perf_const,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=asparagus, postaction={pattern=crosshatch, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = perf_static,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=lightgray, postaction={pattern=crosshatch, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = perf_l2_dram,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=lightblue, postaction={pattern=crosshatch, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = perf_reg_l1,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=teal, postaction={pattern=crosshatch, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = perf_core,
    ]{graphs/data/energy_gpu.data};
    
\end{axis}

\begin{axis}[hide axis, bar shift=2.5pt,
    width=\columnwidth,, height=3.2cm,
    bar width=5pt,
    ybar stacked,
    ymin=0,
    ymax=1.5,
    %ylabel={Total network Congestion (in \%)},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,1.05,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_gpu.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod, postaction={pattern=crosshatch dots, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = acc_const,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=asparagus, postaction={pattern=crosshatch dots, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = acc_static,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=lightgray, postaction={pattern=crosshatch dots, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = acc_l2_dram,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=lightblue, postaction={pattern=crosshatch dots, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = acc_reg_l1,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=teal, postaction={pattern=crosshatch dots, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = acc_core,
    ]{graphs/data/energy_gpu.data};
    
\end{axis}

\begin{axis}[hide axis, bar shift=7.5pt,
    width=\columnwidth,, height=3.2cm,
    bar width=5pt,
    ybar stacked,
    ymin=0,
    ymax=1.5,
    %ylabel={Total network Congestion (in \%)},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,0.9,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_gpu.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod, postaction={pattern=north east lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = bal_const,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=asparagus, postaction={pattern=north east lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = bal_static,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=lightgray, postaction={pattern=north east lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = bal_l2_dram,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=lightblue, postaction={pattern=north east lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = bal_reg_l1,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=teal, postaction={pattern=north east lines, pattern color=black, line width=0.4pt}]
table[
    x expr = \coordindex,
    y = bal_core,
    ]{graphs/data/energy_gpu.data};

\end{axis}

\begin{axis}[hide axis,
    bar shift=7.5pt,
    width=\columnwidth,, height=3.2cm,
    bar width=5pt,
    ybar stacked,
    ymin=0,
    ymax=1.5,
    %ylabel={Total network Congestion (in \%)},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,0.9,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=true,
    xticklabels from table={graphs/data/energy_gpu.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=darkgoldenrod]
table[
    x expr = \coordindex,
    y = extra,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=asparagus]
table[
    x expr = \coordindex,
    y = extra,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=lightgray]
table[
    x expr = \coordindex,
    y = extra,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=lightblue]
table[
    x expr = \coordindex,
    y = extra,
    ]{graphs/data/energy_gpu.data};

\addplot [fill=teal]
table[
    x expr = \coordindex,
    y = extra,
    ]{graphs/data/energy_gpu.data};

\legend{Const, Static, L2, Reg+L1, Core}
\end{axis}

\begin{axis}[hide axis,
    bar shift=7.5pt,
    width=\columnwidth,, height=3.2cm,
    bar width=5pt,
    ybar stacked,
    ymin=0,
    ymax=1.5,
    %ylabel={Total network Congestion (in \%)},
    xtick=data,
    legend columns=4,
    legend columns=8,
    legend style={fill=white, at={(0.5,-1.05,1.15)}, anchor=south, font=\scriptsize},
    reverse legend=false,
    xticklabels from table={graphs/data/energy_gpu.data}{Model},
    xticklabel style={rotate=45}
]

\addplot [fill=white, postaction={pattern=horizontal lines}]
table[
    x expr = 0,
    y = extra,
    ]{graphs/data/energy_gpu.data};
\addlegendentry{\em W8A8}

\addplot [fill=white, postaction={pattern=crosshatch, pattern color=black, line width=0.4pt}]
table[
    x expr = 0,
    y = extra,
    ]{graphs/data/energy_gpu.data};
\addlegendentry{\em HALO(perf-opt)}

\addplot [fill=white, postaction={pattern=crosshatch dots, pattern color=black, line width=0.4pt}]
table[
    x expr = 0,
    y = extra,
    ]{graphs/data/energy_gpu.data};
\addlegendentry{\em HALO(acc-opt)}

\addplot [fill=white, postaction={pattern=north east lines, pattern color=black, line width=0.4pt}]
table[
    x expr = 0,
    y = extra,
    ]{graphs/data/energy_gpu.data};
\addlegendentry{\em HALO(bal)}

\end{axis}

\end{tikzpicture}