\begin{figure}[ht!]
    \centering
    \begin{tikzpicture}[node distance=1.5cm]
        % Phase 1: Network Construction
        \node (input) [startstop] {Input Data};
        \node (state) [process, below of=input] {State Space Analysis};
        \node (node) [process, below left=.8cm and -1.2cm of state] {Node Identification};
        \node (dep) [process, below right=.8cm and -1.2cm of state] {Dependency Mapping};
        \node (graph) [startstop, below=2.5cm of state] {Network Graph Generation};
        % Phase 2: Agent Assignment
        \node (task) [miniprocess, below left=1.5cm and -.5cm of graph] {Task-Specific Agents};
        \node (common) [miniprocess, below=1.5cm of graph] {Common Agents};
        \node (edge) [miniprocess, below right=1.5cm and -.5cm of graph] {Edge Agents};
        \node (plan) [startstop, below=3.2cm of graph] {Initial Plan Generation};
        % Phase 3: Validation & Refinement
        \node (validate) [process, below=1.5cm of plan] {Plan Validation};
        \node (decision) [decision, below=0.8cm of validate] {Valid Plan?};
        \node (refine) [process, left=0.7cm of decision, minimum width=1.8cm, minimum height=1.5cm, align=center] {Plan \\ Refinement};
        %\node (refine) [process, left=0.7cm of decision] {Plan Refinement};
        \node (final) [startstop, below=1.0cm of decision] {Final Plan};
        % Arrows for Phase 1
        \draw [arrow] (input) -- (state);
        \draw [arrow] (state) -- (node);
        \draw [arrow] (state) -- (dep);
        \draw [arrow] (node) -- (graph);
        \draw [arrow] (dep) -- (graph);
        % Arrows for Phase 2
        \draw [arrow] (graph) -- (task);
        \draw [arrow] (graph) -- (common);
        \draw [arrow] (graph) -- (edge);
        \draw [arrow] (task) -- (plan);
        \draw [arrow] (common) -- (plan);
        \draw [arrow] (edge) -- (plan);
        % Arrows for Phase 3
        \draw [arrow] (plan) -- (validate);
        \draw [arrow] (validate) -- (decision);
        \draw [arrow] (decision) -- node[anchor=west, above=0.2cm] {No} (refine);
        \draw [arrow] (refine) |- (validate);
        \draw [arrow] (decision) -- node[anchor=west] {Yes} (final);
        % Phase Labels
        \node [above=0.4cm of input, font=\bfseries] {\Large{Phase 1: Network Construction}};
        \node [above=0.4cm of common, fill=white, font=\bfseries] {\Large{Phase 2: Agent Assignment}};
        \node [above=0.5cm of validate, fill=white, font=\bfseries] {\Large{Phase 3: Validation \& Refinement}};
    \end{tikzpicture}
\caption{$\ALAS$ Planning Workflow. \textbf{Color Scheme:} \textcolor{cyan!50}{cyan} for input/output/intermediate results, \textcolor{orange!50}{orange} for processes, and \textcolor{red!50}{red} for decisions. This figure illustrates how the meta-planner generates a planning workflow for the Urban Ride Sharing problem solver to construct an optimal plan.}\Description{Plan Workflow}
    \label{fig:urs_workflow}
\end{figure}
