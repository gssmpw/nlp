% \algnewcommand{\ElseIIf}[1]{\algorithmicelse\ #1}

\begin{algorithm}[t]
\SetAlgoNoLine
\caption{Latent Shift Algorithm }
\begin{algorithmic}

\State $\triangleright$ Latent Shift graduate shifts the latent for denoising.

\State \textbf{Input:} 
\\ 
% - $\mathbf{c}({n})$: $n$ index prompts in over $N$ multiple text.

- $\mathbf{c}$: Denotes the input prompt condition.

\\
- $\Phi$: DDIM Sampler which can infer $f$ frame at once

\\
- $\{\mathbf{z}_{T}^{k}\}^{k=M}_{k=1}$: \text{Latents of $M = n * f$ frame videos at step $T$ }

\\
\State {\bf Hyper-parameters:} 
\\
- $\rho$: The factor of the shifting step


\\
 \State {\bf Output:} 
 \\
 - $\{\mathbf{z}_{0}^{k}\}^N_{k=1}$: \text{Final latent codes}

\\
\State $\triangleright$ Denoising loop when inference.  
\\
\For{$t = T, (T-1),..., 0 $}{
    \\
    \For{$n = 1, ..., N $}{

        \State $ o = (T - t) * \rho \mod f$ \ {\color{cyan}\textit { // get the shift step}}
        \\
        \uIf{$n = 1$ and $o \neq 0$ }{  {\color{cyan}\textit{ // corner case }} 
            \\
            \State $ \{\mathbf{x}_{t-1}^{k}\}_{k=1}^{k=f} = \Phi(\{\mathbf{z}_{t}^{k}\}_{k=1}^{k=f}, t, c )$ \;
            \State $ \{\mathbf{y}_{t-1}^{k}\}_{k=1+o}^{k=f+o} = \Phi(\{\mathbf{z}_{t}^{k}\}_{k=1+o}^{k=f+o}, t, c )$ \;
            \State $ \{\mathbf{z}^{k}_{t-1}\}_{k=1}^{k=f+o} = \{\mathbf{x}^{k}_{t-1}\}_{k=1}^{k=o}\cup\{\mathbf{y}^{k}_{t-1}\}_{k=1+o}^{k=f+o} $\;
            
        }
\uElseIf{$n = N$ and $o \neq 0$ }{ {\color{cyan}\textit{ // corner case }}
            \\
            \State $i = (N - 1) * f$\;
            \State $ \{\mathbf{x}_{t-1}^{k}\}_{k=i+1}^{k=i+f} = \Phi(\{\mathbf{z}_{t}^{k}\}_{k=i+1}^{k=i+f}, t, c)$ \;
            \State $ \{\mathbf{z}^{k}_{t-1}\}_{k=i+1+o}^{k=i+f} = \{\mathbf{x}^{k}_{t-1}\}_{k=i+1+o}^{k=i+f} $\;
        }
        \Else{
            \State $i = (n-1)*f+o$\;
            \State $ \{\mathbf{z}^{k}_{t-1}\}_{k=i+1}^{k=i + f} = \Phi(\{\mathbf{z}_{t}^{k}\}_{k=i+1}^{k=i + f}, t, c)$\;
        }
    }
}
\label{alg:attention_fusion}
\end{algorithmic}
\end{algorithm}


