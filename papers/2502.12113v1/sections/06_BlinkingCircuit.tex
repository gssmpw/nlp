\section{Blinking LED Circuit}
\label{sec:blinked_led_circuit}
%
\begin{figure*}
    \centering
    \includegraphics{media/Fig_CircuitDiagram.pdf}
    \caption{Circuit diagram of the complete blinking LED circuit. For simplicity we only show one LED driver circuit (area enclosed in dotted line), which is then replicated multiple times to drive multiple LEDs. The input voltage range for the power supply is $V_\text{DD}$ is \unit[8-35]{V}. The resistor and capacitor values $R_A$, $R_B$, and $C$ for the A-stable NE555 operation at different frequencies are given in Tab.~\ref{tab:resistor_capacitor_values}. For improved clarity the standard \unit[100]{nF} ceramic bypass capacitors to stabilize VCC for the NE555 and ADG802 have been omitted in the circuit diagram above.}
    \label{fig:circuit_diagram}
\end{figure*}
%
\subsection{Choice of LEDs}
\label{subsec:choice_of_leds}
For the accuracy of the event-based mocap system it is important that the center of the blinking LED can be detected easily by the event camera. To achieve this, the LED should be small, very bright and have a short switching time to produce a well-defined rising and falling edge. These requirements are ideally met by LEDs optimized for pulsed operation, such as infrared LEDs for data transmission.

In this work, the Osram SFH4350~\cite{osram4350} IR-LED \unit[3]{mm} was selected as it features an extremely short switching time of \unit[12]{ns}. Being designed for opto-electronics it also permits up to \unit[1]{A} pulsed forward-current for pulses shorter than \unit[100]{$\mu$s} if the duty cycle is below \unit[2]{\%}. The LED has its peak emission around \unit[850]{nm} with a spread of \unit[50]{nm} which is within the sensitivity of most CMOS-based imaging sensors.

\subsection{Circuit Design}
\label{subsec:circuit_design}

The design of the LED driver circuit is tightly coupled with the entire event-based motion capture system:
\begin{enumerate}
    \item Faster blinking frequencies increase the reactiveness of the system as at least one full period must be detected for identifying an LED. For robustness, a more conservative approach to detect at least two periods is better. Consequently, if the LEDs blink at \unit[1]{kHz} the overall system is limited to \unit[500]{Hz} output rate.
    \label{item:lower_limit}
    \item If the LEDs blink too fast, measuring the signal becomes difficult. Typically event cameras perform very well at measuring signals with frequencies up to \unit[2-3]{kHz}~\cite{wang2024towardshighspeed, crabtree2023refactoryperiod, lichtsteiner2008a128x128dvs} and the events are timestamped with \unit[1]{$\mu$s} time resolution.
    \label{item:upper_limit}
    \item At least four LEDs are neccessary to yield a unique solution to the PnP problem.
    \label{item:number_leds}
    \item the individual frequencies should not alias into each other. This means that, ideally, all LEDs have blinking frequencies within a factor of two.
    \label{item:aliasing}
    \item Due to the limitations of the LED a duty cycle of \unit[2]{\%} can not be exceeded.
    \label{item:duty}
\end{enumerate}

To control the blinking LED either a microcontroller or an analog circuit can be used. Because the high LED forward current of \unit[1]{A} necessitates an analog output stage, we opted for a fully analog design using NE555~\cite{ne555} precision timers. To generate the signal for the LEDs, the NE555 is operated in A-stable mode (c.f. Sec. 8.3.2~\cite{ne555}). 

The current output of the precision timer is limited to \unit[200]{mA}, but its performance significantly degrades if the output current exceeds \unit[10]{\%} of the maximum value (c.f. Figure 3 of~\cite{ne555}). Therefore an SPST (single pole, single throw) digital switch is used. We selected an ADG802 as it features close to \unit[1]{A} pulsed current and has typical switching times around \unit[55]{ns}~\cite{adg802}. While considerably slower than the LED, it is still fast enough for the given application.

\begin{table}[t]
    \centering
    \caption{\vspace*{6pt}\parbox{1\linewidth}{\textnormal{Resistor and capacitor values (see Fig.~\ref{fig:circuit_diagram}) for the different LEDs. The calculated periods as well as the measured frequencies $f$ and duty-cycles $\alpha$ are listed.}}}
    \vspace*{-6pt}
    \label{tab:resistor_capacitor_values}
    \input{tables/Tab_ResistorCapacitor}
\end{table}


The LEDs, precision timers and switches are all supplied with a single LM7805 voltage regulator. This is possible because the time-averaged load is well below the design limit of the voltage regulator. Each NE555 draws {$I_\text{NE555} = \unit[3]{mA}$} of supply current. The time averaged current $\bar{I}_\text{LED}$ for an LED pulsed with a duty cycle $\alpha = t_\text{on} / t_\text{period}$ with a pulse current {$I_p = \unit[1]{A}$} is given by
\begin{equation}
    \bar{I}_\text{LED} = \alpha \cdot I_p
\end{equation}
Assuming there is $N=5$ LEDs and they are operated at an average duty cycle of \unit[1]{\%} this leads to a total, time averaged current of 
\begin{equation}
    \bar{I} = N \cdot \left(\bar{I}_\text{LED} + I_\text{NE555} \right) = \unit[65]{mA}
\end{equation}
which is within specifications for an LM7805~\cite{lm7805} without any additional cooling (given the TO220 package and a \unit[12]{V} supply). Therefore, a sufficiently large decoupling capacitor $C_{DC}$ charged through $R_{DC}$ is used to supply the LEDs with power, effectively shielding the LM7805 from all current spikes caused by the LEDs. Based on all the above considerations, the circuit shown in Fig.~\ref{fig:circuit_diagram} has been designed and subsequently manufactured into a PCB with SMD version of the NE555 and the ADG802. The dotted line marks the components in the circuit that are replicated for each LED.

\begin{figure}
    \centering
    \input{media/Plots_LEDCurrent}
    \vspace*{-6pt}
    \caption{Current through an LED blinking at the lowest frequency of \unit[1.73]{kHz}. The upper plot shows the entire period $t = t_\text{on} + t_\text{off}$, whereas the lower plot shows only the pulse through where the LED is on for $\unit[3.8]{\mu s}$. From the plot, we get a switch-on time constant $\tau_\text{on}$ of the LED of \unit[84]{ns} (time to reach \unit[63]{\%} of the steady-state value).}
    \label{fig:led_current}
\end{figure}

The resistor and capacitor values used in the NE555 timer circuit are listed in Tab.~\ref{tab:resistor_capacitor_values}. The values have been calculated such that the frequencies of all 5 LEDs follow the points \ref{item:upper_limit} to \ref{item:duty}. After building and manufacturing of the PCB, the measured frequencies are also listed in Tab.~\ref{tab:resistor_capacitor_values}. Note that the mismatch w.r.t the calculated values is about \unit[20]{\%}. This mismatch is consistent across 5 identical copies of the board and of no concern for the practical applications as it is straightforward to measure the blinking frequency with an oscilloscope. Exemplarily, Fig.~\ref{fig:led_current} shows the current through one LED.


