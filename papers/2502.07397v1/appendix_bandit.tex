
\section{Technical contributions in Bandit Theory}\label{app: technical details} %might actually become redundant and end up in appendices

\subsection{Confidence sets and Regularised least-squares}\label{subsec: conf sets and RLS}

%Notice that, since $\fourier$ is a linear isometry on $L^2(\Rb^d,\Cb;\varrho)$ (\cref{thm: constantin fourier extension}), $\ffset:=\fourier\fset$ is also convex.

Recall that $R_t:=\langle c^*\vert \pi_t\rangle +\xi_i=\langle \fourier\reflection c^*\vert \fourier \pi_t\rangle_{L^2(\Rb^d;\varrho)} + \xi_t$ (by \cref{lemma: finiteness of IP}), in which by \cref{asmp: estimate + subG} we have ${(\xi_i)}_{i\in\Nb}$ a conditionally $\sigma$-sub-Gaussian sequence. Let $a_t:=\fourier\pi_t\in L^2(\Rb^d;\varrho)$ for $t\in\Nb$, and $\vec{a}_t:={(a_i)}_{i=1}^t$ and $\vec{R}_t:={(R_i)}_{i=1}^t$.

Let us begin by defining the regularised least-squares estimator of $c^*$. 
Let $J_\cdot[\cdot]:\Nb\x\ffset\to\Rb$ be the (random) functional defined by 
\[
    (t,f)\mapsto J_t[f]:= \sum_{s=1}^t\norm{R_s - \langle f\vert a_s\rangle_{L^2(\Rb^d;\varrho)}}^2_2 \,.
\]
Consider $\Lambda:L^2(\Rb^d;\varrho)\to\Rb$, a strongly convex and continuously Fréchet-differentiable functional whose Fréchet derivative, denoted $\De \Lambda$, satisfies
\begin{align}
    \frac1{M_\Lambda}\norm{f}_{L^2(\Rb^d;\varrho)}\le \De^2\Lambda[f] \le M_\Lambda \norm{f}_{L^2(\Rb^d;\varrho)} \quad\mbox{for any}\quad f\in L^2(\Rb^d;\varrho)\label{eq: Fréchet derivative of Lambda}
\end{align} 
for some $M_\Lambda>0$, e.g.\ $\Lambda=\frac12\norm{\cdot}_{L^2(\Rb^d;\varrho)}^2$ with $M_\Lambda=1$. Let us recall that the Fréchet derivative of a strongly convex Fréchet-differentiable functional is a (strongly) positive-definite operator denoted $\De \Lambda$.
It is clear that $J_t+\lambda\Lambda$ is a strongly convex functional for any $\lambda>0$ and $t\in\Nb^*$ as $\ffset$ is convex. Therefore, we can define the $\Lambda$-regularised least-squares estimator of $c^*$ to be
\[
    \hat f_\lambda:=\argmin_{f\in L^2(\Rb^d;\varrho)} J_t[f]+ \lambda\Lambda[f]\,.
\]
\begin{proposition}\label{prop: least squares estimator}
    Assume \cref{asmp: L2 case}, then for any $\lambda>0$, and $t\in\Nb^*$, we have 
    \begin{align}
        \hat f_t^\lambda = {(M_t^*M_t+\lambda\De \Lambda)}^{-1} M^*_t \vec{R}_t\,,\label{eq: reg least squares estimator}
    \end{align}
    in which, for every $t\in\Nb^*$, $M_t:L^2(\Rb^d;\varrho)\to \Rb^{t}$ is the linear a.s.\ bounded operator defined by 
    \begin{align}
        M_t: f\in L^2(\Rb^d;\varrho) \mapsto {(\langle f\vert a_t \rangle_{L^2(\Rb^d;\varrho)})}_{i=1}^t\in\Rb^t  \,,
    \end{align}
    and $M^*_t:\Rb^t\to L^2(\Rb^d;\varrho)$ is its adjoint, defined by
    \begin{align}
        M^*_t: v\in\Rb^t\mapsto \sum_{s=1}^t v_s a_s \in L^2(\Rb^d;\varrho) \quad \mbox{ for any } v\in\Rb_t\,.
    \end{align}
\end{proposition}

\begin{proof}
    This proof extends the standard arguments for finite-dimensional least-squares, we include it for completeness focusing on the differences owing to infinite dimensions, cf.\ e.g.\ \citep[\S~3.2]{abbasi-yadkori_online_2012}. One first computes the Fréchet derivative of $J_t$, by studying a variation $\delta f\in L^2(\Rb^d;\varrho)$ and
    \[
    J_t[f+\delta f] - J_t[f]\,.
    \]
    One sees that the Fréchet derivative of $J_t$ exists for all $t$ and is given by 
    \[
        f\mapsto \sum_{s=1}^t\langle f\vert a_s\rangle_{L^2(\Rb^d;\varrho)}a_s- R_s a_s +\lambda\De\Lambda f= (M^*_t M_t+\lambda\De\Lambda)f -M^*_t\vec{R}_t\,.
    \]
    Note that the right-hand side is easily checked by expanding the definition of $M_t$ and $M^*_t$, and in doing so one easily checks that $M^*_t$ is indeed the adjoint of $M_t$. Carrying on, by first order optimality, the normal equations are 
    \[
        (M^*_t M_t+ \lambda\De\Lambda)\hat f_\lambda = M^*_t \vec{R}_t\,.
    \]
    Since $M^*_t M_t$ is positive semi-definite and $\De\Lambda$ is positive definite,~\eqref{eq: reg least squares estimator} follows. 
\end{proof}

Let $\design_t:=M^*_t M_t$ and $\designl_t:=\design_t+\lambda\De\Lambda$ denote the design and regularised design operators at time $t\in\Nb$. Let
    \begin{align}
        \event_t(\delta):=\left\{\hspace{-1pt}\norm{\hat f_t^\lambda - \fourier c^*}_{\designl_t}\hspace{-1pt}\le \sigma\sqrt{\log\hspace{-3pt}\left(\frac{4\det(\De\Lambda+\lambda^{-1}M_t M^*_t)}{\delta^2}\right)} +{\left(\frac{\lambda}{\norm{\De\Lambda}_{\op}}\right)}^{\hspace{-2pt}\frac12}\hspace{-5pt}\norm{\fourier c^*}_{L^2(\Rb^d;\varrho)}\right\}.\label{eq: event def}
    \end{align}
for $t\in\Nb$.

\begin{lemma}[{\cite[Cor.~3.6]{abbasi-yadkori_online_2012}}]\label{lemma: probability of confsets unif in N}
    For every $\delta\in(0,1)$, $\lambda>0$, under \cref{asmp: L2 case,asmp: estimate + subG} we have 
    \[  \Pb\left(c^*\in \bigcap_{t\in\Nb}\fourier^{-1}\confset_t(\delta)\right)\ge\Pb\left(\bigcap_{t\in\Nb} \event_t(\delta/2)\right)\ge 1-\frac\delta2 \,.\]
\end{lemma}

\begin{proof}
    Recall that $\fourier$ is an isometry on $L^2(\Rb^d;\varrho)$, and so is $\fourier^{-1}$, so $\fourier^{-1}\confset_t$ is a confidence set for $c^*$ in $L^2(\Rb^d;\varrho)$, and it is a ball of identical radius $\width_t(\delta)$ centred at $\fourier^{-1} \hat f_t^\lambda$. 
    A direct combination of \cref{asmp: estimate + subG},~\eqref{eq: event def}, and~\cite[Cor.~3.6]{abbasi-yadkori_online_2012} yields 
    \[
        \Pb\left(\bigcap_{t\in\Nb} \event_t(\delta/2)\right)\ge 1-\frac\delta2\,.
    \]
    The second results follow by comparison of~\eqref{eq: event def} and~\eqref{eq: confidence set width def}.
\end{proof}



\begin{lemma}\label{lemma: bound on width term}
    Under \cref{asmp: L2 case,asmp: estimate + subG}, on the event $\{c^*\in \cap_{t\in\Nb}\fourier^{-1}\confset_t(\delta)\}$, for any $T\in\Nb$ and ${(c_t)}_{t=1}^T$ with $c_t\in\fourier^{-1}\confset_t(\delta)$ for $t\in[T]$, we have
    \[
        \sum_{t=1}^T\langle c^* - c_t\vert \tilde\pi_t\rangle \le 2\ubnorm\width_T(\delta)\sqrt{T\log\det\left(\Id + \frac{1}{2\lambda\ubnorm}M_t{(\De\Lambda)}^{-1}M_t^*\right)}
    \]
\end{lemma}
\begin{proof}
    Consider $t\ge 0$, $c_t\in\confset_t(\delta)$, and let $\varphi_t:=\langle c^* - c_t\vert \tilde\pi_i\rangle$. Recall that $a_t:=\fourier\pi_t$. By \cref{lemma: probability of confsets unif in N} and the Cauchy-Schwartz inequality, on the event $\{c^*\in \cap_{t\in\Nb}\fourier^{-1}\confset_t(\delta)\}$, we have 
    \begin{align*}
        \abs{\varphi_t} \le \width_t(\delta)\norm{a_t}_{{(\designl_t)}^{-1}}\,,
    \end{align*}
    while, by the Cauchy-Schwartz inequality, \cref{asmp: L2 case}, and using the fact that $\fourier$ is an isometry on $L^2(\Rb^d;\varrho)$, we have 
    \begin{align*}
        \abs{\varphi_t} &\le \norm{\fourier\reflection c^* - \fourier\reflection c}_{L^2(\Rb^d;\varrho)}\norm{a_t}_{L^2(\Rb^d;\varrho)}= \norm{c^*-c}_{L^2(\Rb^d;\varrho)}\pi_t(\Rb^d)\le 2\ubnorm\,.
    \end{align*}
    Combining yields
    \begin{align*}
        \abs{\varphi_t}\le \width_t(\delta)\min\{\norm{a_t}_{{(\designl_t)}^{-1}},2\ubnorm\}=2\ubnorm\width_t(\delta)\left(\frac{1}{2\ubnorm}\norm{a_t}_{{(\designl_t)}^{-1}}\wedge 1 \right) \,.
    \end{align*}
    Squaring and applying the inequality $u\le 2\log(1+u)$, which holds on $[0,1]$, to the final term, yields
    \begin{align*}
        \abs{\varphi_t}^2\le 8\ubnorm^2{\width_t(\delta)}^2\log\left(1+ \frac{1}{2\ubnorm}\norm{a_t}_{{(\designl_t)}^{-1}} \right)
    \end{align*}
    and, summing up,
    \begin{align}
        \sum_{t=1}^T \varphi_t\le \sqrt{T\sum_{t=1}^T \abs{\varphi_t}^2}\le 2\ubnorm\width_t(\delta)\sqrt{T\sum_{t=1}^T \log\left(1+ \frac{1}{2\ubnorm}\norm{a_t}_{{(\designl_t)}^{-1}}\right)} \label{eq: summation of widths in proof of the bound on width term lemma}\,.
    \end{align}
    % On the one hand, by \cref{lemma: bound on size of actions}, we have
    % \[ 
    %     \varphi^2\le 4\ubnorm^2\width_t(\delta)^2\log\left(1+\frac{1}{2\ubnorm\lambda M_\Lambda}\right)\,
    % \]
    % so that 
    % \begin{align}
    %     \sum_{t=1}^n \varphi_t\le \sqrt{n\sum_{t=1}^n \varphi_t^2}\le 2\ubnorm\width_t(\delta)\sqrt{n\sum_{t=1}^n\log\left(1+\frac{1}{2\ubnorm\lambda M_\Lambda}\right)} 
    % \end{align}
    By definition of $M_T$ and $\designl_T$, we have
    \begin{align}
        \sum_{t=1}^T \log\left(1+ \frac{1}{2\ubnorm}\norm{a_t}_{{(\design_t^\lambda)}^{-1}}\right)=\log\left(\prod_{t=1}^T \left(1+ \frac{1}{2\ubnorm}\norm{a_t}_{{(\design_t^\lambda)}^{-1}}\right)\right)\notag\\
        =\log\det\left(\Id + \frac{1}{2\lambda\ubnorm}M_T{(\De\Lambda)}^{-1}M_T^*\right)\,\label{eq: sum of log is logdet}
    \end{align}
    as wanted.
\end{proof}

% \begin{lemma}\label{lemma: bound on action sizes}
%     Under \cref{asmp: L2 case}, for any $n\in\Nb$, we have
%     \begin{align*}
%         \sum_{t=1}^n \norm{\fourier \pi_t}_{(\designl_t)^{-1}}\wedge 1 \le \min\left\{2\log\det \left(\Id + \lambda^{-1} M_t\De\Lambda^{-1} M_t^*\right), 2\log(1+(\lambda M_\Lambda)^{-\frac12})\right\}\,.
%     \end{align*}
% \end{lemma}
% \begin{proof}
%     The first term of the minimum is the well known \cite[Lemma~E.2]{abbasi-abbasi-yadkori_online_2012}, which relies on the fact that $u\le 2\log(1+u)$ on $[0,1]$ implying
%     \[ 
%         \sum_{i=1}^n \norm{\fourier \pi_i}_{(\designl_t)^{-1}}\wedge 1 \le2\log\left(1+\norm{\fourier \pi_i}_{(\designl_t)^{-1}}\right)\,.
%     \]
%     Going from this same equation in another direction, namely taking \cref{lemma: bound on size of actions} into account, we have
%     \[
%         \norm{\fourier \pi_i}_{(\designl_t)^{-1}}\le \frac1{\lambda M_\Lambda}\norm{\fourier\pi_i}_\infty=\frac1{\sqrt{\lambda M_\Lambda}}\,
%     \]
%     which readily yields the second term.
% \end{proof}



% \begin{lemma}\label{lemma: bound on size of actions}
%     Under \cref{asmp: L2 case},
%     \[
%         \norm{a_t}_{(\designl_t)^{-1}} \le \frac1{\sqrt{\lambda M_\Lambda}} \quad\mbox{ for }t\in\Nb\,.
%     \]
% \end{lemma}
% \begin{proof}
%     Let $\varrho\in\measures(\Rb^d)$ be an arbitrary finite Borel measure with $\varrho(\state)=1$. Let us first observe that $\designl_t:=M^*_tM_t+\lambda\De\Lambda$ is positive definite, with 
%     \[ 
%         \langle \designl_tf\vert f\rangle_{\varrho}= \sum_{i=1}^t\langle f\vert a_i\rangle^2_\varrho + \lambda\norm{\De\Lambda f}_{\varrho}^2\ge \lambda M_\Lambda \norm{f}_{\varrho}^2\,.
%     \]
%     Thus, 
%     \[ 
%         \inf\left\{\norm{\designl_tf}_\varrho : f\in L^2(\Rb^d,\Rb;\varrho),\, \norm{f}_\varrho=1\right\} \ge \sqrt{\lambda M_\Lambda} >0
%     \]
%     and $\norm{(\designl_t)^{-1}}_{\op,\varrho}\le (\lambda M_\Lambda)^{-1/2}$, in which $\norm{\cdot}_{\op,\varrho}$ denotes the operator norm induced by $\norm{\cdot}_\varrho$. 
%     One obtains the bound by recalling that $\norm{a_t}_\infty=\pi_t(\state)=1$ and using $\norm{a_t}_{(\designl_t)^{-1}}\le \norm{(\designl_t)^{-1}}_{\op,\varrho}\norm{a_t}_\infty\varrho(\state)$. 
% \end{proof}
