
\documentclass[11pt]{article}

\usepackage{amscd,amsfonts,amsmath,amssymb,amsthm}
\usepackage[left=30mm,right=30mm, top=3cm, bottom=3cm]{geometry}
\usepackage[math]{iwona}
\usepackage[T1]{fontenc}
\usepackage[toc,page]{appendix}
\usepackage{array}
\usepackage[english]{babel}
\usepackage{mathtools}

\usepackage[english]{babel}
% Ours
\usepackage{mathtools}
\usepackage{xspace}
\usepackage{booktabs}
\usepackage{subcaption}
\usepackage{amsthm}

\usepackage{multicol}
\usepackage[utf8]{inputenc} % allow utf-8 input
\usepackage[T1]{fontenc}    % use 8-bit T1 fonts
\usepackage[hidelinks]{hyperref}       % hyperlinks
\usepackage{url}            % simple URL typesetting
\usepackage{booktabs}       % professional-quality tables
\usepackage{amsfonts}       % blackboard math symbols
\usepackage{nicefrac}       % compact symbols for 1/2, etc.
\usepackage{microtype}      % microtypography
\usepackage{cleveref}       % smart cross-referencing
\usepackage{graphicx}
\usepackage{doi}
\usepackage{float}
\usepackage{xcolor}
\usepackage{hyperref}

\usepackage{bigstrut} 
\usepackage{bbold}
\usepackage{calc}
\usepackage{caption}
\usepackage{color}
\usepackage{colortbl}
\usepackage{csquotes}
\usepackage{dsfont}
\usepackage{enumerate}
\usepackage{enumitem}
\usepackage{epsfig}
\usepackage{esint}
\usepackage{hyperref}
\usepackage{etoolbox}
\usepackage{float}
\usepackage{graphpap}
\usepackage{graphics}
\usepackage{graphicx}
\usepackage{latexsym}
\usepackage{lipsum}
\usepackage{lmodern}
\usepackage{marginnote}
\usepackage{mathrsfs}
\usepackage{mathtools}
\usepackage{mathabx}        
\usepackage{multirow}
\usepackage{pdfpages}
\usepackage{pgfplots}
\usepackage{pxfonts}
\usepackage{rotating}
\usepackage{subcaption}
\usepackage{tabularx,booktabs}
\newcolumntype{Y}{>{\centering\arraybackslash}X}
\usepackage{tikz}
\usetikzlibrary{shapes}
\usetikzlibrary{shapes.misc}



% To include the section number in the equation numbering:
\numberwithin{equation}{section}

%\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
%\theoremstyle{definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{definition}[theorem]{Definition}


% New commands
\input{definitions.tex}
\title{A hybrid minimizing movement and  neural network approach to Willmore flow}

%\headers{A hybrid minimizing movement and  neural network approach to Willmore flow}{M. Rumpf, J. Sassen, and C. Smoch}

\author{
	Martin Rumpf \thanks{Institute for Numerical Simulation, University of Bonn, Endenicher Allee 60, 53115 Bonn, Germany
				(\href{mailto:martin.rumpf@uni-bonn.de}{martin.rumpf@uni-bonn.de}, \href{mailto:christoph.smoch@ins.uni-bonn.de}{christoph.smoch@ins.uni-bonn.de} ).}
	\and 
	Josua Sassen\thanks{Centre Borelli, ENS Paris-Saclay, 4 Avenue des Sciences, 91190 Gif-sur-Yvette, France
				(\href{mailto:josua.sassen@ens-paris-saclay.fr}{josua.sassen@ens-paris-saclay.fr}).}
	\and
	Christoph Smoch\footnotemark[1]
%	\thanks{Institute for Numerical Simulation, University of Bonn, Endenicher Allee 60, 53115 Bonn, Germany
%		(\email{martin.rumpf@uni-bonn.de}, \email{christoph.smoch@ins.uni-bonn.de} ).}
%	
%	\and Josua Sassen\thanks{Centre Borelli, ENS Paris-Saclay, 4 Avenue des Sciences, 91190 Gif-sur-Yvette, France
%		(\email{josua.sassen@ens-paris-saclay.fr}).}
%	\and Christoph Smoch\footnotemark[1]
}
\begin{document}
\maketitle
\begin{abstract}
We present a hybrid method combining a minimizing movement scheme with neural operators for the simulation of phase field-based Willmore flow.
The minimizing movement component is based on a standard optimization problem on a regular grid whereas the functional to be minimized involves a neural approximation of mean curvature flow proposed by Bretin \etal \cite{BrDeMa22}.
Numerical experiments confirm stability for large time step sizes, consistency and significantly reduced computational cost compared to a traditional finite element method. 
Moreover, applications demonstrate its effectiveness in surface fairing and reconstructing of damaged shapes. 
Thus, the approach offers a robust and efficient tool for geometry processing.
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
\label{sec:introduction}

%% willmore flow
% general introduction
%In this paper we present a hybrid method for Willmore flow. 
Willmore flow is the $L^2$-gradient flow of the Willmore energy, which is defined as the surface integral over the squared mean curvature.  
For closed surfaces of genus zero, the Willmore energy allows to quantify how much a surface deviates from being a perfect sphere, with a round sphere having minimal Willmore energy.
Physically, the Willmore energy reflects an approximation of the stored energy in a thin elastic shell with a planar physical reference configuration \cite{Ci00}.
It is also used to model the behavior of cell membranes, which have tendency to minimize their bending.
To this end, an extension of the Willmore energy, the Helfrich model, is used to describe elastic cell membranes in biology \cite{CaArMa14}. %\MR{new references missing}
Furthermore, in computer graphics and geometry processing, Willmore flow is used for surface smoothing \cite{CrPiSc13}, and surface restoration \cite{ClDiDz04,LeCh23}. %\MR{new references missing}
This motivates the study of Willmore flow, and in particular the development of numerical schemes.

However, as we will discuss below, Willmore flow is described by a fourth-order PDE, which makes it challenging to devise schemes that stably allow for large time steps and are computationally efficient.
We will show that our proposed hybrid scheme is stable for large time steps and indeed leads to an efficient scheme for Willmore flow in case of a phase field formulation, which is in particular practical for applications with implicitly described geometries.
To compute Willmore flow, we will consider a minimizing movement time discretization.
Therein, we combine a discretization of the minimizing movement scheme on a regular grid with a neural network approximation of the mean curvature arising in the Willmore energy.

% parametric formulation
This paper deals with phase field models approximating hypersurfaces \(\Gamma\) in the computational domain \(\Omega=(0,1)^d\) and their evolution by Willmore flow.
To motivate the hybrid method, we first recall the parametric formulation of Willmore flow.
We denote by \(\param \colon \Gamma \to \Gamma\) the identity restricted to the surface \(\Gamma\).
Then the \emph{Willmore energy} of $\Gamma$ is given by
\begin{equation}
    w[\param] \coloneqq \frac{1}{2} \int_\Gamma\mc^2(\param) \d \Hd^{d-1},
\end{equation}
where \(\mc\) is the mean curvature. 
%of the image of \(\Gamma\) under \(\param\) (which is for \(\param\) being the identity, of course, \(\Gamma\) itself).
The \emph{Willmore flow} for parametrizations is then the \(L^2\)-gradient flow of this energy, \ie the evolution \(\param \colon [0, T] \times \Gamma \to \Omega\) that fulfills 
\begin{equation}
    (\partial_t \param, \vartheta)_{L^2(\Gamma)} = -\partial_\param w[\param](\vartheta) 
\end{equation}
for all test functions \(\vartheta \in C^{\infty}(\Gamma, \R^d)\), where \((\cdot,\cdot)_{L^2(\Gamma)}\) denotes the \(L^2\)-scalar product on the hypersurface \(\Gamma\) and \(\partial_\param w[\param](\vartheta) \) the variation of the Willmore energy in direction \(\vartheta\).

% analysis of Willmore flow and Willmore surfaces
Willmore surfaces, \ie minimizers of the Willmore energy, and Willmore flow have been the subject of intense theoretical study.
Simonett proved in \cite{Si01} the existence of a unique and locally smooth solution of Willmore flow for sufficiently smooth initial surfaces as well as exponential convergence to a sphere for initial surfaces close to a sphere.
Similarly, Dall'Acqua \etal~\cite{DaMuSc23} proved that if the initial datum is a torus of revolution with Willmore energy less than \(8 \pi\) then the Willmore flow converges to the Clifford Torus.
%Polden~\cite{Po95,Po96} analytically investigated Willmore flow of curves and surfaces already in 1996.
Kuwert and Sch\"atzle treated long time existence and regularity of solutions in co-dimension one in \cite{KuSc01,KuSc02c,KuSc04} and Rivi\`ere~\cite{Ri08} extended these results to arbitrary co-dimension.
In 2014, Marques and Neves~\cite{MaNe14} were able to prove the famous Willmore conjecture, \ie that for every smooth immersed torus in \(\R^3\) the Willmore energy is lower bounded by \(2\pi^2\).

%Numerics
Similarly, also the numerical treatment of Willmore flow for surfaces has garnered significant attention.
%Dziuk \etal \cite{DzKuSc02} investigated the long-time existence of Willmore flow of curves and introduced a corresponding numerical algorithm.
Rusu~\cite{Ru01} introduced a semi-implicit finite element scheme for the computation of the parametric Willmore flow of surfaces, which was applied by Clarenz \etal \cite{ClDiDz04} to surface restoration problems.
Droske and Rumpf \cite{DrRu04} introduced a level set formulation for Willmore flow and corresponding numerical scheme. 
Deckelnick and Dziuk provided in \cite{DeDz06} a-priori error estimates for a spatially discretized but time-continuous finite element scheme on two-dimensional graphs. 
%Furthermore, in \cite{DeDz09}, they introduced a similar semi-discrete scheme and error analysis for the case of curves.
%In \cite{DeSc09}, Deckelnick and Schieweck proved the convergence of a conforming finite element approximation in case of axially symmetric surfaces. 
Alternative finite element schemes for parametric Willmore flow were introduced by Barrett \etal \cite{BaGaNu07} and Dziuk \cite{Dz08}.
In contrast, Bobenko and Schr\"oder \cite{BoSc05} introduced a discrete Willmore energy and flow based on discrete differential geometry.
Concerning phase field models, Du \etal introduced and analyzed a discrete semi-implicit scheme for Willmore flow in 
\cite{DuLiWa04, 
%DuLiWa06, 
DuWa07}.
In \cite{BrMaOu15}, Bretin \etal investigated flows for various diffuse approximations of the Willmore energy and its relaxations and introduced corresponding numerical schemes.
If the goal is to minimize Willmore energy, one can also consider gradient flows with respect to other metrics. 
For example, Schumacher \cite{Sc17} analyzed \(H^2\)-gradient flows for the Willmore energy with numerical experiments on triangle meshes. 
% while Perl \cite{Pe16} provided a numerical scheme based on subdivision surfaces.
Soliman \etal \cite{SoChDi21} extended this idea on triangle meshes to incorporate further constraints -- most notably on the conformal class of the surface. 
However, in this paper, the goal is not to minimize the Willmore \emph{energy} but to efficiently simulate Willmore \emph{flow}, \ie the \(L^2\)-gradient flow of the Willmore energy.

To this end,  we will consider a \emph{variational time-discretization} of Willmore flow based on the minimizing movements paradigm \cite{De93,AmGiSa08}. 
In case of parametric Willmore flow and time step size \(\tau > 0\), given a parametrization \(\param^k \colon \Gamma \to \Omega\) approximating the evolution at time \(k\tau\) , the next time step \(\param^{k+1}\) is given as the minimizer of 
\begin{equation}
    \label{eq:variational_willmore_step}
    e[x^k, x] \coloneqq \lVert x - x^k \rVert_{L^2(\Gamma^k)}^2 + 2\tau\, w[\param].
\end{equation}
% approximation via MCF
To obtain a fully implicit, variational formulation of Willmore flow that is (experimentally) unconditionally stable and allows for large step sizes, Balzani and Rumpf \cite{BaRu13} proposed to approximate the Willmore functional \(w[\param]\) in \autoref{eq:variational_willmore_step} using an approximate mean curvature.
To this end, one denotes by \(y_{\tilde\tau}[\param] \colon \Gamma \to \Omega\) the solution of one discrete time step of mean curvature flow with time step size \(\tilde\tau\) starting from the initial parametrization \(\param\) corresponding to the surface $\Gamma$. 
By definition, the mean curvature \(\mc\) is the normal velocity of mean curvature flow. 
Hence, \(\frac12 \int_\Gamma \frac{\vert y_{\tilde \tau}[x]-x\vert^2}{\tilde \tau^2} \d \Hd^{d-1}\) constitutes a difference quotient approximation of the Willmore energy \(w[\param]\) and a minimizing movement functional is given as
\begin{equation}
    \label{eq:nested_willmore_step}
    e[x^k, x] \coloneqq \Vert x - x^k \Vert_{L^2(\Gamma^k)}^2 + \tau \int_\Gamma \frac{\vert y_{\tilde \tau}[x]-x\vert^2}{\tilde \tau^2} \d \Hd^{d-1}.
\end{equation}
As discrete solution for mean curvature motion, one might consider the time step of a semi-discrete backward Euler scheme with time step $\tilde \tau$ as proposed by Dziuk \cite{Dz91}. 
Thus, minimizing the energy  $e[x^k, x]$ in $x$ amounts to solving a nested time discretization with time discrete mean curvature motion as the inner and the actual time discrete Willmore flow as the outer problem,
It can also be understood as a PDE-constrained optimization problem, where one optimizes the energy \autoref{eq:nested_willmore_step} subject to the constraint that $y_{\tilde \tau}[x]$ is the solution of the linear discrete semi-implicit backward Euler scheme for mean curvature motion. 

%%%%%%%% phase field
In this work, we pick up the approach proposed by Franken \etal \cite{FrRuWi11} and focus on the corresponding scheme for phase fields.
Our core idea is to construct a hybrid scheme where the inner problem is solved using a neural network, whereas the outer problem remains a classical minimizing movement optimization scheme. 
For the inner problem, we will build on recent work by Bretin \etal \cite{BrDeMa22} on neural operators for time discrete mean curvature flow in a phase field formulation.
These neural operators are efficient to evaluate, straightforward to differentiate, and convergent under spatial refinement in numerical experiments. 
By using them in the variational time-discretization, we obtain a numerical scheme for the phase-field approximation of Willmore flow that is stable for large time steps and still computationally efficient.

%%%%%%%% organization 
The remainder of the paper is organized as follows. 
In \autoref{sec:method}, we recapitulate the adaption of the variational time-discretization to phase fields from \cite{FrRuWi11} and introduce a neural operator approximation of mean curvature flow for phase fields inspired by \cite{BrDeMa22}. 
We combine both to obtain the spatially discrete hybrid scheme for Willmore flow in \autoref{sec:discretization}.
In \autoref{sec:experiments}, we first experimentally validate the convergence properties of the neural network based discrete mean curvature flow to then underpin a corresponding validation of our hybrid Willmore flow scheme.  
Furthermore, we use our hybrid scheme to compute the evolution for different interesting initial curves in 2D and surfaces in 3D. 
Afterwards, in \autoref{sec:applications}, we apply the scheme for curve and surface restoration. 
Finally, in \autoref{sec:conclusions}, we briefly draw conclusions.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Synthesis of the time discrete Willmore flow}
\label{sec:method}
Our scheme has two essential ingredients: 
a {\it phase field based minimizing movement scheme for Willmore flow} as introduced by Franken \etal \cite{FrRuWi11}, and a {\it convolution based approximation of mean curvature}. 
Below, we will first discuss the relevant parts of the former, then detail the latter and describe how both are combined for the purpose of an robust and efficient approximation of Willmore flow.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% phase field approximation 
\paragraph{Phase field based minimizing movement scheme for Willmore flow.} 
Following Franken \etal \cite{FrRuWi11} we assume that hypersurfaces under consideration are represented by Modica--Mortola-type phase field functions \cite{MoMo77} % in $L^2(\Omega)$ 
with periodic boundary conditions.
In what follows, we assume that all functions and interfaces are sufficiently smooth.
We consider the interfacial energy
\begin{equation} \label{eq:aeps}
    \Per^\eps[v] \coloneqq \frac{1}{2} \int_\Omega \eps \lvert \nabla v \rvert^2 + \frac{1}{\eps} \Psi(v) \d x
\end{equation}
with the double well potential \(\Psi(v) = \frac{9}{16}(1 - v^2)^2\). 
Modica and Mortola \cite{MoMo77} showed that the \(\Gamma\)-limit of \(\Per^\eps[\cdot]\) in the \(L^1\) topology is half the total variation of a function \(u\in BV(\Omega;\{-1,1\})\) in \(\Omega\), \ie the perimeter of the set \(\{u=1\}\).

phase field functions minimizing \eqref{eq:aeps} follow an optimal profile in normal direction across the interface, which is \(\tilde v_\eps \colon \R \to \R; \, s \mapsto \tanh(- \frac{3s}{4\eps})\).
Thus, \(\tanh \left(- \frac{3}{4\eps} \sdist(y, \omega) \right)\) is the 
optimal phase field profile of an interface \(\Gamma  = \partial \omega \cap \Omega\) 
for fixed \(\eps\), 
where the signed distance function of $\Gamma$ is defined as 
\(\sdist(x,\omega) = \dist(x,\omega) - \dist(x, \omega^c)\) with 
$\omega^c$ being the complement of $\omega$.
Now, let \(u^k_\eps\) denote the phase field representations of the hypersurface \(\Gamma^k\)
with parametrization \(x^k\), which is the boundary of a subset \(\omega^k \subset \Omega\), \ie \(\Gamma^k = \partial \omega^k \cap \Omega\).
Similarly, let \(u_\eps\) is the representation of  \(\Gamma = \partial \omega \cap \Omega\) with parametrization \(x\), 
and \(v_{\tilde \tau}[u_\eps]\) a phasefield representation of the image of \(\Gamma\) 
under timestep of mean curvature flow with step size $\tilde \tau$ and initial data $u_\eps$. 

To translate \eqref{eq:nested_willmore_step} to the phase field context, one observes
for a shift \(\delta\) of the optimal profile $\tilde v_\eps$ in one dimension
%\begin{align*}
%\eps  \int_\R &\left(\tilde v_\eps(t)-\tilde v_\eps(t-\delta)\right)^2 \d t \leq \frac{4}{3} \delta^2 (1 + \Theta(\delta, \eps))\,,
%\end{align*}
\begin{align*}
\eps  \int_\R &\left(\tilde v_\eps(s)-\tilde v_\eps(s-\delta)\right)^2 \d s = \delta^2 (1 + \Theta(\delta, \eps))\,,
\end{align*}
where \(\Theta(\delta, \eps) = C \left( \frac{\delta}{\eps} + \frac{\delta^2}{\eps^2} \right)\). 
A detailed calculation is given in \cite{FrRuWi11}.
Chosing \(\delta = \eps^\beta\) with \(\beta>1\) implies \(\Theta(\delta, \eps) \leq C \delta^{(1-\frac1\beta)}\) and thus
\begin{align*}
    \eps \int_\Omega \left( u_\eps(x+\delta(x) n(x))- u_\eps(x)\right)^2 \d x &=
      \int_\Gamma \delta^2(x) \Hd^{d-1} \left(1+ O(\Theta(\lVert\delta\rVert_{\infty}, \eps))\right)\,,
\end{align*}
where now \(\delta\) is some function on \(\Gamma\), \(n\) is the normal field of \(\Gamma\) and \(\delta\) is assumed to be extended constantly in normal direction to \(\Gamma\). 
Next, assuming that all involved phase field functions \(u^k\), \(u\), and \(v_{\tilde \tau}[u]\) follow the optimal profile, one observes that
%\begin{align*}
%    \eps \lVert v_{\tilde \tau}[u] - u \rVert_{L^2(\Omega)}^2 &= \frac{4}{3} \lVert y_{\tilde \tau}[x] - x\rVert_{L^2(\Gamma)}^2 \left(1 + O(\Theta(\lVert y_{\tilde \tau}[x] - x\rVert_{L^\infty(\Gamma)}, \eps))\right)\,, \\
%    \eps \lVert u - u^k \rVert_{L^2(\Omega)}^2 &= \frac{4}{3}  \lVert x - x^k \rVert_{L^2(\Gamma^k)}^2 \left(1 + O(\Theta(\lVert x-x^k\rVert_{L^\infty(\Gamma^k)}, \eps))\right)
%\end{align*}
\begin{align*}
\eps \lVert v_{\tilde \tau}[u] - u \rVert_{L^2(\Omega)}^2 &=  \lVert y_{\tilde \tau}[x] - x\rVert_{L^2(\Gamma)}^2 \left(1 + O(\Theta(\lVert y_{\tilde \tau}[x] - x\rVert_{L^\infty(\Gamma)}, \eps))\right), \\
\eps \lVert u - u^k \rVert_{L^2(\Omega)}^2 &=  \lVert x - x^k \rVert_{L^2(\Gamma^k)}^2 \left(1 + O(\Theta(\lVert x-x^k\rVert_{L^\infty(\Gamma^k)}, \eps))\right).
\end{align*}
The above estimates were presented in \cite{FrRuWi11} using the double well function $\Psi(v) = (1 - v^2)^2$ and thus consistently with an additional factor $\tfrac43$ (and optimal profile $\tilde v_\eps(s) = \tanh(-s\eps^{-1})$).

Finally, with these approximations at hand, 
one can define the energy 
\begin{equation}
    \label{eq:discrete_willmore_flow_energy}
    e^\eps[u^k,u] =  \eps\lVert u - u^k \rVert_{L^2(\Omega)}^2+\frac{\tau\eps}{\tilde\tau^2} \lVert v_{\tilde \tau}[u] - u \rVert_{L^2(\Omega)}^2
\end{equation}
for two functions $u^k$ and $u$ considered as phase field descriptions of $\Gamma^k$ and $\Gamma$.
By our above estimates this energy is equivalent to the energy \(e[\cdot]\) associated with the variational time-discretization in \autoref{eq:nested_willmore_step}.

Altogether for sufficiently small phase field parameter \(\eps\) and sufficiently small time step sizes \(\tau\), \(\tilde \tau\) this leads to the following nested variational time discretization of Willmore flow:
\begin{definition}[Variational time discretization of Willmore flow \cite{FrRuWi11}]\label{def:minProblem}
For $e^\eps[\cdot,\cdot]$ defined in \autoref{eq:discrete_willmore_flow_energy} based on some mapping 
$v_{\tilde \tau}: L^2(\Omega) \to L^2(\Omega)$ with $\tau, \; \tilde \tau >0$
and some $u^0 \in L^2(\Omega)$ 
we iteratively compute 
    \begin{equation}
        \label{eq:discrete_willmore_step}
        u^{k+1} = \argmin_{u \in L^2(\Omega)} e^\eps[u^k, u]
    \end{equation}
 as the time discrete phase field solution at time \((k+1)\tau\) for $k\in\N_0$.
\end{definition}
%In our above approximation arguments \(\delta\) plays the role of local distance between the evolving hypersurfaces at two consecutive time steps either of mean curvature motion or of Willmore flow. 
%Hence, the approximation is effectively valid if these distances are sufficiently smaller than the phase field parameter \(\eps\).

%% transition
\paragraph{Convolution based approximation of mean curvature.}
We are still left to define  \(v_{\tilde \tau}[u]\) variationally.
Again following Franken \etal \cite{FrRuWi11} we take into account a further minimizing movement scheme, 
now for mean curvature motion and define
\begin{equation} \label{eq:implicitMCF}
v_{\tilde \tau}[u] \coloneqq \argmin_{v\in H^1(\Omega)} \left(\eps \|u - v\|^2_{L^2(\Omega)} + 2 \tilde \tau \Per^\eps[v]\right)
\end{equation}
as the inner variational problem to be solved for every $u$ in the outer problem \autoref{eq:discrete_willmore_step}. 
Instead of solving the Euler-Lagrange equation associated with \autoref{eq:implicitMCF} 
for every function $u$ arising in the outer problem 
we pick up the approach by Bretin \etal \cite{BrDeMa22} and combine a nonlinear activation function and 
a convolution operator to define 
a still spatially continuous approximation of \({v}_{\tilde \tau}[\cdot]\). 
In fact, the general, spatially continuous structure of the scheme in \cite{BrDeMa22} 
is given by a spatially continuous neural operator  
\begin{equation}
\label{eq:mbo_structure}
v^{f,\kernel}_{\tilde \tau}[u] = f_{\tilde \tau} \circ (\kernel_{\tilde \tau} * u),
\end{equation}
where one first applies a convolution kernel  \(\kernel_{\tilde \tau} \in L^2(\R^d) \), followed by the concatenation with a nonlinear activation function  \(f_{\tilde \tau} \in  C^0(\R)\).
When applying the kernel $\kappa_{\tilde \tau}$ to $u$ we assume that $u$ is periodically extended to all of $\R^d$.
The convolution $\kappa_{\tilde \tau}  \ast u$ with $\kappa_{\tilde \tau} \in L^2(\R^d)$ is in $C^0(\R^d)$.
Thus, $v^{f,\kernel}_{\tilde \tau}[u] \in C^0(\R^d)$ as well and can in particular be evaluated point-wise. 

The resulting time discrete but spatially still continuous scheme 
combines a standard optimization problem over functions in $L^2(\Omega)$ with a 
neural operator acting on functions in $L^2(\Omega)$.
% and needed to evaluate the functional \autoref{eq:discrete_willmore_flow_energy} to be minimized



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%motivation: MBO scheme
\begin{remark}[Relation to the MBO scheme and semi-implicit time stepping for Allen-Chan flow]
To motivate the neural networks architecture used by Bretin \etal we first observe that 
the rescaled $L^2$-gradient flow of $\Per^\eps$ with time discretization \autoref{eq:implicitMCF} 
is given by the Allen--Cahn equation
\(  \partial_t u  -\laplace u + \tfrac1{2\eps^2} \dwell^\prime(u)=0.\) 
Evaluating the nonlinearity \(\dwell^\prime\) implicitly at \(u^{k+1}\) 
and the Laplace operator explicitly at \(u^k\) we obtain the time-discrete equation
\begin{equation}\label{eq:discreteAllenCahn}
\tfrac{u^{k+1} - u^k}{\tilde \tau} - \laplace u^k + \tfrac{1}{2\eps^2} \dwell^\prime(u^{k+1}) = 0
\end{equation}
to iteratively compute the sequence \((u^k)_{k\in\N}\) of phase fields given an initial phase field \(u^0\). 
The function \(\phi_{\eps, \tilde \tau}(u) = u + \frac{\tilde{\tau}}{2\eps^2} \dwell^\prime(u)\) is monotone for \(\frac{\tilde{\tau}}{\eps^2} < \frac{8}{9}\) and thus invertible.
Hence, \autoref{eq:discreteAllenCahn} can be rewritten as 
\(u^{k+1} = \phi_{\eps, \tilde \tau}^{-1}((\Id +  \tilde \tau \laplace) u^k)\) and finally using  
the approximation \((\Id +  \tilde \tau \laplace) u^k = e^{-\tilde\tau \laplace} u^k + O(\tilde\tau^2)\) 
we obtain
\(u^{k+1} = \phi^{-1}(e^{-\tilde\tau \laplace} u^k).\)
%begin alternative:
%we obtain the
%\begin{equation} \label{eq:ac_splitting}
%u^{k+1} = \phi^{-1}((\Id - \eps \tilde \tau \laplace)^{-1} u^k).
%\end{equation}
%The implicit time step for the heat flow \((\Id - \tilde \tau \laplace)^{-1} u^k\) can 
%be approximated via convolution with a Gaussian kernel leading to a concatenation of a nonlinear function and a convolution kernel as the approximation scheme of a small time step of mean curvature flow.
%end alternative
This indeed reflects the structure \autoref{eq:mbo_structure} proposed by Bretin \etal \cite{BrDeMa22} 
and resembles the Merriman--Bence--Osher (MBO) scheme \cite{MeBeOs92,MeBeOs94} for characteristic functions where one first solves the linear heat equation with time step \(\tilde \tau\) for a characteristic function as the initial data and then applies a thresholding function to obtain the time step updated characteristic function. 	In this sense, the application of the function \(\phi_{\eps, \tilde \tau}^{-1}\) acts as a soft thresholding.
For the convergence to mean curvature motion, we refer to \cite{Ev93} and \cite{BaGe95}.
Recently, Budd and van Gennip \cite{BuGe20} studied a semi-implicit time-discretization for the double obstacle	Allen--Cahn equation on graphs and proved that the MBO scheme coincides with a particular choice of a semi-implicit scheme for Allen--Cahn flow. 
The scheme takes the form  \(u^{k+1} = \rho \circ \left(e^{-\tilde\tau \Delta} u^{k}\right)\), with $\Delta$ being the (positive definite) graph Laplacian, \(\rho\) a monotone Lipschitz continuous (activation) function, 
and $e^{-\tilde\tau \Delta}$ the linear operator representing one timestep of the heat flow with time step size \(\tilde\tau\).
The authors explicitly refer to the analogy of a convolutional neural network in \cite[footnote 6]{BuGe20}.
%We remark the curiosity that, thus expressed, this scheme can be seen to 
% resemble a forward pass through a neural net, with diffusion playing the role of the linear operator and ?? the activation function.
\end{remark}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% optimization problem
As proposed in \cite{BrDeMa22}, both the kernel \(\kernel_{\tilde \tau}\) and the scalar function \(f_{\tilde \tau} \in  C^0(\R)\) are to be learned 
from data. Bretin \etal suggested to consider (discrete) 
phase field profiles for the explicitly known evolution of hyperspheres in \(\R^d\) as training data. 
In the spatially continuous case, we denote by \(R(r_0, \tilde \tau)=\sqrt{r_0^2-2(d-1)\tilde \tau}\) the radius of the sphere evolution under mean curvature motion at time \(\tilde \tau\) for initial radius \(r_0\) and by \(u_r \colon x \mapsto \tanh \left(\frac{3(r- | x |)}{4\eps}\right)\) the phase field profile for a hypersphere with radius $r$ and determine \(f_{\tilde \tau}\) and \(k_{\tilde \tau}\) as solutions of the optimization problem
\begin{equation}
    \label{eq:mcf_scheme_optimization}
    \min_{f,\kernel} \int_{r_\mathrm{min}}^{r_\mathrm{max}} \rVert v^{f,\kernel}_{\tilde \tau}[u_r] - u_{R(r, \tilde \tau)}  \lVert^2_{L^2(\R^d)} \d r
\end{equation}
where one optimizes over suitable classes of nonlinear functions $f$ and convolution kernels $\kappa$ for a suitable choice of 
\(r_\mathrm{min}\) and \(r_\mathrm{max}\) .

\begin{remark}
In their study Bretin \etal \cite{BrDeMa22} focused on a discrete formulation on regular grids and directly developed a time and space discrete 
evolution operator for mean curvature motion. The underlying neural network consists of a single convolution layer
and a scalar activation function realized with a multilayer perceptron.
Bretin \etal demonstrated empirically that this also leads to a reasonable approximation of mean curvature flow for fairly general initial data and corresponding phase fields.  Functions of the form \autoref{eq:mbo_structure} are efficient to evaluate and differentiate when implemented on discrete grids using neural networks.
We will retrieve this discrete formulation in the next section.
\end{remark}

Furthermore, employing the scheme composed of
\autoref{eq:discrete_willmore_flow_energy} and \autoref{eq:mbo_structure}, 
we can show the existence of time-discrete Willmore flow:
\begin{proposition}
For $\Omega=(0,1)^d$, $u^0\in L^2(\Omega)$ periodically extended on $\R^d$, and \(e^\eps[u^0,\cdot]\) as in \eqref{eq:discrete_willmore_flow_energy} 
with \(v_{\tilde \tau}\) of the form \(v_{\tilde \tau}[u] = f(\kernel\ast u)\) for \(f\in C(\R)\) and $\kernel \in L^2(\R^d)$ 
there exists a 
minimizer \(u\in L^2(\Omega)\) of \(e^\eps[u^0,\cdot]\) in the class of periodically extended $L^2(\Omega)$ functions.
\end{proposition}
\begin{proof}
Let \((u_j)_j\subset L^2(\Omega)\) be a minimizing sequence of $e^\eps[u^0,\cdot]$, with
\begin{align*}
C = e^\eps[u^0, u^0] \geq e^\eps[u^0, u_j] \geq \eps \|u^0 - u_j\|^2_{L^2(\Omega)} 
\geq \frac{\eps}{2} \|u_j\|^2_{L^2(\Omega)} - \eps \|u^0\|^2_{L^2(\Omega)}\,,
\end{align*}
for a constant $C$ depending on $\Vert u^0\Vert_{L^2(\Omega)}$. Here, we used that 
$\Vert \kernel\ast u_0 \Vert_{C^0(\bar \Omega)}$ is bounded and applied Young's inequality.
Hence, \(\Vert u_j\Vert_{L^2(\Omega)}\leq \hat C\) for some constant $\hat C$, 
and thus there exists \(u\in L^2(\Omega)\), 
and a subsequence (not relabeled), with \(u_j\rightharpoonup u\) weakly in \(L^2(\Omega)\). 
Once more using that \(\kernel \in L^2(\R^d)\), we have 
\begin{align*}
(\kernel \ast u_j)(x) = \int_\Omega \kernel(x - y) u_j(y) \d y \rightarrow \int_\Omega \kernel(x - y) u(y) \d y = (\kernel\ast u)(x) 
\end{align*}
for $j\rightarrow \infty$.
Furthermore, we observe
\begin{align*}
\sup_{x\in\Omega}\left| (\kernel \ast u_j)(x) \right| \leq \|\kernel\|_{L^2(\R^d)}\|u_j\|_{L^2(\Omega)}  \leq \hat C  \|\kernel\|_{L^2(\R^d)}.
\end{align*}
Since \(f\) is uniformly continuous on \([-\hat C \|\kernel\|_{L^2(\R^d)},\hat C\|\kernel\|_{L^2(\R^d)}]\), we obtain  \(f(\kernel\ast u_j) \rightarrow f(\kernel\ast u)\) pointwise and in $L^2(\Omega)$. Finally, lower semicontinuity of the $L^2$ norm implies
\begin{align*}
\inf_{\tilde u\in L^2(\Omega)}e^\eps[u^0, \tilde u] = \liminf_{j\rightarrow \infty} e^\eps[u^0, u_j] \geq e^\eps[u^0, u].
\end{align*}
Thus \(u\in L^2(\Omega)\) and minimizes \(e^\eps[u^0,\cdot]\) in the class of periodically extended $L^2(\Omega)$ functions.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Spatial discretization}
\label{sec:discretization}

% discretization in space
\paragraph{Minimizing movement scheme for Willmore flow.}
To discretize the time-discrete Willmore flow in $\R^d$ based on the minimizing movement scheme \autoref{eq:discrete_willmore_flow_energy}, we consider a regular grid on \([0,1]^d\) with gridsize $h=\tfrac1n$ for $n\in\N$ and nodes $x_\alpha = (\tfrac{\alpha_1}{n},\cdot, \tfrac{\alpha_d}{n})$ for a multi-index $\alpha$ in the multi index set $\mathcal{I}_n \coloneqq (\{0,\ldots, n\})^d$.
On this grid we consider functions represented  by nodal vectors $U\in \R^{\vert \mathcal{I}_n\vert}$ with function values $U_{\alpha}$ at nodes $x_\alpha$.
A discrete \(L^2\) norm is defined as
\begin{align*}
\lVert U \rVert_{L^2} \coloneqq  \sqrt{(n+1)^{-d} \sum_{\alpha\in \mathcal{I}_n} (U_\alpha)^2},
\end{align*}
\ie the square root of the average of the squared entries of \(U\).
Thus, the discrete counterpart of the energy \autoref{eq:discrete_willmore_flow_energy} is given by
\begin{equation}
    \label{eq:fully_discrete_willmore_flow_energy}
    E^\eps[U^k,U] = \eps\lVert U - U^k \rVert_{L^2}^2+\frac{\tau\eps}{\tilde\tau^2} \lVert V_{\tilde \tau}[U] - U \rVert_{L^2}^2,
\end{equation}
where \(V_{\tilde \tau}[U]\) denotes a spatially discrete counterpart of \autoref{eq:mbo_structure}.

\paragraph{Neural approximation of discrete mean curvature flow.}
Here, we follow the approach by Bretin \etal \cite{BrDeMa22} and consider discrete kernels and a nonlinear activation functions which are defined themselves as networks.
For a discrete kernel $\NNkernel \in \R^{\Z^d}$, one defines the nodal vector resulting from the discrete convolution with this kernel as 
\begin{align*}
(\NNkernel\ast U)_\alpha \coloneqq \sum_{\beta \in \Z^d} \NNkernel_\beta U_{\alpha+\beta}.
\end{align*}
Here, we assume periodicity of the discrete function to which we apply the discrete convolution, \ie \(U_{\alpha+\beta n}=U_{\alpha}\) for \(\beta \in \Z^d\).
Now, one considers discrete kernels with a fixed width $n_\NNkernel$ and a \(n_\NNkernel^d\) stencil, \ie \(\NNkernel_{\alpha} =0\) for $\max_{i=1,\ldots,d} \vert \alpha_i \vert > \tfrac{n_\NNkernel-1}{2}$. 
To ensure consistency with the continuous mean curvature motion the necessary size \(n_\NNkernel\) of the kernel depends on the time step size $\tilde \tau$ and the grid size $h$.
At the same time, smaller kernels are more efficient to train which creates a trade-off between accuracy and speed. 
This trade-off will be explored in our numerical experiments below.
The point-wise function \(f\)  is discretized using a fully-connected neural network \(F^\theta \colon \R \to \R\) with $L$ layers and layer sizes \(N_1,\ldots,N_L\). 
The $l$th layer is described in terms of a weight matrix \(W^{l} \in \R^{N_{l} \times N_{l-1}}\) with $N_0=1$ and a bias vector \(b^{l} \in \R^{N_{l}}\).
These degrees are gathered in a parameter vector \(\theta = (W^1,\ldots, W^{L},b^1,\ldots, b^{L})\).
Then, one defines \(F^\theta(s)=s^L\) with \(s^{l} \coloneqq  \rho\left( W^{l} s^{l-1} + b^{l} \right)\) and \(s^0=s\) and the choice \(\rho(s) = \exp(-s^2)\) as the nonlinear activation function. 
In practice, we used six layers with sizes \(32, \,16, \,8, \,4, \,2,\,1\).
For given parameters \(\theta\) and \(\NNkernel\), we obtain the discrete operator 
\begin{equation}
    \label{eq:mcf_operator_discrete}
    V^{\theta,\NNkernel}_{\tilde \tau}[U] \coloneqq F^\theta(\NNkernel \ast U).
\end{equation}

% neural network training
Now, one approximates the optimization problem \autoref{eq:mcf_scheme_optimization} via our discretization and a sampling of training data.
To this end, one considers $m$ radii \(r_1,\ldots,r_{m}\) sampled uniformly from an interval \([r_\mathrm{min}, r_\mathrm{max}]\) and minimizes the loss functional
\begin{align}
\label{eq:mcf_scheme_optimization_discrete}
\mathcal{L}[\theta,\NNkernel] =  
\frac{1}{m} \sum_{i=1}^{m} \rVert V^{\theta,\NNkernel}_{\tilde \tau}[U_{r_i}] - U_{R(r_i, \tilde \tau)}  \lVert^2_{L^2},
\end{align}
over the total set of parameters \((\theta,\rho)\), where \(U_r\) are nodal evaluations of the hypersphere phase fields \(u_r\).
We approximately solve problem \autoref{eq:mcf_scheme_optimization_discrete} using the Adam optimizer \cite{KiBa15}, with $m=100$, $r_\mathrm{min} = 0.05$, $r_\mathrm{max} = 0.4$, and usually employ mini-batching, \ie approximating the sum in \autoref{eq:mcf_scheme_optimization_discrete} using only ten randomly drawn radii, to speed-up the minimization as was proposed by Bretin \etal \cite{BrDeMa22}.
The resulting neural phase field operator \(V^{\theta,\NNkernel}_{\tilde \tau}[\cdot]\) approximates the PDE solution \(v_{\tilde \tau}\) defined in \autoref{eq:implicitMCF} and is inexpensive to evaluate.

%%%%%
%The resulting neural phase field operator \(V^{\theta,\NNkernel}_{\tilde \tau}[\cdot]\) which
%approximates the PDE solution \(v_{\tilde \tau}$ defined in \autoref{eq:implicitMCF}
%is (for not too large stencil width \(n_K\)) inexpensive to evaluate  along with their gradient computed via auto-differentiation.  
%\MR{which is fully used below!}

%%%%%
%The resulting scheme based on the minimization of the functional \(E^\eps[U^k,\cdot]\) \autoref{eq:fully_discrete_willmore_flow_energy}
%is hybrid in the sense that the minimizing movement component is 
%based on a standard optimization problem on discrete functions on a regular grid whereas the 
%evaluation of the functional to be minimized involves a convolutional neural network.

%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff
\begin{figure}[t]
	\centering
	\includegraphics[width=.9\textwidth]{images/network.pdf}
	\caption{
		Learned networks for \(\eps = 2^{-6}\) and \(\tilde \tau = 2^{-14}\) are displayed via a color coding of the learned kernels \(\NNkernel\) and the graphs of learned activation function \(F^\theta\) on the interval \([-1, 1]\) for increasing $n = 128,\, 256,\, 512$, with stencil widths  $n_K=17,\,33,\,65$, respectively.
	}
	\label{fig:LearnedNetwork}
\end{figure}
%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff

%%%%%
We employ Newton's method with Armijo line search to minimize \(E^\eps[U^k,U]\) over \(U\).
Thus, to determine the descent direction \(P\), we approximately solve the linear system \(D^2E^\eps[U^k, \cdot] P = DE^\eps[U^k,\cdot]\) using the conjugated gradient method (see \cite[Chapter 7]{NoWr06}). 
This also prevents us from having to assemble the Hessian and we instead only compute the corresponding matrix-vector product. 
Furthermore, we manually implemented the derivatives of \(E^\eps[U^k, \cdot]\) to improve performance.
We developed our hybrid method in Python using the PyTorch library \cite{PaGrMa19} and the nonlinear optimization algorithms used in the pytorch-minimize \cite{Fe21} package, which is based on the optimization module of SciPy \cite{ViGoOl20}.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Numerical experiments}
\label{sec:experiments}
As usual in nonlinear optimization, the chosen initialization when solving \autoref{eq:mcf_scheme_optimization_discrete} impacts the result.
For example, Bretin \etal~\cite{BrDeMa22} successfully trained their network on a resolution of \(n=256\) with stencil width \(n_K=17\), \(\eps=2h\), and \(\tilde \tau=\eps^2\).
They initialized the kernel as zero and the parameters \(\theta\) randomly sampled from a normal distribution.
However, when refining $h$ while keeping \(\eps\) fixed, and thus consistently  increasing \(n_K\), we observed a degradation of the approximation quality of \(V^{\theta,\NNkernel}_{\tilde \tau}[\cdot]\).
We mitigated this by first training the network on a coarse resolution as proposed by Bretin \etal~and then progressively passing to finer resolutions. 
In each step, we initialize the kernel using a bilinear interpolation of the coarser one. 
For the nonlinearity \(F^\theta\), we kept the previous parameters as initialization. 
The resulting networks are displayed in \autoref{fig:LearnedNetwork}.

%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff
\begin{figure}[t]
\centering
\includegraphics[width=.9\textwidth]{errorLists/errorplot_MCF_circle}
\caption{
	Convergence validation for mean curvature flow with fixed \(\eps = 2^{-6}\) and \(\tilde \tau = 2^{-14}\) while increasing \(n\), with \(n_K = \tfrac{n}{8} + 1\). 
	We plot the average $L^2$-error to the analytic solution along time for 30 circles with radii $r_i = 0.05\pi + \tfrac{0.15\pi i}{30}\,$, $i=0,\dots,29$. 
	The line-styles correspond to the different methods and the colors to the varying resolution.
	For comparison: for the averaged $L^2$ distance between the solution at time $0.004$ and at the initial time zero, one obtains $\tfrac{1}{30}\sum_{i=1}^{30} \|U_{R(r_i, 0.004)} - U_{R(r_i, 0)}\|_{L^2} \approx 0.133$.
}
\label{fig:ConvergenceTestMCF}
\end{figure}
%\MR{$n \leftrightarrow n_K$?}
%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff
With this setup, we first investigate the convergence of the neural network-based MCF scheme \autoref{eq:mcf_operator_discrete} and \autoref{eq:mcf_scheme_optimization_discrete} in two dimensions under spatial refinement, \ie~we keep the scale parameter \(\eps\) and the time step size \(\tilde\tau\) fixed and increase the spatial resolution and the width of the kernel \(n_K\). 
We compare the neural network scheme by Bretin \etal~\cite{BrDeMa22} with a fully implicit (\cf~\autoref{eq:implicitMCF}) and semi-implicit finite element scheme.
In the latter, one computes the solution \(v\) at next timestep as the solution of $\frac{v - u}{\tilde \tau} = \laplace v - \tfrac{1}{2\eps^2}  \dwell'(u)$ for given $u$ at the current timestep.
Here, we consider a multi-linear finite element approach on the regular quad mesh.
We perform the validation of convergence for the evolution of circles on the computational domain \(\Omega = (-1,1)^2\).
In \autoref{fig:ConvergenceTestMCF}, we plot the average error when comparing to the exact solution over 30 radii ranging from $0.05\pi$ to $0.2\pi$. 
The error is displayed along 64 timesteps of size $\tilde \tau = 2^{-14}$ for the different schemes and varying resolution. 

%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff
\begin{figure}[htbp!]
	\centering
	\begin{subfigure}[t]{.9\linewidth}
		\includegraphics[width=\textwidth]{errorLists/errorplot_WF_circle}
		\caption{Circles}
		\label{fig:ConvergenceTestWFCircle}	
	\end{subfigure}
	\begin{subfigure}[t]{.9\linewidth}
		\includegraphics[width=\textwidth]{errorLists/errorplot_WF_rectangle}
		\caption{Rectangle}
		\label{fig:ConvergenceTestWFRectangle}
	\end{subfigure}
	
	\caption{
		%\MR{$n=N$, $n_K$?}
		Convergence tests for Willmore flow with fixed \(\eps = 2^{-6}\) and \(\tilde \tau = 2^{-14}\) while increasing \(n\), with \(n_K = \tfrac{n}{8} + 1\). 
		As in \autoref{fig:ConvergenceTestMCF}, the line-styles correspond to the different methods for approximating the mean curvature evolution and the colors to the varying resolution.
		In \textbf{(a)}, we plot the average $L^2$-error to the analytic solution for 30 circles with radii $r_i = 0.05\pi + \tfrac{0.15\pi i}{30}\,$, $i=0,\dots,29$ over time. 
		For comparison: for the averaged $L^2$ distance between the solution at time $0.004$ and at the initial time zero, one obtains$\tfrac{1}{30}\sum_{i=1}^{30} \|U_{R_W(r_i, 0.004)}- U_{R_W(r_i, 0)}\|_{L^2} \approx 0.414$. 
		In \textbf{(b)}, we plot the $L^2$-error of the evolution of a rectangle sized $0.4\times 0.2$ compared to a fine implicit finite element solution ($n=2048$).
	}
	\label{fig:ConvergenceTestWF}
\end{figure}
%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff

One observes that the neural network-based MCF scheme performs noticeably better than the semi-implicit finite element scheme. 
This confirms the observations made by Bretin \etal~\cite{BrDeMa22} for a single resolution. 
The fully implicit FE scheme outperforms the network-based scheme, which is not that surprising due to its semi-implicit nature.
In summary, the network-based scheme positions itself between semi-implicit and fully implicit finite element scheme in terms of accuracy.


%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff
\begin{figure}[htbp!]
	\centering
	\includegraphics[width=.9\textwidth]{images/rectangle_evolution.pdf}
	\caption{
		Willmore flow of a rectangle with side lengths $0.4\times 0.2$ using $\eps=2^{-6}$. 
		Results of our hybrid scheme on resolution $n=256$ (top row), fully implicit finite element solution of the nested scheme on resolution $n=256$ (middle row) and on resolution $n=2048$ (bottom row). 
		From left to right: evolution times $t=0,\,2^{-14},\,2^{-13},\,2^{-10},\,2^{-8},\,2^{-7}$, respectively. 
	}
\label{fig:WFrectangles}
\end{figure}
%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff
In two dimensions, the evolution of a circle with initial radius $r$ under Willmore flow is given at time $\tau$ by a circle with radius $R_W(r,\tau) =  \sqrt[^4]{r^4 + 2\tau}$. 
In \autoref{fig:ConvergenceTestWFCircle}, the error of our hybrid scheme based on \autoref{eq:discrete_willmore_flow_energy}, \autoref{eq:mcf_operator_discrete} is displayed averaging over the same set of initial radii as in \autoref{fig:ConvergenceTestMCF}.
Again, the different line-styles (solid, dashed, dotted) correspond to the different methods for solving the inner MCF problem (hybrid, finite element implicit and semi-implicit). 
As shown in \cite{FrRuWi11}, for $\eps=2h$ ($h=\tfrac{1}{n}$), the nested Willmore scheme suffers from numerical instabilities.
Hence, we only consider the error evolution for $n=256,\, 512$ and for fixed $\eps = 2^{-6}$. 

To test our scheme not only on circles, on which the networks were trained, we applied the hybrid scheme to initial data given as the phase field approximation of a rectangle sized $0.4\times 0.2$.
Since there is no known analytic solution for Willmore flow in this case, we compare the results to a solution of the nested finite element scheme by Franken \etal \cite{FrRuWi11} on a much finer resolution ($n=2048$). 
The corresponding error evolution is displayed in \autoref{fig:ConvergenceTestWFRectangle}.
In both experiments, we observe that our hybrid approach performs noticeably better than the nested scheme using a semi-implicit finite element approach for the inner MCF problem, while the fully implicit nested finite element scheme from \cite{FrRuWi11} remains the most accurate.
This mirrors the observations for MCF.%\MR{revise last sentence which?}

From now on, we focus on our hybrid scheme.
In \autoref{fig:WFrectangles}, we show the evolution of the rectangle under Willmore flow. 
We observe that already for the coarser resolution (\eg~\(n=256\)) the results are qualitatively indistinguishable from those computed with fine resolution ($n=2048$). 
Hence, for applications where one is primarily interested in the qualitative effects of Willmore flow, one can effectively achieve satisfying results on coarser resolutions.
We will exploit this in the next section.
 
We end this section with a few details on the implementation and data processing pipeline.
As for our hybrid scheme (see \autoref{sec:discretization}), we have implemented the finite element-based approaches in Python using standard libraries.
We implemented the nested scheme using Newton's method as described in \cite{FrRuWi11} with direct linear solver PARDISO \cite{ScGaFi01}.
All experiments using the finite element-based approaches were run on a workstation with two 32-core AMD EPYC 7601 processors with 1TB RAM. 
All experiments using our hybrid approach were run on a workstation with an NVIDIA A100 GPU with 40GB of memory and two 24-core AMD EPYC 7402 processors with 256GB RAM using double-precision floating-point arithmetic on the GPU.
The phase fields for the armadillo and the rocker-arm were generated as follows:
First, using the tool $\texttt{mesh\_to\_voxels}$ from \cite{Kl21} signed distances were generated on a $n^3$ grid based on corresponding meshes.
Then, the optimal phase field profile, as described in \autoref{sec:method}, was applied to the signed distances. 
To generate the images in \autoref{fig:3dInpainting} and in \autoref{fig:armadillo}, the zero-levelset of the phasefield was extracted using the $\texttt{Contour}$ function from Paraview \cite{AhGeLa05}. 
Finally, all results in 3D were rendered in Blender \cite{Bl18}. 

% patch-based scheme
%By construction, the architecture of the networks inherits a local structure. Moreover, the information in the training data lies almost only in the neighborhood of the surfaces of the circles/balls. To benefit from this, and to reduce the storage demand during the learning phase, we propose a different approach: 
%for every radius $r_i$in the dataset sample patches $P_{r_i,j}$ with $j = 1,\dots,N_\text{patches}$ of size $K\times K (\times K)$ around the surface randomly, where the midpoint has maximal distance $20 \eps$ to the surface. The application of the network to a patch returns a scalar output that approximates the value of the analytic solution $u_{R(r_i,\tilde \tau)}$ at the midpoint of $P_{r_i,j}$. The loss function  \todo{(describe how random) }
%
%Generation of training data: Let $N_\text{radii}$ be the number of radii, $N_\text{patches}$ the number of patches per radius. Let $h$ be the target resolution (for example $h=\frac{1}{512}$). Let $k$ be the width of the kernel (in pixel, for example $k = 17$). For every radius $r$ generate patches $p$ as follows: Generate a $k \times k \times k$ grid of the cell $[-\frac{kh}{2}, \frac{kh}{2}]^3$, such that the middle pixel is at $(0,0,0)$. Generate a random unit vector $x$ uniformly distributed on the unit sphere. Generate a random distance $d_p = \mathcal{N}(0,1) \frac{(k + 4)h}{2} + r$. The center of the random ball is $x_p = d_p x$, and it has radius $r$. Now generate optimal profile of this ball on the patch $[-\frac{kh}{2}, \frac{kh}{2}]^3$. The network $\phi^{NN}:\R^{k\times k\times k} \rightarrow \R$ is then applied to this patch. The result is then compared to the value of the optimal profile of the ball with center $x_p$ and radius $\sqrt{r^2 - 4\delta_t}$ at the midpoint of the patch $(0,0,0)$, where $\delta_t$ is the time-step size.
%\todo{this is all bad}
%\inlinetodo{Add description of patch-based scheme}


%\begin{figure}[htbp!]
%    %	\includegraphics[width=.6\textwidth]{images/armadillo}
%    \caption{Network Architecture.}\label{fig:NetworkArchitecture}
%\end{figure}


%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff
\begin{figure}[t]
	\centering
\includegraphics[width=\textwidth]{images/diskcube.jpg}
\caption{
	Evolution by Willmore flow for a cube surface and a thick disk surface with spatial resolution $n = 64$, kernel size $n_K =17$, interface parameter $\eps=2^{-5}$, inner stepsize $\tilde{\tau} = 2^{-12}$, and Willmore flow stepsize $\tau = 2^{-18}$. 
	Results are shown at time \(0,1\), and time \(10\), which reproduce concave surface patches as common effects for Willmore.
}
\label{fig:DiskAndCube}
\end{figure}
%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Applications in image and geometry processing}
\label{sec:applications}
Now that we have introduced and studied our proposed scheme, we will briefly discuss its use for two closely-related applications: surface fairing and surface restoration.

In the first of these applications, \emph{surface fairing}, the goal is to create a visually smooth and seamless surface starting from an input surface that is usually noisy or otherwise corrupted.
The problem has been studied in the computer graphics and vision communities and curvature flows have established themselves as a classical tool \cite{DeMeSc99}.
Willmore flow is particularly interesting as a basic model for this application \cite{BoSc05,GrAu20,SoChDi21} since it avoids singularities that could arise with mean curvature flow \cite{CrPiSc13}.
Hence, we consider the Willmore flow of surfaces in $\R^3$ for corresponding initial surfaces in \autoref{fig:DiskAndCube} and see that our scheme is able to reproduce common effects of Willmore flow.
We furthermore apply it to the armadillo, often referenced in computer graphics, in \autoref{fig:armadillo} and a rocker-arm model in \autoref{fig:rockerarm}. 
Concerning computational cost, we show the results comparing our hybrid scheme to the original finite element-based nested Willmore approach by Franken \etal \cite{FrRuWi11} in \autoref{table:Performance}.

%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff
\begin{figure}[t]
	\centering
	\includegraphics[width=\textwidth]{images/Armadillo.jpg}
	\caption{
		Evolution of the armadillo shape under Willmore flow.
		The spatial resolution is $n = 128$, the kernel size is $n_K =17$, the interface parameter $\eps=2^{-6}$, the inner stepsize $\tilde{\tau} = 2^{-14}$, and the Willmore flow stepsize $\tau = 2^{-20}$. 
		Results are shown at time \(0,1,4,40\), and \(400\), respectively. 
	}
	\label{fig:armadillo}
\end{figure}
%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff

%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff
\begin{figure}[t]
	\centering
	\includegraphics[width=\textwidth]{images/Rockerarm.jpg}
	\caption{
		Evolution of a rocker arm shape under Willmore flow.
		The spatial resolution is $n = 64$, the kernel size is $n_K =17$, the interface parameter $\eps=2^{-5}$, the inner MCF stepsize $\tilde{\tau} = 2^{-12}$, and the Willmore flow stepsize $\tau = 2^{-12}$. 
		We show the discrete timesteps \(0,1\), and \(20\) leading to an approximation of the Clifford torus.
	}
	\label{fig:rockerarm}
\end{figure}
%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff

\begin{table}[h!]
	\begin{subfigure}[c]{.49\linewidth}
		\begin{tabular}{l|r}
			\toprule
			\textbf{Method}       & \textbf{Armadillo (N=64)}  \\
			%		& \textbf{Armadillo} & \textbf{Cross} & \textbf{Ball} \\
			\midrule
			nested FEM \cite{FrRuWi11}   &         14589 sec                 \\
			%		 &                    &               &              \\
			Ours   &       807 sec               \\
			%		    &                    &               &              \\
			%		Ours (float, A100)    &                &              &                    &               &              \\
			\bottomrule
		\end{tabular}
	\end{subfigure}
	\hfill
	\begin{subfigure}[c]{.49\linewidth}
		\includegraphics[width=\textwidth]{images/Armadillo_Comparison.jpg}
	\end{subfigure}
	\caption{
		Performance comparison of our hybrid method to the nested finite element scheme by Franken \etal \cite{FrRuWi11} on the example from \autoref{fig:armadillo}:
		The results after one step of Willmore flow starting from the shape on the far-left of \autoref{fig:armadillo} (right), computing time (left). 
	}
	\label{table:Performance}
\end{table}

The second application we consider, \emph{surface inpainting}, is a fundamental topic in geometry and image processing, where one aims to restore corrupted or destroyed parts of an image or a surface.
We investigate in this section the use of our hybrid approach to tackle this problem.
In a first step, one replaces the corrupted or missing part by an ansatz geometry, whose primary purpose is to prescribe the desired topology.
Following the edge restoration approach by Nitzberg \etal \cite{NiMuSh93}, one considers the energy \eqref{eq:discrete_willmore_flow_energy} on the full domain \(\Omega\), but only takes into account degrees of freedom in a part \(D\subset\Omega\), where the image or surface 
is corrupted.  
Then, Willmore flow under this constraint leads to smooth reconstructions of the corrupted area while preserving $C^1$ boundary conditions on \(\partial D \cap \Omega\). 
We illustrated two examples in two dimensions in \autoref{fig:2dInpainting}, where the reconstruction region \(D\) is outlined in green. 
In \autoref{fig:3dInpainting}, we carried out similar experiments in three dimensions. 
A particularity of Willmore flow in two dimensions is that the reconstruction of the circle in \autoref{fig:2dInpainting} takes the enormous number of \(2000\) timesteps of size $2h$.
This is due to the competition of the convex and concave parts in the reconstruction area: positive curvature on the sides pushes the surface outwards while the middle part with negative curvature tends to move inwards. 
Only because the curvature of the outer part dominates slightly, the surface moves slowly outwards. 
In contrast, the reconstruction of the ball in \autoref{fig:3dInpainting} does not have the same slow behavior as the circle, because the three-dimensional Willmore energy is scale-invariant.
%Since this behavior is inherent to Willmore flow it does not influence the computational cost im comparison to an finite element-based scheme, which can be seen in \autoref{table:Performance} as before.  

%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff
\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth]{images/circle_inpainting_withFrame_compressed}
\includegraphics[width=\textwidth]{images/cross_inpainting_withFrame_compressed}
\caption{
	Application of our hybrid scheme to image restoration in two dimensions.
	In both examples, the spatial resolution is $n = 1024$, the kernel size is $n_K =17$, and the interface parameter $\eps=2^{-8}$ and the reconstruction region \(D\) is outlined in green.
	In the top row, a disk with a cut-out corner is considered as initial image and we use $\tilde{\tau} = 2^{-14}$, $\tau = 2^{-7}$.
	The restoration evolution is shown at times \(0, 1, 100, 500, 1000, 1500\), and \(2000\).
	In the bottom row, a cross shape is given as initial image with the central part is smoothed under discrete Willmore flow with stepsizes $\tilde{\tau} = 2^{-14}$ and $\tau = 2^{-14}$.
	We show the flow at times \(0, 1, 5, 10, 20, 35\), and \(50\).
}
\label{fig:2dInpainting}
\end{figure}
%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff

%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff
\begin{figure}[t]
	\centering
    \includegraphics[width=\textwidth]{images/Inpainting.jpg}
    \caption{
    	Application of our hybrid scheme to surface restoration in three dimensions. 
    	In both examples, the spatial resolution was $n = 128$, the kernel size was $n_K =17$, the interface parameter was $\eps=2^{-6}$, and the timestep sizes were
	$\tilde{\tau} = 2^{-14}$ and $\tau = 2^{-21}$.
    	In the top row, the flow at timesteps \(0, 1, 3\), and \(5\) recovering a sphere with an initially cut-out corner is shown.
    	In the bottom row, the flow at timesteps \(0, 1, 4\), and \(8\) leads to a smooth blending of six tubes.
    }
    \label{fig:3dInpainting}
\end{figure}
%ffffffffffffffffffffffffffffffffffffffffffffffffffffffff

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusions}
\label{sec:conclusions}
In this paper, we presented a new hybrid scheme for Willmore flow in a phase field formulation, which combines a minimizing movement ansatz for the flow proposed by Franken \etal \cite{FrRuWi11} with a neural operator approach to compute an approximation of the mean curvature following Bretin \etal \cite{BrDeMa22}.
For a fixed timestep size and scale parameter of the phase field ansatz, the hybrid scheme shows error reduction for increasing spatial resolution and stencil size of the network kernel.
The new scheme comes with significantly reduced computing times. 
The resulting discrete Willmore flow properly reflects the qualitative behavior of the continuous flow and is, for instance, applicable to restoration of 2D images and 3D surfaces. 

The results encourage the use of neural networks when simulating geometric flows. 
A future challenge would be to directly learn a solution operator for Willmore flow. 
In \cite{GrHe08}, Grzhibovskis and Heintz described a convolution thresholding scheme for Willmore flow. 
Hence, designing a neural network to directly learn Willmore flow does not seem to be out of reach. 
However, creating proper training data is more subtle. 
The striking observation in \cite{BrDeMa22} is that the evolution of spheres under mean curvature flow is sufficient for the approximation of mean curvature flow for a wide range of initial data.
For Willmore flow, surely a significantly richer set of training data is required.

\section*{Acknowledgments}
We thank Angelo Kitio for helping with the initial re-implementation of the network-based scheme for mean curvature flow by Bretin \etal \cite{BrDeMa22}.


\section*{Funding}
This work was supported by the Deutsche Forschungsgemeinschaft (DFG, German Research Foundation) via project 211504053 -- Collaborative Research Center 1060 and via Germanys Excellence Strategy project 390685813 -- Hausdorff Center for Mathematics.
Furthermore, this project has received funding from the European Unions Horizon 2020 research and innovation program under the Marie Skodowska-Curie grant agreement No 101034255.


%------
% Insert the bibliography.
%------
\bibliographystyle{siam}
\bibliography{RuSaSm24}

\end{document} 
