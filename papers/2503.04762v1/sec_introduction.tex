\section{Introduction}
Safety is a critical consideration in various applications, including robots, autonomous vehicles, smart grids, and transportation control systems~\cite{wolf2017safety}. These safety-critical scenarios demand formal guarantees to ensure that systems operate as expected, as failures may result in severe consequences, such as harm to humans or significant financial costs. Safety verification refers to the task of determining whether a system satisfies a given safety specification over a specified period~\cite{guiochet2017safety, vicentini2019safety}. 
Conventional safe set specifications primarily focus on spatial requirements, ensuring that the system state never enters an unsafe region~\cite{prajna2004safety}. However, as the complexity of autonomous systems increases, many real-world tasks require specifications that are not only spatial but also temporal in nature. For instance, a mobile robot needs to pass Area A before entering Area B. In this paper, we focus on safety verification under Signal Temporal Logic (STL) specification, which uses both boolean and temporal logic operators to formulate constraints for continuous-valued systems~\cite{maler2004monitoring}. 

Real-world systems are subject to various types of uncertainty. It is essential for safety verification algorithms to account for disturbances. Many existing approaches model these uncertainties as bounded disturbances and employ worst-case analysis to guarantee the satisfaction of safety specifications. Examples of such approaches for safe set specification include Hamiltonâ€“Jacobi Reachability (HJ Reachability)~\cite{bansal2017hamilton}, reachability analysis, and barrier certificates~\cite{prajna2004safety}. For STL specifications, methods such as HJ Reachability~\cite{chen2018signal} and reachability analysis~\cite{roehm2016stl, lercher2024using, kochdumper2024fully} have been employed to formally verify STL satisfaction under bounded disturbance inputs.


In many practical situations, disturbances are better modeled as stochastic noise, which provides a more realistic representation, as in the case of sensor noise. When considering stochastic disturbances, the aforementioned deterministic methods are not applicable or tend to be overly conservative, as they focus on worst-case scenarios that rarely occur in practice. To better account for stochastic disturbances, we adopt a probabilistic setting, where the goal is to ensure the safety specification is satisfied with high probability, e.g., greater than 99.9\%. 
For safe set specifications, several methods have been proposed to verify stochastic systems, including martingale-based approaches~\cite{steinhardt2012finite, santoyo2021barrier}, risk estimation~\cite{frey2020collision}, and sampling-based methods~\cite{janson2017monte}. Our recent paper significantly reduces the conservativeness of the verification algorithms for safe set specifications~\cite{liu2024safety}.
For STL specifications, most existing approaches are limited to handling the probability constraint for a single trajectory satisfying the STL specification~\cite{sadigh2016safe, farahani2018shrinking, yang2023distributed, vlahakis2024probabilistic, kordabad2024control}. Very few studies have focused on STL verification under both bounded and stochastic disturbances. In \cite{salamati2021data}, a method is proposed to address this problem for linear systems under Gaussian noise. In this work, we focus on the problem of STL verification for nonlinear systems under both bounded and stochastic disturbances. 

In this work, we present a novel framework for verifying the probabilistic STL satisfaction of discrete-time nonlinear stochastic systems. To the best of our knowledge, this is the first approach capable of addressing this problem for nonlinear systems under both bounded and stochastic disturbances. Given a desired probability requirement, our method first erodes the superlevel set of the predicates in an STL formula to get a tighter STL formula. If the deterministic system is verified to satisfy the tighter STL formula, then the stochastic system is guaranteed to satisfy the original STL formula with the specified probability constraint. As a result, the stochastic verification problem is transformed into a deterministic one. The depth of erosion is determined by the sharp probabilistic bound proposed in our previous work~\cite{liu2024probabilistic}, which helps reduce the conservativeness of the verification result, especially when the probability tolerance is low and the time horizon is long. Our method does not rely on restrictive assumptions, such as linear system dynamics or affine predicates, which is common in previous work~\cite{vlahakis2024probabilistic}. This broader applicability makes our approach suitable for real-world applications.



\textit{Notations.}
% \textit{Vectors, matrices, and probability.} 
Denote by $\real$ and $\n$ the sets of real numbers and nonnegative integers, and define $\n_{[a,b]}=\setb{a, a+1, \dots, b}$ where $a,b\in \n$ and $a<b$. Given a vector sequence $\{x_t\}$, define $\boldsymbol{x}_{[t_1,t_2]} = (x_{t_1}, x_{t_1+1}, \dots, x_{t_2}) = [x\tran_{t_1}, x\tran_{t_1+1}, \dots, x\tran_{t_2}]\tran$ , $t\in\n_{[t_1,t_2]}$. When $X_t$ are random vectors, $\boldsymbol{X}_{[t_1,t_2]}$ is a random process. We use $\bP$ to denote probability. A random vector $X \sim \mathcal{N}(\mu, \Sigma)$ follows a multivariate Gaussian distribution with mean $\mu$ and covariance $\Sigma$.
Given a vector $x\in \real^n$, $\|x\|$ denotes the euclidean norm and $\|x\|_P = \sqrt{x\tran P x}$, where $P\in\real^{n\times n}$ is a positive definite matrix.
% \textit{Sets.} 
The $n$ dimensional ball with radius $r$ and center $y$ is denoted by $\BB^n(r, y)=\setb{x\in \real^n : \|x-y\| \leq r}$. Denote the complement of set $A$ as $\setcomp{A}$ and $-B = \setb{-y: \forall y\in B}$. Given sets $A$ and $B$, define the Minkowski sum of $A$ and $B$ by $A\oplus B = \setb{x+y: x\in A,~ y\in B}$, and the Minkowski difference or Pontryargin difference of $A$ and $B$ by $A\ominus B=\setb{x:x+y\in A, \forall y\in B}$ \cite{kolmanovsky1998theory}. The Minkowski sum and difference satisfy the relation $(A\ominus B)\oplus B \subseteq A$.





