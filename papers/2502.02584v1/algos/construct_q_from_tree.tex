\begin{algorithm}[tb]
\caption{Q-value Estimation}\label{algo:estimate_q}
\begin{algorithmic}
\STATE \textbf{Input}: A reasoning tree $\mathcal{T}$ with a root node $U$, discount factor $\gamma$
\STATE \STATE \textbf{Procedure} \hspace{5pt}Update\_Q\_Values($N$)
    \IF{$N.\mathcal{C} = \emptyset$} 
    \STATE \textbf{return}  
        \hfill \textcolor{gray}{$\vartriangleright$Leaf nodes do not update}
    \ENDIF
    \FOR{node $N_{\text{child}}$ in $N.\mathcal{C}$}
        \STATE Update\_Q\_Values($N_{\text{child}}$)
        \hfill \textcolor{gray}{$\vartriangleright$Recursively update child nodes first}
    \ENDFOR
    \STATE $N.q = N.r + \gamma \max_{N_\text{child} \in N.\mathcal{C}}(N_\text{child}.q)$ 
    \hfill \textcolor{gray}{$\vartriangleright$Update Q-value after all children are updated}
\STATE \textbf{End Procedure}
\STATE \STATE Update\_Q\_Values($U$) 
\hfill \textcolor{gray}{$\vartriangleright$Start the update process from the root}

\STATE $Q_{\text{min}} = \min_{N \in \mathcal{T}}(N.q)$ 
\STATE $Q_{\text{max}} = \max_{N \in \mathcal{T}}(N.q)$ 
\FOR{node $N$ in $\mathcal{T}$}
    \STATE $N.q = \frac{N.q - Q_{\text{min}}}{Q_{\text{max}} - Q_{\text{min}}}$ 
    \hfill \textcolor{gray}{$\vartriangleright$Apply min-max normalization}
\ENDFOR
\STATE \textbf{return} the reasoning tree $\mathcal{T}$ with estimated Q-value of each node

\end{algorithmic}
\end{algorithm}
