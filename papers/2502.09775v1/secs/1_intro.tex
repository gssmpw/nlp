\section{Introduction}
\label{sec:intro}

\input{tabs/overview}

Building a virtual cell that simulates cellular behaviors in silico has been a longstanding dream in computational biology~\cite{slepchenko2003quantitative, johnson2023building, bunne2024build}. Such a system would revolutionize drug discovery by rapidly predicting how cells respond to new compounds or genetic modifications, significantly reducing the cost and time of biomedical research by prioritizing the experiments most likely to succeed based on the virtual cell simulation~\cite{carpenter2007image}. Moreover, this could unlock personalized therapeutic development by building digital twins of cells from patients to simulate patient-specific responses~\cite{katsoulakis2024digital}.

Two recent advances have made creating a generative virtual cell model possible. On the computational side, generative models now excel at modeling and sampling from complex data distributions, demonstrating remarkable success in synthesizing texts, images, videos, and biological sequences~\cite{openai2024gpt4technicalreport, esser2024scaling,pmlr-v235-kondratyuk24a,hayes2025simulating}. Concurrently, on the biotechnology side, automated high-content screening has generated massive imaging datasets --- reaching terabytes or petabytes --- that capture how cells respond to hundreds of thousands of chemical compounds and genetic modifications~\cite{chandrasekaran2023jump, fay2023rxrx3}.

In this work, we introduce \emph{CellFlow}, an image-generative model that simulates how cellular morphology changes in response to chemical or genetic perturbations (Figure~\ref{fig:overview}a). \emph{CellFlow}’s key innovation is formulating cellular morphology prediction as a distribution-to-distribution learning problem, and leveraging flow matching~\cite{lipman2022flow}, a state-of-the-art generative modeling technique designed for distribution-wise transformation, to solve this problem.

Specifically, cell morphology data are collected through high-content microscopy screening, where images of control and perturbed cells are captured from experimental wells across different batches (Figure~\ref{fig:overview}b). Control wells, which receive no drug treatment or genetic modifications, play a crucial role in providing prior information and serving as a reference to distinguish true perturbation effects from other sources of variation. They help calibrate non-perturbation factors, such as batch effects—systematic biases unrelated to perturbations, including variations in color or intensity, akin to distribution shifts in machine learning. Properly incorporating control wells is essential for capturing actual perturbation effects rather than artifacts, yet many existing methods overlook this aspect~\cite{yang2021mol2image,navidi2024morphodiff,cook2024diffusion}. To address this, we frame cellular morphology prediction as a distribution-to-distribution mapping problem (Figure~\ref{fig:overview}c), where the source distribution consists of control cell images, and the target distribution comprises perturbed cell images from the same batch.

To address this distribution-to-distribution problem, \emph{CellFlow} employs flow matching, a state-of-the-art generative modeling approach designed for distribution-wise transformations (Figure~\ref{fig:overview}d). The framework continuously transforms the source distribution into the target using an ordinary differential equation (ODE) by learning a neural network to approximate a velocity field. This direct and native distribution transformation enabled by flow matching is intuitively more effective than previous methods, which rely on adding extra components to GANs, incorporating the source as a condition, or mapping between distributions and noise using diffusion models~\cite{palma2023predicting,hung2024lumic,bourou2024phendiff}.

We demonstrate the effectiveness of \emph{CellFlow} on three datasets: BBBC021 (chemical perturbations)~\cite{caie2010high}, RxRx1 (genetic modifications via CRISPR or ORF)~\cite{sypetkowski2023rxrx1}, and JUMP (combined chemical and genetic perturbations)~\cite{chandrasekaran2023jump}. \emph{CellFlow} generates high-fidelity images of cellular changes in response to perturbations across all datasets, improving FID scores by 35\% over previous approaches. The generated images capture meaningful biological patterns, demonstrated by a 12\% improvement in predicting mode-of-action compared to existing methods (Figure~\ref{fig:overview}e). Importantly, \emph{CellFlow} maintains consistent performance across diverse experimental conditions and generalizes to held-out perturbations never seen during training, showing its broad applicability. 

Moreover, \emph{CellFlow} introduces two key capabilities with significant potential for biological research (Figure~\ref{fig:interpolation}). First, it effectively corrects batch effects by conditioning on control cells from different batches. By comparing control images with generated images, it can disentangle true perturbation-induced morphological changes from experimental batch artifacts. Second, \emph{CellFlow} enables bidirectional interpolation between cellular states due to the continuous and reversible nature of the velocity field in flow matching. This interpolation provides a means to explore intermediate cellular morphologies and potentially gain deeper insights into dynamic perturbation responses.

In summary, by formulating cellular morphology prediction as a distribution-to-distribution problem and using flow matching as a solution, \emph{CellFlow} enables accurate prediction of perturbation responses (Figure~\ref{fig:overview}). \emph{CellFlow} not only achieves state-of-the-art performance but unlocks new capabilities such as handling batch effects or visualizing cellular state transitions, significantly advancing the field towards a virtual cell for drug discovery and personalized therapy.
