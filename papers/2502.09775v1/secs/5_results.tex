\input{tabs/ablation}

\section{Results}
\label{sec:results}

In this section, we present detailed results demonstrating \emph{CellFlow}'s state-of-the-art performance in cellular morphology prediction under perturbations, outperforming existing methods across multiple datasets and evaluation metrics.

\subsection{Datasets}

Our experiments were conducted using three cell imaging perturbation datasets: BBBC021 (chemical perturbation)~\cite{caie2010high}, RxRx1 (genetic perturbation)~\cite{sypetkowski2023rxrx1}, and the JUMP dataset (combined perturbation)~\cite{chandrasekaran2023jump}. We followed the preprocessing protocol from IMPA~\cite{palma2023predicting}, which involves correcting illumination, cropping images centered on nuclei to a resolution of 96×96, and filtering out low-quality images. The resulting datasets include 98K, 171K, and 424K images with 3, 5, and 6 channels, respectively, from 26, 1,042, and 747 perturbation types. Examples of these images are provided in Figure~\ref{fig:comparison}. Details of datasets are provided in \S\ref{sec:data}.

\subsection{Experimental Setup}

\textbf{Evaluation metrics.} We evaluate methods using two types of metrics: (1) FID and KID, which measure image distribution similarity via Fréchet and kernel-based distances, computed on 5K generated images for BBBC021 and 100 randomly selected perturbation classes for RxRx1 and JUMP; we report both overall scores across all samples and conditional scores per perturbation class. (2) Mode of Action (MoA) classification accuracy, which assesses biological fidelity by using a trained classifier to predict a drug’s effect from perturbed images and comparing it to its known MoA from the literature.

\textbf{Baselines.} We compare our approach against two baselines, PhenDiff~\cite{bourou2024phendiff} and IMPA~\cite{palma2023predicting}, the only two baselines that incorporate control images into their model design --- a crucial setup for distinguishing true perturbation effects from artifacts such as batch effects. PhenDiff uses diffusion models to first map control images to noise and then transform the noise into target images. In contrast, IMPA employs GANs with an AdaIN layer to transfer the style of control images to target images, specifically designed for paired image-to-image mappings. Our method uses flow matching, which is tailored for distribution-to-distribution mapping, providing a more suitable solution for our problem. We reproduce these baselines with official codes.

\textbf{Training details.} \emph{CellFlow} employs a UNet-based velocity field with a four-stage design. Perturbations are encoded following IMPA~\cite{palma2023predicting}. Training is conducted for 100 epochs on 4 A100 GPUs. Details are in \S\ref{sec:experimental}.

\input{tabs/qualitative}

\subsection{Main Results}

\textbf{\emph{CellFlow} generates highly realistic cell images.}  
\emph{CellFlow} outperforms existing methods in capturing cellular morphology across all datasets (Table~\ref{tab:results}a), achieving overall FID scores of 18.7, 33.0, and 9.0 on BBBC021, RxRx1, and JUMP, respectively --- improving FID by 21\%–45\% compared to previous methods. These gains in both FID and KID metrics confirm that \emph{CellFlow} produces significantly more realistic cell images than prior approaches.

\textbf{\emph{CellFlow} accurately captures perturbation-specific morphological changes.}  
As shown in Table~\ref{tab:results}a, \emph{CellFlow} achieves conditional FID scores of 56.8 (a 26\% improvement), 163.5, and 84.4 (a 16\% improvement) on BBBC021, RxRx1, and JUMP, respectively. These scores are computed by measuring the distribution distance for each specific perturbation and averaging across all perturbations.   
Table~\ref{tab:results}b further highlights \emph{CellFlow}’s performance on six representative chemical and three genetic perturbations. For chemical perturbations, \emph{CellFlow} reduces FID scores by 14–55\% compared to prior methods.
The smaller improvement (5–12\% improvements) on RxRx1 is likely due to the limited number of images per perturbation type.

\textbf{\emph{CellFlow} preserves biological fidelity across perturbation conditions.} 
Table~\ref{tab:ablation}a presents mode of action (MoA) classification accuracy on the BBBC021 dataset using generated cell images. MoA describes how a drug affects cellular function and can be inferred from morphology. To assess this, we train an image classifier on real perturbed images and test it on generated ones. \emph{CellFlow} achieves 71.1\% MoA accuracy, closely matching real images (72.4\%) and significantly surpassing other methods (best: 63.7\%), demonstrating its ability to maintain biological fidelity across perturbations. Qualitative comparisons in Figure~\ref{fig:comparison} further highlight \emph{CellFlow}’s accuracy in capturing key biological effects. For example, demecolcine produces smaller, fragmented nuclei, which other methods fail to reproduce accurately.

\textbf{\emph{CellFlow} generalizes to out-of-distribution (OOD) perturbations.}  
On BBBC021, \emph{CellFlow} demonstrates strong generalization to novel chemical perturbations never seen during training (Table~\ref{tab:ablation}b). It achieves 6\% and 28\% improvements in overall and conditional FID over the best baseline. This OOD generalization is critical for biological research, enabling the exploration of previously untested interventions and the design of new drugs.

\textbf{Ablations highlight the importance of each component in \emph{CellFlow}.}  
Table~\ref{tab:ablation}c shows that removing conditional information, classifier-free guidance, or noise augmentation significantly degrades performance, leading to higher FID scores. These underscore the critical role of each component in enabling \emph{CellFlow}’s state-of-the-art performance.  

\input{tabs/capability}

\subsection{New Capabilities}

\textbf{\emph{CellFlow} addresses batch effects and reveals true perturbation effects.}  
\emph{CellFlow}’s distribution-to-distribution approach effectively addresses batch effects, a significant challenge in biological experimental data collection. As shown in Figure~\ref{fig:interpolation}a, when conditioned on two distinct control images with varying cell densities from different batches, \emph{CellFlow} consistently generates the expected perturbation effect (cell shrinkage due to mevinolin) while recapitulating batch-specific artifacts, revealing the true perturbation effect. Table~\ref{tab:ablation}d further quantifies the importance of conditioning on the same batch. By comparing generated images conditioned on control images from the same or different batches against the target perturbation images, we find that same-batch conditioning reduces overall and conditional FID by 21\%. This highlights the importance of modeling control images to more accurately capture true perturbation effects—an aspect often overlooked by prior approaches, such as diffusion models that initialize from noise (Figure~\ref{fig:interpolation}b).

\textbf{\emph{CellFlow} has the potential to model cellular morphological change trajectories.}
Cell trajectories could offer valuable information about perturbation mechanisms, but capturing them with current imaging technologies remains challenging due to their destructive nature. Since \emph{CellFlow} continuously transforms the source distribution into the target distribution, it can generate smooth interpolation paths between initial and final predicted cell states, producing video-like sequences of cellular transformation based on given source images (Figure~\ref{fig:interpolation}a). This suggests a possible approach for simulating morphological trajectories during perturbation response, which diffusion methods cannot achieve (Figure~\ref{fig:interpolation}b). Additionally, the reversible distribution transformation learned through flow matching enables \emph{CellFlow} to model backward cell state reversion (Figure~\ref{fig:interpolation}c), which could be useful for studying recovery dynamics and predicting potential treatment outcomes.
