\newcommand{\nodedistance}{4 cm}
\newcommand{\squareside}{2.5 cm}
\tikzstyle{arrow style}=[text width=(\nodedistance - .75 cm),midway,above, minimum height=0cm, minimum width=0cm]
\begin{tikzpicture}[anchor=center, minimum width=\squareside, text width=(\squareside - .75 cm), align=center, minimum height=\squareside,auto,>=stealth']

    \node(rect) [draw] (MMU) {MMU};
    \node(rect) [draw, right = \nodedistance of MMU] (CCI) {CCI};
    \node(rect) [draw, below = \nodedistance/2 of MMU] (DRAM) {DRAM};

    \node(rect) [draw, right = \nodedistance of CCI] (ace) {Coherence Interface};

    \node(rect) [draw, below = \nodedistance/2 of ace] (axi) {DRAM Interface};

    \node(rect) [draw, right = \nodedistance of ace] (pathcheck) {Path checker};
    \node(rect) [draw, right = \nodedistance of axi] (manipulator) {PTEs\\manipulator};
    
    % \node(rect) [draw, right = \nodedistance of ace] (module) {\sname};

    % \node [draw, node distance=0cm, minimum width=0cm, minimum height=0cm, above left = .5cm \nodedistance of ace] {X};

    \newcommand\svncol{2}
    \newcommand\svnrow{2}

    \newcommand\svnwidth{\nodedistance * (\svncol - 1) + \squareside * \svncol + .5 cm}
    \newcommand\svnheight{\nodedistance/2 * (\svnrow - 1) + \squareside * \svnrow + .5 cm}

    % \newcommand{\svnhordelta}{\nodedistance * .5 + \squareside + .5 cm}
    % \newcommand{\svnverdelta}{\nodedistance * .5 + \squareside + .5 cm}
    
    \newcommand{\svnside}{\nodedistance * 1 + \squareside * 2 + .5 cm}
    \newcommand{\svndelta}{\squareside + 1.3 cm}

    \node(rect) [draw, dotted, below right = - (\svndelta) of ace, minimum width=\svnwidth, minimum height=\svnheight] (pd) {};
    \node [above= -.75 cm of pd.south] () {\textbf{\LARGE \sname (FPGA)}};

    \draw[->] (MMU.36) -- node [arrow style] {1) Coherent read} (CCI.144) {};
    \draw[->] (CCI.39) -- node [arrow style] {2) Snoop request} (ace.141) {};
    \draw[->] (ace.30) -- node [arrow style] {3) Check address} (pathcheck.150) {};
    
    \draw[->] (pathcheck) -- node [arrow style] {4a) Match} (ace) {};
    \draw[->] (ace.167) -- node [arrow style] {5a) ACK (Hit)} (CCI.13) {};
    \draw[->] (ace.248) -- node [arrow style, rotate=90, text width=1.5cm, align=center] {6a) Read request} (axi.112) {};
    \draw[->] (axi.158) -- node [arrow style] {7a) Read request} (DRAM.22) {};
    \draw[->] (DRAM.330) -- node [arrow style] {8a) Read data} (axi.210) {};
    \draw[->] (axi) -- node [arrow style] {9a) Read data} (manipulator) {};
    \draw[->] (manipulator) |- node [arrow style] {10a) Manipulated data}| (ace.292) {};
    \draw[->] (ace.219) -- node [arrow style] {11a) Altered data} (CCI.321) {};
    \draw[->] (CCI) -- node [arrow style] {12a) Altered data} (MMU) {};
    % \draw[->] (ace.292) -- node [arrow style, rotate=90] {5a) Read request} (axi.68) {};

    % \draw[-, dotted] (10, 1.75) -- +(0,-8) {};
    % \node[] (10,-6.25) [] {PE};
    
    \draw[->, dotted] (pathcheck.210) -- node [arrow style] {4b) No Match} (ace.330) {};
    \draw[->, dotted] (ace.193) -- node [arrow style] {5b) NACK (Miss)} (CCI.347) {};
    \draw[->, dotted] (CCI.292) |- node [arrow style] {6b) Read request}|[ratio=0.66] (DRAM.78);
    \draw[->, dotted] (DRAM.112) |- node [arrow style] {7b) Read data}|[ratio=.66] (CCI.258);
    \draw[->, dotted] (CCI.210) -- node [arrow style] {8b) Unaltered data} (MMU.330) {};

    
    
\end{tikzpicture}