\section{Experiments}
\label{sec:exp}

% We evaluate the proposed multiPCM and MXMap on simulated and real-world dynamical systems as described in the Section~\ref{sec:data} below. MXMap performance is then compared with several established multivariate causal inference methods, including RESIT~\citep{peters2014causal}, PC~\citep{spirtes2001causation}, Fast Causal Inference (FCI)~\citep{spirtes2013causal}, LiNGAM~\citep{shimizu2006linear}, and PC with Momentary Condition Independence (PCMCI)~\citep{runge2019detecting}. Overview of these methods and how the outputs of each model are interpreted can be found in Appendix~\ref{appsec:baseline_methods}. For RESIT and LiNGAM, we adopt python implementations in the \texttt{LiNGAM} library~\citep{shimizu2014lingam}; PC and FCI are from the \texttt{causal-learn} library~\citep{zheng2024causal}; PCMCI is from the \texttt{tigramite} library~\citep{runge2023causal}. Detailed experimental setup is provided in Appendix~\ref{appsec:exp_setup}.

We evaluate the proposed multiPCM and MXMap on simulated and real-world dynamical systems as described in the Section~\ref{sec:data} below. MXMap performance is then compared with several established multivariate causal inference methods), including RESIT~\citep{peters2014causal}, tsFCI~\citep{entner2010causal}, VAR-LiNGAM~\citep{hyvarinen2010estimation}, PCMCI~\citep{runge2019detecting}, Granger Causality~\citep{granger1969investigating}, DYNOTEARS~\citep{pamfil2020dynotears}, and SLARAC~\citep{weichwald2020causal}. Overview of these methods and how the outputs of each model are interpreted can be found in Appendix~\ref{appsec:baseline_methods}. 

For RESIT and VAR-LiNGAM, we adopt python implementations in the \texttt{LiNGAM} library~\citep{shimizu2014lingam}; tsFCI is adapted based on the implementation of FCI from the \texttt{causal-learn} library~\citep{zheng2024causal}; PCMCI is from the \texttt{tigramite} library~\citep{runge2023causal}; Granger Causality is also from \texttt{causal-learn}; DYNOTEARS is implemented using the \texttt{Causalnex}~\citep{Beaumont_CausalNex_2021} library; SLARAC is from the \texttt{tidybench} repository~\citep{weichwald2020causal}. Experimental setup is provided in Appendix~\ref{appsec:exp_setup}.

\subsection{Data}
\label{sec:data}

\subsubsection{Simulated Data: Species Interaction Systems}
\label{sec:genData}

Following similar data generation scheme as in~\cite{leng2020partial}, we generate the following systems of varying complexity, from 3-variable to 7-variable. These systems are derived and adapted from the Lotka-Volterra competition models~\citep{volterra1931theorie, lotka1925elements, roques2011probing} that characterize species interactions and exhibit chaotic behaviors. Examples of 3-species and 4-species systems are as Eq.~\ref{eq:3var} and Eq.~\ref{eq:4var}.

\begin{equation}
\label{eq:3var}
\begin{aligned}
x_t & =x_{t-1}\left(\alpha_x-\alpha_x x_{t-1}-\beta_{yx} y_{t-1}-\beta_{zx} z_{t-1}\right)\cdot\eta_{x}+\epsilon_{x} \\
y_t & =y_{t-1}\left(\alpha_y-\alpha_y y_{t-1}-\beta_{xy} x_{t-1}-\beta_{zy} z_{t-1}\right)\cdot\eta_{y}+\epsilon_{y} \\
z_t & =z_{t-1}\left(\alpha_z-\alpha_z z_{t-1}-\beta_{xz} x_{t-1}-\beta_{yz} y_{t-1}\right)\cdot\eta_{z}+\epsilon_{z}
\end{aligned}
\end{equation}
For the 3-species system (Eq.~\ref{eq:3var}), the coefficients $\alpha$ for autonomous dynamics are set respectively as $\alpha_x=3.70, \alpha_y=3.78, \alpha_z=3.72$.

\begin{equation}
\label{eq:4var}
\begin{aligned}
w_t & =w_{t-1}\left(\alpha_w-\alpha_w w_{t-1}-\beta_{xw} x_{t-1}-\beta_{yw} y_{t-1}-\beta_{zw} z_{t-1}\right)\cdot\eta_{w}+\epsilon_{w} \\
x_t & =x_{t-1}\left(\alpha_x-\alpha_x x_{t-1}-\beta_{wx} w_{t-1}-\beta_{yx} y_{t-1}-\beta_{zx} z_{t-1}\right)\cdot\eta_{x}+\epsilon_{x} \\
y_t & =y_{t-1}\left(\alpha_y-\alpha_y y_{t-1}-\beta_{wy} w_{t-1}-\beta_{xy} x_{t-1}-\beta_{zy} z_{t-1}\right)\cdot\eta_{y}+\epsilon_{y} \\
z_t & =z_{t-1}\left(\alpha_z-\alpha_z z_{t-1}-\beta_{wz} w_{t-1}-\beta_{xz} x_{t-1}-\beta_{yz} y_{t-1}\right)\cdot\eta_{z}+\epsilon_{z}
\end{aligned}
\end{equation}
For the 4-species system (Eq.~\ref{eq:4var}), the coefficients $\alpha_w=3.70, \alpha_x=3.78, \alpha_y=3.72, \alpha_z=3.70$ are used. For each system, the coupling coefficient $\beta_{ij}$ is either 0 or 0.35, depending on whether the causal interaction is present or absent. 

% An example of a 3-variable chain structure ($x \Rightarrow y \Rightarrow z$) in the 3-species system is as follows in Eq.~\ref{eq:3varChain}, with the interaction coefficients $\beta_{xy}, \beta_{yz}$ activated while all the other $\beta$ set to 0.

% \begin{equation}
% \label{eq:3varChain}
% \begin{aligned}
% x_t & =x_{t-1}\left(3.70-3.70 x_{t-1}\right)\cdot\eta_{x}+\epsilon_{x} \\
% y_t & =y_{t-1}\left(3.78-3.78 y_{t-1}-0.35 x_{t-1}\right)\cdot\eta_{y}+\epsilon_{y} \\
% z_t & =z_{t-1}\left(3.72-3.72 z_{t-1}-0.35 y_{t-1}\right)\cdot\eta_{z}+\epsilon_{z}
% \end{aligned}
% \end{equation}

For higher dimensional systems, we follow a similar logic, where the autonomous dynamics coefficients $\alpha$ are sampled in range $[3.70, 3.80)$, and the coupling coefficients $\beta$ are 0.35 when there is causal interaction between a variable pair (0 if no causal interaction). These systems are used to evaluate the effectiveness of multiPCM and MXMap in capturing both direct and indirect causal links in controlled scenarios. The ground truth causal structures of all used systems (from 3-variable to 7-variable) are demonstrated in Appendix~\ref{appsec:complet}.



\subsubsection{ERA5 Reanalysis Meteorological Data}

We also evaluate MXMap on real-world meteorological data from the ERA5 Global Reanalysis dataset~\citep{hersbach2020era5}, provided by the Copernicus program by ECMWF. The ERA5 dataset offers hourly climate variables over a global scale, allowing us to investigate causality in a practical environmental setting.

% We extract hourly winter data (December to February) for the Montreal region from 1981 to 2023. We evaluate the causal discovery methods on a causal chain: total cloud water ($tcw$) $\Rightarrow$ total radiation ($rad$) $\Rightarrow$ near-ground temperature ($T_{2m}$). This causal chain is particularly pronounced in winter, where cloud coverage directly impacts radiation levels, which in turn affects near-ground temperature (Explanation of this mechanism provided in Appendix~\ref{appsec:weather-chain}). By focusing exclusively on winter data, we capture this chain as the most prominent phenomenon, providing an ideal test case for assessing MXMap's effectiveness in uncovering causal relationships within complex, real-world environmental systems.

We extract hourly winter data (December to February) for the Montreal region from 1981 to 2023. Two experimental setups were designed to assess the effectiveness of causal discovery methods:

\begin{itemize}
    \item \textbf{3V Chain}: 
    A simplified 3-variable system capturing the causal chain: $tcw \Rightarrow rad \Rightarrow  T_{2m}$. 
    This causal chain is particularly pronounced in winter when cloud coverage strongly affects radiation levels, which subsequently modulate ground-level temperatures.
    \item \textbf{5V System}: This system includes solar radiation ($rad_{solar}$), terrestrial radiation ($rad_{terr}$), near-ground temperature advection ($T_{adv950}$), total cloud water ($tcw$) and near-ground temperature ($T_{2m}$). This setup examines whether well-established causal relationships can be detected, namely $rad_{solar} \Rightarrow T_{2m}$, $rad_{terr} \Rightarrow T_{2m}$, $T_{adv950} \Rightarrow T_{2m}$, $tcw\Rightarrow rad_{solar}$. 
    The 5V system builds on the 3V chain by introducing two radiation components as well as a temperature advection term. While the complete causal graph of this system is not fully established due to its complexity, the bivariate relationships outlined above are well-supported in meteorological literature and provide a robust benchmark for evaluation.
\end{itemize}

Detailed explanations of these mechanisms and meteorological contexts are provided in Appendix~\ref{appsec:era5}. By focusing on winter data, when these causal mechanisms are most pronounced, these setups serve as an ideal test case for assessing MXMapâ€™s ability to uncover causal relationships in complex, real-world environmental systems.


\subsection{Validation of multiPCM}
\label{sec:valid_multiPCM}

To validate the effectiveness of multiPCM in distinguishing between direct and indirect causal relationships, we perform experiments on simulated four-variable systems generated without noise. Specifically, we evaluate three scenarios: purely direct causality, purely indirect causality, and combined direct and indirect causality, as illustrated in Table~\ref{tab:multiPCM}. The causal relationships of interest are highlighted in color, while the other variables are shown in gray and grouped together to form a multivariate embedding, used as the condition set ($Conds$) for multiPCM.

We use an input length of $L = 3500$ time steps for all tests and conduct multiPCM on a range of lag and embedding dimension values ($\tau, E \in \{1, 2, 3, \ldots, 8\}$). The results of the grid search are presented in Table~\ref{tab:multiPCM} (complete table with more cases in Appendix~\ref{appsec:valid_multiPCM}), where we analyze the correlation ratio $\gamma=\rho_{Direct}/\rho_{All}$ and the predicted labels indicating whether direct causality between colored nodes is rejected and to be removed based on a PCM threshold of 0.45 (this empirical threshold selection is discussed in Appendix~\ref{appsec:thres_multiPCM}). \textcolor{red}{Red} label indicates rejection, since only indirect causality exists; while \textcolor{blue}{blue} label indicates the existence direct causality, hence the link between colored nodes should be kept.

\begin{table}[htb]
\centering

\makebox[\linewidth]{%

\resizebox{0.85\textwidth}{!}{% Adjust the scaling factor to exceed column width

\begin{tabular}{c|c|c|c}
Type         & $Direct$ & $Indirect$ & $Both$ \\ \hline
Causality         &\begin{minipage}{.15\linewidth} \centering \includegraphics[width=0.3\linewidth]{imgs/ValidPCM/4VDirect.png} \end{minipage}& \begin{minipage}{.15\linewidth} \centering \includegraphics[width=0.3\linewidth]{imgs/ValidPCM/4VIndirect1.png} \end{minipage}   & \begin{minipage}{.15\linewidth} \centering \includegraphics[width=0.5\linewidth]{imgs/ValidPCM/4VBoth1.png} \end{minipage}   \\ \hline
$\rho_{All}$    &\begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VDirect_sc1.png} \end{minipage}& \begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VIndirect1_sc1.png} \end{minipage}    &  \begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VBoth1_sc1.png} \end{minipage}  \\ \hline
$\rho_{Direct}$ &\begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VDirect_sc2.png} \end{minipage}& \begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VIndirect1_sc2.png} \end{minipage}    & \begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VBoth1_sc2.png} \end{minipage} \\ \hline
Ratio             &\begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VDirect_ratio.png} \end{minipage}& \begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VIndirect1_ratio.png} \end{minipage}    & \begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VBoth1_ratio.png} \end{minipage}  \\ \hline
Label    &\begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VDirect_label.png} \end{minipage}& \begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VIndirect1_label.png} \end{minipage}    & \begin{minipage}{.3\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ValidPCM/4VBoth1_label.png} \end{minipage}
\end{tabular}

}

}

\caption{Performance of multiPCM (Full Table in Appendix~\ref{appsec:valid_multiPCM}): Profiles of correlation scores, correlation ratios, predicted label ($thres=0.45$) under grid search. Red dot indicates there isn't direct causality between the colored nodes, while blue indicates there is direct causality between the colored nodes.}

\label{tab:multiPCM}

\end{table}


The experimental results demonstrate the effectiveness of multiPCM in distinguishing direct and indirect causal relationships under different scenarios:
\begin{enumerate}
    \item \textbf{Direct Causality:} For cases involving direct causality ($Direct$ and $Both$), we observe that both correlation scores, $\rho_{All}$ and $\rho_{Direct}$, are significantly higher when the lag $\tau$ is small, and start dropping as lag increases. This trend is also consistent with observations from previous works on cross mapping in nonlinear systems.
    \item \textbf{Indirect Causality:} In the case of purely indirect causality, the correlation profiles tend to be inconsistent across different lags and embedding dimensions, showing fluctuating surfaces rather than a clear decreasing trend. This behavior is characteristic of indirect interactions, as these relationships become weaker and more unstable with increasing delay.
    \item \textbf{Optimal Hyperparameter Range:} 
    The grid search results for predicted labels further illustrate the behavior of multiPCM. There exists an ideal range of lag and embedding dimension values for accurately inferring causality: Here in Table~\ref{tab:multiPCM}, when the multiPCM lag ($\tau$) is less than 2 and the embedding dimension ($E$) is in the interval of $[3, 8]$, multiPCM produces consistent and accurate results across these three causal structures. In practice, if the approximate system dimension and timescale of the lag are known, the appropriate selections for $\tau$ and $E$ would likely align closely with the ground truth values: For the demonstrated 3-variable (3V) and 4-variable (4V) systems, the actual system dimension is 3 or 4, the generating dynamics use a lag of 1 (All these ground-truth $\tau$ and $E$ values fall in the detected ranges above). Notably, the selection of $E$ seems to be more tolerant for slight overestimation when the true state dimension is unknown. Thus, when the exact ground truth is unavailable, a slightly higher dimension for delay embedding may still yield reliable results, and can potentially help account for latent variables.
\end{enumerate}

These observations show that multiPCM is capable of correctly distinguishing direct and indirect causalities in multivariate scenarios. By performing cross mapping with multivariate embeddings, multiPCM achieves consistent causal inference that is robust across different lag and embedding dimension configurations.



\subsection{Prediction Consistency}

Mirage correlations are common in nonlinear dynamical systems. Coupled nonlinear systems often exhibit transient correlations between variables, which may change or disappear entirely when different subsequences are sampled. This presents a significant challenge for causal discovery, particularly for methods relying on consistent predictive relationships, such as Granger causality. The original CCM paper~\cite{sugihara2012detecting} illustrated this phenomenon using a bivariate system of competing species.

\begin{figure}[htb]
    \centering
    \begin{minipage}[b]{0.31\linewidth}
        \centering
        \includegraphics[width=\linewidth]{imgs/PredConsi/4varChain2.png}
        \captionsetup{justification=centering}
        \caption*{(a) Subsequence 1}
    \end{minipage}
    \begin{minipage}[b]{0.31\linewidth}
        \centering
        \includegraphics[width=\linewidth]{imgs/PredConsi/4varChain1.png}
        \captionsetup{justification=centering}
        \caption*{(b) Subsequence 2}
    \end{minipage}
    \begin{minipage}[b]{0.31\linewidth}
        \centering
        \includegraphics[width=\linewidth]{imgs/PredConsi/4varChain3.png}
        \captionsetup{justification=centering}
        \caption*{(c) Subsequence 3}
    \end{minipage}
    % \begin{minipage}[b]{0.245\linewidth}
    %     \centering
    %     \includegraphics[width=\linewidth]{imgs/PredConsi/4varChain4.png}
    %     \captionsetup{justification=centering}
    %     \caption*{(d) Subsequence 4}
    % \end{minipage}
    % \caption{Visualizations of subsequences from a 4-species chain system. \textcolor{red}{Di: please briefly explain the findings of these four figures here} }
    \caption{Visualizations of subsequences from a 4-species chain system: In the same sequence, correlations between variables can be positive, negative or zero when sampling from different start points.}
    \label{fig:4varChainNoNoise}
\end{figure}


To evaluate the robustness of our proposed approach in such scenarios, we first illustrate the chaotic behavior and mirage correlations in the noise-free four-species chain system ($w \Rightarrow x \Rightarrow y \Rightarrow z$), as defined in Section~\ref{sec:genData}. We randomly sample different starting points and visualize subsequences (of length 25) from these sampled points in Fig.~\ref{fig:4varChainNoNoise}. As shown, the correlations between variables vary widely across different subsequences, exhibiting positive, near-zero, and even negative correlations.

\begin{table}[htb]
\centering

\resizebox{1.0\textwidth}{!}{
\begin{tabular}{l|c|ccccc}
\textbf{Model}            & \textbf{  MXMap  } & \multicolumn{5}{c}{\textbf{RESIT-MLP}}                                                                             \\ \hline
\textbf{Prediction} &   
\begin{minipage}{.045\textwidth}
\centering
    \includegraphics[width=\linewidth]{imgs/PredConsi/4varChain_mxmap.png}
\end{minipage} 
& \multicolumn{1}{c|}{
\begin{minipage}{.12\textwidth}
\centering
    \includegraphics[width=\linewidth]{imgs/PredConsi/4varChain_RESIT1.png}
\end{minipage} 
}  & \multicolumn{1}{c|}{
\begin{minipage}{.12\textwidth}
\centering
    \includegraphics[width=\linewidth]{imgs/PredConsi/4varChain_RESIT2.png}
\end{minipage} 
}  & \multicolumn{1}{c|}{
\begin{minipage}{.12\textwidth}
\centering
    \includegraphics[width=\linewidth]{imgs/PredConsi/4varChain_RESIT3.png}
\end{minipage} 
}  & \multicolumn{1}{c|}{
\begin{minipage}{.12\textwidth}
\centering
    \includegraphics[width=\linewidth]{imgs/PredConsi/4varChain_RESIT4.png}
\end{minipage} 
}  & 
\begin{minipage}{.12\textwidth}
\centering
    \includegraphics[width=\linewidth]{imgs/PredConsi/4varChain_RESIT5.png}
\end{minipage} 
\\ \hline
\textbf{Precision}            & \textbf{1.0}    & \multicolumn{1}{c|}{0.5000} & \multicolumn{1}{c|}{0.3333} & \multicolumn{1}{c|}{0.2500} & \multicolumn{1}{c|}{0.5000} & 0.4000
\\ \hline
\textbf{Recall}            & \textbf{1.0}    & \multicolumn{1}{c|}{1.0} & \multicolumn{1}{c|}{0.6667} & \multicolumn{1}{c|}{0.3333} & \multicolumn{1}{c|}{0.6667} & 0.6667
\\ \hline
\textbf{F1}            & \textbf{1.0}    & \multicolumn{1}{c|}{0.6667} & \multicolumn{1}{c|}{0.4444} & \multicolumn{1}{c|}{0.2857} & \multicolumn{1}{c|}{0.5714} & 0.5000
\\ \hline
\textbf{SHD}            & \textbf{0}    & \multicolumn{1}{c|}{3} & \multicolumn{1}{c|}{5} & \multicolumn{1}{c|}{5} & \multicolumn{1}{c|}{3} & 4
\\ \hline
\textbf{Count}            & \textbf{10}    & \multicolumn{1}{c|}{4} & \multicolumn{1}{c|}{3} & \multicolumn{1}{c|}{1} & \multicolumn{1}{c|}{1} & 1
\end{tabular}
}

\caption{Comparison of MXMap and RESIT-MLP on 10 randomly sampled segments from a 4-species chain system $w \Rightarrow x \Rightarrow y \Rightarrow z$.}

\label{tab:PredCons}

\end{table}


To further assess prediction consistency, we apply the MXMap and RESIT (recapitulation in Appendix~\ref{appsec:resit}) frameworks to different segments of the sequences to determine the causal order of variables. Specifically, we generate 10 random positive integers as starting timestamps to sample 10 test sequences from the 4-species chain system (Eq.~\ref{eq:4var}), each with a length of 3500.

For MXMap, we select a $k$-nearest neighbor ($k$NN) size of 10, a PCM correlation ratio threshold of 0.6, and delay embedding parameters $\tau = 2$ and $dim = 6$. For RESIT, we used the scikit-learn MLP regressor with two layers of 32 units each, along with an HSIC threshold ($\alpha = 0.01$) for edge removal. 

Table~\ref{tab:PredCons} shows the results (evaluation metrics listed in Appendix~\ref{appsec:metrics}). MXMap consistently determined the correct causal order across all sampled segments, yielding stable predictions with perfect precision, recall, and F1 scores. In contrast, RESIT-MLP's predictions varied significantly depending on the starting point of each sequence. The causal graph predicted by RESIT changed across different segments, illustrating the sensitivity of its prediction to initial conditions due to the underlying predictive model assumption. Additionally, MXMap achieved better evaluation metrics across all four selected metrics.

\subsection{Comparison with Other Established Causal Inference Methods}

To demonstrate the effectiveness of MXMap in multivariate causal inference for nonlinear dynamical systems, we compare its performance on simulated multivariate dynamical systems (including cycles) with baseline methods (tsFCI, VAR-LiNGAM, PCMCI, Granger Causality, DYNOTEARS, SLARAC). When interpreting the predicted outputs, we consider non-oriented causal edges and bidirectional causal edges equivalent, which is in turn reflected in the metric calculation. 


\subsubsection{Simulated Systems}
\label{sec:baseline_sim}

\begin{table}[htb]
\makebox[\linewidth]{%

\resizebox{0.95\textwidth}{!}{% Adjust the scaling factor to exceed column width

\begin{tabular}{l|cc|cc|cc|cc}
\multicolumn{1}{c|}{\multirow{2}{*}{Structure}} & \multicolumn{2}{c|}{3V Chain}                             & \multicolumn{2}{c|}{3V Immorality}                        & \multicolumn{2}{c|}{3V No Cycle}                          & \multicolumn{2}{c}{3V Cycle}                             \\ \cline{2-9} 
\multicolumn{1}{c|}{}                           & \multicolumn{1}{l}{No Noise} & \multicolumn{1}{l|}{Noise} & \multicolumn{1}{l}{No Noise} & \multicolumn{1}{l|}{Noise} & \multicolumn{1}{l}{No Noise} & \multicolumn{1}{l|}{Noise} & \multicolumn{1}{l}{No Noise} & \multicolumn{1}{l}{Noise} \\ \hline
tsFCI                                           & 4                            & 3                          & 2                            & 2                          & 6                            & 4                          & 3                            & 5                         \\
VARLiNGAM                                       & 2                            & 4                          & 4                            & 4                          & 5                            & 6                          & 3                            & 4                         \\
Granger                                         & 4                            & 4                          & 4                            & 4                          & 5                            & 6                          & 2                            & 4                         \\
PCMCI                                           & \textbf{1}                   & \textbf{0}                 & \textbf{0}                   & \textbf{0}                 & 2                            & 1                          & 3                            & 3                         \\
DYNOTEARS                                       & 3                            & 4                          & 2                            & 2                          & 3                            & 1                          & 5                            & 3                         \\
SLARAC                                          & 6                            & 6                          & 6                            & 6                          & 5                            & 6                          & 5                            & 4                         \\ \hline
MXMap                                           & \textbf{1}                   & \textbf{0}                 & 1                            & \textbf{0}                 & \textbf{0}                   & \textbf{0}                 & \textbf{0}                   & \textbf{0}               
\end{tabular}
} }
\caption{SHD scores of MXMap and baselines for 3V settings on simulated no-noise and noisy dynamical systems.}
\label{tab:mxmap-sim-3V}
\end{table}

\begin{table}[htb]
\makebox[\linewidth]{%

\resizebox{0.72\textwidth}{!}{% Adjust the scaling factor to exceed column width

\begin{tabular}{l|cc|cc|cc}
\multicolumn{1}{c|}{\multirow{2}{*}{Structure}} & \multicolumn{2}{c|}{4V Chain}                             & \multicolumn{2}{c|}{4V No Cycle}                          & \multicolumn{2}{c}{4V Cycle}                             \\ \cline{2-7} 
\multicolumn{1}{c|}{}                           & \multicolumn{1}{l}{No Noise} & \multicolumn{1}{l|}{Noise} & \multicolumn{1}{l}{No Noise} & \multicolumn{1}{l|}{Noise} & \multicolumn{1}{l}{No Noise} & \multicolumn{1}{l}{Noise} \\ \hline
tsFCI                                           & 3                            & 3                          & 5                            & 4                          & 4                            & 6                         \\
VARLiNGAM                                       & 4                            & 6                          & 7                            & 8                          & 4                            & 5                         \\
Granger                                         & 4                            & 6                          & 5                            & 8                          & 3                            & 6                         \\
PCMCI                                           & 1                            & \textbf{0}                 & \textbf{1}                   & \textbf{1}                 & 8                            & 4                         \\
DYNOTEARS                                       & 7                            & 10                         & 3                            & \textbf{1}                 & 7                            & 6                         \\
SLARAC                                          & 10                           & 10                         & 3                            & 2                          & 5                            & 6                         \\ \hline
MXMap                                           & \textbf{0}                   & \textbf{0}                 & \textbf{1}                   & \textbf{1}                 & \textbf{0}                   & \textbf{2}               
\end{tabular}
} }
\caption{SHD scores of MXMap and baselines for 4V settings on simulated no-noise and noisy dynamical systems.}
\label{tab:mxmap-sim-4V}
\end{table}

\begin{table}[htb]
\makebox[\linewidth]{%

\resizebox{0.95\textwidth}{!}{% Adjust the scaling factor to exceed column width

\begin{tabular}{l|cc|cc|cc|cc}
\multicolumn{1}{c|}{\multirow{2}{*}{Structure}} & \multicolumn{2}{c|}{5V  No Cycle}                         & \multicolumn{2}{c|}{5V  Cycle}                            & \multicolumn{2}{c|}{6V  No Cycle}                         & \multicolumn{2}{c}{7V  Cycle}                            \\ \cline{2-9} 
\multicolumn{1}{c|}{}                           & \multicolumn{1}{l}{No Noise} & \multicolumn{1}{l|}{Noise} & \multicolumn{1}{l}{No Noise} & \multicolumn{1}{l|}{Noise} & \multicolumn{1}{l}{No Noise} & \multicolumn{1}{l|}{Noise} & \multicolumn{1}{l}{No Noise} & \multicolumn{1}{l}{Noise} \\ \hline
tsFCI                                           & 7                            & 4                          & 6                            & 8                          & 10                           & 11                         & 10                           & 10                        \\
VARLiNGAM                                       & 6                            & 6                          & 12                           & 12                         & 9                            & 11                         & 16                           & 15                        \\
Granger                                         & 6                            & 6                          & 12                           & 12                         & 11                           & 12                         & 15                           & 15                        \\
PCMCI                                           & 5                            & 5                          & 5                            & \textbf{2}                 & 11                           & \textbf{3}                 & 11                           & 10                        \\
DYNOTEARS                                       & 8                            & 15                         & 11                           & 12                         & 19                           & 18                         & 16                           & 22                        \\
SLARAC                                          & 16                           & 16                         & 18                           & 18                         & 25                           & 27                         & 21                           & 25                        \\ \hline
MXMap                                           & \textbf{1}                   & \textbf{1}                 & \textbf{0}                   & \textbf{2}                 & \textbf{2}                   & 4                          & \textbf{4}                   & \textbf{6}               
\end{tabular}
} }
\caption{SHD scores of MXMap and baselines for 5V-7V settings on simulated no-noise and noisy dynamical systems.}
\label{tab:mxmap-sim-5-7V}
\end{table}


Tables \ref{tab:mxmap-sim-3V}, \ref{tab:mxmap-sim-4V} and \ref{tab:mxmap-sim-5-7V} show the results of SHD scores (best in bold) on simulated systems with varying complexity from 3 to 7 variables. A more complete evaluation with all four metrics ($Prec$, $Rec$, $F1$, and $SHD$), along with visualizations of ground truth graphs, predicted causal graphs, is provided in Appendix~\ref{appsec:complet}. The time series data are generated under both noise-free and noisy settings (Gaussian additive noise, strength 0.01). 
% Visualizations of the ground truth and predicted graphs are provided in the Appendix~\ref{appsec:complet}. 
Overall, MXMap consistently achieves good performance the baselines, yielding lower SHD scores which indicate fewer incorrect edges in the predicted causal graphs.



\subsubsection{ERA5 3-Variable Chain: $tcw \Rightarrow rad \Rightarrow  T_{2m}$}
\label{sec:weather_chain}

\begin{table}[hbt]
\centering
\resizebox{0.7\textwidth}{!}{
\begin{tabular}{c|cccc|c}
Method & \multicolumn{1}{c}{PC} & \multicolumn{1}{c}{FCI} & \multicolumn{1}{c}{LiNGAM} & \multicolumn{1}{c|}{PCMCI}& \multicolumn{1}{c}{MXMap} \\ \hline
Output & \begin{minipage}{.06\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ERA5/pc-fci-era5.png} \end{minipage} & \begin{minipage}{.06\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ERA5/pc-fci-era5.png} \end{minipage} & \begin{minipage}{.12\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ERA5/lingam-era5.png} \end{minipage} & \begin{minipage}{.06\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ERA5/pcmci-era5.png} \end{minipage} & \begin{minipage}{.06\linewidth} \centering \includegraphics[width=\linewidth]{imgs/ERA5/mxmap-era5.png} \end{minipage}  \\ \hline
$Prec$ & 0.33 & 0.33  & 0  & 0.50  & \textbf{0.67} \\ \hline
$Rec$ & \textbf{1.0} & \textbf{1.0}  & 0  & \textbf{1.0}  & \textbf{1.0} \\ \hline
$F1$ & 0.50  & 0.50  & 0  & 0.67  & \textbf{0.80} \\ \hline
$SHD$   & 4  & 4  & 4  & 2  & \textbf{1}                        
\end{tabular}
}
\caption{Causal inference methods on the ERA5 3V system.}
\label{tab:mxmap-era5}
\end{table}

For inferring the chain $tcw \Rightarrow rad \Rightarrow T_{2m}$, we take input sequence length of 6000, and consider the lag $\tau$ value to be 4 (for the lag value of delay embedding formulation, and max lag of the PCMCI method) While other methods either failed to identify causal directions correctly or predicted incorrect causal orders, MXMap consistently maintained the correct causal order and produced results closest to the expected ground truth.

\subsubsection{ERA5 5-Variable System: $tcw$, $rad_{solar}$, $rad_{terr}$, $T_{adv950}$ and $T_{2m}$}
\label{sec:era5_5V_eval}

\begin{table}[htb]
\centering
\resizebox{1\textwidth}{!}{
\begin{tabular}{l|llllll|l}
Methods                          & tsFCI                            & VARLiNGAM                        & Granger                          & PCMCI                            & DYNOTEARS                        & SLARAC                           & MXMap      \\ \hline
% Output                           &                                  &                                  &                                  &                                  &                                  &                                  &            \\ \hline
$rad_{solar} \Rightarrow T_{2m}$ & \cmark                       & \halfcheckmark & \halfcheckmark & \halfcheckmark & \halfcheckmark & \xmark                           & \cmark \\
$rad_{terr} \Rightarrow T_{2m}$  & \halfcheckmark & \halfcheckmark & \cmark                       & \halfcheckmark & \xmark                           & \cmark                       & \cmark \\
$T_{adv950} \Rightarrow T_{2m}$  & \xmark                           & \halfcheckmark & \halfcheckmark & \halfcheckmark & \cmark                       & \halfcheckmark & \cmark \\
$tcw\Rightarrow rad_{solar}$     & \xmark                           & \xmark                           & \halfcheckmark & \cmark                       & \cmark                       & \cmark                       & \cmark
\end{tabular}
}
\caption{Detection of Benchmark Causal Relationships in the ERA5 5V System (full visualizations in Table~\ref{apptab:mxmap-era5-5V}). A checkmark (green) indicates a correctly detected and oriented edge, a half-checkmark (gray) denotes a detected but ambiguously oriented edge, and a crossmark (red) represents an undetected or incorrectly oriented edge.}
\label{tab:mxmap-era5-5V}
\end{table}

The objective is to evaluate the performance via observing how many of these well-established causal relationships are detected by the methods $rad_{solar} \Rightarrow T_{2m}$, $rad_{terr} \Rightarrow T_{2m}$, $T_{adv950} \Rightarrow T_{2m}$, $tcw\Rightarrow rad_{solar}$ (explanations of these mechanisms in Appendix~\ref{appsec:era5}, full table with predicted graphs in Table~\ref{apptab:mxmap-era5-5V} in Appendix~\ref{appsec:era5_eval}). The results in Table~\ref{tab:mxmap-era5-5V} show that MXMap is overall able to correctly identify and orient edges that represent the 4 benchmark causal mechanisms in the 5-variable system, and outperforms the other baseline methods.