%!TEX root = ../main.tex

\section{Note for discussion}
\label{sec:note}

\subsection{Jan 4}

\begin{itemize}
    \item Components
    \begin{enumerate}
        \item \teaser++: 3D-3D registration
        \item re\ransac: 2D-3D registration
        \item \glomap two-view filter: 3D-3D registration
    \end{enumerate}
    Finally we choose 
    \begin{enumerate}
        \item \nameshort purely as a baseline, denote by \nameshort
        \item \nameshort running for two times, denote by \xmdouble
        \item \xmdouble + re\ransac + \teaser++ as one pipline, denote by \xmdouble-T
        \item \xmdouble + \glomap two-view filter as another pipeline, denote by \xmdouble-F
    \end{enumerate}
    These three are all filters. These filter method now have the following thing we have not figured out:
    \begin{enumerate}[label={\checkmark}]
        \item \textcolor{red}{How to tune the hyper-parameters?}
        \item \textcolor{red}{It may cause the number of images decrease.}
        \item \textcolor{red}{It may make the view-graph sparse.}
    \end{enumerate}
    \item Neural rendering:
    Plan to use \colmap, seems glomap is not that stable.
    \item Breakdown plot
    \begin{enumerate}[label={\checkmark}]
        \item \textcolor{green}{Add solver time}
        \item \textcolor{green}{Remove \teaser + \ransac}
    \end{enumerate}
    \item Visualization
    \begin{enumerate}[label={\checkmark}]
        \item \textcolor{red}{Add circle rotation Visualization}
    \end{enumerate}
    \item Replica main table
    \begin{enumerate}[label={\checkmark}]
        \item \textcolor{green}{Change to median}
        \item \textcolor{green}{separate solve and propress time for glomap.}
    \end{enumerate}
    \item Suboptimality
    The math of suboptimility is here:
    For the problem with regularity term, the primal problem is:
    \begin{align}
    \min ~~&\langle C, X \rangle + Q(X)\\
    s.t. ~~&X \succ 0\\
    & \langle A_i, X \rangle = b_i, ~~\forall i
    \end{align}
    $Q(X)$ is a quadratic term defined by $Q(X) = \lambda \sum_i (X_{ii}-1)^2$. This is still a convex problem and the lagrangian is:
    \begin{align}
    L(X, y, Z) =& \langle C, X \rangle + Q(X) - \\&\sum_i y_i (\langle A_i, X \rangle - b_i) - \langle Z, X \rangle \\
    =& \langle C - \sum_i y_i A_i - Z, X \rangle + Q(X) + \sum_i y_i b_i
    \end{align}
    The KKT condition is:
    \begin{align}
    Z =& C + \nabla Q(X) - \sum_i y_i A_i \succ 0 \\
    \langle A_i, X \rangle =& b_i, ~~\forall i \\
    X \succ & 0 \\
    \langle Z, X \rangle = & 0
    \end{align}
    \red{For $Q(X) = 0$ I know to get $\inf L(X, y, Z)$  finite we need $C - \sum_i y_i A_i = Z \succ 0$. }
    Note $L$ is linear in the off-diagnol elements of $X$, and quadratic in the diagnol elements of $X$. To get the minimum finite, we need $(\nabla L)_{ij} = 0,~i\neq j$. For the diagnol elements, we need $(\nabla L)_{ij} = 0$ to get the minimal point. So together we will need $\nabla L = 0$, i.e.
    \begin{align}
    C - \sum_i y_i A_i - Z = -\nabla Q(X)
    \end{align}
    From diagnol we know $X_{ii} = -\frac{(C - \sum_i y_i A_i - Z)_{ii}}{2\lambda} + 1$. So we plug in $X$ then we get the dual problem:
    \begin{align}
    \max ~~&\sum_i b_i y_i - \frac{\sum_j (C - \sum_i y_i A_i - Z)_{jj}^2}{4\lambda} 
    \\ & + \sum_j (C - \sum_i y_i A_i - Z)_{jj} \\
    s.t. ~~&Z \succ 0\\
         ~~&(C - \sum_i y_i A_i - Z)_{ij} = 0, ~~i\neq j    
    \end{align}
    To derive the sub-optimality gap, we assume primal is feasible, then for all feasible $X$ we have:
    \begin{align}
    \langle C, X \rangle + Q(X) &\geq \langle C - \sum_i y_i A_i + \nabla Q(x) , X \rangle \\
    &+ \underbrace{\sum_i y_i b_i + Q(X) - \langle \nabla Q(X), X \rangle}_{\text{dual value}}\\
    &= \langle Z, X \rangle + p_{\text{dual}}\\
    &\geq \text{max}(0,\lambda_{\text{min}}(Z)) \text{tr}(X) + p_{\text{dual}}
    \end{align}
    then we define the sub-optimality gap as:
    \begin{align}
    p_{\text{primal}} - p_{\text{dual}} - \text{max}(0,\lambda_{\text{min}}(Z)) \text{tr}(X)
    \end{align}
\end{itemize}

\subsection{Jan 10}
\begin{itemize}
    \item Undistort images -- if it is radial camera, need to do undistortion
\end{itemize}
