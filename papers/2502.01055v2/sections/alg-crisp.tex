%!TEX root = main.tex

\begin{algorithm}[htp]
    \caption{\crisp}
    \label{alg:crisp}
    \SetAlgoLined
    \KwIn{Initial guess $x_0$}
    \KwParameter{$k_{\max}$, $\Delta_0$, $\Delta_{\max}$, $\mu_0$, $\mu_{\max}$, $\eta_{\text{low}}$, $\eta_{\text{high}}$, $\gamma_{\text{shrink}}$, $\gamma_{\text{expand}}$, $\epsilon_c$, $\epsilon_p$, $\epsilon_r$}
    Initialize $k \leftarrow 0$, $\mu \leftarrow \mu_0$, $\Delta_k \leftarrow \Delta_0$\;
    \While{$k < k_{\max}$}{
        Evaluate $f_k$, $\nabla f_k$, $\nabla^2_{xx} f_k$, $c_k$, and $\nabla c_k$ at $x_k$\;
        Construct and solve subproblem~\eqref{eq:subproblem-smooth} to obtain $p_k$\;
        Compute reduction ratio $\rho_k$\;
        // \texttt{\small{Second Order Correction}}\;
        \If{$\textup{ared}_k < 0$}{
            From~\prettyref{eq:second_order_correction}, calculate Second Order Correction Step $\Bar{p}_k$\;
            $p_k \leftarrow \Bar{p}_k$\;
            Re-compute reduction ratio $\rho_k$\;
            \If{$\textup{ared}_k < 0$}
            {Abandon the Step\;
            $\Delta_{k+1} \leftarrow \gamma_{\text{shrink}} \Delta_k$\;
            Go to Line 28\;
            }
        }
            // \texttt{\small{Trust Region Update}}\;
            \uIf{$\rho_k < \eta_{\text{low}}$}{
                $\Delta_{k+1} \leftarrow \gamma_{\text{shrink}} \Delta_k$\;
                $x_{k+1} \leftarrow x_k + p_k$\;
            }
            \uElseIf{$\rho_k > \eta_{\text{high}}$ and $\|p_k\|_{\infty} = \Delta_k$}{
                $\Delta_{k+1} \leftarrow \min\{\gamma_{\text{expand}}\Delta_k, \Delta_{\max}\}$\;
                $x_{k+1} \leftarrow x_k + p_k$\;
            }
            \Else{
                $\Delta_{k+1} \leftarrow \Delta_k$\;
                $x_{k+1} \leftarrow x_k + p_k$\;
            }
        
        // \texttt{\small{Check Convergence of Merit Function}}\;
        \If{$\Delta_{k+1} < \epsilon_r$ \textbf{or} $\|p_k\|_{\infty} < \epsilon_p$}{
        \texttt{\small{Merit Function Converged}}\;
        \texttt{\small{Check Overall Convergence}}\;
                \eIf{max constraint violation $ < \epsilon_c$}{
                    \Return{$x^* \leftarrow x_k$}\;
                    \texttt{\small{Optimization successful}}\;
                }{
                    \For{$i\in\calE$ with $|c_i(x_k)| \geq \epsilon_c$\\ \textbf{and} $i\in\calI$ with $[c_i(x_k)]^- \geq \epsilon_c$}{
                        $\mu_i \leftarrow \min(10\mu_i, \mu_{\max})$\;
                    }
                    \If{any $\mu_i > \mu_{\max}$}{
                        \Return{Failure}\; 
                        \texttt{\small{Penalty Max Out}}\;
                    }
                }
            
        }
        $k \leftarrow k + 1$\;
    }
    \texttt{\small{Max iterations reached\;}}
    \Return{Failure;}
    \end{algorithm}