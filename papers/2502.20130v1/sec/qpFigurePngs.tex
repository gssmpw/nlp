\newcommand{\featurevert}{.15cm}
\definecolor{mydarkgreen}{rgb}{0,0.5,0}
\begin{figure}
\centering
\resizebox{.9\linewidth}{!}{
\begin{tikzpicture}[node distance=.5cm]
           \node(feature_labelU) at (0, 0)[text width=1.3cm ] {Features};  
         \node[inner sep=0pt,below=.1cm of feature_labelU] (left1U) {\includegraphics[width=1.5cm]{QpImgs2/0_Color}};
         \node[inner sep=0pt, below=\featurevert of left1U] (left4U) {\includegraphics[width=1.5cm]{QpImgs2/Smoothed_54_Color}};
          \node[inner sep=0pt, below=\featurevert of left4U] (left3U) {\includegraphics[width=1.5cm]{QpImgs2/34_Color}};
        \node[inner sep=0pt,below=\featurevert of left3U] (left2U) {\includegraphics[width=1.5cm]{QpImgs2/35_Color}};
        


        \node[inner sep=0pt, below right=0cm and 1.3cm of left1U] (right1U) {\includegraphics[width=1.5cm]{QpImgs2/Class161_4828}};
        \node[inner sep=0pt, below=of right1U] (right2U) {\includegraphics[width=1.5cm]{QpImgs2/Class158_4763}};
        \node (class_labelU) at (feature_labelU -| right1U){Classes};
        
        \draw[-, line width=1.4pt, mydarkgreen, line cap=round] (left1U.east) -- (right1U.west)  node[pos=.45, sloped, above] {\footnotesize1.4};
         \draw[-, line width=1.9pt, mydarkgreen, line cap=round] (left1U.east) -- (right2U.west) node[pos=0.3, sloped, below] {\footnotesize1.9};
        \draw[-, line width=1.9pt, mydarkgreen, line cap=round] (left2U.east) -- (right1U.west) node[near start, sloped, above] {\footnotesize1.5};
         \draw[-, line width=2pt, red, out=0, in=180, line cap=round] (left2U.east) -- (right2U.west) node[pos=.45, sloped, below] {\footnotesize-2};
        \draw[-, line width=.5pt, mydarkgreen, line cap=round] (left3U.east) -- (right1U.west) node[pos=0.35, sloped, above] {\footnotesize{0.2}};
        \draw[-, line width=1.7pt, mydarkgreen, line cap=round] (left3U.east) -- (right2U.west) node[pos=.33,  above] {\footnotesize1.7};
         \draw[-, line width=2.1pt, mydarkgreen, line cap=round] (left4U.east) -- (right1U.west) node[pos=0.1,  left] {\footnotesize2.1};
        \draw[-, line width=1.8pt, mydarkgreen, line cap=round] (left4U.east) -- (right2U.west) node[pos=0.25,sloped,  above] {\footnotesize1.8};
  \node(feature_label) at (9, 0)[,text width=1.3cm] {Features};  
      \node[inner sep=0pt,below=.1cm of feature_label] (left1) {\includegraphics[width=1.5cm]{QpImgs2/0_Color}};
      \node[inner sep=0pt, below=\featurevert of left1] (left4) {\includegraphics[width=1.5cm]{QpImgs2/Smoothed_54_BW}};
      \node[below=-0.16 cm of left4, font=\scriptsize] {(deselected)};

              \node[inner sep=0pt, below=\featurevert of left4] (left3) {\includegraphics[width=1.5cm]{QpImgs2/34_Color}};
        \node[inner sep=0pt,below=\featurevert of left3] (left2) {\includegraphics[width=1.5cm]{QpImgs2/35_Color}};
        \node[inner sep=0pt, below right=0cm and 1.3 cm of left1] (right1) {\includegraphics[width=1.5cm]{QpImgs2/Class161_4828}};
        \node[inner sep=0pt, below=of right1] (right2) {\includegraphics[width=1.5cm]{QpImgs2/Class158_4763}};
          \node (class_label) at (feature_label -| right1) {Classes};
        \draw[-, line width=2pt, mydarkgreen, line cap=round] (left1.east) -- (right1.west)   node[pos=.45, sloped, above] {\footnotesize1} ;
         \draw[-, line width=2pt, mydarkgreen, line cap=round] (left1.east) -- (right2.west)  node[pos=0.2, sloped, below] {\footnotesize1} ;
 \draw[-, line width=2pt, mydarkgreen, line cap=round] (left2.east) -- (right1.west)  node[near start, sloped, above] {\footnotesize1} ;
        \draw[-, line width=2pt, mydarkgreen, line cap=round] (left3.east) -- (right2.west)node[pos=.2,  above] {\footnotesize1} ;
       
       
          \node [fit=(feature_labelU)(right2U.east)(class_labelU)(left2U.south), draw, inner sep=1pt] (dense_box) {};

        \node [above=of dense_box.south,xshift=0.8cm, anchor=center] {\large\textbf{Dense}};
         \node [fit=(feature_label)(right2.east)(class_label)(left2.south), draw, inner sep=1pt, yshift=-0.0cm] (qpm_box) {};

         \node [above=of qpm_box.south, anchor=center, xshift=0.8cm] {\large\textbf{\gls{NewlayerName}}};
         
        \draw[->, line width=2pt] ([yshift=-.2cm] dense_box.east) -- node[midway, above] {$\text{Maximize:}  \frac{1}{2} \mathbf{x}^T \mathbf{Q} \mathbf{x} + \mathbf{c}^T \mathbf{x}$} node[midway, below=.15cm] {$\mathbf{x}$ = $\begin{bmatrix}
\mathrm{Feature\text{ }Selection} \\
\mathrm{Sparse\text{ }Assignment}\\
\end{bmatrix}$} ([yshift=-.2cm] qpm_box.west);

         
    \end{tikzpicture}
    }
    \caption{Exemplary Application of the QP to a dense model with just 4 features and 2 classes with the aim of selecting 3 features and assigning 2 per class. 
    The different weights are indicated by thickness of connection and color indicates sign.
    The result is a binary assignment of selected features to classes. 
    Typical values for \resnet{} on \cubheader{}  are selecting 50 features out of 2048 and assigning 5 to each of the 200 classes.}
         \label{fig:QP}
         \vspace{-.5cm}
\end{figure}
