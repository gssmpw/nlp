In this section, we prove \Cref{lem:gp_stability_cor}, the fundamental result in the paper.  The proof proceeds by first proving the technical meat of the lemma (\Cref{lem:gp_stability}), which holds in generality, and then instantiating the result for the case of separated function classes.  The following is a strengthening of the Gaussian process stability result from \citet{block2022smoothed,block2024oracle}.

    \begin{lemma}\label{lem:gp_stability}
        Let $T$ be a set, $K$ a covariance kernel, and suppose that $T$ is separable with respect to the metric induced by $K$.  Suppose that there is some $0 < \kappa \leq K(t,t) \leq 1$ for all $t \in T$, let $\tstar = \argmin \Omega(t)$, and for $\rho, \tau > 0$, define the set 
        \begin{align}\label{eq:good_set_def}
            \cE(\rho, \tau) = \left\{ \text{there exists } s \in T, \text{ s.t. } \frac{K(s,\tstar)}{K(\tstar, \tstar)} \leq 1 - \rho^2 \text{ and } \Omega(s) \leq \Omega(\tstar) + \tau \right\}.
        \end{align}
        Then, for any $t \in T$ it holds that
        \begin{align}\label{eq:gp_stability}
            \pp\left( \tstar = t \right) \leq \left(1 + \frac{2 \tau }{ \eta \kappa^2  \rho^2}  \cdot\left( \ee\left[ \sup_{f \in \cF} \omega(f) \right] + \sqrt{\log\left( \frac 2\delta \right)}\right)\right) \cdot \pp\left( \tstar = t \text{ and } \cE(\rho, \tau)^c \right) + \delta,
        \end{align}
        whenever
        \begin{align}\label{eq:eta_lb}
            \eta \geq \frac{2\tau}{\kappa^2 \rho^2} \left( \ee\left[ \sup_{t \in T} \omega(t) \right] + \sqrt{\log\left( \frac 2\delta \right)} \right).
        \end{align}
    \end{lemma}






\begin{proof}
    We modify the proof of \citet[Theorem 5]{block2024oracle} which in turn is an improvement on \citet{block2022smoothed}.  First, for $\delta > 0$, let
    \begin{align}
        \Phi_\delta = \left\{ \sup_{t \in T} \omega(t) \leq  \ee\left[ \sup_{t \in T} \omega(t) \right] + \sqrt{\log\left( \frac 2\delta \right)}\right\}.
    \end{align}

    
    By standard Gaussian tailbounds (see, e.g., \citet[Theorem 8.5.5]{vershynin2018high}), it holds that $\pp(\Phi_\delta) \geq 1 - \delta$.  Now, a union bound implies that
    \begin{align}\label{eq:proof1}
        \pp\left( \tstar = t \right) &\leq \pp\left( \tstar = t \text{ and } \cE(\rho, \tau)^c \right) + \pp\left( \tstar = t \text{ and } \cE(\rho, \tau) \text{ and } \Phi_\delta \right) + \delta.
    \end{align}
    We focus on the middle term and show that
    \begin{align}\label{eq:proof2}
        \pp\left( \tstar = t \text{ and } \cE(\rho, \tau) \text{ and } \Phi_\delta \right) \leq \frac{2\tau}{\eta \kappa^2 \rho^2} \left( \ee\left[ \sup_{t \in T} \omega(t) \right] + \sqrt{\log\left( \frac 1\delta \right)} \right) \cdot \pp\left( \tstar = t \right).
    \end{align}
    Given \eqref{eq:proof2}, rearranging \eqref{eq:proof1} and observing that $(1-x)^{-1} \leq 1 + 2x$ for $0 \leq x \leq 1$ concludes the proof of the theorem.

    To establish \eqref{eq:proof2}, we follow \citet{block2024oracle} and introduce for $y \in \rr$ and $s, t \in T$:
    \begin{align}\label{eq:proof3}
        m_{t,y}(s) = m(s) + \frac{K(s,t)}{K(t,t)}(y - m(t)), \qquad a(s) = \frac{\tau}{\rho^2} \cdot \frac{K(s,t)}{K(t,t)}, \qquad \text{and} \qquad b(s) = \frac{\tau}{\rho^2} - a(s).
    \end{align}
    It is immediate that if $K(s,t) \leq (1 - \rho^2) K(t,t)$, then $b(s) \geq \tau$; moreover, $b(s) \geq 0$ for all $s$ by Cauchy-Schwarz and $m_{t, y + \tau/\rho^2}(s) = m_{t,y}(s) + a(s)$ pointwise.  The utility of introducing $m_{t,y}$ is that the distribution of $\Omega(s)$ conditioned on $\Omega(t) = y$ is also a Gaussian process with mean $m_{t,y}$ and covariance $K_t$, independent of $y$.  Thus, we have for all fixed $t \in T$ and $y \in \rr$
    \begin{align}
        \pp&\left( \Phi_\delta, \, \tstar=t \text{, and } \inf_{K(s,t) \leq (1- \rho^2) K(t,t)} \Omega(s) \geq y + \tau | \Omega(t) = y \right) \\
        &\geq \pp\left( \Phi_\delta, \, \tstar=t \text{, and } \inf_{K(s,t) \leq (1- \rho^2) K(t,t)} \Omega(s) - b(s) \geq y | \Omega(t) = y \right) \\
        &=  \pp\left( \Phi_\delta, \, \tstar=t \text{, and } \inf_{K(s,t) \leq (1- \rho^2) K(t,t)} \Omega(s) - b(s) - a(s) + a(s) \geq y | \Omega(t) = y \right) \\
        &=  \pp\left( \Phi_\delta, \, \tstar=t \text{, and } \inf_{K(s,t) \leq (1- \rho^2) K(t,t)} \Omega(s)  + a(s) \geq y + \frac{\tau}{\rho^2} | \Omega(t) = y \right) \\
        &= \pp\left( \Phi_\delta, \, \tstar=t \text{, and } \inf_{K(s,t) \leq (1- \rho^2) K(t,t)} \Omega(s) \geq y + \frac{\tau}{\rho^2} | \Omega(t) = y + \frac{\tau}{\rho^2} \right).
    \end{align}
    Letting
    \begin{align}
        q_t(y) = (2 \pi K(t,t,)^{-1/2}) \cdot \exp\left( -\frac{(y - m(t))^2}{2 \eta^2 K(t,t)} \right)
    \end{align}
    denote the density of $\Omega(t)$, we have
    \begin{align}
        \pp&\left( \tstar = t \text{ and } \cE(\rho, \tau) \text{ and } \Phi_\delta \right) \\
        &= \pp\left( \tstar = t  \text{ and } \Phi_\delta \right)  - \int_{-\infty}^\infty \pp\left( \Phi_\delta, \, \tstar=t \text{, and } \inf_{K(s,t) \leq (1- \rho^2) K(t,t)} \Omega(s) \geq y + \tau | \Omega(t) = y \right)q_t(y) d y \\
        &\leq \pp\left( \tstar = t  \text{ and } \Phi_\delta \right)  - \int_{-\infty}^\infty \pp\left( \Phi_\delta, \, \tstar=t \text{, and } \inf_{K(s,t) \leq (1- \rho^2) K(t,t)} \Omega(s) \geq y + \frac{\tau}{\rho^2} | \Omega(t) = y + \frac{\tau}{\rho^2} \right) q_t(y)d y \\
        &= \int_{-\infty}^\infty \left( q_t(y) - q_t\left( y - \frac{\tau}{\rho^2} \right) \right) \pp\left( \Phi_\delta, \, \tstar=t \text{, and } \inf_{K(s,t) \leq (1- \rho^2) K(t,t)} \Omega(s) \geq y  | \Omega(t) = y  \right) d y \\
        &= \int_{-\infty}^\infty \left( q_t(y) - q_t\left( y - \frac{\tau}{\rho^2} \right) \right) \pp\left( \Phi_\delta \text{ and } \tstar=t  | \Omega(t) = y  \right) d y.
    \end{align}
    Noting now that
    \begin{align}
        q_t(y) - q_t\left( y - \frac{\tau}{\rho^2} \right) \leq \frac{\tau q_t(y)}{ \eta^2 \kappa^2  \rho^2} (y - m(t))
    \end{align}
    by the proof of \citet[Theorem 5]{block2024oracle}, we have that
    \begin{align}
        \pp\left( \tstar = t \text{ and } \cE(\rho, \tau) \text{ and } \Phi_\delta \right) &\leq \frac{\tau }{ \eta^2 \kappa^2  \rho^2} \int_{-\infty}^\infty (y - m(t)) \pp\left( \Phi_\delta \text{ and } \tstar=t  | \Omega(t) = y  \right) q_t(y) d y \\
        &= \frac{\tau }{ \eta^2 \kappa^2  \rho^2} \cdot  \ee\left[ \eta  \cdot \omega(t) \cdot \bbI\left[ \Phi_\delta \text{ and } \tstar = t \right] \right] \\
        &= \frac{\tau }{ \eta \kappa^2  \rho^2} \cdot \ee\left[ \omega(\tstar) \bbI[\Phi_\delta] | \tstar = t \right] \cdot \pp\left( \tstar = t \right).
    \end{align}







    Now, noting that, by definition, 
    \begin{align}
        \ee\left[ \omega(\tstar) \bbI[\Phi_\delta] | \tstar = t \right]  \leq \ee\left[ \sup_{t \in T} \omega(t) \right] + \sqrt{\log\left( \frac 2\delta \right)},
    \end{align}
    we conclude the proof.
\end{proof}







We now instantiate \Cref{lem:gp_stability} for the case of separated index sets and bounded perturbations following \citet[Corollary 1]{block2024oracle}
\begin{theorem}\label{thm:separated_privacy}
    Let $T, \omega, \Omega, K, m$ be as in \Cref{lem:gp_stability} and suppose that $T$ is a subset of a real vector space, $K$ is bilinear and let $\norm{t} = \sqrt{K(t,t)}$, extended through bilinearity to the span of $T$.  Further suppose that $T$ is $\rho$-separated in $\norm{\cdot}$ in the sense that $\norm{t - t'} \geq \rho$ for all $t \neq t' \in T$.  Let $m' : T \to \rr$ denote a mean function such that $\sup_{t \in T} \abs{m(t) - m(t')} \leq \tau$ and let $\Omega'$ denote the associated shifted Gaussian process.  Letting $\tstarp = \argmin \Omega'(t)$, if
    \begin{align}\label{eq:separated_privacy_eta_lb}
        \eta \geq \frac{32\tau}{\rho^2} \left( \ee\left[ \sup_{t \in T} \omega(t) \right] + \sqrt{\log\left( \frac 2\delta \right)} \right),
    \end{align}
    it holds for any $t \in T$ that
    \begin{align}
        \pp\left( \tstar = t \right) \leq \left( 1 + \frac{32\tau}{\eta \rho^2} \cdot \left( \ee\left[ \sup_{f \in \cF} \omega(f) \right] + \sqrt{2 \log\left( \frac 2\delta \right)} \right) \right) \cdot \pp\left( \tstarp = t \right) + \delta
    \end{align}
\end{theorem}
\begin{proof}
    Note that unlike \Cref{lem:gp_stability}, we do not requite a lower bound of $\kappa \leq K(t,t)$.  To handle this case, we introduce the kernel $\Ktil: T \times T \to \rr$ defined such that
    \begin{align}
        \Ktil(s,t) = \frac 12 \left( K(s,t) + \kappa^2 \right)
    \end{align}
    for some $1 \geq \kappa > 0$.  Observe that $\Ktil = (K + \kappa^2 \cdot \mathbf{1} \mathbf{1}^\top)/2 \succeq K / 2$, and, because $\mathbf{1} \mathbf{1}^\top$ is rank 1, its addition does not affect whether or not $K$ is trace class; thus $\Ktil$ is a valid covariance kernel if $K$ is.  Furthermore, it is clear that $\Ktil(t, t) \geq \kappa^2 / 2$ for all $t \in T$ and that $\Ktil$ is the covariance kernel associated to the process $\Omegatil(t) = \Omega(t) + \kappa \cdot \xi$, where $\xi$ is an independent standard normal random variable.  Thus for any $t \in T$, it holds that
    \begin{align}\label{eq:same_distribution}
        \pp\left( \ttilstar = t \right) = \ee_\xi \left[ \pp\left( \ttilstar = t | \xi \right) \right] = \ee_\xi\left[ \pp\left( \tstar = t \right) \right] = \pp\left( \tstar = t \right).
    \end{align}
    Thus $\tstar$ and $\ttilstar$ have the same distribution.  Let $\Omegatil' = \Omegatil + m' - m$, i.e., the process with mean $m'$ and covariance kernel $\Ktil$ and observe the above holds for $\Omegatil'$ and its minimizer $\ttilstarp$ as well.  Furthermore, if we compute the norm induced by $\Omegatil$, we see that
    \begin{align}
        \Ktil(t,t) + \Ktil(s,s) - 2 \Ktil(s,t) &= \frac{K(t,t) + \kappa^2}{2} + \frac{K(s,s) + \kappa^2}{2} - K(s,t) - \kappa^2 \\
        &= \frac{K(t,t) + K(s,s) - 2 K(s,t)}{2} \\
        &= \frac{\norm{s -t}^2}{2}.
    \end{align}
    Now, applying \Cref{lem:gp_stability} to $\Omegatil$, we see that for sufficiently large $\eta$, it holds that
    \begin{align}
        \pp\left( \ttilstar = t \right) \leq \left( 1 + \frac{16 \tau}{\eta \kappa^2 \rho^2} \cdot \left( \ee\left[ \sup_{f \in \cF} \omega(f) \right] + \sqrt{2 \log\left( \frac 2\delta \right)} \right) \right) \cdot \pp\left( \ttilstar = t \text{ and } \cE^c(\rho/2, 2 \cdot\tau) \right) + \delta,
    \end{align}
    where we note that the expected supremum of $\omega$ is unaffected by the addition of $\kappa \cdot \xi$; a similar statement holds for $\Omegatil'$.  Furthermore, by construction,  
    \begin{align}
        \Omegatil(\ttilstarp) = \Omegatil'(\ttilstarp) + m'(\ttilstarp) - m(\ttilstarp) \leq \Omegatil'(\ttilstar) +  m'(\ttilstarp) - m(\ttilstarp) \leq \Omega(\ttilstar) + 2\tau.
    \end{align}
    To conclude, we note that if $\ttilstar \neq \ttilstarp$, then $\norm{\ttilstar - \ttilstarp}^2 \geq \rho^2$, and, letting $M = \max\left( \Ktil(\ttilstar, \ttilstar), \Ktil(\ttilstarp, \ttilstarp) \right) \leq 1$, we see that
    \begin{align}
        \norm{\ttilstar - \ttilstarp}^2 &= 2 \cdot \left( \Ktil(\ttilstar, \ttilstar) + \Ktil(\ttilstarp, \ttilstarp) - K(\ttilstar, \ttilstarp) \right) \\
        &\leq 4 M \left( 1 - \frac{K(\ttilstar, \ttilstarp)}{M} \right).
    \end{align}
    Rearranging, we see that
    \begin{align}
        \min\left( \frac{\Ktil(\ttilstar, \ttilstarp)}{\Ktil(\ttilstar, \ttilstar)}, \frac{\Ktil(\ttilstar, \ttilstarp)}{\Ktil(\ttilstarp, \ttilstarp)} \right) \leq 1 - \frac{\rho^2}{4M} \leq 1 - \frac{\rho^2}{4}.
    \end{align}
    Thus we see that $\left\{ \ttilstarp \neq \ttilstar \right\} \subset \cE\left( \nicefrac \rho2, 2\tau \right)$.  Recalling from \eqref{eq:same_distribution} that $\tstar$ and $\ttilstar$ have the same distribution, we conclude the proof by setting $\kappa =1$.
















    
    
    
    
    
\end{proof}
Finally, the proof of \Cref{lem:gp_stability_cor} follows by specializing to the setting where $\cF$ is a function class mapping $\cX \to \rr$ and $\omega$ is the canonical Gaussian process associated to this space. 
