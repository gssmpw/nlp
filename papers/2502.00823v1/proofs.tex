\section{Proof of \cref{theo:single_meas}}\label{pf:single_meas}

\begin{proof}
    Without loss of generality, we set $\mathcal{X} = \{\vonneu i\}$,  with $i\in\llbracket 0,N-2 \rrbracket$. Define $\mathbf{x}$ as the complete binary tree of depth $T$ such that $\forall t\in[T],\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T-1}$,
    \begin{equation}
        \mathbf{x}_t(\boldsymbol{\epsilon}) = \vonneu i.
    \end{equation}
    Furthermore, define $\mathbf v$ (\cref{fig:halving_tree}) as the complete binary tree of depth $T$ such that $\forall t\in[T],\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T-1}$,
    \begin{equation}
        \mathbf v_t(\boldsymbol\epsilon)=\frac1{2^t}\sum_{k=0}^{t-1}\epsilon_{k}2^{t-k-1}=\sum_{k=0}^{t-1}\epsilon_{k}2^{-k-1}.
    \end{equation}
    Here, we set $\epsilon_0=1$.

    
Given $(\mathbf x,\mathbf v)$, we now set:
\begin{equation}
    \ket{\psi(\boldsymbol\epsilon)}=\sqrt{\sum_{k=0}^{T-1}\epsilon_{k}2^{-k-1}}\vect i+\sqrt{1-\sum_{k=0}^{T-1}\epsilon_{k}2^{-k-1}}\ket{\perp}.
\end{equation}
% $\ket{\psi(\boldsymbol\epsilon)}=\sqrt{\sum_{k=0}^{T-1}\epsilon_{k}2^{-k-1}}\vect i+\sqrt{1-\sum_{k=0}^{T-1}\epsilon_{k}2^{-k-1}}\ket{\perp}$.
    Then, for $T=\lfloor\operatorname{log}_2(\frac1\delta)\rfloor$ (which implies $\delta\le\frac1{2^T}$), $\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T-1}, \forall t \in [T]$, we have:
    \begin{align}
    \label{eq:halving_proof}
        \epsilon_t [\operatorname{Tr}_{ \boldsymbol\omega(\boldsymbol \epsilon)}(\mathbf{x}_t(\boldsymbol{\epsilon})) - \mathbf{v}_t (\boldsymbol{\epsilon})] 
        &= \epsilon_t \left[\sum_{k=0}^{T-1}\epsilon_{k}2^{-k-1}-\sum_{k=0}^{t-1}\epsilon_{k}2^{-k-1}\right]
        \nonumber\\&=\epsilon_t\sum_{k=t}^{T-1}\epsilon_{k}2^{-k-1}\nonumber\\&=2^{-t-1}+\epsilon_t\sum_{k=t+1}^{T-1}\epsilon_{k}2^{-k-1}\nonumber\\&\geq2^{-t-1}-\sum_{k=t+1}^{T-1}2^{-k-1}\nonumber\\&=2^{-t-1}-(2^{-t-1}-2^{- T})
        \nonumber\\&\geq \delta,
    \end{align}
    where the first inequality follows from the minimum value that the term $\epsilon_t\sum_{k=t+1}^{T-1}\epsilon_{k}2^{-k-1}\nonumber$ can take, and the last inequality is by direct computation and the assumption $T=\lfloor\operatorname{log}_2(\frac1\delta)\rfloor$. Thus, we show that the set $\mathcal{X}$ is $\delta$-shattered by the hypothesis class $\mathcal{H}_n$ with $\text{sfat}_\delta (\mathcal{H}_n, \mathcal{X}) = \Omega(\log_2(\frac1\delta))$. %$(\mathbf{x},\mathbf{v},\boldsymbol{\omega})$ is $\delta$-shattered, of depth $\Omega(\log_2(\frac1\delta))$.
\end{proof}

We can replace $\mathbf{v}$ by a slightly modified version of itself, where each node is scaled by a factor $\frac1N$. Therefore, the quantum state associated to a path  has an amplitude corresponding to $\vect i$: $\operatorname{Tr}(\vonneu i \boldsymbol\omega(\boldsymbol\epsilon))$ bounded by $\frac1N$. We will write $\mathbf{T}_h [i, T]=(\mathbf x,\mathbf v)$ the resulting pair-valued tree and call it the Halving Tree of depth $T$. The index $i$ indicates the Von Neumann measurement associated to $\mathbf{x}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Proof of \cref{theo:uniform}}\label{pf:uniform}

\begin{proof}
Let $T\in[N]$.
Define $\mathbf{v}$ as the complete binary tree of depth $T$ such that $\forall t\in[T],\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T-1}$,
\begin{equation}
    \mathbf{v}_t (\boldsymbol{\epsilon}) = \frac{1}{2T}. 
\end{equation}
Furthermore, denote $\mathbf x$ (\cref{fig:vn_tree}) the complete binary tree of depth $T$ such that $\forall t\in[T],\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T-1}$,
\begin{equation}
    \mathbf{x}_t(\boldsymbol{\epsilon}) = \ket{t-1} \bra{t-1}.
\end{equation}
We refer to the pair $(\mathbf{x}, \mathbf{v})$ as the Von-Neumann tree $\mathbf{T}_{vn}$. 


Given the Von Neumann tree, we now associate each path $\boldsymbol{\epsilon}$ to a pure quantum state:
\begin{equation}
\ket{\psi(\boldsymbol\epsilon)}=\frac 1{\sqrt{K+1}}\sum_{i=0}^{T-2} \mathbf{1}_{\epsilon_{i+1}=1}\vect i+\frac{1}{\sqrt{K+1}}\vect{N-1},
\end{equation}
where $K=\sum_{i=0}^{T-2}\mathbf{1}_{\epsilon_{i+1}=1}$, and $\mathbf{1}_{\epsilon = 1}$ is an indicator function which takes value $1$ if $\epsilon = 1$ and $0$ otherwise. Then, for $\delta\le \frac1{2T}$, $\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T-1}, \forall t \in [T]$:
\begin{align}
\label{eq:von_neumann_proof}
    \epsilon_t [\operatorname{Tr}_{\boldsymbol \omega(\boldsymbol \epsilon)}(\mathbf{x}_t(\boldsymbol{\epsilon})) - \mathbf{v}_t (\boldsymbol{\epsilon})] 
    &= \epsilon_t \left[\frac{\mathbf{1}_{\epsilon_{t}=1}}{K+1}-\frac1{2T}\right]
    \nonumber\\&\ge\delta.
\end{align}
 Thus, we show that the set $\mathcal{X}$ is $\delta$-shattered by the hypothesis class $\mathcal{H}$ with $\text{sfat}_\delta(\mathcal H, \mathcal{X})=\Omega(\min(\frac1\delta,2^n))$.

\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Proof of \cref{theo:vnh}}\label{pf:vnh}

\begin{proof}
Without any loss of generality, we can chose the sample space to be a set of Von Neumann measurements $\mathcal{X} = \{ \vonneu{i}: i \in \llbracket 0, N-1 \rrbracket$\}. Denote $t'=\lfloor \frac {t-1} T \rfloor$ and $\tilde t=t-1-Tt'$. We then define $\mathbf{x}$ as the complete binary tree of depth $T(N-1)$ such that $\forall t\in[T(N-1)],\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T(N-1)-1}$,
\begin{equation}
\label{eq:x_vnh}
    \mathbf x_t(\boldsymbol\epsilon)=\vonneu {t'}.
\end{equation}
Furthermore, denote $\mathbf{v}$ the complete binary tree of depth $T(N-1)$ such that $\forall t\in[T(N-1)],\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T(N-1)-1}$,
\begin{equation}
\label{eq:v_vnh}
    \mathbf v_t(\boldsymbol\epsilon)=\frac1{2^{n+1}}(1+\sum_{k=1}^{\tilde t}\epsilon_{k+Tt'}2^{-k})
\end{equation}

We refer to the pair $(\mathbf{x}, \mathbf{v})$ as the Von Neumann halving tree $\mathbf{T}_{vnh}$. The name follows from the fact that the trees $\mathbf{x}$ and $\mathbf{v}$ as defined in \cref{eq:x_vnh,eq:v_vnh} can be constructed by replacing each node on the $t$-th layer of $\mathbf{T}_{vn}$, for both $\mathcal{X}$ valued and real valued parts, by the corresponding parts of the halving tree $\mathbf{T}_h [t, T]$.

Given the Von Neumann halving tree we can now associate each path $\boldsymbol{\epsilon}$ to a pure quantum state:
\begin{equation}
\ket{\psi(\boldsymbol\epsilon)}=\sum_{i=0}^{N-2}\sqrt{a_i}\vect i+\sqrt{1-\sum_{i=0}^{N-2}a_i}\vect{N-1}
\end{equation}
where $\forall i\in\llbracket0,N-2\rrbracket$,
\begin{equation}
    a_i=\mathbf v_{(i+1)T}(\boldsymbol\epsilon)+\frac1{2^{T+n+1}}\epsilon_{(i+1)T}.
\end{equation}
Then, for $\delta\le\frac1{2^{n+T+1}}$, we can show that $\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T(N-1)-1}, \forall t \in [T(N-1)]$:
    \begin{align}
    \label{eq:von_neumann_halving_proof}
        \epsilon_t [\operatorname{Tr}_{\boldsymbol \omega(\boldsymbol \epsilon)}(\mathbf{x}_t(\boldsymbol{\epsilon})) - \mathbf{v}_t (\boldsymbol{\epsilon})] 
        &= \epsilon_t[\mathbf v_{(t'+1)T}(\boldsymbol\epsilon)+\frac1{2^{T+n+1}}\epsilon_{(t'+1)T}-\frac1{2^{n+1}}(1+\sum_{k=1}^{\tilde t}\epsilon_{k+Tt'}2^{-k})]
        \nonumber\\&=\epsilon_t[\frac1{2^{n+1}}(1+\sum_{k=1}^{T}\epsilon_{k+Tt'}2^{-k})-\frac1{2^{n+1}}(1+\sum_{k=1}^{\tilde t}\epsilon_{k+Tt'}2^{-k})]
        \nonumber\\&=\frac{\epsilon_t}{2^{n+1}}(\sum_{k=\tilde t+1}^{T}\epsilon_{k+Tt'}2^{-k})
        \nonumber\\&=\frac{1}{2^{n+1}}(\frac{1}{2^{\tilde t+1}}+\sum_{k=\tilde t+2}^{T}\epsilon_{k+Tt'}2^{-k})
        \nonumber\\&\ge\delta
    \end{align}
In particular, let $k\in\mathbb N^*$. Taking $\delta=\frac1{N^{1+\frac1k}}$ and $T=\lfloor\text{log}_2(\frac1{4\delta N})\rfloor$, we get $TN=\Omega( n\delta^{-\frac1{1+\frac1k}})$. Therefore, we have shown that the set $\mathcal{X}$ is $\delta$-shattered by the Hypothesis class $\mathcal{H}_n$ with $\text{sfat}_\delta(\mathcal H_n)=\Omega(\frac n{\delta^\eta}), \forall\eta<1$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Proof of \cref{lemma_completion}}\label{pf:lemma_completion}

To prove \cref{lemma_completion}, we rely on Theorem $7$ in \citet{GRONE1984109}. We begin by introducing the necessary definitions. Let $\mathcal{G}=(V,E)$ be a finite undirected graph. 
A {\it cycle} in $\mathcal{G}$ is a sequence of distinct vertices $v_1, v_2, \dots, v_s\in V$ such that $\{v_i, v_{i+1}\} \in E$ for all $i\in[s-1]$, and $\{v_s, v_1\}\in E$. A cycle is said to be {\it minimal} if and only if it has no chord, where a chord is an edge $\{v_i, v_j\} \in E$ with $|i-j|>1$ and $\{i, j\} \neq \{1, s\}$.

A matrix $\omega$ is said to be $\mathcal{G}$-partial when its entries $w_{ij}$ are determined if and only if $\{i,j\}\in E$, while other elements are undetermined.
A $\mathcal{G}$-partial matrix $\omega$ is said to be non-negative if and only if (a) $\omega_{ij}=\overline{\omega}_{ji}, \ \forall\{i,j\}\in E$ and (b) for any clique $\mathcal C$ of $\mathcal{G}$, the principal submatrix of $\omega$ corresponding to $\mathcal C$ (which has entries corresponding to $\mathcal C$) is positive semidefinite. Recall that a clique $\mathcal C$ of $\mathcal G$ is a complete subgraph of $\mathcal G$. The corresponding principal submatrix is obtained by keeping only the indices in $\mathcal C$.


A {\it completion} of a $\mathcal{G}$-partial matrix $\omega$ is a full Hermitian
matrix $M$ such that $M_{ij} = \omega_{ij}$ for all $\{i, j\} \in E$. We say that M is a non-negative completion if and only if M is also positive semidefinite.
A graph $\mathcal{G}$ is said to be {\it completable} if and only if any $\mathcal{G}$-partial non-negative matrix has a non-negative completion. With these definitions in place, we proceed to state the relevant results in \citet{GRONE1984109}.


\begin{lemma}[\citet{GRONE1984109}]\label{lemma.graph.grone}
        A graph $\mathcal{G}$ is completable if and only if every minimal cycle in the graph is of length $< 4$.
\end{lemma}

\noindent Now that we have covered the necessary background, we can proceed to prove \cref{lemma_completion}.


\begin{proof}

Let $\omega$ be a partial matrix as stated in \cref{lemma_completion}. Consider the graph $\mathcal{G}=(V,E)$, where $V=[N]$ and $E=\{\{i,j\},i\in[N],j\in\{1,i\}\}\cup\{\{i,i\},i\in[N]\}$.
    
    
    \begin{figure}[h]
        \centering
        \begin{tikzpicture}[
            node/.style = {circle, draw, minimum size=1.5cm, align=center, font=\fontsize{8}{12}\selectfont}, % Adjusted font size
            edge/.style = {thick},
            textstyle/.style = {minimum size=0cm}
        ]
        
        % Define the first three nodes in set U (arranged horizontally)
        \node[node] (U1) {2};
        \node[node] (U2) [right=of U1] {3};
        \node[node] (U3) [right=of U2] {4};
        
        % Add first cdots for intermediate nodes in set U
        \node[textstyle] (Udots1) [right=of U3] {\(\cdots\)};
        
        % Define the last node in set U
        \node[node] (Un) [right=of Udots1] {\(N\)};
        
        
        % % Define the first three nodes in set V (placed below U horizontally)
        \node[node] (V1) [above=2cm of U3] {\(1\)};
        % \node[node] (V2) [right=of V1] {\(M + 2\)};
        % \node[node] (V3) [right=of V2] {\(M + 3\)};
        
        % % Add first cdots for intermediate nodes in set V
        % \node[textstyle] (Vdots1) [right=of V3] {\(\cdots\)};
        
        % % Define the last node in set V
        % \node[node] (Vn) [right=of Vdots1] {\(N\)};
        
        
        
        % Draw edges between every node in U and every node in V
        \foreach \u in {U1, U2, U3, Un} {
            \foreach \v in {V1} {
                \draw[edge] (\u) -- (\v);
            }
        }
        
        % % Draw edges within set U
        % \draw[edge] (U1) -- (U2);
        % \draw[edge] (U2) -- (U3);
        
        \end{tikzpicture}
        \caption{Graph representation of $\mathcal G=(V,E)$}
        \label{fig:bipartite_graph}
    \end{figure}
    
    One can easily check that $\mathcal{G}$ is completable using \cref{lemma.graph.grone}. Therefore, if we prove that $\omega$ is non-negative $\mathcal{G}$-partial, it will have a positive semidefinite Hermitian  completion. Combining with the first two conditions in \cref{lemma_completion}, we can show that the completion of $\omega$ is Hermitian, positive semidefinite, with trace equal to $1$, and therefore is a density matrix.
    % All that is left to prove is that $\omega$ is nonnegative $\mathcal G$-partial.
    Now to show that $\omega$ is non-negative $\mathcal{G}$-partial, let $\mathcal C=\{1,i\}$ be a clique of $\mathcal G$. Since $|w_{1i}|\leq\frac1{2\sqrt{N-1}}$ by assumption, the principal submatrix of $\omega$ corresponding to $\mathcal C$, i.e.,
    \begin{align}
        \begin{pmatrix}
            \frac{1}{2} & \omega_{1i}\\
            \omega_{i1} & \frac{1}{2(N-1)}
        \end{pmatrix}
    \end{align}
    can be shown to be non-negative.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Proof of \cref{thm:final}}\label{pf:final}

\begin{proof}\label{proof:final}

Set $\mathcal{X} = \{E_{0,i}, i \in [N-1]\}$ where $E_{0,i}=\frac12(\vonneu 0 + \vonneu i + \meas 0 i)$. Define $t'=\lfloor \frac {t-1} T \rfloor$ and $\tilde t=t-1-Tt'$ for $T>0$. Write $\mathbf{x}$ the complete binary tree of depth $T(N-1)$ such that $\forall t\in[T(N-1)],\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T-1}$,
\begin{equation}
    \mathbf{x}_t (\boldsymbol{\epsilon}) = E_{0,t'+1}, 
\end{equation}
and $\mathbf{v}$ the complete binary tree of depth $T(N-1)$ such that $\forall t\in[T(N-1)],\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T-1}$,
\begin{equation}
    \mathbf{v}_t (\boldsymbol{\epsilon}) = \frac1{4\sqrt{N-1}}(1+\sum_{k=1}^{\tilde t}\epsilon_{k+Tt'}2^{-k}).
\end{equation}
The pair $(\mathbf{x}, \mathbf{v})$ resembles the Von Neumann halving tree constructed in the previous section, with the key difference being that the nodes in the $\mathcal{X}$ valued part of the new tree are now labelled by a different class of measurement operators. We will replace $\mathbf v$ with a slightly modified version $\tilde{\mathbf{v}}$:
\begin{equation}
    \tilde{\mathbf{v}}_t (\boldsymbol{\epsilon}) = \mathbf v_t(\boldsymbol{\epsilon})+\frac14(1+\frac1{N-1}).
\end{equation}
We now associate every path $\boldsymbol{\epsilon}$ to any nonnegative completion $\boldsymbol\omega(\boldsymbol\epsilon)$ of $\text{part}(a_1,...a_{N-1})$, where $\forall i\in\llbracket1,N-1\rrbracket$,
\begin{equation}
    a_i=\mathbf v_{iT}(\boldsymbol\epsilon)+\frac1{2^{T+2}\sqrt{N-1}}\epsilon_{(i+1)T}.
\end{equation}
Recall that the partial matrix $\text{part}(a_1,...a_{N-1})$ satisfies all the conditions in \cref{lemma_completion} and hence can be completed to a valid density matrix $\boldsymbol\omega(\boldsymbol\epsilon)$.


Then, for $\delta\le\frac1{2^{T+2}\sqrt{N-1}}$, we have that $\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T(N-1)-1}, \forall t \in [T(N-1)]$,
\begin{align}
        &\epsilon_t [\operatorname{Tr}_{\boldsymbol \omega(\boldsymbol \epsilon)}(\mathbf{x}_t(\boldsymbol{\epsilon})) - \tilde{\mathbf{v}}_t (\boldsymbol{\epsilon})] \nonumber \\ 
        =& \epsilon_t[\mathbf v_{(t'+1)T}(\boldsymbol\epsilon)+\frac1{2^{T+2}\sqrt{N-1}}\epsilon_{(t'+2)T}-\frac1{4\sqrt{N-1}}(1+\sum_{k=1}^{\tilde t}\epsilon_{k+Tt'}2^{-k})]
        \nonumber\\=&\epsilon_t[\frac1{4\sqrt{N-1}}(1+\sum_{k=1}^{T}\epsilon_{k+Tt'}2^{-k})-\frac1{4\sqrt{N-1}}(1+\sum_{k=1}^{\tilde t}\epsilon_{k+Tt'}2^{-k})]
        \nonumber\\=&\frac{\epsilon_t}{4\sqrt{N-1}}(\sum_{k=\tilde t+1}^{T}\epsilon_{k+Tt'}2^{-k})
        \nonumber\\=&\frac{1}{4\sqrt{N-1}}(\frac{1}{2^{\tilde t+1}}+\sum_{k=\tilde t+2}^{T}\epsilon_{k+Tt'}2^{-k})
        \nonumber\\\ge&\delta.
    \end{align}
By taking $\delta=\frac1{N^{\frac12+\frac1k}}$ and $T=\lfloor\text{log}_2(\frac1{ 4\delta \sqrt{N}})\rfloor$, we get $TN=\Omega( n\delta^{-\frac2{1+\frac2k}})$. Therefore, we have shown that the set $\mathcal{X}$ is $\delta$-shattered by the Hypothesis class $\mathcal{H}_n$ with $\text{sfat}_\delta(\mathcal H_n)=\Omega(\frac n{\delta^\eta}), \forall\eta<2$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Proof of~\cref{cor:tight_reg_gen,cor:bis}}\label{pf:cor}

\begin{proof}[Proof of~\cref{cor:tight_reg_gen}]
    Recall from \cref{eq:Regret_LB_bis} that the minimax regret is lower bound by the sequential fat-shattering dimension as:
    $$\mathcal{V}_T \geq \frac{1}{4 \sqrt{2}} \sup_{\delta > 0} \Big\{ \sqrt{\delta^2 T \min\{ \text{sfat}_\delta (\mathcal{H}_n, \mathcal{X}), T\}} \Big\}$$
    provided that the loss function under consideration is the $L_1$-loss.
    Now combining this result with the lower bound on $\text{sfat}_\delta (\mathcal{H}_n, \mathcal{X})$ established in \cref{thm:final} we get $\mathcal{V}_T = \Omega (\sqrt{nT})$. 
\end{proof}

The Proof of~\cref{cor:bis} is identical.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%ùù

\section{Proof of \cref{theo:final_pure}}\label{pf:final_pure}

\begin{proof}
    Set $\mathcal{X} = \{E_{0,i},i\in[N-1]\}$ where $E_{0,i}=\frac12(\vonneu 0 + \vonneu i + \meas 0 i)$.
    Define $t'=\lfloor \frac {t-1} T \rfloor$ and $\tilde t=t-1-Tt'$ for $T>0$.
    Write $\mathbf{x}$ the complete binary tree of depth $T(N-1)$ such that $\forall t\in[T(N-1)],\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T-1}$,
\begin{equation}
    \mathbf{x}_t (\boldsymbol{\epsilon}) = E_{0,t'+1}. 
\end{equation}
and $\mathbf{v}$ the complete binary tree of depth $T$ such that $\forall t\in[T],\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T-1}$,
\begin{equation}
    \mathbf{v}_t (\boldsymbol{\epsilon}) = \frac1{4\sqrt{N-1}}(1+\sum_{k=1}^{\tilde t}\epsilon_{k+Tt'}2^{-k}).
\end{equation}
We can associate every path $\boldsymbol\epsilon$ to a pure state
\begin{equation}
    \ket{\psi(\boldsymbol\epsilon)}=\frac1 {\sqrt{2}}\vect0+\sum_{i=1}^{N-2}a_i\vect i+\left(\frac12-\sum_{i=1}^{N-2}a_i^2 \right)\vect{N-1}
\end{equation}
    where,
\begin{equation}
    a_i=\mathbf v_{iT}(\boldsymbol\epsilon)+\frac1{2^{T+2}\sqrt{N-1}}\epsilon_{(i+1)T}.
\end{equation}
Here $i\in\llbracket1,N-2\rrbracket$.
Let $\mathbf w_t=\frac1{\sqrt{2}}\mathbf v_t+\frac12(\frac12+a_{t'+1}^2)$.
Then, for $\delta\le\frac1{2^{T+2}\sqrt{2(N-1)}}$, we have that $\forall \ \boldsymbol{\epsilon} \in \{\pm 1\}^{T(N-2)-1}, \forall t \in [T(N-2)]$,
        \begin{align}
    \label{eq:final}
        \epsilon_t [\operatorname{Tr}_{\ket{\psi(\boldsymbol\epsilon)}}(\mathbf{x}_t(\boldsymbol{\epsilon})) - \mathbf{w}_t (\boldsymbol{\epsilon})] 
        &= \frac{\epsilon_t}{\sqrt{2}}[\mathbf v_{(t'+1)T}(\boldsymbol\epsilon)+\frac1{2^{T+2}\sqrt{N-1}}\epsilon_{(t'+2)T}-\frac1{4\sqrt{N-1}}(1+\sum_{k=1}^{\tilde t}\epsilon_{k+Tt'}2^{-k})]
        \nonumber\\&=\frac{\epsilon_t}{\sqrt{2}}[\frac1{4\sqrt{N-1}}(1+\sum_{k=1}^{T}\epsilon_{k+Tt'}2^{-k})-\frac1{4\sqrt{N-1}}(1+\sum_{k=1}^{\tilde t}\epsilon_{k+Tt'}2^{-k})]
        \nonumber\\&=\frac{\epsilon_t}{4\sqrt{2(N-1)}}(\sum_{k=\tilde t+1}^{T}\epsilon_{k+Tt'}2^{-k})
        \nonumber\\&=\frac{1}{4\sqrt{2(N-1)}}(\frac{1}{2^{\tilde t+1}}+\sum_{k=\tilde t+2}^{T}\epsilon_{k+Tt'}2^{-k})
        \nonumber\\&\ge\delta
    \end{align}
In particular, let $k\in\mathbb N^*$. By taking $\delta=\frac1{N^{\frac12+\frac1k}}$ and $T=\lfloor\text{log}_2(\frac1{ 4\delta \sqrt{N}})\rfloor$, we get $TN=\Omega( n\delta^{-\frac2{1+\frac2k}})$. Therefore, we have shown that the set $\mathcal{X}$ is $\delta$-shattered by the Hypothesis class $\mathcal{H}$ with $\text{sfat}_\delta(\mathcal H, \mathcal{X})=\Omega(\frac n{\delta^\eta}) \ \forall\eta<2$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%ùù
\input{rademacher}


\section{Proof of \cref{theo:smooth_ub}}\label{pf:smooth}

For this proof, we will use the notion of Rademacher complexity and a few related results that can be found in \cref{rademacher}.

Consider the sequential Rademacher complexity $\mathfrak{R}_T (\ell \circ \mathcal{H}, \mathbf{x})$ in \cref{eq:seq_rad_comp} defined on the function class $\ell \circ \mathcal{H}$.  For the purpose of this proof let us consider a slightly modified version of the sequential Rademacher complexity defined as:
\begin{align}
    \mathfrak{R}_T (\ell \circ \mathcal{H}, \mathcal{D}_\wedge) &= \mathop{\mathbb{E}}_{\mathbf{x} \sim \mathcal{D}_\wedge} \mathfrak{R}_T (\ell \circ \mathcal{H}, \mathbf{x}) \nonumber \\
    &= \mathop{\mathbb{E}}_{\mathbf{x} \sim \mathcal{D}_\wedge} \Big[\frac{1}{T} \mathop{\mathbb{E}}_{\boldsymbol{\epsilon}} \Big[ \sup_{h \in \mathcal{H}} \sum_{j=1}^T \epsilon_j \ell (h(\mathbf{x}_t(\boldsymbol{\epsilon})), h_\rho (\mathbf{x}_t(\boldsymbol{\epsilon}))) \Big]
\Big],
\end{align}
where $\mathcal{D}_\wedge \in \mathcal{B}_T (\sigma, \mathcal{D})$. Moreover we will call $\mathfrak{R}_T (\ell \circ \mathcal{H}, \mathcal{B}_T) = \sup_{\mathcal{D}_\wedge \in \mathcal{B}_T(\sigma, \mathcal{D})} \mathfrak{R}_T (\ell \circ \mathcal{H}, \mathcal{D}_\wedge)$. The key idea now is to relate $\mathfrak{R}_T (\ell \circ \mathcal{H}, \mathcal{D}_\wedge)$ to $\mathcal{R} (\mathcal{H})$ (Rademacher complexity assuming i.i.d. data inputs; see \cref{eq:rad_comp}). This can be achieved using the idea of coupling discussed in the previous section. 


\begin{lemma}
Let $\mathcal{D}_\wedge \in \mathcal{B}_T (\sigma, \mathcal{D})$ be a distribution that is coupled to independent random variables drawn according to the distribution $\mathcal{D}$, as per \cref{def:coupling}. Let $\mathcal{H}$ be a Hypothesis class and $\ell$ be the loss function. Then we have $\mathfrak{R}_T (\ell \circ \mathcal{H}, \mathcal{D}_\wedge) \leq T^2 e^{-\sigma k} + \mathcal{R}_{kT} (\ell \circ \mathcal{H})$
\end{lemma}
\begin{proof}
Let $A$ be an event that $\mathbf{x}_t (\boldsymbol{\epsilon}) \in \{ Z_t^j \}_{j=1}^k \ \forall t \in [T]$. Furthermore, let $\chi_A$ be the corresponding indicator function and $\chi_{A^c}$ be $1-\chi_A$. Then we have:
\begin{align}
\label{eq:rad_comp_ubound}
    \mathfrak{R}_T (\ell \circ \mathcal{H}, \mathcal{D}_\wedge) &= \mathop{\mathbb{E}}_{\mathbf{x} \sim \mathcal{D}_\wedge} \Big[\frac{1}{T} \mathop{\mathbb{E}}_{\boldsymbol{\epsilon}} \Big[ \sup_{h \in \mathcal{H}} \sum_{j=1}^T \epsilon_j \ell (h(\mathbf{x}_t(\boldsymbol{\epsilon})), h_\rho (\mathbf{x}_t(\boldsymbol{\epsilon}))) \Big] \Big] \nonumber \\
    &= \mathop{\mathbb{E}}_{\mathbf{x} \sim \Pi} \Big[\frac{1}{T} \mathop{\mathbb{E}}_{\boldsymbol{\epsilon}} \Big[ \sup_{h \in \mathcal{H}} \sum_{j=1}^T \epsilon_j \ell (h(\mathbf{x}_t(\boldsymbol{\epsilon})), h_\rho (\mathbf{x}_t(\boldsymbol{\epsilon}))) \Big] \Big] \nonumber \\
    &= \mathop{\mathbb{E}}_{\mathbf{x} \sim \Pi} \Big[\frac{1}{T} \mathop{\mathbb{E}}_{\boldsymbol{\epsilon}} \Big[ \chi_A \sup_{h \in \mathcal{H}} \sum_{j=1}^T \epsilon_j \ell (h(\mathbf{x}_t(\boldsymbol{\epsilon})), h_\rho (\mathbf{x}_t(\boldsymbol{\epsilon}))) \Big] \Big] \nonumber \\ 
    &\hspace{2cm}+ \mathop{\mathbb{E}}_{\mathbf{x} \sim \Pi} \Big[\frac{1}{T} \mathop{\mathbb{E}}_{\boldsymbol{\epsilon}} \Big[ \chi_{A^c} \sup_{h \in \mathcal{H}} \sum_{j=1}^T \epsilon_j \ell (h(\mathbf{x}_t(\boldsymbol{\epsilon})), h_\rho (\mathbf{x}_t(\boldsymbol{\epsilon}))) \Big] \Big] \nonumber \\
    &\leq \mathop{\mathbb{E}}_{\mathbf{x} \sim \Pi} \Big[\frac{1}{T} \mathop{\mathbb{E}}_{\boldsymbol{\epsilon}} \Big[ \chi_A \sup_{h \in \mathcal{H}} \sum_{j=1}^T \epsilon_j \ell (h(\mathbf{x}_t(\boldsymbol{\epsilon})), h_\rho (\mathbf{x}_t(\boldsymbol{\epsilon}))) \Big] \Big] + T^2 e^{-\sigma k} \nonumber \\
    &\leq \mathop{\mathbb{E}}_{\mathbf{x} \sim \Pi} \Big[\frac{1}{T} \mathop{\mathbb{E}}_{\boldsymbol{\epsilon}} \Big[ \chi_A \sup_{h \in \mathcal{H}} \sum_{j=1}^T \epsilon_j \ell (h(\mathbf{x}_t(\boldsymbol{\epsilon})), h_\rho (\mathbf{x}_t(\boldsymbol{\epsilon}))) \nonumber \\
    &\hspace{2cm}+  \sum_{j : Z_t^j \neq \mathbf{x}_t(\boldsymbol{\epsilon})} \sum_{t=1}^T \mathop{\mathbb{E}}_{\epsilon_{jt}} \epsilon_{jt} \ell (h(Z_t^j), h_\rho (Z_t^j)) \Big] \Big] + T^2 e^{-\sigma k} \nonumber \\
    &\leq  \mathop{\mathbb{E}}_{\mathbf{x} \sim \Pi} \Big[\frac{1}{T} \mathop{\mathbb{E}}_{\boldsymbol{\epsilon}} \Big[ \chi_A \sup_{h \in \mathcal{H}} \sum_{j=1}^T \epsilon_j \ell (h(\mathbf{x}_t(\boldsymbol{\epsilon})), h_\rho (\mathbf{x}_t(\boldsymbol{\epsilon}))) \nonumber \\
    &\hspace{2cm}+ \mathop{\mathbb{E}}_{\epsilon_{jt}} \sum_{j : Z_t^j \neq \mathbf{x}_t(\boldsymbol{\epsilon})} \sum_{t=1}^T  \epsilon_{jt} \ell (h(Z_t^j), h_\rho (Z_t^j)) \Big] \Big] + T^2 e^{-\sigma k} \nonumber \\
    &\leq \mathop{\mathbb{E}}_{\mathcal{D}} \Big[ \frac{1}{T} \mathop{\mathbb{E}}_{\epsilon_{jt}} \Big[ \sup_{h \in \mathcal{H}} \sum_{j = 1}^k \sum_{t = 1}^T \epsilon_{jt} \ell (h(Z_t^j), h_\rho (Z_t^j)) \Big] \Big] + T^2 e^{-\sigma k} \nonumber \\
    &\leq T^2 e^{-\sigma k} + \mathcal{R}_{kT} (\ell \circ \mathcal{H}).
\end{align}
\end{proof}
Here the first inequality comes from the fact that coupling constructed in the previous section bounds the probability of $\mathbf{x}_t (\boldsymbol{\epsilon}) \notin \{Z_t^j\}_{j=1}^k$ at least for one value of $t$. The second inequality follows from the fact that $\sigma_t$ has a zero mean while the third one follows Jensen's inequality.

\begin{proof}[Proof of \cref{theo:smooth_ub}]
    

As per \cref{eq:reg_rad} $\mathcal{V}_T$ is upper bounded by the sequential Rademacher complexity $\mathfrak{R}_T (\mathcal{H})$. Therefore it suffices to establish an upper bound on the latter in the smooth setting considered here. \cref{eq:rad_comp_ubound} bounds the distribution dependent sequential Rademacher complexity with the standard notion of Rademacher complexity which assumes independent samples. Assuming the loss function to be $L$-Lipschitz, the quantity $\mathcal{R}_{kT}(\ell \circ \mathcal{H})$ can be upper bounded as:
\begin{equation}
\label{eq:loss_to_nloss}
    \mathcal{R}_{kT}(\ell \circ \mathcal{H}) \leq L \mathcal{R}_{kT}(\mathcal{H}).
\end{equation}
The sequential Rademacher complexity can be bounded above by the sequential fat-shattering dimension. Likewise, one can establish upper bounds on $\mathcal{R}_{kT} (\mathcal{H})$:
\begin{equation}
\label{eq:integral_bounds}
    \mathcal{R}_{kT}(\mathcal{H}) \leq  \inf_{\alpha > 0} \Big\{ 4 \alpha k T + 12 \sqrt{kT} \int_\alpha^1 \sqrt{K \text{fat}_{c \delta} (\mathcal{H}) \log \frac{2}{\delta}} d\delta \Big\},
\end{equation}
where $K$ and $c$ are constants. Note here that $\text{fat}_{\delta} (\mathcal{H})$ unlike its sequential counterparts assume independent data. Therefore one can recover the definition of $\text{fat}_{\delta} (\mathcal{H})$ from their sequential version by replacing the $\mathcal{X}$ and $\mathbb{R}$-valued tree by the sets $\mathcal{X}$ and $\mathbb{R}$. Combining \cref{eq:rad_comp_ubound,eq:loss_to_nloss,eq:integral_bounds}, and setting $k = \frac{2 \log T}{\sigma}$ we get:
\begin{equation}
    \mathfrak{R}_T(\ell \circ \mathcal{H}, \mathcal{D}_\wedge) \leq 1 + L \inf_{\alpha > 0} \left\{ \frac{8 \alpha T \log T}{\sigma} + 12 \sqrt{\frac{2 T \log T}{\sigma}} \int_\alpha^1 \sqrt{K \text{fat}_{c \delta} (\mathcal{H}) \log \frac{2}{\delta}} d\delta \right\}.
\end{equation}
Now using the relation that $\text{fat}_\delta (\mathcal{H}_n) = O(n/\delta^2)$ when $\mathcal{H}_n=\{\operatorname{Tr}_\omega, \omega\in\mathcal C_n\}$ and setting $K = c = 1$ we get:
\begin{equation}
\label{eq:penultimate_ubound}
    \mathfrak{R}_T(\ell \circ \mathcal{H}_n, \mathcal{D}_\wedge) \leq 1 + L \inf_{\alpha > 0} \left\{ \frac{8 \alpha T \log T}{\sigma} + 12 \sqrt{\frac{2 n T \log T}{\sigma}} \int_\alpha^1 \sqrt{\frac{1}{\delta^2} \log \frac{2}{\delta}} d\delta \right\}.
\end{equation}
Finally to eliminate the infimum in \cref{eq:penultimate_ubound} we recall that $\alpha \in [0,1]$ and therefore for any function $f$ on $\alpha$ we get $\inf_{\alpha} f(\alpha) \leq f (\alpha = \alpha^\star); \ \alpha^\star \in [0,1]$. Thus setting $\alpha = \sqrt{\frac{n \sigma}{T \log T}}$, we get:
\begin{equation}
    \mathfrak{R}_T(\ell \circ \mathcal{H}_n, \mathcal{D}_\wedge) = O \Bigg(\sqrt{\frac{nT \log T}{\sigma}} \ \Bigg).
\end{equation}
\end{proof}

