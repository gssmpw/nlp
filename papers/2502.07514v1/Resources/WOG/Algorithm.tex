\subsection{Weakly Observable Graph Bandits}
\label{sec:wog}

\begin{algorithm}[!ht]
    \caption{WOG-BARBAC}
    \label{algs:WOG-BARBAC} % Weakly Observable Graph
    \begin{algorithmic}[1]
        \STATE \textbf{Parameters:} Initial round $t_0=0$, the independence number $\alpha$ of graph $\mathcal{G}$.
        \STATE Initialize $T_0 = 0$ and $\Delta_k^0 = 1$ for all $k \in \mathcal{K}$.
        \FOR{epochs $m = 1,2,...$}
            \STATE Set $\zeta_m \leftarrow 2048(m + 4)2^{2(m-1)}\ln (K)$, $\delta_m \leftarrow 1/(\gamma\zeta_m)$.
            \STATE Set $\lambda_m \leftarrow 256 \ln{\left(8K / \delta_m\right)}$ and $\beta_m \leftarrow \delta_m / (2K)$.
            \STATE Set $N_m \leftarrow \gamma \lambda_m 2^{2(m-1)}$
            and $T_m \leftarrow T_{m-1} + N_m$.
            \STATE Set $n_k^m \leftarrow \lambda_m (\Delta_k^{m-1})^{-2}$ for all $k \in \mathcal{K}$.
            \STATE Build a pulling arm times array $Z^m[K] = \{0\}$ and $H^m \leftarrow [K]$.
            \STATE Select the largest $n_k^m$ arm as $k_c$ and get the domain arm $k'$.
            \STATE Set $Z^m [k'] = \max_{k \neq k_c} n_k^m$ and $H^m \leftarrow H^m - \phi(k')$, where $\phi(k')$ represents the set of arms where rewards can be observed by pulling arm $k'$.
            \REPEAT
                \STATE Choose an arm $k \in \arg\max_{k \in H^m}n_k^m$ and get the domain arm $k'$.
                \STATE Set $Z^m[k'] = n_k^m$ and $H^m \leftarrow H^m - \phi(k')$.
            \UNTIL{$H^m = \varnothing$}
            \STATE Build the actual expected number of pulls as \\
            $\widetilde{n}_k^m = \begin{cases}
                Z^m[k] & k \neq k_c \\
                N_m - \sum_{k \neq k_c} Z^m[k] & k = k_c
            \end{cases}$.
            \STATE Build the actual expected observable times as
            $\hat{n}_k^m = \sum_{l: (l, k) \in E} \widetilde{n}_l^m $.
            \FOR{$t = t_0 + T_{m-1} + 1$ to $t_0 + T_m$}
                \STATE Choose arm $I_t\sim p_m$ where $p_m(k)= \widetilde{n}_k^m / N_m$.
                \STATE Observe the corrupted reward $\widetilde{r}_{I_t}$ and update the total reward
                $S_{I_t}^m = S_{I_t}^m + \widetilde{r}_{I_t}$.
            \ENDFOR 
            \STATE Set $r_k^m \leftarrow \min \{S_k^m / \hat{n}_k^m, 1\}$.
            \STATE Set $r_*^m \leftarrow \max_{k \in \mathcal{K}}\{r_k^m - \sqrt{\frac{4\ln(4 / \beta_m)}{\hat{n}_k^m}}\}$.
            \STATE Set $\Delta_k^m \leftarrow \max\{2^{-m}, r_*^m - r_k^m\}$.
        \ENDFOR
    \end{algorithmic}
\end{algorithm}

In weakly observable setting, The agent only needs to pull one sub-set of $K$ arms to observe rewards in all arms, where the subset is called domain set. We define the smallest domain set of the graph $\mathcal{G}$ as $dom(\mathcal{G})$ and $\gamma = |dom(\mathcal{G})|$. Same as SOG-BARBAC, we set the confidence level $\delta_m = 1/(\gamma\zeta_m)$ and the epoch $m$'s length $N_m = \gamma \lambda_m 2^{2(m-1)}$.

Due to different settings, we also need to redesign the actual expected number of pulls $\widetilde{n}_k^m$. Firstly, WOG-BARBAC build a pulling arm times array $Z^m[K] = {0}$ and a set $H^m = [K]$ of conditions to judge. Different from SOG-BARBAC, WOG-BARBAC needs to select the largest $n_k^m$ arm, marked as $k_c$, and get the domain arm $k'$. Then $Z^m[k'] = \max_{k \neq k_c}n_k^m$ and $H^m \leftarrow H^m - \phi(k')$. You may be wondering why we donâ€™t set $Z^m[k'] = n_{k_c}^m$ to ensure that we can observe the reward of arm $k_c$ at least 
$n_{k_c}^m$ times. As mentioned before, when the number of epochs is large enough and the
corruption level is insufficient, $k_c$ is always guaranteed to be the optimal arm, so we 
cannot set $Z^m[k'] = n_{k_c}^m$ because this will lead to linear regret if $k'$ is the sub-optimal arm. As mention in SOG-BARBAC, by theoretical analysis, this problem $\hat{n_{k_c}}^m < n_{k_c}^m$ does not affect the theoretical derivation of regret. Next, WOG-BARBAC repeat choose an arm $k \in \arg\max_{k \in H^m}n_k^m$, get the domain arm $k'$, set $Z^m \leftarrow Z^m [k'] = n_k^m$ and $H^m \leftarrow H^m - \phi(k')$. Finally, WOG-BARBAC build the actual expected number of pulls $\widetilde{n}_k^m$ according the pulling arm array $Z^m$.

We show that the WOG-BARBAC algorithm have the following regret bound. The proof is given in Appendix \ref{ape:wog}.

\begin{theorem}
\label{the:wog-erm}    % The expected regret of Algorithm WOG-BARBAC
    We define the set $\mathcal{T}^*$ as follows:
    \[\mathcal{T}^* = \mathop{\arg\max}_{\mathcal{T} \in dom(\mathcal{G})}\sum_{k \in \mathcal{T}, \Delta_k > 0}\frac{1}{\Delta_k}.\]
    Where $dom(\mathcal{G})$ represents the set of arms dominated by each arm in the smallest domination set.
    
    The expected regret of WOG-BARBAC satisfies
    \[R(T) = O\left(\sum_{k \in \mathcal{T}^*}\frac{C}{\gamma\Delta_k} + \sum_{k \in \mathcal{T}^*}\frac{\log^2(T)}{\Delta_{k}^2} + \frac{\gamma}{\Delta}\right).\]
\end{theorem}