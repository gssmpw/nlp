\section{Proof of Theorem \ref{the:ds-erb}}
\label{ape:ds}
\subsection{Notations}
Following~\citep{zimmert2019beating,dann2023blackbox}, with loss of generality, we assume $\mu_1 \geq \mu_2 \geq \cdots \geq \mu_K$ and $\Delta_k = \mu_k - \mu_d$ for all arms $k > d$.

\subsection{Lemmas for Proving Theorem \ref{the:ds-erb}}

By the methods mentioned before, Lemma \ref{lem:tne} still holds.
For Lemma \ref{lem:rkc}, we need to consider the impact of changing $k_m$ representing an arm to representing an arm set.

\begin{lemma}
\label{lem:rkcsemi}    % (Semi) The reason of k_m (semi)
    For any epoch $m$, the length $N_m$ satisfies $d N_m \geq \sum_{k \in \mathcal{K}}n_k^m$. The actual expected pulling times $\widetilde{n}_k^m \geq n_k^m$ for all arms $k \in [K]$.
\end{lemma}
\begin{proof}
    Since $\Delta_k^m = \max \{2^{-m}, r_*^m - r_k^m\} \geq 2^{-m}$, we can get
    \[n_k^m = \lambda_m (\Delta_k^{m-1})^{-2} \leq \lambda_m 2^{2(m-1)}.\]
    Therefore, we have
    \[\sum_{k \in \mathcal{K}}n_k^m \leq K \lambda_m 2^{2(m-1)} = d N_m.\]
    Since $N_m = K \lambda_m 2^{2(m-1)} / d$, so for arm $k \in \cK_m$, we have
    \[\widetilde{n}_{k}^m = N_m  - \sum_{k \not\in \cK_m} n_k^m /d \geq \lambda_m 2^{2(m-1)} \geq n_k^m.\]
    This proof is complete.
\end{proof}

Using the methods mentioned before, all lemmas in Appendix \ref{ape:mab} still holds. Maybe Lemma \ref{lem:bsg} will be different because we changed the way $r_{*}^m$ is assigned. Next we will prove that Lemma \ref{lem:bsg} still holds.
\begin{proof}
    Since $|r_k^m - \mu_k| \leq \sqrt{\frac{4\ln(4 /\beta_m)}{\widetilde{n}_k^m}} + \frac{D_m}{N_m}$, we have
    \[-\frac{D_m}{N_m} - \sqrt{\frac{4\ln(4 /\beta_m)}{\widetilde{n}_k^m}} \leq r_{k}^m - \mu_{k} \leq \frac{D_m}{N_m} + \sqrt{\frac{4\ln(4 /\beta_m)}{\widetilde{n}_k^m}}.\]
    Additionally, since
    \[r_{*}^m \leq \top(d)_{k}\left\{\mu_{k} + \frac{D_m}{N_m} + \sqrt{\frac{4\ln(4 /\beta_m)}{\widetilde{n}_k^m}} - \sqrt{\frac{4\ln(4 /\beta_m)}{\widetilde{n}_k^m}}\right\} \leq \mu_{d} + \frac{D_m}{N_m},\]
    \[r_{*}^m = \top(d)_{k} \left\{r_k^m - \sqrt{\frac{4\ln(4 /\beta_m)}{\widetilde{n}_k^m}}\right\} \geq r_{d}^m - \sqrt{\frac{4\ln(4 /\beta_m)}{\widetilde{n}_{d}^m}} \geq \mu_{d} - 2\sqrt{\frac{4\ln(4 /\beta_m)}{\widetilde{n}_{d}^m}} - \frac{D_m}{N_m},\]
    we can get
    \[-\frac{D_m}{N_m} - 2\sqrt{\frac{4\ln(4 /\beta_m)}{\widetilde{n}_{d}^m}} \leq r_{*}^m - \mu_{d} \leq \frac{D_m}{N_m}.\]
    According to Algorithm \ref{algs:BARBAT} and Lemma \ref{lem:rkc}, we have $\widetilde{n}_k^m \geq n_k^m$ for all arms $k$. Then we have the following inequality for all $k\in [K]$:
    \[\sqrt{\frac{4\ln(4 /\beta_m)}{\widetilde{n}_k^m}} \leq \sqrt{\frac{4\ln(4 /\beta_m)}{n_k^m}} = \frac{\Delta_k^{m-1}}{8}.\]

    We now establish the upper bound for $\Delta_k^m$ by induction on $m$.
    
    For the base case $m = 1$, the statement is trivial as $\Delta_k^1 = 1$ for all $k \in [K]$.
    
    Assuming the statement is true for the case of $m-1$, we have
    \begin{equation*}
    \begin{split}
        \Delta_k^m = r_*^m - r_k^m
        &= (r_*^m - \mu_{d}) + (\mu_{d} - \mu_k) + (\mu_k - r_k^m) \\
        &\leq \frac{D_m}{N_m}+ \Delta_k + \frac{D_m}{N_m} + \frac{1}{8}\Delta_k^{m-1} \\
        &\leq \frac{2D_m}{N_m} + \Delta_k + \frac{1}{8}\left(\frac{8 \Delta_k}{7} + 2^{-(m-2)} + 2\rho_{m-1}\right) \\
        &\leq \frac{8 \Delta_k}{7} + 2^{-(m-1)} + 2\rho_m,
    \end{split}
    \end{equation*}
    Where the second inequality follows from the induction hypothesis.
     
    Next, we provide the lower bound of $\Delta_k^m$. We can get
    \begin{equation*}
    \begin{split}
        \Delta_k^m =  r_*^m - r_k^m
        &= (r_*^m - \mu_{d}) + (\mu_{d} - \mu_k) + (\mu_k - r_k^m) \\
        &\geq -\frac{D_m}{N_m} - \frac{1}{4}\Delta_{k^*}^{m-1} + \Delta_k -\frac{D_m}{N_m} - \frac{1}{8}\Delta_k^{m-1} \\
        &\geq -\frac{2D_m}{N_m} + \Delta_k - \frac{3}{8}\left(\frac{8 \Delta_k}{7} + 2^{-(m-2)} + 2\rho_{m-1}\right) \\
        &\geq \frac{4}{7}\Delta_k - \frac{3}{2}2^{-m} - 6\rho_m.
    \end{split}
    \end{equation*}
    where the third inequality comes from the upper bound of $\Delta_k^{m-1}$.
\end{proof}

\subsection{Proof for Theorem \ref{the:ds-erb}}

Following to the work~\cite{zimmert2019beating}, we can define the regret $R_k^m$ generated by arm $k$ in epoch $m$ as 
\[R_k^m\triangleq\Delta_k\widetilde{n}_{k}^m=\begin{cases}
    \Delta_kn_{k}^m & k\not\in \cK_m\\
    \Delta_k\widetilde{n}_{k}^m & k \in \cK_m
\end{cases}.\]
Then we analyze the regret in following three cases:

\paragraph{Case 1:} $0<\Delta_k\le 64\rho_{m-1}$.\\ 
If $k\not\in \cK_m$, then we have \[R_k^m=\Delta_k n_{k}^m\le 64\rho_{m-1}n_k^m .\] 
If $k\in \cK_m$, then we have \[R_k^m=\Delta_k\widetilde{n}_{k_m}^m\le 64\rho_{m-1}dN_m.\]

\paragraph{Case 2:} $\Delta_k \leq 8 \cdot 2^{-m}$ and $\rho_{m-1} \leq \frac{\Delta_k}{64}$.\\
If $k\not\in \cK_m$, then we have \[R_k^m=n_{k}^m\Delta_k =\lambda_m(\Delta_k^{m-1})^{-2} \Delta_k \leq \lambda_m 2^{2(m-1)} \Delta_k  \leq \frac{16 \lambda_m}{\Delta_k}.\] 
If $k\in \cK_m$, since $\Delta_{k_m}^{m-1} = 2^{-(m-1)}$, we can get:
\begin{align*}
    R_k^m=\widetilde{n}_{k_m}^m \Delta_{k_m} \leq 
    dN_m\Delta_{k_m} = d\lceil K\lambda_m 2^{2(m-1)} /d \rceil \Delta_{k_m} \leq \frac{16Kd\lambda_m}{\Delta_{k_m}} + d\Delta_{k_m} \leq \frac{16Kd\lambda_m}{\Delta} + d.
\end{align*}

\paragraph{Case 3:} $\Delta_k > 8 \cdot 2^{-m}$ and $\rho_{m-1} \leq \frac{\Delta_k}{64}$.\\
By Lemma \ref{lem:bsg} we have
\[\Delta_k^{m-1} \geq \frac{4}{7}\Delta_k - \frac{3}{2}2^{-m} - \frac{6}{64}\Delta_k \geq \Delta_k\left(\frac{4}{7} - \frac{3}{16} - \frac{6}{64}\right) \geq 0.29 \Delta_k.\]
In this case, it is impossible that $k \in \cK_m$ because $\Delta_{k_m}^{m-1} = 2^{-(m-1)}<0.29\cdot 8\cdot 2^{-m}<0.29\Delta_k$.
So we can obtain
\begin{align*}
   R_k^m= n_k^m \Delta_k = \lambda_m(\Delta_k^{m-1})^{-2} \Delta_k
    \leq \frac{\lambda_m}{0.29^2 \Delta_k} 
    \leq \frac{16\lambda_m}{\Delta_k}.
\end{align*}

We define $\cA^m\triangleq\left\{ k\in[K]\,\big|\,0<\Delta_k\le 64\rho_{m-1} \right\}$ for epoch $m$. By combining all three cases, we can upper bound the regret as
\begin{equation}\label{eq:dsmab-regret}
\begin{split}
R(T)=&\sum_{m=1}^M\Bigg(\sum_{k \in \mathcal{A}^m} R_k^m + \sum_{k \notin \mathcal{A}^m} R_k^m\Bigg)\\    
\le& \sum_{m=1}^M\Bigg( 64\rho_{m-1}d N_m+\sum_{k \in \mathcal{A}^m,k\neq k_m} 64\rho_{m-1}n_k^m + \sum_{k \notin \mathcal{A}^m, \Delta_k>0} \frac{16\lambda_m}{\Delta_k}\\
&+ \left(\frac{16Kd\lambda_m}{\Delta} + d\right)\BI(0<\Delta_{k_m} \le 8 \cdot 2^{-m}) \Bigg)\\ 
\le& \sum_{m=1}^M\Bigg( 64\rho_{m-1}dN_m+\sum_{\Delta_k>0} 64\rho_{m-1}n_k^m + \sum_{\Delta_k>0} \frac{16\lambda_m}{\Delta_k} \\
&+ \left(\frac{16Kd\lambda_m}{\Delta} + d\right)\BI\left(m\le \log_2\left(8/\Delta\right)\right)\Bigg)\\ 
\le& \sum_{m=1}^M\Bigg( 128\rho_{m-1}dN_m + \sum_{\Delta_k>0} \frac{16\lambda_m}{\Delta_k}\Bigg)+ \sum_{m=1}^{\log_2(8/\Delta)}\left(\frac{16Kd\lambda_m}{\Delta} + d\right)
\end{split}
\end{equation}
where the last inequality uses the fact that $\sum_{\Delta_k>0} n_k^m\le N_m$. Notice that we can bound the expectation of the offset level as
\[\mathbb{E}[D_m] = 2(1-\delta_m)C_m + \delta_m N_m \leq 2C_m + 1\]
and we can bound $\sum_{m=1}^M \rho_{m-1} N_m$ as
\begin{equation}\label{eq:dsmab-rho}
    \begin{split}
        \sum_{m=1}^M \rho_{m-1} dN_m
        &\leq \sum_{m=1}^M \left(\sum_{s=1}^{m-1}\frac{D_s}{8^{m-1-s}N_s}\right)dN_m \\
        &\leq 4d\sum_{m=1}^M \left(\sum_{s=1}^{m-1}\frac{(4^{m-1-s} + 1)\lambda_m}{8^{m-1-s}\lambda_s}D_s\right) \\
        &= 4d\sum_{m=1}^M \left(\sum_{s=1}^{m-1}((7/12)^{m-1-s} + (7/48)^{m-1-s})D_s\right) \\
        &= 4d\sum_{s=1}^{M-1} D_s \sum_{m=s+1}^M (7/12)^{m-1-s} + (7/48)^{m-1-s}\\
        &\leq 4d\left(\sum_{m=1}^{M-1} D_m\right)\sum_{j=0}^{\infty} \left(7/12\right)^{j} + \left(7/48\right)^{j} 
        \leq 11d\sum_{m=1}^{M-1} D_m.
    \end{split}
\end{equation}
Combining Eq.~\eqref{eq:dsmab-regret} and Eq.~\eqref{eq:dsmab-rho}, by Lemma \ref{lem:tsl}, we can get
\begin{equation*}
    \begin{split}
        \BE[R(T)]
        &\leq \sum_{m=1}^{M-1} 1440 \BE[dD_m] + \sum_{m=1}^M \sum_{\Delta_k > 0}\frac{16\lambda_m}{\Delta_k} + \sum_{m=1}^{\log_2(8/\Delta)}\left(\frac{16Kd\lambda_m}{\Delta} + d\right) \\
        &\leq \sum_{m=1}^{M-1} 1440 \BE[dD_m] + \sum_{\Delta_k > 0}\frac{2^{12}(\log^2(T) + 3\log(T)\log(30K))}{\Delta_k} \\
        &\quad + \frac{2^{12}Kd(\log^2(8/\Delta) + 3\log(8/\Delta)\log(30K)))}{\Delta} + d\log(8/\Delta) \\
        &\leq \sum_{m=1}^{M-1} 2880 dC_m + 1440d + \sum_{\Delta_k > 0}\frac{2^{14}\log(T)\log(30KT)}{\Delta_k} \\
        &\quad+ \frac{2^{14}Kd\log(8/\Delta)\log(240K / \Delta)}{\Delta} + d\log(8/\Delta) \\ 
        &= O\left(dC + \sum_{\Delta_k > 0}\frac{\log(T)\log(KT)}{\Delta_k} + \frac{dK\log(1 / \Delta)\log(K / \Delta)}{\Delta}\right).
    \end{split}
\end{equation*}
