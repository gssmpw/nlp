\section{Details about Experiments}\label{appd}
% \vspace{-10pt}
\subsection{Details about Datasets}
\label{appd1}
We list details about the used datesets in 10 image restoration tasks in Table \ref{tab:dataset}.
\begin{table}[h]
    \centering
    \begin{minipage}{0.98\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{cccc}
        			\toprule[1.5pt]
                    % \multicolumn{6}{c}{Rainy} \\
                    % \cmidrule(lr){1-6}
                    Task name                &Dataset name                     &Reference                                                                      &Number of testing images         \\
                    \cmidrule(lr){1-4}
                    Blurry                   &GoPro                           &\cite{nah2017deep}                                                              &1111                  \\
                    \cmidrule(lr){1-4}
                    Hazy                     &RESIDE-6k                       &\cite{qin2020ffa}                                                               &1000                  \\
                    \cmidrule(lr){1-4}
                    JPEG-compressing         &DIV2K, Flickr2K and LIVE1       &\cite{agustsson2017ntire},\cite{timofte2017ntire}, \cite{sheikh2005live}        &29                    \\
                    \cmidrule(lr){1-4}
                    Low-light                &LOL                             &\cite{wei2018deep}                                                              &15                    \\
                    \cmidrule(lr){1-4}
                    Noisy                    &DIV2K, Flickr2K and CBSD68      &\cite{agustsson2017ntire},\cite{timofte2017ntire},\cite{martin2001database}     &68                    \\
                    \cmidrule(lr){1-4}
                    Raindrop                 &RainDrop                        &\cite{qian2018attentive}                                                        &58                    \\
                    \cmidrule(lr){1-4}
                    Rainy                    &Rain100H                        &\citep{yang2017deep}                                                            &100                   \\
                    \cmidrule(lr){1-4}
                    Shadowed                 &SRD                             &\citep{qu2017deshadownet}                                                       &408                   \\
                    \cmidrule(lr){1-4}
                    Snowy                    &Snow100K-L                      &\citep{liu2018desnownet}                                                        &601                   \\
                    \cmidrule(lr){1-4}
                    Inpainting               &CelebaHQ                        &\citep{lugmayr2022repaint}                                                      &100                   \\           
                    \bottomrule[1.5pt]
        \end{tabular}}
        \caption{\textbf{Details about the used datasets in 10 image restoration tasks}}
        \label{tab:dataset}
    \end{minipage}
\end{table}
% \vspace{-20pt}

\subsection{Details on the neural network architecture}
\label{appd2}

In this section, we describe the neural network architecture used in experiments. We follow the framework of \cite{luo2024daclip}, an image restoration model designed to address multiple degradation problems simultaneously without requiring prior knowledge of the degradation. The diffusion model in \cite{luo2024daclip} is derived from \cite{luo2023refusion}, and its neural network architecture is based on \textit{NAFNet}. NAFNet builds upon the U-Net architecture by replacing traditional activation functions with \textit{SimpleGate} and incorporating an additional multi-layer perceptron to manage channel scaling and offset parameters for embedding temporal information into the attention and feedforward layers. For further details, please refer to Section 4.2 in \cite{luo2023refusion}. 

\subsection{Detailed metrics on all tasks}
\label{appd3}

We list results on four metrics for ten image restoration tasks in Table \ref{tab:app_inpaint}-\ref{tab:app_blurry}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% First row %%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[h]
    \centering
    \begin{minipage}{0.48\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{cccccc}
			\toprule[1.5pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE                   &Method          &LPIPS\textdownarrow  &FID\textdownarrow   &PSNR\textuparrow    & SSIM\textuparrow   \\
            \cmidrule(lr){1-6}
            \multirow{4}{*}{100}   & Posterior      & \textbf{0.0385}     & {18.35}            & \textbf{29.49}     & \textbf{0.9102}    \\
                                   & Euler          & 0.0426              & 20.71              & 29.34              & 0.8981             \\
                                   & \ourmethod-1   & 0.0390              & \textbf{18.16}     & 29.45              & 0.9086             \\
                                   & \ourmethod-2   & 0.0397              & 18.81              & 29.30              & 0.9055             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{50}   & Posterior       & 0.4238              & {247.0}            & {12.85}            & {0.6048}     \\
                                  & Euler           & 0.4449              & 249.5              & 12.68              & 0.5800              \\
                                  & \ourmethod-1    & \textbf{0.0379}     & \textbf{18.03}     & \textbf{29.68}     & \textbf{0.9118}              \\
                                  & \ourmethod-2    & 0.0402              & 19.09              & 29.15              & 0.9046              \\
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{20}   & Posterior       & 0.7130              & {347.4}            & {10.19}            & {0.2171}    \\
                                  & Euler           & 0.7257              & 344.3              & 10.16              & 0.2073             \\
                                  & \ourmethod-1    & \textbf{0.0383}     & \textbf{18.29}     & \textbf{30.05}     & \textbf{0.9172 }            \\
                                  & \ourmethod-2    & 0.0408              & 19.13              & 28.98              & 0.9032             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{10}   & Posterior       & {0.8097}            & {374.1}            & {9.802}            & {0.1339}     \\
                                  & Euler           & 0.8154              & 381.1              & 9.786              & 0.1305             \\
                                  & \ourmethod-1    & \textbf{0.0401}     & \textbf{18.46}     & \textbf{30.61}     & \textbf{0.9229}              \\
                                  & \ourmethod-2    & 0.0437              & 19.29              & 28.48              & 0.8996              \\  
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{5}   & Posterior       & {0.8489}             & {385.6}            & {9.599}            & {0.1057}     \\
                                  & Euler           & 0.8525              & 384.7              & 9.587              & 0.1042             \\
                                  & \ourmethod-1    & \textbf{0.0428}     & \textbf{20.00}     & \textbf{31.03}     & \textbf{0.9262}              \\
                                  & \ourmethod-2    & 0.0529              & 24.02              & 28.35              & 0.8930              \\ 
                          
            \bottomrule[1.5pt]
        \end{tabular}}
        \caption{\textbf{Image inpainting.}}
        \label{tab:app_inpaint}
    \end{minipage}
    \hspace{0.01\textwidth}
    \begin{minipage}{0.48\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{cccccc}
			\toprule[1.5pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE                   &Method          &LPIPS\textdownarrow  &FID\textdownarrow   &PSNR\textuparrow    & SSIM\textuparrow   \\
            \cmidrule(lr){1-6}
            \multirow{4}{*}{100}   & Posterior      & {0.0614}            & 21.42              & {27.43}            & \textbf{0.8763}    \\
                                   & Euler          & 0.0683              & 23.27              & 27.09              & 0.8577             \\
                                   & \ourmethod-1   & \textbf{0.0608 }    & \textbf{21.30}     & \textbf{27.45}     & 0.8754             \\
                                   & \ourmethod-2   & 0.0626              & 21.47              & 27.18              & 0.8691             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{50}   & Posterior       & {0.2374}            & {72.04}            & {21.35}            & {0.7037}     \\
                                  & Euler           & 0.2730              & 76.02              & 21.02              & 0.6676              \\
                                  & \ourmethod-1    & \textbf{0.0602}     & \textbf{20.91}     & \textbf{27.63}     & \textbf{0.8803}              \\
                                  & \ourmethod-2    & 0.0628              & 21.85              & 27.08              & 0.8685              \\
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{20}   & Posterior       & {0.6622}            & {123.8}            & {16.42}          & {0.3546}    \\
                                  & Euler           & 0.6861              & 126.0              & 16.23            & 0.3431             \\
                                  & \ourmethod-1    & \textbf{0.0601}     & \textbf{21.32}     & \textbf{28.07}   & \textbf{0.8903}             \\
                                  & \ourmethod-2    & 0.0650              & 22.34              & 26.89            & 0.8645             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{10}   & Posterior       & {0.8013}            & {138.5}            & {14.76}          & {0.2694}     \\
                                  & Euler           & 0.8164              & 140.4              & 14.64            & 0.2640             \\
                                  & \ourmethod-1    & \textbf{0.0608}     & \textbf{22.26}     & \textbf{28.50}   & \textbf{0.8992}              \\
                                  & \ourmethod-2    & 0.0698              & 23.92              & 26.49            & 0.8573              \\  
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{5}   & Posterior        & {0.8590}            & {145.8}            & 13.92            & {0.2318}     \\
                                  & Euler           & 0.8680              & 145.8              & 13.85            & 0.2290             \\
                                  & \ourmethod-1    & \textbf{0.0611}     & 23.29              & \textbf{28.89}   & \textbf{0.9065}              \\
                                  & \ourmethod-2    & 0.0628              & \textbf{21.95}     & 27.06              & 0.8718              \\ 
                          
            \bottomrule[1.5pt]
        \end{tabular}}
        \caption{\textbf{Snowy image restoration.}}
        \label{tab:app_snowy}
    \end{minipage}
\end{table}

\newpage 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% second row %%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[h]
    \centering
    \begin{minipage}{0.48\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{cccccc}
			\toprule[1.5pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE                   &Method          &LPIPS\textdownarrow  &FID\textdownarrow   &PSNR\textuparrow    & SSIM\textuparrow   \\
            \cmidrule(lr){1-6}
            \multirow{4}{*}{100}   & Posterior      & \textbf{0.0970}     & 20.14              & \textbf{27.84}     & \textbf{0.8391}    \\
                                   & Euler          & 0.1129              & 20.30              & 27.59              & 0.8112             \\
                                   & \ourmethod-1   & 0.0984              & \textbf{20.03}      & 27.73              & 0.8370             \\
                                   & \ourmethod-2   & 0.0989              & 20.69              & 27.44              & 0.8329             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{50}   & Posterior       & 0.6119              & 101.8              & 18.29              & 0.4720     \\
                                  & Euler           & 0.6985              & 114.2              & 17.80              & 0.4123              \\
                                  & \ourmethod-1    & \textbf{0.0978}      & 20.90              & \textbf{27.92}     & \textbf{0.8409}              \\
                                  & \ourmethod-2    & 0.1006              & \textbf{20.74}      & 27.20              & 0.8310              \\
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{20}   & Posterior       & 1.043               & 187.2              & 14.73              & 0.2049    \\
                                  & Euler           & 1.065               & 192.9              & 14.56              & 0.1955             \\
                                  & \ourmethod-1    & \textbf{0.0954}     & \textbf{19.79}      & \textbf{28.31}     & \textbf{0.8505}             \\
                                  & \ourmethod-2    & 0.1014              & 20.93              & 27.17              & 0.8299             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{10}   & Posterior       & 1.122               & 208.4              & 13.67              & 0.1525     \\
                                  & Euler           & 1.133               & 209.7              & 13.57              & 0.1484             \\
                                  & \ourmethod-1    & \textbf{0.0956}     & \textbf{19.87}     & \textbf{28.67}     & \textbf{0.8554}              \\
                                  & \ourmethod-2    & 0.1044              & 21.85              & 26.99              & 0.8276              \\  
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{5}   & Posterior        & 1.155               & 218.9              & 13.12              & 0.1298     \\
                                  & Euler           & 1.161               & 221.4              & 13.06              & 0.1278             \\
                                  & \ourmethod-1    & \textbf{0.0964}     & \textbf{20.16}     & \textbf{28.90}     & \textbf{0.8601}              \\
                                  & \ourmethod-2    & 0.2203              & 36.69              & 23.73              & 0.6690              \\ 
                          
            \bottomrule[1.5pt]
        \end{tabular}}
        \caption{\textbf{Shadowed image restoration.}}
        \label{tab:app_shadowed}
    \end{minipage}
    \hspace{0.01\textwidth}
    \begin{minipage}{0.48\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{cccccc}
			\toprule[1.5pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE                   &Method          &LPIPS\textdownarrow  &FID\textdownarrow   &PSNR\textuparrow    & SSIM\textuparrow   \\
            \cmidrule(lr){1-6}
            \multirow{4}{*}{100}   & Posterior      & \textbf{0.0594}     & \textbf{25.58}     & 29.14              & \textbf{0.8704}    \\
                                   & Euler          & 0.0725              & 28.80              & 28.77              & 0.8473             \\
                                   & \ourmethod-1   & \textbf{0.0594}     & 30.53              & \textbf{29.15}     & 0.8679             \\
                                   & \ourmethod-2   & 0.0616              & 27.33              & 28.92              & 0.8614             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{50}   & Posterior       & 0.4418              & 183.1              & 16.41              & 0.4903     \\
                                  & Euler           & 0.4560              & 185.2              & 16.24              & 0.4729              \\
                                  & \ourmethod-1    & \textbf{0.0586}     & 30.73              & \textbf{29.34}     & \textbf{0.8730}              \\
                                  & \ourmethod-2    & 0.0620              & \textbf{27.65}     & 28.85              & 0.8602              \\
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{20}   & Posterior       & 0.6865              & 293.6              & 12.54              & 0.2464    \\
                                  & Euler           & 0.6943              & 299.0              & 12.49              & 0.2402             \\
                                  & \ourmethod-1    & \textbf{0.0604}     & 31.19              & \textbf{29.81}     & \textbf{0.8845}             \\
                                  & \ourmethod-2    & 0.0635              & \textbf{27.79}     & 28.60              & 0.8559             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{10}   & Posterior       & 0.7972              & 323.0              & 11.50              & 0.1755     \\
                                  & Euler           & 0.8043              & 330.8              & 11.46              & 0.1724             \\
                                  & \ourmethod-1    & \textbf{0.0659}     & 31.66              & \textbf{30.28}     & \textbf{0.8943}              \\
                                  & \ourmethod-2    & 0.0678              & \textbf{29.54}     & 28.09              & 0.8483              \\  
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{5}   & Posterior        & 0.8663              & 332.4              & 10.96              & 0.1450     \\
                                  & Euler           & 0.8714              & 332.5              & 10.94              & 0.1435             \\
                                  & \ourmethod-1    & 0.0729              & 32.06              & \textbf{30.68}     & \textbf{0.9029}              \\
                                  & \ourmethod-2    & \textbf{0.0637}     & \textbf{26.92}     & 28.82              & 0.8685              \\ 
                          
            \bottomrule[1.5pt]
        \end{tabular}}
        \caption{\textbf{Rainy image restoration.}}
        \label{tab:app_rainy}
    \end{minipage}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% third row %%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[h]
    \centering
    \begin{minipage}{0.48\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{cccccc}
			\toprule[1.5pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE                   &Method          &LPIPS\textdownarrow  &FID\textdownarrow   &PSNR\textuparrow    & SSIM\textuparrow   \\
            \cmidrule(lr){1-6}
            \multirow{4}{*}{100}   & Posterior      & 0.0443              & \textbf{19.70}     & \textbf{30.05}     & \textbf{0.8910}    \\
                                   & Euler          & 0.0634              & 24.19              & 29.31              & 0.8438             \\
                                   & \ourmethod-1   & \textbf{0.0437}     & 19.94              & 29.91              & 0.8852             \\
                                   & \ourmethod-2   & 0.0454              & 21.35              & 29.55              & 0.8768             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{50}   & Posterior       & 0.4289              & 100.1              & 23.19              & 0.4663     \\
                                  & Euler           & 0.5011              & 111.6              & 22.35              & 0.4106              \\
                                  & \ourmethod-1    & \textbf{0.0428}     & \textbf{19.14}     & \textbf{30.07}     & \textbf{0.8914}             \\
                                  & \ourmethod-2    & 0.0459              & 20.50              & 29.40              & 0.8764              \\
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{20}   & Posterior       & 0.8873              & 190.8              & 17.37              & 0.1925    \\
                                  & Euler           & 0.9082              & 194.1              & 17.10              & 0.1839             \\
                                  & \ourmethod-1    & \textbf{0.0439}     & \textbf{19.31}     & \textbf{30.44}     & \textbf{0.9025}             \\
                                  & \ourmethod-2    & 0.0470              & 21.08              & 29.34              & 0.8745             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{10}   & Posterior       & 0.9884              & 215.5              & 15.67              & 0.1419     \\
                                  & Euler           & 0.9993              & 213.1              & 15.52              & 0.1381             \\
                                  & \ourmethod-1    & \textbf{0.0466}     & \textbf{20.60}     & \textbf{30.77}     & \textbf{0.9114}              \\
                                  & \ourmethod-2    & 0.0485              & 22.17              & 29.37              & 0.8779              \\  
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{5}   & Posterior        & 1.030               & 226.3              & 14.82              & 0.1209     \\
                                  & Euler           & 1.037               & 226.4              & 14.74              & 0.1190             \\
                                  & \ourmethod-1    & \textbf{0.0497}     & \textbf{21.18}     & \textbf{31.04}     & \textbf{0.9175}              \\
                                  & \ourmethod-2    & 0.0733              & 28.26              & 28.03              & 0.8369              \\ 
                          
            \bottomrule[1.5pt]
        \end{tabular}}
        \caption{\textbf{Raindrop image restoration.}}
        \label{tab:app_raindrop}
    \end{minipage}
    \hspace{0.01\textwidth}
    \begin{minipage}{0.48\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{cccccc}
			\toprule[1.5pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE                   &Method          &LPIPS\textdownarrow  &FID\textdownarrow   &PSNR\textuparrow    & SSIM\textuparrow   \\
            \cmidrule(lr){1-6}
            \multirow{4}{*}{100}   & Posterior      & 0.1694              & 65.79              & \textbf{25.97}     & \textbf{0.7267}    \\
                                   & Euler          & 0.2719              & 68.69              & 24.28              & 0.5686             \\
                                   & \ourmethod-1   & 0.1629              & \textbf{59.12}     & \textbf{25.97}     & 0.7244             \\
                                   & \ourmethod-2   & \textbf{0.1586}     & 64.02              & 25.67              & 0.7126             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{50}   & Posterior       & 0.7713              & 135.7              & 18.19              & 0.2763     \\
                                  & Euler           & 0.8060              & 143.5              & 17.74              & 0.2615              \\
                                  & \ourmethod-1    & 0.1680              & 65.14              & \textbf{26.20}     & \textbf{0.7330}              \\
                                  & \ourmethod-2    & \textbf{0.1615}     & \textbf{64.24}     & 25.61              & 0.7127              \\
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{20}   & Posterior       & 0.9941              & 181.6              & 14.76              & 0.1821    \\
                                  & Euler           & 1.006               & 188.3              & 14.61              & 0.1781             \\
                                  & \ourmethod-1    & 0.1872              & 71.31              & \textbf{26.68}     & \textbf{0.7494}             \\
                                  & \ourmethod-2    & \textbf{0.1695}     & \textbf{64.90}     & 25.46              & 0.7098             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{10}   & Posterior       & 1.057               & 202.6              & 13.59              & 0.1550     \\
                                  & Euler           & 1.063               & 207.0              & 13.51              & 0.1529             \\
                                  & \ourmethod-1    & 0.2043              & 79.28              & \textbf{27.13}     & \textbf{0.7628}              \\
                                  & \ourmethod-2    & \textbf{0.1853}     & \textbf{70.19}     & 25.09              & 0.6984              \\  
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{5}   & Posterior        & 1.087               & 213.5              & 13.00              & 0.1419     \\
                                  & Euler           & 1.091               & 218.6              & 12.96              & 0.1408             \\
                                  & \ourmethod-1    & \textbf{0.2046}     & 80.45              & \textbf{27.51}     & \textbf{0.7743}              \\
                                  & \ourmethod-2    & 0.3178              & \textbf{73.93}     & 24.32              & 0.5485              \\ 
                          
            \bottomrule[1.5pt]
        \end{tabular}}
        \caption{\textbf{Noisy image restoration.}}
        \label{tab:app_noisy}
    \end{minipage}
\end{table}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% fourth row %%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[h]
    \centering
    \begin{minipage}{0.48\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{cccccc}
			\toprule[1.5pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE                   &Method          &LPIPS\textdownarrow  &FID\textdownarrow   &PSNR\textuparrow    & SSIM\textuparrow   \\
            \cmidrule(lr){1-6}
            \multirow{4}{*}{100}   & Posterior      & {0.0796}            & {34.70}            & \textbf{23.84}     & \textbf{0.8496}    \\
                                   & Euler          & 0.1014              & 37.46              & 23.27              & 0.8027             \\
                                   & \ourmethod-1   & \textbf{0.0774}     & 32.91              & 23.80              & 0.8451             \\
                                   & \ourmethod-2   & 0.0789              & \textbf{32.91}     & 23.59              & 0.8394             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{50}   & Posterior       & {0.6572}            & {151.3}            & {9.490}            & {0.2746}     \\
                                  & Euler           & 0.7517              & 176.7              & 9.402              & 0.2340              \\
                                  & \ourmethod-1    & \textbf{0.0784}     & 34.45              & 23.51              & \textbf{0.8476}              \\
                                  & \ourmethod-2    & 0.0786              & \textbf{32.85}     & \textbf{23.52}     & 0.8382              \\
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{20}   & Posterior       & {1.288}             & {390.1}            & {8.211}            & {0.0648}    \\
                                  & Euler           & 1.297               & 396.8              & 8.212              & 0.0625             \\
                                  & \ourmethod-1    & \textbf{0.0791}     & 35.28              & \textbf{24.22}     & \textbf{0.8586}             \\
                                  & \ourmethod-2    & 0.0792              & \textbf{32.80}     & 23.63              & 0.8399             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{10}   & Posterior       & {1.351}             & {432.2}            & {8.130}            & {0.0476}     \\
                                  & Euler           & 1.354               & 424.2              & 8.136              & 0.0467             \\
                                  & \ourmethod-1    & \textbf{0.0831}     & 41.10              & \textbf{24.04}     & \textbf{0.8619}              \\
                                  & \ourmethod-2    & 0.0841              & \textbf{36.53}     & 23.22              & 0.8398              \\  
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{5}   & Posterior        & {1.371}             & {453.0}            & {8.114}            & {0.0408}     \\
                                  & Euler           & 1.372               & 447.2              & 8.118              & 0.0405             \\
                                  & \ourmethod-1    & 0.0860              & 41.81              & 24.02              & \textbf{0.8676}              \\
                                  & \ourmethod-2    & \textbf{0.0782}     & \textbf{33.98}     & \textbf{24.13}     & 0.8507              \\ 
                          
            \bottomrule[1.5pt]
        \end{tabular}}
        \caption{\textbf{Low-light image restoration.}}
        \label{tab:app_lowlight}
    \end{minipage}
    \hspace{0.01\textwidth}
    \begin{minipage}{0.48\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{cccccc}
			\toprule[1.5pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE                   &Method          &LPIPS\textdownarrow  &FID\textdownarrow   &PSNR\textuparrow    & SSIM\textuparrow   \\
            \cmidrule(lr){1-6}
            \multirow{4}{*}{100}   & Posterior      & 0.1702            &{45.77}               & {25.78}            & \textbf{0.7380}    \\
                                   & Euler          & 0.2949              & 56.99              & 23.84              & 0.5398             \\
                                   & \ourmethod-1   & 0.1636              & \textbf{43.67}     & \textbf{25.81}     & {0.7362}             \\
                                   & \ourmethod-2   & \textbf{0.1555}     & 44.58              & 25.46              & 0.7220             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{50}   & Posterior       & {0.6494}            & {103.7}            & {19.34}            & {0.2908}     \\
                                  & Euler           & 0.7035              & 113.7              & 18.62              & 0.2659              \\
                                  & \ourmethod-1    & 0.1734              & 47.09              & \textbf{26.06}     & \textbf{0.7470}              \\
                                  & \ourmethod-2    & \textbf{0.1567}     & \textbf{45.56}     & 25.41              & 0.7224              \\
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{20}   & Posterior       & {0.8252}            & {140.6}            & {16.44}            & {0.1988}    \\
                                  & Euler           & 0.8477              & 144.5              & 16.19              & 0.1921             \\
                                  & \ourmethod-1    & 0.1993              & 51.43              & \textbf{26.58}     & \textbf{0.7649}             \\
                                  & \ourmethod-2    & \textbf{0.1675}     & \textbf{47.36}     & 25.33              & 0.7235             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{10}   & Posterior       & {0.8723}            & {158.9}            & {15.49}            & {0.1738}     \\
                                  & Euler           & 0.8859              & 159.9              & 15.34              & 0.1701             \\
                                  & \ourmethod-1    & 0.2183              & 57.83              & \textbf{26.98}     & \textbf{0.7771}              \\
                                  & \ourmethod-2    & \textbf{0.1871}     & \textbf{51.25}     & 25.08              & 0.7197              \\  
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{5}   & Posterior       & {0.8941}             & {163.6}            & {14.99}            & {0.1615}     \\
                                  & Euler           & 0.9013              & 162.0              & 14.91              & 0.1596             \\
                                  & \ourmethod-1    & \textbf{0.2281}     & \textbf{59.17}     & \textbf{27.28}     & \textbf{0.7853}              \\
                                  & \ourmethod-2    & 0.3751              & 62.60              & 23.15              & 0.4797              \\ 
                          
            \bottomrule[1.5pt]
        \end{tabular}}
        \caption{\textbf{JPEG image restoration.}}
        \label{tab:app_jpeg}
    \end{minipage}
\end{table}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% fifth row %%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[h]
    \centering
    \begin{minipage}{0.48\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{cccccc}
			\toprule[1.5pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE                   &Method          &LPIPS\textdownarrow  &FID\textdownarrow   &PSNR\textuparrow    & SSIM\textuparrow   \\
            \cmidrule(lr){1-6}
            \multirow{4}{*}{100}   & Posterior      & \textbf{0.0211}     & \textbf{4.755}     & {30.37}            & \textbf{0.9485}    \\
                                   & Euler          & 0.0358              & 6.182              & 29.95              & 0.9319             \\
                                   & \ourmethod-1   & 0.0219              & 4.826              & \textbf{30.42}     & 0.9462             \\
                                   & \ourmethod-2   & 0.0230              & 4.978              & 30.26              & 0.9431             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{50}   & Posterior       & 0.3994              & {35.47}            & {15.34}            & {0.5808}            \\
                                  & Euler           & 0.4745              & 42.70              & 15.16              & 0.5160              \\
                                  & \ourmethod-1    & \textbf{0.0211}     & \textbf{4.737}     & \textbf{30.49}     & \textbf{0.9484}     \\
                                  & \ourmethod-2    & 0.0233              & 4.993              & 30.19              & 0.9427              \\
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{20}   & Posterior       & 0.9911              & {114.0}            & {12.81}            & {0.1832}             \\
                                  & Euler           & 1.012               & 118.5              & 12.71              & 0.1752               \\
                                  & \ourmethod-1    & \textbf{0.0200}     & \textbf{4.682}     & \textbf{30.63}     & \textbf{0.9534}      \\
                                  & \ourmethod-2    & 0.0240              & 5.077              & 30.06              & 0.9409                \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{10}   & Posterior       & 1.116               & {144.0}            & {11.94}            & {0.1261}               \\
                                  & Euler           & 1.128               & 147.3              & 11.87              & 0.1228                 \\
                                  & \ourmethod-1    & \textbf{0.0197}     & \textbf{4.785}     & \textbf{30.80}     & \textbf{0.9579}         \\
                                  & \ourmethod-2    & 0.0246              & 5.228              & 29.65              & 0.9372                  \\  
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{5}   & Posterior        & 1.162               & {159.1}            & {11.47}            & {0.1042}                \\
                                  & Euler           & 1.168               & 161.2              & 11.43              & 0.1026                  \\
                                  & \ourmethod-1    & \textbf{0.0205}     & \textbf{4.926}     & \textbf{30.56}     & \textbf{0.9604}          \\
                                  & \ourmethod-2    & 0.0228              & 5.174              & 29.65              & 0.9416                  \\ 
                          
            \bottomrule[1.5pt]
        \end{tabular}}
        \caption{\textbf{Hazy image restoration.}}
        \label{tab:app_hazy}
    \end{minipage}
    \hspace{0.01\textwidth}
    \begin{minipage}{0.48\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{cccccc}
			\toprule[1.5pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE                   &Method          &LPIPS\textdownarrow  &FID\textdownarrow   &PSNR\textuparrow    & SSIM\textuparrow   \\
            \cmidrule(lr){1-6}
            \multirow{4}{*}{100}   & Posterior      & 0.1249              & \textbf{14.48}     & \textbf{27.48}     & \textbf{0.8442}    \\
                                   & Euler          & 0.1404              & 16.06              & 27.16              & 0.8179             \\
                                   & \ourmethod-1   & \textbf{0.1239}     & 14.61              & 27.46              & 0.8419             \\
                                   & \ourmethod-2   & 0.1248              & 14.61              & 27.30              & 0.8365             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{50}   & Posterior       & 0.5112              & {45.13}            & 24.41              & 0.5571              \\
                                  & Euler           & 0.5739              & 61.21              & 23.79              & 0.4957              \\
                                  & \ourmethod-1    & 0.244               & \textbf{14.47}     & \textbf{27.59}     & \textbf{0.8461}     \\
                                  & \ourmethod-2    & \textbf{0.1251}      & 14.62              & 27.24              & 0.8360              \\
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{20}   & Posterior       & 1.069             & 117.8              & {18.20}             & 0.1717              \\
                                  & Euler           & 1.089              & 120.8              & 17.94               & 0.1637             \\
                                  & \ourmethod-1    & 0.1287             & 14.92              & \textbf{27.85}      & \textbf{0.8544}     \\
                                  & \ourmethod-2    & \textbf{0.1266}    & \textbf{14.82}     & 27.13               & 0.8337             \\
                                   
            \cmidrule(lr){1-6}
            \multirow{4}{*}{10}   & Posterior       & {1.187}            & 141.9     & 16.11               & 0.1136     \\
                                  & Euler           & 1.197              & 143.7              & 15.96               & 0.1104             \\
                                  & \ourmethod-1    & 0.1356             & 15.65              & \textbf{28.10}      & \textbf{0.8613}              \\
                                  & \ourmethod-2    & \textbf{0.1300}    & \textbf{15.51}     & 26.88               & 0.8295              \\  
                                  
            \cmidrule(lr){1-6}
            \multirow{4}{*}{5}   & Posterior        & 1.228             & 155.3     & 15.08               & 0.0922     \\
                                  & Euler           & 1.234             & 157.3              & 15.00               & 0.0907             \\
                                  & \ourmethod-1    & 0.1422            & 16.32              & \textbf{28.31}      & \textbf{0.8668}              \\
                                  & \ourmethod-2    & \textbf{0.1248}   & \textbf{14.20}     & 26.92               & 0.8354              \\ 
                          
            \bottomrule[1.5pt]
        \end{tabular}}
        \caption{\textbf{Motion-blurry image restoration.}}
        \label{tab:app_blurry}
    \end{minipage}
\end{table}

\newpage


\subsection{Details on numerical stability at low NFEs}
\label{appd4}

We have included further details regarding numerical stability at 5 NFEs to complement the experiments presented in Section \ref{section5.3}. As illustrated in Figure \ref{fig:appd4}, when the NFE is relatively low, the convergence rate of noise prediction at each step does not exceed 40\%, which results in sampling collapse. In contrast, during the final 1 or 2 steps, the convergence rate of data prediction approaches nearly 100\%.

\begin{figure*}[ht]
    \centering
    \begin{minipage}[t]{0.35\linewidth}
        \centering
        \includegraphics[width=\linewidth, trim=0 20 20 0]{figs/appendix/appD4_1a.pdf} %trim左下右上
        \subcaption{Sampling results.}
        \label{fig:appd4(a)}
    \end{minipage}
    \begin{minipage}[t]{0.45\linewidth}
        \centering
        \includegraphics[width=\linewidth, trim=0 0 0 0]{figs/appendix/appD4_1b.pdf} %trim左下右上
        \subcaption{Ratio of convergence.}
        \label{fig:appd4(b)}
    \end{minipage}
    \caption{\textbf{Convergence of noise prediction and data prediction at 5 NFEs.} In (a), we choose a stained image for example. The numbers in parentheses indicate the NFE. In (b), we illustrate the ratio of components of neural network output that satisfy the Taylor expansion convergence requirement.}
    \label{fig:appd4}
\end{figure*}


\subsection{Wall clock time}
\label{appd5}

We measured the wall clock time in our experiments on a single NVIDIA A800 GPU. The average wall clock time per image of two representative tasks (low-light and motion-blurry image restoration) are reported in Table \ref{tab:time1} and \ref{tab:time2}.

\begin{table}[ht]
    \centering
    \begin{minipage}{0.45\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \caption{Wall clock time on the Low-light dataset.}
    % \vspace{8pt}
    \resizebox{1\textwidth}{!}{
        \begin{tabular}{ccc}
			\toprule[1.2pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE & Method      & Time(s)\textdownarrow  \\
            \midrule[0.8pt]
            \multirow{2}{*}{100}
             & Posterior Sampling & 17.19\\
             & MR Sampler-2 & 17.83\\
            \cmidrule(lr){1-3}
            \multirow{2}{*}{50}
             & Posterior Sampling & 8.605  \\
             & MR Sampler-2 & 8.439  \\
            \cmidrule(lr){1-3}
            \multirow{2}{*}{20}
              & Posterior Sampling & 3.445  \\
              & MR Sampler-2 & 3.285  \\
            \cmidrule(lr){1-3}
            \multirow{2}{*}{10}
              & Posterior Sampling & 1.727  \\
              & MR Sampler-2 & 1.569  \\
            \cmidrule(lr){1-3}
            \multirow{2}{*}{5}
              & Posterior Sampling & 0.8696  \\
              & MR Sampler-2 & 0.7112  \\       
            \bottomrule[1.2pt]
        \end{tabular}}
        \label{tab:time1}
    \end{minipage}
    \hspace{0.01\textwidth}
    \begin{minipage}{0.45\textwidth}
    \small
    \renewcommand{\arraystretch}{1}
    \centering
    \caption{Wall clock time on the Motion-blurry dataset.}
    % \vspace{8pt}
        \resizebox{1\textwidth}{!}{
        \begin{tabular}{ccc}
			\toprule[1.2pt]
            % \multicolumn{6}{c}{Rainy} \\
            % \cmidrule(lr){1-6}
             NFE & Method      & Time(s)\textdownarrow  \\
            \midrule[0.8pt]
            \multirow{2}{*}{100}
             & Posterior Sampling & 82.04 \\
             & MR Sampler-2 & 81.16 \\
            \cmidrule(lr){1-3}
            \multirow{2}{*}{50}
             & Posterior Sampling & 41.23  \\
             & MR Sampler-2 & 40.18  \\
            \cmidrule(lr){1-3}
            \multirow{2}{*}{20}
              & Posterior Sampling & 16.44  \\
              & MR Sampler-2 & 15.59  \\
            \cmidrule(lr){1-3}
            \multirow{2}{*}{10}
              & Posterior Sampling & 8.212  \\
              & MR Sampler-2 & 7.413  \\
            \cmidrule(lr){1-3}
            \multirow{2}{*}{5}
              & Posterior Sampling & 4.133  \\
              & MR Sampler-2 & 3.294  \\       
            \bottomrule[1.2pt]
        \end{tabular}}
        \label{tab:time2}
    \end{minipage}
\end{table}


\subsection{Presentation of Sampling Results}
\label{appd6}

We present the sampling results for all image restoration tasks in Figure \ref{fig:appd6(a)} and \ref{fig:appd6(b)}. We choose one image for each task.

\begin{figure}[h]
    \centering
    \begin{minipage}[t]{0.95\linewidth}
    \centering
    \includegraphics[width=\linewidth, trim=0 20 0 0]{figs/appendix/appD5_1.pdf} %trim左下右上
    \end{minipage}
    % \vspace{}
    \begin{minipage}[t]{0.95\linewidth}
        \centering
        \includegraphics[width=\linewidth, trim=0 0 0 0]{figs/appendix/appD5_2.pdf} %trim左下右上
    \end{minipage}
    \begin{minipage}[t]{0.95\linewidth}
        \centering
        \includegraphics[width=\linewidth, trim=0 0 0 0]{figs/appendix/appD5_3.pdf} %trim左下右上
    \end{minipage}
    \caption{\textbf{Comparisons between \textit{posterior sampling} and \textit{\ourmethod-SDE-d-2} on snowy, shadowed, rainy, raindrop, noisy and low-light datasets.}}
    \label{fig:appd6(a)}
    % \newpage
\end{figure}

\begin{figure}[h]
    \centering
    \begin{minipage}[b]{0.95\linewidth}
        \centering
        \includegraphics[width=\linewidth, trim=0 0 0 0]{figs/appendix/appD5_4.pdf} %trim左下右上
    \end{minipage}
    \begin{minipage}[t]{0.95\linewidth}
        \centering
        \includegraphics[width=\linewidth, trim=0 0 0 0]{figs/appendix/appD5_5.pdf} %trim左下右上
    \end{minipage}
    \caption{\textbf{Comparisons between \textit{posterior sampling} and textit{\ourmethod-SDE-d-2} on JPEG-compressed, hazy, inpainting and motion-blurry datasets.}}
    \label{fig:appd6(b)}
\end{figure}

\section{Selection of the optimal NFE}
\label{appe}

In practice, sampling quality is expected to degrade as the NFE decreases, which requires us to make a trade-off between sampling quality and efficiency. From the perspective of reverse-time SDE and PF-ODE, the estimation error of the solution plays a critical role in determining the sampling quality. This estimation error is primarily influenced by $h_{max} = \max_{1 \leq i \leq M}\{\lambda_i - \lambda_{i-1}\} = \mathcal{O}(\frac{1}{M})$, where $M$ represents the NFE. During sampling, the noise schedule must be designed in advance, which also determines the $\lambda$ schedule. Since $\lambda_i$ is monotonically increasing, a larger NFE results in a smaller $h_{max}$, thereby reducing the estimation error and improving sampling quality. However, different sampling algorithms exhibit varying convergence rates. Experimental results show that the MR Sampler (our method) can achieve a good score with as few as 5 NFEs, whereas posterior sampling and Euler discretization fail to converge even with 50 NFEs. 

Specifically, we conducted experiments on the snowy dataset with low NFE settings, and the results are presented in Table \ref{tab:opt_nfe}. The sampling quality remains largely stable for NFE values larger than 10, gradually deteriorates when the NFE is below 10, and collapses entirely when NFE is reduced to 2. Based on our experience, we recommend using 10–20 NFEs, which provides a reasonable trade-off between efficiency and performance.

\begin{table}[ht]
    \renewcommand{\arraystretch}{1.2}
    \centering
    \caption{Results of MR Sampler-SDE-2 with data prediction and uniform $\lambda$ on the snowy dataset.}
    \resizebox{\textwidth}{!}{
    \begin{tabular}{cccccccccc}
    \toprule[1.5pt]
    NFE & 100 & 50 & 20 & 10 & 8 & 6 & 5 & 4 & 2 \\
    \midrule[1pt]
    LPIPS\textdownarrow & 0.0626 & 0.0628 & 0.0650 & 0.0698 & 0.0725 & 0.0744 & 0.0628 & 0.1063 & 1.422 \\
    FID\textdownarrow   & 21.47  & 21.85  & 22.34  & 23.92  & 24.81  & 25.60  & 21.95  & 30.18  & 421.1 \\
    PSNR\textuparrow    & 27.18  & 27.08  & 26.89  & 26.49  & 26.61  & 26.40  & 27.06  & 25.38  & 6.753 \\
    SSIM\textuparrow    & 0.8691 & 0.8685 & 0.8645 & 0.8573 & 0.8462 & 0.8407 & 0.8718 & 0.7640 & 0.0311 \\
    \bottomrule[1.5pt]
    \end{tabular}}
    \label{tab:opt_nfe}
\end{table}
