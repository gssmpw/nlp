\begin{algorithm}[t]
\caption{Simplified KV cache during denosing}
\begin{algorithmic}[1]
\State \textbf{Input:} $t_{i}$, foreground $z^{fg}_{t_{i}}$, $M$-layer block $\{ l_j \}_{j=1}^{M}$, KV cache $C$
\State \textbf{Output:} Prediction vector $V^{fg}_{\theta t_{i}}$
\For{$j = 0$ \textbf{to} $M$}
    \State $Q^{fg}, K^{fg}, V^{fg} = W_Q(z^{fg}_{t_{i}}), W_K(z^{fg}_{t_{i}}), W_V(z^{fg}_{t_{i}})$
    \State $K^{bg}_{ij}, V^{bg}_{ij} = C_K[i, j], C_V[i, j]$
    \State $K, V = \text{Concat}(K^{bg}_{ij}, K^{fg}),\text{Concat}(V^{bg}_{ij}, V^{fg})$
    \State $z^{fg}_{t_{i}} = z^{fg}_{t_{i}} + \text{Attn}(Q^{fg}, K, V)$
\EndFor
\State $V^{fg}_{\theta t_{i}} = \text{MLP}(z^{fg}_{t_{i}}, t_{i})$
\State \textbf{Return} $V^{fg}_{\theta t_{i}}$
\end{algorithmic}
\label{algorithm:algorithm2}
\end{algorithm}
