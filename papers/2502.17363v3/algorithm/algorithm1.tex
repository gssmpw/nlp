\begin{algorithm}[t]
\caption{Simplified KV cache during inversion}
\begin{algorithmic}[1]
\State \textbf{Input:} $t_{i}$, image $x_{t_{i}}$, $M$-layer block $\{ l_j \}_{j=1}^{M}$, foreground region $mask$, KV cache $C$
\State \textbf{Output:} Prediction vector $V_{\theta t_{i}}$, KV cache $C$
\For{$j = 0$ \textbf{to} $M$}
    \State $Q, K, V = W_Q(x_{t_{i}}), W_K(x_{t_{i}}), W_V(x_{t_{i}})$
    \State $K^{bg}_{ij}, V^{bg}_{ij} = K[1-mask>0], V[1-mask>0]$
    \State $C \gets \text{Append}(K^{bg}_{ij}, V^{bg}_{ij})$
    \State $x_{t_{i}} = x_{t_{i}} + \text{Attn}(Q, K, V)$
\EndFor
\State $V_{\theta t_{i}} = \text{MLP}(x_{t_{i}}, t_{i})$
\State \textbf{Return} $V_{\theta t_{i}}$, $C$
\end{algorithmic}
\label{algorithm:algorithm1}
\end{algorithm}
