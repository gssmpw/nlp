\begin{algorithm}[tp]
\caption{$\ChunkKR((x\ind{i},a\ind{i}_{1:H})_{i=1}^n, K,L, \epsilon)$}\label{alg:chunkkr}
\begin{algorithmic}[1]
\State \textbf{input:} Samples $(x\ind{i},a_{1:H}\ind{i})_{i=1}^n$, chunk size $K$, norm bound $L$, desired excess error $\epsilon$.
\State \multiline{Set $B \gets (L^2H^22^{3H+2}e^{2L^2+1}/\epsilon)^{C_{\ref{thm:kernel-apx}}L^2H}$, $\gamma \gets e^{-2L^2H-1}2^{-H}$, $\epapx \gets e^{-3L^2H-2}2^{-3H/2}\epsilon/H$, \\and $\epopt \gets \epsilon/H$.}
\For{$h \in \{K, 2K, 3K, \dots, H\}$} 
    \State Define $\pihat_{h+1-K:h}: \MX \times \MA^{h-K} \to \Delta(\MA^K)$ by
    \[\pihat_{h+1-K:h} \gets \KernRho((x\ind{i,h},a\ind{i}_{h+1-K:h})_{i=1}^n, B, \gamma, \epapx,\epopt),\]
    where $x\ind{i,h} := (x\ind{i}, a\ind{i}_{1:h-K}).$
    \Comment{See \cref{alg:kernrho} for the description of $\KernRho$.}
    \For{$j \in \{h+1-K,\dots,h\}$}
        \State Define $\pihat_j: \MX\times\MA^{j-1} \to \MA$ by
        \[\pihat_j(a_j\mid{}x,a_{1:j-1}) := \frac{\sum_{a'_{j+1:h} \in \MA^{h-j}} \pihat_{h+1-K:h}(a_{h+1-K:j},a'_{j+1:h})\mid{}x,a_{1:h-K})}{\sum_{a'_{j:h} \in \MA^{h+1-j}} \pihat_{h+1-K:h}(a_{h+1-K:j-1},a'_{j:h})\mid{}x,a_{1:h-K})}.\]
    \EndFor
\EndFor
\State \textbf{return:} policy $\pihat = (\pihat_j)_{j=1}^H$.
\end{algorithmic}
\end{algorithm}
