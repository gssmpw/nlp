% \begin{figure*}[t]
% \centering
% \includegraphics[width=1.0\textwidth]{figures/WhatELSE.pdf}
% \vspace{-10pt}
% \caption{An overview of the system.}
% ~\label{overview}
% \vspace{-10pt}
% \end{figure*}

In this section, we present the interface and features of {\sc WhatELSE}, describe its technical pipeline to facilitate the transformation between narrative instances and narrative outlines, and demonstrate its workflow with an example user story.

\subsection{Narrative Space Editor Interface}

{\sc WhatELSE} system assists the user in creating a narrative space. The user can upload narrative examples in text file(s). \presentation{In addition, the user uses a sentence to describe a story's moral (e.g., {\it ``kindness is never wasted''}). The system uses the story input to construct an initial version of the narrative space. The user can edit this narrative space using the interface.}
%\subsubsection{Three Views of the Narrative Space} \label{views}
 {\sc WhatELSE} features three views for the user to perceive the narrative space: \textbf{Pivot View}, \textbf{Outline View}, and \textbf{Variants View} (Figure~\ref{overview}). 
 %Figure. \ref{overview} illustrated how each view is presented on panels in the narrative space editor. 

\noindent \presentation{
\textbf{Pivot View}\hspace{1mm} The pivot view shows a pivot narrative instance. A {\em pivot (narrative instance)} is a user-defined narrative instance, considered as a representative instance in the narrative space. By default, the user's input is automatically marked as the pivot. The pivot serves as a point of reference as the user edits the narrative space.}

\noindent\textbf{Outline View} \presentation{An {\em outline} is an abstract specification of a sequence of events defining the narrative space. }\originality{Similarly to ``loglines'' \cite{mirowski2023co}, it specifically describes the general structure of the narrative with a sequence of high-level events }\presentation{ - e.g., {\it ``A small creature runs into an accident. It was then saved by another creature''}.} The outline describes the narrative space from a broader perspective by capturing the commonality across all the narrative instances in the narrative space. It represents the most abstract manifestation of the author's narrative intent, thus defining the boundary of the narrative space.

\noindent\textbf{Variants View}\hspace{1mm} A {\em variant (narrative instance)} is a narrative instance residing in the current narrative space. A variant instantiates the outline with a sequence of concrete events - e.g., {\it "An ant fell into water. A dove dropped a leaf next to the ant. The ant climbed on the leaf. The ant was saved."} Each abstract event in the outline is expanded to multiple concrete events in a variant. 


The variants are displayed in an interactive scatter plot along two dimensions to help users understand the shape of the narrative space: 1) the \textbf{authorial intent} dimension, measured by the distance between the moral expressed by the variant and by the pivot (ranging from 0 to 1)\footnote{This distance is evaluated by prompting the LLM to assess how well the moral is conveyed}, and 2) the \textbf{emergence} dimension, measured by how much the plot progress in the variant deviates from the pivot (ranging from 0 to 1). \originality{These two dimensions are inspired by the ``authorial intent'' dimension in Riedl's taxonomy of IN approaches \cite{riedl2013interactive,riedl2009incorporating}, as well as the notion of ``emergence'' \cite{walsh2011emergent} and ``interactivity'' \cite{stang2019action} from prior IN research.} Users can configure the number of variants to be generated for visualization. Users can click on any variant in the visualization to display its detailed content, allowing them to compare it with the pivot. \presentation{Users can also use a scroll bar to visualize the plot progression} as they develop across different stages, allowing them to perceive how the narrative variants evolve over time and deviate from the pivot.

%In practice, users generate this scatter plot by clicking on the \textit{Generate Variants} button, as shown Figure. \ref{user_study:interface} C. Additionally, 


%, ranging from 1 to 5 sets. For each set, we generate 3 variants corresponding to the variant plots driven by the three types of players. For example, if a user chooses to visualize 4 sets, a total of 12 variants—categorized by player type—will be displayed on the scatter plot as shown in Figure. \ref{user_study:interface}. 


%Variant plots are a sequence of plots that players could experience under this narrative space constrained by the outline. Each variant consists of two parts: the game plot, and the player action. Player actions drive the gradual unfolding of game plots from the narrative space, and connect gameplots as a narrative. In other words, one variant records the full gaming experience of a specific player. Thus, such variation is caused by different game plots and different player actions jointly. For instance, the same game plot describing a character facing danger, can be led by two different player actions "save" and "kill" can lead to two variants; similarly, with the same player action "save", the character to be saved in game plot to be saved will also lead to two variants. 



%which is formatted from the user's input narrative instance, by extracting all events that occurred in the story and arranging the events sequentially as a plot. 
%Specifically, following the principles in defining events in digital games ~\cite{gould2011narrative,castellan2017games},  each event is a combination of "subject + action + object + potential location". 
%The view of the pivot plot shows the backbone of the user's input narrative instance, providing a straightforward structure of the narrative progression. More importantly, the pivot plot lies in the centric position of the narrative space. Narratives unfolded from the narrative space should always refer to this pivot plot. 

% Similar to how "acts" function in drama writing~\cite{styan1960elements},


% Therefore, the outline plot condenses the events in narrative instances into a less specific form compared to the detailed events, such as the pivot plot

These three views provide different perspectives for users to inspect the narrative space. We also provide editing tools at each view to support shaping the narrative space in different ways. 

%and are closely connected to each other. The outline is an abstraction of the pivot plot, and variant plots are generated within boundaries defined by the plot outline. Meanwhile, each variant plot serves as an alternative to the pivot plot. Therefore, the three views employed jointly describe the narrative space. 




\begin{figure*}[t]
\centering
\includegraphics[width=0.99\textwidth]{figures/whatelse_interface_v3.pdf}
\vspace{-10pt}
\caption{\presentation{An illustration of the Narrative Space Editor interface, including the pivot, outline, and variants view. Users can (A) generate outline from pivot or variants with an abstraction ladder to configure the abstraction level. They can (B) fine-tune sentence or word-level abstraction using an abstraction tooltip. They can also (C) generate variants from outline specifying the number of variants in the variants view. They can use (D) narrative progression slider to visualize the variants' dynamic distance from the pivot (star). }}
~\label{overview}
\vspace{-10pt}
\end{figure*}




\subsubsection{Support Editing the Narrative Space} 

\presentation{The system provides editing tools at outline and instance level.}

\noindent\textbf{Outline Editing}\hspace{1mm} \presentation{Users can constrain or relax the boundary of the narrative space by adjusting the outline's level of abstraction.}  The more abstract the outline is, the less constrained the narrative space is. \presentation{For example, {\it ``a small creature got into an accident''} is more abstract than {\it ``the ant fell into water''}, enabling more possible narrative instances to be generated. The former removes the constraint on {\it ``the small creature''} being  {\it ``the ant''}, and the {\it ``accident''} being {\it ``falling into water''}.} A less constrained narrative space allows stronger player agency but follows a looser authorial structure. Outline editing allows the user to tune the narrative space to reach a desired balance between authorial structure and player agency. \presentation{The system provides two tools to support the abstraction editing}.

\begin{itemize}
    \item \textbf{Abstraction Ladder (Figure. \ref{overview}.A)} The abstraction ladder helps the user to shift the global level of abstraction across the events in the outline. Inspired by theories of narrative structure ~\cite{styan1960elements, mckee1997story}, \presentation{this ladder covers a spectrum of abstraction levels (beat, scene, sequence, act, and story level)}. An outline at the beat level is similar to a narrative instance, while an outline at the story level summarizes the plot into a one-line overview. Between the two ends, each level of abstraction is progressively more abstract than the previous level. For instance, a scene-level outline provides detailed descriptions of specific scenes, including characters, actions, objects, etc: \textit{``The kind dove takes a leaf to reach the ant and drags it out of a water bubble.''} An act-level outline offers a highly summarized view of the narrative, focusing on the turning points: \textit{``A character saves their friend from danger.''}
    \item \textbf{Abstraction Tooltip (Figure. \ref{overview}.B)} The abstraction tooltip \presentation{allows the user to adjust the sentence, phrase, or word-level abstraction in a more fine-grained manner.} Practically, when users select a text snippet in their outline plots, the tooltip appears, offering two options: ``More Abstract'' and ``More Concrete''. \presentation{By clicking the button, users receive suggested edits that replace the selected content with a more abstract or more concrete phrase.} While the abstraction ladder provides global control over the entire outline, the tooltip enables more fine-grained adjustments at the word or phrase level. The suggestion of making the selected content more abstract or more concrete is based on the taxonomy in linguistics~\cite{hayes1983cognitive}. For example, {\it ``character-animal-small animal-cat-tabby cat''} constructs a linguistic hierarchy. Given a selected text snippet {\it ``cat''}, requesting a more abstract suggestion would yield its superordinate term {\it ``small animal''} or {\it ``animal''}, while a more concrete suggestion would provide its subordinate {\it ``tabby cat''}. 
\end{itemize}
Once the user is satisfied with the outline, they can click the ``Generate Variants'' button to generate narrative variants in the Variant View. Section \ref{compiler} describes the technical pipeline for generating narrative instances from outline. 

\noindent\textbf{Instance Editing}\hspace{1mm} \presentation{Users can fine-tune the narrative space by editing the instance-level content in Pivot and Variant View. They can select a variant to set or unset it as the pivot. They can also remove a variant from the narrative space or add it back. Finally, they can directly edit the text in the instances. They can click the ``Generate Outline'' button to update the outline based on their edited variants. For example, a user who does not want to include certain player type may choose to remove all variants by that player type and update the outline. Section \ref{compiler} describes different player types in the player proxy model. }

%Editing operation on the instance level allows the user to fine-tune the narrative space. We support the following editing operations on the instances: 1) direct text editing, 2) setting or unsetting as pivot, and 3) removing from or adding back to the narrative space. Once the user has done editing at the narrative instance level, they can click the ``generate outline'' button to synchronize the changes to the narrative space to the outline view. Section \ref{summarizer} describes the technical pipeline for generating outlines from narrative instances. 


%With the three views on the narrative space, we provide users with an intuitive way to perceive the narrative space. We then provide a series of tools as follows targeting \textbf{DG2}, to help users effectively shape the narrative space by configuring the level of abstraction. 





%Our first tool helps users obtain an ideal outline plot based on narrative instances. 
%Specifically, users can initiate the abstraction process by clicking the \textit{Generate Outline} button (i.e., Figure. \ref{user_study:interface} A). To enable customization of this abstraction process, we offer a feature named the "abstraction ladder." The abstraction ladder provides users with options of abstraction levels that they can choose from to generate the outline.



%To implement the abstraction ladder, we designed a prompt pipeline to help users ini outlines based on the defined abstraction levels. The pipeline uses professional drama writing knowledge as prior, and generates outlines via summarizing the commonalities among narrative instances. We present the detailed design of the prompt pipeline in the later Section ~\ref{sec:technical_pipeline}.


% We first provide knowledge of defined levels of abstraction referring to professional drama writing literature in the prompt. We then implemented a prompt chain, structured as a tree of thought. This chain operates in three stages: (1) Given the pivot plot, the first part of the chain prompts the LLM to generate a series of variations of the plot by creatively rearranging the elements involved. (2) The second stage generates three outlines corresponding to the predefined abstraction levels: scene, sequence, and act level. (3) In the final stage, the outline is tailored according to the user's specific requirements.



%\noindent\textbf{Variants-driven Editing} In addition to visualizing the variant plots, we designed tools to help users edit the narrative space by selecting among plot variants.  Additionally, users can refine the set of variants by removing selected variants from the set. For example, users may reject all narrative paths driven by negative players if they are unsatisfied with the narrative direction in the variants. Once users are satisfied with the remaining variants, they can use the \textit{Generate Outline} button to generate an outline based on the variants by summarizing their commonalities. Similarly, users can also use the abstraction ladder and customize the outline generation based on their specific needs.


%Overall, we provide a suite of tools that users can utilize to continuously shape the narrative space by editing across three intuitive representations. Specifically, we leverage the concept of abstraction to allow users to set appropriate boundaries within the narrative space, offering flexibility and control over how the narrative evolves and adapts to player actions.


\subsection{Technical Pipeline}

% \zl{todo, review 4.2}

\label{sec:technical_pipeline}
This section describes our technical pipeline supporting the features described in the above section, focusing on the transformation between narrative outline and narrative instances. Specifically, we employ the GPT-4o ~\cite{openai2023chatgpt} for the implementation of our system.


%To support the features we stated above, we design the technical pipeline of \textsc{WhatELSE} focusing on leveraging LLMs to facilitate two key processes: transforming narrative instances into outlines through a prompt pipeline, and converting outlines back into narrative instances using LLM-based narrative planning. We introduce the design and implementation of these two processes in the pipeline with the following two sections.


\subsubsection{Transforming Narrative Instances to Outline} \label{summarizer}
We use an LLM prompting pipeline to generate outlines from narrative instances (Figure \ref{system_overview}.1). This pipeline first prompts the LLM with domain knowledge in drama writing, providing the context of the story domain and the narrative instances. The pipeline then prompts the LLM to summarize the commonalities across these narrative instances, generating outlines at different abstraction levels based on story structure principles \cite{mckee1997story}. Finally, the system selects an outline according to the user's chosen level of abstraction.

\subsubsection{Transforming Outline to Narrative Instances} \label{compiler}

% \presentation{[delete me later: QZ revision for better readability, better structure the text for R1 R3]}
\presentation{To generate meaningful events that can react to player actions (DG3), we go beyond text generation and integrate an LLM-based narrative planning approach with character simulation and player proxy models. Our method extends \textit{StoryVerse} \cite{wang2024storyverse} with player interactivity and behavior modeling.}
 \presentation{Generating narrative instances from outline is essentially simulating an interactive story generation process, where player actions may be generated by computational proxies of players, and the story generated grounded in the causal changes of game world states in accordance with the game mechanism.} 
%To ground the outline with the concrete plot in order to enable a better understanding of the narrative space (DG1), and generate meaningful events that react to player actions (DG3), we go beyond text generation and develop a novel LLM-based narrative planning approach \revision{with character simulation and player proxy models} (Figure.\ref{system_overview}.2).


\begin{figure*}[t]
\centering
\includegraphics[width=\textwidth]{figures/system_overview.png}
\vspace{-10pt}
\caption{\presentation{An overview of the technical pipeline of \textsc{WhatELSE}. (1) The system transforms narrative instances to an outline using the LLM to summarize their commonalities, generate outlines at different levels of abstraction, and review the outline based on user specifications in the Abstraction Ladder. (2) The Interactive Narrative Compiler unfolds the outline into (3) a sequence of character actions to act out the events in the outline. (4) The Game Environment executes the actions and
updates the world states. (5) The player (or a simulated player) can interfere with the game by changing the world states. Finally, the Game Environment sends the updated world states and outline back to the compiler for the next iteration. }}
~\label{system_overview}
\vspace{-10pt}
\end{figure*}

To explain this process, we assume a {\em Game Environment} \presentation{(Figure~\ref{system_overview}.4) is given, which contains the {\em Story Domain} and maintains the {\em World State}.} The {\em World State} consists of a collection of variables that hold relevant values for the game mechanics, such as the characters’ attributes (e.g., health points), current locations, and relationship scores, as well as their memories from the simulation. \presentation{ The {\em Story Domain} contains a set of characters, locations, and an action schema that specifies executable actions in the game system. These actions are implemented as executable function calls that modify the variables of {\em World State} accordingly. For example, executing the action $\texttt{kill(X)}$ will result in character $\texttt{X}$'s state to become dead. }

\presentation{The main game loop starts by sending an event from the outline to the Interactive Narrative Compiler (Figure~\ref{system_overview}.2) to instantiate a sequence of character actions (Figure~\ref{system_overview}.3). The Game Environment (Figure~\ref{system_overview}.4) executes the actions and updates the world states resulting from the generated character actions. Once the Game Environment executes the actions, the player (or a simulated player) can interfere with the game by changing the world states, such as saving a character (Figure~\ref{system_overview}.5). Finally, the Game Environment sends the updated world states and outline back to IN Compiler for the next iteration.} The process loops over the events in the outline plot, and stops when it exhausts all the events.

%The main game loop alternates between 3 modes: 1) plot orchestration mode, 2) player action mode, and 3) character simulation mode. The process loops over the events in the outline plot, and stops when it exhausts all the events.

\vspace{2mm} \presentation{\noindent \textbf{Plot Generator} \hspace{2mm} Given an event in the outline, the system generates a sequence of character actions that act out the event. It takes into account the current game world state as a result of all previous plot executions and player actions. }
%\noindent \textbf{Plot Orchestration Mode} \hspace{2mm} Given an event in the outline, we generate a sequence of character actions that acts out the event\revision{, taking into account the current game world state as a result of all previous plot execution and character/player interactions}. 
%\begin{enumerate}
%    \item \textbf{Generation} \hspace{1mm} An LLM is prompted to generate a sequence of character actions that acts out the event. The prompt includes the following information from the game environment:
%\begin{itemize}
%   \item the list of characters and their descriptions;
%   \item the action schema;
%   \item current world state (including character's memory).
%\end{itemize}
An LLM is prompted to generate a sequence of character actions that act out the event. The prompt includes the following information from the game environment:
\begin{itemize}
   \item the list of characters and their descriptions;
   \item the action schema;
   \item current world state (including character's memory).
\end{itemize}

\presentation{This process is very similar to narrative planning which generates a sequence of state transitions that leads to a narrative goal. Compared to classic symbolic narrative planning, our narrative goal may be fuzzier - sometimes it may not be rigidly characterizable by world states. For example, the narrative goal could be {\it ``everyone likes Bob''}, which corresponds to world states semantically in a fuzzy way. This narrative goal can also be any arbitrary statements describing the desired outcome, constraining not only the endings but also the transitions, for example, {\it``someone was careless and got into an accident''}. Therefore, we use an LLM-based method instead of existing symbolic narrative planning methods for transforming outlines into concrete plots.}


\vspace{2mm} \presentation{\noindent \textbf{Plot Reviewer}} \hspace{2mm} \presentation{Similar to symbolic planning problems,  the plot generation requires causal soundness. This means the character actions must be valid state transitions according to the game's causal rules. We thus adopt an LLM-based planning method following the LLM-Modulo framework \cite{kambhampati2024llms}, with a game environment simulating plans generated by LLMs and providing external critiques.}
To review the generated plan, an LLM is prompted to provide feedback regarding the quality and feasibility of the action sequence to improve it:
    \begin{itemize}
    \item \textbf{Overall Coherency Evaluation} Feedback is obtained by prompting an LLM to comment on the overall coherency of the generated plot and make suggestions for improvement.
    \item \textbf{Character Simulation Evaluation} For every action in the sequence, we prompt an LLM to play the role of the subject of the action. Given the current world state including the character’s memory, we ask the LLM if the motivation for the character to perform the action has been established. We include the explanation to this question in the feedback if the motivation has not been established.
    \end{itemize}
    In addition, we leverage a simulated Game Environment for external evaluation. The system evaluates the \textbf{Causal soundness} of the generated action sequence and reports the observations on the success/failure of the execution. The combined feedback is added to the prompt for the next round of generation.

\vspace{2mm} \presentation{For example, the event {\it ``a small creature gets into an accident''} could be turned into a sequence of character actions shown in Figure~\ref{system_overview}.3. Note that the events in the outline plot are at a higher abstraction level. This means the same event can be transformed into multiple character action sequences, leaving room for the exact plot to adapt to different world states \footnote{In the above example, if the dove is dead at the time of plot execution, then a different character action sequence will be generated - one possibility is that the ant fell into the water.}.
Once the final sequence of character actions is generated, it will be executed by the {\em Game Environment} to update the world state. }

\presentation{The Plot Generator and Reviewer create a sequence of character actions to act out the event. In between these events, the player or NPCs take free actions. These actions are driven by the LLM.
The player actions are determined \presentation{either by a real player's input or a simulated Player Proxy Model (Figure~\ref{system_overview}.5)}. }

\vspace{2mm}\noindent \presentation{\textbf{Player Proxy Model}} \hspace{2mm} %In this mode, the player is prompted to input one or more actions following the action schema. The system execute each of the actions to update the world state if the action is executable with the current world state.
When generating narrative variants, player actions are provided by an LLM-based player proxy model which operates based on player behavior classification derived from previous studies in digital games ~\cite{yannakakis2013player,worth2015dimensions}. Our player simulation incorporates three key player behavior models:

\begin{itemize}
    \item \textbf{Positive Players} in digital games contribute positively by following the intended game objectives and exhibit helping behaviors~\cite{velez2013helping,bostan2009player}.
    \item \textbf{Negative Players} are the killers identified in classic player modeling~\cite{majors2021some,hamari2014player}. They often exhibit aggressive behavior that disrupts the experience of others, particularly when they seek to dominate or harm others destructively.
    \item \textbf{Role Players} prioritize narrative immersion and character development by mimicking the actions their character would take in the gaming world~\cite{praetorius2020avatars}.    
\end{itemize}

Using these player models, we simulate a potential plot that could emerge from the interaction between game characters and simulated players within the narrative space defined by the outline. In this way, the system generates a diverse set of narrative instances in the variants view.

\vspace{2mm} \noindent \presentation{\textbf{Non-Player Character Simulation}} \hspace{2mm} 
An LLM is prompted to role-play as each of the NPCs and generate an action for this character. The prompt includes the following information:
\begin{itemize}
   \item the action schema;
   \item the list of characters and their descriptions;
   \item current world state (including character's memory);
\end{itemize}
Note that the character actions are not directly determined by the outline. However, it is affected by the current world state and, therefore, indirectly influenced by the executed events in the outline.

\vspace{2mm}
\presentation{Using this pipeline, \textsc{WhatELSE} creates a gameplay experience by unfolding the outline into narrative instances. The system generates the game plot for each event in the outline as a series of character actions. The player then inputs actions within the action schema, which influence the progression of the subsequent plot. The system runs executable actions to update the world state. After each round of player action, the system unfolds the next events until exhausting all the events in the outline, in this way, creating an interactive narrative experience. }

\input{sections/exampleWorkflow}




