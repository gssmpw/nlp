\begin{figure*}[htbp]
  \centering
   \centering
      % --- Subfigure 1: Distance Thrown ---  
  \begin{subfigure}[b]{0.15\textwidth}
  \begin{minipage}[c]{\textwidth}
            \vspace{-3cm}  % Adjust this value if needed
            \caption{Error metrics.}
            \label{fig:sysid_comparison_quantitative}
        \end{minipage}%
  \end{subfigure}
  \begin{subfigure}[b]{0.25\textwidth}
    \centering
    \begin{tikzpicture}
      \begin{axis}[
        ybar,
         bar width=0.4cm,
         bar shift=0.0cm,
        width=\textwidth,
        height=4cm,
        ymin=0,
        ymax=0.015,
        symbolic x coords={Default,CEM,Actuator Net,UAN (ours)},
        xtick=\empty,
        xticklabel=\empty,         % hide x-axis labels
        title={Square \& Sine Waves $\downarrow$},
        ylabel={MSE ($\SI{}{\radian ^2}$)},
        ylabel style={font=\small},  % decrease the font size here
        enlarge x limits=0.2,       % extra space left/right
        clip=true,                 % allow drawing outside the box
        grid=major,
        scaled y ticks = false,
        yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=3},
      ]
        \addplot+[ybar, fill=IdealColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(Default,0.0021) +- (0,0.0002)};
        \addplot+[ybar, fill=CEMColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(CEM,0.0010) +- (0,0.0001)};
        \addplot+[ybar, fill=ActuatorNetColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(Actuator Net,0.0180) +- (0,0.0006)};
        \addplot+[ybar, fill=UANColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(UAN (ours),0.0003) +- (0,0.0001)};
      \end{axis}
    \end{tikzpicture}
  \end{subfigure}
  \hfill
  % --- Subfigure 2: Throw Release Speed ---
  \begin{subfigure}[b]{0.25\textwidth}
    \centering
    \begin{tikzpicture}
      \begin{axis}[
        ybar,
         bar width=0.4cm,
         bar shift=0.0cm,
        width=\textwidth,
        height=4cm,
        ymin=0,
        ymax=0.015,
        symbolic x coords={Default,CEM,Actuator Net,UAN (ours)},
        xtick=\empty,
        xticklabel=\empty,
        title={Gaussian Noise $\downarrow$},
        enlarge x limits=0.2,
        clip=true,
        grid=major,
        scaled y ticks = false,
        yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=3},
      ]
        \addplot+[ybar, fill=IdealColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(Default,0.0118) +- (0,0.0004)};
        \addplot+[ybar, fill=CEMColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(CEM,0.0028) +- (0,0.0002)};
        \addplot+[ybar, fill=ActuatorNetColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(Actuator Net,0.1252) +- (0,0.0013)};
        \addplot+[ybar, fill=UANColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(UAN (ours),0.0003) +- (0,0.0001)};
      \end{axis}
    \end{tikzpicture}
  \end{subfigure}
  \hfill
  % --- Subfigure 3: Peak Leg Power ---
  \begin{subfigure}[b]{0.25\textwidth}
    \centering
    \begin{tikzpicture}
      \begin{axis}[
        ybar,
         bar width=0.4cm,
         bar shift=0.0cm,
        width=\textwidth,
        height=4cm,
        ymin=0,
        ymax=0.015,
        symbolic x coords={Default,CEM,Actuator Net,UAN (ours)},
        xtick=\empty,
        xticklabel=\empty,
        title={Throw $\downarrow$},
        enlarge x limits=0.2,
        clip=true,
        grid=major,
        scaled y ticks = false,
        yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=3},
      ]
        \addplot+[ybar, fill=IdealColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(Default,0.0074) +- (0,0.0004)};
        \addplot+[ybar, fill=CEMColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(CEM,0.0026) +- (0,0.0002)};
        \addplot+[ybar, fill=ActuatorNetColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(Actuator Net,0.0035) +- (0,0.0002)};
        \addplot+[ybar, fill=UANColor, draw=black, 
          error bars/.cd, y dir=both, y explicit,
          error bar style={draw=black, fill=black, line width=1pt}]
          coordinates {(UAN (ours),0.0016) +- (0,0.0002)};
      \end{axis}
    \end{tikzpicture}
  \end{subfigure}

    % \vspace{0.5em}
    
    \rule{0.9\linewidth}{0.2pt}
    
    \vspace{1.5em}
   
    \begin{subfigure}[b]{\textwidth}
        \begin{minipage}[c]{0.15\textwidth}
            \vspace{-\baselineskip}  % Adjust this value if needed
            \caption{Train rollout.}
            \label{fig:sysid_comparison_j3_train}
        \end{minipage}%
        \begin{minipage}[c]{0.85\textwidth}
            \includegraphics[width=\textwidth,trim=0cm 0cm 0cm 0cm,clip]{sysid_comparison_j3_train.pdf}
        \end{minipage}
    \end{subfigure}
    
    \vspace{1em} % Adjust vertical space as needed

    \begin{subfigure}[b]{\textwidth}
        \begin{minipage}[c]{0.15\textwidth}
            \vspace{-\baselineskip}  % Adjust this value if needed
            \caption{Test rollout.}
            \label{fig:sysid_comparison_j3_test}
        \end{minipage}%
        \begin{minipage}[c]{0.85\textwidth}
            \includegraphics[width=\textwidth,trim=0cm 1.2cm 0cm 0cm,clip]{sysid_comparison_j3_test.pdf}
        \end{minipage}
    \end{subfigure}

  % --- Shared Legend ---
  \vspace{1ex}
  \begin{tikzpicture}
    \begin{axis}[
      hide axis,
      scale only axis,
      height=0pt,
      width=0pt,
      legend columns=4,
      legend style={
        draw=none,
        /tikz/every even column/.append style={column sep=1cm},
        legend image code/.code={
           \draw[fill=##1, draw=none] (0cm,-0.1cm) rectangle (0.3cm,0.1cm);
         },
      },
    ]
      \addplot+[ybar, fill=IdealColor] coordinates {(0,0)};
      \addlegendentry{\texttt{Default}}
      \addplot+[ybar, fill=CEMColor] coordinates {(0,0)};
      \addlegendentry{\texttt{CEM}}
      \addplot+[ybar, fill=ActuatorNetColor] coordinates {(0,0)};
      \addlegendentry{\texttt{Actuator Net}}
      \addplot+[ybar, fill=UANColor] coordinates {(0,0)};
      \addlegendentry{\texttt{UAN (ours)}}
    \end{axis}
    \node[anchor=north east, fill=white, draw=white, circle, minimum size=12pt, xshift=5pt, yshift=5pt] at (current bounding box.north east) {};
  \end{tikzpicture}
  
  \caption{\textbf{UAN achieves the tightest real-to-sim fit to the training data, as well as a throw trajectory unseen during training.} We rolled out three real-world joint trajectories: square \& sine waves at each joint, Gaussian noise across all the joints, and a throw. Square waves, sine waves, and gaussian noise were seen during training, while the throw was not. We found that \texttt{Actuator-Net} error remains bounded on the \SI{5}{\second} throw trajectory but diverges when rolling out the \SI{5}{\minute} training trajectories, while the \texttt{UAN} learned to remain accurate across long rollouts through RL training.
  }
  \label{fig:sysid_comparison_metrics}
\end{figure*}
