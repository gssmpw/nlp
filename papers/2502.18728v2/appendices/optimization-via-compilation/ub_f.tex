\subsection{$\mathsf{UB}_f$ for MEU and MMAP}
\label{appendix:ub_f}

$\mathsf{UB}_f$ for MEU is given in Algorithm~\ref{algorithm:ub_f meu}.
For notational simplicity, instead of using the BBIR 
$(\{\varphi \land \gamma_{\pi} : \pi \in \mathcal A\}, A, w)$, 
we will use
the tuple $(\{\varphi, \gamma\}, A, w)$ 
in which $\gamma$ is the formula in which
for all $\pi \in \mathcal A$, $\gamma|_{\pi} = \gamma_{\pi}$. 

We define 
scalar division for $\mathcal S$:
\begin{equation}
  \frac{(a,b)}{r} = \begin{cases}
    \paren{\frac a r , \frac b r} & r \neq 0, \\
    (0, -\infty) & r = 0.
  \end{cases}
\end{equation}
We note that, if utilities are all nonnegative, 
then Lines 3-4 are not needed, and we can instead let the returned value in
Line 5 be $t/\ell$; this follows from 
eliminating the casework done to 
prove Theorem~\ref{appendix:reduction soundness}.
Indeed, in the implementation, this is what happens.

\begin{figure}
  \begin{mdframed}{\footnotesize\begin{algorithmic}[1]
    \Procedure{$bb$}{$(\{\varphi, \gamma\}, A, w), P_{curr}, \ell$}
    \State $t = ub((\{\varphi|_{\ell}, \gamma|_{\ell}\}, A, w),
        (\varphi \land \gamma)|_{\ell} , P_{curr} \cup \{\ell\})$
        \State $x = lb((\{\varphi|_{\ell}, \gamma|_{\ell}\}, A, w),
        \gamma|_{\ell} , P_{curr} \cup \{\ell\})$
        \State $y = ub((\{\varphi|_{\ell}, \gamma|_{\ell}\}, A, w),
        \gamma|_{\ell} , P_{curr} \cup \{\ell\})$
        \State \textbf{return } $\sqcup (t/x_{\Pr}, t/y_{\Pr})$
  \EndProcedure
  \end{algorithmic}}\end{mdframed}
  \caption{$\mathsf{UB_f}$ for MEU.}
  \label{algorithm:ub_f meu}
\end{figure}

The $\mathsf{UB}_f$ for MMAP is omitted as it is known~\citep{huang2006solving} that

\begin{align*}
  \sum_{v \in inst(V)}
  \Pr[\{m \cup v \cup e \models \varphi\} | \{e \models \gamma\}]
  = \frac{\AMC_{\R} (\varphi |_m \land \gamma|_m)}{ \AMC_{\R}(\gamma|_m)}
\end{align*}

where $\AMC_{\R}$ is the algebraic model count taken over the reals.