\begin{figure}
\begin{mdframed}
  {\footnotesize
  \begin{align*}
    \infer[\texttt{s/flip}]
    {
      (\texttt{x = flip} \ \theta, \mathcal{D}) \Downarrow
      \{\sigma \cup [x \mapsto \top] \mapsto \theta \times \mathcal{D}(\sigma)\} \cup
      \{\sigma \cup [x \mapsto \bot] \mapsto (1 - \theta) \times \mathcal{D}(\sigma)\}
    }
    {
      \mathrm{fresh} \; x
    }
  \end{align*}
  \begin{align*}
    \infer[\texttt{s/assn}]
    {
      (\texttt{x = e}, \mathcal{D}) \Downarrow
      \begin{gathered}
      \{\sigma \cup [x \mapsto \top] \mapsto p \times\mathcal{D}(\sigma) \mid e[\sigma] = \top, \sigma \in \dom(\mathcal{D})\}
      \\
      \cup
      \{\sigma \cup [x \mapsto \bot] \mapsto (1-p) \times \mathcal{D}(\sigma) \mid e[\sigma] = \bot, \sigma \in \dom(\mathcal{D})\}
      \end{gathered}
    }
    {
      \mathrm{fresh} \; x
      &
      p = \Pr_{\mathcal D}[\texttt e]
    }
  \end{align*}
  \begin{align*}
    \infer[\texttt{s/seq}]
    {
        (s_1; s_2, \mathcal{D}) \Downarrow \mathcal{D}''
    }
    {
        (s_1, \mathcal{D}) \Downarrow \mathcal{D}'
        & (s_2, \mathcal{D}') \Downarrow \mathcal{D}''
    }
  \end{align*}
  \begin{align*}
    \infer[\texttt{s/if}]
    {
      (\texttt{if e \{s$_1$\} else \{s$_2$\}}, \mathcal{D}) \Downarrow
      \{\sigma \mapsto p \times \mathcal{D}_1(\sigma) +
      (1-p) \times \mathcal{D}_2(\sigma)| \sigma \in \dom(\mathcal{D}_1)\}
    }
    {
      (\texttt s_1, \mathcal{D}) \Downarrow \mathcal{D}_1
      & (\texttt s_2, \mathcal{D}) \Downarrow \mathcal{D}_2
      & \Pr_{\mathcal D}[\texttt e] = p
    }
  \end{align*}
  \begin{align*}
    \infer[\texttt{s/mmap}]
    {
      (\vec{\texttt{m}}\texttt{ = mmap }\vec{\texttt{x}}, \mathcal{D}) \Downarrow
      \{\sigma \cup \sigma_m \mapsto \mathcal{D}(\sigma) \mid \sigma \in \dom(\mathcal{D}) \}
    }
    {
      \vec{A} = MMAP_{\mathcal D}(\vec{\texttt{x}})
      & \sigma_m = \{m_i \mapsto A_i \mid i \in [1,n]\}
    }
  \end{align*}
  \begin{align*}
    \infer[\texttt{s/mmap/with}]
    {
      (\vec{\texttt{m}}\texttt{ = mmap }\vec{\texttt{x}} \ \pineapplcode{ with \{e\}}, \mathcal{D})
      \Downarrow
      \{\sigma \cup \sigma_m \mapsto \mathcal{D}(\sigma) \mid \sigma \in \dom(\mathcal{D}) \}
    }
    {
      \vec{A} = MMAP_{\mathcal D}(\vec{\texttt{x}} \mid e)
      & \sigma_m = \{m_i \mapsto A_i \mid i \in [1,n]\}
    }
  \end{align*}
  \begin{align*}
    \infer[\texttt{p/pr}]
    {
      \texttt{s; Pr(e)}  \Downarrow_P \Pr_{\mathcal D} [\texttt{e}]
    }
    {
      (\texttt s, \eset) \Downarrow \mathcal{D}
    } \;\;
    \qquad
    \infer[\texttt{p/pr/with}]
    {
      \texttt{s; Pr(e$_1$) with \{e$_2$\}} \Downarrow_P \frac{\Pr_{\mathcal{D}}[\texttt e_1 \land \texttt e_2]}{\Pr_{\mathcal{D}}[\texttt e_2]}
    }
    {
    (\texttt s, \eset) \Downarrow \mathcal{D}
    }
  \end{align*}
  }
\end{mdframed}
\caption{Operational semantics for $\pineappl$.
  All variable names in a $\pineappl$ program are assumed unique.
  $x_i$ denotes the $i$-th component of a vector $\vec{x} = (x_1, \cdots, x_n)$.}
\label{fig:pineappl-os}
\end{figure}
