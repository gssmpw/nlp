
\begin{tikzpicture}
    % Image minipage
    \node at (0, 0) {%
        \begin{minipage}{0.9\linewidth}
            \includegraphics[width=\linewidth]{pacs_sources/Images/loopy_for_graph.png}
        \end{minipage}
    };
    % Arrow

    % TikZ diagram minipage
    \node at (10.6, 0) {%
        \begin{minipage}{\linewidth}    
        \resizebox{\linewidth}{!}{
        \begin{tikzpicture}
        
            % Define styles for the nodes
            \tikzstyle{node_style}=[circle,draw,fill=blue!20,minimum size=7pt,inner sep=0pt]
            \tikzstyle{special_style}=[circle,draw,fill=black!50,minimum size=7pt,inner sep=0pt]
            \tikzstyle{highlight_style}=[circle,draw=black,minimum size=7.5pt,inner sep=0pt, outer sep=2pt]
            \tikzstyle{inner_node_style}=[circle,draw,fill=blue!20,minimum size=7pt,inner sep=0pt]
            \tikzstyle{meta_node_style}=[circle,draw,fill=red!20,minimum size=8pt,inner sep=0pt, font = \tiny]

        
            % Create the 4x4 grid of nodes
            \foreach \x in {1,2,3} {
                \foreach \y in {1,2,3,4} {
                    \node[node_style] (N-\x-\y) at (\x,-\y) {}; % Define a node at position (\x, -\y)
                }
            }
        
        
            % Draw horizontal and vertical dashed connections between adjacent nodes
            \foreach \x in {1,2,3} { % Stop at 3 to prevent out-of-bounds connections
                \foreach \y in {1,2,3,4} {
                \ifnum\x<3
                    \draw[] (N-\x-\y) -- (N-\the\numexpr\x+1\relax-\y); % Draw dashed line to the right
                \fi
                }
            }
        
        
            % Add inner circles and connect them to the four circles delimiting their square
            \foreach \x in {0, 1,2,3} {
                \foreach \y in {1,2,3} {
                    \node[inner_node_style] (I-\x-\y) at (\x+0.5,-\y-0.5) {}; % Define a smaller node at the center of each square
                    \ifnum\y<3
                        \draw[] (I-\x-\y) -- ++(0,-0.5); % Draw vertical dashed line downwards
                    \fi
                    \ifnum\y>1
                        \draw[] (I-\x-\y) -- ++(0,0.5); % Draw vertical dashed line upwards
                    \fi
        
                    \ifnum\x>0
                        \draw (I-\x-\y) -- (N-\x-\y);
                        \draw (I-\x-\y) -- (N-\x-\the\numexpr\y+1\relax);
                    \fi
                    % \draw (I-\x-\y) -- (N-\x-\y);
                    \ifnum\x<3
                    \draw (I-\x-\y) -- (N-\the\numexpr\x+1\relax-\y);
                    % \draw (I-\x-\y) -- (N-\x-\the\numexpr\y+1\relax);
                    \draw (I-\x-\y) -- (N-\the\numexpr\x+1\relax-\the\numexpr\y+1\relax);
                    \fi
                }
            }
            %% METANODES
            \foreach \x in {1, 2, 3}{
                \foreach \y in {1,2,3}{
                    \node[meta_node_style] (I-\x-\y) at (\x,-\y-0.5) {};
                    \draw[dashed, dash pattern=on 2pt off 1pt] (I-\x-\y) -- ++(0,-0.39);
                    \draw[dashed, dash pattern=on 2pt off 1pt] (I-\x-\y) -- ++(0,0.39);
                    \draw[dashed, dash pattern=on 2pt off 1pt] (I-\x-\y) -- ++(-0.39,0);
                    \draw[dashed, dash pattern=on 2pt off 1pt] (I-\x-\y) -- ++(0.39,0);
                }
            }
        
            % Add numbers to specific meta nodes
            \node[meta_node_style] at (1,-1.5) {3}; % Number 1 at (0.5, -1.5)
            \node[meta_node_style] at (3,-1.5) {0}; % Number 2 at (1.5, -2.5)
            \node[meta_node_style] at (3,-2.5) {2}; % Number 3 at (2.5, -3.5)
            \node[meta_node_style] at (1,-2.5) {3}; % Number 4 at (3.5, -1.5)


            \node[special_style] at (1,-1) {};
            \node[special_style] at (0.5,-1.5) {};
            \node[special_style] at (1.5,-1.5) {};
            \node[special_style] at (.5,-2.5) {};
            \node[special_style] at (1,-3) {};
            \node[special_style] at (2,-4) {};
            \node[special_style] at (2.5,-2.5) {};
            \node[special_style] at (1.5,-3.5) {};
            \node[special_style] at (2,-2) {};
            \node[special_style] at (3,-2) {};
            \node[special_style] at (3,-4) {};
            \node[special_style] at (3,-3) {};
            \node[special_style] at (3.5,-2.5) {};


        \end{tikzpicture}
        }
        \end{minipage}
    };        
\end{tikzpicture}