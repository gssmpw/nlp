\begin{algorithm}[h]
    \caption{Advanced Prompt Sampling}
    \label{alg:advanced_prompts}
    \begin{algorithmic}
      \Require{Parameter $k$, Candidate set $F=\{f_1,\ldots,f_s\}$, set of control models $C=\{c_1,\ldots,c_m\}$, prompt space $\Omega$, number of prompts $T'$
      }
      \State $Prompts \gets \emptyset$ \Comment{Initialize empty set of prompts}
      \State $H \gets F \cup C$ 
      \Comment{All models} 
        \State $\text{same}[i][j] \gets 0 \text{ for all } i,j \in [|H|]$ \Comment{Counter of times two models produced the same output token}
      \For{$i \gets 1$ to $T'$}
          \State $x_1,\ldots,x_k \stackrel{\text{iid}}{\sim} \Omega$ \Comment{Sample $k$ prompts}
          \State $Score[j] \gets 0 \text{ for all } j \gets 1$ to $k$ \Comment{Scores across $k$ prompts} 
          \For{$j \gets 1$ to $k$} \Comment{Find score for each}
            \State $s \gets 0$
            \For{$l_1 \gets 1$ to $|H|$}
                \For{$l_2 \gets 1$ to $|H|$}
                    \State $old \gets \frac{same[l_1][l_2]}{i-1}$ 
                    \State $new \gets \frac{same[l_1][l_2] + \mathds{1}(h_{l_1}(x_j)=h_{l_2}(x_j))}{i}$
                    \State $weight \gets e^{\tau \cdot (old - new)}$
                    \State $s \mathrel{+}= \mathds{1}(old>new) \cdot weight$
                \EndFor
            \EndFor
            \State $\text{Score}[j] \gets s$
          \EndFor
      \EndFor
      \State $l \gets \argmax_{j} \text{Score}[j]$ \Comment{Find largest score}
      \State $Prompts\gets Prompts \cup \{x_l\}$ \Comment{Add that prompt}
      \State \Return $Prompts$
    \end{algorithmic}
  \end{algorithm}
