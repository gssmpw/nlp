\documentclass{ieeeaccess}
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{textcomp}
\usepackage{listings}
\usepackage{subfig}
\usepackage{braket}
\usepackage{hyperref}
\usepackage{cleveref}
\crefname{figure}{Figure}{Figures}
\crefname{section}{Section}{Sections}
\usepackage[htt]{hyphenat}



\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
  language=Python,
  basicstyle=\ttfamily\small,
  numbers=left,
  numberstyle=\tiny\color{codegray},
  stepnumber=1,
  numbersep=5pt,
  backgroundcolor=\color{white},
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  frame=single,
  rulecolor=\color{black},
  tabsize=2,
  captionpos=b,
  breaklines=true,
  breakatwhitespace=false,
  title=\lstname,
  keywordstyle=\color{blue},
  commentstyle=\color{codegreen},
  stringstyle=\color{red},
  escapeinside={\%*}{*)},
  morekeywords={*,...}
}

\lstset{style=mystyle}

\lstdefinelanguage{qoala}
{
    morekeywords=[1]{
        add, add, sub, addm, subm,
        jmp, bez, bnz, beq, bne, blt, bge,
        set, store, load
        meas,
        create_epr, recv_epr,
        init, meas, h, rot_x, rot_y, rot_z, cnot, cphase, cx_dir, cy_dir,
        APPID, NETQASM,
        run_request, run_routine, return_result, assign
    },
    morekeywords=[2]{
        META_START, META_END,
        SUBROUTINE,
        NETQASM_START, NETQASM_END,
        REQUEST
    },
    keywordstyle=[1]\color{blue},
    keywordstyle=[2]\color{purple},
    sensitive=true,
    morecomment=[l]{//},
    morecomment=[s]{/*}{*/},
    morecomment=[s][\color{blue}]{\#\ }{\ },
    morestring=[b]",
    escapeinside={(*@}{@*)},
}

\lstnewenvironment{qoalacode}{\lstset{style=mystyle,language=qoala}}{}

\newcommand{\revision}[1]{#1}
\newcommand{\todo}[1]{\textcolor{red}{TODO #1}}

\title{Qoala: an Application Execution Environment for Quantum Internet Nodes}

\author{
    Bart van der Vecht\authorrefmark{1,2,3},
    Atak Talay Yücel\authorrefmark{1},
    Hana Jirovská\authorrefmark{1,2,3},
    Stephanie Wehner\authorrefmark{1,2,3}
}
\address[1]{QuTech, Delft University of Technology}
\address[2]{Kavli Institute of Nanoscience, Delft University of Technology}
\address[3]{Quantum Computer Science, Electrical Engineering, Mathematics and Computer Science, Delft University of Technology}

\markboth
{Van der Vecht \headeretal: Qoala}
{Van der Vecht \headeretal: Qoala}

\corresp{Corresponding author: Bart van der Vecht (email: b.vandervecht@tudelft.nl).}

\begin{abstract}
Recently, a first-of-its-kind operating system for programmable quantum network nodes was developed, called QNodeOS.
Here, we present an extension of QNodeOS called Qoala, which introduces
(1) a unified program format for hybrid interactive classical-quantum programs, providing a well-defined target for compilers, and 
(2) a runtime representation of a program that allows joint scheduling of the hybrid classical-quantum program, multitasking, and asynchronous program execution.
Based on concrete design considerations, we put forward the architecture of Qoala, including the program structure and execution mechanism.
We implement Qoala in the form of a modular and extendible simulator that is validated against real-world quantum network hardware (available online).
However, Qoala is not meant to be purely a simulator, and implementation is planned on real hardware.
We evaluate Qoala's effectiveness and performance sensitivity to latencies and network schedules using an extensive simulation study.
Qoala provides a framework that opens the door for future computer science research into quantum network applications, including scheduling algorithms and compilation strategies that can now readily be explored using the framework and tools provided. 
\end{abstract}

\titlepgskip=-15pt

\maketitle

\input{sections/introduction}
\input{sections/related_work}
\input{sections/design_considerations}
\input{sections/architecture}
\input{sections/implementation}
\input{sections/evaluation}
\input{sections/conclusion}

\section{Acknowledgements}
This research was supported by the Quantum Internet Alliance through the European Union's Horizon 2020 program under grant agreement No. 820445 
and from the Horizon Europe program grant agreement No. 101080128.
We furthermore acknowledge support from NWO (including a VICI grant).

We thank 
Przemysław Pawełczak,
Michele Amoretti,
Anabel Ovide,
Thomas Beauchamp,
Álvaro Gomez Iniesta,
Ingmar te Raa,
Diego Rivera and
Francisco Silva
for useful discussions and feedback on (early) drafts.


\section{Data availability}
The implementation of Qoala as a simulator can be found online~\cite{qoala2023simulator}.
The code and data supporting the evaluation can be found at~\cite{evaluation-data}.

\bibliographystyle{unsrt}
\bibliography{qoala-paper}


% \clearpage
\appendices

\onecolumn

\section*{Appendix}
Appendix containing additional information for the paper \textbf{Qoala: an Application Execution Environment for Quantum Internet Nodes}.
This Appendix is structured as follows.
\begin{itemize}
\item \cref{app:program_structure} provides details of the \textbf{Qoala program format}.
\item \cref{app:runtime_environment} provides details of the \textbf{Qoala runtime environment}.
\item In \cref{app:scheduling_execution}, our \textbf{scheduler implementation} (\cref{sec:implementation}) is explained more in-depth.
\item \cref{app:simulator} gives an overview of our \textbf{simulator implementation}.
\item In \cref{app:evaluation} we elaborate on our \textbf{evaluations}.
\end{itemize}


\input{sections/appendix/program_structure}
\clearpage
\input{sections/appendix/runtime_environment}
\clearpage
\input{sections/appendix/scheduler}
\clearpage
\input{sections/appendix/simulator}
\clearpage
\input{sections/appendix/evaluation_details}

\EOD

\end{document}
