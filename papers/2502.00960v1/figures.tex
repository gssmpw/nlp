

\newcommand{\figFront}{
\begin{figure}[t]
\centering
\includegraphics[width=0.95\columnwidth]{figs/Front_v3.png}
\vspace{-0.05in}
\caption{\textbf{Overview of the proposed method.} The initial pseudo-labels tend to be accurate but sparse. Our proposed method aims to enhance the pseudo-labels by utilizing the grouping information of SAM masks.}
\label{fig:front}
\vspace{-0.3in}
\end{figure}
}

\newcommand{\figStructure}{
\begin{figure*}[t]
\centering
\includegraphics[width=0.9\linewidth]{figs/Method_v6.png}
\caption{\textbf{Visual explanation of the proposed method.} The SAM masks are sorted in descending order based on their area. For $M_1$, the pseudo-labels contain two main classes (yellow and green) and violate the purity constraint in Equation \ref{equ:rp}. Thus the mask label is not valid and there is no update to the pseudo-labels. For $M_2$ and $M_{N'}$, MLA generates valid mask labels and we apply GAPP to enhance the pseudo-labels within the mask. Then we update the pseudo-labels $\hat{y}$ and proceed to the next mask.}
\label{fig:structure}
\vspace{-0.2in}
\end{figure*}
}

\newcommand{\figProp}{
\begin{figure*}[t]
\centering
\includegraphics[width=0.93\linewidth]{figs/vis3_v4.png}
\caption{\textbf{Visualization of the proposed GAPP}. Note the green points on the Ground Truth images (rightmost) belong to the background, not the car. The lidar paths of these green points are occluded in the camera image, thus they `appear' to be on the car due to the sensor location mismatch between the lidar and camera. Unlike Direct Propagation (DP), GAPP successfully avoids those incorrect mask labels assigned to the car.}
\label{fig:prop}
\vspace{-0.2in}
\end{figure*}
}

\newcommand{\figVis}{
\begin{figure*}[t]
\centering
\includegraphics[width=\linewidth]{figs/vis4_v3.png}
\caption{Visualization of the SAM masks and enhanced pseudo-labels. The proposed method significantly improves the pseudo-label quality.}
\label{fig:visualization}
\vspace{-0.2in}
\end{figure*}
}

\newcommand{\algo}{
\begin{algorithm}[t]
\caption{Proposed Pseudo-Label Enhancement Method}
\label{alg:algo}
\begin{algorithmic}[1]
\Procedure{PLEnhancement}{$x^{2D}, x^{3D}, \hat{y}$, SAM} 
\State $\{M_j\}_{j=1}^{N'} \gets \text{SAM}(x^{2D})$ \Comment{Get SAM masks}
\State Sort the masks in descending order using area
\For{$j = 1$ to $N'$}
    \State Get $\mathcal{B}_j$ through Equation \ref{equ:getpoints}
    \State Get the dominant class $\tilde{c}$ through Equations \ref{equ:getpoints1}, \ref{equ:getclass}
    \State Get $R_{s}, R_{p}, R_{r}$ using Equation \ref{equ:rsize}, \ref{equ:rp}, \ref{equ:rpoint}
    \If{$R_{size} \leq \lambda_s, R_p \geq \lambda_p, R_r \geq \lambda_r$}
        \State $\hat{y}^M_j \gets \tilde{c}$  \Comment{Assign robust mask label}
        \State Calculate $d_{exp}$ using Equation \ref{equ:dist}
        \State Calculate $\mathcal{B}_{exp}$ using Equation \ref{equ:exp}
        \While{$\mathcal{B}_{exp} \neq \phi$}
            \State Update $\hat{y}$ using Equation \ref{equ:update}
            \State Recalculate $d_{exp}$ using Equation \ref{equ:dist}
            \State Recalculate $\mathcal{B}_{exp}$ using Equation \ref{equ:exp}
        \EndWhile
    \EndIf
\EndFor
\State \Return $\hat{y}$
\EndProcedure
\end{algorithmic}
\end{algorithm}
}

\newcommand{\tableMain}{
\begin{table*}[t]
\small
\centering
\caption{Main adaptation performance of our proposed method on mIoU ($\%$). The best results in UDA and SFDA are marked in bold and the performance improvement in 2D+3D is marked as green. }

\label{table:mainres}
\resizebox{\textwidth}{!}{
\begin{tabular}{cc|ccc|ccc|ccc}
\toprule
& \multirow{2}{*}{Method}   &  \multicolumn{3}{c|}{USA$\rightarrow$Singapore}  & \multicolumn{3}{c|}{A2D2$\rightarrow$SemKITTI}& \multicolumn{3}{c}{Singapore$\rightarrow$SemKITTI}   \\
           &  & {\footnotesize 2D}       & {\footnotesize 3D} & {\footnotesize 2D+3D}      & {\footnotesize 2D}    & {\footnotesize 3D}   & {\footnotesize 2D+3D}    & {\footnotesize 2D}       & {\footnotesize 3D}  & {\footnotesize 2D+3D} \\ \midrule

&  No Adaptation      & 47.27   & 45.47    &   49.13     & 32.8      & 32.59  & 39.49    & 24.69       &  29.71   & 32.49 \\ 
 \midrule
  \multirow{3}{*}{\begin{tabular}{@{}c@{}c@{}} UDA \end{tabular}} & xMUDA      & 56.18    &  50.85   &  58.86   & 41.12      & 44.06   & 46.97    &  33.17    &  34.73  &  37.17 \\
& $\text{xMUDA}_{pl}$     & 59.64  &  51.94  &  63.09   & 44.33      & 47.87   & 49.46    &    34.21   &  38.73  &  40.13 \\ 
& $\text{xMUDA}_{pl}$+ours    & \textbf{61.78} &   \textbf{53.96}   & \textbf{64.53} \rm \textcolor[RGB]{0,155,0}{(+1.44)}  &   \textbf{45.55}      & \textbf{51.21}   & \textbf{51.10}  \rm \textcolor[RGB]{0,155,0}{(+1.64)}       &    \textbf{37.92}   & \textbf{40.29}  &  \textbf{43.72} \rm \textcolor[RGB]{0,155,0}{(+3.59)} \\ \midrule
\multirow{2}{*}{SFDA} & SUMMIT      & 57.00   &  53.79   &  58.35  & 44.79      & 47.72   & 49.88    &      36.28    &  43.64  &   42.47  \\ 
& SUMMIT+ours      & \textbf{57.61}    &  \textbf{54.22}   &  \textbf{58.98} \rm \textcolor[RGB]{0,155,0}{(+0.63)} & \textbf{47.98}     & \textbf{49.64}   & \textbf{53.22} \rm \textcolor[RGB]{0,155,0}{(+3.34)} &     \textbf{41.54}    &  \textbf{45.74}  &  \textbf{47.34} \rm \textcolor[RGB]{0,155,0}{(+4.87)}  \\  \bottomrule

\end{tabular}
}
\vspace{-0.1in}
\end{table*}
}

%\rowcolor{gray!15} 


% \newcommand{\tableLabel}{
% \begin{table*}[t]
%   \centering
%   \caption{Comparison of pseudo-label accuracy (\%) and correct pseudo-label increment (\%) for five classes under the \textbf{A2D2 $\rightarrow$ SemKITTI} scenario. }
% \resizebox{\textwidth}{!}{
%     \begin{tabular}{c|ccc|cccccccccc|cc}
%     \toprule
%     & \multirow{2}{*}{MF} & \multirow{2}{*}{DP}  & \multirow{2}{*}{GAPP}  & \multicolumn{2}{c}{Car}  &  \multicolumn{2}{c}{Truck} &  \multicolumn{2}{c}{Bike}  & \multicolumn{2}{c}{Person} &  \multicolumn{2}{c|}{Other-Objects}  &  &   \\
%     &  & & & Acc. & Inc.  &  Acc. & Inc. &  Acc. & Inc.  & Acc. & Inc. &  Acc. & Inc.  & Avg. Acc. &  Avg. Inc. \\
%     \midrule
%     \multirow{4}{*}{\begin{tabular}{@{}c@{}c@{}} xMUDA-2D \end{tabular}} & - & - & - & 89.77  & -  & 9.52  & -  & 72.20  & -  & 55.82  & -  & 58.46  & \multicolumn{1}{c|}{- } & 57.15 & -    \\  
%     & - & \ding{51} & - & 85.20  & \textbf{48.96}  & 5.49  & \textbf{37.29}  & 48.30  & \textbf{28.95}  & 43.84  & \textbf{51.41}  & 50.93  & \multicolumn{1}{c|}{\textbf{65.90}} & 46.75 & \textbf{46.50}    \\ 
%     & \ding{51} & \ding{51} & - & 86.06  & 38.99  & 7.40  & 30.15  & 61.56  & 22.86  & 53.25  & 43.57  & 55.66  & \multicolumn{1}{c|}{49.85} & 52.79 & 37.09    \\  
%     & \ding{51} & - & \ding{51} & \textbf{86.92}  & 38.84  & \textbf{7.67}  & 29.89  & \textbf{62.93}  & 22.55  & \textbf{54.83}  & 43.36  & \textbf{56.48}  & \multicolumn{1}{c|}{49.17} & \textbf{53.77} & 36.76    \\  
%     \midrule
%     \multirow{4}{*}{\begin{tabular}{@{}c@{}c@{}} xMUDA-3D \end{tabular}} & - & - & - &  96.95  & -  & 40.89  & -  & 87.09  & -  & 17.45  & -  & 51.84  & \multicolumn{1}{c|}{-} & 58.84 & -    \\  
%      & - & \ding{51} & - & 82.17  & \textbf{42.81}  & 26.57  & \textbf{26.96}  & 57.86  & \textbf{23.99}  & 9.39  & \textbf{22.57}  & 37.66  & \multicolumn{1}{c|}{\textbf{43.96}} & 42.73 & \textbf{32.06}    \\ 
%      & \ding{51} & \ding{51} & - & 86.42  & 32.63  & 32.46  & 18.68  & 74.12  & 15.16  & 12.26  & 17.60  & 43.23  & \multicolumn{1}{c|}{25.00 } & 49.70 & 21.81    \\  
%      & - & \ding{51}& \ding{51}& \textbf{94.57}  & 31.09  & \textbf{33.56}  & 17.97  & \textbf{81.63}  & 14.58  & \textbf{14.04}  & 17.23  & \textbf{46.07}  & \multicolumn{1}{c|}{23.81} & \textbf{53.97} & 21.01   \\  
%     \midrule
%     \multirow{4}{*}{\begin{tabular}{@{}c@{}c@{}} SUMMIT \end{tabular}} & - & - & - & 98.79  & -  & 41.11  & -  & 99.50  & -  & 90.25  & -  & 82.04  & \multicolumn{1}{c|}{-} & 82.34 & -   \\  
%     & - & \ding{51}& - & 81.35  & \textbf{161.8}  & 27.04  & \textbf{136.9}  & 77.25  & \textbf{55.00}  & 43.40  & \textbf{106.8}  & 54.92  & \multicolumn{1}{c|}{\textbf{125.8}} & 56.79 & \textbf{117.3}    \\ 
%     &\ding{51} & \ding{51}& - & 84.14  & 126.5  & 34.94  & 101.2  & 83.21  & 43.60  & 60.33  & 89.09  & 64.84 & \multicolumn{1}{c|}{83.10} & 65.49 & 88.71    \\  
%     & - &\ding{51} & \ding{51} & \textbf{95.28} & 121.3  & \textbf{37.44}  & 98.56  & \textbf{96.77}  & 42.15  & \textbf{75.31}  & 87.41  & \textbf{69.06}  & \multicolumn{1}{c|}{79.25} & \textbf{74.77} & 85.73  \\  
%     \bottomrule
%     \end{tabular}%
% }
% % \setlength{\abovecaptionskip}{0.15 cm}
% \end{table*}
% }


\newcommand{\tableLabel}{
\begin{table}[t]
  \centering
  \caption{Comparison of pseudo-label accuracy (\%) and total correct pseudo-label increment (\%) for four classes under \textbf{A2D2 $\rightarrow$ SemKITTI}. }
  \label{table:label}
\resizebox{\linewidth}{!}{
    \begin{tabular}{c|ccc|cccc|cc}
    \toprule
    &  &   &   & \multicolumn{4}{c|}{Pseudo-Label Acc.}  &  &   \\
    & DP & MF in MLA  & GAPP  & Car & Truck &  Bike  & Person & Avg. Acc. &  Total Inc. \\
    \midrule
    \multirow{4}{*}{\begin{tabular}{@{}c@{}c@{}} xMUDA-2D \end{tabular}} & - & - & - & 89.77   & 9.52   & 72.20  & 55.82   & 56.83 & -    \\  
    & \ding{51} & - & - & 85.20  & 5.49  & 48.30  & 43.84    & 45.71 & +48.11\%    \\ 
    & \ding{51} & \ding{51} & - & 86.06  & 7.40  & 61.56  & 53.25   & 52.07 & +38.35\%    \\  
    & - & \ding{51} & \ding{51} & {86.92}  & {7.67} & {62.93}  & {54.83}   & {53.09} & +38.18\%    \\  
    \midrule
    \multirow{4}{*}{\begin{tabular}{@{}c@{}c@{}} xMUDA-3D \end{tabular}} & - & - & - &  96.95  & 40.89  & 87.09   & 17.45    & 60.60 & -    \\  
     & \ding{51} & - & - & 82.17  & 26.57   & 57.86   & 9.39  & 44.00 & +41.98\%    \\ 
     & \ding{51} & \ding{51} & - & 86.42  & 32.46   & 74.12   & 12.26   & 51.32 & +31.90\%    \\  
     & - & \ding{51} & \ding{51}& {94.57}  & {33.56}   & {81.63}  & {14.04}   & {55.95} & +30.39\%   \\  
    \midrule
    \multirow{4}{*}{\begin{tabular}{@{}c@{}c@{}} SUMMIT \end{tabular}} & - & - & - & 98.79  & 41.11  & 99.50   & 90.25    & 82.41 & -   \\  
     & \ding{51} & - & - & 81.35   & 27.04   & 77.25   & 43.40    & 57.26 & +159.5\%    \\ 
    &\ding{51} & \ding{51}& - & 84.14   & 34.94   & 83.21   & 60.33  & 65.66 & +124.6\%    \\  
    & - & \ding{51} & \ding{51} & {95.28}  & {37.44}   & {96.77}  & {75.31}  & {76.20} & +119.5\%  \\  
    \bottomrule
    \end{tabular}%
}
% \setlength{\abovecaptionskip}{0.15 cm}
\end{table}
}

\newcommand{\tableAbl}{
\begin{table}[t]
\small
\centering
\caption{Ablation study of the effect of different components on mIoU ($\%$). Best numbers are marked in bold.}

\label{table:ablation}
\resizebox{\linewidth}{!}{
\begin{tabular}{c|ccc|ccc}
\toprule
Method  & DP & MF in MLA  & GAPP &  2D  & 3D & 2D+3D   \\  \midrule

  \multirow{4}{*}{\begin{tabular}{@{}c@{}c@{}} $\text{xMUDA}_{pl}$ \end{tabular}} &  - & - & - & 44.33    &  47.87   &  49.46  \\
& \ding{51} & - & - & 43.16  &  48.05   & 48.30 \\
& \ding{51} & \ding{51} & - & 45.46  &  50.22   & 50.62 \\
& - & \ding{51} & \ding{51} & \textbf{45.55}  &  \textbf{51.21}   & \textbf{51.10} \\ \midrule
\multirow{4}{*}{SUMMIT} & - & - & - &44.79   &  47.72  & 49.88   \\
& \ding{51} & - & - & 45.94  &  48.72   & 51.14 \\
& \ding{51} & \ding{51} & - & 47.37  &  48.52   & 52.14 \\
& - & \ding{51} & \ding{51} & \textbf{47.98}  &  \textbf{49.64}   & \textbf{53.22} \\ \bottomrule

\end{tabular}
}
\vspace{-0.2in}
\end{table}
}