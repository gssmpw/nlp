\section{Deriving Analytical Bounds}
\label{sec: bounds}
\jl{While the optimisation in \eqref{eq: optimisation} and \eqref{eq: additional assumptions} yields exact bounds, it is very inefficient as the number of constraints grows exponentially with the sizes of the state and action spaces. However, for MDPs, we have proven this linear optimisation problem always reduces to exact closed-form solutions.}
%

\subsection{Analytical Bounds}
Given the observed transition $s_t, a_t \rightarrow s_{t+1}$, the counterfactual probability of any transition $\tilde{s}, \tilde{a} \rightarrow \tilde{s}'$ depends only on whether the state-action pair $(\tilde{s}, \tilde{a})$ is equal to the observed state-action pair $(s_t, a_t)$, or if the support of its nominal transition probabilities, $P(\cdot \mid \tilde{s}, \tilde{a})$, is disjoint from or overlaps with the support of the observed state-action pair, $P(\cdot \mid s_t, a_t)$. The lower and upper bounds, denoted by $\tilde{P}_{t}^{\it LB}$ and $\tilde{P}_{t}^{\it UB}$, for these cases are given in Theorems \ref{theorem: observed state}-\ref{theorem:ub overlapping} (with proofs provided in Appendix \ref{sec: probability bounds proof}).
%
%

\begin{theorem}
\label{theorem: observed state}
For the observed state-action pair $(s_t, a_t)$, the linear program will produce the following bounds:
{
%
\[\tilde{P}_{t}^{\it LB}(s_{t+1} \mid s_t, a_t) = \tilde{P}_{t}^{\it UB}(s_{t+1} \mid s_t, a_t) = 1\] 
\[\forall \tilde{s}' \in \mathcal{S} \setminus \{s_{t+1}\}, \tilde{P}_{t}^{\it LB}(\tilde{s}' \mid s_t, a_t) = \tilde{P}_{t}^{\it UB}(\tilde{s}' \mid s_t, a_t) = 0\]
}
\end{theorem}

\begin{theorem}
\label{theorem: ub disjoint}
For state-action pairs $(\tilde{s}, \tilde{a})$ which have disjoint support from the observed $(s_t, a_t)$, the linear program will produce, $\forall \tilde{s}' \in \mathcal{S}$, the following bounds: 
\[
\begin{aligned}
&\tilde{P}_{t}^{\it UB}(\tilde{s}' \mid \tilde{s}, \tilde{a}) = \\ 
&\begin{cases}
\dfrac{P(\tilde{s}' \mid \tilde{s}, \tilde{a})}{P(s_{t+1} \mid s_t, a_t)}, \hfill
\textnormal{ if }P(\tilde{s}' \mid \tilde{s}, \tilde{a}) < P(s_{t+1} \mid s_t, a_t) \\[3pt]
1, \hfill \textnormal{ otherwise}
\end{cases}
\end{aligned}
\]
\[
\begin{aligned}
&\tilde{P}_{t}^{\it LB}(\tilde{s}' \mid \tilde{s}, \tilde{a}) =\\
&\begin{cases}
\text{$\dfrac{P(\tilde{s}' \mid \tilde{s}, \tilde{a}) - (1 - P(s_{t+1} \mid s_t, a_t))}{P(s_{t+1} \mid s_t, a_t)}$} \hspace*{2.5cm} \\ 
\hfill \textnormal{ if }P(\tilde{s}' \mid \tilde{s}, \tilde{a}) >(1-P(s_{t+1}\mid s_t,a_t))\\[3pt]
0, \hfill \textnormal{ otherwise}
\end{cases}
\end{aligned}
\]
\end{theorem}
\begin{theorem}
\label{theorem:ub overlapping}
For state-action pairs $(\tilde{s}, \tilde{a})\neq (s_t, a_t)$ which have overlapping support with the observed $(s_t, a_t)$, the linear program will produce, $\forall \tilde{s}' \in \mathcal{S}$, the bounds
\[
\begin{aligned}
&\tilde{P}_{t}^{\it UB}(\tilde{s}' \mid \tilde{s}, \tilde{a}) =\\
&\begin{cases}
\dfrac{\min\left(\begin{array}{@{}c@{}} P(s_{t+1} \mid s_t, a_t), P(s_{t+1} \mid \tilde{s}, \tilde{a}) \end{array}\right)}{P(s_{t+1} \mid s_t, a_t)}, \hfill \textnormal{if $\tilde{s}' = s_{t+1}$}\\[3pt]
0, \hfill \textnormal{ if CS conditions hold (*)}\\%textnormal
\min\left(\begin{array}{@{}c@{}} P(\tilde{s}' \mid \tilde{s}, \tilde{a}), 1 - P(s_{t+1} \mid \tilde{s}, \tilde{a}) \end{array}\right), \\ \hfill \textnormal{ if $P({\tilde{s}' \mid s_t, a_t}) > 0$}\\[3pt]
\min\left(\begin{array}{@{}c@{}} 1 - P(s_{t+1} \mid \tilde{s}, \tilde{a}), \dfrac{P(\tilde{s}' \mid \tilde{s}, \tilde{a})}{P(s_{t+1} \mid s_t, a_t)} \end{array}\right), \textnormal{ otherwise}\\
\end{cases}
\end{aligned}
\]
{
\[
\begin{aligned}
&\tilde{P}_{t}^{\it LB}(\tilde{s}' \mid \tilde{s}, \tilde{a}) = \\
&\begin{cases}
\max\left(P(\tilde{s}' \mid \tilde{s}, \tilde{a}), 1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{\it UB}(s' \mid \tilde{s}, \tilde{a})}\right), \\
\hfill \textnormal{if $\tilde{s}'= s_{t+1}$}\\[3pt]
0, \hfill \textnormal{ if CS conditions hold (*)}\\[3pt]
\max\left(0, 1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{\it UB}(s' \mid \tilde{s}, \tilde{a})}\right), \textnormal{ otherwise}
\end{cases}
\end{aligned}
\]
}
\end{theorem}
where the counterfactual stability (CS) conditions (*) are $P({\tilde{s}' \mid s_t, a_t}) > 0 \text{ and } \dfrac{P(s_{t+1} \mid \tilde{s}, \tilde{a})}{P(s_{t+1} \mid s_t, a_t)} > \dfrac{P(\tilde{s}' \mid \tilde{s}, \tilde{a})}{P({\tilde{s}' \mid s_t, a_t})}$
\subsection{Equivalence with Existing Work}
\label{sec: equivalence with Li}
The most similar work to ours is by \citet{li2024probabilities}, who derived tight counterfactual probability bounds for categorical models, given observational and interventional distributions. In contrast, our bounds are defined for one specific observation. In Appendix \ref{app: equivalence proofs}, we prove our bounds are equivalent, but only when the counterfactual stability and monotonicity assumptions are removed, or equivalently, when the counterfactual state-action pair has \textit{disjoint support} with the observed state-action pair\footnote{When the state-action pair has disjoint support, counterfactual stability and monotonicity hold vacuously.}. This equivalence reaffirms the correctness of our bounds and suggests we could reformulate them for an observational distribution, which would be an interesting future direction.