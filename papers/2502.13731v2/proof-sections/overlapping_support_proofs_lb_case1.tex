\paragraph{Case 1: $\tilde{s}' = s_{t+1}$}
\noindent
\begin{proof}
    To satisfy Mon1 \eqref{proofeq:monotonicity1}, $\tilde{P}_t^{LB}(s_{t+1} \mid \tilde{s}, \tilde{a}) \geq P(s_{t+1} \mid \tilde{s}, \tilde{a})$. To do this, we must assign $\theta$ such that:

    \begin{equation}
        \label{eq:overlapping constraint 9}
        \sum_{\substack{u_t \in U_t\\f(s_t, a_t, u_t) = s_{t+1}\\f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}}\theta_{u_t}\geq P(s_{t+1} \mid s_t, a_t) \cdot P(s_{t+1} \mid \tilde{s}, \tilde{a})
    \end{equation}
    
    Consider the following disjoint cases:

    \begin{enumerate}
        \item $P(s_{t+1} \mid \tilde{s}, \tilde{a}) \geq 1 - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})}$
        \item $P(s_{t+1} \mid \tilde{s}, \tilde{a}) < 1 - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})}$
    \end{enumerate}

    \paragraph{Case 1(a): $P(s_{t+1} \mid \tilde{s}, \tilde{a}) \geq 1 - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})}$}
\noindent
    \begin{proof}

    In this case, $P(s_{t+1} \mid \tilde{s}, \tilde{a}) \geq 1 - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})}$, therefore:

    \begin{equation}
        \label{eq: lbcase1a}
        P(s_{t+1} \mid s_t, a_t) \cdot P(s_{t+1} \mid \tilde{s}, \tilde{a}) \geq P(s_{t+1} \mid s_t, a_t) - P(s_{t+1} \mid s_t, a_t) \cdot \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})}
    \end{equation}
    
    Therefore, we can assign $\theta$ as follows:
    
    \[
    \begin{cases}
        \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}}{\theta_{u_t}} = P(s_{t+1} \mid s_t, a_t) \cdot P(s_{t+1} \mid \tilde{s}, \tilde{a})\\
        \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = P(s_{t+1} \mid s_t, a_t) - \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}}{\theta_{u_t}}\\
        \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}}{\theta_{u_t}} = P(s_{t+1} \mid \tilde{s}, \tilde{a}) - \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}}{\theta_{u_t}} \\
        \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}P(\tilde{s}' \mid \tilde{s}, \tilde{a}) - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}}\\
    \end{cases}
    \]
   
    This assignment of $\theta$ satisfies the constraints of the linear optimisation problem, as follows:

    \begin{itemize}        
    \item $\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1}}} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} \\ = P(s_{t+1} \mid s_t, a_t)$, satisfying \eqref{proofeq:interventional constraint}.

    \item $\sum_{\substack{u_t \in U_t\\f(s_t, a_t, u_t) \neq s_{t+1}}}{\theta_{u_t}} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} \\=1 -
    P(s_{t+1} \mid s_t, a_t)$, satisfying \eqref{proofeq:interventional constraint}.

    \item $\sum_{\substack{u_t \in U_t \\f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} + \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} = P(s_{t+1} \mid \tilde{s}, \tilde{a})$, \\satisfying \eqref{proofeq:interventional constraint}.
    
    \item $\sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} = \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} \\= 1 - P(\tilde{s}' \mid \tilde{s}, \tilde{a}) = \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}P(s' \mid \tilde{s}, \tilde{a})$, therefore it is possible to assign $\theta$ such that $\forall s' \in \mathcal{S}\setminus\{s_{t+1}\}, \sum_{\substack{u_t \in U_t \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = P(s' \mid \tilde{s}, \tilde{a})$, satisfying \eqref{proofeq:interventional constraint}.
    
    \item Eq. \eqref{eq:overlapping constraint 9} holds, so Mon1 \eqref{proofeq:monotonicity1} is satisfied. 
    
    \item CS \eqref{proofeq:counterfactual stability} always holds vacuously for the transition $\tilde{s}, \tilde{a} \rightarrow s_{t+1}$, because trivially $\dfrac{P(s_{t+1} \mid \tilde{s}, \tilde{a})}{P(s_{t+1} \mid s_t, a_t)} = \dfrac{P(s_{t+1} \mid \tilde{s}, \tilde{a})}{P(s_{t+1} \mid s_t, a_t)}$. 
    
    \item From \eqref{eq: lbcase1a}, we get:

    \[
    P(s_{t+1} \mid s_t, a_t) - P(s_{t+1} \mid s_t, a_t) \cdot P(\tilde{s}' \mid \tilde{s}, \tilde{a}) < \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})} \cdot P(s_{t+1} \mid s_t, a_t)
    \]

    This means that $\theta$ can be assigned such that $\forall s' \in \mathcal{S}\setminus\{s_{t+1}\}$, the counterfactual probability of each transition $\tilde{s}, \tilde{a} \rightarrow s'$ will be $\tilde{P}_t(s' \mid \tilde{s}, \tilde{a}) \leq \tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})$. We have already proven that each $\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})$ satisfies the \eqref{proofeq:monotonicity2} and CS \eqref{proofeq:counterfactual stability} constraints, and because $\tilde{P}_t(s' \mid \tilde{s}, \tilde{a}) \leq \tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})$, $\tilde{P}_t(s'\mid \tilde{s}, \tilde{a})$ will as well.

    \item $0 \leq \theta_{u_t} \leq 1, \forall u_t$, satisfying \eqref{proofeq:valid prob1}.
    
    \item $\sum_{u_t = 1}^{|U_t|} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} +  \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} + \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} \\+ \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = 1$, satisfying \eqref{proofeq:valid prob2}.
\end{itemize}

All the constraints are satisfied, so this is a valid assignment of $\theta$ for this state-action pair.
\end{proof}

\paragraph{Case 1(b): $P(s_{t+1} \mid \tilde{s}, \tilde{a}) < 1 - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})}$}
\noindent
\begin{proof}
In this case $P(s_{t+1} \mid \tilde{s}, \tilde{a}) < 1 - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})}$, therefore:

\begin{equation}
\label{eq: lbcase1b}
    P(s_{t+1} \mid s_t, a_t) \cdot P(s_{t+1} \mid \tilde{s}, \tilde{a}) < P(s_{t+1} \mid s_t, a_t) \cdot (1 - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})})
\end{equation}

Therefore, we can assign $\theta$ as follows:

\[
\begin{cases}
    \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}}{\theta_{u_t}} = P(s_{t+1} \mid s_t, a_t) \cdot (1 - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})})\\
    
    \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = P(s_{t+1} \mid s_t, a_t) \cdot (\sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})})\\
    
    \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}}{\theta_{u_t}} = P(s_{t+1} \mid \tilde{s}, \tilde{a}) - \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}}{\theta_{u_t}} \\
    
    \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{P(s' \mid \tilde{s}, \tilde{a})} - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}}\\
\end{cases}
\]

  This assignment of $\theta$ satisfies the constraints of the linear optimisation problem, as follows:

    \begin{itemize}        
    \item $\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1}}} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} \\ = P(s_{t+1} \mid s_t, a_t)$, satisfying \eqref{proofeq:interventional constraint}.

    \item $\sum_{\substack{u_t \in U_t\\f(s_t, a_t, u_t) \neq s_{t+1}}}{\theta_{u_t}} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} \\=1 -
    P(s_{t+1} \mid s_t, a_t)$, satisfying \eqref{proofeq:interventional constraint}.

    \item $\sum_{\substack{u_t \in U_t \\f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} + \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} = P(s_{t+1} \mid \tilde{s}, \tilde{a})$, \\satisfying \eqref{proofeq:interventional constraint}.
    
    \item $\sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} = \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} \\= 1 - P(\tilde{s}' \mid \tilde{s}, \tilde{a}) = \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}P(s' \mid \tilde{s}, \tilde{a})$, therefore it is possible to assign $\theta$ such that $\forall s' \in \mathcal{S}\setminus\{s_{t+1}\}, \sum_{\substack{u_t \in U_t \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = P(s' \mid \tilde{s}, \tilde{a})$, satisfying \eqref{proofeq:interventional constraint}.
    
    \item From \eqref{eq: lbcase1b}, we get:
    
    \[\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}}{\theta_{u_t}} = P(s_{t+1} \mid s_t, a_t) \cdot (1 - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})})> P(s_{t+1} \mid s_t, a_t) \cdot P(s_{t+1} \mid \tilde{s}, \tilde{a})\]
    
    Therefore, \eqref{eq:overlapping constraint 9} holds, so Mon1 \eqref{proofeq:monotonicity1} is satisfied. 

    \item CS \eqref{proofeq:counterfactual stability} always holds vacuously for the transition $\tilde{s}, \tilde{a} \rightarrow s_{t+1}$, because trivially $\dfrac{P(s_{t+1} \mid \tilde{s}, \tilde{a})}{P(s_{t+1} \mid s_t, a_t)} = \dfrac{P(s_{t+1} \mid \tilde{s}, \tilde{a})}{P(s_{t+1} \mid s_t, a_t)}$. 
    
    \item Because $\sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = P(s_{t+1} \mid s_t, a_t) \cdot (\sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})})$, this means that $\theta$ can be assigned such that $\forall s' \in \mathcal{S}\setminus\{s_{t+1}\}$, its counterfactual probability $\tilde{P}_t(s' \mid \tilde{s}, \tilde{a}) = \tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})$, which we have already proven to satisfy Mon2 \eqref{proofeq:monotonicity2} and CS \eqref{proofeq:counterfactual stability}.

    \item $0 \leq \theta_{u_t} \leq 1, \forall u_t$, satisfying \eqref{proofeq:valid prob1}.
    
    \item $\sum_{u_t = 1}^{|U_t|} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} +  \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} + \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} \\+ \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = 1$, satisfying \eqref{proofeq:valid prob2}.
\end{itemize}

All the constraints are satisfied, so this is a valid assignment of $\theta$ for this state-action pair.
\end{proof}

Therefore, these two cases can be simplified as:

\begin{align*}
\tilde{P}_{t}^{LB}(\tilde{s}' \mid \tilde{s}, \tilde{a}) &= \dfrac{\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}}{\theta_{u_t}}}{P(s_{t+1} \mid s_t, a_t)}\\ &=
\dfrac{\max\left(P(s_{t+1} \mid s_t, a_t) \cdot P(s_{t+1} \mid \tilde{s}, \tilde{a}), P(s_{t+1} \mid s_t, a_t) \cdot (1 - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})})\right)}{P(s_{t+1} \mid s_t, a_t)}\\ &= \max\left(P(\tilde{s}' \mid \tilde{s}, \tilde{a}), 1 - \sum_{s' \in \mathcal{S}\setminus\{s_{t+1}\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})}\right)
\end{align*}
\end{proof}