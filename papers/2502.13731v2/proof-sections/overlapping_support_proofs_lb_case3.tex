\paragraph{Case 3: $\tilde{s}' \neq s_{t+1}$, and $\dfrac{P(s_{t+1} \mid \tilde{s}, \tilde{a})}{P(s_{t+1} \mid s_t, a_t)}\leq\dfrac{P(\tilde{s}' \mid \tilde{s}, \tilde{a})}{P(\tilde{s}' \mid s_t, a_t)}$ or $P(\tilde{s}' \mid s_t, a_t) = 0$}
\noindent
\begin{proof}
Consider the following disjoint cases:
\begin{itemize}
    \item $1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})} \geq 0$
    \item $1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})} < 0$
\end{itemize}

\paragraph{Case 3(a): $1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(\tilde{s}' \mid \tilde{s}, \tilde{a})} \geq 0$}
\noindent
\begin{proof}
We can assign $\theta$ as follows:

\[
\begin{cases}
    \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}}{\theta_{u_t}} = P(s_{t+1} \mid s_t, a_t) \cdot (1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})})\\
    
    \forall{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}, \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = P(s_{t+1} \mid s_t, a_t) \cdot {\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})}\\
    
    \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}}{\theta_{u_t}} = P(\tilde{s}' \mid \tilde{s}, \tilde{a}) - \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}}{\theta_{u_t}} \\
    
    \forall{s' \in \mathcal{S}\setminus\{ \tilde{s}'\}}, \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = P(s' \mid \tilde{s}, \tilde{a})- \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}}\\
\end{cases}
\]

 This assignment of $\theta$ satisfies the constraints of the linear optimisation problem, as follows:

    \begin{itemize}        
    \item $\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1}}} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{ \tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} \\ = P(s_{t+1} \mid s_t, a_t)$, satisfying \eqref{proofeq:interventional constraint}.

    \item $\sum_{\substack{u_t \in U_t\\f(s_t, a_t, u_t) \neq s_{t+1}}}{\theta_{u_t}} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{ \tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} \\=1 -
    P(s_{t+1} \mid s_t, a_t)$, satisfying \eqref{proofeq:interventional constraint}.

    \item $\sum_{\substack{u_t \in U_t \\f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}} \theta_{u_t} + \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}} \theta_{u_t} = P(\tilde{s}' \mid \tilde{s}, \tilde{a})$, \\satisfying \eqref{proofeq:interventional constraint}.
    
    \item $\sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} = \sum_{s' \in \mathcal{S}\setminus\{ \tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} \\= 1 - P(\tilde{s}' \mid \tilde{s}, \tilde{a}) = \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}P(s' \mid \tilde{s}, \tilde{a})$, therefore it is possible to assign $\theta$ such that $\forall s' \in \mathcal{S}\setminus\{\tilde{s}'\}, \sum_{\substack{u_t \in U_t \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = P(s' \mid \tilde{s}, \tilde{a})$, satisfying \eqref{proofeq:interventional constraint}.

    \item $\forall s' \in \mathcal{S} \setminus \{\tilde{s}'\}, \tilde{P}_t(s' \mid \tilde{s}, \tilde{a}) = \dfrac{\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}}}{P(s_{t+1} \mid s_t, a_t)} = \dfrac{P(s_{t+1} \mid s_t, a_t) \cdot \tilde{P}_t^{UB}(s' \mid \tilde{s}, \tilde{a})}{P(s_{t+1} \mid s_t, a_t)} = \tilde{P}_t^{UB}(s' \mid \tilde{s}, \tilde{a})$, which we have already shown in the proof for Theorem \ref{proof theorem:ub overlapping} satisfies Mon1 \eqref{proofeq:monotonicity1}, Mon2 \eqref{proofeq:monotonicity2} and CS \eqref{proofeq:counterfactual stability}.

    \item Mon2 \eqref{proofeq:monotonicity2} is also satisfied for the transition $\tilde{s}, \tilde{a} \rightarrow \tilde{s}'$, as follows:

    \begin{itemize}
        \item If $P(\tilde{s}' \mid s_t, a_t) = 0$, then this assignment of $\theta$ vacuously satisfies Mon2 \eqref{proofeq:monotonicity2}.
        
        \item Otherwise, we have already proven that there exists an assignment of $\theta$ that satisfies all the constraints (as proven in Theorem \ref{proof theorem:ub overlapping}). If $1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(\tilde{s}' \mid \tilde{s}, \tilde{a})} > 0 $, then the minimum possible counterfactual transition probability of $\tilde{s}, \tilde{a} \rightarrow \tilde{s}'$ is $\tilde{P}_t(\tilde{s}' \mid \tilde{s}, \tilde{a}) = 1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'}{\tilde{P}_{t}^{UB}(\tilde{s}' \mid \tilde{s}, \tilde{a})}$ (because the upper bounds must sum to $1$). Therefore, $1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(\tilde{s}' \mid \tilde{s}, \tilde{a})} \leq P(\tilde{s}' \mid \tilde{s}, \tilde{a})$, or there would be no valid assignment of $\theta$ that satisfies Mon2 \eqref{proofeq:monotonicity2}.
    \end{itemize}

    \item CS \eqref{proofeq:counterfactual stability} will be vacuously satisfied for the transition $\tilde{s}, \tilde{a} \rightarrow \tilde{s}'$, because $\dfrac{P(s_{t+1} \mid \tilde{s}, \tilde{a})}{P(s_{t+1} \mid s_t, a_t)}\leq\dfrac{P(\tilde{s}' \mid \tilde{s}, \tilde{a})}{P(\tilde{s}' \mid s_t, a_t)}$ or $P(\tilde{s}' \mid s_t, a_t) = 0$.

    \item $0 \leq \theta_{u_t} \leq 1, \forall u_t$, satisfying \eqref{proofeq:valid prob1}.
    
    \item $\sum_{u_t = 1}^{|U_t|} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} +  \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} + \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} \\+ \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = 1$, satisfying \eqref{proofeq:valid prob2}.
\end{itemize}
All the constraints are satisfied, so this is a valid assignment of $\theta$ for this state-action pair.
\end{proof}

\pagebreak
\paragraph{Case 3(b): $1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(\tilde{s}' \mid \tilde{s}, \tilde{a})} < 0$}
\noindent
\begin{proof}
Because $1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(\tilde{s}' \mid \tilde{s}, \tilde{a})} < 0$, we have:

\[
    P(s_{t+1} \mid s_t, a_t) \cdot \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})} > P(s_{t+1} \mid s_t, a_t)
\]

Therefore, we can assign $\theta$ as follows:

\[
\begin{cases}
    \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}}{\theta_{u_t}} = 0\\
    
    \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = P(s_{t+1} \mid s_t, a_t)\\
    
    \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}}{\theta_{u_t}} = P(\tilde{s}' \mid \tilde{s}, \tilde{a})\\
    
    \sum_{s' \in \mathcal{S}\setminus\{ \tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{P(s' \mid \tilde{s}, \tilde{a})} - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}}\\
\end{cases}
\]

This assignment of $\theta$ satisfies the constraints of the linear optimisation problem, as follows:


    \begin{itemize}        
    \item $\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1}}} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{ \tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} \\ = P(s_{t+1} \mid s_t, a_t)$, satisfying \eqref{proofeq:interventional constraint}.

    \item $\sum_{\substack{u_t \in U_t\\f(s_t, a_t, u_t) \neq s_{t+1}}}{\theta_{u_t}} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{ \tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} \\=1 -
    P(s_{t+1} \mid s_t, a_t)$, satisfying \eqref{proofeq:interventional constraint}.

    \item $\sum_{\substack{u_t \in U_t \\f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}} \theta_{u_t} + \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}} \theta_{u_t} = P(\tilde{s}' \mid \tilde{s}, \tilde{a})$ , \\satisfying \eqref{proofeq:interventional constraint}.
    
    \item $\sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} = \sum_{s' \in \mathcal{S}\setminus\{ \tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} + \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}} \theta_{u_t} \\= 1 - P(\tilde{s}' \mid \tilde{s}, \tilde{a}) = \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}P(s' \mid \tilde{s}, \tilde{a})$, therefore it is possible to assign $\theta$ such that $\forall s' \in \mathcal{S}\setminus\{\tilde{s}'\}, \sum_{\substack{u_t \in U_t \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = P(s' \mid \tilde{s}, \tilde{a})$, satisfying \eqref{proofeq:interventional constraint}.

    \item From this assignment of $\theta$, $\tilde{P}_t(\tilde{s}' \mid \tilde{s}, \tilde{a}) = \dfrac{\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}}{\theta_{u_t}}}{P(s_{t+1}\mid s_t, a_t)} = \dfrac{0}{P(s_{t+1} \mid s_t, a_t)} = 0 \leq P(\tilde{s}' \mid \tilde{s}, \tilde{a})$, which immediately satisfies the Mon2 \eqref{proofeq:monotonicity2} and CS \eqref{proofeq:counterfactual stability} constraints for the transition $\tilde{s}, \tilde{a} \rightarrow \tilde{s}'$.
    
    \item Because $1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(\tilde{s}' \mid \tilde{s}, \tilde{a})} < 0$:
    \[
    P(s_{t+1} \mid s_t, a_t) < \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(\tilde{s}' \mid \tilde{s}, \tilde{a}) \cdot P(s_{t+1} \mid s_t, a_t)}
    \]

    This guarantees that we can assign $\theta$ such that the Mon1 \eqref{proofeq:monotonicity1}, Mon2 \eqref{proofeq:monotonicity2} and CS \eqref{proofeq:counterfactual stability} constraints are satisfied for all transitions $\tilde{s}', \tilde{a}' \rightarrow s', \forall s' \in \mathcal{S}\setminus\{\tilde{s}'\}$. In particular, we should assign $\theta$ such that $\tilde{P}_t(s_{t+1} \mid \tilde{s}, \tilde{a}) = \tilde{P}_{t}^{UB}(s_{t+1} \mid \tilde{s}, \tilde{a})$ (Theorem \ref{proof theorem:ub overlapping} proves this $\theta$ exists), as we have proven that Mon1 \eqref{proofeq:monotonicity1} and CS \eqref{proofeq:counterfactual stability} constraints are satisfied for $\tilde{P}_{t}^{UB}(s_{t+1} \mid \tilde{s}, \tilde{a})$. Then, we can assign $\theta$ such that $\forall s' \in \mathcal{S}\setminus\{\tilde{s}', s_{t+1}\}, \tilde{P}_t(\tilde{s}' \mid \tilde{s}, \tilde{a}) \leq \tilde{P}_{t}^{UB}(\tilde{s}' \mid \tilde{s}, \tilde{a})$, and because each $\tilde{P}_{t}^{UB}(\tilde{s}' \mid \tilde{s}, \tilde{a})$ has been proven to satisfy the Mon2 \eqref{proofeq:monotonicity2} and CS \eqref{proofeq:counterfactual stability} constraints, each $\tilde{P}_t(\tilde{s}' \mid \tilde{s}, \tilde{a})$ must as well. 

    \item $0 \leq \theta_{u_t} \leq 1, \forall u_t$, satisfying \eqref{proofeq:valid prob1}.
    
    \item $\sum_{u_t = 1}^{|U_t|} \theta_{u_t} = \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} +  \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} + \sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s_{t+1}}} \theta_{u_t} \\+ \sum_{s' \in \mathcal{S}\setminus\{ s_{t+1}\}}\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) \neq s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = 1$, satisfying \eqref{proofeq:valid prob2}.
\end{itemize}
All the constraints are satisfied, so this is a valid assignment of $\theta$ for this state-action pair.

\end{proof}
Therefore, these two cases can be simplified as:

\begin{align*}
\tilde{P}_{t}^{LB}(\tilde{s}' \mid \tilde{s}, \tilde{a}) &= \dfrac{\sum_{\substack{u_t \in U_t \\f(s_t, a_t, u_t) = s_{t+1} \\ f(\tilde{s}, \tilde{a}, u_t) = \tilde{s}'}}{\theta_{u_t}}}{P(s_{t+1} \mid s_t, a_t)}\\ &=
\dfrac{\max\left(0, P(s_{t+1} \mid s_t, a_t) \cdot (1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})})\right)}{P(s_{t+1} \mid s_t, a_t)}\\ &= \max\left(0, 1 - \sum_{s' \in \mathcal{S}\setminus\{\tilde{s}'\}}{\tilde{P}_{t}^{UB}(s' \mid \tilde{s}, \tilde{a})}\right)
\end{align*}
\end{proof}