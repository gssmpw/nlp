\subsubsection{CF Bounds for Observed $(s_t, a_t)$}
%
\begin{theorem}
\label{proof theorem: observed state}
For outgoing transitions from the observed state-action pair $(s_t, a_t)$, the linear program will produce bounds of:

\[\tilde{P}_{t}^{LB}(s_{t+1} \mid s_t, a_t) = \tilde{P}_{t}^{UB}(s_{t+1} \mid s_t, a_t) = 1\] 

for the observed next state $s_{t+1}$, and 

\[\tilde{P}_{t}^{LB}(\tilde{s}' \mid s_t, a_t) = \tilde{P}_{t}^{UB}(\tilde{s}' \mid s_t, a_t) = 0\]

for all other $\tilde{s}' \in \mathcal{S}\setminus \{s_{t+1}\}$.
\end{theorem}

\begin{proof}
If $(\tilde{s}, \tilde{a}) = (s_t, a_t)$, then it is impossible to have a $u_t$ such that $f(s_t, a_t, u_t) = s'$ and $f(\tilde{s}, \tilde{a}, u_t) \neq s'$, $\forall s' \in \mathcal{S}$. Therefore, the only possible assignment of $\theta$ is:

\[
    \sum_{\substack{u_t \in U_t\\f(s_t, a_t, u_t) = s_{t+1}}}{\theta_{u_t}} = P(s_{t+1} \mid \tilde{s}, \tilde{a})
\]

\[
    \forall s' \in \mathcal{S}\setminus \{s_{t+1}\}, \sum_{\substack{u_t \in U_t\\f(s_t, a_t, u_t) \neq s'}}{\theta_{u_t}} = P(s' \mid \tilde{s}, \tilde{a})\\
\]
    This assignment satisfies the interventional probability constraints:

    \begin{itemize}
        \item $\sum_{\substack{u_t \in U_t\\f(s_t, a_t, u_t) = s_{t+1}}}{\theta_{u_t}} = P(s_{t+1} \mid s_t, a_t)$ satisfying \eqref{proofeq:interventional constraint}.
        \item $\sum_{\substack{u_t \in U_t\\f(s_t, a_t, u_t) \neq s_{t+1}}}{\theta_{u_t}} = 1 - P(s_{t+1} \mid s_t, a_t)$ satisfying \eqref{proofeq:interventional constraint}.
        \item $\forall s' \in \mathcal{S}, \sum_{\substack{u_t \in U_t \\ f(\tilde{s}, \tilde{a}, u_t) = s'}}{\theta_{u_t}} = P(s' \mid \tilde{s}, \tilde{a})$ satisfying \eqref{proofeq:interventional constraint}.
        \item Because of Lemma \ref{lemma: CF probs of observed state-action pair}, $\tilde{P}_{t}(s_{t+1} \mid s_t, a_t) = 1 \geq P(s_{t+1} \mid s_t, a_t)$, satisfying Mon1 \eqref{proofeq:monotonicity1}, and $\forall s' \in \mathcal{S}\setminus \{s_{t+1}\}, \tilde{P}_{t}(s' \mid s_t, a_t) = 0 \leq P(s' \mid s_t, a_t)$, satisfying Mon2 \eqref{proofeq:monotonicity2}.
        \item Because $\dfrac{P(s_{t+1} \mid s_t, a_t)}{P(s_{t+1} \mid s_t, a_t)} = 1$ and $\forall s' \in \mathcal{S}, \dfrac{P(s' \mid s_t, a_t)}{P(s' \mid s_t, a_t)} = 1$,

        \[
        \forall s' \in \mathcal{S}, \dfrac{P(s_{t+1} \mid s_t, a_t)}{P(s_{t+1} \mid s_t, a_t)} = \dfrac{P(s' \mid s_t, a_t)}{P(s' \mid s_t, a_t)}
        \]
    
        so CS \eqref{proofeq:counterfactual stability} is always vacuously true for all transitions from $(s_t, a_t)$.
        \item $0 \leq \theta_{u_t} \leq 1, \forall u_t$, satisfying \eqref{proofeq:valid prob1}.
        \item $\sum_{u_t = 1}^{|U_t|} \theta_{u_t} = \sum_{s' \in \mathcal{S}} P(s' \mid s_t, a_t) = 1$, satisfying \eqref{proofeq:valid prob2}.
    \end{itemize}
    
Therefore,

\[\tilde{P}_{t}^{LB}(s_{t+1} \mid s_t, a_t) = \tilde{P}_{t}^{UB}(s_{t+1} \mid s_t, a_t) = 1\] 

and $\forall \tilde{s}' \in \mathcal{S}\setminus \{s_{t+1}\}$:

\[\tilde{P}_{t}^{LB}(\tilde{s}' \mid s_t, a_t) = \tilde{P}_{t}^{UB}(\tilde{s}' \mid s_t, a_t) = 0\]

\end{proof}
