\begin{figure*}
\centering
    \begin{tikzpicture}
        \node[anchor=south west,inner sep=0] (image) at (0,0) 
            {\includegraphics[width=1.\linewidth]{figures/raw/arch.pdf}};

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{9}{9}\selectfont] at (0.07,.97) {point cloud $P$};
        \end{scope}
    
        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{9}{9}\selectfont] at (0.22,0.97) {ball tree, level $L_k$};
        \end{scope}
    
        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{9}{9}\selectfont] at (0.07,0.45) {coarsened tree};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{9}{9}\selectfont] at (0.22,0.443) {ball tree, level $L_{k+1}$};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{9}{9}\selectfont] at (0.465,0.46) {refinement};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{9}{9}\selectfont] at (0.465,0.97) {coarsening};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=gray, font=\fontsize{9}{9}\selectfont] at (.41,0.345) {rotate};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=gray, font=\fontsize{9}{9}\selectfont] at (.528,0.345) {ball tree};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{9}{9}\selectfont] at (.36,0.01) {original balls};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{9}{9}\selectfont] at (0.465,0.01) {leaves};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{9}{9}\selectfont] at (0.575,0.01) {"rotated" balls};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=gray, font=\fontsize{8}{8}\selectfont] at (0.885,0.95) {Erwin Transformer};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=gray, font=\fontsize{8}{8}\selectfont] at (0.815,0.57) {Encoder};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=gray, font=\fontsize{8}{8}\selectfont] at (0.955,0.57) {Decoder};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=gray, font=\fontsize{8}{8}\selectfont] at (0.885,0.52) {Bottleneck};
        \end{scope}


        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=gray, font=\fontsize{8}{8}\selectfont] at (0.6925,0.95) {Embedding};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{7}{8}\selectfont] at (0.6925,0.855) {Point Cloud};
        \end{scope}
        
        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{8}{8}\selectfont] at (0.6925,0.704) {Ball Tree};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{8}{8}\selectfont] at (0.6925,0.56) {MPNN};
        \end{scope}


        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{7}{7}\selectfont, rotate=90] at (0.693,0.16) {LNorm};
        \end{scope} 

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{7}{7}\selectfont, rotate=90] at (0.738,0.16) {$+$ RPE};
        \end{scope} 

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{7}{7}\selectfont, rotate=90] at (0.7825,0.162) {Attention};
        \end{scope} 

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{7}{7}\selectfont, rotate=90] at (0.849,0.16) {LNorm};
        \end{scope} 

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{7}{7}\selectfont, rotate=90] at (0.8935,0.162) {SwiGLU};
        \end{scope} 

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=gray, font=\fontsize{8}{8}\selectfont] at (0.78,0.34) {ErwinBlock};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=gray, font=\fontsize{8}{8}\selectfont] at (0.915,0.34) {$\times D$};
        \end{scope}


        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=gray, font=\fontsize{8}{8}\selectfont] at (0.81,0.415) {ErwinLayer};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=gray, font=\fontsize{8}{8}\selectfont] at (0.975,0.415) {$\times S$};
        \end{scope}

        \begin{scope}[x={(image.south east)},y={(image.north west)}]
            \node[color=black, font=\fontsize{7}{7}\selectfont, rotate=90] at (0.977,0.2) {Coarsening};
        \end{scope} 


            
    \end{tikzpicture}
    \vspace{-13pt}
    \caption{
    Overview of Erwin. \textbf{Left:} A sequence of two ball attention layers with intermediate tree coarsening. In every layer, attention is computed on partitions of size $16$, which correspond to progressively higher levels of hierarchy.
    \textbf{Center (top):} Coarsening and refinement of a ball tree. 
    \textbf{Center (bottom):} Building a tree on top of a rotated configuration for cross-ball interaction.
    \textbf{Right:} Architecture of Erwin.
    }
    \label{fig:overview}
\end{figure*}
