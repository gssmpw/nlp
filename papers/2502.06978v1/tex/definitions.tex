\makeatletter
\DeclareRobustCommand{\cev}[1]{%
  {\mathpalette\do@cev{#1}}%
}
\newcommand{\do@cev}[2]{%
  \vbox{\offinterlineskip
    \sbox\z@{$\m@th#1 x$}%
    \ialign{##\cr
      \hidewidth\reflectbox{$\m@th#1\vec{}\mkern4mu$}\hidewidth\cr
      \noalign{\kern-\ht\z@}
      $\m@th#1#2$\cr
    }%
  }%
}

\newcommand{\ubar}[1]{\underaccent{\bar}{#1}}

\makeatother

\newcommand{\clarabelQuad}{Clarabel\textsubscript{quad}}

% sqrt(-1)
\newcommand{\im}{\mathbf{j}}

\newcommand{\trace}{\operatorname{tr}}

% Branch admittance parameters
\newcommand{\gff}{g^{\text{ff}}}
\newcommand{\gft}{g^{\text{ft}}}
\newcommand{\gtf}{g^{\text{tf}}}
\newcommand{\gtt}{g^{\text{tt}}}
\newcommand{\bff}{b^{\text{ff}}}
\newcommand{\bft}{b^{\text{ft}}}
\newcommand{\btf}{b^{\text{tf}}}
\newcommand{\btt}{b^{\text{tt}}}
\newcommand{\yff}{Y^{\text{ff}}}
\newcommand{\yft}{Y^{\text{ft}}}
\newcommand{\ytf}{Y^{\text{tf}}}
\newcommand{\ytt}{Y^{\text{tt}}}


% active / reactive power dispatch
\newcommand{\pg}{\mathbf{p}^{\text{g}}}
\newcommand{\qg}{\mathbf{q}^{\text{g}}}
\newcommand{\Sg}{\mathbf{S}^{\text{g}}}

% voltage variables
\newcommand{\vm}{\mathbf{v}}
\newcommand{\va}{\mathbf{\theta}}
\newcommand{\V}{\mathbf{V}}
\newcommand{\vr}{\mathbf{e}}
\newcommand{\vi}{\mathbf{f}}

% Branch flow variables
\newcommand{\pf}{\vec{\mathbf{p}}}
\newcommand{\qf}{\vec{\mathbf{q}}}
\newcommand{\Sf}{\vec{\mathbf{S}}}
\newcommand{\pt}{\cev{\mathbf{p}}}
\newcommand{\qt}{\cev{\mathbf{q}}}
\newcommand{\St}{\cev{\mathbf{S}}}

% SOC variables
\newcommand{\wmsoc}{\mathbf{w}}
\newcommand{\wcsoc}{\mathbf{w}^{\text{re}}}
\newcommand{\wssoc}{\mathbf{w}^{\text{im}}}

% SDP variables
\newcommand{\Wsdp}{\mathbf{W}}
\newcommand{\Xsdp}{\mathbf{X}}
\newcommand{\Wrsdp}{\mathbf{W}^{\text{re}}}
\newcommand{\Wisdp}{\mathbf{W}^{\text{im}}}

\DeclarePairedDelimiterX{\inner}[2]{\langle}{\rangle}{#1, #2}
\newcommand{\symmat}{\mathbb{S}}
\newcommand{\skewmat}{\overline{\symmat}}
\newcommand{\psdsymmat}{\symmat_{+}}
\newcommand{\hermat}{\mathbb{H}}
\newcommand{\psdhermat}{\hermat_{+}}
\newcommand{\sympart}{\mathcal{H}}  % symmetric part
\newcommand{\skewpart}{\mathcal{Z}}  % skew-symmetric part
\newcommand{\blocksymmat}{\mathbb{S}^{B}}
\newcommand{\blockpsdsymmat}{\mathbb{S}^{B}_{+}}
\newcommand{\E}{\mathbf{E}}
\newcommand{\Ere}{\E^{\text{re}}}
\newcommand{\Eim}{\E^{\text{im}}}

% Input data
% demand
\newcommand{\pd}{\text{p}^{\text{d}}}
\newcommand{\qd}{\text{q}^{\text{d}}}
\newcommand{\Sd}{\text{S}^{\text{d}}}
% min/max generation limits
\newcommand{\Sgmin}{\underline{\text{S}}^{\text{g}}}
\newcommand{\Sgmax}{\overline{\text{S}}^{\text{g}}}
\newcommand{\pgmin}{\underline{\text{p}}^{\text{g}}}
\newcommand{\pgmax}{\overline{\text{p}}^{\text{g}}}
\newcommand{\qgmin}{\underline{\text{q}}^{\text{g}}}
\newcommand{\qgmax}{\overline{\text{q}}^{\text{g}}}
% min/max voltages
\newcommand{\vmmin}{\underline{\text{v}}}
\newcommand{\vmmax}{\overline{\text{v}}}
% min/max voltage angles
\newcommand{\dvamin}{\underline{\Delta \va}_{ij}}
\newcommand{\dvamax}{\overline{\Delta \va}_{ij}}
% min/max for w_ij
\newcommand{\wcsocmin}{\underline{\mathbf{w}}^{\text{re}}}
\newcommand{\wcsocmax}{\overline{\mathbf{w}}^{\text{re}}}
\newcommand{\wssocmin}{\underline{\mathbf{w}}^{\text{im}}}
\newcommand{\wssocmax}{\overline{\mathbf{w}}^{\text{im}}}

% Gamma parameters for the SOC formulation
\newcommand{\gammaPwfr}{\vec{\gamma}^{\text{p,w}}}
\newcommand{\gammaQwfr}{\vec{\gamma}^{\text{q,w}}}
\newcommand{\gammaPwto}{\cev{\gamma}^{\text{p,w}}}
\newcommand{\gammaQwto}{\cev{\gamma}^{\text{q,w}}}
\newcommand{\gammaPrfr}{\vec{\gamma}^{\text{p,r}}}
\newcommand{\gammaQrfr}{\vec{\gamma}^{\text{q,r}}}
\newcommand{\gammaPrto}{\cev{\gamma}^{\text{p,r}}}
\newcommand{\gammaQrto}{\cev{\gamma}^{\text{q,r}}}
\newcommand{\gammaPifr}{\vec{\gamma}^{\text{p,i}}}
\newcommand{\gammaQifr}{\vec{\gamma}^{\text{q,i}}}
\newcommand{\gammaPito}{\cev{\gamma}^{\text{p,i}}}
\newcommand{\gammaQito}{\cev{\gamma}^{\text{q,i}}}

% admittance matrix
\newcommand{\Y}{{\mathbf{Y}}}
\newcommand{\G}{\mathbf{G}}
\newcommand{\B}{\mathbf{B}}

\newcommand{\M}{\mathbf{M}}
\newcommand{\Mfr}{\vec{\M}}
\newcommand{\Mto}{\cev{\M}}


%% Dual variables
% Notation convention:
%   * \lambda --> equality constraints
%   * \mu     --> linear inequality constraints
%   * \nu     --> conic (SOC) constraints
% Power balance (active/reactive)
\newcommand{\lambdaP}{\lambda^{\text{p}}}
\newcommand{\lambdaQ}{\lambda^{\text{q}}}
% Ohm's law (active/reactive, from/to)
\newcommand{\lambdaPf}{\vec{\phantom{\lambda}}\hspace{-0.58em}{\lambda}^{\text{p}}}
\newcommand{\lambdaPt}{\cev{\phantom{\lambda}}\hspace{-0.35em}{\lambda}^{\text{p}}}
\newcommand{\lambdaQf}{\vec{\phantom{\lambda}}\hspace{-0.58em}{\lambda}^{\text{q}}}
\newcommand{\lambdaQt}{\cev{\phantom{\lambda}}\hspace{-0.35em}{\lambda}^{\text{q}}}
% Transmission limit (from/to)
\newcommand{\nuThermalfr}{\vec{\nu}}
\newcommand{\nuThermalSfr}{\vec{\nu}^{\, \text{s}}}
\newcommand{\nuThermalPfr}{\vec{\nu}^{\, \text{p}}}
\newcommand{\nuThermalQfr}{\vec{\nu}^{\, \text{q}}}
\newcommand{\nuThermalto}{\cev{\nu}}
\newcommand{\nuThermalSto}{\cev{\nu}^{\, \text{s}}}
\newcommand{\nuThermalPto}{\cev{\nu}^{\, \text{p}}}
\newcommand{\nuThermalQto}{\cev{\nu}^{\, \text{q}}}
% Voltage product (conic)
\newcommand{\nuWprod}{\nu^{\text{w}}}
\newcommand{\omegaf}{\omega^{\text{f}}}
\newcommand{\omegat}{\omega^{\text{t}}}
\newcommand{\omegar}{\omega^{\text{re}}}
\newcommand{\omegai}{\omega^{\text{im}}}
% Dispatch bounds (active/reactive)
\newcommand{\muPg}{{\mu}^{\text{pg}}}
\newcommand{\muPgMin}{\ubar{\mu}^{\text{pg}}}
\newcommand{\muPgMax}{\bar{\mu}^{\text{pg}}}
\newcommand{\muQg}{{\mu}^{\text{qg}}}
\newcommand{\muQgMin}{\ubar{\mu}^{\text{qg}}}
\newcommand{\muQgMax}{\bar{\mu}^{\text{qg}}}
% Voltage magnitude bounds
\newcommand{\muWm}{{\mu}^{\text{w}}}
\newcommand{\muWmMin}{\ubar{\mu}^{\text{w}}}
\newcommand{\muWmMax}{\bar{\mu}^{\text{w}}}
% Angle difference bounds
\newcommand{\muAngleDiff}{{\mu}^{\Delta\theta}}
\newcommand{\muAngleDiffMin}{\ubar{\mu}^{\Delta\theta}}
\newcommand{\muAngleDiffMax}{\bar{\mu}^{\Delta\theta}}
% w_ij bounds
\newcommand{\muWr}{{\mu}^{\text{wr}}}
\newcommand{\muWrMin}{\ubar{\mu}^{\text{wr}}}
\newcommand{\muWrMax}{\bar{\mu}^{\text{wr}}}
\newcommand{\muWi}{{\mu}^{\text{wi}}}
\newcommand{\muWiMin}{\ubar{\mu}^{\text{wi}}}
\newcommand{\muWiMax}{\bar{\mu}^{\text{wi}}}

% SDP
\newcommand{\Ssdp}{\mathbf{S}}

\newcommand{\pdRef}{\bar{\text{p}}^{\text{d}}}
\newcommand{\qdRef}{\bar{\text{q}}^{\text{d}}}