\begin{algorithm*}[t]
\caption{Verified Diversification for ambiguous queries}
\begin{algorithmic}[1]
\Require Question $q$,
LLM $\texttt{LLM}(\cdot)$
\Ensure Pairs of clarification question and answer $\hat{\mathcal{Q}}=\{(\hat{q}, \hat{y})\}$

\State $q^\prime$ $\leftarrow$ Relax $q$ for high-recall universe
\State %
$U$ $\leftarrow$ Top-$k$ retrieved passages from the retriever, using $q^\prime$ as query

\State $\mathcal{Q} \leftarrow \{\}$
\For{$i=1$ to $k$}
    \State $(\hat{q}_i, \hat{y}_i)$ $\leftarrow$ $\texttt{LLM}(q, p_i; I_{\textrm{E}})$ \Comment{Extracting interpretation from passage $p_i$ with execution feedback}
    \If {$\hat{q}_i$ is not \texttt{None}}
        \State $\mathcal{Q} \leftarrow \mathcal{Q} \cup \left\{ (\hat{q}_i, \hat{y}_i) \right\}$
    \EndIf
\EndFor

\State $\mathcal{C}$ $\leftarrow$ Cluster into partitions $\mathcal{C}_i$'s of $\mathcal{Q}$ based on embeddings $f(\hat{q}_i; \hat{y}_i)$

\State $\hat{\mathcal{Q}} \leftarrow \{\}$
\For{$j=1$ to $k$}
    \State $(\check{q}_j, \check{y}_j)$ $\leftarrow$ $\argmax_{({q}^*,y^*)\in \mathcal{C}_j} \sum_{(\hat{q},\hat{y})\in \mathcal{C}_j} \mathrm{sim}(f(\hat{q};\hat{y}), f(q^*;y^*))$ \Comment{Medoid of the $j$-th cluster $\mathcal{C}_j$}
    \State $\hat{\mathcal{Q}} \leftarrow \hat{\mathcal{Q}} \cup \left\{ (\check{q}_j, \check{y}_j) \right\}$
\EndFor

\State \textbf{return} $\hat{\mathcal{Q}}$
\end{algorithmic}
\label{alg:ours}
\end{algorithm*}
