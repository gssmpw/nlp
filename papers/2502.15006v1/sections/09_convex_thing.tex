\newpage
\section{Constraint Satisfaction on the Variational Distribution} \label{app:convex_controls}
One way of guaranteeing that the variational distribution $q(\vu)$ satisfies the constraints $x_k \in \bar{\mathcal{X}} := \mathcal{X} \backslash \mathcal{A}$ is by making the strong (but unrealistic) assumption that the set of controls that satisfy the constraints is a convex set.
Specifically, for generic state constraints $x \in \bar{\mathcal{X}}$, define the set of safe control trajectories $\mathcal{U}^K_{\text{safe}} \subseteq \mathcal{U}^K$ as
\begin{equation}
    \mathcal{U}^K_{\text{safe}}(x_0) = \left\{ \vu \in \mathcal{U}^K \mid x_k \in \bar{\mathcal{X}},~ k =0, 1, \ldots, K \right\}.
\end{equation}
We then have the following lemma.

\begin{lemma}
    Assume $\mathcal{U}^K_{\mathrm{safe}}(x_0)$ is convex for all states $x_0 \in \bar{\mathcal{X}}$,
    and suppose that $p(\vu \mid o=1)$ has zero density outside of $\mathcal{U}^K_{\mathrm{safe}}(x_0)$.
    Then, the mean $\vv^*$ \eqref{eq:vi:omega_def} of the variational distribution $q_{\vv}$ (and the state trajectory resulting from following $\vv^*$) will also satisfy the constraints, i.e.,
    \begin{equation}
        \vv^* \in \mathcal{U}^K_{\mathrm{safe}}(x_0).
    \end{equation}
\end{lemma}

\begin{proof}
    By definition \eqref{eq:vi:v_opt_def}, $\vv^*$ is the mean of the optimal distribution $p(\vu \mid o=1)$.
    Since $p(\vu \mid o=1)$ has zero density outside $\mathcal{U}^K_{\text{safe}}(x_0)$, its support is contained within $\mathcal{U}^K_{\text{safe}}(x_0)$.
    Since $\mathcal{U}^K_{\text{safe}}(x_0)$ is convex, the integral of $\vu$ over $p(\vu \mid o=1)$ will also be contained within $\mathcal{U}^K_{\text{safe}}(x_0)$. Hence, $\vv^* \in \mathcal{U}^K_{\text{safe}}(x_0)$.
\end{proof}