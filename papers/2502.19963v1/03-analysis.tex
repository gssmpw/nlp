\section{An Analysis of Enumeration in OMT}%
\label{sec:analysis}

As described in~\sref{sec:omt-solving}, a basic \omt{} solving schema involves
the interaction of a combinatorial and a theory-specific optimization
components. In the combinatorial component, a \smt{} solver enumerates
\T{}-satisfiable truth assignments that propositionally satisfy the problem
formula $\vi$ conjoined with increasingly tighter bounds on the cost of the
optimum solution. In the theory-specific component, a \T-minimizer finds a
\T{}-model of minimum cost within the constraints imposed by the given truth
assignment. This model is then used to tighten the upper bound for the cost of
the optimum model and continue the search, until the formula is found
unsatisfiable.

Since the enumeration is based on the CDCL(\T) schema~\cite{marques-silvaConflictDrivenClauseLearning2021},
these truth assignments are typically \emph{total}, i.e., they assign a truth value to
each atom of the formula. %In the following example, we illustrate how this can
%
% be suboptimal in many cases, 
% causing an unnecessary increase in the number of
% search iterations.
%
However, we point out that total truth assignments can often over-constrain the search space for the optimum model, whereas relying on \emph{partial} truth assignments can be much more effective. 
Intuitively,
\emph{by removing from the current satisfying truth
    assignment \T{}-constraints that are not strictly necessary for the propositional
    satisfaction of the formula, we enlarge the area within which the optimum model
    is searched, thus increasing the chances of finding a better optimum model.}
%
This means that the solver can add a tighter upper bound
to the cost of the global optimum, potentially reducing the number of search
iterations needed to find it, and consequently the overall solving time.
Moreover, this improvement can be crucial for anytime OMT solving, as it allows
the solver to converge faster to better solutions within the given time limit.
% This concept is similar to the idea of pure-literal filtering (see~\sref{sec:bg:smt}), with the difference that this is performed only once a \T-satisfiable total truth assignment is found, and not only pur

%Following this observation, we investigated how applying
%assignment-reduction techniques to feed the
We illustrate this idea in the following example.
% \T-minimizer with short partial
% models can improve the effectiveness of the \omt{} search.
% by adapting truth-assignment minimization techniques to the \omlarat{} framework.

% \subsection{OMT with partial assignments}%
% \label{sec:approach:linear-search}

\begin{figure}[t]
    \input{figures/partial-assignments/preamble.tex}
    \centering
    \begin{subfigure}{0.33\textwidth}%
        \resizebox{\columnwidth}{!}{\input{figures/partial-assignments/step1.tex}}%
        \caption{Total assignment $\mu$~\eqref{eq:omt-partial-assignments:total-assignment:mu}}%
        \label{fig:omt-partial-assignments:step1}%
    \end{subfigure}%
    \begin{subfigure}{0.33\textwidth}%
        \resizebox{\columnwidth}{!}{\input{figures/partial-assignments/step2.tex}}%
        \caption{Partial assignment $\muprime$~\eqref{eq:omt-partial-assignments:total-assignment:muprime}}%
        \label{fig:omt-partial-assignments:step2}%        
    \end{subfigure}%
    \begin{subfigure}{0.33\textwidth}%
        \resizebox{\columnwidth}{!}{\input{figures/partial-assignments/step3.tex}}
        \caption{Partial assignment $\mupprime$~\eqref{eq:omt-partial-assignments:total-assignment:mupprime}}%
        \label{fig:omt-partial-assignments:step3}%        
    \end{subfigure}%
    \caption{
        Graphical representation of~\Cref{ex:omt-partial-assignments}. For each step, the half-planes representing the constraints in the truth assignment are delimited by dashed lines and colored in grey. The intersection of these constraints is colored in blue, with a gradient that follows the value of $\obj$ (the lower the value of $\obj$, the more intense the color), and the red dot represents the optimum model found within this region.
    }%
    \label{fig:omt-partial-assignments}%
\end{figure}

\begin{example}%
    \label{ex:omt-partial-assignments}
    Consider the \omlarat{} problem \pair{\vi}{\obj} where \vi{} is the formula in~\eqref{eq:smt} in~\Cref{ex:smt}, and $\obj\defas -2x$.
    Consider the following scenario, which is graphically represented in~\Cref{fig:omt-partial-assignments}. Consider the \larat{}-satisfiable total truth assignment that propositionally satisfies $\vi$:
    \begin{equation}%
        \label{eq:omt-partial-assignments:total-assignment:mu}
        \mu\defas\set{(2x-3y\leq 6),(y\leq 2),\neg(x<-2),(y\leq-3x+9),(x\leq 4)}.
    \end{equation} 
    The optimum model of $\mu$ is \set{x\mapsto{}3,y\mapsto{}0} with $\obj=-6$ (\Cref{fig:omt-partial-assignments:step1}). % This cost is then used to tighten the upper bound by adding the constraint $(\obj < -6)$ and continue the search. 
    We notice, however, that, e.g., the constraint $(y\leq-3x+9)$ is not strictly necessary for propositionally satisfying $\vi$, as $\vi$ is satisfied also by:
    \begin{equation}%
        \label{eq:omt-partial-assignments:total-assignment:muprime}
        \muprime\defas\mu\setminus\set{(y\leq-3x+9)}=\set{(2x-3y\leq 6),(y\leq 2),\neg(x<-2),(x\leq 4)}.
    \end{equation}
    %Suppose, instead, that we drop the unnecessary constraint $(y\leq-3x+9)$ from $\mu$. 
    The optimum model of $\muprime$ is \set{x\mapsto{}4,y\mapsto{}2/3} with
    $\obj=-8$ (\Cref{fig:omt-partial-assignments:step2}).
    %
    If we further remove the unnecessary constraint $(x \leq 4)$, then we obtain
    \begin{equation}%
        \label{eq:omt-partial-assignments:total-assignment:mupprime}
        \mupprime\defas\muprime\setminus\set{(x \leq
        4)}=\set{(2x-3y\leq 6),(y\leq 2),\neg(x<-2)}
    \end{equation}
    with optimum model \set{x\mapsto{}6,y\mapsto{}2} and $\obj=-12$ (\Cref{fig:omt-partial-assignments:step3}). Finally, we could remove
    either $\neg(x<-2)$ or $(y\leq 2)$. In the first case, we would obtain a
    partial truth assignment with the same optimum model as $\mupprime$, since the
    constraint does not ``oppose'' to the optimization of $\obj$ in \mupprime. In the second
    case, instead, by removing $(y\leq 2)$ we would obtain an assignment where the value of
    \obj{} is unbounded, and the optimum model has $\obj=-\infty$.
\end{example}

In general, partial truth assignments have an optimum model that is necessarily better or equal to that of the total truth assignments extending them. Since multiple partial truth assignments can be obtained from a total one, the choice of which constraints to drop can be crucial to improve the quality of the optimum model found.