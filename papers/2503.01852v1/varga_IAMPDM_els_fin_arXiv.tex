%% 
%% Copyright 2007-2024 Elsevier Ltd
%% 
%% This file is part of the 'Elsarticle Bundle'.
%% ---------------------------------------------
%% 
%% It may be distributed under the conditions of the LaTeX Project Public
%% License, either version 1.3 of this license or (at your option) any
%% later version.  The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 1999/12/01 or later.
%% 
%% The list of all files belonging to the 'Elsarticle Bundle' is
%% given in the file `manifest.txt'.
%% 
%% Template article for Elsevier's document class `elsarticle'
%% with harvard style bibliographic references

%% \documentclass[preprint,12pt,authoryear]{elsarticle}

%% Use the option review to obtain double line spacing
%% \documentclass[authoryear,preprint,review,12pt]{elsarticle}

%% Use the options 1p,twocolumn; 3p; 3p,twocolumn; 5p; or 5p,twocolumn
%% for a journal layout:
%% \documentclass[final,1p,times,authoryear]{elsarticle}
%% \documentclass[final,1p,times,twocolumn,authoryear]{elsarticle}
\documentclass[final,3p,times,authoryear]{elsarticle}
%% \documentclass[final,3p,times,twocolumn,authoryear]{elsarticle}
%% \documentclass[final,5p,times,authoryear]{elsarticle}
%% \documentclass[final,5p,times,twocolumn,authoryear]{elsarticle}

%% For including figures, graphicx.sty has been loaded in
%% elsarticle.cls. If you prefer to use the old commands
%% please give \usepackage{epsfig}


%% The amssymb package provides various useful mathematical symbols
\usepackage{amssymb}
%% The amsmath package provides various useful equation environments.
\usepackage{amsmath}
\usepackage{siunitx}
%% The amsthm package provides extended theorem environments
%% \usepackage{amsthm}

%% The lineno packages adds line numbers. Start line numbering with
%% \begin{linenumbers}, end it with \end{linenumbers}. Or switch it on
%% for the whole article with \linenumbers.
%% \usepackage{lineno}

\usepackage{pgfplots}
\pgfplotsset{compat=newest}

\usetikzlibrary{
	pgfplots.statistics,
}

%% the following commands are needed for some matlab2tikz features
\usetikzlibrary{plotmarks}
\usetikzlibrary{arrows.meta}
\usepgfplotslibrary{patchplots}
\usepackage{grffile}
\usepackage{tikz}
\usepackage{tikzscale}
\usepackage{placeins}
\usepackage{dblfloatfix}
%\usetikzlibrary{external}
%\tikzexternalize[prefix=figs/fin_images/] % activate!


\usepackage{subcaption} % for subfigures
\usepackage{graphicx} % for including images
\usepackage{caption}    % for captions
\usepackage{subcaption}  % for sub-tables
\usepackage{siunitx}     % for number formatting
\usepackage{float}      % if you decide to use the [H] option



\usepackage{xcolor} % Explicitly load xcolor
\usepackage[colorlinks=true, allcolors=blue]{hyperref}
\usepackage{todonotes}

\usepackage{algorithmic}
\usepackage[linesnumbered,ruled,vlined]{algorithm2e}


%% Balint custom commands
\newcommand{\vek}[1]{{\mathbf #1}}
\newcommand{\p}[1]{\textnormal{#1}}
\newcommand{\op}{\overrightarrow{\p{OP}}}
\newcommand{\m}[1]{\mathrm{#1}}
\newcommand{\sv}[1]{\boldsymbol{#1}}
\newcommand{\rr}[1]{\textcolor{red}{#1}}
\newcommand{\ee}[1]{\todo[inline]{#1}}
\newcommand{\ind}[1]{\mathbb{#1}}
\newcommand{\play}[1]{^{(#1)}}
\newcommand{\Bigplay}[1]{^{\left(#1\right)}}
\newcommand{\Tplay}[1]{^{(#1)T}}
\newcommand{\Invplay}[1]{^{(#1)-1}}
\newcommand{\Splay}[1]{^{*(#1)}}
\newcommand{\ml}[1]{\mathrm{#1}} % to speed up!
\newcommand{\cc}[1]{\citep{#1}}


\journal{Elsevier}

\begin{document}
	
	\begin{frontmatter}
		
		\title{Interaction-Aware Model Predictive Decision-Making for Socially-Compliant Autonomous Driving in Mixed Urban Traffic Scenarios} %% Article title
		
		\author[label0]{Balint Varga} %% Author name
		\affiliation[label0]{
			addressline={balint.varga2@kit.edu},
			organization={Institute of Control Systems, Karlsruhe Institute for Technology},%Department and Organization 
			city={Karlsruhe},
			postcode={D-76131}, 
			country={Germany}}
		
		\author[label1]{Thomas Brand}
		\author[label1]{Marcus Schmitz}
		\affiliation[label1]{
			organization={Wuerzburg Institute for Traffic Sciences GmbH},
			city={Veitshoechheim},
			postcode={D-97209},
			country={Germany}}
		
		\author[label2]{Ehsan Hashemi}
		\affiliation[label2]{
			organization={Faculty of Engineering - Mechanical Engineering Dept, University of Alberta},
			city={Edmonton AB},
			postcode={Ca-T6G 2H5},
			country={Canada}}
		
		
		
		\begin{abstract}
			This paper presents the experimental validation of an interaction-aware model predictive decision-making (IAMPDM) approach in the course of a simulator study. The proposed IAMPDM uses a model of the pedestrian, which simultaneously predicts their future trajectories and characterizes the interaction between the pedestrian and the automated vehicle. The main benefit of the proposed concept and the experiment is that the interaction between the pedestrian and the socially compliant autonomous vehicle leads to smoother traffic. Furthermore, the experiment features a novel human-in-the-decision-loop aspect, meaning that the test subjects have no expected behavior or defined sequence of their actions, better imitating real traffic scenarios. Results show that intention-aware decision-making algorithms are more effective in realistic conditions and contribute to smoother traffic flow than state-of-the-art solutions. Furthermore, the findings emphasize the crucial impact of intention-aware decision-making on autonomous vehicle performance in urban areas and the need for further research. 
		\end{abstract}
		
		
		
		
		\begin{keyword}
			Human-Machine Interaction \sep Human in the Loop \sep Pedestrian Motion Prediction \sep Simulator Experiment \sep Autonomous Vehicles \sep Model Predictive Controller			
		\end{keyword}
		
	\end{frontmatter}

	\section{Introduction}
	Highly automated and autonomous vehicles (AVs) are increasingly becoming a part of our daily lives \cc{ELLIOTT2019109}\cc{2022_FactorsAffectingPedestrians_zhou}. Integrating these systems into society largely depends on the trust of vulnerable road users, such as cyclists and pedestrians, whose safety is essential \cc{2023_IntAware_Merg_Moh}. Incidents involving automated driving functions often make headlines, fostering public skepticism towards these technologies. Consequently, significant research efforts are directed at enhancing automated vehicles with advanced communication channels and decision-making algorithms designed to manage complex scenarios. For example, in urban environments and city centers -- where vehicles move at slower speeds, and pedestrians may cross unexpectedly -- an effective human-machine interaction is critical to fostering trust in these systems. 
	\begin{figure}[t!]
		\centering
		\includegraphics[width=0.75\linewidth]{0f_scenario.jpg}
		\caption{The pedestrian crosses the street at an unsignalised intersection interacting with an autonomous vehicle. With the courtesy of version1 GmbH.}
		\label{fig:scenario_1}
	\end{figure}
	In recent years, advanced algorithms have enabled automated vehicles to interact with pedestrians and cyclists \cc{2018_WhereAreDangerous_hu}, \cc{2020_PedestriansRoadCrossing_razmirad}. The efficiency of these algorithms from the literature is often analyzed either in pure simulation setups \cc{2023_SharedSpaceMultimodal_kampitakis} or in human-in-the-loop tests see e.~g.~\cite{2024_BridgingSystemLimits_brand}. These human-in-the-loop experiments\footnote{Note that the terms \textit{experiment} and \textit{study} are used interchangeably in the course of this paper.} are usually conducted in virtual environments \cc{2020_PedestriansRoadCrossing_razmirad} \cc{2022_CautiousBehaviorsPedestrians_luu}. However, literature-based experiments restrict decision possibilities: the vehicle’s behaviors or the test subjects’ expected reactions are predefined, making the experiment more controlled and analysis more accessible, limiting their application in real-world scenarios. 
	
	Therefore, this work validates an \textit{interaction-aware model predictive decision-making} (IAMPDM) within a simulator experiment using a \textit{human-in-the-decision-loop} setup, where test subjects' reactions are unspecified to replicate real-world scenarios better. Since field studies with actual vehicles can be risky, human-in-the-loop simulations offer a safer alternative, see e.g~\cite{2020_PedestriansRoadCrossing_razmirad}, \cite{2021_ReviewVirtualReality_tran}, \cite{2021_InteractionPedestriansAutomated_bindschadel}~or~\cite{2023_WhoGoesFirst_kalantari}.	This paper provides a \textit{human-in-the-decision-loop} simulator study for the first time with the following contributions:
	\begin{itemize}
		\item Adapting the IAMPDM for the real-time experiments, 
		\item Designing a suitable experimental human-in-the-decision-loop simulator study, and
		\item Conducting the experiment with 25 participants, offering analysis and recommendations for the real-world implementation of the proposed IAMPDM.
	\end{itemize}
	The paper is structured as follows: In Section \ref{sec:state_of_the_art}, the state of the art of intention-aware automated vehicles is presented.
	Section \ref{sec:mpc_algo} presents the concept of the IAMPDM. The simulator setup of the validation and the experimental design are given in Section \ref{sec:experiment}. Section \ref{sec:Results_discussion} provides the results of the experiment and a further discussion about the limitations. Finally, the paper is summarized in Section~\ref{sec:summary}.

	\section{State of the Art} \label{sec:state_of_the_art}
	This section provides a short comprehensive literature review of interaction-aware decision-making algorithms, which became large in recent years, since the topic is getting more and more relevant. Therefore, the following state-of-the-art overview focuses on

	\begin{itemize}
		\item decision-making methods, models and algorithms\footnote{For simplicity, the terms \textit{decision-making methods}, \textit{models}, and \textit{algorithms} will collectively be referred to as \textit{decision-making concepts}.} and
		\item experiments and studies, which can verify and validate these concepts. 
	\end{itemize}
	For more detailed reviews, the reader is referred to \cite{2023_PedestrianBehaviorShared_predhumeau}.
	
	\newpage
	\subsection{Decision-Making Concepts}
	In the literature, decision-making concepts can be categorized into two main groups: model-based and model-free approaches.
	
	\subsubsection{Model-free Approaches}
	Model-free concepts do not utilize physics-based or logic-based models. Instead, they learn optimal behaviors through trial and error by directly interacting with the environment. These methods use environmental feedback to refine decision-making, often employing algorithms such as Q-learning or policy gradient methods. Generally, model-free approaches are well-suited for complex scenarios, such as modeling human behavior. A review on this topic can be found in \cite{2021_SurveyAutonomousVehicle_di}.
	
	In \citet{2021_ReinforcementLearningApproach_russo}, a Reinforcement Learning (RL) approach is presented addressing pedestrian collision avoidance in autonomous driving systems. The focus is on managing unexpected pedestrian crossings and tracking a specific trajectory. The Deep Deterministic Policy Gradient (DDPG) algorithm is utilized to learn continuous actions. The paper discusses the reward function, agent architecture, and environment model used for training and testing the DDPG-based agent through numerical simulations. Similar, data-based concepts are presented in \citet{2014_PedMidBlock_JTTE}, \citet{2021_MotionPlanningAutonomous_rezaee}, \citet{2022_ModelingInteractionsAutonomous_trumpp} and \citet{2022_EfficientPOMDPBehavior_zhang}. 
	
	However, the main drawbacks of these model-free concepts are that they cannot easily ensure safety or guarantee the reliability needed in high-risk environments, such as AV-pedestrian interactions. This limitation means that pure learning-based systems are not mature enough to be safely used in real traffic situations. It is to be expected that model-free decision-making approaches will become easier to validate and verify for traffic admission, for which one typical method is the combination of model-free and model-based elements as discussed in \citet{2022_ReviewPedestrianTrajectory_korbmacher} or \citet{derajic2024learning}.
	
	\subsubsection{Model-based Approaches}
	On the other hand, model-based concepts utilize mathematical models to describe AV-pedestrian interactions using logical or physical principles. These methods rely on this predefined model to predict future states and make decisions. Furthermore, they can handle constraints and uncertainties in the system-design phase, leading to improved safety and reliability. More detailed overviews of model-based methods can be found in \citet{2021_PedestrianModelsAutonomous_camara}, \citet{2021_SurveyMotionPrediction_gulzar} or \citet{2023_PedestrianBehaviorShared_predhumeau}. 
	
	In \citet{2022_DriverPedestrianPerceptualModels_domeyer}, a perceptual model is established based on the geometrical relations between drivers and pedestrians, emphasizing the implications for vehicle automation. It explores the coupling of driver and pedestrian. However, only a simulation analysis is provided, with no strong indications for real-world usage. Game theoretical models are presented in \citet{2015_NoncooperativeDynamicGame_cheng}, \citet{2020_AnalysisGameTheorybased_skugor} and \citet{2022_GameTheoryBasedModeling_pavelko}. In these works, the interaction between the pedestrian and vehicle is modeled as a game with two players who optimize their own objective functions by their joint actions. These models can model the interaction between the two players, but they are not suitable to predict their future joint actions.
	
	On the other hand, in \citet{2023_InteractionAwareDecisionMaking_chen}, a model predictive control (MPC) formulation is proposed, which can predict the future behavior of the pedestrian. In \citet{2023_StochasticModelPredictive_skugor}, the model predictive formulation is extended with a stochastic component, providing a more realistic overall behavior of the proposed algorithm. 
	
	However, these concepts often have a high computational complexity, therefore they are often not suitable for real-time application on a state-of-the-art automotive hardware.
	
	\subsection{Validation of Decision-Making Concepts}
	Since the main contribution of the work is the experimental study with a human-in-the-decision-loop character, the aftercoming part of the overview focuses on pedestrian-autonomous vehicle experiments from the literature. Reviews on the virtual reality studies of pedestrian-automated vehicle interaction can be found in \citet{2021_ReviewVirtualReality_tran} \citet{2022_FactorsAffectingPedestrians_zhou}.
	
	The two main focuses in the literature are the impact of the external human-machine interface (eHMI) on trust and safety. For instance, in \citet{2021_ComparingStateoftheArtEmerging_prattico}, various eHMI concepts are compared, and the influence of the eHMI on the test subjects' trust is investigated. Similarly, in \citet{2023_EffectEHMIPedestrian_feng}, the impact of eHMI on pedestrian behavior at road crossings is analyzed in a virtual reality setting. The variation of the communication strategies of the automated vehicle is analyzed in \citet{2019_HowShouldAutomated_locken}. The authors proposed five groups for the different communication categories, which are implemented and tested in a virtual reality setup. The results showed that the higher the complexity, the more the test subjects trusted the technical system. 
	
	The study in \citet{2024_InterpretingPedestriansHead_yang} focuses on how pedestrians' head movements should be interpreted in the presence of automated vehicles at a virtual crossroad, offering insights into non-verbal cues and communication patterns in pedestrian-vehicle interaction for enhanced safety. However, the test subjects in this study are not in the decision loop, which means that the interaction between humans and automation has a negligible effect on the study results.
	
	Thus, the works from the state of the art provide a wide range of experiments and investigations, however, none of these focus on the effect of various decision-making algorithms on the preference of the pedestrians.  
	
	\subsection{Shortcoming of the State-of-the-Art Methods}
	The decision-making and control algorithms from the state of the art have shortcomings that 1) they are either too complex for real-time implementation on general automotive hardware or 2) they are hard to validate in order to pass motor vehicle registration of AVs. 
	
	On the other hand, experimental studies from the literature usually use predefined strategies for autonomous vehicles in the case of human-in-the-loop investigations. However, \textit{human-in-the-decision-making-loop} is an inevitable extension for the further analysis of human factors. This means that the experiments should have no predefined behavior, which can have an impact on the results of the decision-making.
	
	Therefore, our work addresses these challenges and provides an IAMPDM that can run in real time. Furthermore, this work also provides an investigation having a human-in-the-decision-making-loop character.
		
	\section{Adjustment of the Model Predictive Algorithm} \label{sec:mpc_algo}
	\subsection{Model Description}
	The IAMPDM implements an explicit motion model for the pedestrians' motion. This is necessary to make the decision-making algorithm of the AV more suitable for city-center traffic scenarios with low driving speeds. The core idea of this IAMPDM is presented in \citet{2023_CooperativeDecisionMakingShared_varga} that we used for our implementation; and we validated the model using the data from \citet{2019_IV_Yang}.
	
	The proposed model uses a sigmoid function based on the time-to-collision (TTC) values to model the probability of the pedestrian's velocity changes. In the following, a detailed and more computationally efficient formulation is given. For the explicit motion model, it is assumed that the pedestrian's choice of speed at the next time step can be modeled by 
	\begin{equation} \label{eq:model}
		\dot{y}_\mathrm{ped}(t) = \frac{1}{1 + \exp\left(-TTC(t)+c\right)} \cdot  v_\mathrm{ped}^\mathrm{ref},
	\end{equation} 
	where c is a parameter that can be used to adjust the pedestrian's characteristics, such as cautious or aggressive behavior. The $TTC$ is the time to collision and is computed by
	\begin{equation}
		TTC(t) = \frac{x_\mathrm{ped}(t) - x_\mathrm{veh}(t)}{v_\mathrm{veh}(t)} - 
		\frac{y_\mathrm{veh}(t) - y_\mathrm{ped}(t)}{v_\mathrm{ped}^\mathrm{ref}}.
	\end{equation}
	The output function of \eqref{eq:model} is a general sigmoid function and ranges between 0 and 1, which can be treated as the probability of the pedestrian crossing. The greater the $TTC$ value, the more likely it is that the pedestrian would choose to cross at a reference speed. Therefore, only a reference speed of the pedestrian $v_\mathrm{ped}^\mathrm{ref}$ needs to be identified for the model. This model allows for real-time \textit{prediction} of pedestrian motion and model-based \textit{interaction} between the pedestrian and automated vehicle, making it simultaneously suitable for practical applications. 
		
	The validity of \eqref{eq:model} can be supported by the research of \citet{2020_pedPattern} and \cite{2021_Ped_Walking_Speed}, which propose also velocity-based models for pedestrian-vehicle interactions. The main benefit of the proposed model is that the decision layer is integrated into to control layer, thus the MPC can solve the trajectory planning and decision making tasks in one step.
		
	Gap distance model (see e.g.~\cc{2024_DconstrHuman_tian}) inherently assumes that the pedestrian’s decision-making is based on the current gap value and assessing the safety without considering how that gap might change in the future. On the other hand, \eqref{eq:model} modulates the interaction dynamics between pedestrian and vehicle, which evolves over time. It can account for variables such as speed, acceleration, and changing distances in a continuous manner and used for prediction interaction dynamics.
	
	Assuming a linear dynamics of the vehicle\footnote{This assumption is commonly utilized by the application of autonomous vehicles, see e.g.~\citet[Chapter 13]{2017_ModernRoboticsMechanics_lynch}.} and that the pedestrian moves in the $y$ direction, the following discrete dynamic system is obtained:
	\begin{align}\label{eq:explicit_dyn_model_ofMPC} \nonumber
		\underbrace{\begin{bmatrix}
				x_\mathrm{veh}(t+\Delta t) \\
				\dot x_\mathrm{veh}(t+\Delta t)\\
				y_\mathrm{ped}(t+\Delta t) \\
				\dot{y}_\mathrm{ped}(t+\Delta t)
		\end{bmatrix}}_{\sv{x}(t + \Delta t)}
		=
		\underbrace{\begin{bmatrix}
				1 & {\Delta}t & 0 &0   \\
				0 & 1 & 0 & 0  \\
				0 & 0 & 1 & \Delta t  \\
				0 & 0 & 0 & 0
		\end{bmatrix}}_{\vek{A}}
		\underbrace{\begin{bmatrix}
				x_\mathrm{veh}(t) \\
				\dot x_\mathrm{veh}(t) \\
				y_\mathrm{ped}(t) \\
				\dot{y}_\mathrm{ped}(t)
		\end{bmatrix}}_{\sv{x}(t)} \\
		+\underbrace{\begin{bmatrix}
				0.5 \cdot {\Delta}t^{2}\\
				\Delta t \\
				0 \\
				0 
		\end{bmatrix}}_{\vek{B}}  u_\mathrm{veh}(t) + \underbrace{\begin{bmatrix}
				0 \\
				0 \\
				0 \\
				\frac{v_\mathrm{ped}^\mathrm{ref}}{1 + e^{-TTC(t)+c}} 
		\end{bmatrix}}_{\sv{z}(t)}
	\end{align}
	where the desired acceleration of the vehicle ${u_\mathrm{veh}(t)=a_\mathrm{des}}$ is the system input. With the model \eqref{eq:explicit_dyn_model_ofMPC}, the prediction of the future states for $N$ steps is possible using \mbox{the batch formulation~\cite{2017_PredictiveControlLinear_borrelli}}:
	\begin{align*}
		\mathcal{A} =
		\begin{bmatrix}  
			\mathbf{A} \\
			\mathbf{A}^2\\
			\vdots \\
			\mathbf{A}^{N}
		\end{bmatrix} \hspace*{3mm} \mathrm{and} \hspace*{3mm} \mathcal{B} =
		\begin{bmatrix}  
			\mathbf{B} & \mathbf{0} & \ldots & \mathbf{0}\\
			\mathbf{AB} & \mathbf{B} & \ldots & \mathbf{0}\\ 
			\vdots & \ddots & \ddots & \vdots \\
			\mathbf{A}^{N-1}\mathbf{B} & \ldots & \mathbf{AB} & \mathbf{B}
		\end{bmatrix} \hspace*{2mm}
		\mathrm{and} \hspace*{3mm} \mathcal{Z} = 
		\begin{bmatrix}
			\mathbf{1} & \mathbf{0} & \ldots & \mathbf{0}\\
			\mathbf{A} & \mathbf{1} & \ldots & \mathbf{0}\\ 
			\vdots & \ddots & \ddots & \vdots \\
			\mathbf{A}^{N-1} & \ldots & \mathbf{A} & \mathbf{1}
		\end{bmatrix}.
	\end{align*}
	The prediction of the future state and input vectors are
	\begin{equation} \label{eq:pred_x}
		\vek{x}_s = \mathcal{A} \vek{x}_0 + \mathcal{B}\vek{u}_s + \mathcal{Z}\vek{z}_s,
	\end{equation}
	where for the sake of simplicity the index $s$ is used for the vector sequences: $\vek{x}_s = [\vek{x}(t), \: \vek{x}(t + \Delta t) \: \ldots \: \vek{x}(t + \Delta \cdot (N-1) t)]^T $, for the future system states, $\sv{u}_s = [u(t), \: u(t + \Delta t) \: \ldots \: u(t + \Delta \cdot (N-1) t)]^T$ for the optimizing future inputs and $\vek{z}_s = [\vek{z}(t), \: \vek{z}(t + \Delta t) \: \ldots \: \vek{z}(t + \Delta \cdot (N-1) t)]^T $ for the pedestrian future dynamics.
	
	
	\subsection{Cost Function Formulation}
	In order to formulate an MPC, the cost function with three components is defined
	\begin{equation} \label{eq:MPC_explicit_cost}
		J_\mathrm{MPC} = J_\mathrm{com} + J_\mathrm{ref} + J_\mathrm{safe},
	\end{equation}
	where three objectives are formulated: 1) comfort of the vehicle, 2) holding the reference velocity of the vehicle, and 3) safety of interaction between pedestrian and AV. These quadratic cost functions are
	\begin{figure*}[t] 
		\includegraphics[width=0.9\textwidth]{0f_bird_scenario_schematics_2.pdf}%
		\caption{Bird's eye view of the scenario with the relevant distances for decision-making}%
		\label{fig:scenario_representation}
	\end{figure*}
	\begin{subequations} \label{eq:J_of_MPC}
		\begin{align}
			J_\mathrm{com} &= \mathrm{w}_\mathrm{com}\cdot\sv{u}^2_s \\
			J_\mathrm{ref} &= \sv{x}^\mathsf{T}_s(t)\cdot  \mathcal{Q}_\mathrm{ref} \cdot \sv{x}_s(t) \\
			J_\mathrm{safe} &= \mathrm{w}_\mathrm{safe}\cdot \frac{1} { \sv{x}^\mathsf{T}_s(t)\cdot  \mathcal{P}_\mathrm{safe} \cdot \sv{x}_s(t)},
		\end{align}
	\end{subequations}
	where $ \mathrm{w}_\mathrm{com}$ and $\mathrm{w}_\mathrm{safe}$ design parameters. Furthermore, the matrices are
	\begin{align*}
		\mathcal{Q}_\mathrm{ref} &= \ml{diag}\underbrace{\left[\vek{Q}_\mathrm{ref},\vek{Q}_\mathrm{ref},..., \vek{Q}_\mathrm{ref}\right]}_{N \, \ml{times}} \\
		\mathcal{P}_\mathrm{safe}  & = \ml{diag}\underbrace{\left[\vek{P}_\mathrm{ref},\vek{P}_\mathrm{ref},..., \vek{P}_\mathrm{ref}\right]}_{N \, \ml{times}}
	\end{align*}
	in which for the weighting $\vek{Q}_\mathrm{ref}$ and the perturbation $\vek{P}_\mathrm{safe}$ matrices,
	\begin{align*}
		\vek{Q}_\mathrm{ref} &= \ml{diag}\left[0, \mathrm{w}_{\mathrm{ref}_\ml{veh}}, 0, \mathrm{w}_{\mathrm{ref}_\ml{ped}}\right] \, \mathrm{and} \\
		\vek{P}_\mathrm{safe} &= \ml{diag}\left[1, 0, 1, 0\right]
	\end{align*}
	hold. The decision result of the IAMPDM is obtained from the optimization  
	\begin{subequations} \label{eq:MPC_optimization}
		\begin{align}
			\sv{u}_s^* &= \mathrm{arg}\,\mathrm{min}\, J_\mathrm{MPC} \left(\sv{u}_s\right) \\
			\mathrm{s.t.}\; & \hspace*{1cm} \text{\eqref{eq:pred_x}} \\
			&d^2_\mathrm{min} \leq x_\mathrm{veh}^2(t) +  y_\mathrm{ped}^2(t) \\
			&0 \leq \dot x_\mathrm{veh}(t) \leq \dot x^\mathrm{max}_\mathrm{veh}\\
			&a_\mathrm{veh}^\mathrm{min} \leq u(t) \leq a_\mathrm{veh}^\mathrm{max},
		\end{align}
	\end{subequations}
	which computed the target acceleration of the AV. The optimization \eqref{eq:MPC_optimization} is solved by a Python API of CasADi  \cc{Andersson2019}, where the nonlinear programming solver with an interior point optimizer is applied, which can handle both the state (\ref{eq:MPC_optimization}c), (\ref{eq:MPC_optimization}d) and input constraints (\ref{eq:MPC_optimization}e). With these hard constraints, the safety of the IAMPDM can be formally ensured by strictly enforcing operational boundaries.
	
	\subsection{Integrating Intention Modeling}
	The \textit{intention} of the pedestrian to cross the street is derived from their non-verbal communication, which includes eye contact, gestures, and body posture. These \textit{explicit communication signals} are referred to as \textit{intention}. Pedestrians use these cues similarly when interacting with human-driven vehicles: They give way with hand gestures or signal their right of way by looking at the human driver. These explicit communication signals can be determined by machine-learning-based/data-driven detection systems (see e.g.~\citet{2022_CrossingNotContextBased_yang}) and should be taken into account to extend the MPC for the decision-making. Therefore, the crossing intention $I_\mathrm{ped}(t)$ of the pedestrian is introduced as a function of time and pedestrian behavior, which can vary between $0$ and $1$, which can be used for predicting the actions of the pedestrian. Note that the aim of this paper is not the development of such intention-detection algorithms. It is assumed for this work that they are given since intention-detection algorithms can be found in the literature \cc{2021_PedestrianIntentionPrediction_razali}, \cc{2022_MultiModalHybridArchitecture_rasouli}, \cc{2023_LocalGlobalContextual_azarmi}, \cc{2024_PedestrianCrossingIntention_zhou}.
	To integrate the pedestrian's crossing intention into the MPC formulation, the following two extensions are implemented: 
	\begin{itemize}
		\item[a)] If the pedestrian is in the safe or near-zone (see Figure~\ref{fig:scenario_representation}), then the parameter $\ml{w}_\ml{safe}$ of the MPC is modified based on the crossing intention of the pedestrian 
		\item[b)] If the velocity of the pedestrian in the safe or near zone is zero, a discount function for the intention is introduced. 
	\end{itemize}
	The core idea is to use the modified parameters $\ml{w}^*_\ml{safe}$ and $d^*_\mathrm{min}$ in $J_\mathrm{safe}$ by introducing
	\begin{equation} \label{eq:gain_update_based_on_intentio_w}
		\ml{w}^*_\ml{safe} =
		\begin{cases}
			\ml{w}_\ml{safe} \cdot I_\mathrm{ped}(t) & \; \text{if pedestrian is not in CZ} \\
			\ml{w}_\ml{safe} & \; \ml{else}
		\end{cases}
	\end{equation}
	and 
	\begin{equation} \label{eq:gain_update_based_on_intentio_d}
		d^*_\mathrm{min} = 
		\begin{cases}
			d_\mathrm{min} \cdot I_\mathrm{ped}(t) & \; \text{if pedestrian is not in CZ} \\
			d_\mathrm{min} & \; \ml{else}.
		\end{cases}
	\end{equation}	
	Thus, an IAMPDM is derived, which includes explicit communication elements. This extension introduces a new aspect that hasn't been applied in state-of-the-art research yet.  
	
	However, these elements can sometimes be contradictory, leading to a traffic standstill. Pedestrians often move quickly in the safe zone and slow down in the near zone. They may sometimes wait in the near zone even if they have the right of way or can cross. In such cases, an automated vehicle would stop and wait for the pedestrian\footnote{Considering the critical significance of safety, automated vehicles tend to behave conservatively, leading to more frequent stops.}. This results in neither the pedestrian nor the vehicle moving, causing a deadlock.
	As a solution, a discount function of the intention is proposed motivated by game theoretical applications, see e.g.~\citet{2021_DynamicBargainingTimeConsistency_marin-solano}:
	\begin{equation} \label{eq:discount_intention}
		I^*_\mathrm{ped}(t) = I_\mathrm{ped}(t_0) \cdot 0.9^{K_\mathrm{d}\cdot t},
	\end{equation}
	where $K_\mathrm{d}$ represents a design parameter, and $t_0$ denotes the onset of the interaction between the AV and the pedestrian. Instead of the initial crossing intention of the pedestrian $I_\mathrm{ped}(t_0)$, the discounted value is taken into account.
	
	If either the pedestrian or the vehicle has passed the intersection, no interaction occurs, allowing the vehicle to proceed at its reference speed, which is controlled by a simple velocity-tracking controller.
	
	\begin{algorithm}[t]
		\caption{The IAMPDM Algorithm}
		\textbf{Input:} $ped$, $veh$, $I_\mathrm{ped}(t_0)$\\
		\textbf{Output:} $veh\_acc$\\
		
		\If{$is\_ped\_passed$ or $is\_veh\_passed$}{
			\Return{velocity\_control($ped, veh$)} 
		}
		\Else{
			\If{$is\_discounting\_intention$}{
				use (10)
			}
			\Else{
				use $I_\mathrm{ped}(t_0)$
			}
			
			\eqref{eq:gain_update_based_on_intentio_w} and \eqref{eq:gain_update_based_on_intentio_d}\\
			Update vehicle state \eqref{eq:pred_x} \\
			Update $J_\mathrm{MPC}$ \eqref{eq:J_of_MPC}\\
			$veh\_acc \gets$ Solve \eqref{eq:MPC_optimization}\\
			\Return{$veh\_acc$} 
		}
		
		
	\end{algorithm}
	
	Note that the IAMPDM can be handle also. Managing dense pedestrian traffic is indeed a challenge in pedestrian crossing scenarios. 
	In scenarios with many pedestrians crossing simultaneously, the IAMPDM framework can be adapted by interacting with the closest person. Another solution, is that the person with the highest estimated crossing intention is taken into account for the interaction. For both cases, the core working principle of the IAMPDM does not change.
	
	
	
	\section{Experiment with the Interaction-Aware Model Predictive Decision-Making} \label{sec:experiment}
	
	In this section, the experiment and its results are presented. The goal of the experiment is to validate the applicability of the IAMPDM and compare it with 
	\begin{itemize}
		\item a non-interactive algorithm (NIA) being cautious in interactions with pedestrians and
		\item a rule-based decision-making (RBDM) introduced in~\citet{2023_IntentionAwareDecisionMakingMixed_varga}. 
	\end{itemize}
	The independent variable of the study design was the selection of the negotiation algorithm (MPDM, RBDM, NIA).
	Note: The Ethical Commission of WIVW approved the study based on \textit{Code of Ethics at WIVW – Summary for project proposals and articles/papers}.
	
	\subsection{Experimental Simulator Platform}
	The simulator was set up in an $8 \times 4$ meter room to simulate an urban street crossing situation for pedestrians. A screen was placed on one wall of the room, projecting the perspective of a pedestrian. This dynamic view corresponded to that of a pedestrian looking perpendicularly along the street in the crossing direction, see Figure~\ref{fig:proposed_architecture}. To precisely capture the pedestrian's position, Vive Trackers were used, with the projected view changing according to the position of the test subjects. 
	The main advantage of this configuration lies in avoiding the motion sickness of a virtual reality system, enabling longer usage and accurately representing natural crossing behavior. 
	In contrast, using a VR headset could cause simulator sickness, and the lack of visual representations of body parts in the virtual environment might lead to unnatural movement behavior. Therefore, we decided against a VR experiment based on these considerations and the advice of the ethical commission. of WIVW.
	
	The experimental setup includes 
	\begin{itemize}
		\item[1] A simulation computer with SILAB$^\circledR$\footnote{SILAB is a software product of WIVW - W\"urzburg Institute for Traffic Sciences GmbH (\url{www.wivw.de}).} software framework,
		\item[2] A short-distance projector to display the scenario with the automated vehicle,
		\item[3] A body sensor to track the position and velocity of the test subjects and
		\item[4] An input joystick for detecting the crossing intention of the test subjects.
	\end{itemize}
	The advantage of using a joystick as input for the crossing intention helps to overcome the errors of computer vision algorithms that would be necessary to recognize the crossing intention of the pedestrian. Since this work does not attempt to validate such detection algorithms, the use of the joystick is a reasonable solution. Therefore, the experiment is even more rigorous in its objective of comparing different decision-making algorithms in a closed-loop manner.
	
	
	\begin{figure}[!t]
		\centering
		\includegraphics[width=0.75\linewidth]{f0_simulator_setup_anoym.jpg}
		\caption{The simulator setup. Note that the light was turned off during the experiments, and the room was completely dark.}
		\label{fig:proposed_architecture}
	\end{figure}
	
	\subsection{The Setups of the Decision-Making Algorithms}
	The critical design parameters of the IAMPDM are shown in Table \ref{table:parameters}. These parameters facilitate the implementation of either a more aggressive or a more conservative/cautious behavior of the AV.
	\begin{table}[t!]
		\centering
		\begin{tabular}{|c|c|}
			\hline
			Parameter & Impact of the parameter on \\
			\hline
			\hline
			$\mathrm{w}_\mathrm{safe}$ & Stopping distance\\	
			$\mathrm{w}_\mathrm{com}$ &  Deceleration rate\\
			$\mathrm{w}_{\mathrm{ref}_\ml{ped}}$&  Deceleration rate\\
			$\mathrm{w}_{\mathrm{ref}_\ml{veh}}$&  Velocity profiles\\
			$K_\ml{d}$  & Waiting time  \\
			\hline
		\end{tabular}
		\caption{The most critical parameters and their values of the IAMPDM algorithm}
		\label{table:parameters}
	\end{table}
	Instead of a manual tuning of these parameters, it is beneficial to apply an automated, optimization-based tuning framework. However, the usage of such automated tuning frameworks from the literature was not suitable for setting up the IAMPDM since they do not take human subjective preferences into account. The inclusion of human preferences into IAMPDM tuning is one challenging aspect since it helps to enhance public acceptance of such technical systems. 
	
	An automated tuning framework for pedestrian-AV interaction is presented in~\citet{2023_IntentionAwareDecisionMakingMixed_varga}, which utilizes the optimization
	\begin{subequations} \label{eq:Parameter_optimization}
		\begin{align}
			\sv{\theta}^* &= \mathrm{arg}\,\mathrm{min}\, J_\mathrm{glob} \\
			\mathrm{s.t.}\; & \eqref{eq:MPC_optimization}
		\end{align}
	\end{subequations}
	to find the optimal parameter vector $\sv{\theta}$ of an intention-aware decision-making. The global cost function has the form
	\begin{align} \label{eq:f_PSO} \nonumber
		J_\mathrm{glob} = \int_{t_0}^{T_\mathrm{end}}
		k_1 \cdot t + k_2 \cdot \left|a^2_\mathrm{max,veh}(t)\right| 
		- k_3 \cdot \left|d_\mathrm{min}\right| + k_4 \cdot \frac{1}{TTC(t)} \,\mathrm{d}t, 	
	\end{align}
	from which the optimal parameters of the intention-aware decision-making are obtained. In previous works, the parameters $k_i, i = \{1,2,3,4\}$ were determined based on optimization goals, such as acceleration profiles and stopping distances. These selections, however, do not account for human preferences. Therefore, for this work, we suggest a semi-automated expert design process to systematically tune the parameters $k_i$. The proposed semi-automated expert design of the IAMPDM has the following steps:
	\begin{algorithm}[t]
		\caption{The algorithm of the iterative design of the intention-aware decision-making including human preferences}\label{alg:IAA}
		\KwIn{$k_i,  i = \{1,2,3,4\}$}
		\KwOut{$\sv{\theta}^*$}
		
		\While{Overaall result not satisfactory}{
			Setting $k_i,  i = \{1,2,3,4\}$\\			
			Run \eqref{eq:Parameter_optimization} with $J_\ml{glob}$\\
			Testing the decision-making\\	
		}
	\end{algorithm}
	
	Through this iterative design, we can obtain the optimal parameters for IAMPDM integrating human preferences. By including these preferences, we achieve more human-centered optimization results. This human-centered optimization is beneficial because it requires tuning only a few parameters, no matter the algorithm's complexity, since the parameter vector of IAMPDM consists of 
	$$
	\sv{\theta}=\left[\mathrm{w}_\mathrm{safe}, \mathrm{w}_\mathrm{com}, \mathrm{w}_{\mathrm{ref}_\ml{ped}}, \mathrm{w}_{\mathrm{ref}_\ml{veh}}, d_\mathrm{min}, K_\ml{d}, x^\mathrm{max}_\mathrm{veh}, a_\mathrm{veh}^\mathrm{min}, a_\mathrm{veh}^\mathrm{max}\right]
	$$
	that can be difficult to tune manually. Moreover, $k_i, i = {1,2,3,4}$ always preserves their physical meaning, leading to time-efficient human-centered optimization. 
	
	The RBDM is also tuned with Algorithm \ref{alg:IAA}; the only difference is that the RBDM has fewer parameters. 
	
	To mitigate the risk of injury in urban areas, the non-interactive algorithm assumes that pedestrians near the street edge may cross unpredictably at any time. As a result, the vehicle halts and waits for a duration of $t_\ml{NIA}$, disregarding pedestrian crossing intentions since it assumes the absence of high-level communication detection. If the pedestrian does not cross, the vehicle starts moving again cautiously after $t_\ml{NIA}$, in accordance with the IAMPDM discount function, which leads to similar wait times.
	
	
	\subsection{Experiment Design}
	The three different decision-making algorithms were marked with different colors during the experiment, meaning that they were not revealed to the test subjects. As a result, distinguishing was simplified without using numbers, resulting in fewer matching errors by the test subjects.
	
	Since existing research does not address the \textit{human-in-the-decision-loop} nature of pedestrian-AV interactions in unsignalised crossings, a key challenge was to instruct test subjects in a way that 1) facilitates interaction but 2) does not result in a fixed sequence of human actions that entirely predetermines their behavior. This balance is challenging, as too much freedom leads to high variability, whereas fully predefined behavior compromises the evaluation of the IAMPDM. Forcing the interaction may result in unrealistic scenarios and misleading results.
	
	This challenge was addressed by instructing the test subjects to mimic altering their decisions: They started to cross the street, but they waited on the roadside. Therefore, we defined four \textit{scenarios}, which describe approximately how the test subjects should behave, but no fixed sequence of human actions is defined, no, crossing time and distance specifications for specific actions are given in advance. The detailed instructions are given in the Appendix. These \textit{scenarios} are
	\begin{itemize}
		\item[1] \textit{Crossing} before the vehicle
		\item[2] \textit{Remaining} and letting the vehicle to cross first  
		\item[3] \textit{Delayed Crossing} before the vehicle
		\item[4] \textit{Delayed Remaining} and letting the vehicle to cross first.
	\end{itemize}
	
	The experimental procedure was organized as follows: Test subjects started with scenarios 1 and 2, performed in a randomized order. Each scenario involved three crossings using each of the three decision-making algorithms, leading to 9 crossings per scenario. After completing both scenarios, they filled out an \textit{intermediate questionnaire} to assess the algorithms. This questionnaire was crucial for shaping the test subjects' perspectives for the final evaluation.
	
	Afterward, the test subjects repeated the procedure with scenarios 3~and~4 in a randomized sequence. They tested all the decision-making algorithms and filled out the \textit{intermediate questionnaire} again. Finally, they had to answer the \textit{final questions}, which are used for subjective assessment of the algorithms. Since scenarios 3 and 4 are the most crucial and involve contradictory interactions with the AV, only these were used for objective assessment.
	
	
	\subsection{Objective Goals and Evaluation Criteria}
	In the following, our null and working hypotheses are presented, and the measures of the experiment are discussed. 
	
	The investigation included two hypotheses focusing on objective and subjective measures. For the objective assessment, we have the following null and working hypotheses:
	\begin{itemize}
		\item[H1$_0$] The use of intention-aware decision-making in autonomous vehicles significantly does not alter the crossing times and the criticality of intersection scenarios.
		\item[H1$_w$] The use of intention-aware decision-making in autonomous vehicles significantly shortens crossing times and elevates the criticality of intersection scenarios.
	\end{itemize}
	The subjective assessment is based on the following null and alternative hypotheses:
	\begin{itemize}
		\item[H2$_0$] The usage of intention-aware decision-making does not lead to a higher user preference in the intersection scenarios.
		\item[H2$_w$] The usage of intention-aware decision-making leads to a higher user preference in the intersection scenarios.
	\end{itemize}
	To measure our hypotheses, we used three evaluation metrics defined in~\citet{2023_CriticalityMetricsAutomated_westhofen}: 
	\begin{itemize}
		\item The average Time-to-Collision ($TTC_\ml{avg}$). $TTC(t)$ is computed such as
		\begin{equation}
			TTC(t) = \frac{y_\ml{ped}(t) + x_\ml{veh}(t)}{\ml{max}(v_\ml{veh}(t),\kappa)},
		\end{equation}
		where $\kappa = 0.05$ in order to ensure the numerical stability, in cases of the pedestrian or the vehicle ar at a standstill. From that the average $TTC_\ml{avg}$ is calculated by
		\begin{equation}
			TTC_\ml{avg} = \frac{1}{N} \int_{t_0}^{T_\ml{end}} TTC(t) \, \text{d}t. 
		\end{equation}
		\item Average Deceleration to Safety Time (DST) 
		\begin{equation}
			DST(t) = \frac{1}{2}\frac{v^2_\ml{ped}(t) + v^2_\ml{veh}(t)}{x_\ml{veh}(t) + y_\ml{ped}(t) + v_\ml{veh}(t)\cdot t_\ml{safe}},
		\end{equation}
		where the safety time is $t_\ml{safe}=1$. The average $DST_\ml{avg}$ is calculated by
		\begin{equation}
			DST_\ml{avg} = \frac{1}{N} \int_{t_0}^{T_\ml{end}} DST(t) \, \text{d}t. 
		\end{equation}
		\item The completion time of the scenario ($T_\ml{end}$), defined as the time after the vehicle or pedestrian has left the collision zone.
	\end{itemize}
	Besides these objective metrics, the test subjects had to assess the decision-making algorithm in the \textit{final questions} to obtain their subject impressions. These are
	\subsubsection*{Question 1:} \textit{Which decision-making did you find overall to be the most appropriate concerning the experienced situations?}
	
	\subsubsection*{Question 2:} \textit{Please now evaluate the decision-making algorithms based on your experiences in all the situations: Can you imagine a red/green/blue vehicle with this decision-making algorithm operating in real traffic?}\\
	\textit{What do you think of red/green/blue decision-making in general?}
	
	The possible answers are given in Table \ref{tab:answer_table}.
	\begin{table}[!h]
		\centering
		\begin{tabular}{|*{6}{@{\hspace{4pt}}c@{\hspace{4pt}}|}} %\begin{tabular}{|c|c|c|c|c|c|}
			\hline
			\begin{tabular}{@{}c@{}}not \\ at all\end{tabular} & \begin{tabular}{@{}c@{}}very \\ little\end{tabular} & little & medium & strong & \begin{tabular}{@{}c@{}}very \\ strong\end{tabular}  \\
			\hline
			0&1,2,3 &4,5,6 &7,8,9 &10,11,12 &13,14,15 \\
			\hline
		\end{tabular}
		\caption{Answer Table for the test-subjects}
		\label{tab:answer_table}
	\end{table}
	
	Note hypothesis H1 is evaluated by the objective metrics $TTC$, $DST$ and $T_\ml{end}$. For the assessment of hypothesis H2 the final questions are used.
	
	
	\section{Results and Discussion} \label{sec:Results_discussion}
	This section presents the results of our experiment and provides an in-depth discussion. Please note that the \textit{Delayed Crossing} and \textit{Delayed Remaining} scenarios cause different overall behaviors in the pedestrian and the automated vehicle, making it necessary to assess them separately. For both objective and subjective results, the outliers are removed using the inter-quartile range method, see~e.g.~\citet{2023_OutliersDetectionElimination_dash}.
	\subsection{Objective Results}
	The resulting average values of the measures $TTC_\ml{avg}$, $DST_\ml{avg}$ and $T_\ml{end}$ with their standard deviations are presented in Table~\ref{tab:res_crossing} for the \textit{Delayed Crossing} case and in Table~\ref{tab:res_remaining} for the \textit{Delayed Remaining} case. Furthermore, Figure~\ref{fig:box_plots_delayed_crossing} and Figure~\ref{fig:box_plots_delayed_no_crossing} show the box plots of the objective results.	
	
	It can be seen that the NIA has the largest $T_\ml{end}$ for both scenarios. On the other hand, the IAMPDM and RBDM have comparable shorter crossing times. This means that negotiations between a pedestrian and an AV took shorter, indicating that using intention-aware decision-making algorithms can lead to smoother traffic.
	
	On the other hand, the criticality metrics (DST and TTC) show that the scenarios became more critical: The TTC was smaller for both IAMPDM and RBDM compared to NIA. Furthermore, the DST values were smaller if the NIA was used\footnote{Note that the smaller the DST, the less critical the scenario. On the other hand, larger TTC values mean safer (less critical) scenarios.}. 
	
	To assess whether these differences between the decision-making algorithms are statistically significant, statistical tests are performed. First, the Kruskal-Wallis test is utilized for evaluating H1, because all three samples are compared, see e.g.~\citet{2008_IntroductoryStatistics_dalgaard}.
	The degrees of freedom of this test are $df=2$, and the significance level is chosen to $\alpha=0.01.$ Its null hypothesis is that there is no difference between the three decision-making algorithms. This hypothesis is declined if $\mathcal{H} \geq \mathcal{X}_{df,\alpha}^2$ holds, where $\mathcal{X}^2_{df=2,\alpha=0.01} = 9.21$.
	
	\input{res_table_v2crossing.tex}
	\input{res_table_v2not_crossing.tex}
	In case of \textit{Delayed Crossing}, the following $\mathcal{H}$ values are obtained
	\begin{align*}
		\mathcal{H}_{Crs_{T_\ml{end}}} &= 16.64 \\
		\mathcal{H}_{Crs_{DST}} &=  6.82\\
		\mathcal{H}_{Crs_{TTC}} &= 22.42.\\
	\end{align*}
	Since $\mathcal{H}_i \geq \mathcal{X}_{df,\alpha}^2$ hold for $i = \{Crs_{T_\ml{end}, Crs_{TTC}}\}$, we can reject the null hypothesis H1$_0$ for the \textit{Delayed Crossing} scenarios that the average $T_\ml{end}$ and $TTC$ are same for all three decision-making. This indicates that the choice of the decision-making algorithms leads to statistically significant differences in $T_\ml{end}$ and $TTC$. On the other hand, $\mathcal{H}_i \geq \mathcal{X}_{df,\alpha}^2$ does not hold for $i = Crs_{DST}$ meaning the we cannot reject the null hypothesis of H1 in case of $DST$. In case of \textit{Delayed Remaining}, the following $\mathcal{H}$ values are obtained
	\begin{align*}
		\mathcal{H}_{Rem_{T_\ml{end}}} &= 32.44\\
		\mathcal{H}_{Rem_{DST}} &=9.91 \\
		\mathcal{H}_{Rem_{TTC}} &= 30.09\\
	\end{align*}
	Since $\mathcal{H}_i \geq \mathcal{X}^2_{df,\alpha}$ is satisfied for  {$i = \{Rem_{T_\ml{end}}, Rem_{DST}, Rem_{TTC}\}$}, we can conclude that the choice of decision-making algorithms has statistically significant effects on $T_\ml{end}$, $DST$ and $TTC$. \mbox{In addition,} Mann–Whitney–Wilcoxon tests are carried out to compare IAMPDM and RBDM. As it can be seen from Table~\ref{tab:p_mpc_rb}, aside from $TCC$ in \textit{Delayed Remaining} case, there is no statistical difference between IAMPDM and RBDM. %Note that H\rr{FINISH} equvivlance test
		
		
\begin{figure}[t!]
	\centering
	\begin{tabular}{ccc}
		% First Image
		\begin{minipage}{0.32\textwidth}
			\centering
			\includegraphics[width=\textwidth]{0f_instruction_crossing_crossing_time.pdf} % Replace with your image path
			\caption*{(a) Average crossing times}
			\label{fig:sub1} % Label for the first minipage
		\end{minipage}
		&
		% Second Image
		\begin{minipage}{0.32\textwidth}
			\centering
			\includegraphics[width=\textwidth]{0f_instruction_crossing_avg_DST.pdf} % Replace with your image path
			\caption*{(b) Average DSTs}
			\label{fig:sub2} % Label for the second minipage
		\end{minipage}
		&
		% Third Image
		\begin{minipage}{0.32\textwidth}
			\centering
			\includegraphics[width=\textwidth]{0f_instruction_crossing_avg_TTC.pdf} % Replace with your image path
			\caption*{(c) Average TTCs for \textit{Delayed Crossing}}
			\label{fig:sub3} % Label for the third minipage
		\end{minipage}
	\end{tabular}
	
	% Main caption
	\caption{Results in case of \textit{Delayed Crossing}}
	\label{fig:box_plots_delayed_crossing}
\end{figure}		

	\begin{figure}[t!]
	\centering
	\begin{tabular}{ccc}
		% First Image
		\begin{minipage}{0.32\textwidth}
			\centering
			\includegraphics[width=\textwidth]{0f_instruction_not_crossing_crossing_time.pdf} % Updated file path
			\caption*{(a) Average crossing times}
			
		\end{minipage}
		&
		% Second Image
		\begin{minipage}{0.32\textwidth}
			\centering
			\includegraphics[width=\textwidth]{0f_instruction_not_crossing_avg_DST.pdf} % Updated file path
			\caption*{(b) Average DSTs}
			
		\end{minipage}
		&
		% Third Image
		\begin{minipage}{0.32\textwidth}
			\centering
			\includegraphics[width=\textwidth]{0f_instruction_not_crossing_avg_TTC.pdf} % Updated file path
			\caption*{(c) Average TTCs for \textit{Delayed Crossing}}
			
		\end{minipage}
	\end{tabular}
	
	% Main caption
	\caption{Results in case of \textit{Delayed Remaining}}
	\label{fig:box_plots_delayed_no_crossing}
\end{figure}

	
\begin{table}[h!]
\centering
\begin{tabular}{|l|c|} 
	\hline
	Parameter & $p$-value \\
	\hline \hline
	$p_\mathrm{Crs_{T_\mathrm{end}}}$ & \num{0.34} \\
	$p_\mathrm{Crs_{DST}}$ & \num{0.45} \\
	$p_\mathrm{Crs_{TTC}}$ & \num{0.51} \\
	\hline \hline
	$p_\mathrm{Rem_{T_\mathrm{end}}}$ & \num{0.73} \\
	$p_\mathrm{Rem_{DST}}$ & \num{0.08} \\
	$p_\mathrm{Rem_{TTC}}$ & \num{9.47e-6} \\
	\hline
\end{tabular}
\captionof{table}{The resulting $p$-values of Mann–Whitney–Wilcoxon tests to compare IAMPDM and RBDM}
\label{tab:p_mpc_rb}
\end{table}


	
\subsection{Subjective Results}
For the testing of H2, the results of the \textit{final questions} are analyzed, for which the test subject Nr. 21 is excluded since the person could not recall which decision-making was which. First, the preferences of the test subject are given in Table \ref{tab:Q1_final_quesitions}. It can be seen that most of the test subjects have chosen intention-aware decision-making. The results of Q2 from the \textit{final questions} are given in Table~\ref{tab:final_question_table}. The raw data of Q2 is included in~\ref{app2}. It can be seen that in the subjective assessment, both RBDM and the IAMPDM possess larger mean values than NIA. The Kruskal-Wallis test is conducted to test the difference for statistical significance. The result is
$$
\mathcal{H}_\ml{Subj} = 14.56,
$$
which indicates that the choice between intention-aware and non-interactive decision-making algorithms leads to statistically significant differences in the preference of the human test subjects. For a comparison between the IAMPDM and RBDM, a Mann–Whitney–Wilcoxon test is carried out, which yields $$p_\ml{Subj}=0.154,$$ indicating that the difference between IAMPDM and RBDM is not significant.
	
\begin{table}[h!]
	\centering
	\begin{tabular}{cc}
		% First Table in a parbox
		\parbox{0.45\textwidth}{
			\centering
			
			\begin{tabular}{|c|c|}
				\hline
				& Preferences \\
				\hline
				NIA & 5 \\
				RBDM & 14 \\
				IAMPDM & 5 \\
				\hline
			\end{tabular}
			\captionof{table}{Preferences of the test subjects based on Q1}
			\label{tab:Q1_final_quesitions}
		}
		&
		% Second Table in a parbox
		\parbox{0.45\textwidth}{
			\centering
			\begin{tabular}{|l|c|}
				\hline
				& \begin{tabular}{c}Final \\ Question Score\end{tabular} \\
				\hline
				$\mu_{\mathrm{NIA}}$ & 7.04 \\ 
				$\sigma_{\mathrm{NIA}}$ & 3.629 \\
				\hline
				$\mu_{\mathrm{RBDM}}$ & 11.04 \\ 
				$\sigma_{\mathrm{RBDM}}$ & 3.665 \\
				\hline
				$\mu_{\mathrm{IAMPDM}}$ & 10.00 \\ 
				$\sigma_{\mathrm{IAMPDM}}$ & 2.690 \\
				\hline
			\end{tabular}
		\captionof{table}{Mean values and standard deviations of Q2}
		\label{tab:final_question_table}
			 
		}
	\end{tabular}
\end{table}
	

	\begin{figure}[!t]
		\centering
		\includegraphics[width=0.45\linewidth]{final_question_plot.pdf}
		\caption{Results of the subjective assessment}
		\label{fig:final_question_plot}
	\end{figure}
	
	\subsection{Discussion and Limitations}
	One of the limitations of our experimental setup lies in the assumption of perfect crossing intention detection via joystick input. While this simplified approach enabled controlled testing, real-world intention recognition involves inherent uncertainties due to sensor noise, occlusions, and ambiguous pedestrian behavior.
	

	It is necessary to highlight that higher TTC values are associated with more natural driving behavior of the AV. This preference is reflected in the test subjects choosing the RBDM and IAMPDM over the more conservative NIA algorithm. Additionally, the test subjects provided insights into the general question \textit{What do you think of red/green/blue decision-making in general?}, which enhanced our understanding of the proposed algorithms. From the study results, we can draw interesting conclusions. A closer examination of the objective results reveals that the intention-aware decision-making algorithms consistently outperform the NIA in all aspects. However, there is no significant difference between IAMPDM and RB, except in the average TTCs concerning \textit{Delayed Remaining} (see Table~\ref{tab:p_mpc_rb}). 
	Additionally, we observed sporadic instances of extremely high crossing times for IAMPDM in Figure~\ref{fig:box_plots_delayed_no_crossing}(a). These outliers primarily occurred when pedestrians hesitated mid-crossing, triggering repeated velocity adjustments of the AV. This reactive behavior suggests the need for better anticipation of pedestrian motion variability during the prediction.

	 
	For the other cases and measures, no significant differences between IAMPDM and RB were observed in this study. These results suggest that a simple algorithm can achieve outcomes comparable to more complex methods in \textit{simple} urban traffic scenarios. This implies that distinguishing between \textit{simple scenarios} and \textit{complex scenarios} is necessary for the development and validation of interaction-aware algorithms for autonomous vehicles. A \textit{simple scenario} is defined as dyadic interactions with single pedestrians in controlled crossing situations, characterized by predictable trajectories, as in our experiment setup. \textit{Complex scenarios} involve multiple interacting agents, mixed traffic modes, and ambiguous navigation goals. This distinction is crucial because while rule-based systems suffice for simple cases, complex scenarios demand the adaptive reasoning capabilities of model-based approaches like IAMPDM. The model \eqref{eq:model} is also designed for more complex scenarios. It can extend to situations with multiple interacting agents. This flexibility can make it more applicable to a broader range of pedestrian-vehicle interactions, including those involving dynamic or unpredictable behaviors.
	
	
	Moreover, the subjective results offer interesting insights from the human-in-the-decision-loop experiment. The test subjects, who preferred the NIA, indicated that a more conservative approach could increase safety and be more favored by pedestrians. They had the comment such
	\begin{itemize}
		\item ``\textit{Too passive and slow for my taste, but that's not wrong in normal traffic. Then misunderstandings are not so tragic.}'' 
		\item ``\textit{As a pedestrian, I had the feeling that it [the vehicle] looked out for me in every situation and always gave me the opportunity to cross the road. Overall, I felt safest with [NIA].}''
		\item ``\textit{Decision-making for the pedestrians pleasant.}''
	\end{itemize}
	Most of the test subjects liked the RBDM more and criticized the long waiting time of the NIA. 
	An interesting result is that the RBDM leads to better subjective results compared to IAMPDM: Most of the test subjects preferred RBDM over the IAMPDM, see Table~\ref{tab:Q1_final_quesitions}. However, there is no significant difference in the objective results; see Table~\ref{tab:final_question_table}. Furthermore, most of them were not able not distinguish between RBDM and IAMPDM. 
	They left comments like 
	\begin{itemize}
		\item ``\textit{I found hard to the difference between [RBDM] and [IAMPDM], but [RBDM] seemed a bit more thoughtful. Reacted better and more appropriately than [IAMPDM].}''
		\item ``\textit{[In case of IAMPDM:] To [RBDM] no difference detectable}''
		\item ``\textit{[In case of RBDM:] no big difference to [IAMPDM]}''
	\end{itemize}
	The reason for this result is the tuning framework, since the human factors component was tuned for both RBDM and IAMPDM in a similar manner, consequently, the subjective results were also similar. Some general comments were that the test subjects were not sure whether the vehicle recognized them or not. To overcome this, implementing a human-machine interface (HMI) for a vehicle to communicate with pedestrians could significantly enhance trust. When a pedestrian sees a clear signal from the vehicle indicating it has detected them, it reduces uncertainty and potential accidents. 
	
	
	The findings suggest that simply increasing the complexity of intention-aware decision-making algorithms does not necessarily lead to better performance or greater pedestrian preference. Additionally, the conditions under which these more complex and reliable model-based decision-making algorithms can achieve a safe scenario need to be validated in further studies.
	
	\section{Summary} \label{sec:summary}
	
	This paper proposes an interaction-aware model predictive decision-making system and its real-time implementation for automated vehicles interacting with pedestrians in urban, low-speed scenarios. Furthermore, we designed a human-in-the-decision-loop study to examine the human-automation action-reaction cycle. 
	The human-in-the-decision-loop study, conducted with 25 participants, demonstrated that intention-aware decision-making algorithms lead to faster resolution of human-automation negotiations and improved subjective evaluations. These findings highlight the significance of intention-aware decision-making for autonomous vehicles in urban settings.
	Our future work will feature an adaptive decision-making algorithm based on~\citet{2024_AdaptiveCooperationModelBased_varga}. Furthermore, we plan to integrate a probabilistic estimation of human crossing intentions by modeling their stochastic behavior, see \citet{2023_StochasticModelPredictive_skugor}.
	
	\section*{CRediT authorship contribution statement}
	\textbf{Balint Varga:} Writing – original draft, Writing – review \& editing, Conceptualization, Formal analysis, Methodology, Software, Visualization, Validation.
	\textbf{Thomas Brand:} Writing – review \& editing, Conceptualization, Data curation, Methodology, Software.
	\textbf{Marcus Schmitz:} Writing – review \& editing, Methodology, Conceptualization.
	\textbf{Ehsan Hashemi:} Writing – review \& editing, Investigation, Conceptualization.
	
	\section*{Acknowledgments}
	This work was supported by the Federal Ministry for Economic Affairs and Climate Action, in the New Vehicle and System Technologies research initiative with Project number 19A21008D.
	
	\section*{Declaration of competing interest}
	The authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper.
	\newpage
	\bibliographystyle{elsarticle-harv} 
	
	\input{varga_IAMPDM_els_fin_arXiv.bbl}
	
	\appendix
	\section{Instruction Materials} \label{app1}
	\subsection*{Crossing}
	“Please proceed to the markings. In this situation, you want to cross the road in front of the vehicle. Behave as you would with a real vehicle and driver. Please only interact with the vehicle when you think the vehicle is aware of you. Remember to press the button when you want to signal that you want to cross the road. Keep the button pressed as long as you want to cross the road in front of the vehicle. Please remember that you should only cross the road if you feel safe, otherwise do not cross the road.
	
	\subsection*{Remain}
	“Please proceed to the markings. In this situation, you only want to cross the road after the vehicle. Behave as you would with a real vehicle and driver. Remember to press the button when you want to signal that you want to cross the road. Keep the button pressed as long as you want to cross the road in front of the vehicle.”
	
	\subsection*{Delayed crossing}
	“Please proceed to the markings. In this situation, you actually want to cross the road after the vehicle. However, you change your mind and spontaneously decide to cross the road before the vehicle. Behave as you would with a real vehicle and driver. Please only interact with the vehicle when you think the vehicle is aware of you. Remember to press the button when you want to signal that you want to cross the road. Keep the button pressed as long as you want to cross the road in front of the vehicle. Please remember that you should only cross the road if you feel safe, otherwise do not cross the road.”
	
	\subsection*{Delayed stay}
	“Please move to the markings. In this situation, you actually want to cross the road in front of the vehicle. However, you change your mind and spontaneously decide to cross the road after the vehicle. Behave as you would with a real vehicle and driver. Remember to press the button when you want to signal that you want to cross the road. Keep the button pressed as long as you want to cross the road in front of the vehicle.”
	\newpage 
	\section{Subjective Results} \label{app2}
	
	\begin{table}[h!]
		\centering
		\begin{tabular}{|c|c|c|c|}
			\hline
			& IAMPDM & RBDM & NIA \\
			\hline
			1  & 8  & 8  & 8  \\
			2  & 1  & 14 & 1  \\
			3  & 11 & 9  & 6  \\
			4  & 11 & 13 & 9  \\
			5  & 9  & 14 & 0  \\
			6  & 10 & 8  & 4  \\
			7  & 7  & 11 & 7  \\
			8  & 6  & 12 & 8  \\
			9  & 14 & 12 & 6  \\
			10 & 9  & 12 & 1  \\
			11 & 7  & 6  & 10 \\
			12 & 14 & 15 & 10 \\
			13 & 12 & 15 & 4  \\
			14 & 9  & 9  & 4  \\
			15 & 10 & 10 & 5  \\
			16 & 11 & 15 & 9  \\
			17 & 9  & 5  & 13 \\
			18 & 10 & 14 & 11 \\
			19 & 10 & 13 & 10 \\
			20 & 4  & 8  & 12 \\
			21 & -& -& -\\
			22 & 11 & 12 & 7  \\
			23 & 15 & 15 & 8  \\
			24 & 13 & 14 & 4  \\
			25 & 1  & 1  & 12 \\
			\hline
		\end{tabular}
		\caption{The subjective assessment for IAMPDM, RBDM, and NIA}
	\end{table}
	
\end{document}

\endinput

%%
%% End of file `elsarticle-template-harv.tex'.


