\For{$n$ \normalfont{in} $Graph$} {
    \If {\normalfont{IsReduction}$(n)$} {
        $fanin, final \gets$ \normalfont{SplitReduction}$(n)$ \\
        $Graph$.\normalfont{replace}$([n], [fanin, final])$ \\
        $n \gets final$
    }
    \If {\normalfont{IsIntermediate}$(n)$} {
        $q \gets$ \normalfont{CreateQueue}$(n)$ \\
        \For{$c$ \normalfont{in} \normalfont{Dependents}$(n)$} {
            $c$.\normalfont{producer} $\gets q$ 
        }
        $n$.\normalfont{dependents} $\gets [q]$ \\
    }
}
