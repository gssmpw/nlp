\begin{algorithm}
    \caption{$\sdm$ Network Training}
    \label{alg:sdm-network-training}
    \small
    \begin{algorithmic}[1] 
        \Require $\trainSplit$, $\calibrationSplit$, $\alpha'$, $\text{max epochs}$, $\gM^{\rm{ref}}$, $\gM^{\rm{neg}}$, $\gM^{\rm{pos}}$ %
        \Procedure{sdm-network-train}{$\trainSplit$, $\calibrationSplit$, $\alpha'$, $\text{max epochs}$, $\gM^{\rm{ref}}$, $\gM^{\rm{neg}}$, $\gM^{\rm{pos}}$}
        		\State $\sdmVerificationLayer, \trainSplit_{*}, \calibrationSplit_{*}, \gE \gets$ \Call{sdm-iterative-train}{$\cdot$}  \Comment{ Alg.~\ref{alg:sdm-network-training}}
        		\State $\gM_{*} \gets$ Initialized with $\gM^{\rm{neg}}$, $\gM^{\rm{pos}}$ \Comment{Final trained model}
        		\State ${\rm{metric}}_{*} \gets 0$ \Comment{Determines final model}
		\State $\sdmVerificationLayer_{*} \gets \sdmVerificationLayer$ \Comment{Final $\sdm$ activation layer for verification}
        		\State $\gE_{*} \gets \gE$  \Comment{Final $\sdm$ estimator (i.e., $\pLower$) for verification}
		\State $\beta_{\rm{step}} \gets \frac{\beta_{\rm{max}} - \beta_{\rm{min}}}{\rm{total~mini~batches}}$ \Comment{Used to calculate $\beta$ as a function of epoch progress}
		\State Calculate $q,d$ for each $(\vx, y=1) \in \trainSplit_{*}$ using $\sdmVerificationLayer$ over generated output from $\sdm(\vz_{\rm{neg}}, \vz_{\rm{pos}})$ with $\q=e-2, d=1$ \label{line:sdm-net-train-calculate-q-d}
		 \For{$e \in 1, \ldots, \text{max epochs}$}
		 	\State Minimize $\gL(\mW_{\rm{pos}}, \theta_{\rm{pos}}; \trainSplit, \beta, \gM^{\rm{ref}})$ \Comment{Eq.~\ref{eq:sdm-network-next-token-training-loss}}
			\State $\sdmVerificationLayer, \_, \_, \gE \gets$ \Call{sdm-iterative-train}{$\cdot$} \label{line:sdm-net-train-inner-sdm-retrain} \Comment{Without shuffling $\trainSplit_{*}, \calibrationSplit_{*}$}
			\State Update $q,d$ for each $(\vx, y=1) \in \trainSplit_{*}$ \Comment{As in Line~\ref{line:sdm-net-train-calculate-q-d}}
			\State $\rm{metric} \gets$ cardinality of the admitted set from $\pLower$ for $\hat{y}=1$ over $\calibrationSplit_{*}$ \label{line:sdm-net-train-stopping-criteria} \Comment{Restricted to $\yTask=\yTaskPrediction$, if available}
          	 	\If{$\rm{metric} > \rm{metric}_{*}$}
           			\State $\rm{metric}_{*} \gets \rm{metric}$
				\State $\gM_{*} \gets$ Update with $\mW_{\rm{pos}}, \theta_{\rm{pos}}$
				\State $\sdmVerificationLayer_{*} \gets \sdmVerificationLayer$
				\State $\gE_{*} \gets \gE$
           		\EndIf
		 \EndFor
	\State \textbf{return} $\gM_{*}, \trainSplit_{*}, \calibrationSplit_{*}, \sdmVerificationLayer_{*}, \gE_{*}$
        \EndProcedure
        \Ensure $\gM_{*}, \trainSplit_{*}, \calibrationSplit_{*}, \sdmVerificationLayer_{*}, \gE_{*}$ 
    \end{algorithmic}
\end{algorithm}