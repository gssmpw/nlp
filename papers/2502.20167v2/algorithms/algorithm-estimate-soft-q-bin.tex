\begin{algorithm}
    \caption{Search Algorithm to Find $\minValidQBin$ to Detect High-Probability Regions}
    \label{alg:estimate-soft-q-bin}
    \small
    \begin{algorithmic}[1] 
        \Require cached $(\softqbin, \vo)$ for $\calibrationSplit$, $\alpha' \in (\frac{1}{C},1]$ %
        \Procedure{find-min-rescaled-q}{cached $(\softqbin, \vo)$ for $\calibrationSplit$, $\alpha' \in (\frac{1}{C},1]$}
        \State $\minValidQBin \gets \emptyset$ \Comment{A suitable $\minValidQBin$ may not exist.}
        \State $ [\psi_1, \ldots \psi_C] \gets [\emptyset, \ldots, \emptyset]$ \Comment{Needed at test-time, if applicable}
        \State $\tilde{q}s \gets {\rm{sorted}} ~[\tilde{q} \in \calibrationSplit~{\rm{s.t.}}~\hardqbin > 0]$ \label{line:ood-hardqbin} \Comment{Restricted to $\hardqbin > 0$ to exclude OOD}
        \For{$\softqbin' \in \tilde{q}s$} 
            \State Construct ${\rm{eCDF}}^{y_1}_{\rm{ca}} , \ldots , {\rm{eCDF}}^{y_C}_{\rm{ca}} $ for all $ \softqbin \ge \softqbin'$ in $\calibrationSplit$\label{line:eCDFs} \Comment{eCDFs for $\vo$ (Eq.~\ref{equation:rescaled-prediction-conditional-estimate}), stratified by $y$}
            \State Calculate $\psi_c={\rm{inverseCDF}}^{y_c}_{\rm{ca}}(1-\alpha')  ~\forall~c~\in \{1,\ldots,C\}$ \Comment{Quantile functions are inverses of L.~\ref{line:eCDFs}}
	\If{${\rm{all}}( ~ [\psi_1, \ldots \psi_C] \ge \alpha' ~)$} \Comment{Element-wise comparison}
        	    \State $\minValidQBin \gets \softqbin'$ \Comment{Satisfies Remark~\ref{class-conditional-thresholding} at the prediction-conditional estimate (see text) of $\ge \alpha'$}
	    \State \textbf{break}
        \EndIf        
        \EndFor
        \State \textbf{return} $\minValidQBin$, $ [\psi_1, \ldots \psi_C]$
        \EndProcedure
        \Ensure $\minValidQBin$, $ [\psi_1, \ldots \psi_C]$
    \end{algorithmic}
\end{algorithm}