
\subsection{Zero-shot stitching comparison}\label{sec:zero-shot-stitching}
We follow the empirical analysis performed in R3L. We define the encoder as the network up to the first flatten layer after the convolutional blocks, with the remaining layers constituting the controller. The zero-shot stitching evaluation is conducted on visual-task variations that were not seen together during training. Encoders and controllers must match to the specific conditions they were trained on. For example, an encoder trained with a green background should be used in such an environment, and a controller developed for low-speed driving should be applied to that task.
% \AR{immagine di architettura? Empirical/ablation test su layer di stitching? E su numero ancore?}



\paragraph{Stitching table}
Encoders and controllers from different policies trained under different conditions, can be independently assembled through zero-shot stitching. 
In \Cref{sec:method-alignment} we defined how to estimate and use a transformation to then perform the stitching, defining the models as formed by encoders and controllers. 

We present zero-shot stitching results in \Cref{tab:carracing-stitching_performance} and \cref{tab:lunarlander-stitching_performance}. 
The testing procedure to perform stitching is as follows:
Given models trained with various seeds and different visual-task variations, we decompose encoders and controllers of a model, then connect each encoder with controllers that were trained either on different visual variations or different seeds, using the transformation to ensure compatibility between layers.
Each cell reports the average score obtained across different stitched seeds.
Therefore, if we have four visual variations, six task variations and five seeds, for each cell we perform $6 \times 5 = 30$ stitching tests, for a total of 120 across the entire table for a single stitching method. Each combination is tested over 10 different tracks.

In CarRacing, SAPS consistently achieves performance comparable to end-to-end scores across all tested visual and task variations, even in the challenging slow scenario where R3L experiences a noticeable drop. In LunarLander there is a considerable drop in the mean average performance, which is mainly due to some models highly underperforming, decreasing the mean value. This is, however, a strong improvement over R3L, for which we were not even able to train models, strongly highlighting the advantages of being able to perform zero-shot stitching from already trained, standard models.
This table underscores SAPSâ€™s robustness and adaptability in assembling agents for new environment variations, surpassing existing methods.
% \AR{inserisci appendice}Further stitching results for the Atari suite appear in \Cref{appendix:stitching-atari}.

SAPS instead performs much worse in LunarLander with respect to end-to-end agents, although improving upon the naive stitching approach. We think that this might reflect how sensitive LunarLander is to even small latent-space mismatches: a slight misalignment in the latent space could cause the landing procedure to strongly deviate in its trajectory, causing crashes and large penalties. Here, R3L scores are missing because we were not able to train models using this method.
% stitching results under varying background colors (white vs. red) and gravity levels (-10 vs. -3) instead 


\begin{table}[t!]
    \caption{Stitching performance in \textbf{CarRacing}, comparing \textbf{SAPS (ours)} to other methods, averaged over 5 seeds, with standard deviations.}
    \label{tab:carracing-stitching_performance}
    \resizebox{\textwidth}{!}{
    \begin{tabular}{ccccccccccc}
    \toprule
    & & & \multicolumn{6}{c}{\textbf{Controller}} & \\
    \cmidrule{4-9}
    & & & \multicolumn{3}{c}{\textbf{Visual Variations} (task standard)} & \multicolumn{3}{c}{\textbf{Task Variations} (green)} \\
    \cmidrule(r){4-6} \cmidrule(l){7-9}
    & & & \texttt{green} & \texttt{red} & \texttt{blue} &  \texttt{slow} & \texttt{scrambled} & \texttt{no idle} \\
    \cmidrule(r){1-6} \cmidrule(l){7-9}
    \multirow{12}{*}{\rotatebox{90}{\textbf{Encoder}}} 
    & \multirow{3}{*}{\rotatebox{90}{\texttt{green}}} 
    & \emph{Naive} & $175 \pm 304$ & $167 \pm 226$ & $-4 \pm 79$ &  $148 \pm 328$ & $106 \pm 217$ & $213 \pm 201$ \\
    & & \emph{R3L} & $781 \pm 108$ & $787 \pm 62$ & $794 \pm 61$ & $268 \pm 14$ & $781 \pm 126$ & $824 \pm 82$ \\
    & & \textbf{\emph{SAPS} (ours)} & $\mathbf{822 \pm 62}$ & $\mathbf{786 \pm 82}$ & $\mathbf{829 \pm 49}$ & $\mathbf{764 \pm 287}$ & $\mathbf{846 \pm 66}$ & $\mathbf{781 \pm 72}$ \\[1.5ex]
    & \multirow{3}{*}{\rotatebox{90}{\texttt{red}}} 
    & \emph{Naive} & $157 \pm 248$ & $43 \pm 205$ & $22 \pm 112$  & $83 \pm 191$ & $138 \pm 244$ & $252 \pm 228$ \\
    & & \emph{R3L} & $810 \pm 52$ & $776 \pm 92$ & $803 \pm 58$ & $476 \pm 430$ & $790 \pm 72$ & $817 \pm 69$ \\
    & & \textbf{\emph{SAPS} (ours)} & $\mathbf{859 \pm 41}$ & $\mathbf{807 \pm 52}$ & $\mathbf{809 \pm 60}$ & $\mathbf{824 \pm 192}$ & $\mathbf{838 \pm 52}$ & $\mathbf{853 \pm 50}$ \\[1.5ex]
    & \multirow{3}{*}{\rotatebox{90}{\texttt{blue}}} 
    & \emph{Naive} & $137 \pm 225$ & $130 \pm 274$ & $11 \pm 122$ & $95 \pm 128$ & $138 \pm 224$ & $144 \pm 206$ \\
    & & \emph{R3L} & $791 \pm 64$ & $793 \pm 40$ & $792 \pm 48$  & $564 \pm 440$ & $804 \pm 41$ & $828 \pm 50$ \\
    & & \textbf{\emph{SAPS} (ours)} & $\mathbf{839 \pm 57}$ & $\mathbf{808 \pm 70}$ & $\mathbf{814 \pm 52}$  & $\mathbf{746 \pm 319}$ & $\mathbf{832 \pm 60}$ & $\mathbf{808 \pm 62}$ \\[1.5ex]
    & \multirow{3}{*}{\rotatebox{90}{\texttt{far}}} 
    & \emph{Naive} & $152 \pm 204$ & $65 \pm 180$ & $2 \pm 152$ & $-49 \pm 9$ & $351 \pm 97$ & $349 \pm 66$ \\
    & & \emph{R3L} & $527 \pm 142$ & $605 \pm 118$ & $592 \pm 86$ & $303 \pm 100$ & $594 \pm 39$ & $673 \pm 91$ \\
    & & \textbf{\emph{SAPS} (ours)} & $\mathbf{714 \pm 45}$ & $\mathbf{712 \pm 71}$ & $\mathbf{727 \pm 52}$ & $\mathbf{762 \pm 131}$ & $\mathbf{738 \pm 44}$ & $\mathbf{626 \pm 77}$ \\
    \bottomrule
    \end{tabular}
    }
\end{table}

\begin{table}[t!]
    \centering
    \caption{Stitching performance comparing \textbf{SAPS (ours)} to other methods, in the \textbf{LunarLander} environment. Scores are averaged over 5 seeds, with standard deviations. For comparison, end-to-end models achieve $221 \pm 86$ for the white background, $192 \pm 30$ for the red background with gravity -10; for the white background, for gravity -3. R3L results are absent because we were not able to train models for it.}
    \label{tab:lunarlander-stitching_performance}
    % Use 0.7\textwidth or 0.8\textwidth, etc., to control how narrow you want it
    \resizebox{0.6\textwidth}{!}{
    \begin{tabular}{ccccccc}  % exactly 7 columns
    \toprule
    % First row of headers: empty in cols 1-3, "Controller" in cols 4-6, blank col 7
    & \multicolumn{3}{c}{} & \multicolumn{3}{c}{\textbf{Controller}} \\
    \cmidrule(l){5-7}
    % Second row of headers: empty in cols 1-3, "Gravity: -10" in 4-5, "Gravity: -3" in col 6, blank col 7
    & \multicolumn{3}{c}{} & \multicolumn{2}{c}{\textbf{Gravity: -10}} & \textbf{Gravity: -3} \\
    \cmidrule(r){5-6} \cmidrule(l){6-7}
    % Third row of headers: empty in cols 1-3, fill col 4-6 with "white, red, white", col 7 blank
    & & & & \texttt{white} & \texttt{red} & \texttt{white} \\
    \midrule
    \multirow{5}{*}{\rotatebox{90}{\textbf{Enc}}} & \multirow{5}{*}{\rotatebox{90}{\textbf{Gravity -10}}}
    & \multirow{3}{*}{\rotatebox{90}{\texttt{white}}} 
    & \emph{Naive} & $-413 \pm 72$ & $-390 \pm 176$ & $-276 \pm 8$ \\
    & & & \textbf{\emph{SAPS} (ours)} & $\mathbf{19 \pm 56}$ & $\mathbf{8 \pm 60}$ & $-242 \pm 51$ \\[1.5ex]
    & & \multirow{3}{*}{\rotatebox{90}{\texttt{red}}} 
    & \emph{Naive} & $-444 \pm 116$ & $-403 \pm 109$ & $-271 \pm 18$ \\
    & & & \textbf{\emph{SAPS} (ours)} & $\mathbf{52 \pm 44}$ & $\mathbf{33 \pm 61}$ & $-204 \pm 71$ \\
    \bottomrule
    \end{tabular}
    }
\end{table}
