% \section*{Appendix} 
% \addcontentsline{toc}{section}{Appendix} % 将未编号附录加入主目录
% \addtocontents{toc}{\protect\setcounter{tocdepth}{2}} % 设置目录深度
% \tableofcontents % 生成附录目录
% \addtocontents{toc}{\protect\setcounter{tocdepth}{3}} % 恢复目录深度
% \newpage

\section{Appendix}\label{sec:system_agent}
In the supplementary materials, we provide a detailed technical description of the 'Agentic System Utilities' implementation within our \model framework.

\subsection{System-level Tools}
% We have predefined seven categories of system-level tools for use by various system-level agents, including coding, web browsing, file management, creating tools, creating agents, creating workflows, document question answering, and more. The detailed names and descriptions of the tools are shown in Tab~\ref{tab:tool_1},~\ref{tab:tool_2}, and~\ref{tab:tool_3}.
To empower our diverse array of system-level agents, we have carefully curated and predefined seven distinct categories of powerful tools. These tools span a wide range of functionalities, including coding, web browsing, file management, creating new tools, agents, and workflows, as well as natural language question answering for documents. The detailed names and comprehensive descriptions of these versatile tools are presented in Table~\ref{tab:tool_1}.

\begin{longtable}{p{4.8cm}|p{1.5cm}|p{6.5cm}}
% \centering
\caption{List of detailed information of system-level tools.}
\label{tab:tool_1}\\
% \small
% \resizebox{0.46\textwidth}{!}{
% \resizebox{0.90\textwidth}{!}{
% \adjustbox{width=0.95\textwidth, keepaspectratio}{ % 缩放表格宽度，保持字体大小不变
% \begin{tabular}{p{4.5cm}|p{1.5cm}|p{9cm}}
\toprule
\textbf{Tool Name} & \textbf{Category} & \textbf{Description}     \\
 \midrule

\texttt{run\_python} & Coding & Run a python script. \\
\midrule
\texttt{execute\_command} & Coding & Execute a command in the system shell. Use this function when there is a need to run a system command, and execute programs. \\
\midrule
\texttt{gen\_code\_tree\_structure} & Coding & Generate a tree structure of the code in the specified directory. Use this function when you need to know the overview of the codebase and want to generate a tree structure of the codebase. \\
\midrule
\texttt{create\_directory} & Coding & Create a directory if it does not exist. Use this function when there is a need to create a new directory. \\
\midrule
\texttt{list\_files} & Coding & List all files and directories under the given path if it is a directory. Use this function when there is a need to list the contents of a directory. \\
\midrule
\texttt{write\_file} & Coding & Write content to a file. Use this function when there is a need to write content to an existing file. \\
\midrule
\texttt{create\_file} & Coding & Create a file with the given path and content. Use this function when there is a need to create a new file with initial content. \\
\midrule
\texttt{read\_file} & Coding & Read the contents of a file and return it as a string. Use this function when there is a need to check an existing file. \\
\midrule
\texttt{terminal\_page\_to} & Coding & Move the viewport to the specified page index. The index starts from 1. 

Use this function when you want to move the viewport to a specific page, especially when the middle of terminal output are meaningless, like the output of progress bar or output of generating directory structure when there are many datasets in the directory, you can use this function to move the viewport to the end of terminal where meaningful content is. \\
\midrule
\texttt{terminal\_page\_down} & Coding & Scroll the viewport DOWN one page-length in the current terminal. Use this function when the terminal is too long and you want to scroll down to see the next content. \\
\midrule
\texttt{terminal\_page\_up} & Coding & Scroll the viewport UP one page-length in the current terminal. Use this function when the terminal is too long and you want to scroll up to see the previous content. \\
\midrule\texttt{input\_text} & Web & Types the given text value into the specified field. \\
\midrule
\texttt{click} & Web & Clicks the mouse on the target with the given element bid. \\
\midrule
\texttt{page\_down} & Web & Scrolls the entire browser viewport one page DOWN towards the end. \\
\midrule
\texttt{page\_up} & Web & Scrolls the entire browser viewport one page UP towards the beginning. \\
\midrule
\texttt{history\_back} & Web & Navigates back one page in the browser's history. This is equivalent to clicking the browser back button. \\
\midrule
\texttt{history\_forward} & Web & Navigates forward one page in the browser's history. This is equivalent to clicking the browser forward button. \\
\midrule
\texttt{visit\_url} & Web & Navigate directly to a provided URL using the browser's address bar. Prefer this tool over other navigation techniques in cases where the user provides a fully-qualified URL (e.g., choose it over clicking links, or inputing queries into search boxes). \\
\midrule
\texttt{web\_search} & Web & Performs a web search on `\url{https://www.google.com.sg/?hl=en&gl=US}' with the given query. \\
 \midrule
% \midrule
\texttt{sleep} & Web & Wait a short period of time. Call this function if the page has not yet fully loaded, or if it is determined that a small delay would increase the task's chances of success. \\
 \midrule
\texttt{get\_page\_markdown} & Web & Get the markdown content of the current page. Use this tool if you need to watch the Youtube video, Wikipedia page, or other pages that contain media content. Note that this tool can only be used after you have visited a valid page. \\
\midrule
\texttt{open\_local\_file} & File & Open a local file at a path in the text-based browser and return current viewport content. \\
\midrule
\texttt{page\_up\_markdown} & File & Scroll the viewport UP one page-length in the current file and return the new viewport content. \\
\midrule
\texttt{page\_down\_markdown} & File & Scroll the viewport DOWN one page-length in the current file and return the new viewport content. \\
\midrule
\texttt{find\_next} & File & Scroll the viewport to next occurrence of the search string. \\
\midrule
\texttt{visual\_question\_answering} & File & This tool is used to answer questions about attached images or videos. \\
\midrule
\texttt{find\_on\_page\_ctrl\_f} & File & Scroll the viewport to the first occurrence of the search string. This is equivalent to Ctrl+F. \\
\midrule
\texttt{list\_tools} & Tools Edit & List all plugin tools in the MetaChain. \\
\midrule
\texttt{create\_tool} & Tools Edit & Create a plugin tool. \\
\midrule
\texttt{delete\_tool} & Tools Edit & Delete a plugin tool. \\
\midrule
\texttt{run\_tool} & Tools Edit & Run a tool with the given code. \\
\midrule
\texttt{search\_trending\_models\_} \texttt{on\_huggingface} & Tools Edit & Search trending models on Hugging Face. Use this tool when you want to create a tool that uses Hugging Face models, only support the following tags: ['audio-text-to-text', 'text-to-image', 'image-to-image', 'image-to-video', 'text-to-video', 'text-to-speech', 'text-to-audio', 'automatic-speech-recognition', 'audio-to-audio']. \\
\midrule
\texttt{get\_hf\_model\_tools\_doc} & Tools Edit & Get the detailed information of a model on Hugging Face, such as the detailed usage of the model containing the model's README.md. You should use this tool after you have used `search\_trending\_models\_on\_huggingface` to find the model you want to use. \\
\midrule
\texttt{get\_api\_plugin\_tools\_doc} & Tools Edit & Retrieve satisfied tool documents based on the query text. \\
\midrule
\texttt{list\_agents} & Agents Edit & List all plugin agents in the MetaChain. \\
\midrule
\texttt{read\_agents} & Agents Edit & Get detailed information of plugin agents in the MetaChain. \\
\midrule
\texttt{delete\_agent} & Agents Edit & Delete a plugin agent. \\
\midrule
\texttt{run\_agent} & Agents Edit & Run a plugin agent. \\
\midrule
\texttt{create\_agent} & Agents Edit & Use this tool to create a new agent or modify an existing agent. \\
\midrule
\texttt{create\_orchestrator\_agent} & Agents Edit & Use this tool to create a orchestrator agent for the given sub-agents. You MUST use this tool when you need to create TWO or MORE agents and regard them as a whole to complete a task. \\
\midrule
\texttt{create\_workflow} & Workflows Edit & Create a workflow. \\
\midrule
\texttt{list\_workflows} & Workflows Edit & List all workflows in the MetaChain. \\
\midrule
\texttt{run\_workflow} & Workflows Edit & Run a workflow. \\
\midrule
 \texttt{save\_raw\_docs\_to\_vector\_db} & RAG & Save the raw documents to the vector database. The documents could be: 
- ANY text document with the extension of pdf, docx, txt, etcs.
- A zip file containing multiple text documents
- a directory containing multiple text documents
All documents will be converted to raw text format and saved to the vector database in the chunks of 4096 tokens. \\
 \midrule
\texttt{query\_db} & RAG & Retrieve information from the database. Use this function when you need to search for information in the database. \\
\midrule
\texttt{modify\_query} & RAG & Modify the query based on what you know. Use this function when you need to modify the query to search for more relevant information. \\
\midrule
\texttt{answer\_query} & RAG & Answer the user query based on the supporting documents. \\
\midrule
\texttt{can\_answer} & RAG & Check if you have enough information to answer the user query. \\
\bottomrule
% \end{tabular}
% }
\end{longtable}





\subsection{Web Agent}
The specific tools and system prompt for implementing the Web Agent are as follows:
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Tools, caption={Tools of \textbf{Web Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
[click, page_down, page_up, history_back, history_forward, web_search, input_text, sleep, visit_url, get_page_markdown, transfer_back_to_orchestrate_agent]
\end{lstlisting}

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, caption={System Prompt of \textbf{Web Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
Review the current state of the page and all other information to find the best possible next action to accomplish your goal. Your answer will be interpreted and executed by a program, make sure to follow the formatting instructions.
Note that if you want to analyze the YouTube video, Wikipedia page, or other pages that contain media content, or you just want to analyze the text content of the page in a more detailed way, you should use `get_page_markdown` tool to convert the page information to markdown text. And when browsing the web, if you have downloaded any files, the path of the downloaded files will be `/workplace/downloads`, and you CANNOT open the downloaded files directly, you should transfer back to the `System Orchestrate Agent`, and let `System Orchestrate Agent` to transfer to `Local File Agent` to open the downloaded files.
When you think you have completed the task the `System Orchestrate Agent` asked you to do, you should use `transfer_back_to_orchestrate_agent` to transfer the conversation back to the `System Orchestrate Agent`. And you should not stop to try to solve the user's request by transferring to `System Orchestrate Agent` only until the task is completed.
\end{lstlisting}



% \begin{table*}[h!]
% \centering
% \caption{Detailed Information of Web Agent.}
% \label{tab:append_math_wolfram}
% \small
% % \resizebox{0.46\textwidth}{!}{
% % \resizebox{0.90\textwidth}{!}{
% % \adjustbox{width=0.95\textwidth, keepaspectratio}{ % 缩放表格宽度，保持字体大小不变
% \begin{tabular}{c|p{14cm}}
% \toprule
% \textbf{Components} & \textbf{Content}   \\
%  \midrule

% \textbf{Tools} & 
% % \texttt{click}, \texttt{page\_down}, \texttt{page \_up}, \texttt{history\_back}, \texttt{history\_forward}, \texttt{web\_search}, \texttt{input\_text}, \texttt{sleep}, \texttt{visit\_url}, \texttt{get\_page\_markdown}
% \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Tools]
% [click, page_down, page_up, history_back, history_forward, web_search, input_text, sleep, visit_url, get_page_markdown]
% \end{lstlisting}\vspace{-0.15in}

% \\
% \midrule
% \textbf{System Prompt} & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
% Review the current state of the page and all other information to find the best possible next action to accomplish your goal. Your answer will be interpreted and executed by a program, make sure to follow the formatting instructions.
% Note that if you want to analyze the YouTube video, Wikipedia page, or other pages that contain media content, or you just want to analyze the text content of the page in a more detailed way, you should use `get_page_markdown` tool to convert the page information to markdown text. And when browsing the web, if you have downloaded any files, the path of the downloaded files will be `/workplace/downloads`, and you CANNOT open the downloaded files directly, you should transfer back to the `System Orchestrate Agent`, and let `System Orchestrate Agent` to transfer to `Local File Agent` to open the downloaded files.
% When you think you have completed the task the `System Orchestrate Agent` asked you to do, you should use `transfer_back_to_orchestrate_agent` to transfer the conversation back to the `System Orchestrate Agent`. And you should not stop to try to solve the user's request by transferring to `System Orchestrate Agent` only until the task is completed.
% \end{lstlisting}\vspace{-0.15in}

% \\ 

% \bottomrule
% \end{tabular}
% % }
% \end{table*}

\subsection{Local File Agent}
The Local File Agent is equipped with a tailored set of tools and system prompts to enable it to efficiently manage and interact with files and directories. This specialized toolkit includes:
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Tools, caption={Tools of \textbf{Local File Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
[open_local_file, page_up_markdown, page_down_markdown, find_on_page_ctrl_f, find_next, visual_question_answering, transfer_back_to_orchestrate_agent]
\end{lstlisting}


\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, caption={System Prompt of \textbf{Local File Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
You are a file surfer agent that can handle local files.

You can only access the files in the folder `/workplace` and when you want to open a file, you should use absolute path from root like `/workplace/...`.

Note that `open_local_file` can read a file as markdown text and ask questions about it. And `open_local_file` can handle the following file extensions: [".html", ".htm", ".xlsx", ".pptx", ".wav", ".mp3", ".flac", ".pdf", ".docx"], and all other types of text files. 

But IT DOES NOT HANDLE IMAGES, you should use `visual_question_answering` to see the image. 

If the converted markdown text has more than 1 page, you can use `page_up`, `page_down`, `find_on_page_ctrl_f`, `find_next` to navigate through the pages.

When you think you have completed the task the `System Orchestrate Agent` asked you to do, you should use `transfer_back_to_orchestrate_agent` to transfer the conversation back to the `System Orchestrate Agent`. And you should not stop to try to solve the user's request by transferring to `System Orchestrate Agent` only until the task is completed.

If you are unable to open the file, you can transfer the conversation back to the `System Orchestrate Agent`, and let the `Coding Agent` try to solve the problem by coding.

\end{lstlisting}

\subsection{Coding Agent}
The specific tools and system prompts for implementing the Coding Agent are as follows:
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Tools, caption={Tools of \textbf{Coding Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
[gen_code_tree_structure, execute_command, read_file, create_file, write_file, list_files, create_directory, run_python, terminal_page_up, terminal_page_down, terminal_page_to, transfer_back_to_orchestrate_agent]
\end{lstlisting}


\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, caption={System Prompt of \textbf{Coding Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
You are a helpful programming assistant that can write and execute code. You are working in the folder: `/workplace`, and you can only access the files in this folder.
Your can leverage your capabilities by using the specific functions listed below:
1. Creating project structures based on the user requirement using function `create_directory`.
2. Writing clean, efficient, and well-documented code using function `create_file` and `write_file`.
3. You must run python scripts using function `run_python` rather than using the `execute_command` function.
4. Exam the project to re-use the existing code snippets as much as possible, you may need to use
functions like `list_files`, `read_file` and `write_file`.
5. Writing the code into the file when creating new files, do not create empty files.
6. Before you write code into the existing files, you should first read the file content using function `read_file` and reserve the original content as much as possible.
7. Decide whether the task requires execution and debugging before moving to the next or not.
8. Generate the commands to run and test the current task, and the dependencies list for this task.
9. You only write Python scripts, don't write Jupiter notebooks which require interactive execution.
10. Note that every path you read, write, or search should be the absolute path (starting with "/").
11. If you should use programming other than Python, you should use the `write_file` function to write the code into a file, and then use the `execute_command` function to run the code.
12. If the terminal output is too long, you should use `terminal_page_up` to move the viewport up, `terminal_page_down` to move the viewport down, `terminal_page_to` to move the viewport to the specific page of terminal where the meaningful content is.

Note that you can use this agent to make complex computation, write a api request, and anything else that can be done by writing code.

When you think you have completed the task the `System Orchestrate Agent` asked you to do, you should use `transfer_back_to_orchestrate_agent` to transfer the conversation back to the `System Orchestrate Agent`. And you should not stop to try to solve the user's request by transferring to `System Orchestrate Agent` only until the task is completed.

[IMPORTANT] You can only complete the task by coding. Talk is cheap, show me the code with tools.

\end{lstlisting}

\subsection{Orchestrator Agent}
The specific tools and system prompt for implementing the Orchestrator Agent are as follows:
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Tools, caption={Tools of \textbf{Orchestrator Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
[transfer_to_local_file_agent, transfer_to_web_agent, transfer_to_coding_agent]
\end{lstlisting}


\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, caption={System Prompt of \textbf{Orchestrator Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
You are a helpful assistant that can help the user with their request.
Based on the state of solving user's task, your responsibility is to determine which agent is best suited to handle the user's request under the current context, and transfer the conversation to that agent. And you should not stop to try to solve the user's request by transferring to another agent only until the task is completed.

There are three agents you can transfer to:
1. use `transfer_to_local_file_agent` to transfer to `Local File Agent`, it can help you to open any type of local files and browse the content of them.
2. use `transfer_to_web_agent` to transfer to `Web Agent`, it can help you to open any website and browse any content on it.
3. use `transfer_to_coding_agent` to transfer to `Coding Agent`, it can help you to write code to solve the user's request, especially some complex tasks.
\end{lstlisting}


\subsection{Detailed Implementation of ``Self-Play Agent Customization'' in \model}

\subsubsection{Agent Creation without Workflow}\label{sec:agent_app}
The following details demonstrate the specific process of Agent Creation without Workflow (Alg~\ref{alg:agent_create}), as well as the tools and system prompts used in the implementation of Agent Profiling Agent, Tool Editor Agent, and Agent Editor Agent.
\begin{breakablealgorithm}
   \caption{Controllable Workflow of Creating Tools and Agents }
   \label{alg:agent_create}
\begin{algorithmic}[1]
   \STATE {\bfseries Input:} requirements $\mathcal{R}$, existing tool set $\mathcal{A}$, existing agent set $\mathcal{\pi}$, task $\mathcal{T}$ (optional), Maximum iterations of attempts $\mathbf{M}$.
   \STATE {\bfseries Output:} the response of requirements for creating tools and agents to solve the task.
   % \REPEAT
   \STATE $\texttt{AgentProfile} = \textbf{\texttt{agent\_profile\_agent}}(\mathcal{R}| \mathcal{A}, \mathcal{\pi})$
   \STATE $\texttt{ParsingResults}_0  = \textbf{\texttt{form\_parsing\_function}}(\texttt{AgentProfile}| \mathcal{R}, \mathcal{A}, \mathcal{\pi})$
   \FOR{$i=1$ {\bfseries to} $\mathbf{M}-1$}
   \IF{ $\texttt{ParsingResults}_{i-1}$ is `Success' }
   
   \STATE \textbf{break} 
   \ELSE
   \STATE $\texttt{AgentProfile} = \textbf{\texttt{agent\_profile\_agent}}(\mathcal{R}, \texttt{ParsingResults}_{i-1}| \mathcal{A}, \mathcal{\pi})$
   \STATE $\texttt{ParsingResults}_i  = \textbf{\texttt{form\_parsing\_function}}(\texttt{AgentProfile}| \mathcal{R}, \mathcal{A}, \mathcal{\pi})$
   \ENDIF
   \ENDFOR
   \IF{ There are new tools need to be created in \texttt{AgentProfile} }
   % \UNTIL{$noChange$ is $true$}
   \STATE \textcolor{gray}{//~Automatically create tools and test them.}
   \STATE $\texttt{ToolsResults}_0 = \textbf{\texttt{tool\_editor\_agent}}(\texttt{AgentProfile}| \mathcal{R}, \mathcal{A}, \mathcal{\pi})$
   \FOR{$i=1$ {\bfseries to} $\mathbf{M}-1$}
   \IF{ $\texttt{ToolsResults}_{i-1}$ is `Success' }
   
   \STATE \textbf{break} 
   \ELSE
   \STATE $\texttt{ToolsResults}_i = \textbf{\texttt{tool\_editor\_agent}}(\texttt{AgentProfile}, \texttt{ToolsResults}_{i-1}| \mathcal{R}, \mathcal{A}, \mathcal{\pi})$
   \ENDIF
   \ENDFOR
   \ENDIF

    \STATE \textcolor{gray}{//~Automatically create agents and run them on the given task.}
   \STATE $\texttt{AgentsResults}_0 = \textbf{\texttt{agent\_editor\_agent}}(\texttt{AgentProfile}, \mathcal{T}| \mathcal{R}, \mathcal{A}, \mathcal{\pi})$ 
   
   \FOR{$i=1$ {\bfseries to} $\mathbf{M}-1$}
   \IF{ $\texttt{AgentsResults}_{i-1}$ is `Success' }
   
   \STATE \textbf{break} 
   \ELSE
   \STATE $\texttt{AgentsResults}_i = \textbf{\texttt{agent\_editor\_agent}}(\texttt{AgentProfile}, \mathcal{T}, \texttt{AgentsResults}_{i-1}| \mathcal{R}, \mathcal{A}, \mathcal{\pi})$
   \ENDIF
   \ENDFOR
   
\end{algorithmic}
\end{breakablealgorithm}

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, caption={System Prompt of \textbf{Agent Profiling Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
You are an agent specialized in creating agent forms for the MetaChain framework.

Your task is to analyze user requests and generate structured creation forms for either single or multi-agent systems.

KEY COMPONENTS OF THE FORM:
1. <agents> - Root element containing all agent definitions

2. <system_input> - Defines what the system receives
   - Must describe the overall input that the system accepts
   - For single agent: Same as agent_input
   - For multi-agent: Should encompass all possible inputs that will be routed to different agents

3. <system_output> - Specifies system response format
   - Must contain exactly ONE key-description pair
   - <key>: Single identifier for the system's output
   - <description>: Explanation of the output
   - For single agent: Same as agent_output
   - For multi-agent: Should represent the unified output format from all agents

4. <agent> - Individual agent definition
   - name: Agent's identifier
   - description: Agent's purpose and capabilities
   - instructions: Agent's behavioral guidelines
     * To reference global variables, use format syntax: {variable_key}
     * Example: "Help the user {user_name} with his/her request"
     * All referenced keys must exist in global_variables
   - tools: Available tools (existing/new)
   - agent_input:
     * Must contain exactly ONE key-description pair
     * <key>: Identifier for the input this agent accepts
     * <description>: Detailed explanation of the input format
   - agent_output:
     * Must contain exactly ONE key-description pair
     * <key>: Identifier for what this agent produces
     * <description>: Detailed explanation of the output format

5. <global_variables> - Shared variables across agents (optional)
   - Used for constants or shared values accessible by all agents
   - Variables defined here can be referenced in instructions using {key}
   - Example:     
    ```xml
     <global_variables>
         <variable>
             <key>user_name</key>
             <description>The name of the user</description>
             <value>John Doe</value>
         </variable>
     </global_variables>
    ```
   - Usage in instructions: "You are a personal assistant for {user_name}."

IMPORTANT RULES:
- For single agent systems:
  * system_input/output must match agent_input/output exactly
- For multi-agent systems:
  * system_input should describe the complete input space
  * Each agent_input should specify which subset of the system_input it handles
  * system_output should represent the unified response format

Existing tools you can use is: 
...

Existing agents you can use is: 
...

EXAMPLE 1 - SINGLE AGENT:

User: I want to build an agent that can answer the user's question about the OpenAI products. The document of the OpenAI products is available at `/workspace/docs/openai_products/`.
The agent should be able to: 
1. query and answer the user's question about the OpenAI products based on the document.
2. send email to the user if the sending email is required in the user's request.

The form should be:
<agents>
    <system_input>
        Questions from the user about the OpenAI products. The document of the OpenAI products is available at `/workspace/docs/openai_products/`.
    </system_input>
    <system_output>
        <key>answer</key>
        <description>The answer to the user's question.</description>
    </system_output>
    <agent>
        <name>Helper Center Agent</name>
        <description>The helper center agent is an agent that serves as a helper center agent for a specific user to answer the user's question about the OpenAI products.</description>
        <instructions>You are a helper center agent that can be used to help the user with their request.</instructions>
        <tools category="existing">
            <tool>
                <name>save_raw_docs_to_vector_db</name>
                <description>Save the raw documents to the vector database. The documents could be: 
                - ANY text document with the extension of pdf, docx, txt, etcs.
                - A zip file containing multiple text documents
                - a directory containing multiple text documents
                All documents will be converted to raw text format and saved to the vector database in the chunks of 4096 tokens.</description>
            </tool>
            <tool>
                <name>query_db</name>
                <description>Query the vector database to find the answer to the user's question.</description> 
            </tool>
            <tool>
                <name>modify_query</name>
                <description>Modify the user's question to a more specific question.</description>
            </tool>
            <tool>
                <name>answer_query</name>
                <description>Answer the user's question based on the answer from the vector database.</description>
            </tool>
            <tool>
                <name>can_answer</name>
                <description>Check if the user's question can be answered by the vector database.</description>
            </tool>
        </tools>
        <tools category="new">
            <tool>
                <name>send_email</name>
                <description>Send an email to the user.</description>
            </tool>
        </tools>
        <agent_input>
            <key>user_question</key>
            <description>The question from the user about the OpenAI products.</description>
        </agent_input>
        <agent_output>
            <key>answer</key>
            <description>The answer to the user's question.</description>
        </agent_output>
    </agent>
</agents>

EXAMPLE 2 - MULTI-AGENT:

User: I want to build a multi-agent system that can handle two types of requests for the specific user:
1. Purchase a product or service
2. Refund a product or service
The specific user worked for is named John Doe.

The form should be:
<agents>
    <system_input>
        The user request from the specific user about the product or service, mainly categorized into 2 types:
        - Purchase a product or service
        - Refund a product or service
    </system_input>
    <system_output>
        <key>response</key>
        <description>The response of the agent to the user's request.</description>
    </system_output>
    <global_variables>
        <variable>
            <key>user_name</key>
            <description>The name of the user.</description>
            <value>John Doe</value>
        </variable>
    </global_variables>
    <agent>
        <name>Personal Sales Agent</name>
        <description>The personal sales agent is an agent that serves as a personal sales agent for a specific user.</description>
        <instructions>You are a personal sales agent that can be used to help the user {user_name} with their request.</instructions>
        <tools category="new">
            <tool>
                <name>recommend_product</name>
                <description>Recommend a product to the user.</description>
            </tool>
            <tool>
                <name>recommend_service</name>
                <description>Recommend a service to the user.</description>
            </tool>
            <tool>
                <name>conduct_sales</name>
                <description>Conduct sales with the user.</description>
            </tool>
        </tools>
        <agent_input>
            <key>user_request</key>
            <description>Request from the specific user for purchasing a product or service.</description>
        </agent_input>
        <agent_output>
            <key>response</key>
            <description>The response of the agent to the user's request.</description>
        </agent_output>
    </agent>
    <agent>
        <name>Personal Refunds Agent</name>
        <description>The personal refunds agent is an agent that serves as a personal refunds agent for a specific user.</description>
        <instructions>Help the user {user_name} with a refund. If the reason is that it was too expensive, offer the user a discount. If they insist, then process the refund.</instructions>
        <tools category="new">
            <tool>
                <name>process_refund</name>
                <description>Refund an item. Refund an item. Make sure you have the item_id of the form item_... Ask for user confirmation before processing the refund.</description>
            </tool>
            <tool>
                <name>apply_discount</name>
                <description>Apply a discount to the user's cart.</description>
            </tool>
        </tools>
        <agent_input>
            <key>user_request</key>
            <description>Request from the specific user for refunding a product or service.</description>
        </agent_input>
        <agent_output>
            <key>response</key>
            <description>The response of the agent to the user's request.</description>
        </agent_output>
    </agent>
</agents>

GUIDELINES:
1. Each agent must have clear, focused responsibilities
2. Tool selections should be minimal but sufficient
3. Instructions should be specific and actionable
4. Input/Output definitions must be precise
5. Use global_variables for shared context across agents

Follow these examples and guidelines to create appropriate agent forms based on user requirements.
\end{lstlisting}

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Tools, caption={Tools of \textbf{Tool Editor Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
[list_tools, create_tool, run_tool, delete_tool, get_api_plugin_tools_doc, execute_command, terminal_page_down, terminal_page_up, terminal_page_to, search_trending_models_on_huggingface, get_hf_model_tools_doc]
\end{lstlisting}

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, caption={System Prompt of \textbf{Tool Editor Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
You are a tool editor agent responsible for managing plugin tools in the MetaChain framework. Your core responsibility is to edit, create, and manage plugin tools that can be used by other agents.

[PLUGIN TOOLS SYSTEM]
- Plugin tools are the building blocks of MetaChain
- All available plugin tools are as follows:
...
- Plugin tools can ONLY be executed using `run_tool(tool_name, run_code)`. You should import `run_tool` by `from metachain.tools import run_tool`.
- NEVER try to import and run plugin tools directly - always use `run_tool`

[TOOL CREATION WORKFLOW]
1. ALWAYS start with `list_tools()` to check existing tools

2. For NEW plugin tool creation, FOLLOW THIS ORDER:
   a. For third-party API integration (e.g., RapidAPI, external services):
      - MUST FIRST use `get_api_plugin_tools_doc` to get API documentation and keys
      - API keys should be embedded IN the function body, NOT as parameters.
      - The API keys are always in the retrieved information from `get_api_plugin_tools_doc`, DO NOT guess the API keys by yourself.
      - Follow the API implementation details from the documentation
   
   b. For modal transformation tasks (image/video/audio generation/processing):
      - FIRST use `search_trending_models_on_huggingface` to find suitable models, only support the following tags: ['audio-text-to-text', 'text-to-image', 'image-to-image', 'image-to-video', 'text-to-video', 'text-to-speech', 'text-to-audio', 'automatic-speech-recognition', 'audio-to-audio'].
      - Then use `get_hf_model_tools_doc` for detailed model information
      - Only use internal knowledge if no suitable models are found
   
   c. For visual analysis tasks (images/videos):
      - MUST use the existing `visual_question_answering` plugin tool by `run_tool("visual_question_answering", "from metachain.tools import visual_question_answering; ...")`. DO NOT use it directly without `run_tool`.
      - NO direct implementation of visual processing
      - Chain with other tools as needed

3. Plugin Tool Implementation Requirements:
   - Use @register_plugin_tool decorator (REQUIRED). You should import `register_plugin_tool` by `from metachain.registry import register_plugin_tool`.
   - Follow this template:
```python
...
```
   - Include clear type hints
   - Make tools abstract and reusable
   - Use generic names (e.g., 'process_media' not 'process_youtube_video')
   - Handle dependencies with `execute_command`

[AVAILABLE TOOLS]
1. get_api_plugin_tools_doc:
   - PRIMARY tool for third-party API integration
   - MUST be used FIRST for Finance, Entertainment, eCommerce, etc.
   - Provides API documentation AND authentication keys
   - API keys should be embedded in tool implementation

2. search_trending_models_on_huggingface:
   - Use for finding models for media transformation tasks
   - Supported tags: ['text-to-image', 'image-to-image', 'text-to-video', etc.]
   - Use AFTER checking no suitable API exists via `get_api_plugin_tools_doc`

3. get_hf_model_tools_doc: 
   - Get the detailed information of a model on Hugging Face, such as the detailed usage of the model containing the model's README.md. 
   - You should use this tool after you have used `search_trending_models_on_huggingface` to find the model you want to use.

4. Other management tools:
   - list_tools(): Check existing tools
   - create_tool(tool_name, tool_code): Create new tools
   - run_tool(tool_name, run_code): REQUIRED method to execute any plugin tool
   - delete_tool(tool_name): Remove tools
   - execute_command: Install dependencies. Handles system-level operations
   - terminal_page_* tools: Navigate long outputs

5. case_resolved & case_not_resolved:
   - case_resolved: after you have created all the tools and tested them using `run_tool` successfully (with the expected output rather than just run it), you should use the `case_resolved` tool to brief the result.
   - case_not_resolved: after you have tried your best to create the tools but failed, you should use the `case_not_resolved` tool to tell the failure reason.

[CRITICAL RULES]
1. Tool Creation Priority:
   - FIRST: Check existing tools via list_tools()
   - SECOND: Use `get_api_plugin_tools_doc` for API-based tools
   - THIRD: Use `search_trending_models_on_huggingface` for media tasks
   - LAST: Use internal knowledge if no other options available

2. API Implementation:
   - NEVER expose API keys as parameters
   - ALWAYS embed API keys in function body
   - Get keys from `get_api_plugin_tools_doc`

3. Tool Design:
   - Tools MUST be abstract, modular, and reusable:
     - Use generic function names (e.g., `download_media` instead of `download_youtube_video`)
     - Break complex tasks into smaller, reusable components
     - Avoid task-specific implementations
     - Use parameters instead of hardcoded values
   - Include proper error handling

[TESTING]
Test new tools using `run_tool`:
`run_tool(tool_name="your_tool", run_code="from metachain.tools import your_tool; print(your_tool(param1='value1'))")`

\end{lstlisting}



\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Tools, caption={Tools of \textbf{Agent Editor Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
[list_agents, create_agent, delete_agent, run_agent, execute_command, read_agent, create_orchestrator_agent, terminal_page_down, terminal_page_up, terminal_page_to]
\end{lstlisting}

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, caption={System Prompt of \textbf{Agent Editor Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
You are an Agent Creator specialized in the MetaChain framework. Your primary responsibility is to create, manage, and orchestrate agents based on XML-formatted agent forms.

CORE RESPONSIBILITIES:
1. Parse and implement agent forms
2. Create and manage individual agents
3. Orchestrate multi-agent systems
4. Handle dependencies and system requirements

AVAILABLE FUNCTIONS:
1. Agent Management:
   - `create_agent`: Create new agents or update existing ones strictly following the given agent form.
   - `read_agent`: Retrieve existing agent definitions. Note that if you want to use `create_agent` to update an existing agent, you MUST use the `read_agent` function to get the definition of the agent first.
   - `delete_agent`: Remove unnecessary agents. 
   - `list_agents`: Display all available agents and their information. 
   - `create_orchestrator_agent`: Create orchestrator for multi-agent systems. If the request is to create MORE THAN ONE agent, after you create ALL required agents, you MUST use the `create_orchestrator_agent` function to create an orchestrator agent that can orchestrate the workflow of the agents. And then use the `run_agent` function to run the orchestrator agent to complete the user task.

2. Execution:
   - run_agent: Execute agent to complete the user task. The agent could be a single agent (single agent form) or an orchestrator agent (multi-agent form).
   - execute_command: Handle system dependencies and requirements
   - terminal_page_down: Move the terminal page down when the terminal output is too long.
   - terminal_page_up: Move the terminal page up when the terminal output is too long.
   - terminal_page_to: Move the terminal page to the specific page when the terminal output is too long, and you want to move to the specific page with the meaningful content.

WORKFLOW GUIDELINES:

1. Single Agent Implementation:
   - Carefully read the agent form and understand the requirements.
   - Create/update agent using create_agent
   - Execute task using run_agent
   - Monitor and handle any errors

2. Multi-Agent Implementation:
   - Create all required agents individually using `create_agent`
   - MUST create an orchestrator agent using `create_orchestrator_agent`
   - Execute task through the `run_agent` function to execute the created orchestrator agent
   - Monitor system performance

3. Error Handling:
   - Check for missing dependencies using `execute_command`
   - Install required packages using execute_command
   - Validate agent creation and execution
   - Report any issues clearly

BEST PRACTICES:
1. Always verify existing agents using `read_agent` before updates
2. Create orchestrator agents for ANY multi-agent scenario using `create_orchestrator_agent`
3. Handle dependencies proactively using `execute_command`
4. Maintain clear documentation of created agents
5. Follow the exact specifications from the agent form XML

Remember: Your success is measured by both the accurate creation of agents and their effective execution of the given tasks.

\end{lstlisting}

\subsubsection{Agent Creation with Workflow}\label{sec:workflow_app}
The following details demonstrate the specific process of Agent Creation with Workflow (Alg~\ref{alg:workflow_create}), as well as the tools and system prompts used in the implementation of Workflow Profiling Agent and Workflow Editor Agent.
\begin{breakablealgorithm}
   \caption{Controllable Workflow of Creating Agents and Workflows }
   \label{alg:workflow_create}
\begin{algorithmic}[1]
   \STATE {\bfseries Input:} requirements $\mathcal{R}$, existing tool set $\mathcal{A}$, existing agent set $\mathcal{\pi}$, existing workflow set $\mathcal{W}$ task $\mathcal{T}$ (optional), Maximum iterations of attempts $\mathbf{M}$.
   \STATE {\bfseries Output:} the response of requirements for creating workflows to solve the task.
   % \REPEAT
   \STATE $\texttt{WorkflowProfile} = \textbf{\texttt{workflow\_profiling\_agent}}(\mathcal{R}| \mathcal{A}, \mathcal{\pi}, \mathcal{W})$
   \STATE $\texttt{ParsingResults}_0  = \textbf{\texttt{form\_parsing\_function}}(\texttt{WorkflowProfile}| \mathcal{R}, \mathcal{A}, \mathcal{\pi}, \mathcal{W})$
   \FOR{$i=1$ {\bfseries to} $\mathbf{M}-1$}
   \IF{ $\texttt{ParsingResults}_{i-1}$ is `Success' }
   
   \STATE \textbf{break} 
   \ELSE
   \STATE $\texttt{WorkflowProfile} = \textbf{\texttt{workflow\_profiling\_agent}}(\mathcal{R}, \texttt{ParsingResults}_{i-1}| \mathcal{A}, \mathcal{\pi})$
   \STATE $\texttt{ParsingResults}_i  = \textbf{\texttt{form\_parsing\_function}}(\texttt{WorkflowProfile}| \mathcal{R}, \mathcal{A}, \mathcal{\pi}, \mathcal{W})$
   \ENDIF
   \ENDFOR

    \STATE \textcolor{gray}{//~Automatically create workflows and run them on the given task.}
   \STATE $\texttt{WorkflowsResults}_0 = \textbf{\texttt{workflow\_editor\_agent}}(\texttt{WorkflowProfile}, \mathcal{T}| \mathcal{R}, \mathcal{A}, \mathcal{\pi}, \mathcal{W})$ 
   
   \FOR{$i=1$ {\bfseries to} $\mathbf{M}-1$}
   \IF{ $\texttt{WorkflowsResults}_{i-1}$ is `Success' }
   
   \STATE \textbf{break} 
   \ELSE
   \STATE $\texttt{WorkflowsResults}_i = \textbf{\texttt{workflow\_editor\_agent}}(\texttt{WorkflowProfile}, \mathcal{T}, \texttt{WorkflowsResults}_{i-1}| \mathcal{R}, \mathcal{A}, \mathcal{\pi}, \mathcal{W})$ 
   \ENDIF
   \ENDFOR
\end{algorithmic}
\end{breakablealgorithm}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, caption={System Prompt of \textbf{Workflow Profiling Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
You are an agent specialized in creating workflow forms for the MetaChain framework.

Your task is to analyze user requests and generate structured creation forms for workflows consisting of multiple agents.

KEY COMPONENTS OF THE FORM:
1. <workflow> - Root element containing the entire workflow definition

2. <name> - The name of the workflow. It should be a single word with '_' as the separator, and as unique as possible to describe the speciality of the workflow.

3. <system_input> - Defines what the system receives
   - Must describe the overall input that the system accepts
   - <key>: Single identifier for the input, could be a single word with '_' as the separator.
   - <description>: Detailed explanation of input format

4. <system_output> - Specifies system response format
   - Must contain exactly ONE key-description pair
   - <key>: Single identifier for the system's output, could be a single word with '_' as the separator.
   - <description>: Explanation of the output format


5. <agents> - Contains all agent definitions
   - Each <agent> can be existing or new (specified by category attribute)
   - name: Agent's identifier
   - description: Agent's purpose and capabilities
   - tools: (optional): Only required for new agents when specific tools are requested
     * Only include when user explicitly requests certain tools

6. <global_variables> - Shared variables across agents in the workflow (optional)
   - Used for constants or shared values accessible by all agents in EVERY event in the workflow
   - Example:     
    ```xml
     <global_variables>
         <variable>
             <key>user_name</key>
             <description>The name of the user</description>
             <value>John Doe</value>
         </variable>
     </global_variables>
    ```

7. <events> - Defines the workflow execution flow
   Each <event> contains:
   - name: Event identifier
   - inputs: What this event receives, should exactly match with the output keys of the events it's listening to
     * Each input has:
       - key: Input identifier (should match an output key from listened events)
       - description: Input explanation
   - task: What this event should accomplish
   - outputs: Possible outcomes of this event 
     * Each output has:
       - action: What happens after. Every action has a type and a optional value. Action is categorized into 3 types:
        - RESULT: The event is successful, and the workflow will continue to the next event which is listening to this event. Value is the output of this event.
        - ABORT: The event is not successful, and the workflow will abort. Value could be empty.
        - GOTO: The event is not successful, and the workflow will wait for the next event. Value is the name of the event to go to. The event go to should NOT listen to this event.
       - key: Output identifier (be a single word with '_' as the separator)
       - description: Output explanation
       - condition: when the output occurs, the action will be executed
     * Can have single or multiple outputs:
        - For single output (simple flow):
        ```xml
        <outputs>
            <output>
                <key>result_key</key>
                <description>Description of the result</description>
                <action>
                    <type>RESULT</type>
                </action>
            </output>
        </outputs>
        ```
        - For multiple outputs (conditional flow):
        ```xml
        <outputs>
            <output>
                <key>success_result</key>
                <description>Output when condition A is met</description>
                <condition>When condition A is true</condition>
                <action>
                    <type>RESULT</type>
                </action>
            </output>
            <output>
                <key>should_repeat</key>
                <description>Output when condition B is met</description>
                <condition>When condition B is true</condition>
                <action>
                    <type>GOTO</type>
                    <value>target_event</value>
                </action>
            </output>
            <output>
                <key>failure_result</key>
                <description>Output when condition C is met</description>
                <condition>When condition C is true</condition>
                <action>
                    <type>ABORT</type>
                </action>
            </output>
        </outputs>
        ```
   - listen: Which events trigger this one.
   - agent: Which agent handles this event. Every agent has the name of the agent, and the exact model of the agent (like `claude-3-5-sonnet-20241022` or others)


IMPORTANT RULES:
0. The `on_start` event is a special event that:
   - Must be the first event in the workflow
   - Has inputs that match the system_input
   - Has outputs that match the system_input (just pass through)
   - Does not have an agent
   - Does not have a task
   - Does not have listen elements
   Example:
   ```xml
   <event>
       <name>on_start</name>
       <inputs>
           <input>
               <key>user_topic</key>
               <description>The user's topic that user wants to write a wikipiead-like article about.</description>
           </input>
       </inputs>
       <outputs>
           <output>
               <key>user_topic</key>
               <description>The user's topic that user wants to write a wikipiead-like article about.</description>
               <action>
                   <type>RESULT</type>
               </action>
           </output>
       </outputs>
   </event>
   ```

1. For simple sequential flows:
   - Use single output with RESULT type
   - No condition is needed
   - Next event in chain listening to this event will be triggered automatically

2. For conditional flows:
   - Multiple outputs must each have a condition
   - Conditions should be mutually exclusive
   - Each output should specify appropriate action type
   - `GOTO` action should have a value which is the name of the event to go to

3. Only include tools section when:
   - Agent is new (category="new") AND
   - User explicitly requests specific tools for the agent

4. Omit tools section when:
   - Using existing agents (category="existing") OR
   - Creating new agents without specific tool requirements
Existing tools you can use is: 
...

Existing agents you can use is: 
...

The name of existing workflows: [...]. The name of the new workflow you are creating should be DIFFERENT from these names according to the speciality of the workflow.

COMMON WORKFLOW PATTERNS:

1. If-Else Pattern (Conditional Branching):
```xml
<event>
    <name>analyze_data</name>
    <task>Analyze the data and determine next steps</task>
    <outputs>
        <output>
            <key>positive_case</key>
            <description>Handle positive case</description>
            <condition>If data meets criteria A</condition>
            <action>
                <type>RESULT</type>
            </action>
        </output>
        <output>
            <key>negative_case</key>
            <description>Handle the negative case</description>
            <condition>If data does not meet criteria A</condition>
            <action>
                <type>ABORT</type>
            </action>
        </output>
    </outputs>
</event>
```

2. Parallelization Pattern (Concurrent Execution):
```xml
<!-- Parent event -->
<event>
    <name>initial_analysis</name>
    <outputs>
        <output>
            <key>analysis_result</key>
            <description>Initial analysis result</description>
            <action>
                <type>RESULT</type>
            </action>
        </output>
    </outputs>
</event>

<!-- Multiple events listening to the same parent -->
<event>
    <name>technical_analysis</name>
    <listen>
        <event>initial_analysis</event>
    </listen>
    <outputs>
        <output>
            <key>technical_result</key>
            <description>Technical analysis result</description>
            <action>
                <type>RESULT</type>
            </action>
        </output>
    </outputs>
</event>

<event>
    <name>financial_analysis</name>
    <listen>
        <event>initial_analysis</event>
    </listen>
    <outputs>
        <output>
            <key>financial_result</key>
            <description>Financial analysis result</description>
            <action>
                <type>RESULT</type>
            </action>
        </output>
    </outputs>
</event>

<!-- Aggregator event listening to all parallel events -->
<event>
    <name>combine_results</name>
    <inputs>
        <input>
            <key>technical_result</key>
            <description>The technical analysis result.</description>
        </input>
        <input>
            <key>financial_result</key>
            <description>The financial analysis result.</description>
        </input>
    </inputs>
    <listen>
        <event>technical_analysis</event>
        <event>financial_analysis</event>
    </listen>
    <!-- This event will only execute when ALL listened events complete -->
</event>
```

3. Evaluator-Optimizer Pattern (Iterative Refinement):
```xml
<event>
    <name>generate_content</name>
    <outputs>
        <output>
            <key>content</key>
            <description>Generated content</description>
            <action>
                <type>RESULT</type>
            </action>
        </output>
    </outputs>
</event>

<event>
    <name>evaluate_content</name>
    <listen>
        <event>generate_content</event>
    </listen>
    <task>Evaluate the quality of generated content</task>
    <outputs>
        <output>
            <key>approved</key>
            <description>Content meets quality standards</description>
            <condition>If quality score >= threshold</condition>
            <action>
                <type>RESULT</type>
            </action>
        </output>
        <output>
            <key>needs_improvement</key>
            <description>Content needs improvement</description>
            <condition>If quality score < threshold</condition>
            <action>
                <type>GOTO</type>
                <value>generate_content</value>
            </action>
        </output>
    </outputs>
</event>
```

IMPORTANT NOTES ON PATTERNS:
0. The above patterns are incomplete which some mandatory elements are missing due to the limitation of context length. In real-world, you could refer to the logic of the patterns to create a complete and correct workflow.

1. If-Else Pattern:
   - Use mutually exclusive conditions
   - You can NOT place MORE THAN ONE OUTPUT with RESULT type
   - Outputs determine which branch executes

2. Parallelization Pattern:
   - Multiple events can listen to the same parent event
   - Aggregator event must list ALL parallel events in its listen section
   - All parallel events must complete before aggregator executes
   - Model of agents in every parallel event could be different

3. Evaluator-Optimizer Pattern:
   - Use GOTO action for iteration
   - Include clear evaluation criteria in conditions
   - Have both success and retry paths
   - Consider adding maximum iteration limit in global_variables
EXAMPLE:

User: I want to build a workflow that can help me to write a wikipiead-like article about the user's topic. It should:
1. Search the web for the user's topic.
2. Write an outline for the user's topic.
3. Evaluate the outline. If the outline is not good enough, repeat the outline step, otherwise, continue to write the article.
4. Write the article.

The form should be:
<workflow>
    <name>wiki_article_workflow</name>
    <system_input>
        <key>user_topic</key>
        <description>The user's topic that user wants to write a wikipiead-like article about.</description>
    </system_input>
    <system_output>
        <key>article</key>
        <description>The article that satisfies the user's request.</description>
    </system_output>
    <agents>
        <agent category="existing">
            <name>Web Surfer Agent</name>
            <description>This agent is used to search the web for the user's topic.</description>
        </agent>
        <agent category="new">
            <name>Outline Agent</name>
            <description>This agent is used to write an outline for the user's topic.</description>
        </agent>
        <agent category="new">
            <name>Evaluator Agent</name>
            <description>This agent is used to evaluate the outline of the user's topic.</description>
        </agent>
        <agent category="new">
            <name>Article Writer Agent</name>
            <description>This agent is used to write the article for the user's topic.</description>
        </agent>
    </agents>

    <events>
        <event>
            <name>on_start</name>
            <inputs>
                <input>
                    <key>user_topic</key>
                    <description>The user's topic that user wants to write a wikipiead-like article about.</description>
                </input>
            </inputs>
            <outputs>
                <output>
                    <key>user_topic</key>
                    <description>The user's topic that user wants to write a wikipiead-like article about.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
        </event>
        <event>
            <name>on_search</name>
            <inputs>
                <input>
                    <key>user_topic</key>
                    <description>The user's topic that user wants to write a wikipiead-like article about.</description>
                </input>
            </inputs>
            <task>
                search the information about the topic and return the result.
            </task>
            <outputs>
                <output>
                    <key>search_result</key>
                    <description>The search result of the user's topic.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>on_start</event>
            </listen>
            <agent>
                <name>Web Surfer Agent</name>
                <model>claude-3-5-sonnet-20241022</model>
            </agent>
        </event>
        <event>
            <name>on_outline</name>
            <inputs>
                <input>
                    <key>search_result</key>
                    <description>The search result of the user's topic.</description>
                </input>
            </inputs>
            <task>
                write an outline for the user's topic.
            </task>
            <outputs>
                <output>
                    <key>outline</key>
                    <description>The outline of the user's topic.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>on_start</event>
            </listen>
            <agent>
                <name>Outline Agent</name>
                <model>claude-3-5-sonnet-20241022</model>
            </agent>
        </event>
        <event>
            <name>on_evaluate</name>
            <inputs>
                <input>
                    <key>outline</key>
                    <description>The outline of the user's topic.</description>
                </input>
            </inputs>
            <task>
                evaluate the outline of the user's topic.
            </task>
            <outputs>
                <output>
                    <key>positive_feedback</key>
                    <description>The positive feedback of the outline of the user's topic.</description>
                    <condition>
                        If the outline is good enough, give positive feedback.
                    </condition>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
                <output>
                    <key>negative_feedback</key>
                    <description>The negative feedback of the outline of the user's topic.</description>
                    <condition>
                        If the outline is not good enough, give negative feedback.
                    </condition>
                    <action>
                        <type>GOTO</type>
                        <value>on_outline</value>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>on_outline</event>
            </listen>
            <agent>
                <name>Evaluator Agent</name>
                <model>claude-3-5-sonnet-20241022</model>
            </agent>
        </event>
        <event>
            <name>on_write</name>
            <inputs>
                <input>
                    <key>outline</key>
                    <description>The outline of user's topic.</description>
                </input>
            </inputs>
            <task>
                write the article for the user's topic.
            </task>
            <outputs>
                <output>
                    <key>article</key>
                    <description>The article of the user's topic.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>on_evaluate</event>
            </listen>
            <agent>
                <name>Article Writer Agent</name>
                <model>claude-3-5-sonnet-20241022</model>
            </agent>
        </event>
    </events>
</workflow>

GUIDELINES:
1. Each event should have clear inputs and outputs
2. Use conditions to handle different outcomes
3. Properly chain events using the listen element
4. Review steps should be included for quality control
5. Action types should be either RESULT or ABORT

Follow these examples and guidelines to create appropriate workflow forms based on user requirements.
\end{lstlisting}

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Tools, caption={Tools of \textbf{Workflow Editor Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
[list_agents, create_agent, execute_command, read_agent, terminal_page_down, terminal_page_up, terminal_page_to, list_workflows, create_workflow, run_workflow]
\end{lstlisting}

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, caption={System Prompt of \textbf{Workflow Editor Agent}}, frame=shadowbox,xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth]
You are a Workflow Creator specialized in the MetaChain framework. Your primary responsibility is to create and manage workflows based on XML-formatted workflow forms.

CORE RESPONSIBILITIES:
1. Parse and implement workflow forms
2. Create necessary agents if specified in the workflow
3. Create and manage workflows
4. Execute workflows as needed

AVAILABLE FUNCTIONS:
1. Workflow Management:
   - `create_workflow`: Create new workflows based on the workflow form
   - `run_workflow`: Execute the created workflow
   - `list_workflows`: Display all available workflows

2. Agent Management (when needed):
   - `create_agent`: Create new agents if specified in the workflow form. If no tools are explicitly specified, use empty tool list ([])
   - `read_agent`: Retrieve existing agent definitions before updates
   - `list_agents`: Display all available agents

3. System Tools:
   - `execute_command`: Handle system dependencies
   - `terminal_page_down`, `terminal_page_up`, `terminal_page_to`: Navigate terminal output

WORKFLOW CREATION PROCESS:

1. Parse Workflow Form:
   - Analyze the workflow form carefully
   - Identify any new agents that need to be created
   - Understand the workflow structure and requirements

2. Create Required Agents:
   - For each new agent in the workflow form:
     * Use `create_agent` with appropriate parameters
     * If no tools specified, use empty tool list ([])
     * Verify agent creation success

3. Create Workflow:
   - Use `create_workflow` to generate the workflow
   - Ensure all required agents exist
   - Validate workflow structure

4. Execute Workflow:
   - Use `run_workflow` to execute the created workflow
   - Monitor execution progress
   - Handle any errors appropriately

BEST PRACTICES:
1. Always check if required agents exist before creating new ones
2. Use empty tool list ([]) when no specific tools are mentioned
3. Validate workflow creation before execution
4. Follow the exact specifications from the workflow form XML
5. Handle errors and dependencies appropriately

Remember: Your primary goal is to create and execute workflows according to the provided workflow forms, creating any necessary agents along the way.
\end{lstlisting}


\subsection{Supplementary Experimental Findings}

\subsubsection{Case of `DaVinci Agent'}
The XML Form of \textbf{DaVinci Agent} generated by the Agent Profiling Agent is shown in List~\ref{lst:single_form}. The logos of our \model\ generated by the created DaVinci Agent are displayed in Fig~\ref{fig:logos}.
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=shadowbox, columns=fullflexible, breaklines=true, breakatwhitespace=true, breakindent=3pt, language=XML, xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth, caption={AI-generated Creation Profile of \textbf{DaVinci Agent}}, label={lst:single_form}]
<agents>
    <system_input>
        A natural language description for generating an image and evaluating its quality.
    </system_input>
    <system_output>
        <key>image_evaluation</key>
        <description>The evaluation of the generated image after processing.</description>
    </system_output>
    <agent>
        <name>DaVinci Agent</name>
        <description>The DaVinci Agent is designed to generate images from natural language 
descriptions, evaluate them using predefined criteria, and iteratively refine the image 
based on the evaluations.</description>
        <instructions>Use the HF model 'Efficient-Large-Model/Sana_600M_1024px_diffusers' to
generate images from provided descriptions, evaluate these using visual QA, and refine based
on feedback.</instructions>
        <tools category="existing">
            <tool>
                <name>visual_question_answering</name>
                <description>This tool is used to answer questions about attached images or 
videos.</description>
            </tool>
        </tools>
        <tools category="new">
            <tool>
                <name>generate_image</name>
                <description>Generate an image from a natural language description and save 
it to a specified path using the HF model 
'Efficient-Large-Model/Sana_600M_1024px_diffusers'.</description>
            </tool>
            <tool>
                <name>refine_image</name>
                <description>Make iterative adjustments to the generated image based on 
evaluation results to meet quality criteria.</description>
            </tool>
        </tools>
        <agent_input>
            <key>image_description</key>
            <description>A natural language description to generate an image.</description>
        </agent_input>
        <agent_output>
            <key>image_evaluation</key>
            <description>The evaluation of the generated image after 
processing.</description>
        </agent_output>
    </agent>
</agents>
\end{lstlisting}


\begin{figure}[htbp]
    \centering
    \subfigure[Sample 1]{
        \includegraphics[width=0.3\textwidth]{figs/ai_gen/ai_gen1.png}
    }
    \subfigure[Sample 2]{
        \includegraphics[width=0.3\textwidth]{figs/ai_gen/ai_gen2.png}
    }
    \subfigure[Sample 3]{
        \includegraphics[width=0.3\textwidth]{figs/ai_gen/ai_gen3.png}
    }
    \caption{The AI-generated \model's logos. }\label{fig:logos}
\end{figure}

\subsubsection{Case of `Financial Agent'}
The XML Form of \textbf{Financial Agent} generated by the Agent Profiling Agent is shown in List~\ref{lst:multi_form}. The financial report generated by the created Financial Agent is displayed in List~\ref{lst:fin_report}.
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=shadowbox, columns=fullflexible, breaklines=true, breakatwhitespace=true, breakindent=3pt, language=XML, xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth, caption={AI-generated Creation Profile of \textbf{Financial Agent}}, label={lst:multi_form}]
<agents>
    <system_input>
        Financial management requests, including:
        1. Managing private financial documents stored in the 'financial_docs' folder
        2. Retrieving online financial information for specific companies (balance sheets, cash flow statements, income statements)
    </system_input>
    <system_output>
        <key>financial_response</key>
        <description>Detailed response containing either document management results or requested financial information.</description>
    </system_output>
    <agent>
        <name>Document Manager Agent</name>
        <description>Specialized agent for managing and analyzing private financial documents stored locally.</description>
        <instructions>You are responsible for managing financial documents in the 'financial_docs' folder. Your tasks include:
1. Organizing and categorizing financial documents
2. Extracting relevant information from documents
3. Providing summaries and analyses of document contents
4. Maintaining document organization and searchability</instructions>
        <tools category="existing">
            <tool>
                <name>save_raw_docs_to_vector_db</name>
                <description>Save the financial documents to the vector database for efficient searching and retrieval.</description>
            </tool>
            <tool>
                <name>query_db</name>
                <description>Search through stored financial documents to find relevant information.</description>
            </tool>
            <tool>
                <name>visual_question_answering</name>
                <description>Process and analyze any financial charts, graphs, or visual data in the documents.</description>
            </tool>
        </tools>
        <agent_input>
            <key>doc_request</key>
            <description>User request related to managing or querying private financial documents.</description>
        </agent_input>
        <agent_output>
            <key>doc_response</key>
            <description>Results of document management operations or requested document information.</description>
        </agent_output>
    </agent>
    <agent>
        <name>Market Research Agent</name>
        <description>Specialized agent for retrieving and analyzing online financial information for publicly traded companies.</description>
        <instructions>You are responsible for retrieving and analyzing financial information from online sources. Your tasks include:
1. Fetching balance sheets, cash flow statements, and income statements
2. Analyzing financial metrics and trends
3. Providing clear summaries of financial data
4. Ensuring data accuracy and proper citation of sources</instructions>
        <tools category="new">
            <tool>
                <name>get_balance_sheet</name>
                <description>Retrieve balance sheet data for a specific ticker over a given time period.</description>
            </tool>
            <tool>
                <name>get_cash_flow</name>
                <description>Retrieve cash flow statement data for a specific ticker over a given time period.</description>
            </tool>
            <tool>
                <name>get_income_statement</name>
                <description>Retrieve income statement data for a specific ticker over a given time period.</description>
            </tool>
            <tool>
                <name>analyze_financial_data</name>
                <description>Analyze and summarize financial statements to provide meaningful insights.</description>
            </tool>
        </tools>
        <agent_input>
            <key>market_request</key>
            <description>User request for online financial information including ticker symbol and time period.</description>
        </agent_input>
        <agent_output>
            <key>market_response</key>
            <description>Requested financial information and analysis from online sources.</description>
        </agent_output>
    </agent>
</agents>
\end{lstlisting}

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=shadowbox, columns=fullflexible, breaklines=true, breakatwhitespace=true, breakindent=3pt, language=Prompt, xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth, caption={The report generated by AI-generated \textbf{Financial Agent}}, label={lst:fin_report}]
Based on the comprehensive analysis of both historical performance from 10-K reports and current financial data, here is the final investment recommendation for 2025:

Investment Recommendation Summary for 2025:

1. Portfolio Allocation Strategy:
- Microsoft (MSFT): 60% of technology allocation
- Apple (AAPL): 40% of technology allocation

2. Investment Rationale:

Microsoft (MSFT) - Primary Position (60%):
- Leading AI integration and monetization potential
- Superior profit margins (37.61% vs 15.52%)
- Strong cloud revenue growth (23% YoY)
- Successful Activision Blizzard integration
- Robust enterprise market position
- Higher recent revenue growth momentum
- Strong cash position ($78.43B)
- Clear AI leadership advantages

Apple (AAPL) - Supporting Position (40%):
- Superior capital efficiency (ROC: 43.01%)
- Higher Return on Assets (21.24%)
- Strong services growth potential
- Reliable cash flow generation
- Consistent shareholder returns
- Valuable ecosystem lock-in
- Strong emerging market potential
- Value characteristics at current levels

3. Key Monitoring Points for 2025:

Microsoft:
- Cloud market share gains
- AI revenue monetization
- Gaming division integration
- Enterprise spending trends
- Margin sustainability
- Regulatory developments

Apple:
- Services revenue growth
- iPhone replacement cycles
- Emerging market penetration
- Margin pressure management
- AI/ML integration progress
- Supply chain diversification

4. Risk Management Strategy:

Short-term (0-6 months):
- Monitor AI monetization progress
- Track iPhone 15 cycle performance
- Watch macro economic indicators
- Observe cloud growth metrics

Medium-term (6-12 months):
- Evaluate competitive positions in AI
- Assess services growth trajectory
- Monitor regulatory environment
- Track enterprise spending trends

Long-term (12+ months):
- Evaluate ecosystem strength
- Monitor technological shifts
- Assess market share dynamics
- Track return on capital trends

5. Investment Approach:

Implementation Strategy:
- Consider dollar-cost averaging for new positions
- Maintain quarterly rebalancing schedule
- Set stop-loss levels based on risk tolerance
- Monitor position sizes relative to overall portfolio

Adjustment Triggers:
- Significant margin deterioration
- Market share losses in key segments
- Major regulatory actions
- Substantial technological disruption
- Material changes in competitive position

The 60/40 split in favor of Microsoft reflects:
1. Stronger near-term growth prospects in AI and cloud
2. Higher profit margins and improving efficiency metrics
3. Better positioning in enterprise markets
4. More diverse revenue streams
5. Clear leadership in next-generation technologies

However, Apple's position remains crucial due to:
1. Superior capital efficiency
2. Strong ecosystem advantages
3. Significant services growth potential
4. Value characteristics at current levels
5. Consistent shareholder returns

This balanced approach provides exposure to both immediate growth opportunities through Microsoft's AI and cloud leadership, while maintaining stability through Apple's efficient operations and ecosystem strength. Regular monitoring and rebalancing will be essential to maintain optimal positioning as market conditions evolve through 2025.
\end{lstlisting}


\subsubsection{Case of `Majority Voting' workflow}
The XML Form of \textbf{`Majority Voting' Workflow} generated by the {Workflow Profiling Agent} is shown in List~\ref{lst:workflow_form}. A comparison between the math reasoning results of the created `Majority Voting' Workflow and the math reasoning results of a single DeepSeek-V3 model is presented in Tab~\ref{tab:workflow_error}.
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=shadowbox, columns=fullflexible, breaklines=true, breakatwhitespace=true, breakindent=3pt, language=XML, xleftmargin=0.02\linewidth, xrightmargin=0.02\linewidth, caption={AI-generated Creation Profile of \textbf{`Majority Voting' workflow}}, label={lst:workflow_form}]
<workflow>
    <name>parallel_math_solver_workflow</name>
    <system_input>
        <key>math_problem</key>
        <description>The math problem that needs to be solved.</description>
    </system_input>
    <system_output>
        <key>final_solution</key>
        <description>The final solution determined by majority voting.</description>
    </system_output>
    <agents>
        <agent category="new">
            <name>Math Solver Agent</name>
            <description>This agent solves mathematical problems using analytical and systematic approaches.</description>
        </agent>
        <agent category="new">
            <name>Vote Aggregator Agent</name>
            <description>This agent aggregates solutions from different solvers and determines the final answer through majority voting.</description>
        </agent>
    </agents>
    <events>
        <event>
            <name>on_start</name>
            <inputs>
                <input>
                    <key>math_problem</key>
                    <description>The math problem that needs to be solved.</description>
                </input>
            </inputs>
            <outputs>
                <output>
                    <key>math_problem</key>
                    <description>The math problem that needs to be solved.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
        </event>
        <event>
            <name>solve_with_gpt4</name>
            <inputs>
                <input>
                    <key>math_problem</key>
                    <description>The math problem that needs to be solved.</description>
                </input>
            </inputs>
            <task>Solve the math problem using systematic approach with GPT-4.</task>
            <outputs>
                <output>
                    <key>gpt4_solution</key>
                    <description>The solution from GPT-4 solver.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>on_start</event>
            </listen>
            <agent>
                <name>Math Solver Agent</name>
                <model>gpt-4o-2024-08-06</model>
            </agent>
        </event>
        <event>
            <name>solve_with_claude</name>
            <inputs>
                <input>
                    <key>math_problem</key>
                    <description>The math problem that needs to be solved.</description>
                </input>
            </inputs>
            <task>Solve the math problem using systematic approach with Claude.</task>
            <outputs>
                <output>
                    <key>claude_solution</key>
                    <description>The solution from Claude solver.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>on_start</event>
            </listen>
            <agent>
                <name>Math Solver Agent</name>
                <model>claude-3-5-sonnet-20241022</model>
            </agent>
        </event>
        <event>
            <name>solve_with_deepseek</name>
            <inputs>
                <input>
                    <key>math_problem</key>
                    <description>The math problem that needs to be solved.</description>
                </input>
            </inputs>
            <task>Solve the math problem using systematic approach with DeepSeek.</task>
            <outputs>
                <output>
                    <key>deepseek_solution</key>
                    <description>The solution from DeepSeek solver.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>on_start</event>
            </listen>
            <agent>
                <name>Math Solver Agent</name>
                <model>deepseek/deepseek-chat</model>
            </agent>
        </event>
        <event>
            <name>aggregate_solutions</name>
            <inputs>
                <input>
                    <key>gpt4_solution</key>
                    <description>The solution from GPT-4 solver.</description>
                </input>
                <input>
                    <key>claude_solution</key>
                    <description>The solution from Claude solver.</description>
                </input>
                <input>
                    <key>deepseek_solution</key>
                    <description>The solution from DeepSeek solver.</description>
                </input>
            </inputs>
            <task>Compare all solutions and determine the final answer through majority voting.</task>
            <outputs>
                <output>
                    <key>final_solution</key>
                    <description>The final solution determined by majority voting.</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>solve_with_gpt4</event>
                <event>solve_with_claude</event>
                <event>solve_with_deepseek</event>
            </listen>
            <agent>
                <name>Vote Aggregator Agent</name>
                <model>deepseek/deepseek-chat</model>
            </agent>
        </event>
    </events>
</workflow>
\end{lstlisting}
\input{appendix/mathcase}

\subsubsection{Detailed Trajectory of Creating `Financial Agent'}
% \begin{table*}[h!]
% \centering
To provide a more comprehensive demonstration of how \model\ receives user requirements and automates the creation of tools and agents, we present the specific agent trajectory for the creation of the Financial Agent as follows.


\begin{center}

% \small
% \resizebox{0.46\textwidth}{!}{
% \resizebox{0.90\textwidth}{!}{
% \adjustbox{width=0.95\textwidth, keepaspectratio}{ % 缩放表格宽度，保持字体大小不变
\begin{longtable}{p{3cm}|p{4.5cm}|p{6cm}}
\caption{Detailed Trajectory of Creating `Financial Agent'.}
\label{tab:traj_fin_agent}\\
\toprule
\textbf{Role} & \textbf{Action} & \textbf{Content}     \\
 \midrule

\faUser: \textbf{\texttt{User}} & Input & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
I want to create `Financial Agent` that can help me to do two kinds of tasks:
1. Manage the private financial docs. I have a folder that contain the financial docs in my local machine, and I want to help me to manage them.
2. Search the financial information online. You may help me to: 
- get balance sheets for a given ticker over a given period.
- get cash flow statements for a given ticker over a given period.
- get income statements for a given ticker over a given period.

Directly output the form in the XML format without ANY other text.
\end{lstlisting}\vspace{-0.15in}  \\
\midrule


\faAndroid: \textbf{\texttt{Agent Profiling Agent}}  & output & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
<agents>
    <system_input>
        Financial management requests, including:
        ...
    </system_input>
    <system_output>
        <key>financial_response</key>
        ...
    </system_output>
    <agent>
        <name>Document Manager Agent</name>
        ...
    </agent>
    <agent>
        <name>Market Research Agent</name>
        ...
    </agent>
</agents>
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Tool Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
list_tools()
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
{
    "save_raw_docs_to_vector_db": {
        "name": "save_raw_docs_to_vector_db",
        "func_name": "save_raw_docs_to_vector_db",
        "args": [
            "context_variables",
            "doc_name",
            "saved_vector_db_name",
            "overwrite"
        ],
        "docstring": 
        ...
    },
    ...
}
\end{lstlisting}\vspace{-0.15in}
\\
\midrule
\faAndroid: \textbf{\texttt{Tool Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
get_api_plugin_tools_doc
('query_text'='API for getting financial 
statements (balance sheet, cash flow, income statement) 
from stock market')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
The rank 1 referenced tool documentation is:
API Name: Company Income Statement
...
The rank 2 referenced tool documentation is:
...
...
\end{lstlisting}\vspace{-0.15in}
\\
\midrule
\faAndroid: \textbf{\texttt{Tool Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
create_tool(
'tool_name'=
'get_balance_sheet',
'tool_code'=
'from metachain.types import Result, Agent
...
')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
[SUCCESS] Successfully created tool: get_balance_sheet in /workplace/metachain/metachain/
tools/get_balance_sheet.py
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Tool Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
run_tool(
'tool_name'=
'get_balance_sheet', 
'run_code'=
'from metachain.tools import get_balance_sheet
result = 
get_balance_sheet("AAPL", "QUARTERLY")
print(result)')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
[The output of the tool `run_tool` showing in the interactive terminal]
Terminal viewport position: Showing page 1 of 1.
======================
[SUCCESS] 
{
  "symbol": "AAPL:NASDAQ",
  "type": "stock",
  "period": "QUARTERLY",
  "balance_sheet": [
  ...
======================
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Tool Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
create_tool(
'tool_name'=
'get_cash_flow', 
'tool_code'=
'from metachain.types import Result, Agent
...
')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
[SUCCESS] Successfully created tool: get_cash_flow in /workplace/metachain/metachain/
tools/get_cash_flow.py
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Tool Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
run_tool(
'tool_name'=
'get_cash_flow', 
'run_code'=
'from metachain.tools import get_cash_flow
result = get_cash_flow("AAPL", "QUARTERLY")
print(result)')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
[The output of the tool `run_tool` showing in the interactive terminal]
Terminal viewport position: Showing page 1 of 1.
======================
[SUCCESS]
{
  "symbol": "AAPL:NASDAQ",
  "type": "stock",
  "period": "QUARTERLY",
  "cash_flow": [
  ...
======================
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Tool Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
create_tool(
'tool_name'=
'get_income_statement', 
'tool_code'=
'from metachain.types import Result, Agent
...')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
[SUCCESS] Successfully created tool: get_income_statement in /workplace/metachain/metachain/
tools/get_income_statement.py
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Tool Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
run_tool(
'tool_name'=
'get_income_statement', 
'run_code'='from metachain.tools import get_income_statement
result = get_income_statement
("AAPL", "QUARTERLY")
print(result)')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
[The output of the tool `run_tool` showing in the interactive terminal]
Terminal viewport position: Showing page 1 of 1.
======================
[SUCCESS]
{
  "symbol": "AAPL:NASDAQ",
  "type": "stock",
  "period": "QUARTERLY",
  "income_statement": [
  ...
======================
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Tool Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
create_tool(
'tool_name'=
'analyze_financial_data', 
'tool_code'=
'from metachain.types import Result, Agent
...
')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
[SUCCESS] Successfully created tool: analyze_financial_data in /workplace/metachain/metachain/
tools/analyze_financial_data.py
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Tool Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
run_tool(
'tool_name'=
'analyze_financial_data', 
'run_code'=
'from metachain.tools import get_income_statement, analyze_financial_data
income_data = get_income_statement
("AAPL", "QUARTERLY")
result = analyze_financial_data
(income_data)
print(result)')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
[The output of the tool `run_tool` showing in the interactive terminal]
Terminal viewport position: Showing page 1 of 1.
======================
[SUCCESS] 
Financial Analysis for AAPL:NASDAQ
----------------------
Income Statement Analysis:
For the period ending 2024-9-28:
...

Profitability Metrics:
...

Period-over-Period Comparison:
...

======================
\end{lstlisting}\vspace{-0.15in}
\\
\midrule
\faAndroid: \textbf{\texttt{Tool Editor Agent}}  & Output & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
Successfully created and tested all four financial tools:

1. get_balance_sheet - Created and tested successfully with AAPL stock data
2. get_cash_flow - Created and tested successfully with AAPL stock data
3. get_income_statement - Created and tested successfully with AAPL stock data
4. analyze_financial_data - Created and tested successfully by analyzing AAPL's income statement data

All tools are functioning as expected, providing financial data and analysis in proper JSON format.
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Agent Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
create_agent(
'agent_name'=
'Document Manager Agent', 
'agent_description'=
'Specialized agent for managing and analyzing private financial documents stored locally.', 
'agent_tools'=
['query_db', ...],
'agent_instructions'='You are a specialized financial document manager responsible for managing and analyzing financial documents stored in specified directories. Your tasks include:...')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
Successfully created agent: Document Manager Agent in /workplace/metachain/metachain/
agents/document_manager_agent.py
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Agent Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
create_agent(
'agent_name'=
'Market Research Agent', 
'agent_description'=
'Specialized agent for retrieving and analyzing online financial information for publicly traded companies.', 
'agent_tools'=
['get_cash_flow', ...], 
'agent_instructions'=
'You are a specialized market research agent responsible for retrieving and analyzing financial information from online sources. Your primary responsibilities include: ...')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
Successfully created agent: Market Research Agent in /workplace/metachain/metachain/
agents/market_research_agent.py
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Agent Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, escapechar=|]
create_orchestrator_agent
('agent_name'=
'Financial Analysis Orchestrator', 
'agent_description'=
'Orchestrator agent that coordinates between document management and market research to provide comprehensive financial analysis.', 
'sub_agents'=[{'name': 'Document Manager Agent', 'agent_input': |\textcolor{red}{'Document analysis request ...'}|, 'agent_output': |\textcolor{red}{'Analyzed information ...'}|}, {'name': 'Market Research Agent', 'agent_input': |\textcolor{red}{'Market research request ...'}|, 'agent_output': |\textcolor{red}{'Market analysis ...'}|}], 
'agent_instructions'=
'You are a Financial Analysis Orchestrator responsible for coordinating comprehensive financial analysis by leveraging both document analysis and market research capabilities. Your workflow: ...')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, escapechar=|]

|\textcolor{red}{[ERROR]}| Failed to create agent. Error:   File "/workplace/metachain/metachain/
agents/financial_analysis_orchestrator.py", line 32
    def transfer_to_document_manager_agent(Document analysis request including directory paths and analysis requirements: str):
                                                    ^^^^^^^^
SyntaxError: invalid syntax

\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Agent Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
create_orchestrator_agent
('agent_name'=
'Financial Analysis Orchestrator',
'agent_description'=
'Orchestrator agent that coordinates between document management and market research to provide comprehensive financial analysis.', 
'sub_agents'=[{'name': 'Document Manager Agent', 'agent_input': 'doc_request', 'agent_output': 'doc_response'}, {'name': 'Market Research Agent', 'agent_input': 'market_request', 'agent_output': 'market_response'}],
'agent_instructions'=
'You are a Financial Analysis Orchestrator responsible for coordinating comprehensive financial analysis by leveraging both document analysis and market research capabilities. Your workflow: ...')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, escapechar=|]
Successfully created agent: Financial Analysis Orchestrator in /workplace/metachain/metachain/
agents/financial_analysis_orchestrator.py

\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Agent Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
run_agent(
'agent_name'=
'Financial Analysis Orchestrator', 
'query'=
"Based on the 10-K reports of AAPL and MSFT from the past 5 years in the docs directory `docs/
aapl-2020-2024-10K/` and `docs/
msft-2020-2024-10K/`, along with AAPL's other reports `docs/
aapl-other-report/` and available data, conduct a comprehensive horizontal comparison, create a comparative analysis report, and provide constructive investment advice for investing in them in 2025.",
'ctx_vars'='{}')
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, escapechar=|]
[The output of the tool `run_agent` showing in the interactive terminal]
Terminal viewport position: Showing page 1 of 35.
|\textcolor{red}{[NOTE] The output of the tool `run\_agent`, you can use `terminal\_page\_up` to scroll up and `terminal\_page\_down` to scroll down. If there are many pages with meaningless content like progress bar or output of generating directory structure when there are many datasets in the directory, you can use `terminal\_page\_to` to move the viewport to the end of terminal where the meaningful content is.}|
======================
[SUCCESS] 
**** Receive Task ****
Receiveing the task:
Based on the 10-K reports of AAPL and MSFT from the past 5 years in the docs
directory ...
**** Assistant Message ****
Financial Analysis Orchestrator: I'll help coordinate a comprehensive comparative analysis between Apple (AAPL)
and Microsoft (MSFT) using both historical document analysis and current market
research. Let's break this down into parallel workflows to gather all necessary
information.

1. First, let's analyze the historical documents (10-K reports and other
reports):
**** Tool Calls ****
[2025-01-22 05:58:48]
transfer_to_document_manager_agent
('doc_request'='...')
**** Tool Execution ****
[2025-01-22 05:58:48]
Tool Execution: transfer_to_document_manager_agent
Result:
---
Please analyze the following documents:
...

**** Assistant Message ****
Document Manager Agent: ...
======================
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Agent Editor Agent}}  & \vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=Prompt, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}]
terminal_page_to
('page_idx'=35)
\end{lstlisting}\vspace{-0.15in} & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, escapechar=|]
[The output of the tool `run_agent` showing in the interactive terminal]
Terminal viewport position: Showing page 35 of 35.
|\textcolor{red}{[NOTE] The output of the tool `run\_agent`, you can use `terminal\_page\_up` to scroll up and `terminal\_page\_down` to scroll down. If there are many pages with meaningless content like progress bar or output of generating directory structure when there are many datasets in the directory, you can use `terminal\_page\_to` to move the viewport to the end of terminal where the meaningful content is.}|
======================
**** Assistant Message ****
Financial Analysis Orchestrator: Based on the comprehensive analysis of both historical performance from 10-K
reports and current financial data, here is the final investment recommendation
for 2025:

Investment Recommendation Summary for 2025:

1. Portfolio Allocation Strategy:
- Microsoft (MSFT): 60% of technology allocation
- Apple (AAPL): 40% of technology allocation

2. Investment Rationale:

Microsoft (MSFT) - Primary Position (60%):
...
======================
\end{lstlisting}\vspace{-0.15in}
\\
\midrule

\faAndroid: \textbf{\texttt{Agent Editor Agent}}  & Output & 

\vspace{-0.15in}\begin{lstlisting}[basicstyle=\ttfamily\footnotesize, frame=none, columns=fullflexible, breaklines=true, breakatwhitespace=ture, breakindent=0pt, language=XML, postbreak=\mbox{\textcolor{gray}{$\hookrightarrow$}\space}, escapechar=|]
I have successfully created and tested the following agents:

1. Document Manager Agent - for managing and analyzing private financial documents
2. Market Research Agent - for retrieving and analyzing online financial information
3. Financial Analysis Orchestrator - coordinates between the two agents for comprehensive analysis

The agents were tested with a complex task of analyzing AAPL and MSFT's financial documents and providing investment advice. The orchestrator successfully:
1. Processed 10-K reports from both companies
2. Analyzed financial metrics and trends
3. Generated a comprehensive investment recommendation with:
   - Portfolio allocation strategy
   - Investment rationale for each company
   - Key monitoring points
   - Risk management strategy
   - Implementation approach

The test demonstrated that the agents can effectively work together to provide detailed financial analysis and actionable investment advice.
\end{lstlisting}\vspace{-0.15in}
\\
% \midrule

\bottomrule
\end{longtable}
\end{center}


% \input{relate}