\section{Additional Statistical Tests}
\label{sec:appendix-tests}

To further explore whether potential bias arises under different conditions, we implement three complementary strategies:  (1) a \textbf{single-factor analysis} that does not control for confounding variables, (2) a \textbf{matched subset analysis} that fixes control features, and (3) a \textbf{down-sampled matched analysis} that enforces balanced sample sizes.  \footnote{We note that, due to the complete coverage of all attribute combinations in our dataset, the single-factor and matched-subset approaches yield identical results in this specific case; however, we describe both for conceptual clarity.}  Below, we describe each data manipulation strategy, followed by a description of the statistical tests applied to the resulting datasets.  


\subsection{Data Subsetting and Sampling Strategies}

\paragraph{(1) Single-Factor (No Confound Control).}
In the simplest approach, we do not explicitly control for other attributes. We group the data by the \emph{focal} attribute (e.g., \emph{gender} = Female vs.\ Male) and compare detection outcomes.  This is a baseline approach that is straightforward but may be susceptible to confounding.

\paragraph{(2) Matched Subset (Fixing Control Features).}
In a more controlled approach, we fix all \emph{other} (control) attributes so that \emph{only} the \emph{main feature} varies among samples. Suppose our main feature has values \(\{f_1, f_2, \dots, f_n\}\). For each unique combination of the control features (e.g., \textit{CEFR} = B2, \textit{environment} = ESL), we identify those samples that share exactly those control-feature values but differ \emph{exclusively} in the main feature. We keep only the combinations that contain \emph{all} categories \(\{f_1,\dots,f_n\}\). Concatenating these subsets yields a matched dataset where any difference in detector outcomes is more plausibly attributed to the main feature rather than being confounded by other factors. Algorithm~\ref{alg:matched-subset} shows how we construct the matched subset.

Mathematically, let
\[
  \mathcal{C} = \{ c_1, \dots, c_r \}
  \quad\text{and}\quad
  \Omega = \bigtimes_{j=1}^r \mathrm{Levels}(c_j).
\]
For each combination \(\boldsymbol{\omega} \in \Omega\), we form the subset 
\[
  S_{\boldsymbol{\omega}}
  \;=\;
  \bigl\{
    x \in D \;\mid\; x[c_j] = \omega_j,\;\forall c_j \in \mathcal{C}
  \bigr\}.
\]
If \(S_{\boldsymbol{\omega}}\) spans all main feature categories, we retain it. We then unify these retained subsets to form 
\[
  \mathrm{Matched}
  \;=\;
  \bigcup_{\boldsymbol{\omega}\,\in\,\Omega :\, \{\!f_1,\dots,f_n\!\}\subseteq \text{MainFeature}(S_{\boldsymbol{\omega}})}
  S_{\boldsymbol{\omega}}.
\]

\begin{algorithm}[!h]
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\begin{algorithmic}[1]
    \REQUIRE Dataset $D$, main feature $F$ with categories $\{f_1,\ldots,f_n\}$, control features $\mathcal{C} = \{c_1,\dots,c_r\}$
    \ENSURE A subset $M$ where only $F$ varies in each control-feature combo
    \STATE $M \leftarrow \emptyset$
    \STATE $\Omega \leftarrow \mathrm{CartProd}\bigl(\mathrm{Levels}(c_1), \dots, \mathrm{Levels}(c_r)\bigr)$
    \FOR{each $\boldsymbol{\omega} \in \Omega$}
        \STATE $S_{\boldsymbol{\omega}} \leftarrow \bigl\{\,x \in D \;\mid\;\forall j,\, x[c_j] = \omega_j \bigr\}$
        \STATE $\mathcal{F}_{\boldsymbol{\omega}} \leftarrow \{\text{main feature value for } x \in S_{\boldsymbol{\omega}}\}$
        \IF{$\{f_1,\dots,f_n\} \subseteq \mathcal{F}_{\boldsymbol{\omega}}$}
            \STATE $M \leftarrow M \,\cup\, S_{\boldsymbol{\omega}}$
        \ENDIF
    \ENDFOR
    \RETURN $M$
\end{algorithmic}
\caption{Matched Subset (Fix Control Features)}
\label{alg:matched-subset}
\end{algorithm}


\paragraph{(3) Down-Sampled Matched (One-to-One Matching).}
Even if the matched dataset includes all main-feature categories, different groups may still have \emph{unequal} sample sizes. In this one-to-one variant, we require that for every record in the \emph{smallest} category (within each combination of control features), there is exactly \emph{one} matched record in every other category. Concretely, for each record in the smallest category, we randomly select \emph{one} record from each larger category that shares the same control-feature values. This ensures balanced sample sizes \emph{and} enforces a strict one-to-one matching across categories, though it may discard additional data from larger categories. Algorithm~\ref{alg:downsample-one-to-one} shows how to downsample to create matched data.

Formally, let
\[
   \Omega \;=\; \mathrm{CartProd}\bigl(\mathrm{Levels}(c_1), \dots, \mathrm{Levels}(c_r)\bigr),
\]
be the Cartesian product of all levels of control features $C = \{c_1, \dots, c_r\}$. For each $\boldsymbol{\omega} \in \Omega$, define
\[
   S_{\boldsymbol{\omega}}
   \;=\;
   \bigl\{\,
     x \in D
     \;\mid\;
     \forall c_j \in C,\;\;
     x[c_j] = \omega_j
   \bigr\},
\]
the subset of $D$ whose rows match the control-feature values in $\boldsymbol{\omega}$. Let $f_{k^*}$ be the category of the main feature $F$ with the fewest samples in $S_{\boldsymbol{\omega}}$. For each $x \in S_{\boldsymbol{\omega}}$ with $x[F] = f_{k^*}$, define a matched set

\[
\begin{aligned}
S_x 
  &= \{x\} 
     \;\cup\;
     \bigcup_{\substack{f_i \in \{f_1,\dots,f_n\} \\ f_i \neq f_{k^*}}}
     \Bigl\{\, 
       y \in S_{\boldsymbol{\omega}}
       \;\big|\;
       y[F] = f_i, \\[6pt]
  &\quad\quad
       \text{$y$ is sampled exactly once}
     \Bigr\}.
\end{aligned}
\]
where we pick exactly one such $y$ randomly from the available rows each time (removing it to prevent re-use).  
The overall matched subset for $\boldsymbol{\omega}$ is then
\[
   \tilde{S}_{\boldsymbol{\omega}}
   \;=\;
   \bigcup_{\,x : x[F] = f_{k^*}}
   S_x,
\]
and the final down-sampled matched dataset is
\[
   M
   \;=\;
   \bigcup_{\,\boldsymbol{\omega} \,\in\, \Omega}
   \tilde{S}_{\boldsymbol{\omega}}.
\]
This matching enforces that each record in the smallest category is paired one-to-one with exactly one record from each of the other categories.

\begin{algorithm}[!h]
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\begin{algorithmic}[1]
    \REQUIRE Dataset $D$, main feature $F$ with categories $\{f_1,\dots,f_n\}$, control features $C = \{c_1,\dots,c_r\}$
    \ENSURE A balanced, matched dataset $M$ where each sample in the smallest category is paired one-to-one with exactly one sample in every other category, for the same control-feature values
    \STATE $M \leftarrow \emptyset$
    \STATE $\Omega \leftarrow \mathrm{CartProd}\bigl(\mathrm{Levels}(c_1), \dots, \mathrm{Levels}(c_r)\bigr)$
    \FOR{each $\boldsymbol{\omega} \in \Omega$}
        \STATE $S_{\boldsymbol{\omega}} \leftarrow \bigl\{\,x \in D \;\mid\;\forall j,\, x[c_j] = \omega_j \bigr\}$
        \STATE Let $\{f_{k^*}\}$ be the category in $S_{\boldsymbol{\omega}}$ with the fewest samples (the ``smallest'' category)
        \FOR{each $x \in S_{\boldsymbol{\omega}}$ such that $x[F] = f_{k^*}$}
            \STATE $S_{x} \leftarrow \{x\}$ \COMMENT{Start a matched set with the sample from the smallest category}
            \FOR{each $f_i \in \{f_1,\dots,f_n\} \setminus \{f_{k^*}\}$}
                \STATE From $S_{\boldsymbol{\omega}}$ with $F = f_i$, randomly pick exactly one sample $y$ (if any remain)
                \STATE $S_{x} \leftarrow S_{x} \cup \{y\}$
                \STATE Remove $y$ from $S_{\boldsymbol{\omega}}$ to prevent re-use
            \ENDFOR
            \STATE $M \leftarrow M \cup S_{x}$
        \ENDFOR
    \ENDFOR
    \RETURN $M$
\end{algorithmic}
    \caption{Down-Sampled Matched Data Construction (One-to-One Matching)}
\label{alg:downsample-one-to-one}
\end{algorithm}

\subsection{Statistical Tests}
\label{sec:stats-focal-attr}

After applying one of the data strategies above (single-factor, matched subset, or down-sampled matched), we perform hypothesis tests to assess the significance of the focal attribute.  We use weighted statistical tests to account for the varying number of texts within each group.

\paragraph{Binary Attributes (Two Groups).}
If the focal attribute has exactly two categories (e.g., \emph{gender}: Female vs. Male), we employ Welchâ€™s two-sample \emph{t}-test \citep{student1908probable}, modified to incorporate weights. The weighted t-test, with unequal variances, is calculated as follows.

Let \(w_i\) be the weight, and let \(X_i\) be its detection accuracy of each observation. Let two groups be \(G_1\) and \(G_2\)

The weighted means:
\[
\bar{X}_k = \frac{\sum_{i \in G_k} w_i X_i}{\sum_{i \in G_k} w_i}, \quad k \in \{1,2\}.
\]

Weighted variances:
\[
\widehat{\sigma}_k^2 = \frac{\sum_{i \in G_k} w_i (X_i - \bar{X}_k)^2}{\sum_{i \in G_k} w_i}, \quad k \in \{1, 2\}.
\]

Total weights per group:
\[
W_k = \sum_{i \in G_k} w_i, \quad k \in \{1, 2\}.
\]

Weighted Welch's t-statistic:
\[
t = \frac{\bar{X}_1 - \bar{X}_2}{\sqrt{\frac{\widehat{\sigma}^2_1}{W_1} + \frac{\widehat{\sigma}^2_2}{W_2}}}.
\]

Approximate degrees of freedom:
\[
\nu \approx \frac{\left(\frac{\widehat{\sigma}^2_1}{W_1} + \frac{\widehat{\sigma}^2_2}{W_2}\right)^2}
{\frac{\left(\frac{\widehat{\sigma}^2_1}{W_1}\right)^2}{n_1 - 1} + \frac{\left(\frac{\widehat{\sigma}^2_2}{W_2}\right)^2}{n_2 - 1}},
\]
where \(n_1, n_2\) denote the (unweighted) sample counts in each group.

We compare the resulting \(p\)-value to \(\alpha\) (e.g., 0.05) to assess significance.

\paragraph{Multi-Class Attributes (More Than Two Groups).}
When the focal attribute has more than two categories, we use a weighted one-way ANOVA\citep{fisher1925statistical}, implemented via a Weighted Least Squares (WLS) regression. The model is of the form:
\[
\text{accuracy}_i \sim C(\text{focal\_attribute})
\]
with weights \(w_i\). We fit this model using `statsmodels` and then perform a Type II ANOVA. The relevant \(F\)-statistic is:
\[
F = \frac{\text{MS}_{\text{Between}}}{\text{MS}_{\text{Within}}}
\]
A significant \(p\)-value indicates that at least one category differs from the others.












