\section{Related Work}
\label{Section:Background}

%\input{Tables/RelatedWork} 
\input{Tables/SLR}
The prevailing consensus in the software refactoring literature acknowledges its overarching aim of improving software quality and correcting poor design and implementation practices \citep{Fowler:1999:RID:311424}. \textcolor{black}{\textcolor{black}{Tables \ref{Table:Quality Metrics in Related Work} and \ref{Table:Quality Metrics in Related Work-v2}} illustrate two decades of work on a long-standing question within the refactoring community: Does refactoring improve code quality? In recent years, numerous research efforts have been made to examine and explore the influence of refactoring on software quality} \citep{moser2007case,wilking2007empirical,alshayeb2009empirical, shatnawi2011empirical,bavota2015experimental, chavez2017does,mkaouer2017robust, cedrim2016does,hegedHus2010effect}. 
%\ali{some references}.
Most studies have focused on measuring internal and external quality attributes to determine the quality of a software system being refactored. \textcolor{black}{Due to space constraints, this section provides a comprehensive review of some of these studies and a discussion of the pertinent literature on the impact of refactoring on software quality.}

 
Stroulia and Kapoor \citep{stroulia2001metrics} explored the effect of size and coupling measures on software quality after the refactoring application. Their findings indicated that size and coupling metrics decreased after refactorings. Fioravanti \etal \citep{fioravanti2001reengineering} analyzed and described metrics, based on duplication analysis, that
contribute to the process of reengineering analysis of
object-oriented. Antoniol \etal \citep{antoniol2002analyzing} studies cloning evolution in the Linux kernel. Their main result revealed that the Linux system does not contain a relevant fraction of code
duplication.  Kataoka \etal \citep{kataoka2002quantitative} focused solely on coupling measures to study the impact of \textit{Extract Method} and \textit{Extract Class} refactoring operations on the maintainability of a C++ software system. Their study revealed a positive effect of refactoring on system maintainability. Demeyer \citep{demeyer2002maintainability} conducted a comparative study to investigate the impact of refactoring on performance, the results demonstrating an improvement in program performance after refactoring. In addition, Sahraoui \etal \citep{sahraoui2000can} used coupling and inheritance measures to automatically identify potential antipatterns and predict scenarios in which refactoring could enhance software maintainability. The authors found that quality metrics can help bridge the gap between design improvement and automation, but in some situations the process cannot be fully automated, as it requires the programmer's validation through manual inspection. 

Tahvildari \etal \citep{tahvildari2003quality} introduced a software transformation framework that connects software quality requirements, such as performance and maintainability, with the transformation of the program to enhance the targeted qualities. Their results showed that utilizing design patterns increases the system's maintainability and performance. In a related study, Tahvildari and Kontogiannis \citep{tahvildari2003metric} applied the same framework to assess four object-oriented measures (cohesion, coupling, complexity, and inheritance) together with software maintainability. Leitch and Stroulia \citep{leitch2003assessing} utilized dependency graph-based techniques to investigate the impact of two refactorings, namely, \textit{Extract Method} and \textit{Move Method}, on software maintenance using two small systems. Their findings demonstrated that refactoring improved quality by reducing the size of the design, increasing the number of procedures, decreasing data dependencies and minimizing regression testing. Bios and Mens \citep{du2003describing} proposed a framework to analyze the impact of three refactorings on five internal quality attributes (\textit{i.e.,} cohesion, coupling, complexity, inheritance, and size). Their results indicated both positive and negative impacts on the selected measures.  Bios \etal \citep{du2004refactoring} provided a set of guidelines to optimize cohesion and coupling measures. Their study showed that the impact of refactoring on these measures ranged from negative to positive. In a subsequent study,  Bios \etal \citep{du2005does} differentiated between the application of Refactor to Understand and the traditional Read to Understand pattern, demonstrating that refactoring plays a role in improving software understandability. Rieger \etal \citep{rieger2004insights} provided insight into system-wide code duplication. The author proposed a way of grouping the duplication information
into useful abstractions and proposed a number of
polymetric views that structure the data and combine it
with the knowledge about the system that the engineer possesses.

Geppert \etal \citep{geppert2005refactoring} investigated the impact of refactoring on changeability by focusing on three factors: customer-reported defect rates, change effort, and scope of changes. Their findings showed a significant decrease in the first two factors. Ratzinger \etal \citep{ratzinger2005improving} analyzed historical data from a large industrial system, focusing on reducing change couplings. By examining identified change couplings and corresponding code smell changes, they determined efficient areas for applying refactoring, concluding that refactoring has the potential to enhance software evolvability, specifically by reducing change coupling. In an agile development environment, Moser \etal \citep{moser2006does} used internal measures (\textit{i.e.,} CK, MCC, LOC) to explore the effect of refactoring on the reusability of the code using a commercial system. Their study indicated that refactoring could enhance the reusability of classes that initially were difficult to reuse. Wilking \etal \citep{wilking2007empirical} empirically studied the effect of refactoring on non-functional aspects, \textit{i.e.,} the maintainability and modifiability of system systems. They tested maintainability by explicitly adding defects to the code and then measured the time taken to remove them. However, modifiability was examined by adding new functionality and then measuring the LOC metric and the time taken to implement these features. The authors did not find a clear effect of refactoring on these two external attributes. 

Stroggylos and Spinellis \citep{stroggylos2007refactoring} opted for
searching words stemming from the verb ``refactor" such
as \say{refactoring} or \say{refactored} to identify commits related to refactoring to study the impact of refactoring on quality using eight object-oriented metrics. Their results indicated possible negative effects of refactoring on quality, \textit{e.g.,} increased LCOM metric. Moser \etal \citep{moser2007case} investigated the impact of refactoring on productivity within an agile team. Their results indicated that refactoring not only enhanced software developers' productivity but also positively affected various quality aspects, such as maintainability. Alshayeb \citep{alshayeb2009empirical} conducted a study aiming to assess the impact of eight refactorings on five external quality attributes (\textit{i.e.,} adaptability, maintainability, understandability, reusability, and testability). The author found that refactoring could improve the quality in some classes, but could also decrease software quality to some extent in other classes. Hegedus \etal \citep{hegedHus2010effect} examined the effect of singular refactoring techniques on testability, error proneness, and other maintainability attributes. They concluded that refactoring could have undesirable side effects that can degrade the quality of the source code. 

Shatnawi and Li \citep{shatnawi2011empirical} used the hierarchical quality model to assess the impact of refactoring on four quality factors in software, namely reusability, flexibility, extendibility, and effectiveness. The authors found that most of the refactoring operations have a positive impact on quality; however, some operations deteriorated quality. Bavota \etal empirically investigated the developers' perception of coupling, as captured by structural, dynamic, semantic, and logical coupling measures. They found that the semantic coupling measure aligns with developers' perceptions better than the other. Bavota \etal \citep{bavota2015experimental} used \texttt{RefFinder}\footnote{https://github.com/SEAL-UCLA/Ref-Finder}, 
%\citep{5609577}
a version-based refactoring detection tool, to mine the evolution history of three open-source systems. They mainly investigated the relationship between refactoring and quality. The findings of the study indicate that 42\% of the refactorings performed are affected by code smells, and the refactorings were able to eliminate code smells only in 7\% of the cases. 

Cedrim \etal \citep{cedrim2016does} conducted a longitudinal study involving 25 projects to explore the improvement of the structural quality of software. They examined the relationship between refactorings and code smells, categorizing refactorings based on whether they added or removed problematic code structures. The study results indicate that only 2.24\% of the refactorings removed the code smells, while 2.66\% introduced new ones. Chavez \etal \citep{chavez2017does} investigated the impact of refactoring on five internal quality attributes—cohesion, coupling, complexity, inheritance, and size—using 25 quality metrics. Their study indicated that root-canal refactoring-related operations either improved or at least did not worsen internal quality attributes. Furthermore, when floss refactoring-related operations are applied, 55\% of these operations improved these attributes, while only 10\% quality decreased. Pantiuchina \etal \citep{pantiuchina2020developers} investigated the motivation behind refactoring by computing 42 product and process metrics for each of the 213,102 commits in
the studied projects.

%Fakhoury \etal \citep{fakhoury2019improving} have shown that the existing readability models are not able to capture the improvement in readability with minor code changes, and some metrics which can effectively measure the readability improvement are currently not used by readability models. %AlOmar \etal \citep{alomar2019impact} showed a misperception between the state-of-the-art structural metrics widely used as indicators for refactoring and what developers consider to be an improvement in their source code. The research aims to identify (among software quality attributes) the metrics that align with the vision of developers on the quality attribute they explicitly state they want to improve. Their approach entailed mining 322,479 commits from 3,795 open source projects, from which they identified about 1,245 commits based on commit messages that explicitly informed the refactoring towards improving quality attributes. Thereafter, they processed the identified commits by measuring structural metrics before and after the changes. The variations in values were then comparable to distinguish metrics significantly affected by the refactoring, towards better reflecting the intention of developers to improve the corresponding quality attribute. %In follow-up work, AlOmar \etal \citep{alomar2020developers,alomar2022refactoring}  utilized software quality metrics to evaluate the impact of refactoring on reusability.

%Hamdi \etal and Ouni \etal \citep{hamdi2021empirical,ouni2023impact} propose a first analysis on the impact of refactoring on quality metrics in the context of Android applications. They determined the effect each refactoring had upon software quality metrics, and employed the difference-in-differences (DiD) model to determine how much the metric changes brought about by refactoring differ from the metric changes in non-refactoring commits. The results show that metrics can be a strong indicator of refactoring activity, regardless of whether it improves or degrades these metric values.

Two studies, particularly relevant to our work, have delved into comment commits in which developers explicitly aimed to improve software quality \citep{szoke2014bulk,pantiuchina2018improving}. Szoke \etal \citep{szoke2014bulk} studied 198 refactoring commits of five large-scale industrial systems to investigate the effects of these commits on the quality of several revisions over a period of time. To understand the purpose of the applied refactorings, developers were trained and asked to articulate the reason when committing changes to repositories, relating to (1) fixing coding issues, (2) addressing anti-patterns, and (3) improving specific metrics. The results of the study showed that performing a single refactoring could negatively impact the quality, but applying refactorings in blocks (\eg fixing more coding issues or improving more quality metrics) can significantly improve software quality. In a related study, Pantiuchina \etal \citep{pantiuchina2018improving} empirically investigated the correlation between seven code metrics and the quality improvement explicitly reported by developers in 1,282 commit messages. The study showed that quality metrics sometimes do not capture the quality improvement reported by developers. Both studies used quality metrics as a common indicator to assess quality improvements, concluding that minor refactoring changes rarely had a substantial impact on software quality.

All of the aforementioned studies have focused on evaluating the impact of refactorings on quality by examining either internal or external quality attributes through various methodologies. Among them, few studies \citep{ratzinger2005improving, stroggylos2007refactoring, szoke2014bulk, bavota2015experimental, cedrim2016does, chavez2017does, pantiuchina2018improving, hamdi2021empirical,ouni2023impact,alomar2020developers,alomar2022refactoring,fakhoury2019improving,alomar2019impact} mined software repositories to explore the impact on quality. Otherwise, the vast majority of these studies %except Bavota et al. \citep{bavota2015experimental} and Szuke et al. \citep{szoke2014bulk},
used a limited set of projects and mined general commits without applying any form of verification regarding whether refactorings have actually been applied. 

Our work differs from these studies shown \textcolor{black}{in Tables \ref{Table:Quality Metrics in Related Work} and \ref{Table:Quality Metrics in Related Work-v2}}, as our main purpose is to explore whether there is an alignment between quality metrics and the removal of code duplication that developers document in the commit messages. As we summarize these state-of-the-art studies, we identify 5 popular quality attributes, namely \textit{Cohesion}, \textit{Coupling}, \textit{Complexity}, \textit{Inheritance}, and \textit{Design size}. Given the varied metrics advocated by different studies to calculate these quality attributes, we extracted and calculated 32 structural metrics. In a more qualitative sense, we conducted an empirical study using 322 distinct commits that are proven to contain real-world instances of refactoring activities, with the purpose of removing code duplication. To the best of our knowledge, no previous study has empirically investigated, using a curated set of commits, the representativeness of structural design metrics for code duplication. The next section details the steps we took to design our empirical setup.