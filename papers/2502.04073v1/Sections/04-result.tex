\section{Results \& Discussion}
\label{Section:Result}
\subsection{\textcolor{black}{What is the quantitative code quality assessment of code duplications that have been intentionally removed by developers?}}
For each refactoring commit in which developers document the removal of duplicate code, we extract its associated metric values  (see Table~\ref{Table:Quality Metrics Used in This Study.}) before and after the commit. 
 In other words, for commit messages related to the removal of code duplicates, we examine 32 corresponding metric values before and after the selected refactoring commit. As we evaluate metric values both pre- and post-refactoring, we want to distinguish, for each metric, whether there is a variation between its pair of values, whether this variation signifies an improvement, and whether the variation is statistically significant. Therefore, we use the Wilcoxon test \citep{wilcoxon1945individual}, a non-parametric test, to compare the group of metric values before and after the commit since these groups depend on each other. The null hypothesis is defined by no variation in the metric values of pre- and post-refactored code elements. Thus, the alternative hypothesis indicates a variation in the metric values. In each case, a decrease in the metric value is considered desirable (\ie an improvement), except for complexity metrics related to the maintainability index and CLOC (see Table~\ref{Table:Quality Metrics Used in This Study.}), where higher values are desirable. Furthermore, the variation between the values of both sets is considered significant if its associated \textit{p}-value is less than 0.05. Furthermore, we used the Cliff's delta ($\delta$) effect size to estimate the magnitude of the differences. Regarding its interpretation, we follow the guidelines reported by Grissom \etal \citep{trove.nla.gov.au/work/16432558}:

 \begin{itemize}
\item Negligible for $\mid \delta \mid< 0.147$
\item Small for $0.147 \leq \mid \delta \mid < 0.33$
\item Medium for $0.33 \leq \mid \delta \mid < 0.474$
\item Large for $\mid \delta \mid \geq 0.474$
\end{itemize}

%In the following, we report the results of our research questions. 


To answer our main research question, we provide a detailed analysis of each of the five quality attributes reported in Table \ref{Table:Quality Metrics Used in This Study.} and qualitatively analyze the cases with positive and negative impacts. Table~\ref{Table:Metrics Suites and Metrics Tools Summary} shows the overall impact of refactorings on quality. The boxplots in \textcolor{black}{Figures \ref{Chart:Boxplots_cohesion}, \ref{Chart:Boxplots_coupling}, \ref{Chart:Boxplots_complexity}, \ref{Chart:Boxplots_inheritance}, and \ref{Chart:Boxplots_design size}} show the distribution of each metric before and after each of the examined commits.

\input{Tables/RQ1}
%\subsection{Is the developer's perception of code duplicate removal aligned with the quantitative assessment of code quality?}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsubsection{Cohesion}
\noindent\textbf{\textcolor{black}{Cohesion.}}  For commits wherein the messages indicate the removal of code duplication, the boxplot depicted in Figure \ref{BP:chesion-lcom} illustrates the pre- and post-refactoring results of the normalized LCOM. This metric, commonly used in the literature to assess cohesion, is crucial in estimating the strength of cohesion within classes. A lower LCOM metric value generally suggests that classes should be split into one or more classes with better cohesion. Therefore, a low value for this metric signifies strong class cohesiveness. We specifically chose the normalized LCOM metric as it has been widely recognized in the literature  \citep{pantiuchina2018improving,chavez2017does,henderson1995object} as being the alternative to the original LCOM, by addressing its main limitations (artificial outliers, misperception of getters and setters, etc.). As can be seen from the boxplot in Figure \ref{BP:chesion-lcom}, the median drops from 1 to 0. This result indicates that LCOM is improved after code duplicate removal. Furthermore, as shown in Table~\ref{Table:Metrics Suites and Metrics Tools Summary}, LCOM has a positive impact on cohesion quality, as it decreases in the refactored code. This implies that developers did improve the cohesion of their classes. Table~\ref{Table:Metrics Suites and Metrics Tools Summary} shows that the differences in LCOM are statistically significant and the magnitude of the differences is large.

\noindent\textbf{Example (Positive Impact):} To illustrate an improvement in cohesion when the removal of duplicate code was found in the Maven project\footnote{\textcolor{black}{\url{https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2}}}, developers applied `Move Class' refactoring to move \texttt{JUnit4TestCheckerTest.MySuite2} to \texttt{JUnit3TestCheckerTest.MySuite2}. This results in its LCOM5 dropping from 2 to 1. The improvement in the LCOM5 metric after the removal of code duplication could be attributed to the simplification of method interactions, the modularization of logic, the enhancement of code clarity, and the abstraction of common functionality.

%https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2
\noindent\textbf{Example (Negative Impact):} To illustrate a decrease in cohesion when the removal of duplicated code was found in the Maven project\footnote{\textcolor{black}{\url{https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2}}}, developers applied `Move Class' refactoring to move \texttt{JUnit4TestCheckerTest.NestedTC} to \texttt{JUnit3TestChecker\break Test.NestedTC}. This results in its LCOM5 increasing from 0 to 2. The LCOM5 metric might not have improved after removing duplicated code, as removal of duplicated code might not have substantially altered the underlying design and interactions of methods.  


\begin{figure*}
% row-1
\centering
%\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/LCOM5.png}
\caption{Cohesion - LCOM5}
\label{BP:chesion-lcom}
%\end{subfigure}%
\caption{\textcolor{black}{Boxplots of cohesion metric values of pre- and post-refactored files.}}
\label{Chart:Boxplots_cohesion}
\end{figure*}
%https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2
% \begin{boxK}
% \textit{\textbf{Summary.} The normalized LCOM metric not only serves as a suitable substitute for the original LCOM but also serves as a representation of the cohesion quality attribute. A positive variation in this metric aligns with the developer's intention to eliminate code duplication.}
% \end{boxK}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsubsection{Coupling}
\noindent\textbf{\textcolor{black}{Coupling.}} For commits with messages indicating the removal of code duplication, the boxplots presented in Figures \ref{BP:coupling-cbo}, \ref{BP:coupling-rfc}, \ref{BP:coupling-nii}, and \ref{BP:coupling-noi} show the pre- and post-refactoring results of four structural metrics, \ie CBO, RFC, NII, and NOI, used in the literature to estimate the coupling. The figures reveal that three of the coupling metrics exhibited an improvement in median values. For instance, CBO, RFC, and NOI medians decreased, respectively, from 6 to 3, from 5 to 1, and from 6 to 3, respectively. CBO counts the number of classes coupled to a particular class through method or attribute calls. Calls are counted in both directions. CBO values have significantly decreased, making it a good coupling representative.  The RFC, which measures the visibility of a class to outsider classes, has been reduced as developers intend to optimize coupling. According to our results, the variations are statistically significant and the magnitude of the differences is large for both metrics.  NOI, which represents the number of outgoing invocations, has also decreased, and Cliffâ€™s delta value
indicates a small effect size. However, NII exhibits the opposite variation, and the effect size is large.

The manual inspection of the refactored code indicates that developers typically decrease coupling by reducing (1) the strength of dependencies that exist between classes, (2) the message flow of the classes, and (3) the number of inputs a method uses plus the number of subprograms that call this method. The code was improved as expected from the developer's intentions in their commit message.

\noindent\textbf{Example (Positive Impact):} One of the examples showing an improvement in coupling was found in the Maven project\footnote{\textcolor{black}{\url{https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2}}}. Developers applied `Move Class' refactoring to move \texttt{JUnit4TestCheckerTest.MySuite2} to \texttt{JUnit3Test\break CheckerTest.MySuite2}. This results in its CBO dropping from 1 to 0, and its RFC from 2 to 1.  The improvement in the CBO and RFC metrics after the removal of code duplication can be related to the elimination of external dependencies and the simplification of method interactions. However, its NII and NOI remain unchanged.

%https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2
\noindent\textbf{Example (Negative Impact):} One of the examples showing an increase in coupling was found in the Archiva project\footnote{\textcolor{black}{\url{https://github.com/apache/archiva/commit/26e9c3b257bed850d0e2f0bc9dc2d7f11381b789}}}. The developer applied `Extract Superclass' refactoring to extract \texttt{AbstractDiscoverer} from \texttt{AbstractArtifact\break Discoverer}. This results in its CBO increasing from 0 to 1, its RFC from 4 to 6, and its NOI from 0 to 2. However, its NII improves from 3 to 0. The lack of improvement in CBO, RFC, and NOI metrics after the removal of code duplication could be attributed to the specific nature of the duplication and its limited impact on class interactions, method hierarchies, and message handling. 
%which indicates that the number of dependencies does not decrease after performing the refactoring to remove code duplication. 
%https://github.com/apache/archiva/commit/26e9c3b257bed850d0e2f0bc9dc2d7f11381b789
% \begin{boxK}
% \textit{\textbf{Summary.} CBO, RFC, and NOI generally improve as the developer intends to eliminate code duplication, and their variation is significant. NII exhibits opposite variations in
% coupling.}
% \end{boxK}
\begin{figure*}
% row-1
\centering
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/CBO.png}
\caption{Coupling - CBO}
\label{BP:coupling-cbo}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/RFC.png}
\caption{Coupling - RFC}
\label{BP:coupling-rfc}
\end{subfigure}%\vspace{9pt}
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/NII.png}
\caption{Coupling - NII}
\label{BP:coupling-nii}
\end{subfigure}%\vspace{9pt}
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/NOI.png}
\caption{Coupling - NOI}
\label{BP:coupling-noi}
\end{subfigure}%
\caption{\textcolor{black}{Boxplots of coupling metric values of pre- and post-refactored files.}}
\label{Chart:Boxplots_coupling}
\end{figure*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%RFC exhibits an opposite variation to coupling, but it is not statistically significant.
%\subsubsection{Complexity}
\noindent\textbf{\textcolor{black}{Complexity.}} Regarding complexity metrics, we consider 16 literature metrics, shown in Table \ref{Table:Quality Metrics Used in This Study.}, to investigate the removal of duplicate code as perceived by developers. As seen in the boxplots in Figures \ref{BP:Complexity-cc}, \ref{BP:Complexity-wmc}, \ref{BP:Complexity-nl}, \ref{BP:coupling-nle}, \ref{BP:Complexity-hcpl}, \ref{BP:Complexity-hdif}, \ref{BP:Complexityheff}, \ref{BP:Complexity-hndb}, \ref{BP:Complexity-hpl}, \ref{BP:Complexity-hpv}, \ref{BP:Complexity-htrp}, \ref{BP:Complexity-hvol}, \ref{BP:Complexity-mims}, \ref{BP:Complexity-mi}, \ref{BP:Complexity-misei}, and \ref{BP:Complexity-mism},  we observe that CC, NL, and NLE remain unchanged, whereas the other 13 metrics experienced an improvement in the median values. The refactored duplicate code exhibits higher values for the four maintenance index-related complexity (\ie MIMS, MI, MISEI, and MISM). The higher values are desirable for these metrics, as shown in Table \ref{Table:Quality Metrics Used in This Study.}. Additionally, the duplicate code refactored shows lower values for the other metrics (\ie WMC, HCPL, HDIF, HEEF, HNDB, HPL, HPV, HTRP, and HVOL), where lower values are desirable after the application of refactoring.

%Furthermore, all the variations are statistically significant and the magnitude of the differences is large for both metrics. 


%Our results indicate that the two metrics represent the quality attribute of complexity that improved. 

In particular, through a manual inspection of the collected dataset, we observe that developers tend to reduce the number of local methods, simplify the structure statements, reduce the number of paths in the body of the code, and lower the nesting level of the control statements (\eg selection and loop statements) in the method body. %On the other hand, when we observe a significant increase in RFC, we notice that developers lower the complexity of methods by pulling them up in the hierarchy, and so they increase the number of inherited methods. 

As seen in Table \ref{Table:Metrics Suites and Metrics Tools Summary}, the \textit{p}-values obtained from all complexity metrics are statistically significant. The effect sizes
calculated in Cliff 's delta ($\delta$) are found to be large only for WMC, small for CC, MISEI, and MISM, and negligible for the remaining 12 metrics.

\noindent\textbf{Example (Positive Impact):} As an illustrative example, we refer to commit\footnote{\textcolor{black}{\url{https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2}}} which implements `Move Class' refactoring to move \texttt{JUnit4TestChecker\break Test.MySuite2} to \texttt{JUnit3TestCheckerTest.MySuite2}. Its CC, NL, and NLE remain unaffected, and its WMC improves from 2 to 1. The unchanged CC could be due to the specific nature of the duplicated code, which might not have affected the control flow patterns significantly. However, the improved WMC could be due to consolidation, optimization, or simplification of methods due to the removal of duplicates. In another example\footnote{\textcolor{black}{\url{https://github.com/apache/kafka/commit/f7b7b4745541a576eb0219468263487b07bac959}}}, `Extract Method' refactoring has been applied by developers to extract \texttt{resume} from \texttt{addStreamTasks} to eliminate duplication. Its four maintainability index metrics, \ie MIMS, MI, MISEI, and MISM improved (44.59 to 75.78, 76.25 to 129.6, 56.64 to 153.82, and 33.12 to 89.95), respectively. The remaining complexity metrics, \ie HCPL, HDIF, HNDB, HPL, HPV, HTRP, HVOL, have also improved (343.36 to 23.50, 52.85 to 3, 1515.44 to 44, 184 to 11, 67 to 10, 3277.43 to 6.09, and 1116.16 to 36.54, respectively).
%https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2

\noindent\textbf{Example (Negative Impact):} As an illustrative example, we refer to commit\footnote{\textcolor{black}{\url{https://github.com/apache/sis/commit/c8ffc0116b86f39caa3d2f45dca5dec68049c93e}}} which implements `Extract Superclass' refactoring to extract \texttt{Element} from \texttt{Copyright} and \texttt{Person}. Its CC increases from 0 to 0.11, its WMC increases from 3 to 45, its NL and NLE increase from 0 to 2. When referring to commit\footnote{\textcolor{black}{\url{https://github.com/apache/ant-ivy/commit/b74264847ef8e9ffeaf06d5fa1fdead4a065b480}}}, the `Extract Method' refactoring to extract \texttt{getReportFile} from \texttt{getRealDependencyRevisionIds} to remove duplication. Its four maintainability index metrics have not improved (75.71 to 64.27, 129.47 to 109.90, 155.64 to 83.06, 91,02, for MIMS, MI, MISEI, and MISM, respectively).   The remaining complexity metrics, \ie HCPL, HDIF, HNDB, HPL, HPV, HTRP, HVOL, have also not improved (61.30 to 120.76, 12.25 to 21, 108.09 to 317.87, 22 to 55, 18 to 30, 62.43 to 314.85, and 91.73 to 269.87, respectively). The absence of improvement in complexity metrics could be due to factors such as the nature of duplicated code, the distribution of complexity across the codebase, and the potential compensatory complexity introduced during the code duplicate removal process. 


%https://github.com/apache/sis/commit/c8ffc0116b86f39caa3d2f45dca5dec68049c93e
% \begin{boxK}
% \textit{\textbf{Summary.} CC, NL, and NLE remain unchanged, and the remaining 13 complexity-related metrics generally improve as the developer intends to improve code duplicate, and all their variation is significant.}
% \end{boxK}




\begin{figure*}
% row-1
\centering
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/CC.png}
\caption{Complexity - CC}
\label{BP:Complexity-cc}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/WMC.png}
\caption{Complexity - WMC}
\label{BP:Complexity-wmc}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/NL.png}
\caption{Complexity - NL}
\label{BP:Complexity-nl}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/NLE.png}
\caption{Coupling - NLE}
\label{BP:coupling-nle}
\end{subfigure}%
\vspace{9pt}
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/HCPL.png}
\caption{Complexity - HCPL}
\label{BP:Complexity-hcpl}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/HDIF.png}
\caption{Complexity - HDIF}
\label{BP:Complexity-hdif}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/HEFF.png}
\caption{Complexity - HEFF}
\label{BP:Complexityheff}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/HNDB.png}
\caption{Complexity - HNDB}
\label{BP:Complexity-hndb}
\end{subfigure}%
\vspace{9pt}
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/HPL.png}
\caption{Complexity - HPL}
\label{BP:Complexity-hpl}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/HPV.png}
\caption{Complexity - HPV}
\label{BP:Complexity-hpv}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/HTRP.png}
\caption{Complexity - HTRP}
\label{BP:Complexity-htrp}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/HVOL.png}
\caption{Complexity - HVOL}
\label{BP:Complexity-hvol}
\end{subfigure}%
\vspace{9pt}
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/MIMS.png}
\caption{Complexity - MIMS}
\label{BP:Complexity-mims}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/MI.png}
\caption{Complexity - MI}
\label{BP:Complexity-mi}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/MISEI.png}
\caption{Complexity - MISEI}
\label{BP:Complexity-misei}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/MISM.png}
\caption{Complexity - MISM}
\label{BP:Complexity-mism}
\end{subfigure}%
\caption{\textcolor{black}{Boxplots of complexity metric values of pre- and post-refactored files.}}
\label{Chart:Boxplots_complexity}
\end{figure*}



% \begin{figure*}
% % row-1
% \centering
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/LCOM5.png}
% \caption{Cohesion - LCOM5}
% \label{BP:chesion-lcom}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/CBO.png}
% \caption{Coupling - CBO}
% \label{BP:coupling-cbo}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/RFC.png}
% \caption{Coupling - RFC}
% \label{BP:coupling-rfc}
% \end{subfigure}%\vspace{9pt}
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/NII.png}
% \caption{Coupling - NII}
% \label{BP:coupling-nii}
% \end{subfigure}%\vspace{9pt}





% % row-2 
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/NOI.png}
% \caption{Coupling - NOI}
% \label{BP:coupling-noi}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/CC.png}
% \caption{Complexity - CC}
% \label{BP:Complexity-cc}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/WMC.png}
% \caption{Complexity - WMC}
% \label{BP:Complexity-wmc}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/NL.png}
% \caption{Complexity - NL}
% \label{BP:Complexity-nl}
% \end{subfigure}%


% % row-2 
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/NLE.png}
% \caption{Coupling - NLE}
% \label{BP:coupling-nle}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/HCPL.png}
% \caption{Complexity - HCPL}
% \label{BP:Complexity-hcpl}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/HDIF.png}
% \caption{Complexity - HDIF}
% \label{BP:Complexity-hdif}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/HEFF.png}
% \caption{Complexity - HEFF}
% \label{BP:Complexityheff}
% \end{subfigure}%




% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/HNDB.png}
% \caption{Complexity - HNDB}
% \label{BP:Complexity-hndb}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/HPL.png}
% \caption{Complexity - HPL}
% \label{BP:Complexity-hpl}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/HPV.png}
% \caption{Complexity - HPV}
% \label{BP:Complexity-hpv}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/HTRP.png}
% \caption{Complexity - HTRP}
% \label{BP:Complexity-htrp}
% \end{subfigure}%

% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/HVOL.png}
% \caption{Complexity - HVOL}
% \label{BP:Complexity-hvol}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/MIMS.png}
% \caption{Complexity - MIMS}
% \label{BP:Complexity-mims}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/MI.png}
% \caption{Complexity - MI}
% \label{BP:Complexity-mi}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/MISEI.png}
% \caption{Complexity - MISEI}
% \label{BP:Complexity-misei}
% \end{subfigure}%

% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/MISM.png}
% \caption{Complexity - MISM}
% \label{BP:Complexity-mism}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/DIT.png}
% \caption{Inheritance - DIT}
% \label{BP:Inheritance-dit}
% \end{subfigure}%\vspace{9pt}
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/NOC.png}
% \caption{Inheritance - NOC}
% \label{BP:Inheritance-noc}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/NOA.png}
% \caption{Inheritance - NOA}
% \label{BP:Inheritance-noa}
% \end{subfigure}%



% % row 3
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/LOC.png}
% \caption{Design Size - LOC}
% \label{BP:Design Size-loc}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/TLOC.png}
% \caption{Design Size - TLOC}
% \label{BP:Design Size-tloc}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/LLOC.png}
% \caption{Design Size - LLOC}
% \label{BP:Design Size-lloc}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/TLLOC.png}
% \caption{Design Size - TLLOC}
% \label{BP:Design Size-tlloc}
% \end{subfigure}%


% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/CLOC.png}
% \caption{Design Size - CLOC}
% \label{BP:Design Size-cloc}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/NPM.png}
% \caption{Design Size - NPM}
% \label{BP:Design Size-npm}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/NOS.png}
% \caption{Design Size - NOS}
% \label{BP:Design Size-nos}
% \end{subfigure}%
% \begin{subfigure}{3.5cm}
% \centering\includegraphics[width=3.5cm]{Images/TNOS.png}
% \caption{Design Size - TNOS}
% \label{BP:Design Size-tnos}
% \end{subfigure}

% \caption{Boxplots of metrics values of pre- and post-refactored files.} 
% \label{Chart:Boxplots_Al_V1}
% \end{figure*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsubsection{Inheritance}
\noindent\textbf{\textcolor{black}{Inheritance.}} For commits that involve the removal of code duplication, the boxplots depicted in Figures  \ref{BP:Inheritance-dit}, \ref{BP:Inheritance-noc} and \ref{BP:Inheritance-noa} showcase the pre- and post-refactoring results of three structural metrics:  \ie DIT, NOC, and NOA, used in the literature to estimate the inheritance. We observe that only one metric among the three experienced a degradation in median values. Specifically, the median for NOC decreased from 3 to 0, while the median for DIT and NOA increased from 2 to 3 and from 3 to 4, respectively. This suggests that developers may be increasing the depth of the hierarchy by adding more methods for a class to inherit, reducing the number of immediate subclasses, and increasing the number of methods added by a subclass. While some instances show improvement in inheritance, the overall depth of the inheritance tree and the number of methods added by a subclass did not decrease.  The interpretation of the metric improvement depends highly on the quality of the code and the developer's design decisions. The statistical test shows that the differences are statistically significant for DIT, NOC, and NOA. The magnitude of the difference between the three metrics is large.

\noindent\textbf{Example (Positive Impact):} One of the examples that demonstrated improvement in inheritance was found
in a particular commit in the Maven project\footnote{\textcolor{black}{\url{https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2}}}.  The developer applied `Move Class' refactoring to move \texttt{JUnit4TestChecker\break Test.CustomSuiteOnlyTest} to \texttt{JUnit3TestCheckerTest.CustomSuiteOnlyTest}. Its DIT drops from 1 to 0, its NOC remains unaffected, and its NOA improves from 1 to 0. This increases the reuse of common code logic and leads to more effective inheritance relationships and a better-defined hierarchy.
%https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2

\noindent\textbf{Example (Negative Impact):} One of the examples that showed improvement in inheritance was found
in a particular commit in the Archiva project\footnote{\textcolor{black}{\url{https://github.com/apache/archiva/commit/26e9c3b257bed850d0e2f0bc9dc2d7f11381b789}}}.  The developer applied `Extract Superclass' refactoring to extract \texttt{AbstractDiscoverer} from class \texttt{AbstractArtifactDiscoverer}. Its DIT increases from 0 to 1, its NOC remains unaffected, and its NOA increases from 0 to 1. This indicates that the refactoring applied to remove duplication does not always improve inheritance metrics due to either pre-existing inheritance challenges, or the focused nature of the duplication removal. 
%https://github.com/apache/archiva/commit/26e9c3b257bed850d0e2f0bc9dc2d7f11381b789
% \begin{boxK}
% \textit{\textbf{Summary.} NOC generally decreases as the developer intends to remove code duplication, and its variation is significant. DIT and NOA exhibit opposite variations in inheritance. }
% \end{boxK}


\begin{figure*}
% row-1
\centering
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/DIT.png}
\caption{Inheritance - DIT}
\label{BP:Inheritance-dit}
\end{subfigure}%\vspace{9pt}
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/NOC.png}
\caption{Inheritance - NOC}
\label{BP:Inheritance-noc}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/NOA.png}
\caption{Inheritance - NOA}
\label{BP:Inheritance-noa}
\end{subfigure}%
\caption{\textcolor{black}{Boxplots of inheritance metric values of pre- and post-refactored files.}}
\label{Chart:Boxplots_inheritance}
\end{figure*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsubsection{Design Size}
\noindent\textbf{\textcolor{black}{Design Size.}} For commits whose messages report the removal of code duplicate, the boxplots sketched in Figures \ref{BP:Design Size-loc}, \ref{BP:Design Size-tloc}, \ref{BP:Design Size-lloc}, \ref{BP:Design Size-tlloc}, \ref{BP:Design Size-cloc},  \ref{BP:Design Size-npm}, \ref{BP:Design Size-nos}, and \ref{BP:Design Size-tnos}  show the pre- and post-refactoring results of four structural metrics, \ie LOC, TLOC, LLOC, TLLOC, CLOC,  NPM, NOS, and TNOS, used in the literature to estimate the design size. We notice the improvement of six metrics, namely LOC, TLOC, LLOC, TLLOC, NOS, and TNOS after the commits in which developers explicitly target the improvement of code duplication, their variations are statistically significant.  
 The magnitude of LOC, TLOC, and TLLOC is small, whereas the magnitude for LLOC, NOS, and TNOS is negligible. As seen in the box plots, the medians generally decreased. However, we note that the medians for CLOC and NPM remain unchanged. The differences in CLOC and NPM are statistically significant, and the magnitude of the difference is negligible and large, respectively. This indicates that developers generally retain the lines containing comments and maintain the same number of methods after applying refactoring. %This shows us that developers added more lines of code plus more declarative and executable statements after the application of refactoring that might be because developer intentions is to improve the readability and the clarity of the code. 

\noindent\textbf{Example (Positive Impact):} As an illustrative example, we refer to the commit\footnote{\textcolor{black}{\url{https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2}}} which implements `Extract Method' refactoring to extract \texttt{accept\break(testClass)} from \texttt{invalidTest}. Its LOC, TLOC, LLOC, TLLOC drop from 6 to 4, and its CLOC, NOS, and TNOS remain unaffected.  Furthermore, when moving the class \texttt{JUnit4TestCheckerTest.AlsoValid}  to \texttt{JUnit3TestChecker\break Test.AlsoValid}, its NPM improves from 1 to 0.  In qualitative terms, the removal of code duplication and the introduction of a dedicated method have led to more modular, focused, and readable code. This shows that size metrics capture the removal of code duplication as perceived by the developer.
%https://github.com/apache/maven-surefire/commit/d5de47a4f790ea2d18edb5e05c1ef2adcd2db8a2

\noindent\textbf{Example (Negative Impact):} As an illustrative example, we refer to the commit\footnote{\textcolor{black}{\url{https://github.com/apache/commons-bcel/commit/67dfdf60f5f8ccb8ed910bfe9d1cdc6e84f0db36}}} which implements `Extract Method' refactoring to extract \texttt{accept\break(createAnnotationEntries)} from \texttt{getAnnotationEntries}. Its LOC and TLOC increased from 7 to 11, its LLOC, TLLOC increased from 6 to 10, and its NOS and TNOS increased from 3 to 6. Its CLOC decreases from 3 to 1. The observed lack of improvement, in this case, can be attributed to a couple of factors, including the nature of the changes made, the extent of duplication and additional compensatory changes. This results in an overall increase in the class size as assessed by these employed design size metrics.
%https://github.com/apache/commons-bcel/commit/67dfdf60f5f8ccb8ed910bfe9d1cdc6e84f0db36
\begin{figure*}
% row-1
\centering
% row 3
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/LOC.png}
\caption{Design Size - LOC}
\label{BP:Design Size-loc}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/TLOC.png}
\caption{Design Size - TLOC}
\label{BP:Design Size-tloc}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/LLOC.png}
\caption{Design Size - LLOC}
\label{BP:Design Size-lloc}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/TLLOC.png}
\caption{Design Size - TLLOC}
\label{BP:Design Size-tlloc}
\end{subfigure}%
\vspace{9pt}
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/CLOC.png}
\caption{Design Size - CLOC}
\label{BP:Design Size-cloc}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/NPM.png}
\caption{Design Size - NPM}
\label{BP:Design Size-npm}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/NOS.png}
\caption{Design Size - NOS}
\label{BP:Design Size-nos}
\end{subfigure}%
\begin{subfigure}{3.5cm}
\centering\includegraphics[width=3.5cm]{Images/TNOS.png}
\caption{Design Size - TNOS}
\label{BP:Design Size-tnos}
\end{subfigure}

\caption{\textcolor{black}{Boxplots of design size metric values of pre- and post-refactored files.}}
\label{Chart:Boxplots_design size}
\end{figure*}
% \begin{boxK}
% \textit{\textbf{Summary.} LOC, TLOC, LLOC, TLLOC, NOS, TNOS generally improve as developers intend to remove code duplication, and their variations are significant. These metrics have a significant positive variation which matches the developer's perception of removing code duplicates.}
% \end{boxK}


\noindent\textbf{\textcolor{black}{Summary.}} \textcolor{black}{This \textcolor{black}{section} summarizes our findings and their implications.}

\begin{itemize}
    \item \textcolor{black}{\textbf{Cohesion.} The normalized LCOM metric not only serves as a suitable substitute for the original LCOM but also serves as a representation of the cohesion quality attribute. A positive variation in this metric aligns with the developer's intention to eliminate code duplication.}
    \item \textcolor{black}{\textbf{Coupling.} CBO, RFC, and NOI generally improve as the developer intends to eliminate code duplication, and their variation is significant. NII exhibits opposite variations in
coupling.}
    \item \textcolor{black}{\textbf{Complexity.} CC, NL, and NLE remain unchanged, and the remaining 13 complexity-related metrics generally improve as the developer intends to improve code duplicate, and all their variation is significant.}
    \item \textcolor{black}{\textbf{Inheritance.} NOC generally decreases as the developer intends to remove code duplication, and its variation is significant. DIT and NOA exhibit opposite variations in inheritance.}
    \item \textcolor{black}{\textbf{Design Size.} LOC, TLOC, LLOC, TLLOC, NOS, TNOS generally improve as developers intend to remove code duplication, and their variations are significant. These metrics have a significant positive variation which matches the developer's perception of removing code duplicates.}
\end{itemize}

%\begin{comment}

\subsection{What are the refactoring operations that are associated with code duplicate removal?}
\input{Charts/RefactoringType}
Looking at the refactoring operations that could play a role in code duplicate removal, Figure \ref{fig:refactoringtypes} depicts the percentages of refactoring operations. \textcolor{black}{As can be seen, the most common category concerns `Extract Method', representing 55.7\% of the commits. This observation is in line with the findings of previous studies describing that `Extract Method' refactoring is considered \say{Swiss army knife} of
refactorings as developers often apply it to eliminate duplicated code \citep{higo2004aries,higo2005aries,higo2008metric,tairas2012increasing,bian2013spape,yue2018automatic,yoshida2019proactive,arcelli2015duplicated,alomar2022anticopypaster,alomar2023just,alomar2024behind}. In fact, a recent study on extract method refactoring highlights that method extraction is one of the main refactorings that were defined when the area was established \citep{alomar2024behind,griswold1993automated}, as it is a common response to the need to keep methods concise and modular, and reduced the spread of shared responsibilities.} The next most common categories are `Move Method', representing 37.5\% of the commits. This indicates that developers might improve the quality of the code by moving the method containing duplication to a different class, effectively eliminating duplicated code. The category `Extract Superclass', `Move Attribute', and `Move Class' had the least number of commits, which had a ratio of 3.8\%, 2.7\%, and 0.3\%, respectively. 

When performing manual inspection of source code, we notice that these five refactoring operations contribute to the elimination of code duplication in several ways. By performing the `Extract Method' refactoring, redundant code segments can be consolidated into a single method that can be reused across different parts of the codebase. Additionally, when moving methods from one class to another using `Move Method' refactoring, it helps centralize logic and eliminate duplicate code that might have been present in multiple classes. Moreover, by extracting a superclass using `Extract Superclass' refactoring, it encapsulates common attributes and behaviors of related classes, allowing duplicated code to be consolidated. This can be followed by moving shared attributes to a common superclass using `Move Attribute' refactoring to reduce redundancy and ensures that changes to these attributes are reflected across all subclasses. Finally, moving the entire class to a common location using `Move Class' refactoring can help in reducing duplicated code, and it is useful when classes share similar functionality but exist in different parts of the codebase.

%\end{comment}
