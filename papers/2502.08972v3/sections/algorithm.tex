

\RestyleAlgo{ruled}
\SetKwComment{Comment}{/* }{ */}

\begin{algorithm}[t!]
\small
\caption{
    \ours algorithm
}
\label{alg:our_algorithm}
\KwIn{$\pi_\theta$: LLM, $\mathcal{D}^\mathcal{T}=\{(x_i,y_i)|_{i=1}^N\}$: Initial training data, $L$: number of \ours iterations, $p(\cdot)$: ICL prompt formatting function, $S$: $\{(\Tilde{y}, e)\}$ where $\Tilde{y}$: negative sample and $e$: explanation.}
\KwOut{Augmented data $\mathcal{D}^{\text{\ours}}$}

$\mathcal{D}^{\text{\ours}} \gets \mathcal{D}^\mathcal{T}$

\For{$\text{l} \gets 0$ \KwTo $L$}{
    
    \For{$\text{i} \gets 0$ \KwTo $\left|\mathcal{D}^\mathcal{T}\right|-1$}{

        \textcolor{gray}{// Sample ICL examples excluding $x_i$ (\textsection \ref{sec:behavioral_cloning})} 
        
        $\mathcal{D^{\texttt{icl}}}=\texttt{random.sample(}\mathcal{D}^\mathcal{\text{\ours}}\setminus\{(x_i, y_i, S_i)\}\texttt{)}$
        
        \textcolor{gray}{ // Generate model output for $x_i$ (\textsection \ref{sec:exploration}})
        
        $\Tilde{y_i} \sim \pi_\theta\left(p(x_i, \mathcal{D^\texttt{icl}})\right)$

        \textcolor{gray}{// Generate explanation and determine whether it's a negative sample (\textsection \ref{sec:learning})}
        
        $(e_i, v_i) \sim \pi_\theta\left(\mathcal{E}(y_i, \Tilde{y}_i)\right)$ 

        \If{$v_i \neq \text{True}$}{
            \textcolor{gray}{// Update $\mathcal{D}^{\text{\ours}}$ with the negative sample and explanation}
            
            $S'_i \gets S_i \cup \{(\Tilde{y_i}, e_i)\} $  

            $(x_i, y_i, S_i) \in \mathcal{D}^{\text{\ours}}, (x_i, y_i, S_i) \mapsto (x_i, y_i, S'_i)$
        
        }
    }
}

\Return $\mathcal{D}^{\text{\ours}}$
\end{algorithm}
