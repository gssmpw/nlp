\documentclass{article}


% if you need to pass options to natbib, use, e.g.:
%     \PassOptionsToPackage{numbers, compress}{natbib}
% before loading neurips_2022


% ready for submission
\usepackage{microtype}
\usepackage{subfigure}
\usepackage{tocbibind}
\usepackage{multirow}
\usepackage{enumitem}
\usepackage{graphicx}
\usepackage{longtable}
% \usepackage{subfigure}
\usepackage{bbding}
\usepackage{booktabs}

% for professional tables
% \usepackage{tensor}
% \usepackage[utf8]{inputenc} % allow utf-8 input
% \usepackage[T1]{fontenc}    % use 8-bit T1 fonts

% hyperref makes hyperlinks in the resulting PDF.
% If your build breaks (sometimes temporarily if a hyperlink spans a page)
% please comment out the following usepackage line and replace
% \usepackage{icml2023} with \usepackage[nohyperref]{icml2023} above.
\usepackage{hyperref}

% \input{math_commands.tex}


% Attempt to make hyperref and algorithmic work together better:
\newcommand{\theHalgorithm}{\arabic{algorithm}}

% Use the following line for the initial blind version submitted for review:
% \usepackage{icml2023}

% If accepted, instead use the following line for the camera-ready submission:
% \usepackage[accepted]{icml2023}

% For theorems and such
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{amsthm}

% if you use cleveref..
\usepackage[capitalize,noabbrev]{cleveref}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% THEOREMS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{assumption}[theorem]{Assumption}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

% Todonotes is useful during development; simply uncomment the next line
%    and comment out the line below the next line to turn off comments
%\usepackage[disable,textsize=tiny]{todonotes}
\usepackage[textsize=tiny]{todonotes}



\title{When and How: Learning Identifiable Latent States for
Nonstationary Time Series Forecasting}


% The \author macro works with any number of authors. There are two commands
% used to separate the names and addresses of multiple authors: \And and \AND.
%
% Using \And between authors leaves it to LaTeX to determine where to break the
% lines. Using \AND forces a line break at that point. so, if LaTeX puts 3 of 4
% authors names on the first line, and the last on the second line, try using
% \AND instead of \And before the third author name.


% \author{%
%   David s.~Hippocampus\thanks{Use footnote for providing further information
%     about author (webpage, alternative address)---\emph{not} for acknowledging
%     funding agencies.} \\
%   Department of computer science\\
%   cranberry-Lemon University\\
%   Pittsburgh, PA 15213 \\
%   \texttt{hippo@cs.cranberry-lemon.edu} \\
%   % examples of more authors
%   % \And
%   % coauthor \\
%   % Affiliation \\
%   % Address \\
%   % \texttt{email} \\
%   % \AND
%   % coauthor \\
%   % Affiliation \\
%   % Address \\
%   % \texttt{email} \\
%   % \And
%   % coauthor \\
%   % Affiliation \\
%   % Address \\
%   % \texttt{email} \\
%   % \And
%   % coauthor \\
%   % Affiliation \\
%   % Address \\
%   % \texttt{email} \\
% }
% \maketitle

\begin{document}

\section{Supplement}  
\newcommand{\beginsupplement}
\ The generating process is defined as follows:
\begin{align}
      [\textbf{x}_{t-\tau-1},\textbf{x}_{t-\tau+1:t},\textbf{x}_{t-\tau}]&=g(\textbf{Z}^d_{t-\tau-1},\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau+1:t},\textbf{Z}^d_{t-\tau})\\
    \textbf{x}_{t-\tau-1}&=g_1(\textbf{Z}^d_{t-\tau-1},\textbf{Z}^s_{t-\tau-1:t},)\\
    \textbf{x}_{t-\tau+1:t},\textbf{x}_{t-\tau}&=g_2(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau+1:t},\textbf{Z}^d_{t-\tau}
\end{align}
where $\textbf{Z}^s_{t-\tau-1:t} \in \textbf{Z}^s \subset R^{d_{Z_s}},\textbf{Z}^d_{t-\tau-1} \in \textbf{Z}^{d}_1 \subset R^{d_{Z^{d}_1}},\textbf{Z}^d_{t-\tau+1:t},\textbf{Z}^d_{t-\tau} \in \textbf{Z}^d_2 \subset R^{d_{Z^d_2}}$ Both
$g_1$ and $g_2$  are smooth and have non-singular Jacobian matrices
almost anywhere, and g is invertible.
if $\hat{g}_1: Z \longrightarrow V_1 \in \textbf{x}_{t-\tau-1}$ and $\hat{g}_2: Z \longrightarrow V_2 \in \textbf{x}_{t-\tau:t}\cup \textbf{x}$ assume the generating
process of the true model $(g_1, g_2)$ and match the joint distribution $p_{v_1,v_2}$ , then there is a one-to-one mapping between the estimate $\hat{\textbf{Z}}^s_{t-\tau-1:t}$ and the ground truth $\textbf{Z}^s_{t-\tau-1:t}$ over $\textbf{Z}^s \times \textbf{Z}^d \times \textbf{Z}^d $,that is, $\textbf{Z}^s_{t-\tau-1:t}$ is  block-identifiable.

For $(v_1,v_) \sim p_{v_1,v_2}$ 
 because of the matched joint distribution, we have the following relations between the true variables $(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}, \textbf{Z}^d_{t-\tau+1:t})$ and the estimated ones $(\hat{\textbf{Z}}^s_{t-\tau-1:t},\hat{\textbf{Z}}^d_{t-\tau-1}, \hat{\textbf{Z}}^d_{t-\tau+1:t})$
 \begin{align}
   \textbf{x}_{t-\tau-1}=g_1(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1})
   =\hat{g}_1(\hat{\textbf{Z}}^s_{t-\tau-1:t},\hat{\textbf{Z}}^d_{t-\tau-1})\\
   \textbf{x}_{t-\tau+1:t}=g_2(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau+1:t})=\hat{g}_2(\hat{\textbf{Z}}^s_{t-\tau-1:t},\hat{\textbf{Z}}^d_{t-\tau+1:t})\\
   (\hat{\textbf{Z}}^s_{t-\tau-1:t},\hat{\textbf{Z}}^d_{t-\tau-1},\hat{\textbf{Z}}^d_{t-\tau+1:t})=\hat{g}^{-1}( \textbf{x}_{t-\tau-1},\textbf{x}_{t-\tau+1:t})\\
   \nonumber=\hat{g}^{-1}(g(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}, \textbf{Z}^d_{t-\tau+1:t})) := h(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}, \textbf{Z}^d_{t-\tau+1:t})
 \end{align}
 where we define the smooth and invertible function $h := \hat{g}^{-1} \circ g$ that transforms the true variables $(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}, \textbf{Z}^d_{t-\tau+1:t})$ to estimates $(\hat{\textbf{Z}}^s_{t-\tau-1:t},\hat{\textbf{Z}}^d_{t-\tau-1}, \hat{\textbf{Z}}^d_{t-\tau+1:t})$
 \begin{align}
     g_1(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1})=\hat{g}_1(h_{\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}}(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}, \textbf{Z}^d_{t-\tau+1:t}))
 \end{align}
 For $i \in \{1,...,d_{Z^d_1}\}$ and $j \in \{1,...,d_{Z^d_{2}}\}$
taking partial
derivative of the i-th dimension of both sides $w.r.t. z^d_{t-\tau+1:t,j}$
\begin{align}
    0= \frac{\partial \hat{g}_{1,i}(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1})}{\partial z^d_{t-\tau+1:t,j} }=\frac{\partial g_{1,i}(h_{\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}}(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}))}{\partial z^d_{t-\tau+1:t,j} }
\end{align}
The equation equals zero because there is no $z^d_{t\tau+1:t,j}$ in the left-hand
side of the equation. Expanding the derivative on the right-hand
side gives:
\begin{align}
    \sum_{k \in \{1,...,d_{z^s}+d_{\textbf{Z}^d_{t-\tau-1}}\}} \frac{\partial \hat{g}_{1,i}  }{\partial h_{(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}),k} } \cdot \frac{\partial  h_{(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}),k}}{ z^d_{t-\tau+1:t,j} } (\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}, \textbf{Z}^d_{t-\tau+1:t}) = 0 
\end{align}

assume $vectors [\frac{\partial \hat{g}_{1,i}  }{\partial h_{(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}),1} },..., \frac{\partial \hat{g}_{1,i}  }{\partial
h_{(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}),d_{z^s}+z^d_{t-\tau-1}}}]$
% h_{(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}),d_{z^s+d_{Z^d_{t-\tau-1}}}} ]
are linearly
independent, which is equivalent to the non-singular Jacobian matrix condition. Therefore, the linear system
is invertible and the solution states that:
\begin{align}
    \frac{\partial  h_{(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}),k}}{ z^d_{t-\tau+1:t,j} }(\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}, \textbf{Z}^d_{t-\tau+1:t}) = 0
\end{align}

 Therefore, we have shown that $h_{\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau-1}} , i.e. (\hat{\textbf{Z}}^s_{t-\tau-1:t},\hat{\textbf{Z}}^d_{t-\tau-1})$ does
not depend on $\textbf{Z}^d_{t-\tau+1:t}$ 

Applying the same reasoning to $h_{\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau+1}} $ , we can obtain \\ that $h_{\textbf{Z}^s_{t-\tau-1:t},\textbf{Z}^d_{t-\tau+1}} , i.e. (\hat{\textbf{Z}}^s_{t-\tau-1:t},\hat{\textbf{Z}}^d_{t-\tau+1})$  does not depend on $\textbf{Z}^d_{t-\tau-1}$
Thus,for $(\hat{\textbf{Z}}^s_{t-\tau-1:t},\hat{\textbf{Z}}^d_{t-\tau-1}, \hat{\textbf{Z}}^d_{t-\tau+1:t})$ we can observe that $\hat{\textbf{Z}}^s_{t-\tau-1:t}$ does not depend on  $\textbf{Z}^d_{t-\tau+1:t}$ and $\textbf{Z}^d_{t-\tau-1}$ , that is , $\hat{\textbf{Z}^s_{t-\tau-1:t}} = h_{\textbf{Z}^s_{t-\tau:t}}(\textbf{Z}^s_{t-\tau-1:t})$
$\textbf{Z}^s_{t-\tau-1:t}$ are subspace identifiable. \\

assumption
\begin{itemize}
    \item We imposed an L1 constraint on $z^d$, so the data processiong is identifiable\\
    \item Assuming intervention occurs within at least $\tau >2$ steps\\
    \item  (Smooth and Positive Density:) The probability density function of latent variables is smooth and positive, i.e.,$p(\textbf{z}_{t-\tau+1:t}|\textbf{z}^d_{t-\tau})>0$ over $Z_{t-\tau+1:t}$\\
    \item (Conditional independent:) Conditioned on $\textbf{z}^d_{t-\tau}$ each $z_i$ is independent of any other $z_j$ for $i,j\in {1,...,n}, i\neq j,i.e$, $\log{p(\textbf{z}^d_{t-\tau+1:t}|\textbf{z}^d_{t-\tau})} = \sum_{k=1}^{n_s} \log {p(z^d_{t-\tau+1:t,k}|\textbf{z}^d_{t-\tau})}$ \\
    \item (Linear Independent:) For any $\textbf{z}^d\in Z^d_{t-\tau+1:t}\subseteq \mathbb{R}^{n_s},\bar{v}_{t-\tau,1},...,\bar{v}_{t-\tau,n_s}$ as $n_s$ vector functions in $z^d_{t-\tau,1},...,z^d_{t-\tau.l},...,z^d_{t-\tau,n_s}$ are linear independent, where $\bar{v}_{t-\tau,l}$ are formalized as follows:
    \begin{align}
        \bar{\textbf{v}}_{t-\tau,l}=\frac{\partial^2 \log{p(\textbf{z}^d_{t-\tau+1:t}|\textbf{z}^d_{t-\tau})}  }{\partial z^d_{t-\tau+1:t ,k} \partial z^d_{t-\tau,k} } 
    \end{align}

\end{itemize}
 Proof. We start from the matched marginal distribution to develop the relation between $\textbf{z}_{t-\tau+1:t}$ and $\hat{\textbf{z}}_{t-\tau+1:t}$ as follows:

\begin{align}  
    p(\hat{\textbf{z}}_{t-\tau+1:t}) = p(\textbf{z}_{t-\tau+1:t})  \Longleftrightarrow p(\hat{g}(\hat{\textbf{z}}_{t-\tau+1:t})) = p(g(\textbf{z}_{t-\tau+1:t}))
    \Longleftrightarrow \\
    \nonumber
    p(g^{-1}\circ \hat{g}(\hat{\textbf{z}}_{t-\tau+1:t}))
    = p(\textbf{z}_{t-\tau+1:t})|\textbf{J}_{g^{-1}}|\Longleftrightarrow p(h(\hat{\textbf{z}}_{t-\tau+1:t})) = p(\textbf{z}_{t-\tau+1:t}),
\end{align} 


\begin{gather}  
    p(\hat{\textbf{z}}_{t-\tau+1:t}|\textbf{z}^d_{t-\tau}) = p(\textbf{z}_{t-\tau+1:t}|\textbf{z}^d_{t-\tau}) \cdot |\textbf{J}_h| \\  
    \log{p(\hat{\textbf{z}}_{t-\tau+1:t}|\textbf{z}^d_{t-\tau})} = \log{p(\textbf{z}_{t-\tau+1:t}|\textbf{z}^d_{t-\tau})} \\+ \log{|\textbf{J}_h|}   
    = \log{p(\textbf{z}^d_{t-\tau+1:t}|\textbf{z}^d_{t-\tau})} + \log{p(\textbf{z}^s_{t-\tau+1:t}|\textbf{z}^d_{t-\tau})} + \log{|\textbf{J}_h|}  
\end{gather}
Therefore, for $i \in \{n_s+1,...,n\}$,the partial derivative of the equation $w.r.t\ \hat{z}^s_{t-\tau+1:t,i}$ is:

\begin{align}
    \frac{\partial p(\hat{z}_{t-\tau+1:t}|\textbf{z}^d_{t-\tau}) }{\partial \hat{z}^s_{t-\tau+1:t,i} } =  {\textstyle \sum_{k=1}^{n_s}}\frac{\partial \log{p(z^s_{t-\tau+1:t,k}|\textbf{z}^d_{t-\tau})} }{\partial z^s_{t-\tau+1:t,k} } \cdot  \frac{\partial z^s_{t-\tau+1:t,k} }{\partial \hat{z}^s_{t-\tau+1:t,i}  } \\ +
     {\textstyle \sum_{k=n_s+1}^{n}} \frac{\partial p(z^d_{t-\tau+1:t}|\textbf{z}^s_{t-\tau})}{\partial z^d_{t-\tau+1:t,k} } \cdot \frac{\partial z^d_{t-\tau+1:t,k} }{\partial \hat{z}^s_{t-\tau+1:t,i}  } + \frac{\partial \log{|J_h|} }{\hat{z}^s_{t-\tau+1:t,i}} 
\end{align}

Sequentially, for each $l\in \{1,...,n_s\}$ , and each value of $z^d_{t-\tau,l}$ , its partial derivative $w.r.t.\ z^d_{t-\tau,l}$  is shown as follows:

\begin{align}
    \frac{\partial^2 p(\hat{z}_{t-\tau+1:t}|\textbf{z}^d_{t-\tau}) }{\partial \hat{z}^s_{t-\tau+1:t,i} \partial z^d_{t-\tau,l}} =  {\textstyle \sum_{k=1}^{n_s}}\frac{\partial^2 \log{p(z^s_{t-\tau+1:t,k}|\textbf{z}^d_{t-\tau})} }{\partial z^s_{t-\tau+1:t,k} \partial z^d_{t-\tau,l}} \cdot  \frac{\partial z^s_{t-\tau+1:t,k} }{\partial \hat{z}^s_{t-\tau+1:t,i}  } +
     \\
     \nonumber{\textstyle \sum_{k=n_s+1}^{n}} \frac{\partial^2 p(z^d_{t-\tau+1:t}|\textbf{z}^d_{t-\tau})}{\partial z^d_{t-\tau+1:t,k} \partial z^d_{t-\tau,l}} \cdot \frac{\partial z^d_{t-\tau+1:t,k} }{\partial \hat{z}^s_{t-\tau+1:t,i}  } + \frac{\partial^2 \log{|J_h|} }{\partial z^d_{t-\tau:t,i}\partial \hat{z}^s_{t-\tau+1,l}} 
\end{align}

\begin{align}
    0 =  {\textstyle \sum_{k=1}^{n_s}}\frac{\partial^2 \log{p(z^d_{t-\tau+1:t,k}|\textbf{z}^d_{t-\tau})} }{\partial z^d_{t-\tau+1:t,k} \partial z^d_{t-\tau,l}} \cdot  \frac{\partial z^d_{t-\tau+1:t,k} }{\partial \hat{z}^s_{t-\tau+1:t,i}  }
\end{align}

% \begin{vmatrix}
% \frac{\partial z^s_{t} }{\partial z^s_{t} } & \cdots & \frac{\partial z^s_{t}}{\partial z^s_{t+\tau}} & \frac{\partial z^s_{t} }{\partial z^d_{t}} & \cdots & \frac{\partial z^s_{t} }{\partial z^d_{t+\tau}} \\
% & & & & & \\
% & & & & & \\
% & & & & & \\
% & & & & & \\
% & & & & &
% \end{vmatrix}

% \begin{equation}
% \small
% \begin{gathered}\nonumber
%     \large
%     \mathbf{J}_{\mathbf{h}}=\begin{bmatrix}
%     \begin{array}{cccccc}
%         \frac{\partial z^s_{t-\tau} }{\partial z^s_{t-\tau} } & \cdots & \frac{\partial z^s_{t-\tau}}{\partial z^s_{t}} & \frac{\partial z^s_{t-\tau} }{\partial z^d_{t-\tau}} & \cdots & \frac{\partial z^s_{t-\tau} }{\partial z^d_{t}} \\
%          \cdots & \cdots & \cdots &\cdots & \cdots & \cdots\\
%        \frac{\partial z^s_{t} }{\partial z^s_{t-\tau} } & \cdots & \frac{\partial z^s_{t}}{\partial z^s_{t}} & \frac{\partial z^s_{t} }{\partial z^d_{t-\tau}} & \cdots & \frac{\partial z^s_{t} }{\partial z^d_{t}}\\
%        \cdots & \cdots & \cdots &\cdots & \cdots & \cdots\\
%        \frac{\partial z^d_{t-\tau} }{\partial z^s_{t-\tau} } & \cdots & \frac{\partial z^d_{t-\tau}}{\partial z^s_{t}} & \frac{\partial z^d_{} }{\partial z^d_{t-\tau}} & \cdots & \frac{\partial z^d_{t-\tau} }{\partial z^d_{t}} \\
%        \cdots & \cdots & \cdots &\cdots & \cdots & \cdots\\
%        \frac{\partial z^d_{t} }{\partial z^s_{t-\tau} } & \cdots & \frac{\partial z^d_{t}}{\partial z^s_{t}} & \frac{\partial z^d_{t} }{\partial z^d_{t-\tau}} & \cdots & \frac{\partial z^d_{t} }{\partial z^d_{t}} \\
%     \end{array}
%     \end{bmatrix}.
% \end{gathered}
% \end{equation}

% \begin{equation}
% \small
% \begin{gathered}\nonumber
%     \mathbf{A}_=\begin{bmatrix}
%     \begin{array}{ccc}
%       \frac{\partial z^s_{t-\tau} }{\partial z^s_{t-\tau} } & \cdots & \frac{\partial z^s_{t-\tau}}{\partial z^s_{t}}\\
%        \cdots & \cdots & \cdots \\
%         \frac{\partial z^s_{t} }{\partial z^s_{t-\tau} } & \cdots & \frac{\partial z^s_{t}}{\partial z^s_{t}} 
%     \end{array}
%     \end{bmatrix}.
% \end{gathered}
% \end{equation}

% \begin{equation}
% \small
% \begin{gathered}\nonumber
%     \mathbf{B}_=\begin{bmatrix}
%     \begin{array}{ccc}
%       \frac{\partial z^s_{t-\tau} }{\partial z^d_{t-\tau}} & \cdots & \frac{\partial z^s_{t-\tau} }{\partial z^d_{t}}\\
%       \cdots & \cdots & \cdots \\
%       \frac{\partial z^s_{t} }{\partial z^d_{t-\tau}} & \cdots & \frac{\partial z^s_{t} }{\partial z^d_{t}}
%     \end{array}
%     \end{bmatrix}.
% \end{gathered}
% \end{equation}
% $B=0$\\
% $A$ full rank\\
Identifiablity under a Fixed Temporal Causal Model\\
\begin{itemize}
    \item (Conditional independent:) Conditioned on $x_{t-1}$ each $z_{t,i}$ is independent of any other $z_j$ for $i,j\in {1,...,n}, i.e$, $\log{p(\textbf{z}^s_{t}|\textbf{z}_{t-1})} = \sum_{k=1}^{n_s} \log {p(z^s_{t,k}|\textbf{z}_{t-1})}$ \\
    \item \begin{align}
    v_{k,t} = (\frac{\partial^2 \log{p(z^s_{t,k}|z^s_{t-1})} }{\partial z^s_{k,t} \partial z^s_{1,t-1}},\frac{\partial^2 \log{p(z^s_{t,k}|z^s_{\tau -1}})} {\partial z^s_{k,t} \partial z^s_{2,t-1}},...,\frac{\partial^2 \log{p(z^s_{t,k}|z^s_{t-1}})} {\partial z^s_{k,t} \partial z^s_{n,t-1}} )^T\\
    \nonumber
    \hat{v}_{k,t} = (\frac{\partial^3 \log{p(z^s_{t,k}|z^s_{t-1})} }{\partial^2 z^s_{k,t} \partial z^s_{1,t-1}}, \frac{\partial^3 \log{p(z^s_{t,k}|z^s_{t-1})} }{\partial^2 z^s_{k,t} \partial z^s_{2,t-1}},..., \frac{\partial^3 \log{p(z^s_{t,k}|z^s_{t-1})} }{\partial^2 z^s_{k,t} \partial z^s_{n,t-1}})^T
\end{align}
\item \begin{align}
    z^s_t = h(\hat{z}^s_t)
\end{align}
\end{itemize}

Since $p(\hat{z}^s_t,\hat{z}^s_{t-1}) =p(\hat{z}^s_t|\hat{z}^s_{t-1})p(\hat{z}^s_{t})$ \\while $p(\hat{z}^s_{t})$ does not involve $z^s_{t,i}$ or $z^s_{t,j}$ the above equality is equivalent to:

\begin{align}
    \frac{\partial^2 \log{p(\hat{z}^s_t|\hat{z}^s_{t-1})} }{\partial z^s_{t,i}\partial z^s_{t,j} } =0
\end{align}

\begin{align}
    \log{p(\hat{z}^s_t|\hat{z}^s_{t-1})} & = \log{p(z^s_t|z^s_{t-1})} + \log{|J_{h}|}\\
    \nonumber
   & =  \textstyle \sum_{k=1}^{n} \log{p(z^s_{t,k}|z^s_{t-1})} + \log{|J_{h}|}
\end{align}

Its partial derivative $w.r.t. \hat{z}^s_{t,i}$

\begin{align}
    \frac{\partial \log{p(\hat{z}^s_t|\hat{z}^s_{t-1}) }}{\partial \hat{z}^s_{t,i} } =  \textstyle \sum_{k=1}^{n} \frac{\partial p(\hat{z}^s_t|\hat{z}^s_{t-1})}{\partial z^s_{t,k}}\frac{\partial z^s_{t,k}}{\partial \hat{z}^s_{t,i}} - \frac{\partial \log{|J_h|} }{\partial \hat{z}^s_{t,i}} 
\end{align}

Its second-order cross derivative is:

\begin{align}
    \frac{\partial^2 \log{p(\hat{z}^s_t|\hat{z}^s_{t-1}) }}{\partial \hat{z}^s_{t,i} \partial \hat{z}^s_{t,j}} &=  \textstyle \sum_{k=1}^{n} (\frac{\partial^2 p(\hat{z}^s_t|\hat{z}^s_{t-1})}{\partial z^{s2}_{t,k}}\frac{\partial z^s_{t,k}}{\partial \hat{z}^s_{t,i}}\frac{\partial z^s_{t,k}}{\partial \hat{z}^s_{t,j}} + \frac{\partial p(\hat{z}^s_t|\hat{z}^s_{t-1})}{\partial z^s_{t,k}} \cdot \frac{\partial^2 z^s_{t,k}}{\partial \hat{z}^s_{t,i}  \partial \hat{z}^s_{t,j}})\\
    \nonumber &- \frac{\partial \log{|J_h|} }{\partial\hat{z}^s_{t,i}\partial \hat{z}^s_{t,j}} 
\end{align}

The above quantity is always 0, Therefore, for each$l = 1, 2, ..., n$ and each value $z^s_{t-1,l}, $ its partial derivative$w.r.t. z^s_{t-1,l} $ is always 0. That is,

\begin{align}
    \frac{\partial^3 \log{p(\hat{z}^s_t|\hat{z}^s_{t-1}) }}{\partial \hat{z}^s_{t,i} \partial \hat{z}^s_{t,j} \partial z^s_{t-1,l}} &= \textstyle \sum_{k=1}^{n} (\frac{\partial^3
p(\hat{z}^s_t|\hat{z}^s_{t-1})}{\partial z^{s2}_{t,k}\partial z^s_{t-1,l}}
\frac{\partial z^s_{t,k}}{\partial \hat{z}^s_{t,i}}
\frac{\partial z^s_{t,k}}{\partial \hat{z}^s_{t,j}} \\
\nonumber &+ 
\frac{\partial^2 p(\hat{z}^s_t|\hat{z}^s_{t-1})}{\partial z^s_{t,k}\partial z^s_{t-1,l}}
\frac{\partial^2 z^s_{t,k}}{\partial \hat{z}^s_{t,i} \cdots 
\partial \hat{z}^s_{t,j}}) \equiv  0
\end{align}


\end{document}