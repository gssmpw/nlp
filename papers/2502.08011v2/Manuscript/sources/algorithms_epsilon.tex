\begin{algorithm}[!tb]
  \caption{Training-Free Safe Diffusion Models}
  \label{alg:safer_epsilon}
  \begin{algorithmic}
    \STATE {\bfseries Input:} 
    Diffusion Models $\epsilon_{\theta}$, Feature extractor $f_{\phi}$, Reference data points $Z = \{z_k\}_{k=1}^K$, and $\sigma_t \sim \mathcal{N}(0, \frac{(1 - \alpha_t)(1 - \bar{\alpha}_{t-1})}{1 - \bar{\alpha}_t}\textbf{I}) $
    \vspace{.1cm} 
    
    \STATE {\bfseries Initialize:} Noisy input $x_T \sim \mathcal{N}(0, \textbf{I})$
    \FOR{$t=T$ {\bfseries to} $0$} 
    \STATE Evaluate pre-defined diffusion models $\epsilon_{\theta}(x_t)$

    \STATE $\nabla \log p(x_t) = - \frac{1}{\sqrt{1 - \bar{\alpha}_t}} \epsilon_{\theta}(x_t)$ \hfill given in \eqref{eq_epsilon_score}
    
    \STATE   
    $\hat{x}_0 \leftarrow 
    \frac{1}{\sqrt{\bar{\alpha_t}}} \big(x_t + (1- \bar{\alpha_t})\nabla \log p(x)\big)$  \hfill given in \eqref{eq_tweedie_dm}

    \STATE
    ${\hat{x}_0}' \leftarrow \text{Our Method}$

    \STATE
    $x_{t-1} \leftarrow \frac{\sqrt{\alpha_t} (1 - \bar{\alpha}_{t-1})}{1 - \bar{\alpha}_t} x_t + \frac{\sqrt{\bar{\alpha}_{t-1}}(1-\alpha_t)}{1 - \bar{\alpha}_t}{\hat{x}_0}' + \sigma_t $ by \eqref{eq_reverse_2}
    \ENDFOR 
  \end{algorithmic}
\end{algorithm}