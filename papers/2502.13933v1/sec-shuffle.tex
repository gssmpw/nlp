%!TEX root = main.tex

\section{Shuffled A-loss recall}
\label{sec:shuffled-loss-recall}

\input{Figures/fig-alr-shuffle}

We start with an example. The game-structure in \cref{fig:shuffle-a}
is an equivalent game of version \textbf{II} of the matching-unmatching
game (\cref{fig:match-penny-3-die-b}) obtained by merging die outcome $0$ and $1$ (and renaming $H, T$), with $p_1 = \frac{2}{3}, p_2 = \frac{1}{3}$. The game
does not have $\alr$: we have
$\Hh_{\Max}(I_3) = \{b, \bar{b}, c, \bar{c}\}$. Since
$\{b, \bar{b}\}$ and $\{c, \bar{c}\}$ are from different information
sets, the pair of histories $b$ and $c$, for instance, is a witness
for no $\alr$. The player forgets what she knew about $\chance$ actions. Now,
consider the game-structure in~\cref{fig:shuffle-b}, obtained by
\emph{shuffling} the actions ($a$ goes above $b$ and $c$). This
game-structure has $\alr$. The crucial observation is that both
the game-structures, \cref{fig:shuffle-a} and \cref{fig:shuffle-b},
lead to the same leaf monomials\footnote{Two monomials are same if their sets of variables are same}:
$\{x_ax_b,~x_ax_{\bar{b}},~x_{\bar{a}}x_b,~x_{\bar{a}}x_{\bar{b}},~x_ax_c,~
x_ax_{\bar{c}},~x_{\bar{a}}x_c,~x_{\bar{a}}x_{\bar{c}} \}$. Similarly,
in \cref{fig:match-penny-3-die-b}, by shuffling the turns of Alice and
Bob, we get an $\alr$ recall game that induces the same leaf
monomials. 

We say that the game-structure of ~\cref{fig:shuffle-a} has
\emph{shuffled A-loss recall}. Even though the game-structure
originally does not have $\alr$, it can be shuffled in some way
to get an $\alr$ structure.  Not every game-structure has shuffled
A-loss recall. In this section, we provide a polynomial-time algorithm
to identify whether a game-structure has shuffled A-loss recall. If
the answer is yes, the algorithm also computes the shuffled
game-structure. As a result, we are able to show that one-player
shuffled A-loss recall games can be solved in
polynomial-time. 
We will keep our discussion to one-player games played by $\Max$, and
later in \cref{sec:two-player} discuss extensions to two-player
games. 
We will require few notions and notations, which we introduce
gradually as we need them.


For a game structure $\Tt$, we write $L_{\Tt}$ for the set of its
leaves. Define $|\Tt|$, the \emph{size} of a game structure $\Tt$, to be
$|L_{\Tt}|$, the total number of its leaves. We work with history sequences originating from game structures.
Fix a finite set of information
sets $\Ii$ and a set of actions $\act(I)$ for each $I \in \Ii$.~Recall that the action sets of distinct information sets are disjoint. 
Let $A = \biguplus_{I \in \Ii} \act(I)$. A \emph{sequence} is a finite word over
$A^*$ that contains at most one letter from each $\act(I)$ \footnote{
 We restrict to such words in $A^*$ since histories in an $\nam$ game structure have this property}.

Let $s[i]$ denote the $i$th action in $s$. For sequences $s_1$ and $s_2$ of length $k$, we say
$s_2$ is a permutation of $s_1$ if $\exists$~a bijective function
$\rho : \{1,\dots,k\} \mapsto \{1,\dots,k\}$ such that $\forall i$,
$s_1[i] = s_2[\rho(i)]$.


\begin{definition}[Shuffled A-loss recall]\label{def:salr}
  A game structure $\Tt$ is said to have shuffled A-loss
  recall~(\salr) if $\exists$ a game structure $\Tt'$ with
  $|\Tt| = |\Tt'|$ such that
  \begin{itemize}   \item $\Tt'$ has A-loss recall
  \item There is a bijection $f : L_{\Tt} \mapsto L_{\Tt'}$ such that
    $\forall t \in L_{\Tt}$, $\his(f(t))$ is a permutation of
    $\his(t)$.
  \end{itemize}
\end{definition}
When $\Tt$ has $\salr$ we call the structure $\Tt'$ an $\salr$ witness of $\Tt$. The following lemma is a consequence on leaf monomials.

\begin{restatable}{lemma}{shuffleSameLeafMonomials}\label{lem:alr-salr-same-leaf-monomials}
  Suppose $\Tt$ has $\salr$ with $\salr$ witness $\Tt'$, then $\Tt$ and $\Tt'$ have the same set of leaf
  monomials.
\end{restatable}


\paragraph*{Detecting S-ALR.}

Checking whether a structure $\Tt$ has $\pfr$ or $\alr$ can be done in
polynomial-time, simply by checking histories at every information
set. On the other hand, from the definition of $\salr$, it is not
immediate if one could test it efficiently. One approach could be
finding good permutations for each leaf history in order to get the $\salr$ witness but this could potentially lead to
exponentially many checks.  In the following discussion we will
provide a polynomial-time algorithm to test $\salr$ in a structure.

\begin{theorem}\label{thm:shuffle-detection-ptime} Given a game structure
  $\Tt$, there is an algorithm that checks if $\Tt$ has $\salr$ in
  time $O(|\Tt|)$. Moreover if $\Tt$ does have $\salr$, this algorithm
  also outputs an $\salr$ witness structure $\Tt'$.
\end{theorem}

To prove Theorem~\ref{thm:shuffle-detection-ptime}, we will work with
the history sequences. For a game structure $\Tt$, recall that
$\Hh(L_{\Tt})$ is the set of all leaf histories in $\Tt$. We will
construct a set of leaf histories $H'$ such that $H' = \Hh(L_{\Tt'})$
for some $\alr$ structure $\Tt'$. Since we work with sequences, and
not game-structures themselves, we will need a notion of $\alr$ for
sets of words. When we are given a game, $\alr$ can be detected by
looking at the histories. When we are given a set of histories, it is
not as direct. We will need to determine some structure inside the
sequences.


\paragraph*{ALR on sequence sets.} 

Two sequences $s_1, s_2$ over $A$ are said to be \emph{connected} if
there is some information set $I$ such that both $s_1$ and $s_2$
contain an action from $\act(I)$. E.g., suppose
$\act(I_1) = \{a, b\}$, $\act(I_2) = \{c, d\}$, $\act(I_3) = \{e,f\}$; then $s_1 = ac$ and
$s_2 = eb$ are connected since $s_1$ contains $a$, $s_2$ contains $b$,
both of which are in $\act(I_1)$. Sequences $s_1, s_2$ are said to be
\emph{disconnected} if they are not connected. For the same alphabet
as before, let $s_3 = e$, then $s_1$ and $s_3$ are disconnected.

We say that a set of sequences $S$ is connected if for every disjoint
partition of $S$ as $S_1 \uplus S_2$ (where $S_1, S_2$ are non-empty),
there exist $s_1 \in S_1$ and $s_2 \in S_2$ such that $s_1$ and $s_2$
are connected. E.g., consider $S = \{ac, eb, e\}$ with
information sets as above. This set $S$ is connected, even though $ac$
and $e$ are not connected. For a set $S$, we can construct an
undirected graph as follows: each $s \in S$ is a vertex, and there is
an edge between $s_1, s_2 \in S$ if they are connected. Notice that a
set $S$ is connected iff there is a path between any two vertices in
this graph. This interpretation allows to decompose $S$ uniquely as
$S = \biguplus_i S_i$ where each $S_i$ is a
\emph{maximal connected component} in the graph.


We can now give a definition of $\alr$ on sequences. This is defined
inductively as follows. The set $\{\epsilon\}$ has $\alr$. A disconnected set
$S$ with decomposition $\biguplus_i S_i$ has $\alr$ if each of
its connected components $S_i$ has $\alr$. A connected set $S$ has
$\alr$ if there exists an $I \in \Ii$ s.t.:
\begin{enumerate} \item every sequence in $S$ starts with $\act(I)$: i.e. each
  $w \in S$ is of the form $a u$ for some $a \in \act(I)$, and
\item the set of continuations of each $a \in \act(I)$ has $\alr$: for
  each $a \in \act(I)$, the set $\{ u \mid au \in S\}$ has $\alr$.
\end{enumerate}
Let us illustrate this definition on examples from
\cref{fig:recall-examples}. In \ref{fig-allexmp-pftrec}, we have the
leaf histories $H_1 = \{ac, ad, be, bf\}$. Notice that $H_1$ is a
connected set. There is an information set $I_1$ with
$\act(I_1) = \{a, b\}$ such that the first condition above is
true. For the second condition, let us look at the continuations:
$H_1^a = \{c, d\}$ and $H_1^b = \{e, f\}$. Both $H_1^a$ and $H_1^b$
are connected and satisfy the first condition. The second condition is
vacuously true for $H_1^a$ and $H_1^b$. This shows $H_1$ has $\alr$
(as expected, since on game-structures, $\pfr$ is a subclass of
$\alr$). Now, let us look at \cref{fig:shuffle-a}. The leaf
histories are given by $H_2 = \{ba,b\bar{a},\bar{b}a,\bar{b}\bar{a},ca,c\bar{a},\bar{c}a,\bar{c}\bar{a}\}$. Observe that
$H_2$ is connected. However, the first condition in the $\alr$
definition does not hold. So $H_2$ is not $\alr$. We can show that the recursive
definition of $\alr$-sets and that of $\alr$ game structures are equivalent.

\begin{restatable}{proposition}{alrSetStructEquiv}\label{prop:alr-set-struct-equiv}
  A game structure $\Tt$ has $\alr$ iff $\Hh(L_{\Tt})$ has $\alr$.
\end{restatable}


              
           

        
     

  
\paragraph*{S-ALR on sequence sets.} We can also extend the
definition of $\salr$ to sequence sets.  $S$ has $\salr$ if $\exists$
another set $S'$ such that (i) $S'$ has $\alr$ and (ii) there is a
bijection $f : S \mapsto S'$ where $\forall s \in S,$ $f(s)$ is a
permutation of $s$. We call the set $S'$ an $\salr$ witness of $S$.

Exploiting the recursive definition of $\alr$ sets we will provide
recursive necessary and sufficient conditions for sequence sets to
have $\salr$.  Firstly, one can check for $\salr$ for a set $S$ by
checking $\salr$ for each individual maximal connected components.

\begin{restatable}{proposition}{salrDisc}\label{lem:aloss-shuffle-disconnected}
  Let $S$ be a disconnected set and $S = \biguplus_i S_i$ be the
  decomposition of $S$ into maximal connected components. Then $S$ has
  $\salr$ iff $\forall i,S_i$ has $\salr$ .
\end{restatable}

\begin{restatable}{corollary}{salrDiscApply}\label{cor:alosshuffle-disconnected-apply}
  Let $S =\uplus_i S_i$ be the decomposition of $S$ where each $S_i$
  has $\salr$ witnessed by sets $S'_i$. Then $S$ has $\salr$ and
  $S' = \bigcup_i S'_i$ is an $\salr$ witness of $S$.
\end{restatable}

Secondly, for connected sets we will provide another recursive
condition to have $\salr$. We use another notation. For an action
$a \in A$, we write $S_a := \{u_1 u_2 \mid u_1 a u_2 \in S\}$, for the
set of sequences obtained by picking a sequence in $S$ that contains $a$,
and dropping the $a$ from it.

\begin{restatable}{proposition}{commonact}\label{prop:commonact}
  Let $S$ be a connected set. $S$ has $\salr$ iff there exists an
  information set $I \in \Ii$ such that
  \begin{enumerate}   \item every sequence $s \in S$ contains an action from $\act(I)$,
  \item and for all $a \in \act(I)$, the set $S_a$ has $\salr$.
  \end{enumerate}
\end{restatable}

The above proposition can be naturally translated into an
algorithm. However, this does not yet ensure a polynomial-time
complexity. If there are two information sets $I_1$ and $I_2$ that
satisfy Condition 1 of Proposition~\ref{prop:commonact}, the order in
which we pick them might, in principle, create a difference and hence
one has to guess the right order. The next lemma says this does not
happen.

\begin{restatable}{lemma}{salrPtime}\label{lem:salr-common-act}
  Let $S$ be a connected set and let $I$ be an arbitrary information
  set such that every sequence $s \in S$ contains an action from
  $\act(I)$. Then: $S$ has $\salr$ iff for all $a \in \act(I)$, the
  set $S_a$ has $\salr$. Moreover, if for each $a$, $S'_a$ is $\salr$ witness of $S_a$, then $\bigcup_{a} aS_a'$ is an $\salr$ witness of $S$.  
\end{restatable}

\input{algo-shuffle}

Proposition~\ref{prop:commonact} and Lemma~\ref{lem:salr-common-act} lead
to
Algorithm~\ref{algo:alosshuffle}.      This algorithm runs in time $\Oo(|S|)$, proving
Theorem~\ref{thm:shuffle-detection-ptime}.
Here is an example run of the algorithm on \cref{fig:shuffle-a}. 

We
have $S = \{ ba, b\bar{a}, \bar{b}a, \bar{b}\bar{a}, ca, c\bar{a}, \bar{c}
a, \bar{c} \bar{a} \}$. All the sequences contain an action from
$\act(I_1) = \{a, \bar{a}\}$. For the recursive call, we the set
$H = \{b, \bar{b}, c, \bar{c}\}$. This set is disconnected, with
components $H_1 = \{b, \bar{b}\}$ and $H_2 = \{c, \bar{c}\}$. For
$H_1, H_2$ the same sets are witness for $\salr$. For $H$, the witness
is the same set again. For $S$, the witness is
$aH \biguplus \bar{a}H = \{ab, a\bar{b}, \dots, \bar{a} c, \bar{a}
\bar{c} \}$. This set can be translated to the game
\cref{fig:shuffle-b}, with $\alr$.   Now, back to our
running example \cref{fig:match-penny-3-die-b}. Let $H_{01}, T_{01}$ and
$H_2, T_2$ be Alice's actions out of the information sets obtained
after die roll $0$ or $1$, and $2$ respectively. The induced
sequence set is $\{ H_{01} H, H_{01} T, T_{01} H, T_{01}T, H_2 H, T_2
T \}$, which can be seen to have $\salr$. In fact, for all values for
$n$, the game \textbf{II} has $\salr$.
                                                             

Theorem~\ref{thm:shuffle-detection-ptime} and the fact that $\alr$
games can be solved in polynomial-time give us the following theorem,
and hence a new polynomial-time solvable class with imperfect
recall.

 
\begin{restatable}{theorem}{onepShufflePtime}\label{thm:1p-shuffle-ptime}
  The maxmin value in one-player games with $\salr$ can be computed in
  polynomial time.
\end{restatable}
         
\endinput

To prove \cref{thm:1p-shuffle-ptime} we consider behavioral
strategies expressed using probability variables ; $x_a$ for action
$a$. For a leaf $t \in L$ in a game structure $\Tt$ the product of
action variables on $\pathto(t)$ gives a \emph{leaf monomial}
$\mu(t)$. Now for a game $G$ on $\Tt$, the polynomial given by
$\sum\limits_{t \in L}\mu(t)Prob_{\chance}(t)\Uu(t)$ is the payoff
polynomial of $G$. A valuation of $\{x_a\}_{a \in A}$ in $[0,1]^{|A|}$
satisfying the \emph{strategy constraints}
\[ \forall I \in \Ii,~ \sum\limits_{a \in Act(I)} x^I_{a} = 1\] gives
a behavioral strategy and the corresponding valuation of the payoff
polynomial is the corresponding expected payoff. Computing maxmin
value is equivalent to optimizing the payoff polynomial under the
strategy constraints.

\begin{proposition}
  The maxmin value of $G$ is the maximum value attained by payoff
  polynomial over the domain $[0,1]^{|A|}$ under the strategy
  constraints
\end{proposition}

\begin{lemma}
  For a game structure $\Tt$, if $\Tt$ has $\salr$ witnessed by
  $\Tt'$, then $\Tt$ and $\Tt'$ has the same set of leaf monomials.
\end{lemma}

\begin{proof}[Proof sketch of \cref{thm:1p-shuffle-ptime}]
  Given a game $G = (\Tt, \Uu, \d)$, one can verify and construct the
  $\alr$ structure $\Tt'$ that is the $\salr$ witness of $\Tt$. Since
  the payoff polynomial is linear combination of leaf monomials and
  set of leaf monomials are same, once can assign suitable $\Uu'$ and
  $\d'$ to $\Tt'$ to get a game $G'$ with the same payoff
  polynomial. $G'$ being an $\alr$ game can be solved efficiently
  which solves $G$ as well.
\end{proof}

\endinput


\emph{Payoff polynomial}~:~ The space of behavioral strategy profiles
in a game $G$ can be expressed by fixing variables for actions in
$G$. The symbolic strategy $X_{\Max}$ of $\Max$ in $G$ is the set of
variables $X_{\Max} = \{x^I_a| I \in \Ii_{\Max}, a \in Act(I) \}$
where $x^I_a$ is assigned to the action $a$ from information set $I$ in
$G$. The symbolic strategy $X_{\Min}$ of $\Min$ is defined
similarly. The symbolic strategy profile is given by
$X = X_{\Max} \cup X_{\Min}$.  \soum{introduce leaf monomial and
  express payoff polynomial as linear combination of leaf monomials}
The \emph{payoff polynomials} given by $\Ee_G(X)$, a polynomial, is
the expected payoff under the strategy profile $X$ where $x^I_a$ is
treated as the probability of playing action $a$ at information set
$I$.  A symbolic strategy profile in itself doesn't denote any
particular behavioral strategy.  However, a valuation of $X$ in
$[0,1]^{|\Ii|}$ satisfying the \emph{strategy constraints}
\[ \forall I \in \Ii,~ \sum\limits_{a \in Act(I)} x^I_{a} = 1\] gives
a behavioral strategy. The corresponding valuation of the payoff
polynomial is the corresponding expected payoff. There is a one-to-one
correspondence between valuations of $X$ over $[0,1]^{|\Ii|}$ and the
space of behavioral strategy profiles in $G$.

\begin{lemma}
  Let $G$ be a game. Then the maxmin value of $G$ is given by (state
  in terms of payoff polynomial)
\end{lemma}

\begin{lemma}
  For a game structure $\Tt$, if $\Tt$ has $\salr$ witnessed by
  $\Tt'$, then $\Tt$ and $\Tt'$ has the same set of leaf monomials.
\end{lemma}

\begin{proof}[Proof sketch of \cref{thm:1p-shuffle-ptime}]
  Given a game $G = (\Tt, \Uu, \d)$, one can verify and construct the
  $\alr$ structure $\Tt'$ that is the $\salr$ witness of $\Tt$. Since
  the payoff polynomial is linear combination of leaf monomials and
  set of leaf monomials are same, once can assign suitable $\Uu'$ and
  $\d'$ to $\Tt'$ to get a game $G'$ with the same payoff
  polynomial. $G'$ being an $\alr$ game can be solved efficiently
  which solves $G$ as well.
\end{proof}
 


     