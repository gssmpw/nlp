\begin{algorithm}[t]
	\caption{$\PCO$: Episodic Reward-free RL via Two-Context Regression}
	\label{alg:pco}
	\begin{algorithmic}[1]\onehalfspacing
          \State \textbf{input:} Two-context regression oracle $\Reg$; efficiency function $\Nreg: (0,1)\times(0,1)\to\NN$; \# of latent states $S$; final error tolerance $\epfinal \in (0,1)$; failure parameter $\delta \in (0,1)$; horizon $H$; action set $\MA$.
		%
%        \State Define $\pihat_k: \MX \to \Delta(\MA)$ by $\pihat_k(x) := \Unif(\MA)$.
        \State $N \gets \Nreg\left(\left(\frac{\epfinal\delta}{H|\MA|S}\right)^{C_{\ref{thm:pco-app}}},\left(\frac{\epfinal\delta}{H|\MA|S}\right)^{C_{\ref{thm:pco-app}}}\right)$.
        \State $\trunc \gets \epfinal/(4+HS)$.
        \State $R \gets SH$, $\tsmall \gets \frac{\trunc^2}{RS^2H^2}$, $\alpha \gets \frac{1-4\trunc}{S}$, $m \gets \frac{2}{\min(\alpha\trunc,\tsmall)}\log(S/\delta)$, $n \gets \frac{m|\MA|}{\trunc}$.
        \State $\epsilon \gets \min(\frac{\alpha^{32}\trunc^{64}\tsmall^{32}}{96^{16}H^{16}S^{16}|\MA|^{32}m^8}, \frac{\delta^4}{81n^4})$, $\gamma \gets \epsilon^{1/16}$, $\gamma' \gets 2\epsilon^{1/8}\sqrt{m|\MA|}$.
        \State $\Gamma^{(1)} \gets \emptyset$.
        \For{$1 \leq r \leq R$}
            \State $\Psi_1^{(r)} := \{\piunif\}$.
            \For{$1 \leq h < H$}
                \State $\Psi_{h+1}^{(r)} \gets \EPCO(\Reg, h, \Psi_{1:h}^{(r)}, \Gamma,n,m,N,\gamma,\gamma')$.\Comment{See \cref{alg:extend-pc-online}}
            \EndFor
            \State $\Gamma^{(r+1)} \gets \Gamma^{(r)} \cup \bigcup_{h \in [H]:|\Psi_h^{(r)}| \leq S} \Psi_h^{(r)}$.
        \EndFor
        \State \textbf{return} $\bigcup_{h \in [H]} \bigcup_{1 \leq r \leq R: |\Psi_h^{(r)}| \leq S} \Psi_h^{(r)}$.
	\end{algorithmic}
\end{algorithm}

\begin{algorithm}[t]
	\caption{$\EPCO$: Extend Policy Cover for Episodic RL}
	\label{alg:extend-pc-online}
	\begin{algorithmic}[1]\onehalfspacing
          \State \textbf{input:} Two-context regression oracle $\Reg$; step $h \in [H]$; policy covers $\Psi_{1:h}$; backup policy cover $\Gamma$; sample counts $n,m,N\in\NN$; tolerances $\gamma,\gamma' \in (0,1)$.
		%
%        \State Define $\pihat_k: \MX \to \Delta(\MA)$ by $\pihat_k(x) := \Unif(\MA)$.
        \State $\Reg'(\cdot) \gets \OneTwo(\Reg,\cdot)$ \Comment{See \cref{alg:onetwo}}
        \For{$a \in \MA$}
            \State $\MD_a \gets \emptyset$.
            \For{$N$ times}
                \State Sample trajectory $(x_1,a_1,\dots,x_h,a,x_{h+1}) \sim \frac{1}{2}\left(\Unif(\Psi_h) + \Unif(\Gamma)\right) \circ_h a$.
                \State Sample trajectory $(x'_1,a'_1,\dots,x'_h,a'_h,x'_{h+1}) \sim \frac{1}{2}\left(\Unif(\Psi_h) + \Unif(\Gamma)\right) \circ_h \Unif(\MA)$.
                \State Draw $y \sim \Ber(1/2)$.
                \State If $y = 1$, update dataset: $\MD_a \gets \MD_a \cup \{(x_h,x_{h+1},y)\}$.
                \State If $y = 0$, update dataset: $\MD_a \gets \MD_a \cup \{(x_h,x'_{h+1},y)\}$.
            \EndFor
            \State $\wh f_{h+1}(\cdot,\cdot;a) \gets \Reg(\MD_a)$. \label{line:hat-f-regression}
        \EndFor
        \For{$1 \leq i \leq m$}
            \State Sample trajectory $(x_1,a_1,\dots,x_h) \sim \frac{1}{2}(\Unif(\Psi_h)+\Unif(\Gamma))$.
            \State Set $x^{(i)}_h := x_h$.
        \EndFor
        \State $\Psi_{h+1} \gets \emptyset$, $\Tclus \gets \emptyset$.
        \For{$1 \leq t \leq n$}
            \State Draw $(x_1,a_1,\dots,x_h,a_h,x_{h+1}) \sim \frac{1}{2}(\Unif(\Psi_h)+\Unif(\Gamma)) \circ_h \Unif(\MA)$ and set $\ol x_{h+1}^{(t)} := x_{h+1}$.
            \State Define $\MR^{(t)}: \MX \to [0,1]$ by 
            \[\MR^{(t)}(x) := \max\left(0, 1-\frac{\max_{(i,a) \in [m]\times\MA} |\wh f_{h+1}(x_h^{(i)},\xbar_{h+1}^{(t)};a) - \wh f_{h+1}(x_h^{(i)}, x; a)|}{\gamma}\right).\] \label{line:rt-def-online}
            \If{$\max_{(i,a) \in [m]\times\MA} |\wh f_{h+1}(x_h^{(i)},\xbar_{h+1}^{(t)};a) - \wh f_{h+1}(x_h^{(i)},\xbar_{h+1}^{(t')};a)| > \gamma'$ for all $t' \in \Tclus$}\label{line:cluster-threshold-online}
                \State $\pihat^{(t)} \gets \PSDPB(h, \Reg', \MR^{(t)}, \Psi_{1:h}, \Gamma, N)$.\Comment{See \cref{alg:psdpb}}\label{line:psdp-call-online}
                \State Update $\Psi_{h+1} \gets \Psi_{h+1} \cup \{\pihat^{(t)}\}$.
                \State Update $\Tclus \gets \Tclus \cup \{t\}$.
            \EndIf
        \EndFor 
        \State \textbf{return} $\Psi_{h+1}$.
	\end{algorithmic}
\end{algorithm}
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
