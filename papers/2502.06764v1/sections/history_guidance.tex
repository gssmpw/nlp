\input{tables/comparison_quantitative}

\section{History Guidance}
\label{sec:our_history_guidance}

Leveraging the flexibility of \method (\mtd), we introduce \emph{History Guidance} (\HG), a family of techniques for history-conditioned video generation. These methods enhance generation quality, improve motion dynamics, enable robustness to out-of-distribution (OOD) histories, and unlock novel capabilities such as compositional video generation. Please refer to \cref{fig:sampling} for an overview.

\textbf{Simplest \HG: Vanilla History Guidance.} The simplest form of \HG, referred to as \emph{Vanilla History Guidance} (\HGv), directly performs classifier-free guidance (CFG) with a chosen history length, following Equation~\ref{eq:history_guidance}. The conditional score for any history $\cH$ can be computed as described in the previous section. To perform CFG, we need to estimate the \emph{unconditional} score $\score p_k(\xGk)$. Notably, the unconditional score is a special case of the conditional score with $\cH \tighteq \varnothing$ and can be estimated by masking history frames $\xH$ with \emph{complete} noise. Even this simple form of \HG significantly improves generation quality and consistency.

\textbf{History Guidance Across Time and Frequency.} While history guidance has been presented as a special case of CFG so far, its full potential extends far beyond CFG.
Consider the following generalization of Equation~\ref{eq:history_guidance}:
\vspace{-5pt}
\begin{equation}
\scalebox{0.85}{$
\score p_k(\xGk) + \sum_i \omega_i \big[\score p_k(\xGk|\bx_{\cH_i}^{k_{\cH_i}}) - \score p_k(\xGk)\big]
$},
\label{eq:history_guidance_across_tf}
\vspace{-5pt}
\end{equation}
where the total score is a weighted sum of conditional scores, each conditioned on possibly \emph{different segments of history} $\{\cH_i\}$, and each masked with a possibly \emph{different noise level} $k_{\cH_i}$. This formulation enables better generalization than a single score function conditioned on a full long history. By composing scores, each individual score component operates on a restricted conditional context, reducing the likelihood of being out-of-distribution~\cite{du2024compositional}. Appendix~\ref{appendix:add_score} provides informal mathematical intuition on why summing conditional scores is permissible.

Equation~\ref{eq:history_guidance_across_tf} effectively allows us to compose the scores conditioned on 1) different history subsequences, and 2) history frames that are partially noisy. We refer to these two principal axes as \emph{time} and \emph{frequency}, which together form a 2D plane of options that we refer to as \emph{History Guidance across Time and Frequency}. For simplicity, we introduce composition along these two axes separately.

\input{figures/ablation/qualitative}
\input{figures/guidance/quantitative_qualitative}

\textbf{Time Axis: Temporal History Guidance.}
Due to the curse of dimensionality, the amount of data that we require to guarantee constant data support grows exponentially with the length of history we wish to condition on. As a result, history conditioned models are particularly prone to out-of-distribution (OOD) history without an inductive bias of sparse dependency. Common symptoms include blowing up or overfitting to irrelevant features. To address this, we propose \emph{Temporal History Guidance} (\HGt), which composes scores conditioned on different subsequences of history by setting $k_{\cH_i} = 0$ in Equation \ref{eq:history_guidance_across_tf}.
This composition can be performed with either: 1) long and short history $\{\cH_{\text{long}}, \cH_{\text{short}}\}$, aiming to trade-off between the two imperfect predictive models, reducing the likelihood of OOD while preserving both long and short-term dependencies, or 2) multiple short, overlapping in-distribution histories $\{\cH_{\text{short}_1}, \cH_{\text{short}_2}, \cdots\}$, to simulate the conditional distribution of the full history.

\input{figures/re10k_ood/quantitative_qualitative.tex}

\textbf{Frequency Axis: Fractional History Guidance.} 
We observe that a major failure mode of \HGv under high guidance scales is the generation of overly static videos with minimal motion. This occurs because \HGv encourages consistency with history, leading to a trivial solution of simply copying the most recent history frame. To address this, we propose \emph{Fractional History Guidance} (\HGf), which guides the sampling process using \emph{fractionally masked history}. Fractionally masking history retains only low-frequency information~(\citet{dieleman2024spectral}, \cref{app:frequency_guidance}), allowing high-frequency details (e.g., fine textures and fast motions) to remain unconstrained by guidance. This approach makes videos more dynamic while maintaining consistency, which is mainly associated with low-frequency details.
Specifically, the \HGf score is given by:
\vspace{-4pt}
\begin{equation} 
\label{eq:fractional_guidance}
\scalebox{0.85}{$
\score p_k(\xGk | \xH) + \omega \big[\score p_k\big(\xGk | \bx_{\cH}^{k_{\cH}}\big) - \score p_k(\xGk)\big]
$},
\vspace{-2pt}
\end{equation}
where $\kH \in (0, 1)$ controls the degree of masking to focus on lower-frequency details, and $\omega$ is the guidance scale for the partially masked history $\bx_{\cH}^{k_{\cH}}$.
In principle, different history frames could contribute information at different frequency bands, such as high-frequency details from recent frames and low-frequency motion from earlier frames. While a detailed exploration of sophisticated sampling strategies is left to future work, our experiments show that even simple implementations of \HGf significantly improve motion dynamics without sacrificing consistency.















