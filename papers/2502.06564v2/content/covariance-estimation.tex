\section{Applications}

\subsection{Robust PCA}

In this subsection we briefly discuss how to derive \cref{cor:pca} from \cref{thm:main}. By Davis-Kahan inequality \cite{davis-kahan}, $\hat{v}$ is either ${O}(\e\log(1/\e)/\gamma)$-close to $v$ or to $-v$. Let us without loss of generality assume that it is close to $v$. Then
\[
\normf{\hat{v}\hat{v}^\top - vv} = \normf{\Paren{\hat{v} - v}\Paren{\hat{v} + v}^\top + \Paren{\hat{v} + v}\Paren{\hat{v} - v}^\top} \le O\Paren{\norm{\hat{v} - v}} \le {O}(\e\log(1/\e)/\gamma)\,.
\]

\subsection{Robust covariance estimation}

In this subsection we show how to estimate the scaling factors assuming the Hanson-Wright property or sub-exponentiality. Further in this section we denote by $\Sigma$ the covariance of $\cD$. First we assume that the mean of $\cD$ in $0$, and then we explain how the case $\mu\neq 0$ can be reduced to it.

By \cref{thm:main}, we can compute $\hat{\Sigma}$ such that
\[
\Normf{\paren{\hat{\Sigma}}^{-1/2}\Paren{\gamma\Sigma}\paren{\hat{\Sigma}}^{-1/2} - \Id} \le O\Paren{\e\log(1/\e)}\,,
\]
where $\gamma > 0$ is unknown. Our goal is to find a good estimator $\hat{\gamma}$ of $\gamma$, and then use $\hat{\Sigma}/\hat{\gamma}$ as an estimator for $\Sigma$.

Let us use fresh samples (as before, we can split the original sample into several parts, and work with a new part for a new estimation), and let us apply the transformation $\hat{\Sigma}^{-1/2}$ to the samples. The covariance of the resulting distribution is $\tilde{\Sigma} = \paren{\hat{\Sigma}}^{-1/2}\Sigma \paren{\hat{\Sigma}}^{-1/2}$, and it satisfies
\[
\normf{\gamma\tilde{\Sigma} - \Id} \le O\Paren{\e\log(1/\e)}\,.
\]

In particular, $\effrank(\tilde{\Sigma})\ge \Omega(d)$. Let us robustly estimate $\Tr(\tilde{\Sigma})$. 
By the Hanson-Wright inequality,
    \[
    \Pr_{x\sim\cD} \Paren{\Abs{\norm{x}^2 - \Tr \tilde{\Sigma}} \ge t} \le 2\exp\Paren{-\frac{1}{C_{HW}} \min\Set{\frac{t^2}{\normf{\tilde{\Sigma}}^2}, \frac{t}{\norm{\tilde{\Sigma}}}}} \le 2\exp\Paren{-\Omega\Paren{ \min\Set{\frac{d \cdot t^2}{\Tr(\tilde{\Sigma})^2}, \frac{\sqrt{d} \cdot t}{\Tr(\tilde{\Sigma})}}}}
    \,,
    \]
    where we used the fact that $\effrank(\tilde{\Sigma})\ge \Omega(d)$. Hence for all even $p\in\N$,
    \[
    \Paren{\E\Abs{\norm{x}^2 - \Tr \tilde{\Sigma}}^p}^{1/p} \le O\Paren{\Tr\paren{\tilde{\Sigma}}\cdot p/\sqrt{d}}\,.
    \]
    Now, applying one-dimensional truncated mean estimation (see, for example, Proposition 1.18 from \cite{DK_book}), we get an estimator $\hat{T}$ such that with high probability
    \[
    \Abs{\hat{T} - \Tr \tilde{\Sigma}} \le O\Paren{\Tr\paren{\tilde{\Sigma}} \cdot \e\log(1/\e) / \sqrt{d}}\,.
    \]

    Hence
    \[
    \Abs{1 - \Tr \paren{\tilde{\Sigma}}/\hat{T}} \le O\Paren{\e\log(1/\e) / \sqrt{d}}\,.
    \]

    Let $\hat{\gamma} = d/\hat{T}$, and $\hat\Sigma' = \hat{\Sigma}/\gamma = \paren{\hat{T}/d}\cdot \hat\Sigma$. 
    Then
    \begin{align*}
\Normf{\paren{\hat{\Sigma}'}^{-1/2}\Paren{\Sigma}\paren{\hat{\Sigma}'}^{-1/2} - \Id} 
&=  \Normf{\hat{\gamma}\tilde{\Sigma} - \Id} 
\\&= \Normf{\frac{\hat{\gamma}}{\gamma} \gamma\tilde{\Sigma} - \Id} 
\\&= \Normf{\Paren{1+O\Paren{\e\log(1/\e) / \sqrt{d}}} \gamma\tilde{\Sigma} - \Id}
\\&\le \normf{\gamma\tilde{\Sigma} - \Id} + O\Paren{\e\log(1/\e) / \sqrt{d}}\Normf{\gamma\tilde{\Sigma}}
\\&\le
 O\Paren{\e\log(1/\e)} + O\Paren{\e^2\log^2(1/\e)/\sqrt{d}}
 + O\Paren{\e\log(1/\e) / \sqrt{d}}\Normf{\Id_d}
 \\&\le
 O\Paren{\e\log(1/\e)}\,.
\end{align*}


Now let us prove the spectral norm bound assuming $O(1)$-sub-exponentiality. As before, we work with a transformed distribution with covariance $\tilde{\Sigma}$ such that for some $\gamma > 0$, $\Normf{\paren{\hat{\Sigma}}^{-1/2}\Paren{\gamma\Sigma}\paren{\hat{\Sigma}}^{-1/2} - \Id} \le O\Paren{\e\log(1/\e)}$.
Since $x = \xi \cdot \tilde{\Sigma}^{1/2} g/\norm{g}$, where $g\sim\cN(0,\Id)$,
for all $u\in \R^d$ and even $p\in \N$,
\[
\Paren{\E\xi^p\iprod{u, g/\norm{g}}^p}^{1/p} \le O\Paren{p\Paren{\E\xi^2\iprod{u, g/\norm{g} }^2 }^{1/2}}\,.
\]

Since $\xi$ and $g$ are independent, 
\[
\Paren{\E\xi^p}^{1/p} \le O\Paren{p\Paren{\E\xi^2}^{1/2} \cdot \frac{\Paren{\E\iprod{u, g/\norm{g}}^2 }^{1/2}}{\Paren{\E\iprod{u, g/\norm{g}}^p}^{1/p}} }\,.
\]
Note that since $g/\norm{g}$ and $g$ are independent, $\E\iprod{u, g}^p = \E\norm{g}^p \cdot \E\iprod{u, g/\norm{g}}^p$. Since $\norm{g}^2$ has chi-squared distribution, its $(p/2)$-th moment is $2^{p/2}\cdot \Gamma(d/2 + p/2) / \Gamma(d/2)$. Hence for all $p\le d$,
\[
\Paren{\E\norm{g}^p}^{1/p} = \Theta\Paren{\sqrt{d}}\,.
\]
Since for all $p$,
\[
\Paren{\E\iprod{u, g}^p}^{1/p} = \Theta(\sqrt{p} \norm{u})\,,
\]
we get for all $p\le d$
\[
\Paren{\E\xi^p}^{1/p} \le O\Paren{\sqrt{p}\Paren{\E\xi^2}^{1/2} }\,.
\]

Now consider 
\[
\E\norm{x}^p = \E\xi^p \cdot \E \norm{\tilde{\Sigma}^{1/2} g/\norm{g}}^p\,.
\]
Since $\norm{\tilde{\Sigma}^{1/2}} = \Theta(1)$, for all $p\le d$ we get 
\[
\Paren{\E\norm{x}^p}^{1/p} \le O\Paren{\sqrt{p}\Paren{\E\xi^2}^{1/2}}\le 
O\Paren{\sqrt{p}\E \norm{x}^2}^{1/2}
\,.
\]

Applying one-dimensional truncated mean estimation with $p = O(\log(1/\e))$, we get an estimator $\hat{T}$ such that with high probability
    \[
    \Abs{\hat{T} - \Tr \tilde{\Sigma}} \le O\Paren{\Tr\paren{\tilde{\Sigma}} \cdot \e\log(1/\e)}\,.
    \]
The rest of the proof is exactly the same as for the Hanson-Wright distributions (with relative spectral norm instead of relative Frobenius norm).

Now let us explain how to deal with the case when the mean of $\cD$ is nonzero. As for covariance estimation, we can use symmetrization $y = \paren{x-x'}/\sqrt{2}$. Denote $z = x - \mu$ and $z' = x' - \mu'$. We need to show the Hanson-Wright inequality for all positive definite matrices $A$ with $\effrank(A) \ge \Omega(d)$. Since the inequality is scale invariant, let us assume $\Tr(A) = d$. Then 
\[
y^\top Ay- \Tr(A) = \frac{1}{2}\Paren{z^\top A z - \Tr(A)} + \frac{1}{2}\Paren{(z')^\top Az' - \Tr(A)} + \frac{1}{2}z^\top A z' + \frac{1}{2}(z')^\top A z\,.
\]
The first two terms are bounded by $O\Paren{\sqrt{d\log(1/\delta)} + \log(1/\delta)}$ with probability $1-\delta$ (by the Hanson-Wright inequality). Let us bound the third term. Let us condition on $z'$ and treat it as a constant. By the Hanson-Wright inequality, with probability $1-\delta$,
\[
\Paren{z^\top A z'}^2 \le O\Paren{\sqrt{\norm{Az'}^2\log(1/\delta)} + \norm{Az'}^2\log(1/\delta)}\,.
\]

By the Hanson-Wright inequality for $z'$, $\norm{Az'}^2 \le O(\norm{z'}^2) \le  d + O\Paren{\sqrt{d\log(1/\delta)} + \log(1/\delta)}$ with probability $1-\delta$. Note that we only need to apply the Hanson-Wright inequality for $\delta$ such that $\log(1/\delta) \le O(\log(1/\e)) \le O(\log d)$. For such $\delta$, 
\[
z^\top A z' \le O\Paren{\sqrt{d\log(1/\delta)}}.
\]
The term $(z')^\top A z$ is also bounded by this value. Since this bound is enough to obtain the bound on the $O(\log(1/\e)$-th moment that we use, we get the desired result.

Let us now consider the sub-exponential case. Note that
\[
O\Paren{\E \iprod{z, u}^p}^{1/p} \le O\Paren{\Paren{\E \iprod{x - \mu, u}^p}^{1/p} + \Paren{\E \iprod{x' - \mu, u}^p}^{1/p}} \le 
O\Paren{\Paren{\E \iprod{x - \mu, u}^2}^{1/2}}\,.
\]
Note that $\iprod{z, u}^2 = \tfrac{1}{2}\iprod{x - \mu, u}^2 + \tfrac{1}{2}\iprod{x' - \mu, u}^2 - \iprod{x - \mu, x'-\mu}$, so $\E \iprod{z, u}^2 = \E  \iprod{x - \mu, u}^2$, and we get the desired bound.

%Finally, the standard stability-based filtering algorithm for robust mean estimation works for sub-exponential distributions if its covariance satisfies $\Norm{\Sigma - \Id}\le O(\e \log(1/\e))$ (see section 2.2.1 of \cite{DK_book}), and the mean estimator satisfies $\norm{\mu-\hat{\mu}} \le O(\e\sqrt{\log(1/\e)})$ with high probability.
