\begin{algorithm}
\caption{Slicing Intent}
\label{algo:compute_nll}
\begin{algorithmic}[1]
\Function{NLL}{$\pi_\theta$, $X$, $Y$}

  \State $logits \gets \pi_\theta(X)$ \label{algocn:2}\algorithmiccomment{Obtain last layer output}
  \State $logits \gets logits[:,-1,:]$ \label{algocn:3}\algorithmiccomment{Omit last token}
  \State $P \gets \sigma(logits)$ \label{algocn:4}\algorithmiccomment{Perform softmax operation}
 \State $mask \gets Y\neq \pi_{\theta}.padding\_id$ \label{algocn:1} 

  \State $n_1 \gets -Y \times \log(P) $ \label{algocn:5}\algorithmiccomment{NLL for tokens}
  
  \State $n_2 \gets \sum^{T}_{t}n_1(t) \times mask$ \label{algocn:6}\algorithmiccomment{NLL for sequence}
  \State $nll \gets \frac{n_2}{\sum^{T}_{t}mask(t)}$ \label{algocn:7}\algorithmiccomment{Mean NLL}

  \State \textbf{return} $nll$ \label{algocn:8}\algorithmiccomment{Return NLL}
\EndFunction
% \end{algorithmic}


% \begin{algorithmic}[1]
\Function{Sensitivity}{$\pi_\theta$, $X$, $Y$}
  \State $S \gets \{\}$ \label{algocs:2}
    \State $L \gets \text{NLL}(\pi_\theta, X, Y)$\label{algocs:3}\algorithmiccomment{Get Negative Log Likelihood}
    \For {every $block \in \pi_\theta$}\label{algocs:4}
        \State $S\{block\} \gets \sqrt{\sum_{i}^{\vartheta \in \theta_{block}} \left(\frac{\partial \mathcal{L}}{\partial w_i}\right)^2}$\label{algocs:5}\algorithmiccomment{L2-norm}

    \EndFor
  \State \textbf{return} $S$\label{algocs:6}
\EndFunction
% \end{algorithmic}

% \begin{algorithmic}[1]
\Function{Slice}{$\pi_\theta$,  $X$, $Y$}
  \State $S \gets \text{Sensitivity}(\pi_\theta, X, Y)$\label{algoid:1}\algorithmiccomment{Measure sensitivity}
  \State $B \gets \operatorname*{arg\,max}_{block \in \pi_\theta} S\{block\}$ \label{algoid:2}\algorithmiccomment{Get most error-prone block}
\State $\theta_\text{slice} \gets \{\vartheta | \vartheta \in \theta_B \land \theta_B \in \theta\}$ \label{algoid:3}\algorithmiccomment{Get slice}
  \State  \textbf{return} $\theta_\text{slice}$\label{algoid:4}
\EndFunction
\end{algorithmic}
\end{algorithm}
