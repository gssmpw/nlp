\usepackage{moreverb,url}
\usepackage{xspace}
\usepackage{xcolor}

% Math
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsbsy}
\usepackage{bbm}
\usepackage{dsfont}

% Figs & tables
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{booktabs} % for professional tables

\usepackage{subfiles}
\usepackage{csquotes}

%\usepackage{cite} % Compacts [1]--[4] citations and adds spaces

\usepackage{array}

% These three are needed for fancy figure above abstract.
\usepackage{graphicx}
\usepackage{subfig} 
\usepackage{multirow}
\pdfminorversion=4 

% discourage line breaks inside inline math:
% https://pbelmans.ncag.info/blog/2010/12/18/my-good-practice-concerning-inline-mathematical-formulas
\relpenalty=10000
\binoppenalty=10000

\newcommand\BibTeX{{\rmfamily B\kern-.05em \textsc{i\kern-.025em b}\kern-.08em
T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

% Colors 
\definecolor{wine}{RGB}{204, 0, 102}
\definecolor{magenta_wine}{RGB}{158, 44, 143}
\definecolor{dusty_wine}{RGB}{143, 59, 101}
\definecolor{ocean}{RGB}{13, 121, 202}
\definecolor{light_ocean}{RGB}{18, 178, 235}
\definecolor{dark_ocean}{RGB}{10, 89, 148}
\definecolor{grey}{RGB}{170, 170, 170}
\definecolor{light-grey}{RGB}{220, 220, 220}
\definecolor{dark_gray}{rgb}{0.2, 0.2, 0.2} 
\definecolor{med-grey}{rgb}{0.3, 0.3, 0.3} 
\definecolor{grape}{RGB}{112,48,160}
\definecolor{aqua}{RGB}{52,172,139}
\definecolor{dark_aqua}{RGB}{35,115,93}
\definecolor{dark_orange}{RGB}{216,92,0}
\definecolor{vibrant_orange}{RGB}{250, 160, 26}
\definecolor{vibrant_blue}{RGB}{14, 120, 255}
\definecolor{vibrant_pink}{RGB}{255, 0, 104}
\definecolor{dark_red}{RGB}{122, 0, 0}
\definecolor{dark_green}{RGB}{0, 92, 34}
\definecolor{dusty_blue}{RGB}{77, 91, 128}
\definecolor{dark_brown}{RGB}{125, 54, 36}

% for theorems
\theoremstyle{subtle} % rqstyle, subtle, plain, definition, remark
\newtheorem{RQ}{RQ}
\newtheorem{definition}{Definition}
\newtheorem{theorem}{Theorem}

% For pretty paragraphs
\newcommand{\para}[1]{\medskip\noindent\textbf{#1. }} 
\newcommand{\paras}[1]{\smallskip\noindent\textbf{#1. }} 
\newcommand{\paranopunc}[1]{\medskip\noindent\textbf{#1 }} % pretty paragraphs with no punctuation at end

% For numbered Q's
\newcounter{qnum}
\setcounter{qnum}{1} 
\newcommand{\ques}[1]{\medskip \noindent \textbf{Q\theqnum:} \textit{#1} \smallskip \stepcounter{qnum}}

% For in-line TODOs 
\newcommand{\todo}[1]{\normalsize{\color{red}(TODO:\ #1)}} % todo
% \newcommand{\ques}[1]{\normalsize{\color{blue}(Q:\ #1)}} % question

% For in-line comments 
\newcommand{\abnote}[1]{\normalsize{\color{red}(AB:\ #1)}}
\newcommand{\knnote}[1]{\normalsize{\color{blue}(KN:\ #1)}}
\newcommand{\lpnote}[1]{\normalsize{\color{cyan}(LP:\ #1)}}
\newcommand{\draft}[1]{\normalsize{\color{magenta}#1}}

% Methods
\newcommand{\ours}{\textcolor{vibrant_orange}{\textbf{LatentSafe}}\xspace}
\newcommand{\privsafe}{\textcolor{dark_brown}{\textbf{PrivilegedSafe}}\xspace}  % dark_ocean
\newcommand{\recoveryrl}{\textcolor{dark_ocean}{\textbf{RecoveryRL}}\xspace} %light_ocean
\newcommand{\cmdp}{\textcolor{ocean}{\textbf{SQRL}}\xspace} %light_ocean
\newcommand{\dreamer}{\textcolor{dark_aqua}{\textbf{Dreamer}}\xspace} % dark_ocean
\newcommand{\diffpolicy}{\textcolor{magenta_wine}{\textbf{DiffusionPolicy}}\xspace}

% \newcommand{\diffpolicyshield}{\textcolor{wine}{\textbf{DiffusionPolicy^{\shield}}}\xspace}

% Math operators
\DeclareMathOperator{\E}{\mathbb{E}}
\DeclareMathOperator*{\argmax}{argmax}
\DeclareMathOperator*{\argmin}{argmin}

% Reference macros
\newcommand{\figref}{Fig.~\ref}
\newcommand{\secref}{Sec.~\ref}
\newcommand{\tabref}{Tab.~\ref}

% environment definition
\newcommand{\env}{\mathbf{E}}
\newcommand{\envSpace}{\mathbb{E}}

% Privileged State
\newcommand{\state}{s}
\newcommand{\stateSpace}{\mathcal{S}}
\newcommand{\dyns}{f}

% Latent State & Dynamics
\newcommand{\latent}{z}
\newcommand{\latentSpace}{\mathcal{Z}}
\newcommand{\dynz}{f_{\latent}}

% NN Params
\newcommand{\encparam}{\psi}
\newcommand{\ellparam}{\mu}
\newcommand{\dynparam}{\phi}

% High-dim observations
\newcommand{\obs}{o}
\newcommand{\obsSpace}{\mathcal{O}}
\newcommand{\enc}{\mathcal{E}}
\newcommand{\img}{\mathcal{I}}

% State & Action Spaces
\newcommand{\action}{a}
\newcommand{\actionSpace}{\mathcal{A}}

% Policy
\newcommand{\policy}{\pi}
\newcommand{\policyLatent}{\policy_{\textrm{latent}}}
\newcommand{\policyPriv}{\policy_{\textrm{priv}}}
\newcommand{\policyDemo}{\pi_{\text{demo}}}
\newcommand{\policyTask}{\pi^{\text{task}}}

% Pretty Shield Icons
\usepackage{fontawesome5}
\newcommand{\shield}{\text{\tiny{\faShield*}}}
\newcommand{\shieldVirus}{\text{\tiny{\faShieldVirus}}}
\newcommand{\task}{{\text{\tiny{\faCheckSquare[regular]}}}}
\newcommand{\adv}{\dag}

% Reachability -- Failure Spec
\newcommand{\failure}{\mathcal{F}}
\newcommand{\failureLatent}{\failure_\textrm{latent}}
\newcommand{\marginfunc}{\ell}

% Reachability -- BRT
\newcommand{\valfunc}{V}
\newcommand{\valfuncGt}{\valfunc_\textrm{gt}}
\newcommand{\valfuncLatent}{\valfunc_{\textrm{latent}}}
\newcommand{\valfuncPriv}{\valfunc_{\textrm{priv}}}
\newcommand{\brtS}{\stateSpace^\mathrm{unsafe}}
\newcommand{\brtZ}{\latentSpace^\mathrm{unsafe}}
\newcommand{\safeSetS}{\stateSpace^\shield} % priviledged safe set
\newcommand{\safeSetZ}{\latentSpace^\shield} % latent safe set
\newcommand{\unsafeSet}{\mathcal{U}} % priviledged safe set


% Reachability -- Safety Filter
\newcommand{\monitor}{{\valfunc^{\shield}}} % monitor (i.e., V)
\newcommand{\fallback}{\policy^{\shield}} 

% fallback policy
\newcommand{\fallbackGt}{\policy_\textrm{gt}^{\shield}} % fallback policy
\newcommand{\fallbackLatent}{\policy^{\shield}_{\textrm{latent}}} % fallback policy

\newcommand{\riskLatent}{\policy^{\textrm{risk}}_{\textrm{latent}}} 
\newcommand{\valfuncRisk}{\valfunc^{\mathrm{risk}}}

\newcommand{\fallbackPriv}{\policy^{\shield}_{\textrm{priv}}} % fallback policy
\newcommand{\filter}{{\phi}} % filtering mechanism 

\newcommand{\unsafeSetLatent}{\mathcal{U}_{\textrm{latent}}} % priviledged safe set



