\begin{figure*}[t]
\vspace{-2mm}
  \centering
  \includegraphics[width=\textwidth]{figure/overview.pdf}
  \vspace{-8mm}
  \caption{Framework of Igformer.}
  \label{fig:fig3-framework}
  \vspace{-4mm}
\end{figure*}


\section{Results}
\label{sec:experiment}
\subsection{IgFormer}
Figure~\ref{fig:fig3-framework} illustrates the overall framework of Igformer. Specifically, the {\em Equivariant Message Passing (EMP)} modules serve as foundational blocks of Igformer, integrating both spatial and biochemical properties during the message-passing process. Our theoretical analysis confirms the E(3)-equivariant property of EMP, which lays the theoretical foundation of Igformer.

The key innovation of Igformer lies in its sophisticated inter-graph refinement strategy. The process begins with the initialization of residue representations and coordinates, followed by intra-graph construction. Subsequently, based on the constructed intra-graph, Igformer captures the complex interactions within the binding range between antibody paratope and antigen epitope through two key modules: {\em Approximate Personalized Propagation (APP)}, which preserves local interaction information, and {\em Simplified Graph Transformer (SGFormer)}, which captures global binding dependencies. Next, the learned intricate binding patterns are utilized to refine the inter-graph, followed by {\em Triangle Multiplicative (TM)} module and {\em Axial Attention (AA)} module, which generate pairwise residue interactions through different mechanisms. Finally, the refined inter-graph, together with the intra-graph are processed through a {\em dual-scale EMP modules}, responsible for the final coordinate and sequence predictions. Systematical elaboration on our method and supplementary details can be found in Appendix~\ref{sec:framework} and appendix~\ref{appendix-sec:sup}. 




{\bf Dataset.}
Following previous works on antibody design~\cite{jin2022hern,kong2023dymean,kong2023mean}, we train all models on the \textit{Structural Antibody Database} (SAbDab)~\citep{dunbar2013sabdab,schneider2021sabdab} using the snapshot from November 2022. We split the dataset into training and validation sets with a ratio of 9:1, yielding $3,246$ antibodies for training and $365$ antibodies for validation.
The antibodies are clustered based on their CDR-H3 regions using a $40\%$ sequence identity threshold, calculated using the BLOSUM62 substitution matrix \cite{foote1992antibody}. This clustering process, performed using MMseqs2, results in $1,644$ clusters in the training set and $182$ clusters in the validation set.
After that, we evaluate Igformer and other competitors on the RAbD benchmark \cite{adolf2018rabd} for Tasks 1-3, which consists of 60 diverse antibody-antigen complexes. For Task 4, Igfold benchmark \cite{ruffolo2023IgFold} consisting of $51$ antibody-antigen complexes is utilized. This test set selection prevents data leakage during the evaluation phase.
Detailed introduction to datasets and training settings of IgFormer are listed in Appendix~\ref{appendix-sec:dataset} and Appendix~\ref{appendix-sec:exp-setting}, respectively. 





\input{table/table1-task1}
\input{table/table2-task2}


\begin{figure}[t]
\centering
\vspace{-2mm}
  \begin{small}
    \begin{tabular}{cc}
        \includegraphics[width=0.32\linewidth]{figure/case-main-igformer.pdf} &
        \hspace{-3mm}
        \includegraphics[width=0.32\linewidth]{figure/case-main-dymean.pdf} \\
        (a) Igformer &
        \hspace{-2mm}
        (b) dyMEAN \\
    \end{tabular}
    \vspace{-2mm}
    \caption{Antibody structures by Igformer \& dyMEAN.}
    \label{fig:fig4-task1-case}
    \vspace{-4mm}
  \end{small}
\end{figure}


\subsection{Task 1: CDR-H3 Design}
We first evaluate each model for both sequence and structure prediction on CDR-H3, which plays a critical role in antigen binding. During training, the model simultaneously predicts CDR-H3 residue sequences and generates coordinates for the entire antibody structure. 
We compare Igformer against five SOTA methods: RosettaAb \cite{adolf2018rabd}, DiffAb \cite{luo2022diffab}, HERN \cite{jin2022hern}, MEAN \cite{kong2023mean}, and dyMEAN \cite{kong2023dymean}. Evaluation metrics include unaligned RMSD for CDR-H3 using CA atoms and sequence-based metrics for CDR-H3. Details of baselines and metrics can be found in Appendix~\ref{appendix-sec:baselines} and Appendix~\ref{appendix-sec:metrics}, respectively. 


Table \ref{tab:task1-main} reports the results of the epitope-binding CDR-H3 design task on the RAbD dataset. As we can observe, Igformer demonstrates superior performance across all evaluation metrics. Specifically, it achieves an AAR of 43.50\%, representing a 2.2\% relative improvement over previous SOTA method dyMEAN, and substantially outperforms earlier approaches like RosettaAb and HERN. Most notably, Igformer excels in docking performance, achieving an RMSD of 7.15 and a DockQ score of 0.450, marking a relative improvement of 15.08\% and 10.29\% respectively over the second-best method. Figure~\ref{fig:fig4-task1-case} provides a comparative visualization of predictions generated by Igformer and dyMEAN. These results demonstrate the enhanced capability of Igformer to capture antibody-antigen interactions and generate more accurate binding interface predictions.



\subsection{Task 2: Multiple CDR Design}
In this set of experiments, we compare Igformer against dyMEAN, the current leading method, on sequence and structure prediction across all six CDRs using the RAbD dataset. The evaluation examines structural accuracy through AAR for individual CDR regions and assesses overall antibody structure quality using additional metrics.
As shown in Tables \ref{tab:task2-main1}-\ref{tab:task2-main2-task3}, Igformer achieves better sequence recovery results in 5 out of 6 CDRs except for CDR-L1, where Igformer maintains comparable performance with dyMEAN. Moreover, Igformer consistently surpasses dyMEAN in overall performance by substantial margins. Notably, Igformer achieves relative improvements of 5.83\% in overall AAR and 21.24\% in DockQ score. These comprehensive results validate the effectiveness of Igformer in both sequence prediction and structural generation across multiple CDR regions.




\subsection{Task 3: Full Antibody Design}
\input{table/table3-task2-3}
In this set of experiments, we evaluate predictions across all regions, including both frameworks and CDRs on RAbD dataset, where the sequences and coordinates for the entire antibody are masked in the testing phase. Table \ref{tab:task2-main2-task3} presents the performance comparison for full antibody design. 
These results align with the fundamental characteristic of antibody structure: framework regions exhibit higher conservation across different antibodies, making them more predictable than hyper-variable CDR regions. Our experimental findings confirm this biological characteristic, as both models achieve higher sequence recovery rates in full antibody design compared to CDR-specific prediction tasks.
Notably, Igformer demonstrates consistent superiority over dyMEAN across all evaluation metrics. Igformer achieves a 3.25\% relative improvement in AAR and an 8.57\% relative enhancement in DockQ score. These significant improvements indicate that Igformer not only generates more accurate sequence predictions but also maintains higher structural fidelity, leading to improved antigen binding affinity prediction.


\subsection{Task 4: Complex Structure Prediction}
In this set of experiments, we evaluate the model performance on the Igfold benchmark \cite{ruffolo2023IgFold}, focusing on complex structure prediction when given complete antibody sequences, including CDR-H3. Evaluation metrics include CDR-H3-specific RMSD and comprehensive structural assessments of the entire antibody complex. 

As demonstrated in Table \ref{tab:task4-main}, Igformer establishes new state-of-the-art performance in the complex structure prediction task, particularly excelling in docking metrics. Specifically, Igformer achieves relative improvements of 12.44\% in RMSD and 15.49\% in DockQ scores, respectively. Notably, even when compared to GT$\Rightarrow$HERN, which utilizes ground-truth structures for docking, Igformer demonstrates superior docking performance. These results validate the effectiveness of the proposed inter-graph refinement strategy in capturing the intricate residue interactions within antibody-antigen binding interfaces.


\input{table/table4-task4}
\input{table/table5-ablation}

\subsection{Ablation Study}
We conduct comprehensive ablation studies to evaluate the individual contributions of key components in Igformer. Specifically, we systematically analyze APP and SGFormer introduced in Section~\ref{sec:subsec-inter-graph}, triangle multiplicative module (TM), axial attention (AA), and dual EMP module presented in Section~\ref{sec:subsec-update}. Table~\ref{tab:ablation-main} illustrates the impact of removing each component from Igformer on epitope-binding CDR-H3 prediction tasks. Results of experiments on Task 4 are provided in Appendix~\ref{appendix-sec:subsec-ablation}.


Our observations are as follows. Removing the APP reduces performance across all metrics, particularly affecting the DockQ score (0.416) and RMSD (8.30). The removal of SGFormer shows similar trends but with less impact, achieving a DockQ score of 0.431 and RMSD of 7.82. These results demonstrate their crucial role in capturing complicated interface interactions. 
The triangle multiplicative module and axial attention mechanism both contribute significantly to model performance. Without TM, the AAR drops to 43.32\% and DockQ to 0.417, while removing AA results in an AAR of 43.06\% and DockQ of 0.425. Most notably, replacing our dual EMP architecture with a single message passing framework results in significant performance degradation across all metrics, with AAR dropping to 42.79\% and DockQ to 0.417, validating our design choice of separate intra- and inter-graph message passing processes.

