\section{Supplementary}
\label{appendix-sec:sup}
\subsection{Graph Construction}
\label{appendix-sec:graph-construct}
{\bf Intra-Graph Construction. } The intra-graph construction process integrates both sequence and structural information from the antibody-antigen complex. We begin by extracting information from the antigen epitope $G_{ae}$ and antibody $G_{ab}$, where each residue $i$ serves as a graph node $v_i$. Each node encapsulates both its amino acid type and 3D coordinate information, providing a comprehensive representation of its chemical and spatial properties.
We formalize the intra-graph as $G_{\textit{Intra}} = (V_{\textit{Intra}}, E_{\textit{Intra}})$, where $V_{\textit{Intra}} = V_{ae} \cup V_{ab}$ represents the union of antigen epitope residues $V_{ae}$ and antibody residues $V_{ab}$. Edge construction follows a distance-based approach, connecting residues within their respective chains (either epitope or antibody). For each residue $v_i$, we establish connections to its $k$-nearest neighbors $v_j$ within the same chain based on Euclidean distances between their spatial coordinates. The shortest distance between two residues is defined as the minimum distance between any pair of atoms across two residues.
This construction ensures that the intra-graph captures meaningful spatial relationships within both the antigen epitope and antibody domains while maintaining their distinct molecular contexts.


{\bf Inter-Graph Construction}
The inter-graph construction process integrates both sequence and structural information from the antibody-antigen binding region.
We construct an inter-graph $G_{\textit{Inter}} = (V_{p}, V_{ae}, E_{\textit{Inter}})$ to model critical paratope-epitope interactions between antibody paratope residues $V_p$ and antigen epitope residues $V_{ae}$.
Edge construction in the inter-graph is based on embedding similarity between residue pairs. For paratope residues $v_i \in V_p$ and $v_j \in V_{ae}$ with embeddings $\vect{H}_i$ and $\vect{H}_j$, we compute bidirectional interaction features:
\begin{equation*}
    \vect{z}_{\textit{in}} = \vect{H}_i \oplus \vect{H}_j, \quad \vect{z}_{\textit{out}} = \vect{H}_j \oplus \vect{H}_i.
\end{equation*}
These concatenated embeddings are processed through a feed-forward neural network (FFN) to generate interaction scores:
\begin{equation}
    \textit{FFN}(\vect{z}) = \sigma(\vect{W}_2 \cdot \sigma(\vect{W}_1 \cdot \vect{z} + \vect{b}_1) + \vect{b}_2),
\end{equation}
where $ \vect{W}_1 \in \mathbb{R}^{d \times 2d}$, $ \vect{W}_2 \in \mathbb{R}^{d \times d}$, and $ \vect{b}_1, \vect{b}_2 \in \mathbb{R}^d$ are learnable parameters, $ \sigma$ is the activation function. The final pair-wise distance of $(v_i,v_j)$ combines interactions from both directions:
\begin{equation*}
    dist_{ij} = \textit{FFN}(\vect{z}_{\textit{in}}) + \textit{FFN}(\vect{z}_{\textit{out}}).
\end{equation*}
The edge set $E_{\textit{inter}}$ is then constructed by selecting $k$-nearest residues of each $v_i \in V_p$ based on these interaction scores.
This construction focuses exclusively on paratope-epitope interactions, providing a refined inter-graph structure of the binding interface that captures the essential dynamics of antibody-antigen docking.



\subsection{Residue Embedding}
\label{appendix-sec:embeds}

Our embedding framework captures comprehensive residue characteristics through two complementary components: residue-type and positional embeddings.
First, we encode residue-type information through $\vect{H}_i^{\textit{res}} \in \mathbb{R}^d$, which represents the biochemical properties of amino acid residue $v_i$.
This embedding resides in a matrix of dimensions $N_{\textit{res}} \times d$, where $N_{\textit{res}} = 20$ represents the number of different amino acid types.

To preserve structural context, we implement position-specific embeddings 
$\vect{H}_i^{\textit{pos}} \in \mathbb{R}^{d}$ that encode the sequential context of residues. This positional encoding maintains distinct indices for antigen, heavy chain, and light chain segments, enabling the model to differentiate between different components.
The position embedding matrix has dimensions $N_{\textit{seq}} \times d_{\textit{pos}}$, where $N_{\textit{seq}} = 192$ is the maximum length of the sequence, ensuring consistent positional representation across all residue types while maintaining chain-specific contexts.

Importantly, different segments of the sequence, such as the antigen, heavy chain, and light chain, utilize distinct position indices to allow the model to differentiate between these regions.

The final residue representation integrates both biochemical and positional information through a simple addition:
\begin{equation}
    \vect{H}_i = \vect{H}_i^{\textit{res}} + \vect{H}_i^{\textit{pos}}.
\end{equation}


\subsection{Template-based Coordinates}
\label{appendix-sec:coord}

\subsubsection{Template Generation}
\label{appendix-sec:subsec-template-coord}
The template generation process exploits a fundamental characteristic of antibody structures: the high conservation within framework regions (FRs). 
We define a residue as well-conserved when its amino acid type is maintained across at least 95\% of antibodies in the dataset - a threshold optimized through empirical analysis to balance the number of conserved residues against their structural variability \cite{kong2023dymean}. Using this criterion, we identify 16 and 18 well-conserved residues in the heavy and light chains, respectively. To construct template coordinates $\vect{X}^{\textit{temp}}$, we compute mean backbone atom coordinates (N, CA, C, O) in the main chains across all antibodies in the dataset, establishing an initial backbone template $\{\vect{X}_r \in \mathbb{R}^{3 \times 4} | r \in \mathcal{W}_{\textit{temp}} \}$, where $\mathcal{W}_{\textit{temp}}$ denotes the positions of well-conserved residues as detailed in Table \ref{tab:template_positions}.
\input{table/table6-template}



\subsubsection{Coordinate Initialization}
\label{appendix-sec:subsec-coord-init}
Our coordinate initialization strategy employs a template-based approach that preserves actual coordinates for the epitope region $V_e$ while utilizing template-derived coordinates for paratope regions requiring prediction.

Each residue is represented using 14 atoms in 3D space, with coordinates denoted as $\vect{X}_{\textit{ae}} = \{ \vect{X}_i \in \mathbb{R}^3 \mid v_i \in V_{ae} \}$ for known positions and $\vect{X}^{\textit{temp}} = \{ \vect{X}_r \in \mathbb{R}^3 \mid j \in \mathcal{W}_{\textit{temp}} \}$ for template-derived positions (refer to Appendix~\ref{appendix-sec:subsec-template-coord}).

For residues with missing coordinates in the template, linear interpolation is employed. The missing coordinate $\vect{X}_k$ for position $k$ is calculated as follows:
\begin{equation*}
    \vect{X}_k = \vect{X}_{\textit{left}} + \frac{k - \textit{left}}{\textit{right} - \textit{left}} (\vect{X}_{\textit{right}} - \vect{X}_{\textit{left}}),
\end{equation*}
where $\textit{left}$ and $\textit{right}$ denote indices of nearest known template coordinates. The intersection of these indices is denoted as $\mathcal{W}_{\textit{align}} = \mathcal{W}_{\textit{true}} \cap \mathcal{W}_{\textit{temp}}$.

To ensure interpolation remains within valid sequence boundaries, $\textit{left}$ and $\textit{right}$ are constrained as follows:  $0 \leq \textit{left} < k < \textit{right} \leq N_{\textit{seq}},$
where $ N_{\textit{seq}} $ is the total length of the original antibody sequence.   
This ensures that interpolation remains within the structural constraints of the antibody sequence while preserving the geometric continuity of the coordinates.  

To ensure structural coherence, we align template coordinates with true coordinates by optimizing a rigid-body transformation for shared indices $\mathcal{W}_{\textit{align}}$. The optimal transformation, comprising rotation matrix $\vect{Q} \in \mathbb{R}^{3 \times 3}$ and translation vector $\vect{t} \in \mathbb{R}^3$, is determined by solving the following optimization problem:
\begin{equation}
    \arg \min_{\vect{Q}, \vect{t}} \sum_{i \in \mathcal{W}_{\textit{Align}}, j \in \mathcal{W}_{\textit{temp}}} \left| \vect{X}_i - (\vect{Q} \vect{X}_j + \vect{t}) \right|^2,
\end{equation}
subject to $\vect{Q}^\top \vect{Q} = \vect{I}$. After interpolation, we obtain the complete antibody coordinates as  
\begin{equation}
    \vect{X}_{ab}^{'} = \vect{X}^{\textit{temp}} \cup \vect{X}^{\textit{interp}},
\end{equation}
where $\vect{X}^{\textit{interp}}$ represents the set of interpolated coordinates for positions that are within the sequence range but absent from the template. Formally,  
\begin{equation}
    \vect{X}^{\textit{interp}} = \{ \vect{X}_k \mid k = \{0, \cdots, N_{\textit{seq}}-1 \} \text{ and } k \notin \mathcal{W}_{\textit{temp}} \}.
\end{equation}
This ensures that interpolation is applied only to residues that are part of the original antibody sequence but do not have known coordinates in the template. The resulting transformation for alignment is then applied globally:
\begin{equation}
    \vect{X}_{ab}  = \vect{Q} \vect{X}_{ab}^{'} + \vect{t}, 
\end{equation}
This initialization procedure primarily focuses on backbone atoms (N, CA, C, O), with side-chain atoms initially positioned at their respective CA coordinates, establishing a foundation for subsequent refinement.


\subsubsection{Coordinate Processing}
\label{appendix-sec:subsec-coord-process}

Following initial coordinate assignment, we implement a comprehensive normalization procedure to ensure consistent scale and reference frame across the antibody-antigen complex $\vect{X}$. For a system with $N$ total atoms, we first define an indicator function $\mathbb{I}(i)$ that distinguishes between antigen and antibody atoms:
\begin{equation} 
\label{eq:coord-indicator}
    \mathbb{I}(i) = 
    \begin{cases}
        1 & \textit{if }v_i \in V_\textit{ae} \\
        0 & \textit{if }v_i \in V_\textit{ab}
    \end{cases}.
\end{equation} 
Using this indicator function, we compute chain-specific centers of mass:
\begin{equation} 
\label{eq:coord-center}
    \vect{X}_c = \frac{\sum_{i=1}^N \vect{X}_i \cdot \mathbb{I}(i)}{\sum_{i=1}^N \mathbb{I}(i)}.
\end{equation}
The coordinates are then centered relative to their respective chain centers $\vect{X}_i^{'} = \vect{X}_i -  \vect{X}_c$.
Finally, we apply dimension-specific normalization to ensure consistent scale:
\begin{equation*}
    \vect{X}_i = \frac{\vect{X}_i^{'} - \mu_d}{\sigma_d},
\end{equation*}
where $\mu_d$ and $\sigma_d$ represent the mean and standard deviation along dimension $d$ across all atoms, with a target standard deviation of $\sigma=10$. This processing pipeline ensures that all atomic coordinates are properly scaled and centered within their respective molecular contexts, facilitating subsequent structural prediction tasks. Finally, we update the global coordinates again based on Equations \ref{eq:coord-indicator} and \ref{eq:coord-center}.


\subsubsection{Paratope Coordinates Generation}
\label{appendix-sec:subsec-coord-generate}
Our paratope coordinate generation framework implements a structured approach to initialize and refine binding interface positions. The process begins by anchoring initial paratope coordinates to the epitope center $\vect{X}_0 = \vect{X}_c$
where $\vect{X}_0$ represents the initial paratope coordinates and $\vect{X}_c$ represents the coordinates of the epitope center calculated by Equation \ref{eq:coord-center}, which are assigned as initial positions for all atoms in the paratope region.
We then introduce controlled structural variations:
\begin{equation*}
    \vect{\epsilon}_{i} = 
    \begin{cases} \vect{\epsilon}_{ca} & \textit{for CA atoms} \\
    0.1\vect{\epsilon}_{o} + \vect{\epsilon}_{ca} & \textit{for other atoms}
\end{cases},
\end{equation*}
where 
$\vect{\epsilon}_{o}, \vect{\epsilon}_{ca} \sim  \mathcal{N}(0, 1)$. This differential noise incorporation ensures that CA atoms exhibit greater conformational flexibility while maintaining structural coherence for other atoms through correlated, smaller perturbations. 
The final paratope coordinates are computed as:
\begin{equation*}
    \vect{X}_{\textit{p}} = \vect{X}_0 + \vect{\epsilon}_{i}.
\end{equation*}

Our model maintains two distinct coordinate representations:  
\begin{equation}
    \vect{X}_{\textit{full}} = \vect{X}_{\textit{ae}} \cup \vect{X}_{\textit{ab}},
\end{equation}
where $\vect{X}_{\textit{full}}$ represents the complete antibody-antigen complex, with  
$\vect{X}_{\textit{ae}}$ denoting the epitope coordinates and $\vect{X}_{\textit{ab}}$ representing the full antibody structure, including framework and paratope regions.  

Similarly, we define the focused binding interface representation as:  
\begin{equation}
    \vect{X}_{\textit{inter}} = \vect{X}_{\textit{ae}} \cup \vect{X}_{\textit{p}},
\end{equation}
where $\vect{X}_{\textit{inter}}$ includes the epitope coordinates $\vect{X}_{\textit{ae}}$ and the generated paratope coordinates $\vect{X}_{\textit{p}}$, without the full antibody framework.  

This distinction ensures that the model can separately handle global structural representations $\vect{X}_{\textit{full}}$ and the more localized binding interactions $\vect{X}_{\textit{inter}}$ for improved prediction and analysis.


We employ the standardized IMGT/Chothia \cite{chothia1989cdr,lefranc2003imgt} to maintain structural consistency across antibody chains.This well-established system assigns independent position indices to each chain while preserving the original residue numbering from PDB structures. For the antibody heavy chain, the framework regions and CDRs follow specific positional ranges, with CDR-H1 typically spanning positions 23-35 and CDR-H3 occupying positions 104-118. Similarly, the light chain maintains its distinct numbering convention, with CDR-L1 typically located at positions 27-38 and CDR-L3 at positions 105-117. This independent numbering approach ensures clear differentiation between chain segments while facilitating accurate structural analysis and prediction. To maintain a clear distinction between antibody and antigen components, all antigen residues are uniformly assigned position 0, allowing the model to effectively distinguish between interacting molecular components.


\subsection{Epitope Selection}
\label{appendix-sec:epitope}
We implement a distance-based approach for epitope selection that identifies the most relevant antigen residues interacting with the antibody CDR-H3. For each antigen residue $v_i \in V_{ag}$, we compute its minimal distance to any CDR-H3 residue $v_j$:
$$
    \hat{dist}(v_i) = \min_{v_j} dist_{i, j},
$$
From these distances, we select the residues with top-$k$ (typically $k=48$) smallest distances to form the antigen epitope:
\begin{equation*}
    V_{\textit{ae}} = \{ \arg\min_k \hat{dist}(v_i) \mid \forall v_i \in V_{ag} \}.
\end{equation*}
This selection process ensures that we focus on the most critical residues involved in antibody-antigen binding while maintaining computational efficiency. The fixed-size antigen epitope selection provides a consistent representation of the binding interface, enabling robust structural prediction and analysis.

\subsection{Proofs}
\label{appendix-sec:proof}
\input{section/proof}


\subsection{Algorithms}
\label{appendix-sec:pipeline}
The training process iterates three times per batch, with each iteration updating the epitope coordinates and embeddings, followed by the reconstruction of intra-graph and inter-graph connections. The final iteration is utilized for loss function calculation.
Algorithm \ref{alg:iterative_update} shows the pseudo-code of the iterative updating process in Igformer. Detailed descriptions from Lines 3-8 are provided in Sections \ref{sec:subsec-inter-graph}-\ref{sec:subsec-update}.
In the first iteration ($T=1$), we use the initialized embeddings for calculation.
For subsequent iterations ($T\in \{2,3\}$), both embeddings and coordinates are updated accordingly. 
(i) The full embedding update is given by $\vect{H}_{full} = \textit{MLP}(\vect{H}_{intra}) + \vect{H}_{full}^{'}$, where $\vect{H}_{full}^{'} = \{ \vect{H}_{ae}, \vect{H}_{ab}^{'} \}$.
The paratope region is specifically updated using attention weights: $\vect{H}_{ab}^{'} = \{\vect{P} \odot \vect{H}_{\textit{p}}, \vect{H}_{ab\setminus\textit{p}}\}$, where $\vect{P} = \textit{MLP}(\vect{H}_{\textit{p}})$ assigns different weights to different residues through element-wise multiplication $\odot$, while maintaining embeddings of non-paratope regions $\vect{H}_{ab\setminus\textit{p}}$. 
(ii) The coordinate update follows a similar strategy, replacing the original epitope coordinates:
$\vect{X}_{full} = \{\vect{X}_{ae}^{'}, \vect{X}_{ab}\}$, ensuring consistent transformation patterns between embedding and coordinate spaces. 


\input{algorithm/algorithm}


\subsection{Loss Function}
\label{appendix-sec:loss}

Our training objective combines multiple loss terms to ensure accurate prediction of both sequence and structure. 

{\bf Sequence Loss.} The Sequence Negative Log Likelihood (SNLL) loss evaluates sequence prediction accuracy for masked positions in CDR regions:
\begin{equation}
\label{eq:loss-seq}
\begin{aligned}
    \mathcal{L}_{\textit{seq}} &= -\frac{1}{|V_p| \cdot | \mathcal{R}|}\sum_{v_i \in V_p } \sum_{r \in \mathcal{R}} y_{i,r} \log(\textit{softmax}(\textit{MLP}(\vect{Z}_i))_r),
\end{aligned}
\end{equation}
where $V_p$ is the set of masked residues in epitope-binding CDRs, $\vect{Z}_i$ is the output embedding of residue $v_i$, $\mathcal{R}$ is the set of all possible residue types,
$y_{i,r}$ indicates the ground truth residue type through one-hot encoding. $\textit{MLP}(\vect{Z}_i)$ outputs a vector of logits for each residue type and $\textit{softmax}(\textit{MLP}(\vect{Z}_i))_r$ gives the predicted probability for each residue type $r \in \mathcal{R}$.

{\bf Structural Loss.}
For structural accuracy, we employ a coordinate loss computed over the full antibody structure $\vect{X}_{ab}$:
\begin{equation*}
    \mathcal{L}_{\textit{coord}} = \frac{1}{|V_{ab}|} \sum_{v_i \in V_{ab}} \ell_{\textit{huber}}(\vect{X}_i^{\textit{pred}} - \vect{X}_i^{\textit{true}}T)
\end{equation*}
using the Huber loss function:
\begin{equation*}
    \ell_{\textit{huber}}(x) = 
    \begin{cases}
        0.5x^2, & \textit{if } |x| < \delta \\
        \delta(|x| - 0.5\delta), & \textit{otherwise}
    \end{cases}.
\end{equation*}
where $T$ represents the optimal rigid transformation obtained through Kabsch alignment algorithm \cite{kabsch1976rotation} using backbone atoms (N, C$\alpha$, C, O) of each residue, 
$\vect{X}_i^{\textit{pred}}$ and $\vect{X}_i^{\textit{true}}$ are the predicted and ground-truth 3D coordinates for residue $v_i$,
$\delta=1$ is the threshold parameter.

To maintain chemical validity, we include a backbone bond loss:
\begin{equation*}
    \mathcal{L}_{\textit{bond}} = \frac{1}{|\mathcal{A}|} \sum_{b \in \mathcal{A}} \ell_{\textit{huber}}(b^{\textit{pred}} - b^\textit{true})
\end{equation*}
where $\mathcal{A}$ contains all atoms in the antibody,
$b^{\textit{pred}}$ and $b^\textit{true}$ are the predicted and ground-truth bond length derived from $\vect{X}^{\textit{pred}}$
and $\vect{X}^{\textit{true}}$, respectively.
The final structure loss is the combination of the coordinate loss and the backbone bond loss:
\begin{equation}
\label{eq:loss-struct}
    \mathcal{L}_{\textit{struct}} = \mathcal{L}_{\textit{coord}} + \mathcal{L}_{\textit{bond}}
\end{equation}


{\bf Interface Loss.}
The interface loss evaluates the quality of predicted interactions between antibody paratope and antigen epitope regions using $\vect{X}_{inter}$. This loss comprises two components: a structural accuracy term and an edge distance prediction term. The structural accuracy loss measures the deviation of predicted atomic coordinates from their true positions in the paratope region:
\begin{equation*}
    \mathcal{L}_{\textit{struct}} = \frac{1}{|\mathcal{P}|} \sum_{i \in \mathcal{P}} \ell_{\textit{huber}}(\vect{X}_k^{\textit{pred}} - \vect{X}_k^{\textit{true}}),
\end{equation*}
where $\mathcal{P}$ denotes the set of atoms in the antibody paratope region, and $\vect{X}_{k}^{\textit{pred}}$ and $\vect{X}_{k}^{\textit{true}}$ denote the predicted and true 3D coordinates for atom $k$, respectively.
The edge distance prediction loss assesses the accuracy of predicted residue interactions within the binding interface:
\begin{equation*}
    \mathcal{L}_{\textit{edge}} = \frac{1}{|E_{\textit{inter}}|} \sum_{(v_i,v_j) \in E_{\textit{inter}}} \ell_{\textit{huber}}(f_{\theta}(\vect{h}_i, \vect{h}j) - dist_{ij}^{*}),
\end{equation*}
where $E_{\textit{inter}}$ is the set of epitope-paratope residue pairs at the interface with $v_i \in V_{ae}$ from the epitope and $v_j \in V_p$ from the paratope. The network $f_{\theta}$ predicts inter-residue distances based on residue embeddings $\vect{H}_i$ and $\vect{H}_j$ as input, $dist_{ij}^{*}$ is computed directly from coordinates as the minimum distance between atoms, $\vect{h}_i$ and $\vect{h}_j$, which are compared against true distances $d{ij}^*$ computed from atomic coordinates.

The total interface loss combines these components:
\begin{equation}
\label{eq:loss-interface}
    \mathcal{L}_{\textit{interface}} = \mathcal{L}_{\textit{paratope}} + \mathcal{L}_{\textit{edge}}
\end{equation}

{\bf Final Loss Function.}
By combining Equations \ref{eq:loss-seq}-\ref{eq:loss-interface}, the final loss function is calculating following:
\begin{equation}
  \mathcal{L}_{\textit{total}} = \mathcal{L}_{\textit{seq}} + \mathcal{L}_{\textit{struct}} + \mathcal{L}_{\textit{interface}}.
\end{equation}
This comprehensive loss function ensures accurate prediction of both sequence and structure while maintaining chemical validity and interface quality.



