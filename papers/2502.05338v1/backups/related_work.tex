\section{Related work}
%Several systems have attempted to improve the performance or the security properties of networked and distributed systems. We divide them into two categories: host-side trusted systems that make use of trusted components at the host level to improve systems' security and SmartNIC-based systems that take advantage of SmartNICs or programmable switch devices primarily for performance improvements.
% Several systems have attempted to improve the performance or the security properties of networked and distributed systems. We divide them into two categories: the host-side trusted systems that make use of trusted components at the host level to improve systems' security and the NIC-side systems that take advantage SmartNIC or programmable switch devices primarily for performance improvements.

\myparagraph{Trustworthy distributed systems} Prior research designed BFT systems in the context of replication protocols as in~\cite{Castro:2002, 10.1145/1658357.1658358, 199398, Suri_Payer_2021, DBLP:journals/corr/abs-1803-05069, Chan2018PaLaAS, DBLP:journals/corr/abs-1807-04938, Chan2018PiLiAE}. These systems usually have high complexity and performance overheads. \projecttitle{} on the other hand provides a generic trusted networking library to transform existing systems (under CFT) to BFT materializing a theoretical transformation with non-equivocation and transferable authentication properties that scale better than classical BFT.

\myparagraph{Trusted hardware for distributed systems} Prior systems~\cite{10.1145/3492321.3519568, minBFT, 10.1145/3552326.3587455, 10.1145/3492321.3519568} leverage trusted hardware, e.g., Intel SGX~\cite{intel-sgx}, SmartCards~\cite{levin2009trinc} and FPGAs~\cite{10.1145/2168836.2168866} to optimize for BFT systems. Their trusted components generate attestations similarly to \projecttitle{} although they report higher latencies than \projecttitle{} (e.g., 50us---105ms) due to their slow processing units~\cite{levin2009trinc} or communication costs between the host application and the trusted component~\cite{10.1145/2168836.2168866}. Our \projecttitle{} improves latency offloading the security properties at the NIC on the network data path. 

Other systems optimize~\cite{treaty, avocado, ccf} throughput by porting the entire network library and drivers within the TEE relying on SGX runtime freshness protection. Unfortunately, rollback protection is not available in all TEEs, e.g., AMD-sev in our evaluation does not offer that, while these systems build a large TCB with specific low-level code optimizations. Our \projecttitle{} offers a minimal, high-performant, TCB that is unified in all host machines. %Lastly, Trinc~\cite{levin2009trinc} and CheapBFT~\cite{10.1145/2168836.2168866} rely on peripherals to generate attestations, similarly to \projecttitle{}, with extremely expensive latencies. Our \projecttitle{} improves latencies as by principle it resides on the network data path in contrast to CheapBFT and it operates on faster frequencies compared to Trinc.

%To avoid distortion, our plots do not include Trinc~\cite{levin2009trinc} because its reported latencies are an order of magnitude slower (85-105 ms) than all other evaluated solutions.

%Lastly, recent work~\cite{10.1145/3552326.3587455} found safety violations in some optimized systems as minBFT~\cite{minBFT} on top of TEEs proving that equivocation can happens when the TEE is restarted. Our work does not suffer of such attacks because the physical isolation of FPGA renders rollback attacks to FPGA code impossible %\atsushi{I assume that the rollback attacks are a common issue for host-side trusted systems. I'd suggest we mention it in the last paragraph (as a separate paragraph) after introducing the individual systems.}. 

\myparagraph{SmartNIC-assisted systems} State-of-the-art networked systems are built on top of the emerging (programmable) SmartNIC devices~\cite{liquidIO_smartnics, u280_smartnics, bluefield_smartnics, broadcom_smartnics, netronome_smartnics, alibaba_smartnics, nitro_smartnics, msr_smartnics} for low-latency high-throughput network operations. Some systems~\cite{246498, 211249, 10.1145/3387514.3405895, 10.1145/3365609.3365851, 10.1145/3127479.3132252, 10.1145/2934872.2934897, 258971, 246486, 179716, 227655, 10.1145/3286062.3286068, shan2022supernic}  offload the network functions to the hardware optimizing the network latency while reducing the host processing overheads and energy costs. Others~\cite{10.1145/3341302.3342079, 10.1145/2872362.2872367, 234944, 9220629, 6853195, 10.1145/3477132.3483555, 280678, 10.1145/3132747.3132756, honeycomb} build generic execution frameworks that aim to optimize a wide variety of distributed systems. Our \projecttitle{} follows the trend and builds a high-performant, trusted, generic network stack for distributed systems on top of FPGA-based SmartNICs.

%Researchers also leverage FPGA-based SmartNICs to carefully offload (parts of) the business logic. Xenic~\cite{10.1145/3477132.3483555} and AlNiCo~\cite{280678} optimize transaction execution by intelligently utilizing FPGA-based SmartNICs to resolve conflicts and minimize contention. Similarly, KV-Direct~\cite{10.1145/3132747.3132756} and Honeycomb~\cite{honeycomb} accelerate KV operations by implementing a hybrid data structure co-designing between the host and SmartNIC. Similarly, \projecttitle{} leverages FPGAs, but it targets generality and minimalism. As such, our \projecttitle{} remains agnostic to the business logic and offloads to the hardware the minimal necessary processing for security guarantees. 
%\atsushi{The above two paragraphs can probably be merged because they mention studies using SmartNICs for performance/efficiency (not security). Please correct me if I'm wrong.}




\myparagraph{SmartNIC-assisted network stacks} Storm~\cite{storm}, Coyote~\cite{coyote}, Limago~\cite{8891991} and others~\cite{280712, 9114811} re-design and implement generic network stacks, i.e., RDMA and TCP/IP, for FPGA-based NICs. Our \projecttitle{} builds on top of such stacks and further extends their security semantics with the properties of non-equivocation and transferable authentication. %\atsushi{This paragraph can be moved to the bottom; I wanna prioritize the next paragraph that explains studies using SmartNICs for security. So, I'd suggest this part (SmartNIC-based systems) have three paragraphs in the following order: (1) SmartNICs for performance, (2) SmartNICs for security, (3) FPGA-based programmable NICs offering RDMA and/or TCP/IP, where TNIC can be built.}

%A classic line of work in distributed computing proposes stronger network models, such as atomic broadcast [12 , 32 ] and virtual synchrony [ 10 , 11 ], to simplify distributed
%system designs. These network primitives guarantee that a total order of messages are delivered to all broadcast receivers. However, atomic broadcast and virtual synchrony do not offer performance benefits to distributed systems â€“ implementing them is equivalent to solving consensus [ 18 ]. NOPaxos [39 ] and Eris [ 38 ] pioneered a weaker network model in which messages are delivered in a consistent order, but reliable transmission is not guaranteed. This weaker
%model can be efficiently implemented using programmable switches. NOPaxos proposes an Ordered Unreliable Multicast primitive for state machine replication, while Eris designs a multi-sequenced groupcast primitive for distributed transactions. BIDL [ 46 ] uses sequencers to parallelize consensus and transaction execution in a permissioned blockchain system. However, BIDL still uses traditional BFT protocols for consensus and its sequencer design does
%not improve performance of the BFT protocol itself. The network sequencing approach has also been applied to other distributed system designs [ 7 , 8, 57 ]. Our aom primitive was inspired from these work, but additionally provides transferable authentication, a guarantee crucial for BFT protocols


\myparagraph{Programmable hardware for network security} NeoBFT~\cite{10.1145/3603269.3604874} leverages a programmable switch to offer BFT for permissioned (BFT) blockchain systems~\cite{10.1145/3190508.3190538}. It designs an Authenticated Ordered Multicast (AOM) primitive in the programmable switch hardware and uses an FPGA as a cryptographic co-processor to improve scalability bottlenecks. Our \projecttitle{} is not orthogonal to NeoBFT but it differs in two aspects. First, it offers generality expanding the scope of BFT properties beyond the blockchain domain to general distributed systems. Secondly, it does not rely on a centralized switch for ordering but follows a decentralizing approach requiring each machine to be connected to a \projecttitle{}. In contrast to NeoBFT, the switch is not a single point of failure at the cost of some extra hardware.

Helios~\cite{10.1145/3620678.3624786} and others~\cite{10.1145/3563647.3563654, 10.1145/3321408.3323087} build on top of an ASIC-based SmartNICs and programmable switches to offer security but they target different threat models (e.g., access control, lateral movements between compromised containers, DNS traffic inspection, security functions offloading) from \projecttitle{}.


%\myparagraph{Host-side trusted systems} There has been a lot of work that builds trusted and secure systems on top of CPU-based trusted hardware such as TEEs. Particularly, several systems have designed external trusted services on top of TEEs that run independently as a separate process with the distributed application to generate and verify authenticated network messages~\cite{10.1145/3492321.3519568, minBFT}. These systems require an extra communication step between the untrusted application code and the trusted service, which has been reported to dominate the operations latency~\cite{10.1145/2168836.2168866}. In contrast, our \projecttitle{} offers on the communication path direct processing, optimizing the latency of the system. Importantly, recent work~\cite{10.1145/3552326.3587455} reports that the system can possibly equivocate and violate safety under rollback attacks. Our work does not suffer because the physical isolation of FPGA renders rollback attacks to FPGA code impossible \atsushi{I assume that the rollback attacks are a common issue for host-side trusted systems. I'd suggest we mention it in the last paragraph (as a separate paragraph) after introducing the individual systems.}. Other systems optimize the communication latency by porting the entire network library within the TEE~\cite{treaty, avocado, ccf}. Unfortunately, this leads to a huge TCB and requires low-level and very specific code optimizations which cannot be generalized for a variety of distributed systems. Lastly, Trinc~\cite{levin2009trinc} and CheapBFT~\cite{10.1145/2168836.2168866} rely on peripherals to generate and validate the attested messages with extremely expensive latencies \atsushi{Can we explain if TNIC avoids such latency increases, and how?}. 
%To avoid distortion, our plots do not include Trinc~\cite{levin2009trinc} because its reported latencies are an order of magnitude slower (85-105 ms) than all other evaluated solutions.

%\atsushi{Can we also write a one-sentence conclusion that highlights the advantage of TNIC to the systems mentioned above?}

%Trinc: SmartCards~\cite{levin2009trinc}\\
%CheapBFT: FPGA~\cite{10.1145/2168836.2168866}\\
%Trusted network stack: ~\cite{treaty, avocado} -> HUGE TCB\\
%Trusted message signing service:~\cite{10.1145/3492321.3519568, minBFT}



%\myparagraph{SmartNIC-based systems} A large body of research presented systems on top of the emerging (programmable) SmartNIC devices to optimize various systems. Some systems~\cite{246498, 211249, 10.1145/3387514.3405895, 10.1145/3365609.3365851, 10.1145/3127479.3132252, 10.1145/2934872.2934897, 258971, 246486, 179716, 227655, 10.1145/3286062.3286068, shan2022supernic}  offload the network functions improving the network latencies and reducing the host processing overheads and energy costs. Others~\cite{10.1145/3341302.3342079, 10.1145/2872362.2872367, 234944, 9220629, 6853195} have designed generic frameworks on top of the SmartNIC devices to optimize a wide variety of distributed systems.

%Researchers also leverage FPGA-based SmartNICs to carefully offload (parts of) the business logic. Xenic~\cite{10.1145/3477132.3483555} and AlNiCo~\cite{280678} optimize transaction execution by intelligently utilizing FPGA-based SmartNICs to resolve conflicts and minimize contention. Similarly, KV-Direct~\cite{10.1145/3132747.3132756} and Honeycomb~\cite{honeycomb} accelerate KV operations by implementing a hybrid data structure co-designing between the host and SmartNIC. Similarly, \projecttitle{} leverages FPGAs, but it targets generality and minimalism. As such, our \projecttitle{} remains agnostic to the business logic and offloads to the hardware the minimal necessary processing for security guarantees. 
%\atsushi{The above two paragraphs can probably be merged because they mention studies using SmartNICs for performance/efficiency (not security). Please correct me if I'm wrong.}

%Storm~\cite{storm}, Coyote~\cite{coyote}, Limago~\cite{8891991} and others~\cite{280712, 9114811} re-design and implement generic network stacks, i.e., RDMA and TCP/IP, for FPGA-based NICs. Our \projecttitle{} builds on top of such stacks and further extends their security semantics with the properties of non-equivocation and transferable authentication. \atsushi{This paragraph can be moved to the bottom; I wanna prioritize the next paragraph that explains studies using SmartNICs for security. So, I'd suggest this part (SmartNIC-based systems) have three paragraphs in the following order: (1) SmartNICs for performance, (2) SmartNICs for security, (3) FPGA-based programmable NICs offering RDMA and/or TCP/IP, where TNIC can be built.}

%NeoBFT~\cite{10.1145/3603269.3604874} and Helios~\cite{10.1145/3620678.3624786} leverage programmable NIC devices to offer security. NeoBFT~\cite{10.1145/3603269.3604874} targets the BFT model for permissioned (BFT) blockchain systems~\cite{10.1145/3190508.3190538} by designing an Authenticated Ordered Multicast (AOM) primitive in the programmable switch. To overcome the computation and scalability bottlenecks, they connect to the switch an FPGA device that serves as a cryptographic coprocessor. Our \projecttitle{} is orthogonal to NeoBFT in two aspects. First, it expands the scope of BFT properties in generic distributed systems, including blockchain systems. Secondly, it does not rely on a centralized switch for ordering, but each participating machine is connected to each own \projecttitle{} instance. Helios~\cite{10.1145/3620678.3624786} builds on top of an ASIC-based SmartNIC targeting a different threat model from \projecttitle{}. In particular, Helios targets adversaries that are able to conduct network-based attacks and enable lateral movement from a compromised container to other containers, gaining control over the compromised containers.

%extends RDMA primitives to enable remote direct key-value
%access to the main host memory. Honeycomb~\cite{honeycomb} designs an hardware-accelarated B-tree within the FPGA to accelarate KV operations.

%KV stores co-design~\cite{ 10.1145/3093337.3037731,  9912712}\\
%Network stacks on FPGA~\cite{storm, coyote, 8891991, 280712, 9114811}\\
%Security-based SmartNICs: BFT-concensus->NeoBFT~\cite{} and Helios~\cite{}\\






