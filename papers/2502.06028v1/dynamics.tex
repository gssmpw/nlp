\section{Trading Dynamics}\label{app:dynamics}
We more formally describe the update dynamics for a perpetuals exchange using a PDLP in this section.
For each time $t \in \naturals$, let $\tau_t = \{(c^i_t, \delta^i_t, \eta^i_t, p_t)\}$ be the set of trades created by users at time $t$ and let $\mathcal{A}_t = \cup_{s \leq t} \tau_s$ be the set of all trades created at or before time $t$.
We define the set of liquidatable long and short trades at time $t$ as
\begin{align*}
\ell_L(t, p_1, \ldots, p_t) &= \left\{ (c^i_s, \delta^i_s, \eta^i_s, p_s) \in \mathcal{A}_t : \eta^i_s > 0, \wedge \forall s' \in [s, t) \; p_{s'} > L(\eta, p_s) \wedge p_t \leq L(\eta, p_s)  \right\} \\
\ell_S(t, p_1, \ldots, p_t) &= \left\{ (c^i_s, \delta^i_s, \eta^i_s, p_s) \in \mathcal{A}_t : \eta^i_s < 0, \wedge \forall s' \in [s, t) \; p_{s'} < L(\eta, p_s) \wedge p_t \geq L(\eta, p_s)  \right\}
\end{align*}
In words, this is the set of trades at times $s < t$ such that the trade was not liquidatable at any time $s'$ with $s \leq s' < t$ but was liquidatable at time $t$.
That is, the trades in these sets are first liquidatable at time $t$.
We define the set $\mathcal{T}_t$ of valid trades at time $t$ to be
\[
\mathcal{T}_t = \mathcal{A}_t - \bigcup_{s \leq t} (\ell_L(t, p_1, \ldots, p_t) \cup \ell_S(t, p_1, \ldots, p_t) )
\]
Finally, we let $\mathcal{L}_t, \mathcal{S}_t \subset \mathcal{T}$ be the set of long and/or short positions alive at time $t$.
Given these definitions, we can describe the dynamics formally as follows:
\begin{enumerate}
    \item The price is updated by the price oracle to $p_{t+1}$
    \item The liquidatable positions are removed:
    \begin{align*}
    \mathcal{L}_{t} &\leftarrow \mathcal{L}_t - \ell_L(t, p_1, \ldots, p_{t+1}) &&&
    \mathcal{S}_t &\leftarrow \mathcal{S}_t - \ell_S(p_1, \ldots, p_{t+1})
    \end{align*}
    \item For each market, the funding rate $\gamma^i_{t}$ for the previous period is paid out, where
    \[
    \gamma^i_{t} = \gamma_L(L^i_t, S^i_t, p_{t+1}, p_t) = \kappa\left(\frac{L^i_t}{S^i_t} - \frac{p_{t+1}}{p_t}\right)
    \]
    and the long and short positions are updated as
    \begin{align*}
    L^i_t &\leftarrow L^i_t + \gamma^i_t S^i_t \ones_{\gamma^i_t \geq 0} &&&
    S^i_t &\leftarrow S^i_t + \gamma^i_t L^i_t \ones_{\gamma^i_t \leq 0}
    \end{align*}
    Each trader $j \in [M]$ receives a pro-rata percentage of the funding rate based on the relative size of their position.
    Note that the payout for the previous period occurs before the new trades for the following period are added.
    \item LPs submit updates to their portfolio, $q^i_t \in \reals^n$, which modifies the current portfolio $R_t$ to $R_{t+1} = R_t + \sum_{i=1}^K q^i_t$ subject to the constraint that $R_t + \sum_{i=1}^{\ell} q^i_t \geq 0$ for all $\ell \in [k]$.
    This constraint ensures that the LPs cannot drain the pool.
    \item For each trader $j \in [M]$ that submits a trade $(c^i_t, \delta^i_t, \eta^i_t, p_t) \in \tau_t$:
    \begin{itemize}
        \item Collateral $c_t^i$ is chosen such that $(1+\gamma)|\eta_t^i| p_{t+1}^T c^t_i = p_{t+1}^T \delta_t^i$.
        If this is not possible due to the user's previous positions, the trade is rejected
        \item If $c_{L,t} + c_{S, t} + \sum_{i \leq j} c_t^i > R_{t+1}$, the trade from trader $j$ is rejected as it violates the solvency requirement
        \item Otherwise update $\mathcal{L}_{j, t}, \mathcal{S}_{j, t}$ via
        \begin{align*}
            \mathcal{L}_{j, t+1} &= \mathcal{L}_{j, t} + \ones_{\eta^j_t >0 } (c^j_t, \delta^j_t, \eta^j_t) &&&
            \mathcal{S}_{j, t+1} &= \mathcal{S}_{j, t} + \ones_{\eta^j_t < 0} (c^j_t, \delta^j_t, \eta^j_t)
        \end{align*}
    \end{itemize}
    \item Fees from the last period are paid out to liquidity providers from the traders
    \[
    R_{t+1} \leftarrow R_{t+1} + f\cdot(c_{L, t+1} + c_{S, t+1})
    \]
\end{enumerate}
