\begin{algorithm}
    \small
    \caption{General System Contract: DAG-CRT}
    \label{alg:gsc-mult-triggers}
    \begin{algorithmic}[1]
    \Statex
    \Function{\textcolor{chain}{startSession}}{\textcolor{chain}{$\addr{}, \cdata$}}
            \State \textcolor{chain}{ \require ($\Not \; \acalled{}$) }
            \State \textcolor{chain}{ $\enonce{} \gets \enonce{} + 1$ }
            \State \textcolor{chain}{ $\snonce{} \gets \snonce{} + 1$ }
            \State \textcolor{chain}{ $\sactive{} \gets \true$ }
            \State \textcolor{chain}{ $\tcalled{} \gets \false$ }
            \State \textcolor{dag}{ (status, \_) $\gets \addr{}.\call(\cdata)$ }
            \State \textcolor{dag}{ \require (status) }
            \State \textcolor{dag}{ \require ($\tcalled{}$) }
    \EndFunction
    \Statex
    \Function{trigger}{$\addr{}, \cdata$}
        \If{\textcolor{dag}{ ($\Not \; \tcalled{}$) } }
            \State \textcolor{dag}{$\tnonce{} \gets \tnonce{} + 1$} {\Comment{Allow many triggers per tx}}
        \EndIf
        \State \textcolor{chain}{$\tcalled{} \gets \true$}
        \State \textcolor{chain}{$\sid{} \gets \snonce{}$}
        \State $ \msghash \gets \hash(\msgsender, \addr{}, \cdata, \tnonce{}, \textcolor{chain}{\sid{}})$
        \State \textbf{emit T}($\msgsender, \addr{}, \cdata, \tnonce{}$)
        \State $\ttree.\insertt(\msghash)$
    \EndFunction
    \Statex
    
    \Function{action}{\textcolor{dag}{$\tdatalist{}$}, \textcolor{chain}{$\sid{}$}}
            \State \textcolor{chain}{\Call{checkSessionId}{$\sid{}$}}
            \State \textcolor{chain}{$\acalled{} \gets \true$}
            \State \textcolor{chain}{$\tcalled{} \gets \false$}
            \State \textcolor{dag}{ \require ($\mathsf{len}(\tdatalist{}) > 0$) }
            \State \textcolor{dag}{ $\anonce{} \gets \anonce{} + 1$ }
            \For{\textcolor{dag}{ trigData : trigDataList } }
                \State \textcolor{dag}{(sender, caddr, cdata) $\gets$ trigData }
                \State $\xsender{} \gets \sender$
                \State (status, \_) $\gets \addr{}.\call(\cdata)$
                \State \require (status)
                \State $ \msghash \gets \hash(\sender, \addr{}, \cdata, \anonce{}, \textcolor{chain}{\sid{}}) $
                \State $\ttree.\insertt(\msghash)$
                \State $\xsender{} \gets \texttt{address}(0)$
            \EndFor
            \If{\textcolor{chain}{ ($\Not \; \tcalled{}$) } }
                \State \textcolor{chain}{ $\sactive{} \gets \false$ }
            \EndIf
            \State \textcolor{chain}{$\acalled{} \gets \false$}
    \EndFunction
    \end{algorithmic}
\end{algorithm}
