\documentclass{ifacconf}
\usepackage{graphicx}     
\usepackage{natbib}   
\usepackage{graphicx} % Required for inserting images
\usepackage{amsmath}
% \usepackage[french]{babel}
\usepackage{eurosym}
\usepackage{textcomp}
\usepackage{ulem}
\usepackage{subcaption}
\usepackage[utf8]{inputenc}
\usepackage{pgfplots}
\usepackage{xurl}
\usepackage{bm}
\DeclareUnicodeCharacter{2212}{âˆ’}
\usepgfplotslibrary{groupplots,dateplot}
\usetikzlibrary{patterns,shapes.arrows}
\pgfplotsset{compat=newest}
%\usepackage{appendix}


\begin{document}
\begin{frontmatter}
\title{Backcasting Policies in Transport Systems as an Optimal Control Problem : An Example with Electric Vehicle Purchase Incentives}

\author{Vinith Lakshmanan} 
\author{Xavier Guichet} 
\author{Antonio Sciarretta}

\address{IFP Energies Nouvelles, France (e-mail: vinith-kumar.lakshmanan@ifpen.fr, xavier.guichet@ifpen.fr, antonio.sciarretta@ifpen.fr).}
%\address[Second]{Department of Economic and Environmental Evaluation, 
  % IFP Energies Nouvelles, France (e-mail: xavier.guichet@ifpen.fr)}
%\address[Third]{Electrical Engineering Department, 
 %  Seoul National University, Seoul, Korea, (e-mail: author@snu.ac.kr)}

\begin{abstract}                % Abstract of not more than 250 words.
This study represents a first attempt to build a backcasting methodology to identify the optimal policy roadmaps in transport systems. Specifically, it considers a passenger car fleet subsystem, modelling its evolution and greenhouse gas emissions. The policy decision under consideration is the monetary incentive to the purchase of electric vehicles. This process is cast as an optimal control problem with the objective to minimize the total budget of the state and reach a desired CO$_2$ target. A case study applied to Metropolitan France is presented to illustrate the approach. Additionally, alternative policy scenarios are also analyzed.   
\end{abstract}

\begin{keyword}
Backcasting, Optimization, Policy-making, Transport system
\end{keyword}

\end{frontmatter}


\section{Introduction}

The European Union's (EU) goal of carbon neutrality by 2050 requires reducing transportation sector emissions by 90\% compared to 1990 levels. Transport alone is set to make up nearly half of Europe's greenhouse gas (GHG) emissions in 2030. Thus the European Commission has adopted a set of proposals to make the EU's policies fit for reducing net greenhouse gas emissions by at least 55\% by 2030 (\cite{GreenDeal}).
%
Similar targets are being implemented in U.S. and other regions (\cite{EPA}). 

Governance, policies, and incentives ("decisions") play an important role in shaping transport systems of the future, and influence the development and implementation of the various technologies and modes of transport. It is therefore important to study how decisions could be best used to govern transport systems in the desired direction of decarbonization. 

% \textit{In addition, the COVID-19 crisis has significantly altered commuting habits; remote and telework have become widespread together with other flexible work arrangements. The true impact of these changes on gas emissions and on the well-being of people as well as on the real-estate market (offices) are not known. This is now an opportunity to leverage on an ongoing change in habits that could result in significant GHG reduction.}

To find the best policy roadmaps for desired targets, the traditional approach consists in designing prospective scenarios, and testing them using simulation. Once the impacts are forecasted for each scenario, conclusions can be drawn on which decisions are the most effective. With this approach, the choice is limited to the scenarios designed, which may represent a tiny subset of all possibilities if multiple concurrent decisions are considered. Moreover, even when a small set of decisions are to be taken, the optimum might not be achieved since only the designed scenarios are evaluated.

To overcome these limitations, a backcasting paradigm is supported in this work. In this approach, desired targets are set by the decision makers at a certain time horizon, then the optimal combinations of policies to achieve these targets are calculated as a function of time (``backcasted"). 
In this way, the aprioristic choice of scenarios is replaced by a full dynamic optimization process that can explore among all combinations possible.

The backcasting paradigm has been introduced since the last century (\cite{Robinson, Bibri}). It has been mainly deployed in qualitative terms (\cite{Levitate}) or quantitatively with some static optimization procedure (\cite{Gomi, Ashina}).
However, this process can be more effectively cast as an optimal control problem, with a suitable definition of an objective function, an horizon, local and terminal constraints, etc.

 %However, with respect to the traditional approach, here the physical causality has to be somehow inverted.

%The availability of such a model thus represents the first step toward the new backcasting methodology. 
Clearly, since future impacts have to be predicted, the new backcasting paradigm is still based on a simulation model. This model must be able to describe transport as a system, with manipulable inputs, exogenous inputs or disturbances, outputs, and states. The manipulable inputs are represented by the decisions to optimize, which may concern local authorities, state government, EU, or even private companies. 
The exogenous inputs represent the influence of other, related systems such as the energy, urban, economic, demographic ones, which cannot be modeled within the transport system alone.
The outputs represent the impacts targeted or the constraints to impose to the backcasting process. Finally, the states are the dynamics associated with the internal variables. 

In this paper, we illustrate the backcasting paradigm, applied to the transport sector, by considering a specific subsystem with a single decision variable. The subsystem considered describes the evolution of the passenger car fleet within a certain region and its impacts on the GHG emissions. The decision optimized is a monetary incentive to the purchase of electric vehicles.

The prediction of vehicle fleet composition is the subject of a large body of literature (\cite{TREMOVE, High-Tool, ITF, ADEME}). Typically, dynamic fleet models are based on the evaluation of stocks and sales of various types of vehicles per time period. Stocks change in time due to disposal of old vehicles (due to scrappage, exports, change of use, etc.), and sales of new vehicles. The latter, in turn, are induced by transport demand (vkm) and mileage, and split among the vehicle types using discrete choice models (\cite{train, benakiva}). 

The GHG emissions of a given vehicle fleet are typically assessed using emission factors. CO$_2$ emissions of light-duty vehicles are regulated in the EU. Similar regulations are about to be applied to heavy-duty vehicles as well.
%Since 2021, new vehicles sold must emit at most 95~g(CO$_2$)/km. 

Recent studies that include electric vehicles have applied a fleet model to predict the future transport emissions in France (\cite{ADEME, ITF}), Norway (\cite{thorne}), Japan (\cite{sato}), and the U.S. (\cite{woody}).

The paper is organized as follows. Section~\ref{sec:model-refinement} introduces the passenger car fleet model, followed by the optimal control problem formulation. A case study, based on the French national passenger car fleet, is presented in Sect.~\ref{sec:casestudy}. The last section draws some conclusions and proposes several research directions to extend to a more realistic system model.

\section{Passenger Car Fleet Model} \label{sec:model-refinement}
This section presents the equations of the passenger car fleet model and the formulation of the proposed backcasting approach.  The latter consists in optimising some decisions concerning the transport system  in order to achieve some defined target in greenhouse-gas (CO$_2$) emissions at year $T$. We thus treat the transport system as a system having $\textbf{u}=
u_v(t)$ as the manipulable input to be backcasted in this study, where the monetary incentive to the purchase of electric vehicles (EV) given by the state ($u\equiv u_2$, while $u_1\equiv 0$), and the CO$_2$ emissions as the targeted output. 
% $\textbf{y}$. 
This system shall be represented by an aggregated dynamic model, which evaluates the transport emissions of the studied area as a function of time.

\subsection{Model}

We consider only a single area of interest and private car as the transport mode. In addition, we consider the latter's stock composed of two types of vehicles (thermal, $v=1$ and electric, $v=2$) differentiated by $A+1$ classes of ages ($a=0\ldots A$). We consider vehicle-km (vkm), a measure of transport demand $G(t)$, as an input provided by upstream models. Additionally, we also consider mileage $M(t)$ as an exogenous input.

We use one year as the time step and label the year index as $t$, starting from present until target year $T$. The passenger car fleet model can be written as follows. 

The demand of new vehicles $N$ at year $t$ is given by the ratio of the vkm demand for new vehicles, $F(t)$ and the mileage $M(t)$,
%
\begin{equation} \label{eqn:N}
  N(t) = \frac{F(t)}{M(t)}.
\end{equation}
%
The vkm demand for new vehicles is evaluated as the difference between total transport demand, $G(t)$ and those covered by the sum of the old vehicles disaggregated by vehicle type and age $O_{va}(t)$,
%
\begin{equation}\label{eqn:F2}
    F(t) = G(t) - M(t) \sum_{va} O_{va}(t)
\end{equation}
%
The latter is obtained using the age-dependant survival rate $\eta_a$ and the stock by vehicle type and age $S_{va}(t)$ at year $t$ as 
%
\begin{equation}\label{eqn:O2}
O_{va}(t) = \left\{ \begin{array}{ll} 
\eta_a S_{v,a-1}(t-1)  \quad \forall a=1,\ldots,A-1 \\  
\eta_A S_{v,A-1}(t-1) + \eta_A S_{vA}(t-1) 
\end{array} \right.
\end{equation}
%
% where $a'=a-1$.
The total sales at year $t$ are split among vehicle types according to 
%
\begin{equation} \label{eqn:Nv}
  N_v(t) = P_v(t)N(t),
\end{equation}
%
where $P_v$ is the share of sales by veh-type at year $t$. 

The latter is obtained from a logit expression
%
\begin{equation} \label{eqn:P}
  P_v(t) = \frac{e^{\mu U_v(t)}}{\sum_v e^{\mu U_v(t)} },
\end{equation}
%
where $U_v$ is the utility function by veh-type.

To evaluate the $P_v(t)$, we consider different technical-economic characteristics of the vehicles in its utility function, $U_v(t)$. Among the latter, we consider two classes of costs for the user: purchase costs, and operating costs (i.e., fuel/energy, maintenance, insurance costs). 
These are the main determinants for the choice of new vehicles. Another determinant is the development rate of the refilling (fuel/electricity) infrastructure which reflects its availability.
Conversely, we do not consider explicitly socio-economic determinants that depend on the single agent (like age, gender, income level, etc.) and thus are difficult to be accounted for in an aggregated model. 
Instead, we introduce an adoption coefficient to better model the penetration of new technologies (\cite{macmanus, sterman}) such as the EV. The latter is a probability density function based on the Bass model (\cite{Bass}). The expression for $U_v(t)$ is given as
%
\begin{equation} \label{eqn:U}
  \begin{aligned}
  U_v(t) = \left(1-c_v^A(t) \right)  \Biggl(p^P\frac{C_v^P(t)-u(t)}{\overline{C}^P(t)} + p^O \frac{C_v^O(t)}{\overline{C}^O(t)} +  \\   + p^I {(1-c_v^I(t))} \Biggr),  
  \end{aligned}
\end{equation}  
%
where $p$'s are tuning coefficients, $C_v^P$ is the purchase price, $C^O$ is the sum of operational costs, and $c^I$ is the rate of development of the refilling infrastructure (normalized to unity, by definition $c_1^I\equiv 1$). The average costs between the two vehicles types are given by $\overline{C}_v^P(t)$ and $\overline{C}_v^O(t)$. The prefactor that multiplies the cost-based utility is the adoption coefficient $c^A_2$ ($c^A_1\equiv 0$). Since the cost-based utility is negative (coefficients $p$'s are so), a prefactor lower than unity increases the utility of EVs proportionally to their rate of exposure.

The evolution of vehicle stock by vehicle type and age, $s_{va}$ at year $t$, is given by 
\begin{equation}
    S_{va}(t) = \left\{ \begin{array}{lll} N_v(t) & a=0 \\ O_{va}(t) & a \geq 1 \end{array} \right. .
\end{equation}

Tailpipe CO$_2$ emissions are described by simple emission factors (g/km) in this work. The latter are certainly differentiated by vehicle type and generally with vehicle age, since vehicles produced in a certain year have to comply with the emission regulations in force that year. The emissions of the stock are evaluated using the age-specific factor $\epsilon_{va}(t)$ and its annual mileage $M(t)$ as
\begin{equation}
    E(t) = \sum_{va} \epsilon_{va}(t) M(t) S_{va}(t).
\end{equation}

\subsection{OCP Formulation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

If $T$ is the time horizon, we state an optimal control problem where the cost function is the total budget for the state $I(T)$, that is, the sum of yearly products of the incentive and the number of EV sales
\begin{equation} \label{eqn:Jr}
        \min_{u(t)} I(T) = \sum_{t=1}^T  u(t) (1- P_1(t,u(t))) N(t, \textbf{x}(t-1))
\end{equation}
where the explicit form of $N$ is
% $$N(t,\textbf{x}(t-1)) = g(t)-\sum_{v,a=1}^A O_{va}(t)$$
\begin{equation}
\begin{aligned}
     & N(t,\textbf{x}(t-1)) = \frac{G(t)}{M(t)} - \Biggl(\sum_{v,a=1}^{A-1} \eta_a S_{v,a-1}(t-1) + \\&  + \eta_A S_{vA-1}(t-1) +  \eta_A S_{vA}(t-1) \Biggr)\;,
\end{aligned}
\end{equation}
%
and the state includes all partial stocks, $\textbf{x}=[S_{v0},\ldots,S_{vA}]$, $\forall v$.
Minimization of (\ref{eqn:Jr}) is subject to the terminal condition
%
\begin{equation} \label{eqn:ebar}
  E(T) \leq \overline{E} \;,  
\end{equation}
%
where $\overline{E}$ is the desired target on emissions at horizon $T$, to state equations
%
\begin{equation}
\begin{aligned}
S_{v0}(t) &= P_v(\textbf{u}(t)) N(t,\textbf{x}(t-1))\;, \\
S_{va}(t) &= \eta_a S_{v,a-1}(t-1), \quad \forall a = 1,\ldots,A-1 \\
S_{vA}(t) &= \eta_A S_{v,A-1}(t-1)+\eta_A S_{vA}(t-1) \;,
\end{aligned}
\end{equation}
%
as well as to opportune initial and boundary conditions for the control and state variables. 

For a discrete system, the Hamiltonian is generally formed as 
\begin{equation*} 
H(t) = L(t,\textbf{u}(t)) +\bm{\lambda}(t) f\left(t,\textbf{u}(t),\textbf{x}(t-1)\right), \;\; \forall t=1, \ldots, T .  
\end{equation*}
where $L$ and $\bm{\lambda}$ are the running cost and the adjoint state vector, respectively.
If are there no constraints on the control, the necessary conditions are
\begin{equation} \label{eqn:lambda}
\bm{\lambda}(t-1) =\frac{\partial H(t)}{\partial \textbf{x}(t-1)} 
\end{equation}
\begin{equation}
\frac{\partial H(t)}{\partial \textbf{u}(t)}  =0 \text { at } \textbf{u}^* .
\end{equation}

The Hamiltonian for this study case can be formed as
\begin{equation}
    \begin{aligned}
        H(t) = & u(t) (1 - P_1(u)) N(t, S_{va}(t-1)) \\
        & + \sum_{v} \lambda_{v0}(t) P_v(u) N(t,S_{va}(t-1)) \\
        & + \sum_{v,a=1}^{A-1} \lambda_{va}(t) \eta_a S_{v,a-1}(t-1) \\
        & + \sum_v \lambda_{vA}(t) \eta_A \bigl( S_{v,A-1}(t-1) + S_{vA}(t-1) \bigr)
    \end{aligned}
\end{equation}

The first-order optimality conditions yield
\begin{equation}
    \begin{aligned}
        \frac{\partial{H(t)}}{\partial{u(t)}} = & \, N(t,S_{va}(t-1))\bigl(1 - P_1 + \\& + \frac{\partial{P_1}}{\partial{u(t)}}\left(\lambda_{1,0}(t) -  \lambda_{2,0}(t) - u(t)\right) \bigr) = 0
    \end{aligned}
\end{equation}
%
\begin{equation}
    \begin{aligned}
        \lambda_{va}(t-1) =& \frac{\partial{H}(t)}{\partial{S_{va}(t-1)}} = -\eta_{a+1} \left(u(t)\left(1-P_1\right) + \right.\\& \left. + \lambda_{1,0}P_1 + \lambda_{2,0}(1-P_1) \right) + \lambda_{v,a+1}\eta_{a+1}, \\& \quad a=0,\ldots,A-1
    \end{aligned}
\end{equation}
%
\begin{equation}
\begin{aligned}
      \lambda_{vA}(t-1) =& \frac{\partial{H}(t)}{\partial{S_{vA}(t-1)}} = -\eta_A\left( u(t)(1-P_1) + \right.\\& +\lambda_{1,0}P_1 + \left. \lambda_{2,0}(1-P_1)\right) + \lambda_{vA} \eta_{A}
\end{aligned}
\end{equation}
where we have omitted the dependency on time and control for the sake of shortness.

% \begin{equation}
% \begin{aligned}
%         H(t) = u(t) P_2(u) N(t,s_{va}(t-1)) +  \\

%         H(t) = u(t)  P_2(u) \left( \frac{G(t) - M \sum_{v} \left( \sum_{a=1}^{A-1} \eta_a s_{va-1}(t-1) + \eta_A s_{vA-1}(t-1) + \eta_A s_{vA}(t-1) \right)}{M} \right) +\\
%         \lambda(t) \left( P_v(u)  \left( \frac{G(t) - M \sum_{v} \left( \sum_{a=1}^{A-1} \eta_a s_{va-1}(t-1) + \eta_A s_{vA-1}(t-1) + \eta_A s_{vA}(t-1) \right)}{M} \right) \right) + \\
%         \sum_{a=1}^{A-1}{\mu_a(t) \left(\eta_a s_{v a-1}(t-1)\right)} + \mu_A(t) \left(\eta_A s_{v A-1}(t-1)+\eta_A s_{v A}(t-1) \right)
% \end{aligned}
% \end{equation}

The nonlinear system of differential equations cannot be solved analytically to obtain the optimal incentive law. Therefore, numerical procedures must be employed. The solution is obtained using the \textit{'trust-constr'} method within the Python scipy optimize package (\cite{trustCons}).
%\subsection{Numerical Solution}
%Numerical solutions of the backcasting problem of previous section are obtained 

\section{Case Study} \label{sec:casestudy}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
This section describes a case study applied to Metropolitan France to illustrate the backcasting approach. 
It addresses the question, \textit{what financial incentives for electric vehicles make it possible to achieve a desired level of CO$_2$ in year $T$ while minimizing public spending during those years?} 
To this end, the analysis considers a time horizon from $t_0$ = 2022 to $T$ = 2050, with a one year time step. The CO$_2$ target is set by forecasting a reference scenario in which a constant incentive (IC) of 5 k\euro~is provided for every EV purchased. As a result, $\overline{E}$ in (\ref{eqn:ebar}) is set to $E(T)$ from this scenario. The 2022 passenger car fleet, from data source~1 in Table~\ref{tab:data}, is taken as the initial value for the states $\textbf{x}$. The model inputs and parameters are described in Sect.~\ref{sec:calib}, followed by the results of the case study. Furthermore, alternative policy scenarios are analyzed in Sect.~\ref{sec:alter}. 

\subsection{Parameter Calibration and Exogenous Inputs}\label{sec:calib}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The parameters of the model are tuned using historical data using sources listed in Table~\ref{tab:data}.

\begin{table}[t!]
    \centering
    \caption{Data sources}
    \begin{tabular}{|c|c|p{5.5cm}|}
        \hline
        Index & Parameter & Web link \\
        \hline
        1 & $s_{voa}$ & \url{www.statistiques.developpement-durable.gouv.fr/parc-et-circulation-des-vehicules-routiers} \\
        2 & $\epsilon_{1,0}$ & \url{carlabelling.ademe.fr/chiffrescles/r/evolutionTauxCo2} \\
        3 & $e_v$ & \url{www.citepa.org/fr/secten} \\
        4 & $\dot{\chi}$ & \url{www.statistiques.developpement-durable.gouv.fr/immatriculation-des-vehicules-routiers}\\
        \hline
    \end{tabular}
    \label{tab:data}
\end{table}

As for the survival rate, the identification was carried out using data source~1. The latter contains historical stock of passenger vehicles $s_{voa}(\tau)$ by technology, ownership type ($o = \{$private, professional$\}$), and age  until 2022.  As a first step, we neglect the dependency of survival rate on vehicle technology, and the movement of second-hand vehicles between ownership types.  Under these assumptions, the survival rate is defined as 
\begin{equation}
    \eta_a = \frac{\sum_{vo} s_{voa}(2022)}{\sum_{vo} s_{vo,a-1}(2021)} 
\end{equation}
and is approximated as an affine function, given by
\begin{equation}
    \eta_{a} = 1.05 - 0.01 \cdot a. 
\end{equation}
The approximated $\eta_a$ corresponds to an average vehicle life of around 11 years. The survival rate exceeds one for newer vehicles, likely due to vehicles imported from neighbouring countries that are subsequently sold in France; a common practice with professional ownership type.  This is overcome by saturating the maximum of $\eta_a$ to 1.

As for the emission factor $\epsilon_{1a}(t)$, considering only apparent tail-pipe emissions, the identification was carried using two sources. Data source 2 provides the historical trend ($\tau$ = 1995 to 2020) of average CO$_2$ emissions for newly sold ($a=0$) petrol and diesel cars. The emission factor for thermal vehicles ($v=1$) for this period is calculated as a weighted average based on the number of newly sold petrol and diesel vehicles and their respective emission factors. For vehicles sold prior to 1995, the emission factor is assumed to be at 1995 level. For the future trend ($\tau$ = 2020 to 2050), (\cite{ITF}) presents the efficiency trajectory of newly sold thermal vehicles in kWh(eq.)/100 km, projecting a 50\% improvement from 2015 to 2050. This evolution, with the initial value adjusted to align with data source 2, is converted to gCO$_2$/km and approximated using a quadratic function as
\begin{equation}
\begin{aligned}
        \epsilon_{1,0}(\tau) = &  0.01 \cdot (\tau-2020)^2 - 1.27 \cdot (\tau-2020) +\\ &+ 108.2, \quad \tau  \in[2020,2050]\;.
\end{aligned}
\end{equation}
Given a stock of thermal vehicles by age, their corresponding emission factor $\epsilon_{1a}(t)$ is obtained using the following transformation
\begin{equation}
    \epsilon_{1a} (t) = \epsilon_{1,0}(t_0+t-a).
\end{equation}
The emission factor for EVs is set to zero (i.e., $\epsilon_{2a} = 0$).
%
The survival rate by veh-age $\eta_a$ and emission factor of newly sold thermal vehicles $\epsilon_{1,0}(\tau)$ are shown in Fig.~\ref{fig:param}. %Their numerical values, together with those of the initial stock by veh-type and age are also listed in Table~\ref{tab:instock}.

For the annual mileage $M(t)$, data source 3 provides the annual CO$_2$ emissions by different vehicle types $e_v(\tau)$ in France, with $e_2(\tau) =0$. Assuming a constant annual mileage across vehicle types, $M(t)$ is calculated as 
\begin{equation}\label{eqn:M}
    M(\tau) = \frac{e_1(\tau)}{\sum_a  \sum_o s_{1oa}(\tau)\epsilon_{1,0}(\tau - a)},\; \tau \in [2011, 2022]
\end{equation}
where $s_{1a}$ represents the thermal passenger vehicle stock from data source~1, and $\epsilon_{1,0}$ is the emission factor described above. Using (\ref{eqn:M}), Fig.~\ref{fig:param} shows the annual mileage $M(\tau)$, with a dip during the COVID-19 pandemic in 2020. Overall, $M(t)$ is approximated to a constant value of 13,500~kms. Since the focus of this work is emissions reduction, we match $M(t)$ using the historical emissions data. This average is slightly higher than the one estimated in (\cite{ITF}). The latter reports a mileage of 12500~kms/year computed as a function of different use profiles specific a household's location type (rural, urban, etc.).

\begin{figure}[h!]
    \centering
    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
        \pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel distance
        \input{figParc/na}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
        \pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel 
        \input{figParc/EmsissionFactor}
    \end{subfigure}

    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
        \pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel 
        \input{figParc/Mileage}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
        \pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel 
        \input{figParc/Demand}
    \end{subfigure}
    \caption{Model Inputs and Parameters} \label{fig:param}
\end{figure}

The parameters and determinants related to the Logit model in (\ref{eqn:U}) are considered as exogenous inputs. The assumptions and values for these inputs are directly adopted from the work conducted for the French Agency of Ecological Transistion (ADEME) using the DRIVE$^{RS}$ fleet model, see (\cite{ADEME}). The transport demand $G(t)$ (vkm), shown in Fig.~\ref{fig:param}, is also adopted from the latter.  

The adoption coefficient $c^A(t)$ is the solution of the Bass model (normalised to market-share) 
\begin{equation}\label{eqn:Bass}
\begin{aligned}
    c^A(\tau) = \frac{d}{d\tau}\chi(\tau) = (p + q \chi(\tau))(1-\chi(\tau)) 
\end{aligned}
\end{equation}
where %$\bar{s}_2(\tau) = {s}_2(\tau)/M$, and 
$p$ and $q$ are the coefficients of innovation and imitation, respectively. The values of $p$ and $q$ are tuned to align with the yearly EV sales from 2018 to 2022, as provided by data source 4. Figure~\ref{fig:Exo} and Table~\ref{tab:logit} shows the different determinants and parameters, used in  (\ref{eqn:U}), respectively.

\begin{table}[h!]
    \centering
    \caption{List of model parameters.}   
    \label{tab:logit}
    \begin{tabular}{ccc}
        Attributes & ICEV & EV \\ \hline
        Purchase Cost ($p^P$) & -0.3 & -0.3\\
        Operating Cost ($p^O$) & -0.15 & -0.15\\
        Infrastructure Cost ($p^I$) & - & -0.3\\
        $\mu$ & \multicolumn{2}{c}{6.75} \\ 
        $p$ & \multicolumn{2}{c}{0.02} \\ 
        $q$ & \multicolumn{2}{c}{0.4} \\ \hline
    \end{tabular}
    \label{tab:param}
\end{table}

\begin{figure}[h!]
    \centering
    % \hspace{-.5cm}
    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
        \pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel distance
        \input{figParc/AdoptionCoeff.tex}
    \end{subfigure}
    % \hspace{1cm}
    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
        \pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel 
        \input{figParc/Infra.tex}
    \end{subfigure}
    
    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
        \pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel 
        \input{figParc/Costs.tex}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
        \pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel 
        \input{figParc/Costs2.tex}
    \end{subfigure}
    %\hspace{1cm}
%   
\caption{Determinants used in Logit model} \label{fig:Exo}
\end{figure}

\begin{figure}[h!]
    \centering
    % \hspace{-.5cm}
    \begin{subfigure}[t]{.48\columnwidth}
        \centering
         \pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel distance
        \input{figParc_aac/OptIncentive}
        %\caption{}
        %\label{fig:optInc}
    \end{subfigure}
    \begin{subfigure}[t]{.48\columnwidth}
        \centering
         \pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel 
        \input{figParc_aac/Emission5KOpt}
        %\caption{}
        %\label{fig:optEms}
    \end{subfigure}
    \caption{Incentive (left) and Emission (right) Profile} \label{fig:opt}
\end{figure}

\begin{figure}[h!]
    \centering
    \begin{subfigure}[t]{\columnwidth}
        \centering
        \input{figParc_aac/Sales5KOpt}
       % \caption{}
       % \label{fig:Nv}
    \end{subfigure}
    \hspace{1cm}
    \begin{subfigure}[t]{\columnwidth}
        \centering
        % \pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel 
        \input{figParc_aac/Stock5KOpt}
        %\caption{}
        %\label{fig:stock}
    \end{subfigure}
    % \hspace{1cm}
    \caption{Vehicle Sales (top) and Vehicle Stock (bottom) }\label{fig:salesStock}
\end{figure}


\subsection{Results}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The emissions, and vehicle sales and stock curves, for IC and optimal scenario, are shown in Fig.~\ref{fig:opt}~(right), and Fig.~\ref{fig:salesStock}, respectively. Clearly, in both scenarios, the ICEV stock ($v=1$) decreases while the EV stock ($v=2$) increases with time, both exhibiting an S-shaped curve suggesting variable rate. The curve of CO$_2$ emissions, Fig.~\ref{fig:opt}~(right), is proportional to that of $S_1$ and decreases by more than three times with respect to 2022. The IC scenario forecasts 12.3~Mt of CO$_2$ in 2050. Correspondingly, $\overline{E}$ is set to this value. 

The incentive law shown in  Fig.~\ref{fig:opt}~(left) exhibits a very variable behavior, being null until a certain year, to rise up by the end of the period. Intuitively, such a behavior is optimal, within the assumptions of the model, in that it incentivises late adopters and encourages EV purchase during a period when ICE performance is improving. 
and further reduce the emissions while minimizing the total budget. This effect is visible in the curves of EV sales and stock (Fig.~\ref{fig:salesStock}) and emissions (Fig.~\ref{fig:opt}~(right)). Compared to the IC law,  EV sales are lower in the initial years and begin to increase around midpoint. Consequently, the optimal emission curve decreases gradually in the early years and exhibits a sharper decrease towards the end. The final CO$_2$ emission for both scenarios are equal as the  constraint is defined only at $T$. However, the cumulative CO$_2$ emissions of the optimal scenario is higher than the IC scenario. To address this, an integral constraint on emissions can be defined in future work.  
Regarding the EV stock, it increases gradually early-on but shows a sharper increase towards the end as result of the optimal incentive. 

Overall, we obtain a total expenditure $I(T)= 196.2$ G\euro, that is, around 30\% reduction with respect to the IC reference scenario, see Table~\ref{tab:res}.    

\subsection{Alternative scenarios}\label{sec:alter}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In addition to the optimal and IC scenarios, we analyze three different policies, namely,
\begin{itemize}
    \item No incentive (I0), $u(t) \equiv 0$ 
    %\item Constant incentive (IC), $u(t) \equiv 5$ k\euro  
    \item Incentive covering the whole EV price (IP), $u(t) = C_2^P(t)$
    \item Ban of ICEV sales from $t_0$ (BI), $N_{2}(t) = N(t)$
\end{itemize}
%
The corresponding curves of CO$_2$ emissions and EV stock are shown in Fig.~\ref{fig:refs}. Clearly, the more stringent the policy, the faster increase of EV stock is observed, together with a decrease in yearly emissions. With the BI, the ICEV stock virtually empties by 2050 and consequently the CO$_2$ emissions vanish by that target year. The $E(T)$ and $I(T)$ values for the different policy scenarios are given in Table~\ref{tab:res}.

\begin{figure}[h!] 
    \centering
    \begin{subfigure}[t]{\columnwidth}
        \centering
        %\pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel 
        \input{figParc/caseStudies}
        %\caption{}
    \end{subfigure}
    \hspace{1cm}
    \begin{subfigure}[t]{\columnwidth}
        \centering
        %\pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel 
        \input{figParc/caseStudies_S2}
        %\caption{}
    \end{subfigure}
    \caption{Reference Scenarios with the full model: CO$_2$ emissions (top) and EV stock (bottom) as a function of time.}\label{fig:refs}
\end{figure}

\begin{table}[h!]
    \centering
    \caption{Reference and optimal scenario}    \label{tab:res}
    \begin{tabular}{c|ccccc}
    \hline
              Output  & I0  & IC  & IP  & BI  & Optimal  \\
    \hline
       $E(T)$ (Mt) &   15.3 & 12.3 & 4.3 & 0.4 & 12.3 \\
         $I(T)$ (G\euro) & 0 & 215 & 1497 & - & 196.2 \\
         \hline
        %Refined & 12.2 &   215 & 12.2 & 196.2\\ \hline
    \end{tabular}
\end{table}



\section{Conclusions and Future Work}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

This study represents a first attempt to build a backcasting methodology to identify the optimal policy roadmaps in transport systems. 
The analysis focussed on a passenger car fleet subsystem, describing its evolution and associated emissions, with the monetary incentive to an EV purchase as the control input. The optimal incentive trajectory was derived by formulating an optimal control problem with the objective to minimize the state's budget while reaching a desired CO$_2$ target. A quantitative case study applied to Metropolitan France was performed to illustrate the backcasting approach. 

Further research can improve the backcasting paradigm in several ways. Refinements to the fleet model could include regional disaggregation within Metropolitan France, additional vehicle types (e.g., gasoline, diesel, hybrid) and transport modes (e.g., bikes, rail), and modeling second-hand vehicle exchanges. Mileage assumptions could be refined by accounting for variation by vehicle type and user profile, using zone-specific data (e.g., urban, rural) as in (\cite{ITF}). The survival rate, currently based only on natural obsolescence, could also incorporate factors like Low Emission Zones (LEZ), which can accelerate vehicle turnover. Additionally, the zonal choice in a LEZ implementation could be optimized.  Finally, to capture the changes in operating costs and vehicle ownership, the demand for passenger cars, treated here as exogenous, could be replaced with a demand model predicting vkm by mode and zone.

% Further research can improve the presented backcasting paradigm in several different directions. Firstly, refinements to the fleet model can include disaggregating Metropolitan France into smaller zones, including more vehicle types (e.g., gasoline, diesel, hybrid) and transportation modes (e.g., bike, powered-two-wheelers, rail), modelling second-hand vehicle movement between private and professional ownerships, and distinction between registered and circulating fleet.
% %
% Similarly, mileage is likely not constant for all users and vehicles in a given zone. A differentiation of the latter by veh-type, using typical usage profiles by zone or zone category (e.g., urban, peri-urban, rural) as done in (\cite{ITF} could therefore be considered in a future version of the model.
% %
% The current survival rate implementation considers only natural vehicle obsolescence. Other factors such as Low Emission Zones (LEZ) can decrease the survival rata. Furthermore, the decision to set up a LEZ for a certain zone can be optimized. 
% %
% Secondly, the demand for passenger cars has been considered as exogenous in this work. To capture the effects of operating cost and ownership changes, a demand model that predicts the vkm by zone and mode is thus necessary. 

% However, a change in operating costs and in vehicle ownership will likely have an effect on the share of this transportation mode with respect to others (public transport, walking, etc.) To capture this effects, a demand model that predicts the vkm by zone and mode is thus necessary.
% Similarly, mileage is likely not constant for all users and vehicles in a given zone. A differentiation of the latter by veh-type, using typical usage profiles by zone or zone category (e.g., urban, peri-urban, rural) as done in (\cite{ITF} could therefore be considered in a future version of the model.
% Some types of vehicles are not only scrapped because of their natural obsolescence, but also for other reasons that are linked to decisions that could be optimized. For example, the set up of low emission zones in some urban areas could bring to the riddance of the vehicle types forbidden by a higher rate that the natural survival rate. The decision to set up a LEZ by zone could be then optimized with the constraint of minimize the forced number of vehicle dumped. 

% The adoption coefficient can be also made endogenous to capture the influence of variable prices and operational costs, which is not the case in the present model. 
% %
% An anticipation of future bans could be treated similarly to a negative-adoption coefficient that decreases the utility function for ICEVs without strictly forbidding their sales.

% These extensions of the backcasting approach would require further refinements to the fleet model itself. First off, multiple zones must be considered since setting a LEZ is a typically local policy. Also, multiple vehicle types (e.g., gasoline, diesel, hybrid) must be considered, since LEZ regulations distinguish between them. 
% The in-use (or circulating) fleet could be considered when evaluating the emissions, instead of the registered fleet. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Acknowledgments}
This research benefited from state aid managed by the \textit{Agence Nationale de la Recherche (ANR)}, under France 2030, within the project FORBAC bearing the reference ANR-23-PEMO-0002. The authors would like to acknowledge the useful discussions with Dr. Benoit Cheze (IFPEN) and the partners of the FORBAC project. 
%A CC-BY public copyright license has been applied by the authors to the present document and will be applied to all subsequent versions up to the Author Accepted Manuscript arising from this submission, in accordance with the grantâ€™s open access conditions.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliography{parc_aac} 


% \begin{thebibliography}{99}

% \bibitem{GreenDeal} European Commission (2021), ``European Green Deal: Commission proposes transformation of EU economy and society to meet climate ambitions", Press Release, available at \url{https://ec.europa.eu/commission/presscorner/}.

% \bibitem{EPA} Environmental Protection Agency (2023), ``Multi-Pollutant Emissions Standards for Model Years 2027 and Later Light-Duty and Medium-Duty Vehicles", available at \url{https://www.epa.gov}.

% \bibitem{TREMOVE} De Ceuster G et al. (2004), TREMOVE 2.2 Model and Baseline Description, 
% Report for European Commission, available at \url{www.asser.nl}.

% \bibitem{High-Tool} Van Grol R et al. (2016), ``Elasticities and Equations of the HIGH-TOOL
% Model (Final Version)", HIGH-TOOL Deliverable D4.3, project cofunded by the European Commission under the 7th Framework Programme, Karlsruhe.

% \bibitem{ITF} International Transport Forum (2019), ``Understanding Consumer Vehicle Choice: A New Car Fleet Model for France", International Transport Forum Policy Papers No. 72, OECD Publishing, Paris.

% \bibitem{ADEME} Bouter A et al. (2022), ``Etude Ã©nergÃ©tique, Ã©conomique et environnementale du transport routier Ã  horizon 2040 (E4T 2040), IFPEN-ADEME, available at \url{https:\\librairie.ademe.fr}.

% \bibitem{train} Train KE (2003), ``Discrete Choice Methods with Simulation", Cambridge Univ. Press, Cambridge, 2nd ed.

% \bibitem{benakiva} Ben-Akiva L, Lerman SR (2000), ``Discrete Choice Analysis", MIT press, Cambridge MA.

% \bibitem{thorne} Thorne R, Aguilar Lopez F, Figenbaum E, FridstrÃ¸m L, MÃ¼ller DB (2021), ``Estimating stocks and flows of electric passenger vehicle batteries in the Norwegian fleet from 2011 to 2030", Journal of Industrial Ecology, 25(6):1377--1706.

% \bibitem{sato} Kenta Sato FE, Nakata T (2020), ``Recoverability Analysis of Critical Materials from Electric Vehicle Lithium-Ion Batteries through a Dynamic Fleet-Based Approach for Japan", Sustainability, 12(1), 147.

% \bibitem{woody} Woody M., Keoleian GA, Vaishnav P (2023), ``Decarbonization potential of electrifying 50\% of U.S. light-duty vehicle sales by 2030". Nat Commun 14, 7077.

% \bibitem{Bass} Bass FM (1969), ``A New-Product Growth Model for Consumer Durables", Management Science, 15, 1,215-227.

% \bibitem{macmanus} McManus W, Senter R (2009), ``Market Models for Predicting PHEV Adoption and Diffusion", U.S. Department of Energy, Final Report, available at \url{https://deepblue.lib.umich.edu/}.

% \bibitem{sterman} Struben J, Sterman J (2008), ``Transition Challenges for ALternative Fuel Vehicle and Transportation Systems", Environment and Planning B, 35(6):1070--1097.


% \end{thebibliography}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \appendix

% \section{Parameters and Exogenous Variables}

% \begin{table}[h!]
%     \centering
%     \caption{List of parameters for Metropolitan France.}   
%     \label{tab:logit}
%     \begin{tabular}{ccc}
%         Attributes & ICEV & EV \\ \hline
%         Purchase Cost ($p^P$) & -0.3 & -0.3\\
%         Operating Cost ($p^O$) & -0.15 & -0.15\\
%         Infrastructure Cost ($p^I$) & - & -0.3\\
%         $\mu$ & \multicolumn{2}{c}{6.75} \\ \hline
%     \end{tabular}
%     \label{tab:param}
% \end{table}

% \begin{table}[!ht]
%     \centering
%     \caption{Initial stocks, emission factor, and survival rate by veh-type and veh-age} \label{tab:instock}
%     \begin{tabular}{ccccc} \hline Age & \multicolumn{2}{c}{{Initial stock}} & Emission factor & Survival rate \\ $a$ & $S_1(t_0)$ & $S_2(t_0)$ & $\epsilon_{1,0}(t)$ & $\eta_a$ \\ \hline
%         0  & 850729 & 107751 &   105.8  & N.A. \\ 
%         1  & 1208829 & 77284 &    107  & 1.0  \\ 
%         2  & 1911867 & 25646 &    108  & 1.0  \\ 
%         3  & 2001224 & 18161 &    115  & 0.999  \\ 
%         4  & 1922874 & 14580 &    114  & 0.944  \\ 
%         5  & 1915687 & 12701 &    113  & 1.011  \\ 
%         6  & 1815720 & 9332 &    112  & 0.993  \\ 
%         7  & 1715103 & 4653 &    113  & 0.996  \\ 
%         8  & 1704027 & 3695 &    116  & 0.981  \\ 
%         9  & 1773074 & 2013 &    119  & 0.983  \\ 
%         10  & 1992409 & 716 &    124  & 0.975  \\ 
%         11  & 1984333 & 61 &    128  & 0.978  \\ 
%         12  & 1941219 & 64 &    130  & 0.964  \\ 
%         13  & 1734257 & 23 &    133  & 0.962  \\ 
%         14  & 1656124 & 18 &    140  & 0.945  \\ 
%         15  & 1461471 & 11 &    151  & 0.941  \\ 
%         16  & 1282236 & 7 &    151  & 0.919  \\ 
%         17  & 1116991 & 9 &    154  & 0.914  \\ 
%         18  & 970820 & 5 &    156  & 0.895  \\ 
%         19  & 874548 & 25 &    157  & 0.892  \\ 
%         20  & 762675 & 20 &    158  & 0.871  \\ 
%         21  & 632719 & 15 &    159  & 0.875  \\ 
%         22  & 511403 & 32 &    162  & 0.858  \\ 
%         23  & 353184 & 27 &    166  & 0.859  \\ 
%         24  & 230132 & 10 &    171  & 0.845  \\ 
%         25  & 199309 & 4 &    175  & 0.785  \\ 
%         26  & 199309 & 4 &    175  & N.A.  \\ 
%         27  & 199309 & 4 &    176  & N.A.  \\ 
%         28  & 199309 & 4 &    176  & N.A.  \\ 
%         29  & 199309 & 4 &    176  & N.A.  \\ 
%         30  & 199309 & 4 &    176 & N.A.  \\ 
%         \hline
%     \end{tabular}
% \end{table}

% \begin{table}[h!] 
% \centering
% \caption{Costs by type, veh-type, and year.} \label{tab:costs}
% \begin{tabular}{ccccccc}
% \hline
% {Year} & \multicolumn{2}{c}{{BEV({\euro})}} & \multicolumn{2}{c}{{Thermal({\euro})}} & \multicolumn{2}{c}{{Average({\euro})}} \\
% & $C_2^P(t)$ & $C_2^O(t)$ & $C_1^P(t)$ & $C_1^O(t)$ & $\overline{C}^P(t)$ & $\overline{C}^O(t)$ \\
% \hline
% 2020 & 40000 & 800.0 & 27500 & 550 & 33750 & 675.0 \\
% 2021 & 33220 & 664.4 & 27650 & 553 & 30435 & 608.7 \\
% 2022 & 32440 & 648.8 & 27800 & 556 & 30120 & 602.4 \\
% 2023 & 31660 & 633.2 & 27950 & 559 & 29805 & 596.1 \\
% 2024 & 30880 & 617.6 & 28100 & 562 & 29490 & 589.8 \\
% 2025 & 30100 & 602.0 & 28250 & 565 & 29175 & 583.5 \\
% 2026 & 29320 & 586.4 & 28400 & 568 & 28860 & 577.2 \\
% 2027 & 28540 & 570.8 & 28550 & 571 & 28545 & 570.9 \\
% 2028 & 27760 & 555.2 & 28700 & 574 & 28230 & 564.6 \\
% 2029 & 26980 & 539.6 & 28850 & 577 & 27915 & 558.3 \\
% 2030 & 26200 & 524.0 & 29000 & 580 & 27600 & 552.0 \\
% 2031 & 26090 & 521.8 & 29450 & 589 & 27770 & 555.4 \\
% 2032 & 25980 & 519.6 & 29900 & 598 & 27940 & 558.8 \\
% 2033 & 25870 & 517.4 & 30350 & 607 & 28110 & 562.2 \\
% 2034 & 25760 & 515.2 & 30800 & 616 & 28280 & 565.6 \\
% 2035 & 25650 & 513.0 & 31250 & 625 & 28450 & 569.0 \\
% 2036 & 25540 & 510.8 & 31700 & 634 & 28620 & 572.4 \\
% 2037 & 25430 & 508.6 & 32150 & 643 & 28790 & 575.8 \\
% 2038 & 25320 & 506.4 & 32600 & 652 & 28960 & 579.2 \\
% 2039 & 25210 & 504.2 & 33050 & 661 & 29130 & 582.6 \\
% 2040 & 25100 & 502.0 & 33500 & 670 & 29300 & 586.0 \\
% 2041 & 24990 & 499.8 & 33950 & 679 & 29470 & 589.4 \\
% 2042 & 24880 & 497.6 & 34400 & 688 & 29640 & 592.8 \\
% 2043 & 24770 & 495.4 & 34850 & 697 & 29810 & 596.2 \\
% 2044 & 24660 & 493.2 & 35300 & 706 & 29980 & 599.6 \\
% 2045 & 24550 & 491.0 & 35750 & 715 & 30150 & 603.0 \\
% 2046 & 24440 & 488.8 & 36200 & 724 & 30320 & 606.4 \\
% 2047 & 24330 & 486.6 & 36650 & 733 & 30490 & 609.8 \\
% 2048 & 24220 & 484.4 & 37100 & 742 & 30660 & 613.2 \\
% 2049 & 24110 & 482.2 & 37550 & 751 & 30830 & 616.6 \\
% 2050 & 25000 & 500.0 & 38000 & 760 & 31500 & 630.0 \\
% \hline
% \end{tabular}
% \end{table}

% \begin{table}[!ht] 
%     \centering
%     \caption{Coefficients of adoption and infrastructure development, by year} \label{tab:coeff}
%     \begin{tabular}{ccc}
%     \hline
%     Year & Infr. Dev. & Adoption \\
%     & $c^I_2(t)$ & $c^A_2(t)$ \\
%     \hline
%         2020  & 0.1 & 0.04 \\ 
%         2021  & 0.15 & 0.05 \\ 
%         2022  & 0.2 & 0.06 \\ 
%         2023  & 0.25 & 0.08 \\
%         2024  & 0.3 & 0.09 \\ 
%         2025  & 0.35 & 0.11 \\
%         2026  & 0.4 & 0.11 \\ 
%         2027  & 0.45 & 0.11 \\
%         2028  & 0.5 & 0.09 \\ 
%         2029  & 0.6 & 0.07 \\ 
%         2030  & 0.7 & 0.05 \\ 
%         2031  & 0.8 & 0.04 \\ 
%         2032  & 0.9 & 0.02 \\ 
%         2033  & 1 & 0.01 \\ 
%         2034  & 1 & 0.01 \\ 
%         2035  & 1 & 0.00 \\ 
%         2036  & 1 & 0.00 \\ 
%         2037  & 1 & 0.00 \\ 
%         2038  & 1 & 0.00 \\ 
%         2039  & 1 & 0.00 \\ 
%         2040  & 1 & 0.00 \\ 
%         2041  & 1 & 0.00 \\ 
%         2042  & 1 & 0.00 \\ 
%         2043  & 1 & 0.00 \\ 
%         2044  & 1 & 0.00 \\ 
%         2045  & 1 & 0.00 \\ 
%         2046  & 1 & 0.00 \\ 
%         2047  & 1 & 0.00 \\ 
%         2048  & 1 & 0.00 \\ 
%         2049  & 1 & 0.00 \\ 
%         2050  & 1 & 0.00 \\ 
%         \hline
%     \end{tabular}
% \end{table}


% \begin{table}[h!]
% \centering
% \caption{Buying Costs (\euro)}
% \begin{tabular}{cccc}
% \hline
% \textbf{Year} & \textbf{BEV} & \textbf{Thermal} & \textbf{Average} \\
% \hline
% 2020 & 40000 & 27500 & 33750 \\
% 2021 & 33220 & 27650 & 30435 \\
% 2022 & 32440 & 27800 & 30120 \\
% 2023 & 31660 & 27950 & 29805 \\
% 2024 & 30880 & 28100 & 29490 \\
% 2025 & 30100 & 28250 & 29175 \\
% 2026 & 29320 & 28400 & 28860 \\
% 2027 & 28540 & 28550 & 28545 \\
% 2028 & 27760 & 28700 & 28230 \\
% 2029 & 26980 & 28850 & 27915 \\
% 2030 & 26200 & 29000 & 27600 \\
% 2031 & 26090 & 29450 & 27770 \\
% 2032 & 25980 & 29900 & 27940 \\
% 2033 & 25870 & 30350 & 28110 \\
% 2034 & 25760 & 30800 & 28280 \\
% 2035 & 25650 & 31250 & 28450 \\
% 2036 & 25540 & 31700 & 28620 \\
% 2037 & 25430 & 32150 & 28790 \\
% 2038 & 25320 & 32600 & 28960 \\
% 2039 & 25210 & 33050 & 29130 \\
% 2040 & 25100 & 33500 & 29300 \\
% 2041 & 24990 & 33950 & 29470 \\
% 2042 & 24880 & 34400 & 29640 \\
% 2043 & 24770 & 34850 & 29810 \\
% 2044 & 24660 & 35300 & 29980 \\
% 2045 & 24550 & 35750 & 30150 \\
% 2046 & 24440 & 36200 & 30320 \\
% 2047 & 24330 & 36650 & 30490 \\
% 2048 & 24220 & 37100 & 30660 \\
% 2049 & 24110 & 37550 & 30830 \\
% 2050 & 25000 & 38000 & 31500 \\
% \hline
% \end{tabular}
% \end{table}




% \begin{table}[h!]
% \centering
% \caption{Operational Costs (\euro)}
% \begin{tabular}{ccccccc}
% \hline
% \textbf{Year} & \multicolumn{2}{c}{\textbf{BEV}} & \textbf{Thermal)} & \textbf{Moyen} \\

% \hline
% 2020 & 800.0 & 550 & 675.0 \\
% 2021 & 664.4 & 553 & 608.7 \\
% 2022 & 648.8 & 556 & 602.4 \\
% 2023 & 633.2 & 559 & 596.1 \\
% 2024 & 617.6 & 562 & 589.8 \\
% 2025 & 602.0 & 565 & 583.5 \\
% 2026 & 586.4 & 568 & 577.2 \\
% 2027 & 570.8 & 571 & 570.9 \\
% 2028 & 555.2 & 574 & 564.6 \\
% 2029 & 539.6 & 577 & 558.3 \\
% 2030 & 524.0 & 580 & 552.0 \\
% 2031 & 521.8 & 589 & 555.4 \\
% 2032 & 519.6 & 598 & 558.8 \\
% 2033 & 517.4 & 607 & 562.2 \\
% 2034 & 515.2 & 616 & 565.6 \\
% 2035 & 513.0 & 625 & 569.0 \\
% 2036 & 510.8 & 634 & 572.4 \\
% 2037 & 508.6 & 643 & 575.8 \\
% 2038 & 506.4 & 652 & 579.2 \\
% 2039 & 504.2 & 661 & 582.6 \\
% 2040 & 502.0 & 670 & 586.0 \\
% 2041 & 499.8 & 679 & 589.4 \\
% 2042 & 497.6 & 688 & 592.8 \\
% 2043 & 495.4 & 697 & 596.2 \\
% 2044 & 493.2 & 706 & 599.6 \\
% 2045 & 491.0 & 715 & 603.0 \\
% 2046 & 488.8 & 724 & 606.4 \\
% 2047 & 486.6 & 733 & 609.8 \\
% 2048 & 484.4 & 742 & 613.2 \\
% 2049 & 482.2 & 751 & 616.6 \\
% 2050 & 500.0 & 760 & 630.0 \\
% \hline
% \end{tabular}
% \end{table}



\end{document}




Le modÃ¨le du parc de vÃ©hicules [5, 6] pourra Ãªtre du type :
\begin{equation}
    \begin{array}{ll}
        O_{imva}(t) &= S_{imva'}(t-1)\eta_{imva}, a\geq 1, a'=a-1 \\
        N_{im}(t) &= \displaystyle\frac{F_{im}(t)}{M_{im}(t-1)}  \\
        M_{im}(t) &= \displaystyle\frac{F_{im}(t)}{\sum_v N_{ivm}(t)}  \\
        F_{im}(t) &= G_{im}(t)-\sum_a \left(M_{im}(t-a)\sum_v O_{imva}(t) \right)  \\
        N_{imv}(t) &= P_{imv}(t)N_{im}(t)  \\
        P_{imv}(t) &= \displaystyle\frac{\sum_a S_{imva}(t-1)\exp(C_{iv}(t)^p_{iv}) }{\sum_v \sum_a S_{imva}(t-1)\exp(C_{iv}(t)^p_{iv})}  \\
        S_{imva}(t) &= \left\{ \begin{array}{ll}
            N_{imv}(t) & a=0 \\
            O_{imva}(t) & a \geq 1
        \end{array} \right.
    \end{array}
\end{equation}
Dans ces Ã©quations, $t$ est la variable temporelle, discretisÃ©e par pas de, p. ex., 1 an ; les indices $c,m,v$ et $a$ dÃ©signent la rÃ©gion dâ€™intÃ©rÃªt, le mode de transport, le type de vÃ©hicule et lâ€™Ã¢ge des vÃ©hicules. Les variables en lettres majuscules dÃ©signent : le nombre total de vÃ©hicules ($S$), le nombre de vieux vÃ©hicules dâ€™Ã¢ge supÃ©rieur Ã  1 an ($O$), le nombre de vÃ©hicules nouveaux ($N$), les km parcourus en moyenne par unitÃ© de temps ou mileage ($M$), la demande en nombre de vÃ©hiculesâ‹…km attribuÃ©e aux vÃ©hicules nouveaux ($F$), la demande totale ($G$), la part typologique ($P$), le coÃ»t unitaire ($C$). Les variables dâ€™entrÃ©e du sous-systÃ¨me sont $G$ et $C$. La sortie est $P$. Le modÃ¨le utilise les paramÃ¨tres fixes $\eta$ et $p$. Les Ã©tats sont $S(t)$, $M(t)$, $M(t-1)$, \ldots, $M(t-a)$. 
Il est Ã©vident quâ€™il sâ€™agit dâ€™un modÃ¨le nonlinÃ©aire multidimensionnel, oÃ¹ les variables indÃ©pendantes sont discrÃ©tisÃ©es et prennent le rÃ´le dâ€™indices de grandeurs qui peuvent Ãªtre continues. De plus, des opÃ©rations dâ€™agrÃ©gation (somme sur un indice) ou dÃ©sagrÃ©gation (introduction dâ€™un nouvel indice) sont frÃ©quentes car les sorties globales du modÃ¨le sont des variables diffÃ©remment agrÃ©gÃ©es. 
Aussi Ã©vidente est la cardinalitÃ© trÃ¨s Ã©levÃ©e de lâ€™espace dâ€™Ã©tat. Au total, le nombre dâ€™Ã©tats dynamiques pour cet exemple serait
$n=(c\times m \times v \times a)+(c\times m\times a)$
Avec $c=100$, $m=4$, $v=10$, $a=8$, nous aurions donc 3520 Ã©tats.
Quelques simplifications substantielles sont a priori possibles si certains indices ne sont pas couplÃ©s (par exemple, les indices $c$ et $m$, ce qui rÃ©duirait le nombre dâ€™Ã©tats dâ€™un facteur $400$ dans lâ€™exemple). Cependant, il est fort probable que des effets croisÃ©s apparaissent dans les autres sous-modÃ¨les interconnectÃ©s avec celui-ci.
Un autre Ã©lÃ©ment Ã  prendre en considÃ©ration dans le PCO de backcasting concerne la formulation des contraintes dâ€™Ã©tat, ce qui va conditionner ultÃ©rieurement le choix de la mÃ©thode de rÃ©solution. Outre que les contraintes banales ou ``physiques" (dans lâ€™exemple, $Sâ‰¥0$ etc.), il sâ€™agira de traduire en termes mathÃ©matiques des considÃ©rations socio-Ã©conomiques ou des besoins recueillis des utilisateurs potentiels (ce qui sera fait dans le cadre du projet FORBAC.


% \section{Modeling Assumptions} \label{sec:ass}

% A certain number of model inputs are considered as exogenous here, as they can be calculated from upstream models.
% % demand
% In particular, we consider the transport demand as an exogenous process. We assume that in general the demand is segmented by zone $i$ and transport mode $m$. We take the total vehicle-km (vkm) $G_{im}(t)$ as a measure of the demand. 
% % mileage
% Similarly, the mileage $M_{im}(t)$ (km/y) is also considered as an exogenous variable in this work.

% % fleet
% The fleet of vehicles for a certain transport mode is composed of several vehicle types $v$, which have different technical and econometric characteristics. We aim at evaluating the time evolution of the vehicle stock by type because the environmental footprint directly depends on the fleet composition at a certain year.

% % prices
% Among the latter, we consider prices and fares by vehicle type exogenous as well. In particular, we consider two classes of costs for the user: purchase costs, and operating costs (i.e., fuel/energy, maintenance, insurance costs). 
% These are the main determinants for the choice of new vehicles. Another determinant is the development rate of the refilling (fuel/electricity) infrastructure which reflects its availability.
% Conversely, we do not consider explicitly socio-economic determinants that depend on the single agent (like age, gender, income level, etc.) and thus are difficult to be accounted for in an aggregated model. 
% Instead, we introduce an adoption coefficient to better model the penetration of new technologies such as the EV. The latter is based on the Bass model ((\cite{Bass}) that addresses the interaction between early adopters or adopters via innovation, and adopters via imitation.

% % emissions
% Tailpipe CO$_2$ emissions are described by simple emission factors (g/km) in this work. The latter are certainly differentiated by vehicle type and generally with vehicle age, since vehicles produced in a certain year have to comply with the emission regulations in force that year. Thus we introduce a new segmentation variable that is the vehicle age, and represent the emission factors as $\epsilon_{va}$ and the vehicle stock as $S_{imva}$. 

% In the following, we consider a single zone of interest ($i\equiv 1$) and transport mode (private car, $m\equiv 1$), and thus we omit the indication of the subscripts $i$ and $m$. In addition, we consider two types of vehicles (thermal, $v=1$ and electric, $v=2$) and $A+1$ classes of ages ($a=0\ldots A$).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Backcasting with a Simplified Fleet Model} \label{sect:simpleModel}
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \subsection{Model (M1)}


% A simple model considering constant mileage $M$ and only the purchase incentive $u(t)$ ($u\equiv u_2$, while $u_1\equiv 0$) provided for EV by the state,  can be written as follows.
% %
% The demand of new vehicles $N$ at year $t$ is given by the ratio of the vkm demand for new vehicles, $F(t)$ and the mileage,
% \begin{equation} \label{eqn:N}
%   N(t) = \frac{F(t)}{M}.
% \end{equation}

% The vkm demand for new vehicles is in turn evaluated as the difference between the total demand $G(t)$ and that covered by old vehicles,
% \begin{equation} \label{eqn:F}
%   F(t) = G(t)- M \sum_{v} O_{v}(t),   
% \end{equation}
% where $O_v(t)$ is the stock of old vehicles by veh-type at year $t$.

% The latter is obtained from $S_v(t)$, the stock by vehicle type at year $t$, assuming a constant (by now) survival rate $\eta$,
% \begin{equation} \label{eqn:O}
%   O_{v}(t) = \eta S_{v}(t-1).
% \end{equation}

% The total sales at year $t$ are split among vehicle types according to 
% \begin{equation} \label{eqn:Nv}
%   N_v(t) = P_v(t)N(t),
% \end{equation}
% where $P_v$ is the share of sales by veh-type. The latter is obtained from a logit expression
% \begin{equation} \label{eqn:P}
%   P_v(t) = \frac{e^{\mu U_v(t)}}{\sum_v e^{\mu U_v(t)} },
% \end{equation}
% where $U_v$ is the utility function by veh-type.

% To evaluate the latter, we consider the various determinants as explained in Section~\ref{sec:ass}, yielding an expression of the type
% \begin{equation} \label{eqn:U}
%   U_v(t) = \left(1-c_v^A(t) \right)\left(p^P\frac{C_v^P(t)-u(t)}{\overline{C}^P(t)} + p^O \frac{C_v^O(t)}{\overline{C}^O(t)}+p^I {(1-c_v^I(t))} \right),  
% \end{equation}
% %
% %\begin{equation} \label{eqn:U_th}
%  % U_1(t) = \left(p^P\frac{C_1^P(t)}{ \overline{C}_1^P(t)} + p^O \frac{C_1^O(t)}{\overline{C}_v^O(t)} \right),  
% %\end{equation}
% %
% where $p$'s are tuning coefficients, $C_v^P$ is the purchase price, $C^O$ is the sum of operational costs, and $c^I$ is the rate of development of the refilling infrastructure (normalized to unity, by definition $c_1^I\equiv 1$). The average costs between the two vehicles types are given by $\overline{C}_v^P(t)$ and $\overline{C}_v^O(t)$. 
% The prefactor that multiplies the cost-based utility is a measure of the exposure to the new technology (\cite{macmanus, sterman}. The latter is described by a Bass model (\cite{Bass}, where the adoption coefficient $c^A_2$ ($c^A_1\equiv 0$) is the probability density function of the random adoption time. Since the cost-based utility is negative (coefficients $p$'s are so), a prefactor lower than unity increases the utility of EVs proportionally to their rate of exposure.

% Finally, the stock by veh-type at year $t$ is given by the sum of new and old vehicles,
% \begin{equation}\label{eqn:S}
%   S_v(t)=N_v(t)+O_v(t). 
% \end{equation}
% %

% The emissions of this stock is evaluated using the emission factors $\epsilon_v$ as
% %
% \begin{equation} \label{eqn:E}
%   E(t) = \sum_{v} \epsilon_{v} M S_{v}(t).  
% \end{equation}

% Since under the assumptions used in this section, $S(t)=S_1(t)+S_2(t)\equiv G(t)/M$, this model can be summarized as
% %
% \begin{equation} \label{eqn:summ}
% \left\{
% \begin{array}{l}
%    E(t) = \epsilon_1 M S_1(t)\\
%   S_1(t) = \eta S_1(t-1) + P_1(t,u(t))N(t)  \\ P_1(t,u(t)) = \dfrac{p(t)}{p(t)+q(t) r(t)^{u(t)}}
% \end{array} 
% \right.
% \end{equation}
% %
% where 
% \begin{equation}
%   N(t) = \dfrac{G(t)-\eta G(t-1)}{M}  
% \end{equation}
% \begin{equation}
%   p(t)= e^{\mu U_1(t)}  
% \end{equation}
% \begin{equation}\label{eqn:p}
%     q(t) = \exp\left(\mu(1-c_2^A(t))\left(p^P\frac{C^P_2(t)}{\overline{C}^P(t)} + p^O \frac{C^O_2(t)}{\overline{C}^O(t)} + p^I (1-c^I_2(t)) \right) \right),
% \end{equation}
% and 
% \begin{equation}
%   r(t)=\exp\left(-\mu(1-c_2^A(t))\frac{p^P}{\overline{C}^P(t)} \right)
% \end{equation}
% are explicit functions of time only.

% By integrating over time, the emission level at time $T$ is obtained as
% \begin{equation} \label{eqn:eT}
%     E(T) = \eta^T E(0)+\sum_{t=1}^T\eta^{T-t}\frac{K(t)p(t)}{p(t)+q(t)r(t)^{u(t)}}
% \end{equation}
% %
% while the total incentive is
% \begin{equation} \label{eqn:IT}
%     I(T) = \sum_{t=1}^T u(t)N(t)\frac{q(t)r(t)^{u(t)}}{p(t)+q(t)r(t)^{u(t)}}
% \end{equation}

% To illustrate the type of behavior this model describes, we use the following parameters (their choice will be explained later in Sect.~\ref{sec:casestudy}): $M=13500$ [km/a], $\eta = 0.89$, %$\eta=0.9379$, 
% %(instead of $0.955$), 
% $\epsilon_1=129.3 \cdot 10^{-12}$ [Mt(CO$_2$)/km], 
% %(instead of $120)
% $\epsilon_2=0$, $\mu=6.75$, $p^P=-0.3$, $p^O=-0.15$, $p^I=-0.3$.
% %
% We set the initial values of the stocks as $S_1(t_0)=35.520\cdot 10^6$, $S_2(t_0)=2.769\cdot 10^6$ at $t_0=2022$. Also, $G(t_0)=MS(t_0)$ and $E(t_0)=\epsilon_1 MS_1(t_0)$.
% %
% For the time-varying exogenous demand we take
% %
% % $$G(t)=M(-14115.11(t+2019)^2 + 57269844.35(t+2019) - 58051410552.05)$$
% % $$c^A_2(t) = 1-\exp\left(-\left(\frac{t+9}{15}\right)^3\right), \quad c^A_1(t)=0$$
% % $$u(t) = 1000(t\leq 10)+1500(t\leq 7)+2500(t\leq 4)$$
%  $$G(t) = M\cdot (-3.72\cdot 10^{-3}(t_0+t)^2 + 1.53\cdot 10^1(t_0+t) - 1.57\cdot 10^4)\cdot 10^6$$
% for $t=1,\ldots,T$ with $T=28$ (i.e., until year 2050), see Fig.~\ref{fig:G}.
% The various time-varying costs and coefficients are shown in Fig.~\ref{fig:Exo}, and their numerical values are listed in Tables~\ref{tab:costs}--\ref{tab:coeff}.
% We set a reference incentive law that is constant in time, $u^R(t)\equiv 5$ [k\euro/veh].

% With these data, we obtain the following results.
% % The demand in terms of vehicle-kilometres is show in Fig.~\ref{fig:G}.
% %
% The two stocks and the annual CO$_2$ emissions are shown in Fig.~\ref{fig:ref}a--b as a function of time. Clearly, the ICEV stock ($v=1$) decreases while the EV stock ($v=2$) increases with time, both exhibiting an S-shaped curve suggesting variable rate. The curve of CO$_2$ emissions, Fig.~\ref{fig:ref}b is proportional to that of $S_1$ and decreases by more than three times with respect to 2022.

% Overall, we get $E(T)=17.5$~Mt and $I(T)=403$~G\euro, as summarized in Table~\ref{tab:res}. To reduce the total state expenditure while keeping the CO$_2$ to the levels achieved in 2050, we introduce an optimal control (``backcasting") paradigm in the next section.

% \begin{figure}[h!]
%     \centering
%     \input{figParc/Demand.tex}
%     \caption{Transportation demand as a function of time.}
%     \label{fig:G}
% \end{figure}

% \begin{figure}[h!]
%     \centering
%     \begin{subfigure}[t]{0.45\textwidth}
%         \centering
%         %\pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel distance
%         \input{figParc/RefsimpleStock}
%     \end{subfigure}
%     \hfill
%     \begin{subfigure}[t]{.45\textwidth}
%         \centering
%         %\pgfplotsset{ylabel shift = -.5em} % Adjusts the ylabel 
%         \input{figParc/RefsimpleEmission}
%     \end{subfigure}
%     \caption{Reference Scenario with the simplified model: stocks (left) and CO$_2$ emissions (right) as a function of time.} \label{fig:ref}
% \end{figure}

% \subsection{OCP Formulation}
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% If $T$ is the time horizon, we state an optimal control problem as
% %
% \begin{equation} \label{eqn:J}
%    \min_{u(t)} I(T) = \sum_{t=1}^T u(t)(1-P_1(t,u(t))N(t) 
% \end{equation}
% %
% where (i) the cost function is the total budget for the state, that is, the sum of yearly products of the incentive and the number of EV sales, subject to (ii) the terminal condition
% %
% \begin{equation} \label{eqn:ebar}
%   E(T) \leq \overline{E} ,  
% \end{equation}
% %
% where $\overline{E}$ is the desired target on emissions at horizon $T$, to (iii) a state equation that is a combination of (\ref{eqn:S}) and (\ref{eqn:E}),
% %
% \begin{equation} \label{eqn:state}
%   E(t) = \eta E(t-1)+K(t)P_1(t,u(t)) \equiv f(t,u(t),E(t-1)) ,
% \end{equation}
% %
% where $K(t)=\epsilon_1 M N(t)$, (iv) as well as to opportune initial conditions and boundary conditions for the control variable $u(t)$. Clearly, high values of $u(t)$ decrease $E(T)$ but increase $I(T)$.

% % \textbf{*** The notation is discrete and is rewritten as $x_{k+1} = f(x_k)$ *** }

% % \textbf{*** Needs to be uniform in the above section ***}

% For a discrete system, the Hamiltonian is generally formed as 
% \begin{equation}
% % H_k = f\left(x_k, u_k, k\right)+\lambda_{k+1} g\left(x_k, u_k, k\right), \quad \text { for } k=0,1, \ldots, T-1 .    
% H(t) = L(t,u(t)) +\lambda(t) f\left(t,u(t),x(t-1)\right), \quad \text { for } t=1, \ldots, T .  
% \end{equation}
% where $x$ is the state and $\lambda$ the adjoint state.
% % Notice the indexing on the adjoint; it is one step ahead of the other terms.  
% If we do not have any constraints on our control, the necessary conditions are
% % \begin{aligned}
% % \lambda_k & =\frac{\partial H_k}{\partial x_k} \\
% % \frac{\partial H_k}{\partial u_k} & =0 \text { at } u^* .
% \begin{equation} \label{eqn:lambda}
% \lambda(t-1) =\frac{\partial H(t)}{\partial x(t-1)} 
% \end{equation}
% \begin{equation}
% \frac{\partial H(t)}{\partial u(t)}  =0 \text { at } u^* .
% % \end{aligned}    
% \end{equation}

% The  Hamiltonian for our case is formed as
% \begin{equation}
%   % H_k = u_k +\lambda_{k+1}(\eta E_k+K_kP_1(k,u_k))  
%   H(t) = u(t)\left(1-P_1(t,u(t))\right)N(t) +\lambda(t)(\eta E(t-1)+K(t)P_1(t,u(t)))  
% \end{equation}
% where the state variable is $E(t)$ and its dynamics is given by (\ref{eqn:state}).
% Therefore, the Euler-Lagrange equation (\ref{eqn:lambda}) is particularized as
% %
% \begin{equation} \label{eqn:euler}
%   % \lambda_k = \eta \lambda_{k+1} .  
%   \lambda(t-1) = \eta \lambda(t) .  
% \end{equation}
% % Rearranging (\ref{eqn:control}) we get,
% % \begin{equation}
% %     % \frac{r_k^u}{(p_k+q_kr_k^{u_k})^2} = \frac{1}{\lambda_{k+1}K_kln(r_k)p_k^2q_k}. 
% %     \frac{r(t)^{u(t)}}{\left(p(t)+q(t)r(t)^{u(t)}\right)^2} = \frac{1}{\lambda(t+1)K(t)\ln(r(t))p(t)^2q(t)}. 
% % \end{equation}
% %
% with the initial condition $\lambda(1)=\lambda_0$ and $\lambda_0$ to be found by imposing the boundary constraint (\ref{eqn:ebar}).

% \subsection{Semi-Analytical Solution}
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% The solution of (\ref{eqn:euler}) is obtained as
% % $$ \lambda_{k+1} = \lambda_0(1/\eta)^{k+1} $$
% $$ \lambda(t) = \lambda_0(1/\eta)^{t}, \quad t=0,\ldots,T .$$
% %
% By setting $dH/du=0$ we obtain the optimal solution $u^*(t)$ implicitly as:
% \begin{equation} \label{eqn:control}
% \begin{aligned}
%     % 1 - \lambda_{k+1}K_k \left(  \frac{p_k^2q_kr_k^uln(r_k)}{(p_k+q_kr_k^{u_k})^2} \right) = 0   
%     % 1 - \lambda(t+1)K(t) \frac{p(t)^2q(t)r(t)^{u(t)} \ln(r(t))}{\left(p(t)+q(t)r(t)^{u(t)}\right)^2}  = 0   
%     p(t)+q(t)r(t)^{u^*(t)}+u^*(t)p(t)\ln(r(t))-\lambda_0(1/\eta)^t\epsilon_1M p(t)\ln(r(t)) = 0
%     \end{aligned}
% \end{equation}
% %
% % where the quantity $p^*$ depends on $u^*$ as per (\ref{eqn:p}).
% %
% % from whence (\ref{eqn:control}) becomes
% % \begin{equation}\label{eqn:control1}
% %     \begin{aligned}
% %     % \frac{r_k^u}{(p_k+q_kr_k^{u_k})^2} &= \frac{1}{\lambda_{0}B_k} 
% %     \frac{r(t)^{u(t)}}{(p(t)+q(t)r(t)^{u(t)})^2} &= \frac{1}{\lambda_{0}B(t)}     \end{aligned}
% % \end{equation}
% % where 
% % % $B_k = (1/\eta)^{k+1}K_kln(r_k)p_k^2q_k$. 
% % $B(t) = (1/\eta)^{t+1}K(t)\ln(r(t))p(t)^2q(t)$. 
% % Upon expanding and rearranging (\ref{eqn:control1}) we obtain,
% % \begin{equation}
% %     % q_k^2x_k^{2} - (B_k \lambda_0 - 2p_kq_k)x_k + p_k^2 = 0
% %     q(t)^2x(t)^{2} - \left(B(t) \lambda_0 - 2p(t)q(t)\right)x(t) + p(t)^2 = 0
% % \end{equation}
% % where 
% % % $x_k = r_{k}^{u_k} $. 
% % $x(t) = r(t)^{u(t)} $. 
% % On solving for $x(t)$, the optimal incentive is obtained as,
% % % $$ u_k = ln(x_k)/ln(r_k)$$.
% % $$ u(t) = \frac{\ln(x(t))}{\ln(r(t))}$$.
% %
% This transcendental equation can be solved by invoking the Lambert function\footnote{The Lambert function $W(x)$ is the solution of the equation $We^W=x$.}:
% $$u^*(t) = \frac{a(t)-W\left(-b(t)e^{a(t)}\right)}{c(t)}-$$
% where $a(t)= \lambda_0\eta^{-t}\epsilon_1M\ln(r(t)) -1$, $b(t)= -q(t)/p(t)$, and $c(t)= \ln(r(t))$.

% By replacing $u^*$ into (\ref{eqn:eT}), the target emission level and the total incentive are obtained as 
% \begin{equation} \label{eqn:ETlam}
%   E^*(T|\lambda_0) = \eta^T E(0)+\sum_{t=1}^T \eta^{T-t} K(t)\left(1+W(t)\right)^{-1}  
% \end{equation}
% %
% \begin{equation} \label{eqn:ITlam}
%   I^*(T|\lambda_0) = \sum_{t=1}^T N(t) \left(\frac{a(t)-W(t)}{c(t)} \right) W(t) \left(1+W(t)\right)^{-1}  
% \end{equation}
% %
% where we have written $W(t)$ instead of $W(-b(t)e^{a(t)})$ for the sake of conciseness.

% It is straightforward to show that
% $$\frac{\partial }{\partial a} \left( \frac{1}{1+W}\right) = -\frac{W}{(1+W)^3}$$
% $$\frac{\partial }{\partial a} \left( \frac{aW-W^2}{1+W}\right) = \frac{W(1+a)}{(1+W)^3}$$
% %
% In the range of $\lambda_0$ where both $a(t)$ and $W(t)$ are positive quantities for all times, the larger $\lambda_0$, the larger $a$, so that $E^*(T)$ decreases monotonically. At the same time, $I^*(T)$ monotonically increases with an increase of $\lambda_0$. Since $I^*(T)$ is to be minimized, and the constraint (\ref{eqn:ebar}) to be satisfied, it is clear that the optimal solution is obtained for the value of $\lambda_0$ such that the equality sign holds in (\ref{eqn:ebar}), i.e., $E^*(T|\lambda_0)=\overline{E}$.
% %
% Unfortunately, it is not possible to find this value in closed form. However, this value can be found numerically using a shooting algorithm. 
 
% % \begin{figure}
% %     \centering
% %     % \includegraphics{}
% %     \caption{Optimal incentive law - Analytical solution.}
% %     \label{fig:enter-label}
% % \end{figure}


% Other sensitivities of $E^*(T)$, $I^*(T)$ with respect to key parameters can be analytically evaluated. For example, the fuel cost, $C_1^O$ enters in the functions $p(t)$ and $q(t)$, thus in $b(t)$ and ultimately in $W(t)$. It is possible to show that
% $$\frac{\partial }{\partial C_1^O} \left( \frac{1}{1+W}\right) = \frac{W}{(1+W)^3} 2\mu p^O \frac{C_2^O(2-c_2^A)}{(C_1^O+C_2^O)^2}$$
% $$\frac{\partial }{\partial C_1^O} \left( \frac{aW-W^2}{1+W}\right) = -\frac{a-2W-W^2}{(1+W)^3} 2\mu p^O \frac{C_2^O(2-c_2^A)}{(C_1^O+C_2^O)^2}$$
% %
% which are both negative quantities, since $p^O<0$ and $a(t)-2W(t)-W^2(t) <0$. In fact, increasing the fuel cost (e.g., through excises, or a ``carbon" tax), decreases the ratio of thermal vehicles sold, thus both the target emission and the need to subsidize the purchase of EVs.

% In summary the model of this section is useful to give some insight of the nature of the solutions to our backcasting problem, and show the influence of some factors and parameters. However, it is still too simple to capture essential phenomena, so that its quantitative predictions might be inaccurate. 
% Therefore we shift in the next section to a more realistic model.
















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{Backcasting with a More Realistic Model} \label{sect:model-refinement}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\subsection{Model (M2)}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% We introduce now three realistic refinements to the model M1. First, the dependency of the emission factors and thus of the stock with the vehicle age, assuming $A+1$ classes of age $(a=0,\ldots,A)$. 
% Second, we introduce an age-varying survival rate $\eta_a$, which we assume valid for both types of vehicles. Third, a time-varying annual mileage $M(t)$ constant across vehicle types is considered. With these assumptions, the equations (\ref{eqn:F})--(\ref{eqn:O}) and (\ref{eqn:S})--(\ref{eqn:E}) of fleet model M1  are rewritten as follows. 

% The vkm demand for new vehicles is now evaluated as the difference between total demand and those covered by the sum of the old vehicles disaggregated by vehicle type and age. 
% \begin{equation}\label{eqn:F2}
%     F(t) = G(t) - M(t) \sum_{va} O_{va}(t)
% \end{equation}

% The latter is obtained using the age-dependant survival rate $\eta_a$ and the stock by vehicle type and age $S_{va}(t)$ at year $t$ as 

% \begin{equation}\label{eqn:O2}
% O_{va}(t) = \left\{ \begin{array}{ll} 
% \eta_a S_{va'}(t-1) & \text{for } a=1,\ldots,A-1 \\  
% \eta_A S_{vA'}(t-1) + \eta_A S_{vA}(t-1) & \text{for } a = A  
% \end{array} \right.
% \end{equation}
% where $a'=a-1$, $A'=A-1$.

% The refinements introduced in M2 do not impact the logit model used to determine the share of each vehicle type. Consequently, the total vehicle sales in year $t$ are given by equations (\ref{eqn:Nv}) and (\ref{eqn:P}), while the evolution of stock is given by 
% \begin{equation}
%     S_{va}(t) = \left\{ \begin{array}{lll} N_v(t) & a=0 \\ O_{va}(t) & a \geq 1 \end{array} \right. .
% \end{equation}

% The emissions of the stock are evaluated using the age-specific factor $\epsilon_{va}(t)$ and its annual mileage $M(t)$ as
% \begin{equation}
%     E(t) = \sum_{va} \epsilon_{va}(t) M(t) S_{va}(t).
% \end{equation}

% % \begin{equation} \label{eqn:realistic}
% % \begin{array}{r@{}l}
% %     N(t) &{}= \dfrac{F(t)}{M(t)}  \\
% %   F(t) &{}= G(t)- M(t) \sum_{va} O_{va}(t),   \\
% %   O_{va}(t) &{}= \left\{ \begin{array}{ll} \eta_a S_{va'}(t-1) & a=1,\ldots,A-1 \\  \eta_A S_{vA'}(t-1) + \eta_A S_{vA}(t-1)  & a = A  \end{array} \right. \\
% %   N_v(t) &{}= P_v(t)N(t) \\
% %   P_v(t) &{}= \dfrac{e^{U_v(t)}}{\sum_v e^{U_v(t)} }, \\
% %     U_v(t) &{}= 2U^0(1-c_v^A(t))\left(p^P\dfrac{C_v^P(t)-u_v(t)}{\sum_v C_v^P(t)} + p^O \dfrac{C_v^O(t)}{\sum_v C_v^O(t)}+p^I \dfrac{C_v^I(t)}{\sum_v C_v^I(t)} \right),  \\   
% %     S_{va}(t) &{}= \left\{ \begin{array}{lll} N_v(t) & a=0 \\ O_{va}(t) & a \geq 1 \end{array} \right. \\
% %     E(t) &{}= \sum_{a=0}^A \epsilon_{a}(t) M(t)S_{1a}(t)
% % \end{array}
% % \end{equation}


% The nature of these equations inherently make the optimization of $u(t)$ more complex than with M1, so that a new OCP must be formulated.