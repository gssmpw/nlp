\documentclass[twocolumn]{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{chapterbib}  
\usepackage{caption}
\usepackage{subcaption}
\usepackage{array}
\usepackage{multirow}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{hyperref}
\usepackage[inkscapelatex=false]{svg}
\usepackage{pdfpages}
\usepackage{geometry}
\usepackage{algorithm}
 \geometry{
 a4paper,
 total={170mm,257mm},
 left=20mm,
 top=20mm,
 }
 \usepackage{float}
 \usepackage{comment}
\usepackage{placeins} 
 \usepackage{amsmath}
\usepackage{algorithm}
\usepackage{algpseudocode}

\usepackage{graphicx}% http://ctan.org/pkg/graphicx
\usepackage{array}% http://ctan.org/pkg/array
\usepackage{authblk}
\makeatletter
\newcommand\footnoteref[1]{\protected@xdef\@thefnmark{\ref{#1}}\@footnotemark}
\makeatother
\title{Generative augmentations for improved cardiac ultrasound segmentation using  diffusion models}
\author{Gilles Van De Vyver, Aksel Try Lenz, Erik Smistad, Sindre Hellum Olaisen, Bjørnar Grenne, Espen Holte, Håvard Dalen, and Lasse Løvstakken}
\date{}
\setlength{\parindent}{0pt}
\pdfobjcompresslevel=0


\begin{document}







\maketitle


\begin{figure*}[h!]
\centering
  \centering
  \includegraphics[trim={0.75cm 0.25cm 0.75cm 0.25cm}, clip,width = \linewidth]{figures/augmentation_examples_v3.drawio.pdf}
  \caption{Examples of the generative augmentations types used in this work. All the examples are generated from the same original image shown in the top-left corner.}
  \label{fig: generative_aug_examples}
\end{figure*}

\begin{abstract}

One of the main challenges in current research on segmentation in cardiac ultrasound is the lack of large and varied labeled datasets and the differences in annotation conventions between datasets. This makes it difficult to design robust segmentation models that generalize well to external datasets. 

This work utilizes diffusion models to create generative augmentations that can significantly improve diversity of the dataset and thus the generalisability of segmentation models without the need for more annotated data. The augmentations are applied in addition to regular augmentations. 

A visual test survey showed that experts cannot clearly distinguish between real and fully generated images. 

Using the proposed generative augmentations, segmentation robustness was increased when training on an internal dataset and testing on an external dataset with an improvement of over 20 millimeters in Hausdorff distance. Additionally, the limits of agreement for automatic ejection fraction estimation improved by up to 20\% of absolute ejection fraction value on out of distribution cases.

These improvements come exclusively from the increased variation of the training data using the generative augmentations, without modifying the underlying machine learning model. 

The augmentation tool is available as an open source Python library at
\url{https://github.com/GillesVanDeVyver/EchoGAINS}.
\begin{center}
    \textbf{Keywords}:
\end{center}
Cardiac segmentation, Ultrasound, Generative AI, Diffusion models, RePaint

\end{abstract}



\input{Sections/Introduction}

\input{Sections/Datasets}

\input{Sections/Methods}

\begin{figure*}
\centering
  \centering
  \includegraphics[trim={0cm 0cm 0cm 0 cm}, clip,width = 0.618\linewidth]{figures/biggest_diffs.drawio.pdf}
  \caption{Segmentation results for HUNT4 study participants with the largest difference in automatic EF for models with and without generative augmentations. The model trained without generative augmentations fails to correctly segment the LV  for frames with increased depth due to the lack of such images in the training set.}
  \label{fig: biggest_diff.pdf}
\end{figure*}

\begin{figure}
\centering
  \centering
  \includegraphics[trim={0cm 0cm 0cm 0 cm}, clip,width = 0.5\linewidth]{figures/hallucination_repaint.pdf}
  \caption{A problematic hallucination by the diffusion model, generating a second mitral valve below the true mitral valve.}
  \label{fig: hallucination_repaint}
\end{figure}



\input{Sections/experimental_setup}



\input{Sections/RealTimeDemo}


\input{Sections/Discussion}


\input{Sections/Conclusion}


% placing large figure at the end, but before references

\begin{figure*}[h!]
    \centering
    \begin{subfigure}{0.382\linewidth}
        \centering
        \includegraphics[trim={1cm 1.6cm 0.4cm 2cm},clip,width=\textwidth]{figures/bland_altman_hunt4_on_hunt4_in_v2.pdf}
        \caption{Trained on \textbf{HUNT4} \textbf{without} generative augmentations, tested \textbf{in normal range}.}
    \end{subfigure}
    \hspace{1.5cm}
    \begin{subfigure}{0.382\linewidth}
        \centering
        \includegraphics[trim={1cm 1.6cm 0.4cm 2cm},clip,width=\textwidth]{figures/bland_altman_hunt4_all_on_hunt4_in_v2.pdf}
        \caption{Trained on \textbf{HUNT4} \textbf{with} generative augmentations, tested \textbf{in normal range}.}
    \end{subfigure}

    %\vspace{1em} % Adds some space between the rows

    \begin{subfigure}{0.382\linewidth}
        \centering
        \includegraphics[trim={1cm 1.6cm 0.4cm 2cm},clip,width=\textwidth]{figures/bland_altman_hunt4_on_hunt4_out_v2.pdf}
        \caption{Trained on \textbf{HUNT4} \textbf{without} generative augmentations, tested \textbf{outside normal range}.}
    \end{subfigure}
    \hspace{1.5cm}
    \begin{subfigure}{0.382\linewidth}
        \centering
        \includegraphics[trim={1cm 1.6cm 0.4cm 2cm},clip,width=\textwidth]{figures/bland_altman_hunt4_all_on_hunt4_out_v2.pdf}
        \caption{Trained on \textbf{HUNT4} \textbf{with} generative augmentations, tested \textbf{outside normal range}. \newline}
    \end{subfigure}

        %\vspace{1em} % Adds some space between the rows

    \begin{subfigure}{0.382\linewidth}
        \centering
        \includegraphics[trim={1cm 1.6cm 0.4cm 2cm},clip,width=\textwidth]{figures/bland_altman_CAMUS_all_on_CAMUS_out_v2.pdf}
        \caption{Trained on \textbf{CAMUS} \textbf{without} generative augmentations, tested \textbf{outside normal range}.}
    \end{subfigure}
    \hspace{1.5cm}
    \begin{subfigure}{0.382\linewidth}
        \centering
        \includegraphics[trim={1cm 1.6cm 0.4cm 2cm},clip,width=\textwidth]{figures/bland_altman_CAMUS_on_CAMUS_out_v2.pdf}
        \caption{Trained on \textbf{CAMUS} \textbf{with} generative augmentations, tested \textbf{outside normal range}. \newline}
    \end{subfigure}

    \caption{Bland–Altman plots comparing the manual reference with automatic EF measurements obtained via segmentation trained with and without generative augmentations. The exams outside the normal range are the exams where at least one frame used in the calculation is outside the normal range of HUNT4 (depth $>150$mm or sector angle $>70^\circ$).}
    \label{fig: ef_main_text}
\end{figure*}



\FloatBarrier


\bibliographystyle{IEEEtran}

\bibliography{bibliography.bib}


\input{Sections/Appendix}



\end{document}
