% \documentclass[journal,draftclsnofoot,onecolumn,12pt]{IEEEtran}
 \documentclass[journal]{IEEEtran}

\usepackage{amsthm,amssymb,graphicx,multirow,amsmath,color,amsfonts}%,ulem}
% \usepackage[left=1.62cm,right=1.62cm,top=1.85cm,bottom=2.6cm]{geometry} % Useful for ICC and Globecom submissions if you are facing margins issues.
\usepackage[update,prepend]{epstopdf}
\usepackage[noadjust]{cite}
%\usepackage{ucs}
\usepackage[latin1]{inputenc}
\usepackage{tikz}
\usetikzlibrary{arrows,calc}		% Optional ticks libraries
\usepackage{bbm} % for \mathbbm{1}
\usepackage{pdfpages}
%\usepackage{flushend}
\usepackage{tabulary}
\usepackage{multirow}
\usepackage{comment}
\usepackage{subcaption}
% \usepackage{algorithm}
% \usepackage{algpseudocode}
\usepackage[linesnumbered,ruled,vlined]{algorithm2e}
\pdfoutput=1
\usepackage{svg}
\usepackage{enumitem,kantlipsum}
\usepackage{balance}
\usepackage{tabularx}
\usepackage{makecell}               % For wrapping text in cells (especially headers)
\usepackage{array}                  % For extended column definitions

% % Define Theorem and Corollary environments
% \newtheorem{theorem}{Theorem}
% \newtheorem{corollary}{Corollary}[theorem] % Numbered relative to theorems

% Colors
\def\chr#1{{\color{red}#1}}
\def\chb#1{{\color{blue} #1}}
\renewcommand{\chb}[1]{\textcolor{black}{#1}}
% \renewcommand{\chr}[1]{\textcolor{black}{#1}}

\everymath{\small} % Applies \small to inline math
% \DeclareMathSizes{10}{8}{6}{5} % Adjust display math sizes

\allowdisplaybreaks % Allows breaking of eqnarray over multiple pages (avoids unnecessary blanks in the document before eqnarray)
\include{notation}

\begin{document}
\graphicspath{{./figures/}}
\title{
% {\fontsize{22}{19}\selectfont A Novel Two-Stage Weighted Projection for Cooperative Localization: A New NLOS Bias Model}
% \chb{{\fontsize{22}{19}\selectfont A Novel Two-Stage Weighted Projection for Robust Cooperative Localization: Addressing NLOS Bias}}
% \chb{{\fontsize{22}{19}\selectfont A Novel Two-Stage Weighted Projection Method: Cooperative Localization and NLOS Bias Modeling}}
\chb{{\fontsize{20.8}{19}\selectfont Two-Stage Weighted Projection for Reliable Low-Complexity Cooperative and Non-Cooperative Localization}}
}
\author{
Harish K. Dureppagari, R. Michael Buehrer, Harpreet S. Dhillon
\thanks{H. K. Dureppagari, R. M. Buehrer, and H. S. Dhillon are with Wireless@VT, Department of ECE, Virginia Tech, Blacksburg, VA 24061, USA. Email: \{harishkumard, rbuehrer, hdhillon\}@vt.edu. The support of the US NSF (Grants CNS-1923807 and CNS-2107276) and the US NIST (Grant CAN-70NANB22H070) is gratefully acknowledged. This paper has been submitted in part to the IEEE ICC Workshop 2025, Montreal, Canada~\cite{dureppagari2025icc}.
}
\vspace{-1mm}
}

\maketitle
%\thispagestyle{empty}
%\pagestyle{empty}

\begin{abstract}
% In this paper, we present a novel two-stage weighted projection method (TS-WPM) for time-difference-of-arrival (TDOA)-based localization aimed at significantly enhancing positioning accuracy, particularly under challenging conditions such as high geometric dilution of precision (GDOP) or low signal-to-noise ratio (SNR). TS-WPM maintains computational efficiency through an iterative refinement mechanism that effectively mitigates residual errors. Moreover, we extend this approach to support cooperative localization. In addition, we perform a comprehensive analysis to obtain the covariance matrix for the proposed two-stage approach, offering insights into the optimality of the proposed scheme. Consequently, we derive mean square error (MSE) and compare it with the state-of-the-art weighted nonlinear least squares (WNLS) algorithm and demonstrate that, under non-ideal conditions, our two-stage approach consistently outperforms WNLS. To rigorously evaluate the proposed method, we develop a comprehensive 3rd Generation Partnership Project (3GPP) compliant analytical framework that incorporates the 5G New Radio (NR) physical layer aspects, along with large-scale and small-scale fading effects. As part of our analysis, we derive a generalized Cram{\'e}r-Rao lower bound (CRLB) to characterize both range and positioning error bounds in the presence of additive white Gaussian noise (AWGN) and multipath propagation. We further propose a novel modeling technique for non-line-of-sight (NLOS) bias induced by multipath, which accounts for underlying radio propagation characteristics and the prevailing SNR. Using the derived range errors, we conduct extensive Monte Carlo simulations to assess the performance of the proposed TS-WPM and benchmark it against the CRLB. Our results show that the proposed method consistently outperforms WNLS, particularly under adverse conditions like high GDOP and low SNR. Finally, we highlight the substantial accuracy improvements made possible by incorporating cooperative localization, underscoring the potential of TS-WPM for a wide range of real-world positioning applications.

In this paper, we propose a two-stage weighted projection method (TS-WPM) for time-difference-of-arrival (TDOA)-based localization, providing provable improvements in positioning accuracy, particularly under high geometric dilution of precision (GDOP) and low signal-to-noise ratio (SNR) conditions. TS-WPM employs a two-stage iterative refinement approach that dynamically updates both range and position estimates, effectively mitigating residual errors while maintaining computational efficiency. Additionally, we extend TS-WPM to support cooperative localization by leveraging two-way time-of-arrival (TW-TOA) measurements, which enhances positioning accuracy in scenarios with limited anchor availability. To analyze TS-WPM, we derive its error covariance matrix and mean squared error (MSE), establishing conditions for its optimality and robustness. To facilitate rigorous evaluation, we develop a 3rd Generation Partnership Project (3GPP)-compliant analytical framework, incorporating 5G New Radio (NR) physical layer aspects as well as large-scale and small-scale fading. As part of this, we derive a generalized Cram{\'e}r-Rao lower bound (CRLB) for multipath propagation and introduce a novel non-line-of-sight (NLOS) bias model that accounts for propagation conditions and SNR variations. Our evaluations demonstrate that TS-WPM achieves near-CRLB performance and consistently outperforms state-of-the-art weighted nonlinear least squares (WNLS) in high GDOP and low SNR scenarios. Moreover, cooperative localization with TS-WPM significantly enhances accuracy, especially when an insufficient number of anchors (such as 2) are visible. Finally, we analyze the computational complexity of TS-WPM, showing its balanced trade-off between accuracy and efficiency, making it a scalable solution for real-time localization in next-generation networks.
\end{abstract}

\begin{IEEEkeywords}
Two-stage weighted projection, low complexity positioning, cooperative localization, NLOS bias, TDOA, TOA, CRLB, two-way ranging.
\end{IEEEkeywords}
\section{Introduction}
Localization is an essential component for numerous applications spanning navigation, autonomous systems, the Internet of Things (IoT), and next-generation communication networks like 5G Advanced and 6G. Over the years, significant advancements have been made in positioning methodologies, leveraging techniques such as TOA and TDOA-based localization. Among these, sophisticated methods such as nonlinear least squares (NLS)~\cite{kay1993fundamentals} and weighted NLS (WNLS)~\cite{buehrer2019handbook}, along with optimization techniques like semi-definite programming (SDP)~\cite{6268731,8241388} and multidimensional scaling (MDS)~\cite{10.1145/1138127.1138129,5342507} and machine learning-based techniques~\cite{Bhatti2018MachineLB,tian2023highprecisionmachinelearningbasedindoor} are recognized for their increased accuracy. However, they tend to be computationally intensive. In contrast, parallel projection methods (PPMs)~\cite{5683693_toa_coop_mod_ippm,5677549_tao_coop_ippm} are noted for their computational efficiency by avoiding complex operations like matrix inversion but are inferior to methods like NLS~\cite{10632801_harish_dyspan}. Note that PPMs have traditionally been confined to TOA-based localization, while SDP, MDS, and NLS methods are applicable to both TOA and TDOA-based localization. TOA-based localization requires precise time synchronization between anchors and user equipment (UEs), as well as awareness of signal transmission time. Conversely, TDOA-based localization does not require precise synchronization between anchors and UEs, is more resilient to clock offsets, and is more robust to multipath propagation. As a result, TDOA-based localization is often preferred, making methods like NLS, WNLS, SDP, and MDS often desirable. However, these methods may not be computationally feasible, especially for scenarios such as edge location computing (e.g., augmented reality (AR)/virtual reality (VR), drone navigation, and emergency geolocation)~\cite{10329418,10.1007/s00521-021-06815-9}, UE-driven non-terrestrial networks (NTN) access~\cite{dureppagari_ntn_10355106,dureppagari2024leo}, and power- and bandwidth-limited devices~\cite{10634076}. 
%Driven by these challenges, this paper proposes a novel two-stage weighted projection method (TS-WPM) for cooperative localization aimed at enhancing positioning accuracy while maintaining computational efficiency. 
Motivated by these challenges, this paper proposes a novel two-stage weighted projection method (TS-WPM) for cooperative localization \chb{that provides provable gains in positioning accuracy while maintaining computational efficiency.} Our proposed approach is particularly effective in challenging scenarios such as low SNR or high GDOP environments.

\subsection{Related Work}\label{sec:related_work}
Localization algorithms have been extensively studied in the literature, with numerous efforts dedicated to developing low-complexity methods that enhance accuracy while maintaining computational efficiency. Specifically, the work in~\cite{ZHUO2024} introduced a low-complexity optimization technique for localization using successive greedy grid search and successive cancellation-list grid search to address a measurement-to-target association problem, while~\cite{5464262} provides a framework for a low-complexity least-squares algorithm that demonstrates improved accuracy; however, their performance remains comparable to NLS and falls short of more advanced approaches such as WNLS and optimization-based methods. Furthermore, in ~\cite{8947090_liu_weight_ippm, 8979252_liu_covar_ippm}, the authors introduced approaches for weighted PPM to enable enhanced cooperative localization, where the weights are determined using the gradient descent technique and the covariance of TOA measurements respectively. While these methods demonstrated promising results for TOA-based localization, they cannot be directly applied to TDOA-based scenarios. Further, they cannot be used if the TOA values are pseudo-range measurements, meaning they inherently include clock offsets and bias terms. In scenarios where there is no prior information on transmission time and bias offsets, such as clock offsets and non-line-of-sight (NLOS) bias, TOA values cannot be directly treated as noisy range measurements. Addressing these challenges, the authors in~\cite{10632801_harish_dyspan} proposed a reformulated version of IPPM to extend its applicability to TDOA-based localization. However, it is not straightforward to introduce suitable weighting mechanisms in PPMs to prevent overemphasizing or under-emphasizing specific TDOA measurements, particularly when certain anchor-to-UE links experience low SNR~\cite{dureppagari2025icc}. To overcome these limitations and achieve a balance between improved accuracy and computational feasibility, the current paper introduces a novel TS-WPM for robust cooperative localization. The proposed approach significantly enhances positioning accuracy, outperforming state-of-the-art approaches, including IPPM, NLS, and WNLS, while maintaining efficiency suitable for practical deployment. 
%Addressing these challenges, the authors in~\cite{dureppagari2025algo} proposed a reformulated version of IPPM to extend its applicability to TDOA-based localization. However, they also highlighted the difficulty of introducing suitable weighting mechanisms in PPMs to prevent overemphasizing or under-emphasizing specific TDOA measurements, particularly when certain anchor-to-UE links experience low SNR. To overcome these limitations and achieve a balance between improved accuracy and computational feasibility, this paper introduces a novel two-stage weighted projection method (TS-WPM) for robust cooperative localization. The proposed approach significantly enhances positioning accuracy, outperforming state-of-the-art approaches, including IPPM, NLS, and WNLS, while maintaining efficiency suitable for practical deployment.

\subsection{Contributions}\label{sec:contributions}
The main contributions of this paper are summarized as follows.
\begin{itemize}[wide, labelwidth=!, labelindent=0pt]
    \item \textbf{{\em Two-Stage Weighted Projection Method (TS-WPM):}} We propose a novel {\em TS-WPM} for TDOA-based localization, employing a two-stage iterative refinement process. In this approach, the range measurements associated with a reference anchor are iteratively estimated and leveraged to refine the location estimate and vice versa. This iterative refinement effectively mitigates residual errors, improving positioning accuracy, particularly under challenging conditions such as low SNR and high GDOP and equal performance everywhere else. Additionally, we extend TS-WPM to support {\em cooperative localization}, enabling target UEs to utilize internode measurements for accurate localization, especially when an inadequate number of anchors (such as 2) are visible.
    \item \textbf{{\em Optimality and Robustness of TS-WPM:}} We perform a thorough derivation of the {\em error covariance} of the proposed TS-WPM and establish its optimality in high SNR regimes. Furthermore, we compute the mean squared error (MSE) for both WNLS and TS-WPM, providing analytical proof that validates the superiority of TS-WPM over WNLS in non-ideal conditions, such as high GDOP and low SNR while demonstrating identical performance under favorable conditions, thereby highlighting the robustness of TS-WPM across diverse scenarios.
    \item \textbf{{\em 3GPP-Compliant Analytical Framework and NLOS Bias:}} To rigorously evaluate the proposed approach, we develop a {\em 3GPP-compliant system-level analytical framework} using CRLB as the principal tool. Specifically, we derive the CRLB for TOA, TDOA, and positioning error while accounting for the 5G physical layer aspects~\cite{3gpp::38211}, as well as large-scale~\cite{3gpp::36814} and small-scale fading effects~\cite{3gpp::38901}. Using the developed framework, we introduce a {\em novel NLOS bias modeling} approach that incorporates underlying propagation conditions and SNR. The derived TOA error models, along with the proposed NLOS bias model, are utilized to conduct extensive Monte Carlo simulations, enabling a more realistic performance evaluation.
\end{itemize}  
%The remainder of this paper is structured as follows. Section~\ref{sec:novel_ts_wpm} discusses the novel TS-WPM for TDOA localization and its extension to support cooperative localization. Section~\ref{sec:optimality_robustness_ts_wpm} presents a comprehensive analytical proof of the error covariance of TS-WPM, addressing its optimality and superiority over WNLS. Section~\ref{sec:analytical_eval_framework} describes a 3GPP-compliant analytical framework for evaluation and introduces a novel NLOS bias modeling. Section~\ref{sec:results_discussion} demonstrates the positioning performance of TS-WPM, comparing it with state-of-the-art approaches. Finally, Section~\ref{sec:conclusion} concludes the paper by summarizing the key findings.

\section{Novel Two-Stage Weighted Projection Method}\label{sec:novel_ts_wpm}
In this section, we introduce 1) the novel low-complexity TS-WPM, designed for improved accuracy, especially in challenging conditions such as low SNR or high GDOP, and 2) an extension of its framework to support cooperative localization, leveraging collaborative measurements to enhance accuracy in scenarios with limited visible anchors.

\subsection{Novel TS-WPM: TDOA Localization} \label{sec:novel_ts_wpm_tdoa}
To achieve a balance between improved accuracy and maintaining computational efficiency, we introduce a novel TS-WPM designed for TDOA-based localization. This new approach is particularly crucial for addressing the challenges associated with conditions such as high GDOP or low SNR regime. In this approach, we introduce additional variables to the estimation along with the target UE location. Specifically, we estimate the range or TOA between the reference anchor and the target UE, iteratively updating this estimate using the latest UE location. This updated range estimate is then utilized to refine the UE location estimate further. 

Consider a network of \(B\) anchors assisting a target UE to obtain pseudo-range or TOA measurements. Denoting pseudo-range measurements between an anchor \(b\) and a target UE by \(\hat{r}_b\) and assuming anchor \(1\) serves as the reference anchor, the TDOA measurements are defined as
\begin{align}
    \tilde{r}_b = \hat{r}_b - \hat{r}_1,\quad b \in \{2, 3, \cdots, B\}.\label{eq:noisy_tdoa}
\end{align}

The parameter vector to be estimated, denoted by \(\boldsymbol{\theta}\), comprises the target UE coordinates. Denoting an estimate of the location by \(\hat{\boldsymbol{\theta}}\), as part of TDOA-localization, we aim to minimize the TDOA residual error calculated as
\begin{align}
    \mathbf{R} \leftarrow \frac{1}{B-1} \sum_{b=2}^{B} \left(\tilde{r}_{b} - \tilde{r}_{b,e}(\hat{\boldsymbol{\theta}})\right)^2,
\end{align}
where \(\tilde{r}_{b,e}(\hat{\boldsymbol{\theta}})\) represents an estimate of TDOA associated with the anchor \(b\) calculated as 
\begin{align}
    \tilde{r}_{b,e}(\hat{\boldsymbol{\theta}}) = \|\hat{\boldsymbol{\theta}}-\mathbf{a}_b\| - \|\hat{\boldsymbol{\theta}}-\mathbf{a}_1\|,
    \label{eq:tdoa_est_method1}
\end{align}
where \(\mathbf{a}_b\) denotes the coordinates of the anchor \(b\).   
% In our proposed approach, we introduce a new parameter \(r_{1}\) to the parameter vector, along with the UE coordinates, where \(r_{1}\) facilitates an accurate estimation of the range between the reference anchor and the UE by mitigating residual errors. Consequently, we reformulate and rewrite the TDOA measurements from~\eqref{eq:noisy_tdoa} as
% \begin{align}
%     &\tilde{r}'_b = \hat{r}_b - r_1, \quad b \in \{1, 2, \cdots, B\}.
%     \label{eq:revised_noisy_tdoa}
% \end{align}
% % \begin{align}
% %     &\tilde{r}'_b = \tilde{r}_b +\hat{r}_1 - r_1, \quad b \in \{1, 2, \cdots, B\},
% %     \label{eq:revised_noisy_tdoa}
% % \end{align}

% \chb{It is essential to clarify that we are not introducing a new type of TDOA measurement. The conventional TDOA measurements in~\eqref{eq:noisy_tdoa} are reformulated, serving as the basis for the proposed approach. The proposed method continues to utilize conventional TDOA measurements while iteratively refining the UE location and the reference anchor range estimates.} Given \(r_{1}\), \(\tilde{r}'_b\) become independent across anchors and resemble TOA-like measurements. This also ensures that, given \(r_{1}\), \({\rm var}(\tilde{r}'_b)\) is essentially equal to \({\rm var}(\hat{r}_b)\). Denoting an estimate of \(r_1\) by \(\hat{r}_1^e\), the residual error we aim to minimize is reformulated as
% \begin{align}
%     \mathbf{R}' \leftarrow \frac{1}{B} \sum_{b=1}^{B} \left(\tilde{r}_{b} - \tilde{r}'_{b,e}(\hat{\boldsymbol{\theta}},\hat{r}_1^e)\right)^2,
% \end{align}
% where \(\tilde{r}_1 = 0\) corresponds to the reference anchor \(b=1\) and \(\tilde{r}'_{b,e}(\hat{\boldsymbol{\theta}},\hat{r}_1^e)\) represents a modified TDOA estimate as a function of \(\hat{\boldsymbol{\theta}}\) and \(\hat{r}_1^e\), and is defined as 
% \begin{align}
%     \tilde{r}'_{b,e}(\hat{\boldsymbol{\theta}},\hat{r}_1^e) = \|\hat{\boldsymbol{\theta}}-\mathbf{a}_b\| - \hat{r}_1^e.
%     \label{eq:tdoa_est_method2}
% \end{align}

% Consider a network of \(B\) anchors assisting a target UE to obtain pseudo-range (or TOA) measurements, denoted by \(\hat{r}_b\) for the \(b\)-th anchor. Let anchor \(1\) serve as the reference anchor. Conventional TDOA measurements then take the form
% \begin{align}
%     \tilde{r}_b = \hat{r}_b - \hat{r}_1,\quad b \in \{2, 3, \cdots, B\},
%     \label{eq:noisy_tdoa}
% \end{align}
% where \(\boldsymbol{\theta}\) and \(\hat{\boldsymbol{\theta}}\) represent the true and estimated UE coordinates, respectively. As part of TDOA-based localization, we aim to minimize the residual error
% \begin{align}
%     \mathbf{R} \leftarrow \frac{1}{B-1} \sum_{b=2}^{B}
%     \Bigl(\tilde{r}_{b} - \tilde{r}_{b,e}(\hat{\boldsymbol{\theta}})\Bigr)^2,
% \end{align}
% with
% \begin{align}
%     \tilde{r}_{b,e}(\hat{\boldsymbol{\theta}}) 
%     = \|\hat{\boldsymbol{\theta}}-\mathbf{a}_b\|
%       - \|\hat{\boldsymbol{\theta}}-\mathbf{a}_1\|.
%     \label{eq:tdoa_est_method1}
% \end{align}

% To enhance accuracy, we introduce a **new parameter** \(r_{1}\) along with the UE coordinates. This leads us to define
% \begin{align}
%     \tilde{r}'_b = \hat{r}_b - r_1,\quad b \in \{1, 2, \cdots, B\},
%     \label{eq:revised_noisy_tdoa}
% \end{align}
% where \(r_1\) is **not** directly known but is treated as an additional quantity to be estimated. The above expression does **not** replace the original TDOA measurement \(\tilde{r}_b\); rather, it sets up an **auxiliary formulation**. Given \(r_1\), \(\tilde{r}'_b\) become “TOA-like” measurements (each with variance matching \(\hat{r}_b\)), facilitating diagonal covariance and simplifying the subsequent analysis. In practice, we iteratively obtain an estimate \(\hat{r}_1^e\) and refine both \(\hat{\boldsymbol{\theta}}\) and \(\hat{r}_1^e\) while still relying on the original TDOA data. Hence, this “reformulation” does not alter the underlying measurement process but **augments** it with a convenient parameter \(r_1\), which allows us to minimize a new residual
% \begin{align}
%     \mathbf{R}' \leftarrow \frac{1}{B} \sum_{b=1}^{B}
%     \Bigl(\tilde{r}_{b} - \tilde{r}'_{b,e}(\hat{\boldsymbol{\theta}},\hat{r}_1^e)\Bigr)^2,
% \end{align}
% where \(\tilde{r}_1=0\) for the reference anchor, and
% \begin{align}
%     \tilde{r}'_{b,e}(\hat{\boldsymbol{\theta}},\hat{r}_1^e)
%     = \|\hat{\boldsymbol{\theta}}-\mathbf{a}_b\| - \hat{r}_1^e.
%     \label{eq:tdoa_est_method2}
% \end{align}

% It is important to note that this approach **still uses the original TDOA measurements** \(\tilde{r}_b\) for updating \(\hat{\boldsymbol{\theta}}\) and \(\hat{r}_1^e\). The auxiliary expression \(\tilde{r}'_b\) simply provides an alternate perspective that treats the reference-anchor range \(r_1\) as a parameter, enabling simpler covariance structures and a more flexible iterative procedure.
\chb{In our proposed approach, we introduce an additional parameter \(r_1\) in the estimation process alongside \(\boldsymbol{\theta}\), where \(r_1\) enables an accurate estimation of the range between the reference anchor and the UE, thereby reducing TDOA residual errors and improving the localization accuracy. To facilitate this, we define a new variable
\begin{align}
    \tilde{r}'_b = \hat{r}_b - \hat{r}_1^e, \quad b \in \{1, 2, \cdots, B\},
    \label{eq:revised_noisy_tdoa}
\end{align}
where \(\hat{r}_1^e\) is an estimate of \(r_1\), and unlike \(\hat{r}_1\), which is a pseudo-range, \(\hat{r}_1^e\) is intended to be an accurate estimate of the true range. Importantly, we are not modifying the actual TDOA measurements but rather introducing a new variable that serves as the basis for the proposed approach and the corresponding analytical study. The proposed method still uses conventional TDOA measurements to update UE location, residual error, and range estimates, but the analyses and refinement process are guided by \(\tilde{r}'_b\). Given \(\hat{r}_1^e\), \(\tilde{r}'_b\) become independent across anchors resembling TOA-like measurements. This ensures that, given \(\hat{r}_1^e\), \({\rm var}(\tilde{r}'_b)\) is essentially equal to \({\rm var}(\hat{r}_b)\).} \chb{To incorporate this refinement into the estimation process, we redefine the residual error to be minimized as  
\begin{align}
    \mathbf{R}' \leftarrow \frac{1}{B} \sum_{b=1}^{B} \left(\tilde{r}_{b} - \tilde{r}'_{b,e}(\hat{\boldsymbol{\theta}},\hat{r}_1^e)\right)^2,
\end{align}  
where \(\tilde{r}_1 = 0\) for the reference anchor (\(b=1\)), and \(\tilde{r}'_{b,e}(\hat{\boldsymbol{\theta}},\hat{r}_1^e)\) represents the refined TDOA estimate, computed as  
\begin{align}
    \tilde{r}'_{b,e}(\hat{\boldsymbol{\theta}},\hat{r}_1^e) = \|\hat{\boldsymbol{\theta}}-\mathbf{a}_b\| - \hat{r}_1^e.
    \label{eq:tdoa_est_method2}
\end{align}}We now discuss the significance of this new formulation and its advantages in simplifying the process of generating weights by avoiding the estimation of the full covariance matrix, as required in methods like WNLS~\cite{buehrer2019handbook}. As mentioned earlier, with \(\hat{r}_1^e\) available, the measurements described in~\eqref{eq:revised_noisy_tdoa} become independent of each other. As a result, the covariance matrix becomes a diagonal matrix, where the diagonal elements represent the variances of the different TOA equivalent measurements, as opposed to the non-diagonal covariance matrix we observe for the conventional TDOA measurements. Therefore, the new covariance matrix, denoted by \( \tilde{\boldsymbol{\Sigma}} \), takes the form
\begin{align}
\tilde{\boldsymbol{\Sigma}} = {\rm diag}({\rm var}(\tilde{r}'_1),\cdots,{\rm var}(\tilde{r}'_B)) = {\rm diag}({\rm var}(\hat{r}_1),\cdots,{\rm var}(\hat{r}_B)).
    \label{eq:revised_tdoa_covariance}
\end{align}

This newly defined covariance matrix \(\tilde{\boldsymbol{\Sigma}}\) is then utilized to generate weights for the proposed TS-WPM. A key advantage of this approach is the significant reduction in computational complexity, as it eliminates the need to estimate and invert the full covariance matrix. Since \(\tilde{\boldsymbol{\Sigma}}\) is a diagonal matrix, inverting it simply involves inverting the individual diagonal elements, which is computationally efficient. The weights are generated as
\begin{align}
    W_b = \frac{\frac{1}{{\rm var}(\hat{r}_b)}}{\sum_{i=1}^{B} \frac{1}{{\rm var}(\hat{r}_i)}}, \quad b = {1, 2, \cdots, B}.
    \label{eq:weights_novel_ppm}
\end{align}
\begin{algorithm}[htbp]
\small
% \LinesNumberedHidden
\captionsetup{font=small}
\caption{Novel TS-WPM for TDOA Localization}
\label{alg:novel_ts_wpm_tdoa}
\KwData{Initial UE estimate $\hat{\boldsymbol{\theta}}^0$, Initial range estimate $\hat{r}_1^{e,0}$, Convergence threshold $\epsilon$, Maximum consecutive iterations to terminate $l$, Weights $W_b$}
\KwResult{Final estimate $\hat{\boldsymbol{\theta}}$}
\SetAlgoNlRelativeSize{0}
\SetNlSty{}{}{)}
\DontPrintSemicolon

$\mathbf{R}^0 \leftarrow \frac{1}{B} \sum_{b=1}^{B} \left(\tilde{r}_b - \big(\|\hat{\boldsymbol{\theta}}^0-\mathbf{a}_b\| - \hat{r}_1^{e,0}\big)\right)^2$\;
$k \leftarrow 1$; $c \leftarrow 0$\;
\While{True}{    
    $\hat{\boldsymbol{\theta}}^k \leftarrow \sum_{b=1}^{B} W_b\left(\mathbf{a}_b + \left(\tilde{r}_b + \hat{r}_1^{e,k-1}\right)\frac{\hat{\boldsymbol{\theta}}^{k-1}-\mathbf{a}_b}{\|\hat{\boldsymbol{\theta}}^{k-1}-\mathbf{a}_b\|}\right)$\;\label{step:novel_ts_wpm_tdoa_loc_update}
    
    $\mathbf{R}^k \leftarrow \frac{1}{B} \sum_{b=1}^{B} \left(\tilde{r}_b - \left(\|\hat{\boldsymbol{\theta}}^k-\mathbf{a}_b\| - \hat{r}_1^{e,k-1}\right)\right)^2$\; \label{step:novel_ts_wpm_tdoa_res_err}
    
    \If{$|\mathbf{R}^k-\mathbf{R}^{k-1}| < \epsilon$}{
        $c \leftarrow c + 1$\;
        \If{$c \geq l$}{
            $\hat{\boldsymbol{\theta}} \leftarrow \hat{\boldsymbol{\theta}}^k$\;
            break\;
        }
    }
    \Else{
        $c \leftarrow 0$\;
    }
    % $\tilde{r}_1^k \leftarrow \tilde{r}_1^{k-1} -\frac{1}{B} \sum_{b=1}^{B} W_b\left(\tilde{r}_b - \left(\|\hat{\boldsymbol{\theta}}^{k-1}-\mathbf{a}_b\| - \tilde{r}_1^{k-1}\right)\right)$\;\label{step:novel_ts_wpm_toa_range_update}
    $\hat{r}_1^{e,k} \leftarrow \sum_{b=1}^{B} W_b\left(\|\hat{\boldsymbol{\theta}}^{k-1}-\mathbf{a}_b\| - \tilde{r}_b \right)$\;\label{step:novel_ts_wpm_toa_range_update}
    $k \leftarrow k + 1$\;
}
\end{algorithm}

The proposed novel TS-WPM is detailed in Algorithm~\ref{alg:novel_ts_wpm_tdoa}, where weights are applied during the updates of both the UE location estimates and the range estimates. As illustrated, the algorithm starts by initializing the UE location estimate, denoted by \(\hat{\boldsymbol{\theta}}^0\), which is usually assigned the coordinates of the nearest anchor, and the initial range estimate associated with the reference anchor, denoted by \(\hat{r}_1^{e,0}\), which is usually set to 0. At the \(k\)-th iteration, the UE location estimate, \(\hat{\boldsymbol{\theta}}^k\), is iteratively updated in step~\ref{step:novel_ts_wpm_tdoa_loc_update} using the previous location estimate, \(\hat{\boldsymbol{\theta}}^{k-1}\), along with the refined range estimate, \(\hat{r}_1^{e,k-1}\), obtained from iteration \(k-1\). Concurrently, the TDOA residual error is updated in step~\ref{step:novel_ts_wpm_tdoa_res_err} using the position estimate at the \(k\)-th iteration and the range estimate from the previous iteration. This range estimate is iteratively updated and accurately estimated in step~\ref{step:novel_ts_wpm_toa_range_update}, which, in turn, refines the UE location estimate in step~\ref{step:novel_ts_wpm_tdoa_loc_update} in the following iterations. This two-stage iterative process, by effectively mitigating the impact of bias offsets, including NLOS bias, leads to a continuous enhancement of positioning accuracy. This approach is particularly advantageous in scenarios with significant bias offsets, e.g., large NLOS bias and low SNR, where traditional methods struggle to maintain accuracy. 
%\chr{The two-stage iterative refinement process in TS-WPM has a conceptual resemblance to the principles of Turbo decoding~\cite{539767}, where extrinsic information is iteratively exchanged between two decoders to enhance error correction. Similarly, in the proposed TS-WPM, the iterative exchange of refined range estimates and UE location updates significantly improves positioning accuracy. However, unlike Turbo decoding, where the exchanged information is independent in terms of redundant parity, the information refined in the TS-WPM process is inherently correlated, as both range and location updates are derived from the same set of TDOA measurements.}
\chb{The two-stage iterative refinement in TS-WPM has a conceptual resemblance to Turbo decoding principles~\cite{539767}, where extrinsic information is exchanged between decoders to improve error correction. Similarly, in TS-WPM, refining range estimates and UE location updates iteratively improves positioning accuracy. However, unlike Turbo decoding, where exchanged information is independent in terms of redundant parity, the refined information in TS-WPM is correlated, as both updates are derived from the same set of TDOA measurements.}
%This two-stage refinement approach, coupled with its computational efficiency, results in a more robust and scalable approach for TDOA-based localization.

\subsection{Novel TS-WPM: Cooperative Localization} \label{sec:novel_wppm_coop}
In this section, we extend the novel TS-WPM approach described in Algorithm~\ref{alg:novel_ts_wpm_tdoa} to enable cooperative localization, where multiple target UEs leverage internode measurements to enhance positioning accuracy, especially when only a limited number of anchors (such as 2) are visible. In our cooperative localization framework, we assume that TDOA measurements are available between visible anchors and UEs, while TW-TOA measurements are utilized for inter-target UE measurements. In particular, modern positioning technologies such as sidelink positioning (SLP)~\cite{3gpp::38355} enable a wide range of measurement techniques, including TOA, angle of arrival (AOA), round--trip time (RTT), and TDOA, between target UEs. However, we specifically adopt TW-TOA for internode measurements for the following key reasons: 1) TW-TOA eliminates the need for precise synchronization among collaborating nodes~\cite{buehrer2019handbook}. 2) Many existing positioning technologies, such as ultra-wideband (UWB)~\cite{9810941} and WiFi-based localization~\cite{ibrahim2018verification}, predominantly rely on TW-TOA measurements for ranging. By utilizing TW-TOA for cooperative localization, our approach remains flexible and interoperable with different positioning technologies, facilitating seamless integration across various deployment scenarios.  3) The geometric configuration of collaborating target UEs is often suboptimal, particularly in indoor environments or clustered deployments. Relying on relative measurements such as TDOA in these cases can lead to significant localization errors due to high GDOP. By leveraging TW-TOA measurements instead, we improve localization robustness, especially in non-ideal geometries. %\chb{At the same time, TOA measurements require precise synchronization: UWB devices typically employ two-way ranging without needing a global clock, WiFi uses a fine timing measurement protocol, and SLP relies on either synchronization reference signals or a reference UE connected to the network to maintain stable timing information.}

The extended framework for cooperative localization is outlined in Algorithm~\ref{alg:novel_ts_wpm_coop}. As part of this, we aim to jointly localize all target UEs, denoted by \(N_u\). For each target UE \(n\), we define a set of cooperative nodes \(S_n\), with \(|S_n|\) denoting its cardinality. Furthermore, for each target UE \(n\), we begin by initializing location estimate \(\hat{\boldsymbol{\theta}}_n^0\), the reference anchor range estimate \(\tilde{r}_{1,n}^{e,0}\), and a flag \(F_n\) indicating whether the target UE is localized (\(F_n=1\)) or not (\(F_n=0\)), i.e., when the iterative loop converges for the target UE \(n\). In this formulation, \(\tilde{r}_{b,n}\) represents TDOA measurements between the anchor \(b\) and the target UE \(n\), while \(\hat{r}_{u,n}\) denotes TOA measurements between two cooperating UEs \(u\) and \(n\). Next, we iteratively refine the location estimates, residual errors, and the range measurements associated with the respective reference anchors. In step~\ref{step:novel_ts_wpm_coop_loc_update1} of the algorithm, each target UE location is updated based on TDOA measurements from visible anchors, employing weights \(W_b\). Step~\ref{step:novel_ts_wpm_coop_loc_update2} incorporates cooperative measurements between UEs in \(S_n\), applying weights \(W_u\). The weights \(W_u\) are generated similar to \(W_b\) as given in~\eqref{eq:weights_novel_ppm}. Residual errors are then updated in steps~\ref{step:novel_ts_wpm_coop_res_err1} and~\ref{step:novel_ts_wpm_coop_res_err2}. At convergence, the final estimate for the UE is updated, and \(F_n\) is set to 1, indicating convergence. This process continues for all UEs within the loop in step~\ref{step:for_loop_all_ues}, terminating once every \(F_n\) equals 1 (that is, all target UEs have been localized). Throughout this procedure, the range estimates \(\hat{r}_{1,n}^{e,k}\) in step~\ref{step:novel_ts_wpm_coop_range_update} are iteratively refined, further enhancing location accuracy.
\begin{algorithm}[t]
\small
% \LinesNumberedHidden
\captionsetup{font=small}
\caption{Novel TS-WPM for Cooperative Localization}
\label{alg:novel_ts_wpm_coop}
\KwData{Number of UEs \(N_u\), Initial UE estimates \(\left[\hat{\boldsymbol{\theta}}_1^0,\,\hat{\boldsymbol{\theta}}_2^0,\,\cdots, \hat{\boldsymbol{\theta}}_{N_u}^0\right]\), Initial range estimates for the corresponding reference anchors \(\left[\hat{r}_{1,1}^{e,0},\,\tilde{r}_{1,2}^{e,0},\cdots\tilde{r}_{1,N_u}^{e,0}\right]\), Convergence threshold \(\epsilon\), Maximum consecutive iterations to terminate \(l\), Weights \(W_b\), Weights \(W_u\), Initialize \(F_n=0, n = 1,2,\cdots,N_u\)}
\KwResult{Final estimate $\hat{\boldsymbol{\theta}}$}
\SetAlgoNlRelativeSize{0}
\SetNlSty{}{}{)}
\DontPrintSemicolon

$k \leftarrow 1$\;
\For{$n = 1$ \KwTo $N_u$}{
    $\mathbf{R}_n^0 \leftarrow \frac{1}{B} \sum_{b=1}^{B} \left(\hat{r}_{b,n} - \left(\|\hat{\boldsymbol{\theta}}_n^0-\mathbf{a}_b\| - \tilde{r}_{1,n}^0\right)\right)^2$\;
    $\mathbf{R}_n^0 \leftarrow \mathbf{R}_n^0 + \frac{1}{|S_n|} \sum_{u\in S_n}% \,\text{and}\, u\neq n}
    \left(\hat{r}_{u,n} - \left(\|\hat{\boldsymbol{\theta}}_n^0-\hat{\boldsymbol{\theta}}_u^0\|\right)\right)^2$\;
    }
    %\(\exists n \in \{1, \ldots, N_u\} \text{ such that } F_n = 0\)
    %$\text{n} = 1 : \text{N_u}$ $\text{n} = 1 : \text{N_u}$
\For{$n = 1$ \KwTo $N_u$}{\label{step:for_loop_all_ues}
\While{any $F_n = 0$ for $n = 1$ to $N_u$}{
    $\hat{\boldsymbol{\theta}}_n^k \leftarrow \frac{1}{B} \sum_{b=1}^{B} W_b\left(\mathbf{a}_b + \left(\tilde{r}_{b,n} + \hat{r}_{1,n}^{e,k-1}\right)\frac{\hat{\boldsymbol{\theta}}_n^{k-1}-\mathbf{a}_b}{\|\hat{\boldsymbol{\theta}}_n^{k-1}-\mathbf{a}_b\|}\right)$\;\label{step:novel_ts_wpm_coop_loc_update1}

    $\hat{\boldsymbol{\theta}}_n^k \leftarrow \hat{\boldsymbol{\theta}}_n^k + \frac{1}{|S_n|} \sum_{u\in S_n} W_u\left(\hat{\boldsymbol{\theta}}_u^{k-1} + \hat{r}_{u,n}\frac{\hat{\boldsymbol{\theta}}^{k-1}-\hat{\boldsymbol{\theta}}_u^{k-1}}{\|\hat{\boldsymbol{\theta}}^{k-1}-\hat{\boldsymbol{\theta}}_u^{k-1}\|}\right)$\;\label{step:novel_ts_wpm_coop_loc_update2}
    
    $\mathbf{R}_n^k \leftarrow \frac{1}{B} \sum_{b=1}^{B} \left(\tilde{r}_{b,n} - \left(\|\hat{\boldsymbol{\theta}}_n^k-\mathbf{a}_b\| - \hat{r}_{1,n}^{e,k-1}\right)\right)^2$\; \label{step:novel_ts_wpm_coop_res_err1}

    $\mathbf{R}_n^k \leftarrow \mathbf{R}_n^k + \frac{1}{|S_n|} \sum_{u\in S_n} \left(\hat{r}_{u,n} - \left(\|\hat{\boldsymbol{\theta}}_n^k-\hat{\boldsymbol{\theta}}_u^{k-1}\|\right)\right)^2$\; \label{step:novel_ts_wpm_coop_res_err2}
    
    \If{$|\mathbf{R}_n^k-\mathbf{R}_n^{k-1}| < \epsilon$}{
        $C_n \leftarrow C_n + 1$\;
        \If{$c \geq l$}{
            $\hat{\boldsymbol{\theta}}_n \leftarrow \hat{\boldsymbol{\theta}}_n^k$\;
            break\;
        }
    }
    \Else{
        $c \leftarrow 0$\;
    }
    $\hat{r}_{1,n}^{e,k} \leftarrow \frac{1}{B} \sum_{b=1}^{B} W_b\left(\|\hat{\boldsymbol{\theta}}_n^{k-1}-\mathbf{a}_b\| - \tilde{r}_{b,n} \right)$\;\label{step:novel_ts_wpm_coop_range_update}
    $k \leftarrow k + 1$\;
}
}
\end{algorithm}

% \section{Novel TS-WPM vs WNLS: Analytical Comparison}\label{sec:ts_wpm_vs_wnls_anal_comp}
\section{Optimality and Robustness of TS-WPM: Analytical Study}\label{sec:analytical_study_tswpm}
In this section, we present a comprehensive analytical proof demonstrating the conditions under which the proposed two-stage approach is optimal and when it outperforms WNLS. To achieve this, we first derive the error covariance matrix for the novel TS-WPM by using the alternative formulation outlined in~\eqref{eq:revised_noisy_tdoa} as basis. We then compare it with the error covariance for the two-stage estimation employing the maximum likelihood estimation (MLE) as described in~\cite{murphy_topel} and discuss the optimality of the proposed TS-WPM. Afterward, we derive the error covariance employing WNLS for the conventional TDOA formulation given in~\eqref{eq:noisy_tdoa}. Subsequently, we derive and compare the MSE for both methods, TS-WPM and WNLS, discussing the conditions under which TS-WPM surpasses WNLS. Additionally, we provide an alternative mathematical intuition to elucidate why TS-WPM outperforms WNLS by comparing the normalization factors used in both methods alongside the enhanced accuracy that the two-stage approach offers. As a foundation for this analysis, we begin by introducing key preliminaries, including a discussion of conventional and alternative TDOA formulations and the derivation of the Fisher Information Matrix (FIM) for both methods, which we will use later in the analysis.

\subsection{Key Preliminaries}\label{sec:fim_conv_reform_tdoa}%FIM: Conventional and Reformulated TDOA}
{\em Method 1: Conventional TDOA Formulation. } The conventional TDOA measurements are as given in~\eqref{eq:noisy_tdoa}. Defining the TDOA measurement vector as \(\tilde{\mathbf{r}} = [\tilde{r}_2, \dots, \tilde{r}_B]^T\) and the variance of \(\hat{r}_b\) as \(\sigma_b^2\), the covariance matrix of \(\tilde{\mathbf{r}}\) is given by
\begin{align}
  \mathbf{C}_1 = \mathrm{diag}([\sigma_2^2, \dots, \sigma_B^2]) + \sigma_1^2 \mathbf{u}\mathbf{u}^T,
  \label{eq:cov_tdoa_scen1}
\end{align}  
where \(\mathbf{u}\) is a \((B-1) \times 1\) vector of ones, capturing the correlation induced by the common reference measurement \(\hat{r}_1\). Assuming 2D estimation, we define the parameter vector with UE coordinates as \(\boldsymbol{\theta}=[x,y]\). The Jacobian matrix of \(\tilde{\mathbf{r}}\) with respect to \(\boldsymbol{\theta}\) is expressed as  
\begin{align}
  \mathbf{H}_1 = \begin{bmatrix}
  \frac{x - x_2}{d_2} - \frac{x - x_1}{d_1} & \frac{y - y_2}{d_2} - \frac{y - y_1}{d_1} \\
  \vdots & \vdots \\
  \frac{x - x_B}{d_B} - \frac{x - x_1}{d_1} & \frac{y - y_B}{d_B} - \frac{y - y_1}{d_1}
  \end{bmatrix}.
  \label{eq:jacobian_tdoa}
\end{align}  

With this formulation, the FIM for \(\hat{\mathbf{r}}\) is expressed as  
\begin{align}
  \mathbf{F}_1 = \mathbf{H}_1^T \mathbf{C}_1^{-1} \mathbf{H}_1.
  \label{eq:fim_tdoa_scen1}
\end{align}

{\em Method 2: Alternative TDOA Formulation.} As outlined in Section~\ref{sec:novel_ts_wpm_tdoa}, we introduce an additional parameter \(r_1\) to the parameter vector. Considering 2D estimation, the parameter vector is defined as \(\boldsymbol{\theta}_2 = [\boldsymbol{\theta},r_1] = [x,y,r_1]\), where \(r_1\) facilities an accurate range estimation associated with the reference anchor. To incorporate the estimate of \(r_1\), we define an alternative TDOA formulation as given in~\eqref{eq:revised_noisy_tdoa}, and the corresponding covariance matrix is of the form  
\begin{align}
  \mathbf{C}_2 = \mathrm{diag}([\sigma_1^2, \dots, \sigma_B^2]).
  \label{eq:cov_tdoa_scen2}
\end{align}  

Denoting a vector of alternative TDOA measurements by \(\tilde{\mathbf{r}}'\), the Jacobian matrix of \(\tilde{\mathbf{r}}'\) with respect to \(\boldsymbol{\theta}_2\) is then defined as
\begin{align}
    \mathbf{H}_2 = [\mathbf{H}_t\, \mathbf{v}],
    \label{eq:jacobian_pseudo_toa}
\end{align}
where \(\mathbf{H}_t\) is given by  
\begin{align}
    \mathbf{H}_t = \begin{bmatrix}
    \frac{x - x_1}{d_1} \cdots \frac{x - x_B}{d_B}\\
      \frac{y - y_1}{d_1} \cdots \frac{y - y_B}{d_B}
    \end{bmatrix}^T,
    \label{eq:jacobian_toa}
\end{align}  
and \(\mathbf{v}\) is a \(B\times 1\) vector of ones.

The FIM for \(\tilde{\mathbf{r}}\) is given by
\begin{align}
  \mathbf{F}_2 = \mathbf{H}_2^T \mathbf{C}_2^{-1} \mathbf{H}_2.
  \label{eq:fim_tdoa_scen2}
\end{align}

Expanding \(\mathbf{F}_2\) in~\eqref{eq:fim_tdoa_scen2}, we obtain
\begin{align}
    \mathbf{F}_2 = \begin{bmatrix}
    \mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{H}_t & -\mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{v}\\
    -\mathbf{v}^T\mathbf{C}_2^{-1}\mathbf{H}_t & \mathbf{v}^T\mathbf{C}_2^{-1}\mathbf{v}
    \end{bmatrix}.
\end{align}  

Applying Schur complement~\cite{MoeYuanP12010}, we derive the effective FIM for the position parameter \(\boldsymbol{\theta}=[x,y]\) as
\begin{align}
    \mathbf{F}_{2,[x,y]}=\mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{H}_t - \mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{v}\left(\mathbf{v}^T\mathbf{C}_2^{-1}\mathbf{v}\right)^{-1}\mathbf{v}^T\mathbf{C}_2^{-1}\mathbf{H}_t,
    \label{eq:efim_tdoa_scen2}
\end{align}
where \(\mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{v}\left(\mathbf{v}^T\mathbf{C}_2^{-1}\mathbf{v}\right)^{-1}\mathbf{v}^T\mathbf{C}_2^{-1}\mathbf{H}_t\) is the loss of information introduced due to estimating \(r_1\). Not surprisingly, both formulations in~\eqref{eq:noisy_tdoa} and~\eqref{eq:revised_noisy_tdoa} contain the same amount of information, i.e., \(\mathbf{F}_1=\mathbf{F}_{2,[x,y]}\), resulting in identical CRLB.

\subsection{Optimality and Robustness of TS-WPM}\label{sec:optimality_robustness_ts_wpm}
We now apply the proposed TS-WPM for Method 2, which uses a two-stage iterative refinement approach, as outlined in Algorithm~\ref{alg:novel_ts_wpm_tdoa}. \chb{Notably, TS-WPM is designed to iteratively minimize residual errors, ensuring convergence, which is also observed in methods like WNLS.} Assuming convergence, the final estimate can be approximated as
\begin{align}
\hat{\boldsymbol{\theta}}_{\mathrm{tswpm}} = \boldsymbol{\theta} + (\mathbf{H}_2(\boldsymbol{\theta}))^T\mathbf{W}_2\big(\tilde{\mathbf{r}} - \tilde{\mathbf{r}}'_e(\boldsymbol{\theta},r_1)\big),
\label{eq:nwpm_final_est}
\end{align}
where \( \boldsymbol{\theta} \) is the true position parameter, \(\mathbf{H}_2(\boldsymbol{\theta})\) is the Jacobian matrix of \(\tilde{\mathbf{r}}\) with respect to \(\boldsymbol{\theta}\) and is equal to \(\mathbf{H}_2\) as given in~\eqref{eq:jacobian_pseudo_toa}, \(\tilde{\mathbf{r}}'_e(\boldsymbol{\theta},r_1)\) is a vector of TDOA estimates as a function of \(\boldsymbol{\theta}\) and \(r_1\) as given in~\eqref{eq:tdoa_est_method2}, and the weight matrix \(\mathbf{W}_2\) is defined as \(\mathbf{W}_2 = \frac{\mathbf{C}_2^{-1}}{{\rm trace}(\mathbf{C}_2^{-1})}\), where \(\frac{1}{{\rm trace}(\mathbf{C}_2^{-1})}\) serves as a normalization factor to prevent overemphasizing or under-emphasizing certain measurements. We now derive the error covariance and MSE of TS-WPM.
\chb{\begin{lemma}[Error Covariance and MSE of TS-WPM]\label{lemma::cov::mse::tswpm}
The error covariance of TS-WPM, denoted by \({\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{tswpm}}-\boldsymbol{\theta})\), and its MSE, denoted by \({\rm MSE}_{\mathrm{tswpm}}\), can be obtained as:
\begin{align}
    {\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{tswpm}}-\boldsymbol{\theta}) = & \frac{1}{\left({\rm trace}(\mathbf{C}_2^{-1})\right)^2}\left(\mathbf{H}_2^T\mathbf{C}_2^{-1}\mathbf{H}_2\right),\label{eq:cov_tswpm_main}\\
    {\rm MSE}_{\mathrm{tswpm}} = & \frac{1}{\left({\rm trace}(\mathbf{C}_2^{-1})\right)^2}\sum_{i=1}^K\lambda_i\left(\mathbf{F}_{2,[x,y]}\right),  
    \label{eq:mse_tswpm_main}
\end{align}
where \(\mathbf{C}_2\), \(\mathbf{H}_2\), and \(\mathbf{F}_{2,[x,y]}\) are as given in~\eqref{eq:cov_tdoa_scen2}, ~\eqref{eq:jacobian_pseudo_toa}, and~\eqref{eq:efim_tdoa_scen2}, respectively, and \(\lambda_i\left(\mathbf{F}_{2,[x,y]}\right)\) denotes the eigenvalues of \(\mathbf{F}_{2,[x,y]}\).
\end{lemma}
\begin{IEEEproof} 
See Appendix~\ref{app::cov::mse::tswpm}.
\end{IEEEproof}
This result will be further used in subsequent analyses discussing the optimality and robustness of TS-WPM.} 

\chb{We now establish that TS-WPM approaches MLE in a high SNR regime.
\begin{theorem}[Optimality of TS-WPM]\label{thm::optimality::tswpm}
Consider a two-stage estimation framework where the first-stage estimate refines the second-stage estimate, similar to the approach described in Algorithm~\ref{alg:novel_ts_wpm_tdoa}, where the reference anchor range is accurately estimated in the first stage, which enhances the UE location estimate in the second stage. Suppose \(\sigma_1^2 \to 0\), i.e., the SNR of the reference anchor tends to infinity. Then, 
\begin{align}
    \mathrm{cov}\bigl(\hat{\boldsymbol{\theta}}_{\mathrm{tswpm}} - \boldsymbol{\theta}\bigr)
    ~\longrightarrow~
    \boldsymbol{\Sigma}_{\boldsymbol{\theta}}^{\mathrm{MLE}},
\end{align}
where \(\boldsymbol{\Sigma}_{\boldsymbol{\theta}}^{\mathrm{MLE}}\) is the error covariance of MLE. In other words, TS-WPM is asymptotically optimal in a high SNR regime.
\end{theorem}
\begin{IEEEproof} 
See Appendix~\ref{app::optimality::tswpm}.
\end{IEEEproof}}

\chb{To compare the performance of TS-WPM and WNLS, we derive the error covariance and MSE of WNLS by applying WNLS to Method 1.
\begin{lemma}[Error Covariance and MSE of WNLS]\label{lemma::cov::mse::wnls}
The error covariance of WNLS, denoted by \({\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{wnls}}-\boldsymbol{\theta})\), and its MSE, denoted by \({\rm MSE}_{\mathrm{wnls}}\), are given by:
\begin{align}
    {\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{wnls}}-\boldsymbol{\theta}) =& \left(\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1\right)^{-1},\label{eq:cov_wnls_main}\\
    {\rm MSE}_{\mathrm{wnls}} = & \sum_{i=1}^K \frac{1}{\lambda_i\left(\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1\right)},  
    \label{eq:mse_wnls_main}
\end{align}
where \(\mathbf{C}_1\), \(\mathbf{H}_1\) are as given in~\eqref{eq:cov_tdoa_scen1} and ~\eqref{eq:jacobian_tdoa}, respectively, and \(\lambda_i\left(\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1\right)\) denotes the eigenvalues of \(\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1\).
\end{lemma}
\begin{IEEEproof} 
See Appendix~\ref{app::cov::mse::wnls}.
\end{IEEEproof}}

\chb{Using Lemma~\ref{lemma::cov::mse::tswpm} and Lemma~\ref{lemma::cov::mse::wnls}, we now establish the robustness of TS-WPM.
\begin{prop}[Robustness of TS-WPM]\label{prop::robustness::tswpm}
Under non-ideal conditions such as high GDOP scenarios, the MSE of TS-WPM and WNLS can be approximated as
\begin{align}
    \mathrm{MSE}_{\mathrm{tswpm}} &\approx \frac{1}{\sum_{b=1}^B \frac{1}{\sigma_b^2}}, 
    \label{eq:mse_tswpm_approx}\\
    \mathrm{MSE}_{\mathrm{wnls}} &\approx \frac{1}{\lambda_{\min}\bigl(\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1\bigr)},
    \label{eq:mse_wnls_approx}
\end{align}
where $\sigma_b^2$ is the variance of the alternative TDOA measurement $\tilde{r}_b'$ in \eqref{eq:revised_noisy_tdoa}, and $\lambda_{\min}\bigl(\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1\bigr)$ denotes the smallest eigenvalue of $\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1$. Consequently, in high GDOP regimes, we have $\mathrm{MSE}_{\mathrm{tswpm}} < \mathrm{MSE}_{\mathrm{wnls}}$, demonstrating that the proposed TS-WPM outperforms WNLS under non-ideal conditions.
\end{prop}
\begin{IEEEproof}
See Appendix~\ref{app::robustness::tswpm}.
\end{IEEEproof}}


\subsection{Alternative Intuition: Robustness of TS-WPM}\label{sec:alt_math_intuition}
In WNLS, we have the normalization factor taking the form \(\left(\mathbf{H}_1^T\mathbf{W}_1\mathbf{H}_1\right)^{-1}\), where \(\mathbf{W}_1\) is an inverse of the covariance matrix. If \(\mathbf{H}_1^T\mathbf{W}_1\mathbf{H}_1\) is ill-conditioned (often observed in high GDOP scenarios), direct inversion can lead to numerical instability and excessively large step sizes for certain TDOA measurements, resulting in overshooting. To understand this, consider the eigendecomposition. Since \(\mathbf{H}_1^T\mathbf{W}_1\mathbf{H}_1\) is a symmetric matrix and \(\mathbf{W}_1\) is symmetric and positive semi-definite, it can be diagonalized as
\begin{align}
    \mathbf{H}_1^T\mathbf{W}_1\mathbf{H}_1 = \mathbf{U}\boldsymbol{\Lambda} \mathbf{U}^T,
\end{align}
where \(\mathbf{U}\) is an unitary matrix and \(\boldsymbol{\Lambda}\) is a diagonal matrix containing eigenvalues \(\lambda_i\) of \(\mathbf{H}_1^T\mathbf{W}_1\mathbf{H}_1\). Then, the inverse is given by
\begin{align}
    \left(\mathbf{H}_1^T\mathbf{W}_1\mathbf{H}_1\right)^{-1} = \mathbf{U}\boldsymbol{\Lambda}^{-1} \mathbf{U}^T.
\end{align}

For an ill-conditioned matrix, \(\boldsymbol{\Lambda}^{-1}\) amplifies directions with small \(\lambda_i\), leading to large updates and overshooting. A computationally stable alternative is to normalize the location update using
\begin{align}
    \alpha = \frac{1}{\text{trace}\left(\mathbf{H}_1^T\mathbf{W}_1\mathbf{H}_1\right)},
    \label{eq:alt_normalization}
\end{align}
which scales the TDOA measurements based on the sum of eigenvalues, reducing sensitivity to small \(\lambda_i\). This approach mitigates numerical instability while maintaining effective convergence. Note that, in the proposed approach outlined in Algorithm~\ref{alg:novel_ts_wpm_tdoa} and~\eqref{eq:nwpm_final_est}, we use a variant of~\eqref{eq:alt_normalization} by using \(\frac{1}{{\rm trace}(\mathbf{C}_2^{-1})}\) as a normalization factor. This, in addition to the two-stage refinement process, results in the proposed approach providing superior performance to WNLS, particularly in challenging conditions such as high GDOP. Our evaluations also show that, in low SNR conditions under multipath propagation, the proposed TS-WPM surpasses WNLS, which we discuss in detail in Section~\ref{sec:results_discussion}.
%Based on the analysis conducted, we conclude that in a high SNR regime, the proposed TS-WPM approaches MLE and is {\em asymptotically optimal}. Additionally, under non-ideal conditions such as high GDOP, it outperforms WNLS. 

\section{Analytical Evaluation Framework}\label{sec:analytical_eval_framework}
In this section, we develop a comprehensive analytical framework to evaluate the proposed TS-WPM, accounting for the effects of multipath propagation and AWGN. The CRLB serves as the principal tool for this framework. %While existing works on CRLB analysis~\cite{MoeYuanP12010,QiKo2006,6427618,dureppagari_uav1_10139944,4753258} provide valuable insights into the best achievable TOA error and positioning accuracy under AWGN, they exhibit significant limitations in addressing NLOS channels. 
For line-of-sight (LOS) channels, the CRLB for TOA and position error has been well-documented, with accurate closed-form expressions readily available~\cite{MoeYuanP12010,4753258}. However, analysis for NLOS channels presents substantial challenges. A common approach is to incorporate a Gamma-distributed NLOS bias into the analysis~\cite{QiKo2006,6427618,dureppagari_uav1_10139944}, which lacks a functional relationship with the underlying radio propagation conditions and the physical layer aspects. %While this method provides a closed-form CRLB expression, it suffers from a critical limitation: the parameters of the Gamma distribution lack a functional relationship with the underlying radio propagation conditions and the physical layer aspects. 
This limitation makes this approach impractical when we consider a system model that accounts for large-scale fading, small-scale fading, and physical layer aspects, e.g., positioning reference signal (PRS) configurations. To address these shortcomings, we propose an analytical framework capable of determining the best achievable TOA error and positioning accuracy in the presence of multipath propagation. It is important to note that this framework does not aim to mitigate the effects of NLOS bias or multipath. Instead, it aims to characterize the best achievable performance under these conditions. To this end, we first derive the CRLB for TOA estimation between an anchor \(b\) and a target UE without loss of generality. We then extend this analysis to derive the CRLB for position estimates of the target UE based on TOA and TDOA measurements. Additionally, we derive the CRLB of TOA under AWGN as a special case of the multipath scenario. Furthermore, using the developed analytical framework, we propose a novel approach to model NLOS bias. This approach leverages detailed link characteristics, including physical layer parameters, large-scale fading, and small-scale fading, to accurately capture the bias induced by multipath propagation. By incorporating these elements, our approach ensures a more realistic and practical representation of NLOS effects, effectively bridging the gap between theoretical models and real-world scenarios.

\subsection{CRLB Analysis: CIR and AWGN}\label{sec:crlb_toa_cir_awgn}
% \subsection{CRLB Analysis \& NLOS Bias Model}\label{sec:crlb_nlos_bias}
% In this section, we derive the CRLB for the TOA error in the presence of multipath propagation. As a special case of this, we also present the derivation of the CRLB for TOA error under the AWGN channel. Furthermore, we extend this derivation to calculate the positioning error for both TOA and TDOA-based localization techniques. We begin our analysis with the baseband received signal sampled at a rate of \(\frac{1}{T_s}\). Let \(\mathcal{N}_{b} = \{1, 2, \ldots, B\}\) represent the set of anchor nodes assigned to the target UE for positioning reference signal (PRS) transmission. A single PRS occasion refers to the time interval (e.g., one slot) during which the UE receives all PRSs from the anchors in \(\mathcal{N}_{b}\). PRS resources from different anchors can be multiplexed in both time and frequency within a slot. Specifically, this multiplexing uses a comb structure, which distributes the PRS symbols from an anchor across multiple OFDM symbols over time~\cite{3gpp::38211}. In this configuration, we assume that the UE can coherently combine multiple PRS symbols over time. Within one PRS occasion, the time domain received signal between anchor $b$ and the target UE can be represented in matrix form as
% \begin{align}
%     \boldsymbol{r}_b =  \sqrt{P_b} \boldsymbol{F}^H  \boldsymbol{X}_b  \boldsymbol{\Gamma_b}  \boldsymbol{F}_L \boldsymbol{h}_b + \boldsymbol{v},\quad b\in\mathcal{N}_{b},
%     \label{eq:rxd_sgl_mat_form}
% \end{align}
% where \(P_b\) is the received power, $\boldsymbol{r}_b$ denotes the time-domain received PRS signal of length $N$, $\boldsymbol{v}\sim {\cal CN}({\bf 0},\sigma^2 {\bf I})$ represents additive white Gaussian noise (AWGN), \(\boldsymbol{X}_b = {\rm diag}\left(x_{\left(-\frac{N}{2}\right)}^b,\cdots,x_{\left(\frac{N}{2}-1\right)}^b\right)\) is a diagonal matrix of size \(N\times N\) with transmitted PRS symbols as its diagonal elements, $\boldsymbol{h}_b = \left[h_{b,0}\cdots h_{b, L-1}\right]^T$ is the observed channel impulse response (CIR) between anchor $b$ and the target UE of length \(L\), $\boldsymbol{F}_L$ is a Discrete Fourier Transform (DFT) matrix of size $N\times L$, while $\boldsymbol{F}^H$ is an inverse DFT (IDFT) matrix of size $N\times N$. Note that each delay tap of $\boldsymbol{h}_b$ translates to a phase ramp in the frequency domain, which is captured in 
% \begin{align}
%     \boldsymbol{\Gamma} = {\rm diag}\left(e^{-j2\pi\nabla f\tau_{d,b}(-\frac{N}{2})}\ldots e^{-j2\pi\nabla f\tau_{d,b}(\frac{N}{2}-1)}\right),\notag
% \end{align}
% where \(\nabla f\) denotes the sub-carrier spacing (SCS).
In this section, we derive the CRLB for TOA error in the presence of multipath propagation. As a special case of this, we also derive the CRLB for TOA error under AWGN. Let \(\mathcal{N}_{b} = \{1, 2, \ldots, B\}\) represent the set of anchors assigned to a target UE for PRS transmission. The time domain orthogonal frequency division multiplexing (OFDM) received signal between anchor \(b\) and the target UE can be represented in matrix form as
\begin{align}
    \boldsymbol{r}_b =  \sqrt{P_b} \boldsymbol{F}^H  \boldsymbol{X}_b  \boldsymbol{\Gamma_b}  \boldsymbol{F}_L \boldsymbol{h}_b + \boldsymbol{v},\quad b\in\mathcal{N}_{b},
    \label{eq:rxd_sgl_mat_form}
\end{align}
where $\boldsymbol{r}_b$ denotes the time-domain received PRS signal of length $N$, \(P_b\) is the received power, $\boldsymbol{v}\sim {\cal CN}({\bf 0},\sigma^2 {\bf I})$ represents AWGN, \(\boldsymbol{X}_b\) represents transmitted PRS symbols, $\boldsymbol{h}_b$ is the observed channel impulse response (CIR) between anchor \(b\) and the target UE of length \(L\), $\boldsymbol{F}_L$ is a Discrete Fourier Transform (DFT) matrix of size $N\times L$, while $\boldsymbol{F}^H$ is an inverse DFT (IDFT) matrix of size $N\times N$. Note that each delay tap of $\boldsymbol{h}_b$ translates to a phase ramp in the frequency domain, which is captured in 
\begin{align}
    \boldsymbol{\Gamma} = {\rm diag}\left(e^{-j2\pi\nabla f\tau_{d,b}(-\frac{N}{2})}\ldots e^{-j2\pi\nabla f\tau_{d,b}(\frac{N}{2}-1)}\right),\notag
\end{align}
where \(\nabla f\) denotes the sub-carrier spacing (SCS) and \(\tau_{d,b}\) is the propagation delay, determining TOA between anchor \(b\) and the target UE. 

We now present the CRLB of TOA estimation between the target UE and anchor \(b\) as follows. 
\begin{theorem}[CRLB of TOA for Multipath]\label{thm::CRB::TOA::Coh::Comb}
Denoting the TOA estimate as $\hat{\tau}_{d,b}$, the variance of the TOA estimate between the target UE and anchor \(b\) can be lower-bounded as:
\begin{align}
    & {\rm var}(\hat{\tau}_{d,b}) \geq  \mathbb{I}_{e,\theta_{\hat{\tau}}^b}^{-1},\label{eq:cirbasedcrlb_toa}
\end{align}
where vector parameter $\theta_{\hat{\tau}}^b$ comprises $\tau_{d,b}$ and $\boldsymbol{h}_b$ to facilitate the joint estimation of TOA and channel state information (CSI) and $\mathbb{I}_{e,\theta_{\hat{\tau}}^b}$ is the effective FIM (EFIM) representing TOA information. EFIM \(\mathbb{I}_{e,\theta_{\hat{\tau}}^b}\) can be derived as
\begin{align}
    \mathbb{I}_{e,\theta_{\hat{\tau}}^b} & = 2\gamma_b{\boldsymbol{h}_b}^H \boldsymbol{F}_L^H {\boldsymbol{X}_b}^H \boldsymbol{D} \boldsymbol{\Xi}_b \boldsymbol{D} {\boldsymbol{X}_b} \boldsymbol{F}_L \boldsymbol{h}_b,\label{eq:coherent_fim}\\
    \boldsymbol{\Xi}_b & = \boldsymbol{I}_N-\boldsymbol{X}_b \boldsymbol{F}_L \big(\boldsymbol{F}_L^H {\boldsymbol{X}_b}^H \boldsymbol{X}_b \boldsymbol{F}_L\big)^{-1}\boldsymbol{F}_L^H {\boldsymbol{X}_b}^H,\label{eq:Xi_fim}
\end{align}
where \(\gamma_b = \frac{P_b}{\sigma^2}\) is the SNR of the received signal, $\boldsymbol{D}={\rm diag}\big(2\pi\nabla f(-\frac{N}{2}),\dots, 2\pi\nabla f(\frac{N}{2}-1)\big)$, and \(\boldsymbol{I}_N\) is the identity matrix of size \(N\times N\).
\end{theorem}
\chb{Due to space constraints, we cannot provide detailed proof in this paper. A proof sketch can be found in one of our previous conference papers~\cite{10632801_harish_dyspan}.}

% We now derive the variance of the TOA estimate for an AWGN channel, i.e., the LOS scenario, as a special case of Theorem~\ref{thm::CRB::TOA::Coh::Comb}. For the AWGN channel, the CIR \(\boldsymbol{h}_b\) in~\eqref{eq:coherent_fim} reduces to a single path. We assume complex symbols for PRS generation, e.g., the diagonal elements of \(\boldsymbol{X}_b\) are QAM modulated symbols. Note that it aligns with the PRS generation process in 5G where Quadrature Phase Shift Keying (QPSK) symbols are used for PRS~\cite{3gpp::38211}. Since \(\boldsymbol{X}_b\) is a diagonal matrix, it satisfies \(\boldsymbol{X}_b\boldsymbol{X}_b^H = \boldsymbol{X}_b^H\boldsymbol{X}_b = \boldsymbol{I}_N\). Similarly, the DFT matrix \(\boldsymbol{F}_L\) satisfies \(\boldsymbol{F}_L^H\boldsymbol{F}_L = \boldsymbol{I}_L\). Moreover, for large \(N\), we can approximate \(\boldsymbol{F}_L\boldsymbol{F}_L^H \approx {\rm diag}\big(\frac{L}{N}, \frac{L}{N}, \dots, \frac{L}{N}\big)\), which asymptotically approaches \(\mathbf{0}_N\), a zero matrix of size \(N \times N\). Using these results, we observe that \(\boldsymbol{\Xi}_b\) in~\eqref{eq:Xi_fim} approaches \(\boldsymbol{I}_N\), the identity matrix. Substituting the Dirac delta function for \(\boldsymbol{h}_b\) in~\eqref{eq:coherent_fim} and leveraging these simplifications, we can now derive CRLB for TOA in the AWGN scenario. The result is presented below as a corollary.
We now derive the variance of the TOA estimate for an AWGN channel, i.e., the LOS scenario, as a special case of Theorem~\ref{thm::CRB::TOA::Coh::Comb}. For the AWGN channel, the CIR \(\boldsymbol{h}_b\) in~\eqref{eq:coherent_fim} reduces to a single path. Assuming Quadrature Phase Shift Keying (QPSK) symbols for PRS, which aligns with 5G NR~\cite{3gpp::38211}, we have \(\boldsymbol{X}_b\boldsymbol{X}_b^H = \boldsymbol{X}_b^H\boldsymbol{X}_b = \boldsymbol{I}_N\). Similarly, the DFT matrix \(\boldsymbol{F}_L\) satisfies \(\boldsymbol{F}_L^H\boldsymbol{F}_L = \boldsymbol{I}_L\). Moreover, for large \(N\), we can approximate \(\boldsymbol{F}_L\boldsymbol{F}_L^H\) as \(\mathbf{0}_N\), a zero matrix of size \(N \times N\). Based on these results, we observe that \(\boldsymbol{\Xi}_b\) in~\eqref{eq:Xi_fim} approaches \(\boldsymbol{I}_N\). Using these simplifications, we present below the CRLB for TOA under AWGN as a corollary.

\begin{corollary}[CRLB of TOA for AWGN]\label{cor::CRB:TOA::AWGN}
The variance of the TOA estimate between the target UE and anchor \(b\) under the AWGN channel is lower-bounded as:
\begin{align}
    {\rm var}(\hat{\tau}_{d,b}) & \geq \mathbb{I}_{e,\theta_{\hat{\tau}}^b}^{-1},\label{eq:awgnbasedcrlb_toa}\\
    \mathbb{I}_{e,\theta_{\hat{\tau}}^b} & = 2\gamma_b\boldsymbol{D}^2 = 8\pi\gamma_b\nabla f^2\sum_{n=-\frac{N}{2}}^{\frac{N}{2}-1}n^2.\label{eq:fim_awgn}
\end{align}
\end{corollary}
% Note that the expression in~\eqref{eq:coherent_fim} represents a generalized version of the derivation detailed in~\cite{luan2017fundamental}.

Having obtained the CRLB for the variance of the TOA error and denoting the vector parameter for TDOA estimation as $\boldsymbol{\theta}_{\tilde{\tau}}$, the FIM for TDOA is expressed as
\begin{align}
    \mathbb{I}_{\theta_{\tilde{\tau}}} = \big(\mathbf{H}_{\hat{\tau}\rightarrow\tilde{\tau}}^T \mathbb{I}_{\theta_{\hat{\tau}}}^{-1} \mathbf{H}_{\hat{\tau}\rightarrow\tilde{\tau}}\big)^{-1},\label{eq:fim_tdoa_from_toa}
\end{align}
where $\mathbf{H}_{\hat{\tau}\rightarrow\tilde{\tau}}$ is a transformation matrix from TOA to TDOA.

Then, the FIM for position parameter $\boldsymbol{\theta}_p$ using TOA-based localization (denoted by $\mathbb{I}_{\hat{\boldsymbol{\theta}}_p}$) and TDOA-based localization (denoted by $\mathbb{I}_{\tilde{\theta}_p}$) can be obtained as follows
\begin{align}
    \mathbb{I}_{\hat{\boldsymbol{\theta}}_p} & = \mathbf{H}_{\hat{\tau}\rightarrow\boldsymbol{\theta}_p}^T \mathbb{I}_{\theta_{\hat{\tau}}} \mathbf{H}_{\hat{\tau}\rightarrow\boldsymbol{\theta}_p},\,
    \mathbb{I}_{\tilde{\theta}_p} = \mathbf{H}_{\tilde{\tau}\rightarrow\boldsymbol{\theta}_p}^T \mathbb{I}_{\theta_{\tilde{\tau}}} \mathbf{H}_{\tilde{\tau}\rightarrow\boldsymbol{\theta}_p}, \label{eq:fim_theta_toa_tdoa}
\end{align}
where $\mathbf{H}_{\hat{\tau}\rightarrow\boldsymbol{\theta}_p}$ and $\mathbf{H}_{\tilde{\tau}\rightarrow\boldsymbol{\theta}_p}$ are the transformation matrices from TOA and TDOA measurements to the position parameter, respectively. Denoting position estimate by \(\hat{\boldsymbol{\theta}}_p\) for TOA-based localization and \(\tilde{\boldsymbol{\theta}}_p\) for TDOA, the variance of the position estimate, also known as position error bound (PEB), is then given by
\begin{align}
    {\rm var}(\hat{\boldsymbol{\theta}}_p) & \geq \text{trace}(\mathbb{I}^{-1}_{\hat{\boldsymbol{\theta}}_p}),\,
    {\rm var}(\tilde{\boldsymbol{\theta}}_p) \geq \text{trace}(\mathbb{I}^{-1}_{\tilde{\boldsymbol{\theta}}_p}). \label{eq:crlb_peb_toa_tdoa}
\end{align}

\subsection{NLOS Bias Modeling}\label{sec:nlos_modeling}
%Traditionally, NLOS bias modeling has relied on Gamma-distribution-based approaches~\cite{QiKo2006,6427618,dureppagari_uav1_10139944} due to their analytical convenience. However, these approaches fail to establish a direct relationship between the NLOS bias and the underlying radio propagation characteristics or physical layer aspects. 
\chb{To address the limitations of traditional NLOS bias modeling, which relies on Gamma-distribution-based methods, we propose a novel approach for modeling NLOS bias.} As part of this, we first define TOA measurements under AWGN and multipath propagation scenarios; using these, we will provide a more realistic representation of NLOS bias.

Without loss of generality, the TOA measurement between an anchor and a target UE under the AWGN channel is expressed as 
\begin{align}
\hat{\tau}_d = \tau_d + v, \label{eq:toa_awgn}
\end{align} 
where \(\tau_d\) represents the true range between the anchor and the target UE, \(v\) is AWGN with zero mean and variance specified in~\eqref{eq:awgnbasedcrlb_toa}, and \(\hat{\tau}_d\) is the measured range. The variance of \(\hat{\tau}_d\), denoted as \(\sigma_n^2\), is equivalent to the variance of \(v\). Thus,  
\begin{align}
    \sigma_n^2 = {\rm var}(v) \geq \frac{1}{8\pi\gamma\nabla f^2\sum_{n=-\frac{N}{2}}^{\frac{N}{2}-1}n^2}, \label{eq:var_toa_awgn}
\end{align}  
where \(\gamma\) denotes the SNR of the considered link. In Monte Carlo simulations, TOA errors for AWGN channels can be modeled by adding AWGN noise with variance \(\sigma_n^2\) to the true range as follows
\begin{align}
\hat{\tau}_d = \tau_d + u, \quad u\sim\mathcal{CN}(0, \sigma_n^2).\label{eq:awgn_monte_carlo}
\end{align}

Similarly, TOA measurements between an anchor and a target UE under multipath propagation are defined as
\begin{align}
    \tilde{\tau}_d = \tau_d + b + v, \label{eq:toa_cir}
\end{align}  
where \(b\) is the NLOS bias induced by multipath propagation with non-zero mean and finite variance. The measured range, \(\tilde{\tau}_d\), incorporates the NLOS bias and AWGN, with variance specified in~\eqref{eq:cirbasedcrlb_toa}. The variance of \(\tilde{\tau}_d\), denoted as \(\sigma_c^2\), can be expressed as  
\begin{align}
    \sigma_c^2 = {\rm var}(b + v) = {\rm var}(b) + {\rm var}(v) = \sigma_b^2 + {\rm var}(\hat{\tau}_d),
\end{align}  
where \(\sigma_b^2\) is the variance of \(b\). Using this, we model NLOS bias offset \(\sigma_b\) as  
\begin{align}
\sigma_b = \sqrt{{\rm var}(\tilde{\tau}_d) - {\rm var}(\hat{\tau}_d)}.\label{eq:novel_nlos_bias}
\end{align}

Note that \(\sigma_b\) differs for each anchor-UE link. To model TOA errors for Monte Carlo simulations in the presence of multipath, NLOS bias offset \(\sigma_b\) and AWGN are added to the true range with the variance \(\sigma_c^2\) as follows
\begin{align}
\tilde{\tau}_d = \tau_d + \sigma_b + u, \quad u\sim\mathcal{CN}(0, \sigma_c^2).\label{eq:cir_monte_carlo}
\end{align}

By explicitly linking the NLOS bias offset to the SNR, multipath effects, and physical layer characteristics, our proposed approach provides a more realistic and comprehensive representation of the NLOS bias. The proposed approach bridges the gap between theoretical analyses and practical channel conditions, ensuring improved accuracy in modeling and simulation. To further illustrate NLOS bias modeling, we assess the TOA error performance with an anchor-UE drop presented in Fig.~\ref{fig:anchor_ue_drop1}. Fig.~\ref{fig:toa_err_awgn_cir} shows a comparison of the TOA error observed under AWGN (described in~\eqref{eq:awgnbasedcrlb_toa}) and the multipath propagation (as given in~\eqref{eq:cirbasedcrlb_toa}). As anticipated, the TOA error observed under multipath is higher due to NLOS bias offsets. The difference between TOA errors observed in Fig.~\ref{fig:toa_err_awgn_cir} relates to the NLOS bias offset derived in~\eqref{eq:novel_nlos_bias}. After establishing the analytical framework and NLOS modeling, we will proceed to assess positioning performance in the next section.

\section{Results and Discussion}\label{sec:results_discussion}
\begin{figure}[t]
    \centering
    \includegraphics[width=0.90\linewidth]{figures/toa_err_crlb_awgn_vs_cir_pt23dbm_low_gdop.pdf}
    \captionsetup{font=small}
    \caption{{\em TOA error comparison}: Comparing TOA error observed in AWGN and multipath.}
    \label{fig:toa_err_awgn_cir}
\vspace{-15pt} \end{figure}

In this section, we evaluate the positioning performance of the proposed TS-WPM and benchmark it against CRLB. We begin by outlining the evaluation framework. Our evaluation considers the anchor-UE deployment scenario illustrated in Fig.~\ref{fig:anchor_ue_drop1}, where UEs are uniformly distributed within a predefined rectangular area, while anchors are strategically positioned around this area to optimize coverage and geometric diversity. In this configuration, each UE attempts to measure TOA from all visible anchors and subsequently computes TDOA measurements. TDOA measurements are computed using the anchor with the strongest SNR as the reference anchor. For this study, we assume that all UEs are located indoors, leading to predominantly NLOS conditions between the anchors and UEs. This aligns with 3GPP evaluation scenarios~\cite{3gpp::38901,3gpp::36814} and avoids biases that could arise from scenarios favoring higher accuracy. The dual-stripe path loss model~\cite{3gpp::36814} is employed to account for distance-dependent path loss and penetration losses. To capture realistic channel characteristics, shadow fading effects are also considered~\cite{3gpp::36814}. To incorporate small-scale fading, we utilize clustered delay line (CDL) channel models, specifically the CDL-A channel model, which is well-suited for NLOS scenarios~\cite{3gpp::38901}. The system operates at a carrier frequency of 3.5 GHz with a 5 MHz bandwidth. We assume a maximum transmit (Tx) power of 23 dBm. This study demonstrates the effectiveness of our proposed TS-WPM by comparing it with state-of-the-art approaches including IPPM, NLS, and WNLS, with all results benchmarked against the CRLB. Additionally, we present a computational complexity analysis to compare the efficiency of TS-WPM with these state-of-the-art approaches. We specifically selected IPPM, NLS, and WNLS as comparison baselines for the following reasons: 1) The proposed TS-WPM is an iterative approach that updates location estimates in a manner similar to IPPM, NLS, and WNLS methods, making these comparisons particularly relevant. 2) Optimization-based techniques such as SDP~\cite{6268731,8241388} and MDS~\cite{10.1145/1138127.1138129,5342507} are known to outperform weighted least squares (WLS) but offer performance comparable to NLS and are inferior to WNLS, making both NLS methods appropriate benchmarks.
\begin{figure}[t]
    \centering
    % \includegraphics[clip, trim = 1cm 0cm 1.16cm 0.5cm, width=0.90\linewidth]{figures/bldg_layout_snapshot_low_gdop.pdf}
    \includegraphics[width=0.90\linewidth]{figures/bldg_layout_snapshot_low_gdop.pdf}
    \captionsetup{font=small}
    \caption{Anchor - UE drop: Good Geometry.}
    \label{fig:anchor_ue_drop1}
\vspace{-18pt} \end{figure}
\begin{figure*}[t]
     \centering
     \begin{subfigure}[b]{0.44\textwidth}%{0.90\linewidth}%
         \centering
         \includegraphics[width=\textwidth]{figures/crlb_vs_ippm_vs_nls_awgn_pt23dbm_low_gdop.pdf}
         \captionsetup{font=small}
         \caption{Position Error: AWGN Channel.}
         \label{fig:cdf_poserr_23dbm_low_gdop_awgn}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.44\textwidth}%{0.90\linewidth}%
         \centering
        \includegraphics[width=\textwidth]{figures/crlb_vs_ippm_vs_nls_cir_pt23dbm_low_gdop.pdf}
        \captionsetup{font=small}
        \caption{Position Error: Multipath Channel.}
        \label{fig:cdf_poserr_23dbm_low_gdop_cir}
     \end{subfigure}
     \captionsetup{font=small}
     \caption{CDF of position error evaluated at 3.5 GHz with 5 MHz bandwidth in AWGN and multipath: Good geometry and high SNR regime}
\vspace{-18pt} \end{figure*}

\subsection{Positioning Performance}
Fig.~\ref{fig:cdf_poserr_23dbm_low_gdop_awgn} and Fig.~\ref{fig:cdf_poserr_23dbm_low_gdop_cir} present the positioning performance for the anchor-UE deployment depicted in Fig.~\ref{fig:anchor_ue_drop1}, evaluated under both AWGN and multipath propagation scenarios. The results are obtained through extensive Monte Carlo simulations, where TOA errors are modeled in accordance with~\eqref{eq:awgn_monte_carlo} and~\eqref{eq:cir_monte_carlo}. As illustrated, in the AWGN scenario, our novel approach exhibits positioning accuracy superior to IPPM and NLS and matches the performance of WNLS. This observation is significant as WNLS is well-known for achieving CRLB in AWGN scenarios~\cite{buehrer2019handbook}, a standard of optimality that is also met by our two-stage method. A similar trend is observed when extending the evaluation to multipath propagation conditions. Notably, even under multipath conditions, where NLOS effects and biases are prevalent, the performance of the proposed method remains remarkably close to the CRLB. This result also highlights that under favorable geometry and high SNR conditions, both our proposed approach and WNLS are asymptotically optimal.
\begin{figure}
    \centering
    \includegraphics[width=0.90\linewidth]{figures/bldg_layout_snapshot_high_gdop.pdf}
    \captionsetup{font=small}
    \caption{Anchor - UE drop: Non-ideal Geometry.}
    \label{fig:anchor_ue_drop2}
\vspace{-18pt} \end{figure}
\begin{figure}[t]
     \centering
     \begin{subfigure}[b]{0.90\linewidth}%{0.485\textwidth}%
         \centering
         \includegraphics[width=\linewidth]{figures/crlb_vs_ippm_vs_nls_awgn_pt23dbm_high_gdop.pdf}
         \captionsetup{font=small}
         \caption{Position Error: AWGN Channel.}
         \label{fig:cdf_poserr_23dbm_high_gdop_awgn}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.90\linewidth}%{0.485\textwidth}%
         \centering
        \includegraphics[width=\linewidth]{figures/crlb_vs_ippm_vs_nls_cir_pt23dbm_high_gdop.pdf}
        \captionsetup{font=small}
        \caption{Position Error: Multipath Channel.}
        \label{fig:cdf_poserr_23dbm_high_gdop_cir}
     \end{subfigure}
     \captionsetup{font=small}
     \caption{CDF of position error evaluated at 3.5 GHz with 5 MHz bandwidth in AWGN and multipath: Non-ideal geometry}
\vspace{-18pt} \end{figure}

To demonstrate the superior performance of TS-WPM over WNLS, we evaluate positioning performance under non-ideal geometry conditions. For this evaluation, we use anchor-UE deployment shown in Fig.~\ref{fig:anchor_ue_drop2}. In this configuration, while UE distribution remains consistent with the earlier evaluation, anchor deployment is configured such that the anchor geometry is worse compared to the earlier evaluation, thereby increasing the GDOP. All other simulation assumptions remain consistent with the previous assessment. Fig.~\ref{fig:cdf_poserr_23dbm_high_gdop_awgn} and Fig.~\ref{fig:cdf_poserr_23dbm_high_gdop_cir} present the positioning performance under both AWGN and multipath propagation for this non-ideal geometry scenario. As observed, the proposed TS-WPM continues to outperform IPPM and NLS. More importantly, we observe that TS-WPM surpasses WNLS across both AWGN and multipath conditions. The performance gap is more pronounced in the multipath scenario, where NLOS bias offsets, coupled with high GDOP, further degrade the accuracy of WNLS. The improved performance of TS-WPM, especially under these non-ideal conditions, can be attributed to the two-stage refinement process combined with the modified normalization factor, as detailed in Section~\ref{sec:analytical_study_tswpm}.

To further demonstrate the superior performance of TS-WPM, we investigated another challenging scenario characterized by low SNR conditions. For this evaluation, we reuse the anchor-UE deployment presented in Fig.~\ref{fig:anchor_ue_drop1}, but instead of assuming a Tx power of 23 dBm, we reduce it to 13 dBm to induce low SNR conditions. All other simulation assumptions remain consistent with the previous assessment. Our evaluations indicated that, under AWGN conditions, TS-WPM performance closely matches that of WNLS; hence, we focus our discussion on the positioning performance observed under multipath propagation for low SNR scenarios. Fig.~\ref{fig:cdf_poserr_13dbm_low_gdop_cir} illustrates the positioning performance for low SNR under multipath propagation. It is clearly evident that TS-WPM demonstrates superior performance compared to WNLS, in addition to IPPM and NLS. This superior performance is attributed to the amplified errors in TOA measurements at low SNRs, which are further exacerbated due to multipath propagation, where the NLOS bias offset depends on SNR and the underlying propagation conditions. To better understand this phenomenon, consider TOA estimation under multipath propagation for both high and low SNR scenarios. In high SNR conditions, the TOA estimation process is generally able to lock onto the first path or a path close to the first one, as these paths are distinct and detectable. Conversely, under low SNR conditions, the first path may become insignificant or undetectable due to poor SNR, leading to TOA estimates that are biased toward delayed paths. Although our evaluation framework does not explicitly estimate TOA, the TOA error modeling in~\eqref{eq:cir_monte_carlo} captures these effects by accounting for the prevailing SNR and propagation characteristics. Consequently, when TOA errors are significant--primarily due to a pronounced NLOS bias offset--the performance of WNLS deteriorates. In contrast, as described in Section~\ref{sec:novel_ts_wpm_tdoa}, the proposed approach incorporates a two-stage refinement process, which mitigates the impact of the NLOS bias offset by accurately estimating the range measurements associated with the reference anchor range and iteratively updating the UE position estimate and vice versa. As a result, the proposed approach ensures enhanced positioning even under low SNR conditions. Remarkably, even in high GDOP or low SNR scenarios, the proposed method achieves performance levels very close to the CRLB.

\chb{In our final evaluation, we assess the positioning performance of cooperative localization as outlined in Algorithm~\ref{alg:novel_ts_wpm_coop}. For this assessment, we reuse the anchor-UE deployment depicted in Fig.~\ref{fig:anchor_ue_drop1}, considering multipath propagation. However, unlike previous scenarios, we assume that each target UE has visibility to only two anchors, making collaborative measurements essential for accurate localization. The number of cooperative nodes, denoted by \(N_{coop}\), is set to \([1,\,2,\,3]\), with nodes randomly selected from the UE drop. Fig.~\ref{fig:cdf_poserr_coop_cir} illustrates the positioning performance of TS-WPM across different \(N_{coop}\). The results clearly demonstrate the effectiveness of cooperative localization in enabling accurate positioning when an insufficient number of anchors are visible, with increasing the number of cooperative nodes leading to further accuracy improvements. Additionally, we compare the results with WNLS across different \(N_{coop}\). It is crucial to note that WNLS, in its original form, fails to provide meaningful positioning estimates as the matrix in the normalization (see~\eqref{eq:weighted_nls_final_est}) becomes ill-conditioned (non-invertible) due to highly unfavorable GDOP resulting from randomly selected collaborative nodes combined with limited anchor availability. This aligns with the insights established in Proposition~\ref{prop::robustness::tswpm}, which show that WNLS results in high MSE in high GDOP scenarios. Addressing this, we employed a regularization factor to stabilize the matrix inversion process, a concept that is inherently incorporated in TS-WPM through a more systematic approach, as discussed in Section~\ref{sec:alt_math_intuition}. Our evaluation confirms that TS-WPM consistently outperforms WNLS due to its sophisticated normalization coupled with the two-stage approach, reinforcing its robustness under high GDOP conditions. Furthermore, we observed that cooperative localization with IPPM, under this setup, resulted in prohibitively high positioning errors, which is why we opted not to include a comparison with IPPM in this scenario. These findings underscore the effectiveness of TS-WPM in tackling challenging localization conditions where conventional approaches struggle to maintain accuracy.}
%\chr{Additionally, we compare the results with WNLS for \(N_{coop} = 1\), where TS-WPM consistently outperforms WNLS. However, for \(N_{coop} > 1\), randomly selected collaborative nodes combined with limited anchor availability result in highly unfavorable GDOP. Under these conditions, WNLS fails to provide meaningful positioning estimates, preventing a direct comparison with TS-WPM. This further underscores the robustness of TS-WPM, which remains effective in challenging localization environments where conventional approaches struggle to maintain accuracy.}
\begin{figure}[t]
     \centering
    \includegraphics[width=0.90\linewidth]{figures/crlb_vs_ippm_vs_nls_cir_pt13dbm_low_gdop.pdf}
     \captionsetup{font=small}
     \caption{CDF of position error evaluated at 3.5 GHz with 5 MHz bandwidth in multipath: Good geometry and low SNR regime}
    \label{fig:cdf_poserr_13dbm_low_gdop_cir}     
\vspace{-15pt} \end{figure}
\begin{figure}[t]
     \centering
    % \includegraphics[width=\linewidth]{figures/nwppm_coop_cir_pt23dbm_low_gdop.pdf}
    \includegraphics[width=0.90\linewidth]{figures/tswpm_vs_wnls_coop_cir_pt23dbm_high_gdop.pdf}
     \captionsetup{font=small}
     \caption{{\em Performance with co-operative localization:} CDF of position error evaluated at 3.5 GHz with 5 MHz bandwidth in multipath}
     \label{fig:cdf_poserr_coop_cir}
\vspace{-18pt} \end{figure}

\chb{\subsection{Computational Complexity}
Having established the superior positioning performance of TS-WPM, we now analyze the computational complexity of the proposed TS-WPM and compare it with state-of-the-art algorithms, including NLS, WNLS, and IPPM. As outlined in Algorithm~\ref{alg:novel_ts_wpm_tdoa}, each iteration of TS-WPM involves updating the UE location estimate, computing residuals, and refining the reference anchor range estimate across all \(B\) anchors (see steps~\ref{step:novel_ts_wpm_tdoa_loc_update}, \ref{step:novel_ts_wpm_tdoa_res_err}, and \ref{step:novel_ts_wpm_toa_range_update}). Each update step comprises basic vector norms and arithmetic operations, resulting in a per-iteration complexity of \(O(B)\). Consequently, the overall complexity of TS-WPM is \(O(N \cdot B)\), where \(N\) represents the number of iterations required for convergence. Similarly, the computational complexity of IPPM is also \(O(N \cdot B)\)~\cite{5677549_tao_coop_ippm,5683693_toa_coop_mod_ippm}, which is identical to that of TS-WPM. In contrast, the computational complexity of NLS and WNLS is significantly higher due to additional matrix inversion and multiplication operations. Specifically, both methods exhibit a complexity of \(O(N \cdot B \cdot D^3)\)~\cite{buehrer2019handbook}, where \(D\) denotes the number of spatial dimensions of the UE coordinates. NLS and WNLS typically require fewer iterations than IPPM and TS-WPM, with TS-WPM necessitating additional iterations due to its two-stage refinement process. Our evaluations indicate that, on average, NLS and WNLS converge in 16-17 iterations, while IPPM and TS-WPM require more than 20 iterations. Despite its higher iteration count, TS-WPM remains computationally efficient compared to NLS and WNLS, as it avoids costly matrix inversions and minimizes the number of matrix multiplications.} %Overall, TS-WPM offers a balanced trade-off, providing superior positioning accuracy with computational complexity that remains practical for real-time implementations.


%To quantify computational complexity, we define key metrics: the number of additions and subtractions as \(N_{as}\), the number of multiplications and divisions as \(N_{md}\), and the number of square root (sqrt) operations as \(N_s\). For this assessment, we consider a scenario with favorable geometry and high SNR under multipath propagation. The computational complexity comparison is presented in Table~\ref{tab:complexity}. Additionally, we represent sqrt operations in terms of additions, multiplications, and divisions using the Babylonian method~\cite{5156463}, which is an optimized iterative method for calculating sqrt. According to the Babylonian method, each iteration of calculating sqrt requires three operations: one division, one addition, and one multiplication. Assuming five iterations, which is a reasonable assumption, we list the total number of additions/subtractions plus multiplications/divisions, denoted as \(N_t\), in Table~\ref{tab:complexity}. Thus, essentially \(N_t\) is calculated as \(N_t = N_{as}+N_{md}+15N_s\). Despite employing a two-stage refinement process that typically requires more iterations than NLS, WNLS, and low-complexity algorithms like IPPM, the proposed TS-WPM achieves computational efficiency by strategically minimizing complex operations. Notably, while the two-stage iterative process does introduce additional computations, TS-WPM avoids computationally intensive operations such as matrix inversion, a major contributor to the high complexity of NLS and WNLS. Moreover, the simplified normalization factor used in TS-WPM reduces the number of matrix multiplications, further enhancing computational efficiency. Specifically, the proposed approach is inferior to IPPM, maintains a complexity level comparable to NLS, and outperforms WNLS in terms of efficiency. Although WNLS typically requires fewer iterations to converge than TS-WPM, its overall complexity is higher due to the matrix inversion and increased matrix multiplications involved in each iteration. Overall, the proposed TS-WPM demonstrates a balanced trade-off, providing superior positioning accuracy with computational complexity that remains practical for real-time implementations.
% \begin{table}[h]
%   \centering
%   \caption{Computational Complexity Comparison}
%   \label{tab:complexity}
%   % Define 5 columns using p{width} so text will wrap.
%   \begin{tabularx}{\linewidth}{|p{1.3cm}|p{1.4cm}|X|X|X|X|}
%     \hline
%     % First header row: Header 1 and Header 2 use multirow to span two rows.
%     \multirow{2}{*}\textbf{Method} & \multirow{2}{*}\textbf{Number of Iterations} & \multicolumn{4}{c|}{Computational Complexity} \\ \cline{3-6}
%     % Second header row: subheaders under Header 3.
%     & & \(N_{as}\) & \(N_{md}\) & \(N_{s}\) & \(N_t\)\\ 
%     \hline
%     % Data Row 1 with long text for wrapping demonstration.
%     IPPM & 21 & 829 & 756 & 147 & 3790\\
%     \hline
%     NLS & 17 & 1648 & 1451 & 119 & 4884\\
%     \hline
%     % Data Row 2 with additional long text.
%     WNLS & 16 & 2940 & 3074 & 112 & 7694\\
%     \hline
%     TS-WPM & 23 & 1375 & 1032 & 162 & 4837\\
%     \hline
%   \end{tabularx}
% \end{table}

\section{Concluding Remarks}\label{sec:conclusion}
In this paper, we proposed a novel low-complexity TS-WPM for TDOA-based localization and extended it to support cooperative localization. The proposed method employs a two-stage refinement process that iteratively updates both the range estimate associated with the reference anchor and the UE location estimate, thereby significantly enhancing positioning accuracy while maintaining computational efficiency. This refinement process proves particularly effective in challenging scenarios such as high GDOP and low SNR. Furthermore, we provided an analytical derivation establishing the conditions under which TS-WPM is asymptotically optimal and demonstrating its performance advantages over WNLS. To rigorously evaluate the proposed method, we developed a comprehensive 3GPP-compliant analytical framework that integrates physical layer and fading characteristics, using the CRLB as a principal tool. Additionally, we proposed a novel NLOS bias modeling approach that explicitly accounts for underlying propagation conditions and SNR, offering a more accurate representation of the bias induced by multipath. Through extensive Monte Carlo simulations, we demonstrated that the proposed TS-WPM consistently outperforms state-of-the-art techniques such as IPPM and NLS. Our results illustrated that, under non-ideal conditions, TS-WPM surpasses WNLS, achieving performance close to the CRLB even in scenarios with high GDOP, low SNR, and multipath propagation. Furthermore, we highlighted the effectiveness of the proposed approach when incorporating cooperative localization, enabling accurate positioning even when an insufficient number of anchors (such as 2) are visible. Finally, we performed a computational complexity analysis comparing TS-WPM with IPPM, NLS, and WNLS, demonstrating that the proposed approach exhibits complexity identical to IPPM and lower complexity than NLS and WNLS, as it avoids complex operations like matrix inversion and minimizes matrix multiplications. Overall, the proposed TS-WPM presents a balanced trade-off between positioning accuracy and computational complexity, making it a promising candidate for real-time localization applications across diverse environments.

\appendix
\subsection{Proof of Lemma~\ref{lemma::cov::mse::tswpm}}\label{app::cov::mse::tswpm}
By utilizing the expression for the final estimate of TS-WPM in~\eqref{eq:nwpm_final_est} and replacing \(\mathbf{H}_2(\boldsymbol{\theta})\) by \(\mathbf{H}_2\) for notational simplicity, we compute the covariance of the estimation error \( (\hat{\boldsymbol{\theta}}_{\mathrm{tswpm}}-\boldsymbol{\theta}) \) as follows
\begin{align}
    {\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{tswpm}}-\boldsymbol{\theta}) = \mathbf{H}_2^T\mathbf{W}_2{\rm cov}(\tilde{\mathbf{r}} - \tilde{\mathbf{r}}'_e(\boldsymbol{\theta},r_1))\mathbf{W}_2\mathbf{H}_2.
    \label{eq:cov_nwpm_der1}
\end{align}

By substituting \( {\rm cov}(\tilde{\mathbf{r}} - \tilde{\mathbf{r}}'_e(\boldsymbol{\theta},r_1)) = \mathbf{C}_2 \) from~\eqref{eq:cov_tdoa_scen2} into~\eqref{eq:cov_nwpm_der1}, we obtain
\begin{align}
    {\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{tswpm}}-\boldsymbol{\theta}) =\mathbf{H}_2^T\mathbf{W}_2\mathbf{C}_2\mathbf{W}_2\mathbf{H}_2.
    \label{eq:cov_nwpm_der2}
\end{align}

Next, by substituting \(\mathbf{W}_2 = \frac{\mathbf{C}_2^{-1}}{{\rm trace}(\mathbf{C}_2^{-1})}\) into~\eqref{eq:cov_nwpm_der2} and simplifying, we derive
\begin{align}
    {\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{tswpm}}-\boldsymbol{\theta}) =\frac{1}{\left({\rm trace}(\mathbf{C}_2^{-1})\right)^2}\left(\mathbf{H}_2^T\mathbf{C}_2^{-1}\mathbf{H}_2\right).
    \label{eq:cov_nwpm_der3}
\end{align}

The accuracy of the TS-WPM is determined by the MSE associated with \( \hat{\boldsymbol{\theta}}_{\mathrm{tswpm}} \) defined in~\eqref{eq:nwpm_final_est}. Using the result in~\eqref{eq:cov_nwpm_der3}, the MSE of TS-WPM estimate is given by
\begin{align}
    {\rm MSE}_{\mathrm{tswpm},r_1} = \frac{1}{\left({\rm trace}(\mathbf{C}_2^{-1})\right)^2}{\rm trace}\left(\mathbf{H}_2^T\mathbf{C}_2^{-1}\mathbf{H}_2\right).
    \label{eq:mse_tswpm_der1}
\end{align}

Since our desired MSE is for the position parameter 
\([x,y]\), we use the Schur complement in~\eqref{eq:efim_tdoa_scen2} and derive the MSE for \([x,y]\) as  
\begin{align}  
    {\rm MSE}_{\mathrm{tswpm}} =\frac{1}{\left({\rm trace}(\mathbf{C}_2^{-1})\right)^2}{\rm trace}\left(\mathbf{F}_{2,[x,y]}\right).  
    \label{eq:mse_tswpm_der2}  
\end{align}  

The expression in~\eqref{eq:mse_tswpm_der2} can be rewritten in terms of eigenvalues as  
\begin{align}  
    {\rm MSE}_{\mathrm{tswpm}} =\frac{1}{\left({\rm trace}(\mathbf{C}_2^{-1})\right)^2}\sum_{i=1}^K\lambda_i\left(\mathbf{F}_{2,[x,y]}\right),  
    \label{eq:mse_tswpm_der3}  
\end{align}  
where \( \lambda_i \) are the eigenvalues of \( \mathbf{F}_{2,[x,y]} \), and \( K \) denotes the number of non-zero eigenvalues, which takes a maximum value of 2 in a 2D estimation scenario.


\subsection{Proof of Theorem~\ref{thm::optimality::tswpm}}\label{app::optimality::tswpm}
Considering a two-stage estimation method of the form 
\begin{align}
    \hat{\boldsymbol{\phi}}_1& = \frac{1}{N}\sum_m h_1(\boldsymbol{\phi}_1,\mathbf{x}_m),\notag\\
    \hat{\boldsymbol{\phi}}_2& = \frac{1}{N}\sum_n h_2(\boldsymbol{\phi}_2,\hat{\boldsymbol{\phi}}_1,\mathbf{y}_n).\label{eq:two_stage_est}
\end{align}
where \(\boldsymbol{\phi}_1\) and \(\boldsymbol{\phi}_2\) are the parameters to be estimated in the first and second stages, respectively; \(h_1\) and \(h_2\) are the corresponding function maps, while \(\mathbf{x}_m\) and \(\mathbf{y}_n\) represent the respective received signals. According to ~\cite{murphy_topel,mandic_train}, for any two-stage estimation methods of this form, we can represent the error covariance of the second-stage estimate as a summation of the error covariance assuming no error propagation from the first stage to the second stage, i.e., with accurate \(\boldsymbol{\phi}_1\), and a correction term due to the erroneous estimation of \(\boldsymbol{\phi}_1\), denoted as \(\hat{\boldsymbol{\phi}}_1\). We can verify that the proposed approach outlined in Algorithm~\ref{alg:novel_ts_wpm_tdoa} aligns with~\eqref{eq:two_stage_est}, where \(\boldsymbol{\phi}_1 = r_1\), \(\boldsymbol{\phi}_2 = \boldsymbol{\theta}\), and \(\tilde{\mathbf{r}}\) is the received signal in both stages. With that understanding, we now derive the error covariance by applying MLE.

Revisiting the TDOA measurements definition in~\eqref{eq:noisy_tdoa} and rewriting it, we have
\begin{align}
\tilde{r}_b = \hat{r}_b - \hat{r}_1 = r_b - r_1 + n_b - n_1,\quad b \in \{2, 3, \cdots, B\},\label{eq:tdoa_measure_def}
\end{align}
where \(r_b = \|\boldsymbol{\theta}-\mathbf{a}_b\|\) is the true range between anchor \(b\) and the target UE and \(n_b\) is AWGN with variance \(\sigma_b^2\). Subsequently, we can express a vector of TDOA measurements as
\begin{align}
\tilde{\mathbf{r}} = \mathbf{m}(r_1,\boldsymbol{\theta}) + \mathbf{n},\label{eq:tdoa_vec_def}
\end{align}
where \(\mathbf{m}(r_1,\boldsymbol{\theta}) = \begin{bmatrix}r_2(\boldsymbol{\theta})-r_1\, \cdots\, r_B(\boldsymbol{\theta})-r_1\end{bmatrix}^T\) and the resultant noise is denoted by \(\mathbf{n}\), which has covariance \(\mathbf{C}_1\) as given in~\eqref{eq:cov_tdoa_scen1}. Then, if we fix \(\boldsymbol{\theta}\) (say at a previous estimate denoted by \(\boldsymbol{\theta}_0\)) and view \(r_1\) as the only unknown, the log-likelihood function for the first stage is formulated as
\begin{align}
L_1(r_1) = -\frac{1}{2}\Bigl(\tilde{\mathbf{r}}-\mathbf{m}(r_1,\boldsymbol{\theta}_0)\Bigr)^T \mathbf{C}_1^{-1}\Bigl(\tilde{\mathbf{r}}-\mathbf{m}(r_1,\boldsymbol{\theta}_0)\Bigr).
\end{align}

Alternatively, treating both \(\boldsymbol{\theta}\) and \(r_1\) as unknowns, we formulate the log-likelihood function for the second stage estimation as
\begin{align}
L_2(r_1,\boldsymbol{\theta}) = -\frac{1}{2}\Bigl(\tilde{\mathbf{r}}-\mathbf{m}(r_1,\boldsymbol{\theta})\Bigr)^T \mathbf{C}_1^{-1}\Bigl(\tilde{\mathbf{r}}-\mathbf{m}(r_1,\boldsymbol{\theta})\Bigr).
\end{align}

Then, we obtain the following matrices
\begin{align}
\mathbf{R}_1 &= -E\Biggl\{\frac{\partial^2 L_1}{\partial r_1^2}\Biggr\},\,\mathbf{R}_2 = -E\Biggl\{\frac{\partial^2 L_2}{\partial \boldsymbol{\theta}\,\partial\boldsymbol{\theta}^T}\Biggr\}\,, \label{eq:R1_R2}\\
\mathbf{R}_3 &= -E\Biggl\{\frac{\partial^2 L_2}{\partial \boldsymbol{\theta}\,\partial r_1}\Biggr\},\,
\mathbf{R}_4 = E\Biggl\{\frac{\partial L_1}{\partial r_1}\frac{\partial L_2}{\partial \boldsymbol{\theta}^T}\Biggr\}. \label{eq:R3_R4}
\end{align}

A standard derivation yields
\begin{align}
\mathbf{R}_1 &= \mathbf{u}^T \mathbf{C}_1^{-1}\mathbf{u},\,\mathbf{R}_2 = \mathbf{J}^T \mathbf{C}_1^{-1}\mathbf{J}\,,\notag\\
\mathbf{R}_3 &= - \mathbf{J}^T \mathbf{C}_1^{-1}\mathbf{u},\,
\mathbf{R}_4 = - \mathbf{u}^T \mathbf{C}_1^{-1}\mathbf{J}.\notag
\end{align}
where \(\mathbf{u}\) is a vector of \(B-1\) ones and \(\mathbf{J}\) is the Jacobian transformation of \(\tilde{\mathbf{r}}\) with respect to \(\boldsymbol{\theta}\). Note that \(\mathbf{R}_3=\mathbf{R}_4\). Then, according to~\cite{murphy_topel}, it can be shown that the error covariance of the second stage estimate, denoted by \(\boldsymbol{\Sigma}_{\boldsymbol{\theta}}^{\rm MLE}\), is given by
\begin{align}
\boldsymbol{\Sigma}_{\boldsymbol{\theta}}^{\rm MLE} = \mathbf{R}_2^{-1} + \boldsymbol{\Sigma}_{C}.
\label{eq:Sigma_alt}
\end{align}
where \(\boldsymbol{\Sigma}_{C}\) is a correction term introduced due to the first-stage estimate and is given by 
\begin{align}
    \boldsymbol{\Sigma}_{C} = \mathbf{R}_2^{-1}\left(\mathbf{R}_3^T \mathbf{R}_1^{-1} \mathbf{R}_3 - \mathbf{R}_4^T \mathbf{R}_1^{-1} \mathbf{R}_3 - \mathbf{R}_3^T \mathbf{R}_1^{-1} \mathbf{R}_4\right)\mathbf{R}_2^{-1}.
\end{align}

Using \(\mathbf{R}_3=\mathbf{R}_4=-\mathbf{J}^T \mathbf{C}_1^{-1}\mathbf{u}\), one can show that the expression in (\ref{eq:Sigma_alt}) simplifies to
\begin{align}
\boldsymbol{\Sigma}_{\boldsymbol{\theta}}^{\rm MLE}=\left(\mathbf{J}^T \mathbf{C}_1^{-1}\mathbf{J}-\frac{\mathbf{J}^T \mathbf{C}_1^{-1}\mathbf{u}\,\mathbf{u}^T \mathbf{C}_1^{-1}\mathbf{J}}{\mathbf{u}^T \mathbf{C}_1^{-1}\mathbf{u}}\right)^{-1}.
\end{align}

As derived earlier, the TS-WPM estimator yields an error covariance (as specified in~\eqref{eq:cov_nwpm_der3})
\begin{align}
{\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{tswpm}}-\boldsymbol{\theta}) =\frac{1}{\left({\rm trace}(\mathbf{C}_2^{-1})\right)^2}\left(\mathbf{H}_2^T\mathbf{C}_2^{-1}\mathbf{H}_2\right).
\label{eq:cov_ts_wpm}
\end{align}

TS-WPM approaches MLE, i.e., \({\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{tswpm}}-\boldsymbol{\theta})\) becomes equal to \(\boldsymbol{\Sigma}_{\boldsymbol{\theta}}^{\rm MLE}\) when the cross-information between \(r_1\) and \(\boldsymbol{\theta}\) vanishes, i.e., \(\mathbf{u}^T \mathbf{C}_1^{-1}\mathbf{J} = \mathbf{0}\). This condition is met when the measurement noises are uncorrelated. This situation occurs when the covariance matrix \(\mathbf{C}_1\) reduces to \(\mathbf{C}_2\), which occurs when the reference anchor does not introduce additional error dependencies--in practice when its SNR approaches infinity (i.e., \(\sigma_1^2 \rightarrow 0\)). In other words, in a high SNR regime, the proposed novel TS-WPM is {\em asymptotically optimal}.

\subsection{Proof of Lemma~\ref{lemma::cov::mse::wnls}}\label{app::cov::mse::wnls}
Let \( \hat{\boldsymbol{\theta}}^k \) represent the iterative update of \( \boldsymbol{\theta} \) at iteration \( k \). As described in~\cite{buehrer2019handbook,kay1993fundamentals}, the WNLS update is expressed as
\begin{align}
\hat{\boldsymbol{\theta}}^k = \hat{\boldsymbol{\theta}}^{k-1} + \boldsymbol{\beta}_{k-1}\big(\mathbf{H}_1(\hat{\boldsymbol{\theta}}^{k-1})\big)^T\mathbf{W}_1\big(\tilde{\mathbf{r}} - \tilde{\mathbf{r}}_e(\hat{\boldsymbol{\theta}}^{k-1})\big),
\label{eq:weighted_nls_def}
\end{align}
where \( \boldsymbol{\beta}_{k-1}=\big((\mathbf{H}_1(\hat{\boldsymbol{\theta}}^{k-1}))^T\mathbf{W}_1\mathbf{H}_1(\hat{\boldsymbol{\theta}}^{k-1})\big)^{-1} \), and \( \mathbf{W}_1 \) is defined as \( \mathbf{W}_1=\mathbf{C}_1^{-1}\), with \( \mathbf{C}_1 \) given in~\eqref{eq:cov_tdoa_scen1}. The term \( \tilde{\mathbf{r}}_e(\hat{\boldsymbol{\theta}}^{k-1}) \) represents a vector of TDOA estimates evaluated at \( \hat{\boldsymbol{\theta}}^{k-1} \) as given in~\eqref{eq:tdoa_est_method1}.

Assuming convergence, the final WNLS estimate can be approximated as
\begin{align}
\hat{\boldsymbol{\theta}}_{\mathrm{wnls}} = \boldsymbol{\theta} + \boldsymbol{\beta}(\mathbf{H}_1(\boldsymbol{\theta}))^T\mathbf{W}_1\big(\tilde{\mathbf{r}} - \tilde{\mathbf{r}}_e(\boldsymbol{\theta})\big),
\label{eq:weighted_nls_final_est}
\end{align}
where \( \boldsymbol{\theta} \) represents the true position parameter, \( \mathbf{H}_1(\boldsymbol{\theta}) \) denotes the Jacobian matrix of \( \tilde{\mathbf{r}} \) with respect to \( \boldsymbol{\theta} \), equal to \( \mathbf{H}_1 \) as specified in~\eqref{eq:jacobian_tdoa}, and \( \boldsymbol{\beta}=\left((\mathbf{H}_1(\boldsymbol{\theta}))^T\mathbf{W}_1\mathbf{H}_1(\boldsymbol{\theta})\right)^{-1}\). In the following derivation, we will use \(\mathbf{H}_1\) instead of \(\mathbf{H}_1(\boldsymbol{\theta}) \).

The MSE associated with the estimate \( \hat{\boldsymbol{\theta}}_{\mathrm{wnls}} \) quantifies the positioning error of WNLS. To derive the MSE, we first determine the covariance of \( (\hat{\boldsymbol{\theta}}_{\mathrm{wnls}}-\boldsymbol{\theta}) \) as follows
\begin{align}
    {\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{wnls}}-\boldsymbol{\theta}) = \boldsymbol{\beta}\mathbf{H}_1^T\mathbf{W}_1{\rm cov}(\tilde{\mathbf{r}} - \tilde{\mathbf{r}}_e(\boldsymbol{\theta}))\mathbf{W}_1\mathbf{H}_1\boldsymbol{\beta}^T,
    \label{eq:cov_wnls_der1}
\end{align}
where \( {\rm cov}(\tilde{\mathbf{r}} - \tilde{\mathbf{r}}_e(\boldsymbol{\theta})) \) is essentially \( \mathbf{C}_1 \) as defined in~\eqref{eq:cov_tdoa_scen1}. Substituting \( \mathbf{C}_1 \) into~\eqref{eq:cov_wnls_der1} yields
\begin{align}
    {\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{wnls}}-\boldsymbol{\theta}) =\boldsymbol{\beta}\mathbf{H}_1^T\mathbf{W}_1\mathbf{C}_1\mathbf{W}_1\mathbf{H}_1\boldsymbol{\beta}^T.
    \label{eq:cov_wnls_der2}
\end{align}

Further, substituting \( \boldsymbol{\beta} \) and \( \mathbf{W}_1 \) into~\eqref{eq:cov_wnls_der2} and simplifying leads to
\begin{align}
    {\rm cov}(\hat{\boldsymbol{\theta}}_{\mathrm{wnls}}-\boldsymbol{\theta}) =\left(\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1\right)^{-1}.
    \label{eq:cov_wnls_der3}
\end{align}

Consequently, the MSE associated with the WNLS estimate is
\begin{align}
    {\rm MSE}_{\mathrm{wnls}} = {\rm trace}\left(\left(\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1\right)^{-1}\right).
    \label{eq:mse_wnls_der1}
\end{align}

The expression in~\eqref{eq:mse_wnls_der1} can be expressed in terms of eigenvalues as
\begin{align}
    {\rm MSE}_{\mathrm{wnls}} = \sum_{i=1}^K \frac{1}{\lambda_i\left(\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1\right)},
    \label{eq:mse_wnls_der2}
\end{align}
where \( \lambda_i \) are the eigenvalues of \( \mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1 \), and \( K \) indicates the number of non-zero eigenvalues. For 2D estimation, the maximum value of \( K \) is 2.

\subsection{Proof of Proposition~\ref{prop::robustness::tswpm}}\label{app::robustness::tswpm}
%We compare the MSE TS-WPM derived in Lemma~\ref{lemma::cov::mse::tswpm} with that of WNLS derived in Lemma~\ref{lemma::cov::mse::wnls} under non-ideal conditions. 
Considering the MSE of WNLS given in~\eqref{eq:mse_wnls_der2}, in high GDOP scenarios, for 2D estimation, one eigenvalue of \( \mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1 \) is quite significant, while the other remains relatively insignificant. Consequently, the MSE in ~\eqref{eq:mse_wnls_der2} can be approximated as
\begin{align}
    {\rm MSE}_{\mathrm{wnls}} \approx \frac{1}{\lambda_{\min}\left(\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1\right)}.
    \label{eq:mse_wnls_final}
\end{align}
 
% By bounding the MSE in~\eqref{eq:mse_tswpm_der3}, we derive  
% \begin{align}  
%     {\rm MSE}_{2,[x,y]} \leq \frac{1}{\left({\rm trace}(\mathbf{C}_2^{-1})\right)^2}K\lambda_{\max}\left(\mathbf{F}_{2,[x,y]}\right),  
%     \label{eq:mse_tswpm_der4}  
% \end{align}  
% which provides an upper bound on the MSE. Here, \(\lambda_{\max}\) denotes the largest eigenvalue.

% Utilizing~\eqref{eq:efim_tdoa_scen2}, i.e., \(\left(\mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{H}_t-\mathbf{F}_{2,[x,y]}\right)\geq0\), we can simplify the MSE in~\eqref{eq:mse_tswpm_der4} as  
% \begin{align}  
%     {\rm MSE}_{2,[x,y]} & \leq \frac{1}{\left({\rm trace}(\mathbf{C}_2^{-1})\right)^2}K\lambda_{\max}\left(\mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{H}_t\right).  
%     \label{eq:mse_tswpm_der5}  
% \end{align}  

% Now employing the following result \(\lambda_{\max}\left(\mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{H}_t\right)\leq{\rm trace}\left(\mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{H}_t\right)={\rm trace}(\mathbf{C}_2^{-1})\) and substituting  \({\rm trace}(\mathbf{C}_2^{-1})=\sum_{b=1}^B\frac{1}{\sigma_b^2}\), we can further simplify the MSE in~\eqref{eq:mse_tswpm_der5} as  
% \begin{align}  
%     {\rm MSE}_{2,[x,y]} \leq \frac{1}{\sum_{b=1}^B\frac{1}{\sigma_b^2}}K.  
%     \label{eq:mse_tswpm_der6}  
% \end{align}

% Next, we find an approximation for~\eqref{eq:mse_tswpm_der2} in the case of high GDOP. 

Similarly, we approximate the MSE of TS-WPM given in~\eqref{eq:mse_tswpm_der3} in high GDOP scenarios. To facilitate this, we first simplify the second term in~\eqref{eq:efim_tdoa_scen2}. We denote the expression \(\mathbf{C}_2^{-1}\mathbf{v}\left(\mathbf{v}^T\mathbf{C}_2^{-1}\mathbf{v}\right)^{-1}\mathbf{v}^T\mathbf{C}_2^{-1}\) in~\eqref{eq:efim_tdoa_scen2} as \(\mathbf{C_v}\) and evaluate it to obtain
\begin{align}
    \mathbf{C_v} = \left(\sum_{b=1}^B\frac{1}{\sigma_b^2}\right)\begin{bmatrix}
        \left(\frac{1}{\sigma_1^2}\right)^2 & \frac{1}{\sigma_1^2\sigma_2^2} & \cdots & \frac{1}{\sigma_1^2\sigma_B^2}\\
        \vdots & \vdots & \ddots & \vdots\\
        \frac{1}{\sigma_B^2\sigma_1^2} & \frac{1}{\sigma_B^2\sigma_2^2} & \cdots & \left(\frac{1}{\sigma_B^2}\right)^2
    \end{bmatrix}.
    \label{eq:term2_efim_tdoa_scen2}
\end{align}

In high GDOP scenarios, when the anchors are colocated, we observe similar SNR across all the anchors and the target UE links, resulting in identical \(\sigma_b^2\) values for all the anchors. This behavior causes \(\mathbf{C_v}\) to have identical entries. Consequently, we can verify that \({\rm trace}\left(\mathbf{H}_t^T\mathbf{C_v}\mathbf{H}_t\right)\) approaches 0. Using this result, we can show that in high GDOP scenarios, 
\begin{align}
    {\rm trace}\left(\mathbf{F}_{2,[x,y]}\right)\approx{\rm trace}\left(\mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{H}_t\right).
\end{align}

%Furthermore, we can confirm that \({\rm trace}\left(\mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{H}_t\right)={\rm trace}\left(\mathbf{C}_2^{-1}\right)\). Based on this result, 
By using this result along with \({\rm trace}\left(\mathbf{H}_t^T\mathbf{C}_2^{-1}\mathbf{H}_t\right)={\rm trace}\left(\mathbf{C}_2^{-1}\right)\), the MSE in~\eqref{eq:mse_tswpm_der2} can be approximated for high GDOP scenarios as
\begin{align}
    {\rm MSE}_{\mathrm{tswpm}} \approx \frac{1}{\sum_{b=1}^B\frac{1}{\sigma_b^2}}.
    \label{eq:mse_tswpm_final}
\end{align}

This result is significant, as it shows that even under high GDOP conditions, the MSE of the proposed two-stage WPM remains directly proportional to the variance of pseudo-range measurements, which is not commonly observed in non-ideal settings~\cite{buehrer2019handbook}. By comparing~\eqref{eq:mse_wnls_final} and~\eqref{eq:mse_tswpm_final}, we observe that under high GDOP, \( \lambda_{\min}\left(\mathbf{H}_1^T\mathbf{C}_1^{-1}\mathbf{H}_1\right) \) becomes insignificant, resulting in high MSE for the WNLS case. In contrast, the MSE with the novel TS-WPM in~\eqref{eq:mse_tswpm_final} trends similarly to low GDOP or favorable conditions, maintaining robust performance and reinforcing its effectiveness in non-ideal situations.
\balance
\bibliographystyle{IEEEtran}
\bibliography{hokie}

\end{document}