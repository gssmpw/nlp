\begin{algorithm}[!t]
    \caption{Naturalness-based Trigger Identification}
    \scriptsize
    \label{alg:trigger_identifying}
    %\vspace{2.5pt}
    %\hspace{-15.5mm}
    \raggedright
    \begin{tabular}{rllll}
        %\toprule
        \hline
        \textsc{Input}: & $X^p$ & \; & poisoned data & \\
        & $f_{\theta}$ & \; & code language model & \\
        & $k$ & \; & number of tokens selected as trigger tokens & \\
        
        \textsc{Output}: & $\mathcal{T}$ & \; & trigger tokens & \\
        %\bottomrule
        \hline
    \end{tabular}
    \begin{algorithmic}[1]
        \State $C \gets$ get all (poisoned) code snippets from $X^p$

        \State $S \gets$ tokenize each code snippet in $C$ using the CodeLlama tokenizer

        \State $(\mathcal{T}, \Delta) \gets \emptyset$ \hfill\Comment{\textcolor{gray}{list of code tokens $\mathcal{T}$ and their corresponding influence on code naturalness $\Delta$}}

        \For{each code token sequence $s$ \textbf{in} $S$}
            \State $e \gets$ compute the cross-entropy of $f_{\theta}$ on $s$
            
            \State $(t^{m}, s^{m}) \gets$ produce a set of masked code token sequences by deleting one token from $s$ at a time \hfill\Comment{\textcolor{gray}{$t^{m}$ are masked tokens}}
            
            \For{each $(t^{m}_{i}, s^{m}_{i})$ \textbf{in} $(t^{m}, s^{m})$}
                \State $e^{m}_{i} \gets$ compute the cross-entropy of $f_{\theta}$ on $s^{m}_{i}$

                \If{$e^{m}_{i} < e$}
                   \State $\delta^{e}_{i} \gets e - e^{m}_{i}$
                   
                    \State $(\mathcal{T}, \Delta) \gets$ add $\{(t^{m}_{i}, \delta^{e}_{i})\}$ to $(\mathcal{T}, \Delta)$
                \EndIf
                
            \EndFor
        \EndFor
        
        \State $(\mathcal{T}, \Delta) \gets$ merge the elements in $(\mathcal{T}, \Delta)$ and sum \delete{the }$\delta$ values for identical tokens

        \State $\mathcal{T} \gets$ sort the elements in $(\mathcal{T}, \Delta)$ in descending order based on $\Delta$, and select the tokens in the top $k$ elements
    
        \State \Return $\mathcal{T}$
    \end{algorithmic}
\end{algorithm}
% \vspace{-4mm}

