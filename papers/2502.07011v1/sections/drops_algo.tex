\begin{algorithm}
\caption{DROP}
\label{alg:drop}
\SetKwInput{kwGlobals}{Globals input}
\SetKwFunction{FMain}{DROP}
\SetKwFunction{FClustering}{AgglomerativeClustering}
\SetKwFunction{FActivity}{UpdateActivity}
\SetKwFunction{FScore}{score}
\SetKwFunction{FDistillation}{KD}
\SetKwProg{Fn}{Function}{:}{}
\SetKwFor{ForEach}{for each}{do}{end}

\kwGlobals{initial model parameters $w_0$, total training rounds $T$, total client set $\mathcal{N}$, ban threshold $\tau_b$, generator $G$, clean seed set $\mathcal{D}_{\text{clean}}$, knowledge-distillation $KD$}

\For{each round $t \in \{1, \dots, T\}$}{
    \tcp{\textcolor{blue}{Step 1: Training and Update Collection}}
    \ForEach{client $c \in \mathcal{C}_t \subset \mathcal{N}$}{
        $w_c^t \leftarrow \text{ClientLocalTraining}(w_{t-1})$ \tcp*[r]{\textcolor{blue}{Client $c$ trains locally and returns update}}
    }
    
    \tcp{\textcolor{blue}{Step 2: Agglomerative Clustering}}
    $\mathcal{C}_{\text{b}}, \mathcal{C}_{\text{s}} \leftarrow \FClustering(\{w_c^t : c \in \mathcal{C}\})$ \tcp*[r]{\textcolor{blue}{Cluster client updates into \textbf{b}enign and \textbf{s}uspect groups}}
    
    \tcp{\textcolor{blue}{Step 3: Activity Monitoring}}
    \ForEach{client $c \in \mathcal{C}$}{
        \FActivity($c$) % \tcp*[r]{\textcolor{blue}{Update the activity score for client $c$}}
        \If{$c \in \mathcal{C}_{\text{b}} \land \FScore(c) \geq \tau_b$}{
            \tcp{\textcolor{blue}{Exclude $c$ if it exceeds penalty threshold}}
            $\mathcal{C}_{\text{b}} \leftarrow \mathcal{C}_{\text{b}} \setminus \{c\}$ %\tcp*[r]{\textcolor{blue}{Exclude client $c$ if it has exceeded penalty threshold}}
        }
    }
    
    \tcp{\textcolor{blue}{Aggregate model updates from benign clients}}
    $w_t \leftarrow \text{Aggregate}(\{w_c^t : c \in \mathcal{C}_{\text{b}}\})$ % \tcp*[r]{\textcolor{blue}{Aggregate model from benign client updates only}}

    \tcp{\textcolor{blue}{Step 4: Logit-Driven Model Distillation}}
    $w_t \leftarrow \FDistillation(w_t, \{w_c^t : c \in \mathcal{C}_{\text{b}}\}, G, \mathcal{D}_{\text{clean}})$ %\tcp*[r]{Use collective logits to cleanse the global model}

    \tcp{\textcolor{blue}{Step 5: Broadcast the Cleansed Global Model}}
        \ForEach{client $c \in \mathcal{C}$}{
            \text{Send}($c, w_t$);
        }
}


% \Fn{\FClustering{$\{w_c^t : c \in \mathcal{C}\}, \tau_c$}}{
%     Form clusters of client updates using agglomerative clustering with Ward linkage\;
%     Identify cluster(s) containing outlier updates using threshold $\tau_c$\;
%     \KwRet{$\mathcal{C}_{\text{benign}}, \mathcal{C}_{\text{suspect}}$} \tcp*[r]{Return benign and suspect client sets}
% }

% \Fn{\FActivity{$c$, isBenign}}{
%     \If{isBenign}{
%         Increase client $c$'s "benign score" by 1\;
%     }
%     \Else{
%         Increase client $c$'s "penalty score" by 1\;
%     }
%     \If{Client $c$'s "benign score" $\geq \tau_a \times$ "penalty score"}{
%         Allow client $c$ to rejoin $\mathcal{C}$ if it was previously banned\;
%     }
% }

% \Fn{\FDistillation{$w_t, \{w_c^t : c \in \mathcal{C}_{\text{benign}}\}, G$}}{
%     \tcp{** Logit Aggregation from Client Updates **}
%     Aggregate logits $\mathcal{L} \leftarrow \text{AverageLogits}(\{w_c^t : c \in \mathcal{C}_{\text{benign}}\})$ \tcp*[r]{Compute ensemble logits from benign clients}

%     \tcp{** Generator-Guided Knowledge Distillation **}
%     \For{$i = 1, \dots, N_{\text{distill}}$}{
%         Generate synthetic data $\mathcal{D}_{\text{synthetic}} \leftarrow G(\mathcal{L})$\;
%         Update $w_t$ using knowledge distillation loss on $\mathcal{D}_{\text{synthetic}}$\;
%     }
%     \KwRet{$w_t$} \tcp*[r]{Return the cleaned model}
% }
\end{algorithm}