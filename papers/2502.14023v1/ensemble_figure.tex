\begin{tikzpicture}[
    scale=0.7, % Increased scale for two-column width
    transform shape,
    teacher/.style={
        trapezium,
        trapezium angle=90,
        draw,
        fill=gray!20,
        minimum width=3cm,
        minimum height=0.5cm,
        font=\bfseries % Bold text
    },
    student/.style={
        trapezium,
        trapezium angle=90,
        draw,
        fill=#1!20,
        minimum width=2cm,
        minimum height=0.5cm,
        font=\bfseries % Bold text
    },
    feature/.style={
        rectangle,
        draw,
        minimum width=0.4cm,
        minimum height=0.5cm
    },
    arrow/.style={->, >=latex, thick}, % Back to thick arrows
    label/.style={font=\bfseries}, % Bold text
    image3d/.style={
        inner sep=0,
        draw, % Add border
        thick % Border thickness
    }
]

\pgfdeclarelayer{background}
\pgfsetlayers{background,main}

    % Input Image Batch (CIFAR-10) with 3D Depth Effect
    \foreach \i in {0,1,2,3} {
        \node[image3d, inner sep=0, minimum width=1.5cm, minimum height=1.5cm] 
            at ([xshift=\i*0.2cm, yshift=-\i*0.2cm]4, 0) 
            {\includegraphics[width=1.5cm, height=1.5cm]{cifar_images/cifar10_image_\i.png}};
    }
    \node[label] at (4, 1.5) {\textbf{Input Image}}; % Bold text

    % Teacher Network
    \node[teacher] (teacher) at (7, 1.5) {\textbf{Teacher Network}}; % Bold text
    \node[label] at (13.5, 2.5) {\textbf{Feature Vector}}; % Bold text
    
    % Teacher Features
    \foreach \i/\x in {1/blue!50, 2/blue!50, 3/red!50, 4/red!50, 
                       5/green!50, 6/green!50, 7/purple!100, 8/purple!100} {
        \node[feature, fill=\x] (tf\i) at (12, 4.0 - \i * 0.42) {};
    }

    % Draw arrow from Teacher Network to Feature Vector
    \draw[arrow] (teacher) -- (11.75, 1.75);

    % Student Networks
    \foreach \i/\col/\y in {1/blue/-0.5, 2/red/-2, 3/green/-3.5, 4/purple/-5} {
        \node[student=\col] (student\i) at (7, \y) {\textbf{Student \i}}; % Bold text
        \foreach \j in {1,2} {
            \node[feature, fill=\col!50] (s\i\j) at (10, \y + 0.5 - \j * 0.42) {};
        }
        \draw[arrow] (student\i) -- (s\i1);
    }

    % Concatenation
    \node[rectangle, draw, minimum height=3.8cm, minimum width=0.7cm, fill=white] 
        (concat) at (12, -2.125) {};
    
    % Concatenated features
    \foreach \i/\x in {1/blue!50, 2/blue!50, 3/red!50, 4/red!50,
                       5/green!50, 6/green!50, 7/purple!100, 8/purple!100} {
        \node[feature, fill=\x] (cf\i) at (12, -0.25 - \i * 0.42) {};
    }
    \node[label] at (12, -5) {\textbf{Concatenation}}; % Bold text

    % Output components
    \node[rectangle, draw, fill=purple!30, minimum width=1.8cm, minimum height=0.9cm] 
        (classifier) at (15.5, -2.125) {\textbf{Classification Head}}; % Bold text
    \node[circle, draw, fill=yellow!30, minimum width=1.5cm, minimum height=0.9cm] 
        (output) at (19, -2.125) {\textbf{Output}}; % Bold text
    \node[circle, draw, fill=yellow!30, minimum width=1.5cm, minimum height=0.9cm] 
        (target) at (19, 1.5) {\textbf{Target}}; % Bold text
    \node[rectangle, draw, fill=orange!30, minimum width=1.8cm, minimum height=0.9cm] 
        (celoss) at (17, 0) {\textbf{CE Loss}}; % Bold text
    \node[rectangle, draw, fill=orange!30, minimum width=1.8cm, minimum height=0.9cm] 
        (mse) at (14, 0) {\textbf{MSE Loss}}; % Bold text

    % Connections
    \coordinate (input) at (4, 0); % Define a coordinate for the input
    \begin{pgfonlayer}{background}
    \draw[arrow] (input) -- (teacher);
        \foreach \i in {1,...,4} {
            \draw[arrow] (input) -- (student\i);
        }
    \end{pgfonlayer}

    % Connect features to concatenation
    \foreach \i in {1,...,4} {
        \foreach \j in {1,2} {
            \draw[arrow] (s\i\j) -- (cf\the\numexpr 2*\i-2+\j);
        }
    }

    % Final connections
    \draw[arrow] (concat) -- (classifier);
    \draw[arrow] (cf1) -- (mse);
    \draw[arrow] (tf8) -- (mse);
    \draw[arrow] (output) -- (celoss);
    \draw[arrow] (target) -- (celoss);
    \draw[arrow] (classifier) -- (output);

    \node[draw, fill=white, circle] at ($(mse)!0.5!(celoss)$) {\textbf{+}}; % Bold text

\end{tikzpicture}