\subsection{Algorithm}\label{subsec:induced:cw}

In this section we show the following theorem.

\begin{theorem}\label{thm:induced:cw}
    There is an algorithm that,
    given a graph $G$ and an irredundant clique-width expression $\psi$ of $G$ of width $\cw$,
    counts the number of induced matchings of $G$ of each size $\ell \in [0,n/2]$ in time $\sO(3^\cw)$.
\end{theorem}

\begin{proof}
    Before describing our algorithm we start with some definitions and notation.
    Given a tuple $\sigma$, we refer to its $w$-th entry by $\sigma(w)$.
    Let $H$ be a graph and $S \subseteq V(H)$ a subset of its vertices.
    We say that a vertex $v \in S$ is \emph{unsaturated} in $H[S]$ if its degree is $\deg_{H[S]} (v) = 0$,
    else if $\deg_{H[S]} (v) = 1$ it is \emph{saturated} in $H[S]$ instead.
    We say that $S$ is a \emph{partial matching} of $H$ if the maximum degree of $H[S]$ is at most $1$,
    in which case all of its vertices are either saturated or unsaturated in $H[S]$.
    The \emph{size of a partial matching} $S$ of $H$ is equal to the number of its vertices, that is, $|S|$.
    Finally, we say that a partial matching $S$ of $H$ is \emph{extensible} if there exists an induced matching $M$ of $G$
    such that $V_M \cap V(H) = S$.


    Let $\mathcal{H}$ denote the set of all $\cw$-labeled graphs generated by a subexpression of $\psi$.
    For $H \in \mathcal{H}$ and $i \in [\cw]$,
    we define $\sgn_{H,i} \colon V(H) \to \{0,1,2\}$ for $S \subseteq V(H)$ as follows:
    \[
        \sgn_{H,i}(S) =
            \begin{cases}
                0   &\text{if $S \cap \lab^{-1}_H (i) = \varnothing$,}\\
                1   &\text{if $S \cap \lab^{-1}_H (i) \neq \varnothing$ and $\deg_{H[S]}(v) = 1$ for all $v \in S \cap \lab^{-1}_H (i)$,}\\
                2   &\text{if $S \cap \lab^{-1}_H (i) = \{v\}$ and $\deg_{H[S]}(v) = 0$.}
            \end{cases}
    \]
    We further define the tuple $\sgn_H(S) = \left( \sgn_{H,1}(S), \ldots, \sgn_{H,\cw}(S) \right)$ to be
    the \emph{signature} of $S$ in $H$ if $\sgn_{H,i}(S)$ is well-defined for all $i \in [\cw]$.
    Notice that $\sgn_H(S)$ is only defined for a subset of the partial matchings of $H$,
    while there are at most $3^{\cw}$ different signatures.
    For improved readability, we sometimes refer to tuples $\sigma \in \{0,1,2\}^{\cw}$ as signatures.
    We first argue that for any induced matching $M$ of $G$,
    the signature of $V_M \cap V(H)$ is well-defined for all $H \in \mathcal{H}$.

    \begin{claim}\label{claim:induced:cw:well_defined}
        Let $M$ be an induced matching of $G$.
        For all $H \in \mathcal{H}$ it holds that $\sgn_H (V_M \cap V(H))$ is well-defined.
    \end{claim}

    \begin{claimproof} %
        Notice that for all $H \in \mathcal{H}$ it holds that $H[V_M \cap V(H)]$ is a subgraph of $G[V_M]$,
        therefore the maximum degree of $H[V_M \cap V(H)]$ is at most $1$.
        Consequently, $V_M \cap V(H)$ is a partial matching of $H$.
        Fix $H \in \mathcal{H}$ and let $S = V_M \cap V(H)$.
        It suffices to prove that $\sgn_{H,i}(S)$ is well-defined for all $i \in [\cw]$.

        For the sake of contradiction, assume that $\sgn_{H,i}(S)$ is not well-defined for some $i \in [\cw]$.
        Since $S$ is a partial matching of $H$, that can only be the case when $S \cap \lab^{-1}_{H}(i)$ contains at least two vertices,
        say $v,v'$, and at least one of them, say $v$, is unsaturated in $H[S]$,
        that is, $\deg_{H[S]}(v) = 0$.
        Let $u \in V_M$ such that $\{v,u\} \in M$.
        Since $\deg_{H[S]}(v) = 0$ it holds that either $u \notin V(H)$ or $\{v,u\} \notin E(H)$.
        This means that at some point further in the clique-expression there exists a join operation with
        $H_1,H_2 \in \mathcal{H}$ and $H_2 = \eta_{i',j'}(H_1)$ that adds all edges between vertices of labels $i'$ and $j'$,
        with $v,v'$ having label $i'$ and $u$ having label $j'$.
        In that case however, it holds that the degree of $u \in V_M \cap V(H_2)$ in $H_2[V_M \cap V(H_2)]$
        is at least $2$ as it is adjacent to both $v$ and $v'$, a contradiction.
    \end{claimproof}

    Our algorithm proceeds by dynamic programming along $\psi$ in a bottom-up fashion.
    In particular, for every $H \in \mathcal{H}$ it stores a table $\DPt_H[\cdot,\cdot]$ where,
    for $k \in [0,n]$ and $\sigma \in \{0,1,2\}^{\cw}$, $\DPt_H[k,\sigma]$ contains
    the number of partial matchings $S$ of $H$ of size $k$ and signature $\sigma$,
    that is, with $|S|=k$ and $\sgn_H(S) = \sigma$.
    We now proceed to describe how to populate the DP tables.

    \proofsubparagraph{Singleton $H = i(v)$.}
    For $H = i(v)$, notice that $\lab^{-1}_H(i) = \{v\}$ and $\lab^{-1}_H(w) = \varnothing$ for all $w \in [\cw] \setminus \{i\}$.
    Consequently, for $k \in [0,n]$ and $\sigma \in \{0,1,2\}^{\cw}$ we set
    \begin{equation}\label{eq:DPH-singleton}
        \DPt_H[k,\sigma] =
            \begin{cases}
                1   &\text{if $k=0$ and $\sigma(w) = 0$ for all $w \in [\cw]$,}\\
                1   &\text{if $k=1$ and $\sigma(w) = 0$ for all $w \in [\cw] \setminus \{i\}$ and $\sigma(i) = 2$,}\\
                0   &\text{otherwise}.
            \end{cases}
    \end{equation}
    Notice that all but two entries in $\DPt_H[\cdot,\cdot]$ are $0$,
    and by \cref{eq:DPH-singleton} we can fill the table $\DPt_H[\cdot,\cdot]$ in time $\sO(3^{\cw})$.


    \input{Sections/induced_cw_join}

    \input{Sections/induced_cw_relabel}

    \input{Sections/induced_cw_union}

    \proofsubparagraph{Wrapping up.}
    We argue about the correctness of the algorithm by a bottom-up induction on the clique-width $\cw$-expression of~$G$.
    We claim that for all $H \in \mathcal{H}$, $k \in [0,k]$, and $\sigma \in \{0,1,2\}^{\cw}$,
    $\DPt_H[k,\sigma]$ is equal to the number of partial matchings in $H$ of size $k$ and signature $\sigma$.
    Let $H = i(v)$ be a singleton graph for some label $i \in [\cw]$.
    There are only two possible partial matchings in $H$, the first being $\{v\}$ and the second being $\varnothing$.
    Notice that then by \cref{eq:DPH-singleton}, the statement holds for singleton graphs.
    For the Join, Relabel, and Union nodes the statement holds due to
    \cref{lemma:induced:cw:join-correctness,lemma:induced:cw:relabel-correctness,lemma:induced:cw:union-correctness}.
    As for the algorithm's running time, notice that for any $\cw$-labeled graph $H \in \mathcal{H}$ arising in~$\psi$,
    the table $\DPt_H[\cdot,\cdot]$ can be filled in time~$\sO(3^{\cw})$.
    As the number of such graphs is~$\bO(|\psi|)$, this implies that our algorithm runs in time $\sO(3^{\cw})$.
    Finally, notice that for all $H \in \mathcal{H}$,
    the number of induced matchings of $H$ of size $\ell$ is equal to the sum of $\DPt_H[2\ell,\sigma]$
    over all $\sigma \in \{0,1\}^{\cw}$.
    This concludes the proof of \cref{thm:induced:cw}.
\end{proof}
