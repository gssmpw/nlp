%!TEX root = ../root.tex
\setlength{\textfloatsep}{0pt}% Remove \textfloatsep
\begin{algorithm}[hbt!]
\SetKwInput{KwInput}{Input}
\SetKwInput{KwInit}{Initialize}
\caption{\squint with Cutkosky Clipping}\label{alg:squint}
\KwInput{A prior distribution of the weights $\alpha_1$ for each expert}
\KwInit{Cumulative regret $R_1=0 \in \Real{N}$, Cumulative regret squared $V_1=0 \in \Real{N}$}
\For{$t=1,2,\dots, T$}{
    Compute $\ell_t$ as in \eqref{eq:probability-loss} and define the gradient $\tilde{g}_t = \nabla_{\alpha_t}(\ell_t) \in \Real{N}$ 
    
    Set $G_t = \max (\max_{i \in [N]}(|\tilde{g}_{t,i}|), G_{t-1})$ ($\tilde{g}_{t,i}$ denotes the $i$-th element of $\tilde{g}_t$) \label{line:Gt}
    
    % where ``$|\cdot|$'' and ``$\max$'' are applied element-wise \alex{How is max applied element wise? Shouldn't it be taking the max of the vector?}
    
    Define the clipped gradient $g_t = \frac{(\tilde{g}_t / G_t) + 1}{2} \in \Real{N}$ (element-wise division) \label{line:clip-gradient}
    
    Define the instantaneous regret $r_t = \alpha_t\tran g_t - g_t \in \Real{N}$\label{line:ins-regret}
    
    Update 
    \bea\label{eq:squint-update-alpha}
    \alpha_{t+1,i} = \frac{\alpha_{1,i} \xi(R_{t,i}, V_{t,i})}{\sum_i \alpha_{1,i} \xi(R_{t,i}, V_{t,i})}, \quad i=1,\dots,N
    \eea
    where
    \bea\label{eq:squint-error-function}
    \hspace{-4mm} \xi(R,V) = \sqrt{\pi} \exp{\left( \frac{R^2}{4V}\right)} \frac{\mathrm{erfc}(\frac{-R}{2\sqrt{V}})-\mathrm{erfc}(\frac{V-R}{2\sqrt{V}})}{2\sqrt{V}}
    \eea
    and $\mathrm{erfc}$ is the complementary error function $\mathrm{erfc}(x) := 1 - \frac{2}{\sqrt{\pi}} \int_0^x e^{-t^2} dt$
    
    Update $R_{t+1} = R_{t} + r_t$ and $V_{t+1} = V_{t} + r_t \circ r_t$ (``$\circ$'' denotes element-wise multiplication)\label{line:updateRV}
}
\end{algorithm}