\subsection{Preprocessing of the dataset.}
To standardize the image size and facilitate analysis, they were transformed to a resolution of 800 x 600 pixels. This resizing process is crucial to ensure the uniformity of the dataset, and this resizing is shown in Figure \ref{fig:redimension}.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.4\textwidth]{imagenes/materiales_metodos/preprocesamiento/redimension.png}
    \caption{a) Original image. b) 800 x 600 image.}
    \scriptsize \textit{Source:} Author's own creation
    \label{fig:redimension}
\end{figure}

To segment the fly within the image, three preprocessing stages were carried out: segmentation, cropping, and centering. These stages were implemented using the OpenCV library\footnote{OpenCV â€“ 4.9.0 is a library that offers advanced tools for solving computer vision problems through image and video processing.}. Each stage contributes to improving the accuracy and effectiveness of the subsequent analysis by appropriately preparing the images.

\textbf{Fly Segmentation.}
To train our models, we only need the fly area in the images. The following steps were used to segment the flies:
\begin{enumerate}
	\item The image was loaded.
	\item The image was resized to a standard size of 800 x 600 pixels using bilinear interpolation, which ensures good quality in resizing, as illustrated in Figure \ref{fig:redimension}-b.
	\item A median filter was applied to reduce "salt-and-pepper" noise and smooth the image, as shown in Figure \ref{fig:preprocesamiento}-1.
	\item The image was converted to the HSV color space, and a mask was created based on pixel selection within a specific range, as seen in Figures \ref{fig:preprocesamiento}-2 and \ref{fig:preprocesamiento}-3.
	\item The following morphological transformations were applied to the mask to improve segmentation:
	\begin{itemize}
		\item \textbf{Opening.} This operation removed smaller areas that did not contain relevant information, as shown in Figure \ref{fig:preprocesamiento}-4.
		\item \textbf{Dilation.} The selected area was expanded to include nearby relevant information, as seen in Figure \ref{fig:preprocesamiento}-5.
		\item \textbf{Closing.} This operation filled small areas within the regions identified by opening and dilation that were not previously selected, as observed in Figure \ref{fig:preprocesamiento}-6.
	\end{itemize}
	\begin{figure}[htbp]
		\centering
		\includegraphics[width=0.4\textwidth]{imagenes/materiales_metodos/preprocesamiento/preprocesamiento.png}
		\caption{Steps of image preprocessing.}
		\scriptsize \textit{Source:} Author's own creation
		\label{fig:preprocesamiento}
	\end{figure}
	\item The mask was combined with the original image to visualize the processed area, and the pixels with a value of 0 were changed to 255 to set the background in white, as shown in Figure \ref{fig:imagenfinal}.
	\begin{figure}[htbp]
		\centering
		\includegraphics[width=0.2\textwidth]{imagenes/materiales_metodos/preprocesamiento/imagen-final.jpg}
		\caption{Final preprocessed image.}
		\scriptsize \textit{Source:} Author's own creation
		\label{fig:imagenfinal}
	\end{figure}
\end{enumerate}

\textbf{Cropping.}
To focus the image and eliminate the irrelevant background, the cropped image was processed. The cropping process was carried out as follows:
\begin{enumerate}
	\item Using the mask obtained in the previous step, the largest contour in the segmented image was detected. The coordinates of this contour were identified and used to define the region to crop, as shown in Figure \ref{fig:recorte}-a.
	\item With the coordinates of the largest contour, the image was cropped, removing the background and retaining only the region of interest, as shown in Figure \ref{fig:recorte}-b.
\end{enumerate}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.3\textwidth]{imagenes/materiales_metodos/preprocesamiento/recorte.png}
    \caption{a) Largest contour found. b) Cropped image with coordinates of the largest contour.}
    \label{fig:recorte}
    \scriptsize \textit{Source:} Author's own creation
\end{figure}

\textbf{Centering.}
Once the image was segmented and cropped, it was resized to a uniform format. A size of 400 x 400 pixels was chosen, and the missing pixels of each image were filled to reach the desired dimensions, ensuring the image was centered within that space.
\begin{enumerate}
	\item A target size of 400 x 400 pixels was set for each image to avoid excessive reduction of images. 
	\item A scaling factor was determined as the quotient between the desired size and the largest value between the height and width of the original image. This ensures that the image is resized proportionally without distorting its dimensions.
	\item The image was resized using the calculated scaling factor, thus maintaining the original proportions. The resizing was performed using the cv2.resize function from OpenCV.
	\item The resized image was placed in a new 400 x 400 pixel image. The remaining area was filled with a white background to ensure the image maintained the desired uniform size. This was done using the cv2.copyMakeBorder function from OpenCV, which adds a white border around the resized image.
	\item The centered image was saved to a file for later use.
\end{enumerate}

As a result, an image was obtained that, after segmentation, cropping, and centering, has a uniform size of 400 x 400 pixels, as shown in Figure \ref{fig:centrada}.

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.2\textwidth]{imagenes/materiales_metodos/preprocesamiento/centrada.jpg}
    \caption{Segmented and centered image.}
    \scriptsize \textit{Source:} Author's own creation
    \label{fig:centrada}
\end{figure}