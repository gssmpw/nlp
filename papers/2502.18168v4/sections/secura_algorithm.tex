\SetAlFnt{\small}

\begin{algorithm}[htbp]  % 将H修改为htbp，允许更灵活的排版
\caption{SECURA Methodology}
\label{alg:secura}
\SetAlgoLined
\DontPrintSemicolon
\textbf{Input}: Base weights $\mathcal{W}_{\text{base}}$, hyperparameters $r, m, \epsilon, \text{Scale}$ \\
\textbf{Output}: Updated weights $\mathcal{W}_{\text{updated}}$

\underline{\textbf{Step 1: CABR-LoRA Decomposition}} \\
1. \textit{Initialize CABR matrices}: 
\quad $\mathcal{W}_{\text{frozen}} = \mathcal{U}_{\text{SVD}} \mathcal{S}_{\text{SVD}} \mathcal{V}_{\text{SVD}}^{\top}.$ \tcp*{SVD of base weights} 
\quad $\mathcal{W}_A \gets \mathcal{U}_{\text{SVD}}^{(r,:)} \mathcal{S}_{\text{SVD}} \mathcal{V}_{\text{SVD}}^{(:,m) \top}$ \tcp*{Truncated SVD for $A$} 
\quad $\mathcal{W}_B \gets \text{Zeros}(m \times r)$ \tcp*{Zero-initialized $B$} 
\quad $\mathcal{W}_{\text{CABR}} \gets C \cdot \mathcal{W}_A \cdot \mathcal{W}_B \cdot R$ \tcp*{CABR reconstruction}

\underline{\textbf{Step 2: S-MagNorm Normalization}} \\
2. \textit{Merge weights}: \\
\quad $\mathcal{W}_{\text{SECURAMerged}} \gets \mathcal{W}_{\text{CABR}} + \mathcal{W}_{\text{base}}$ \\
3. \textit{Compute magnitude ratio}: \\
\quad $\mathcal{M}_{\text{Mag}} \gets \left|\frac{\mathcal{W}_{\text{SECURAMerged}}}{\mathcal{W}_{\text{base}} + \epsilon}\right|$ \tcp*{Avoid division by zero} 
4. \textit{Normalize and scale}: \\
\quad $\mathcal{M}_{\text{norm}} \gets \left[\frac{\mathcal{M}_{\text{Mag}}}{\max(\mathcal{M}_{\text{Mag}}) + \epsilon} - 0.5\right] \cdot \text{Scale}$ \\
5. \textit{Apply Sigmoid constraint}: \\
\quad $\mathcal{M}_{\text{Res}} \gets 2 - \sigma(\mathcal{M}_{\text{norm}})$ \tcp*{$\sigma$: Sigmoid function} 
6. \textit{Adjust updates}: \\
\quad $\mathcal{W}_{\text{updated}} \gets \mathcal{W}_{\text{SECURAMerged}} / \mathcal{M}_{\text{Res}}$ \tcp*{Element-wise division}

\underline{\textbf{Step 3: Merge Strategy (M1/M2)}} \\
7. \If{M1 (Deep Merge)}{
    \quad $\mathcal{W}_{\text{updated}} \gets C A_{\text{former}} B_{\text{train}} R + \mathcal{W}_{\text{base}}$ \tcp*{Update base weights}
}
\ElseIf{M2 (Shallow Merge)}{
    \quad $\mathcal{W}_{\text{mergedBase}} \gets C A_{\text{frozen}} B_{\text{accum}} R + \mathcal{W}_{\text{base}}$ \\
    \quad $\mathcal{W}_{\text{merged}} \gets \mathcal{W}_{\text{mergedBase}} + C A_{\text{train}} B_{\text{reset}} R$ \tcp*{Preserve $\mathcal{W}_{\text{basic}}$}
}
\Return $\mathcal{W}_{\text{updated}}$
\end{algorithm}
