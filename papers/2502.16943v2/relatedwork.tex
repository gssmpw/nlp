\section{Related works}
Recent approaches for unsupervised anomaly detection (UAD) in brain MRI can mainly be divided in three categories: methods based on different variants of autoencoders (AEs), those using generative adversarial networks (GANs) and the ones based on diffusion models. 


\mypar{AE-based methods.~} Approaches in this category train an autoencoder on normal data to accurately reconstruct input images. At inference, the reconstruction error measured at each pixel is used to localize anomalies. Different networks have been explored for the reconstruction, including standard autoencoders (AE) \cite{atlason2019unsupervised,baur2021autoencoders}, variational autoencoders (VAEs) \cite{baur2021autoencoders,silva2022constrained,zimmerer2019unsupervised} and denoising autoencoders (DAEs) \cite{kascenas2022denoising}. A common issue with these methods is their propensity to overfit the training data, leading to a poor generalization on unseen data. Furthermore, they are prone to blurry reconstructions, struggling to accurately distinguish subtle anomalies from normal variations, especially when relying solely on reconstruction error as a measure of abnormality.

\mypar{GAN-based methods.~} These approaches employ an adversarial learning strategy where a generator and a discriminator are jointly trained on healthy subject images to learn a latent representation of normal variability. AnoGAN~\cite{schlegl2017unsupervised} measures anomaly scores based on a combination of reconstruction error and distance in the latent space. f-AnoGAN~\cite{schlegl2019fast} improves upon this work by incorporating an additional feature-level reconstruction strategy, yielding a more precise localization of anomalies. The work in~\cite{baur2020steganomaly} uses a style transfer method based on CycleGANs to map real MR images of healthy brains to synthetic ones, and vice versa. Anomalies are then detected by comparing input images to their reconstruction. While the ability of GANs to generate high-quality images can translate in a more detailed delineation of anomalies, they are also prone to training instability and are often sensitive to hyperparameter choices.

\mypar{Diffusion-based method.~} 
Diffusion models have gained significant attention in computer vision for their ability to generate high-fidelity images \cite{croitoru2023diffusion}. Recently, these models have also shown promise in various medical image analysis tasks including UAD~\cite{behrendt2023patched,iqbal2023unsupervised,behrendt2024leveraging,bercea2024diffusion,liang2024itermask2,naval_marimont2024disyre,naval2024ensembled,wyatt2022anoddpm}. A prominent diffusion-based method for UAD in medical images,  
AnoDDPM~\cite{wyatt2022anoddpm} utilizes a partial diffusion strategy, adding noise to an image up to a specific timestep and then recovering the original image with a reverse diffusion process. This method has shown success in detecting anomalies in brain MRI and other domains.   PDDPM~\cite{behrendt2023patched} instead applies the diffusion process in a patch-wise manner, aiming to improve the understanding of local image context and achieve better anatomical coherence in the reconstruction. This method divides the image into overlapping patches and reconstructs each patch while considering its unperturbed surroundings. CDDPM~\cite{behrendt2024leveraging} generates multiple reconstructions via the reverse diffusion process and pinpoints anomalies by examining the distribution of these reconstructions with the Mahalanobis distance, subsequently labeling outliers as anomalies. MDDPM\cite{iqbal2023unsupervised} incorporates masking-based regularization, applied on both image patches and in the frequency domain, to enhance unsupervised anomaly detection. AutoDDPM \cite{bercea2023mask} incorporates automatic masking, stitching, and resampling techniques within the DDPM framework to enhance its robustness and accuracy in anomaly detection. This approach also addresses the challenge of selecting an appropriate noise level for detecting lesions of various sizes. However, the diffusion-based UAD models mentioned above rely heavily on a forward diffusion process that inherently results in information loss. Consequently, these methods often fail to accurately reconstruct the original healthy brain structures, leading to false-positive detections where normal regions are incorrectly identified as anomalous. This issue is particularly prominent in brain anomaly detection tasks, as brain structures, especially cortical regions, vary uniquely across individuals, thereby increasing the difficulty of accurately recovering normal anatomical variations.

%Moreover, 
A recently proposed method, DISYRE \cite{naval_marimont2024disyre,naval2024ensembled}, uses a diffusion-like pipeline to train a model to restore images that have been corrupted with synthetic anomalies. Anomalies in a new image are detected based on the model's ability to restore the image to a healthy state. A key limitation of this method is that the synthetic anomalies may not encompass all types of real-world anomalies, limiting its generalization ability. THOR \cite{bercea2024diffusion} integrates implicit guidance into the DDPM's denoising process using intermediate masks to preserve the integrity of healthy tissue details. It aims to ensure a faithful reconstruction of the original image in areas unaffected by pathology, minimizing false positives. However, since these intermediate masks are determined based on the perceptual differences between input images and their reconstruction at each step, the model may struggle to detect subtle or small anomalies, as they might be masked out due to their minimal differences with the input image. Additionally, reconstruction errors may occur due to the loss of details during the forward process, with normal regions not getting masked due to their high perceptual differences. Inspired by diffusion-based models, IterMask$^2$ \cite{liang2024itermask2} incorporates an iterative spatial mask refinement process and frequency masking to enhance UAD performance. This strategy minimizes information loss in normal areas by iteratively shrinking a spatial mask, starting from the whole brain towards the anomaly. Although the model performs well in detecting hypo- or hyper-intense areas, it can fail to localize structural anomalies such as atrophy or enlarged ventricles as their reconstruction is conditioned on structural information from high-frequency image components which can be recovered by the model.