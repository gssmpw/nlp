
\section{Experimental results}\label{chap3/sec:experiments}

The previous section showed how to leverage watermarks for detection and identification of images generated from text prompts.
We now present more general results on robustness and image quality for different generative tasks.
We also compare Stable Signature to post-generation watermarking algorithms.




\subsection{Image generation quality}

\begin{figure}[b!]
    \centering
    \setlength{\tabcolsep}{0pt}
    \resizebox{0.85\linewidth}{!}{
    \begin{tabular}{c @{\hspace{0.1cm}} c @{\hspace{0.1cm}} c}
        \toprule
        Generated with original & Generated with watermark & Pixel-wise difference ($\times 10$) \\
        \midrule
        \includegraphics[width=0.33\linewidth]{chapter-3/figs/qual/01_nw.jpg} &
        \includegraphics[width=0.33\linewidth]{chapter-3/figs/qual/01_w.jpg} &
        \includegraphics[width=0.33\linewidth]{chapter-3/figs/qual/01_diff.jpg} \\ 
        \rule{0pt}{0.2cm}
        \includegraphics[width=0.33\linewidth]{chapter-3/figs/qual/02_nw.jpg} &
        \includegraphics[width=0.33\linewidth]{chapter-3/figs/qual/02_w.jpg} &
        \includegraphics[width=0.33\linewidth]{chapter-3/figs/qual/02_diff.jpg} \\       
        \bottomrule\\
    \end{tabular}
    }
    \caption{
    Images generated from text prompts. 
    The PSNR is $35.4$\,dB in the first row and $28.6$\,dB in the second.
    Images generated with Stable Signature look natural because modified areas are located where the eye is not sensitive.
    }
    \label{chap3/fig:qualitative}
\end{figure}

\autoref{chap3/fig:qualitative} shows qualitative examples of how the image generation is altered by the latent decoder's fine-tuning. 
The difference is very hard to perceive even for a trained eye. 
This is surprising for such a low PSNR, especially since the watermark embedding is not constrained by any human visual system like in professional watermarking techniques. 
Most interestingly, the LDM decoder has indeed learned to add the watermark signal only over textured areas where the human eyes are not sensitive, while the uniform backgrounds are kept intact (see the pixel-wise difference).
Figures~\ref{chap3/fig:supp-watermark}, \ref{chap3/fig:supp-txt2img}, \ref{chap3/fig:supp-inpaint} and \ref{chap3/fig:supp-sr} provide additional qualitative results for different watermarking methods, text-to-image generation, inpainting and super-resolution tasks.

\autoref{chap3/tab:quality-watermarking} presents a quantitative evaluation of image generation on the different tasks.
We report the FID, and the average PSNR and SSIM that are computed between the images generated by the fine-tuned LDM and the original one.
The results show that no matter the task, the watermarking has very small impact on the FID of the generation.

The average PSNR is around $30$~dB and SSIM around $0.9$ between images generated by the original and a  watermarked model.
This is a bit low from a watermarking perspective, because we do not explicitly optimize for them.
However, in a real world scenario, one would only have the watermarked version of the image. 
Therefore it is not as important to be extremely close to the original image, we just need to generate artifacts-free images. Without access to the image generated by the original LDM, it is very hard to tell whether a watermark is present or not.




\begin{figure}[H]
\centering
    \scriptsize
    \newcommand{\imwidth}{0.165\textwidth}
        \setlength{\tabcolsep}{0pt}
        \begin{tabular}{c@{\hskip 2pt}ccccc}
        \toprule
        Original & Stable Signature & Dct-Dwt & SSL Watermark & FNNS & HiDDeN \\
        \midrule
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/00_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/00_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/dctdwt/00_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/ssl/00_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/fnns/00_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/hidden/00_w.jpg} \\

            &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/00_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/dctdwt/00_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/ssl/00_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/fnns/00_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/hidden/00_diff.jpg} \\
        \rule{0pt}{6ex}%

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/01_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/01_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/dctdwt/01_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/ssl/01_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/fnns/01_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/hidden/01_w.jpg} \\

            &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/01_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/dctdwt/01_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/ssl/01_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/fnns/01_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/watermark/hidden/01_diff.jpg} \\
    \\
    \end{tabular}
\caption{\label{chap3/fig:supp-watermark} Qualitative results for different watermarking methods on generated images at resolution $512$.}
\end{figure}

\begin{figure}[H]
\centering
    \scriptsize
    \newcommand{\imwidth}{0.165\textwidth}
        \setlength{\tabcolsep}{0pt}
        \begin{tabular}{ccc@{\hskip 2pt}ccc}
        \toprule
        Original & Watermarked & Difference & Original & Watermarked & Difference \\
        \midrule
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/00_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/00_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/00_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/01_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/01_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/01_diff.jpg} \\
        \rule{0pt}{6ex}%

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/03_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/03_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/03_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/06_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/06_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/06_diff.jpg} \\
        \rule{0pt}{6ex}%

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/08_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/08_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/08_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/09_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/09_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/09_diff.jpg} \\
        \rule{0pt}{6ex}%

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/10_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/10_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/10_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/14_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/14_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/14_diff.jpg} \\
        \rule{0pt}{6ex}%
        
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/15_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/15_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/15_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/16_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/16_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/16_diff.jpg} \\
        \rule{0pt}{6ex}%

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/17_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/17_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/17_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/18_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/18_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/txt2img/18_diff.jpg} \\
    \bottomrule \\
    \end{tabular}
\caption{\label{chap3/fig:supp-txt2img} Qualitative results on prompts of the validation set of MS-COCO, at resolution $512$ and for a $48$-bits signature.
Images are generated from the same latents, with original or watermarked generative models.}
\end{figure}
    
\begin{figure}[H]
    \centering
    \scriptsize
    \newcommand{\imwidth}{0.124\textwidth}
    \setlength{\tabcolsep}{0pt}
    \begin{tabular}{cc@{\hskip 2pt}ccc@{\hskip 2pt}ccc}
        \toprule
        Image to inpaint & Mask & Original & Watermarked & Difference & Original & Watermarked & Difference \\
        \midrule
        \hspace{0pt}
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/00_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/00_mask.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/00_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/00_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/00_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/00_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/00_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/00_diff.jpg} \\
        \rule{0pt}{6ex}

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/01_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/01_mask.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/01_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/01_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/01_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/01_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/01_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/01_diff.jpg} \\
        \rule{0pt}{6ex}

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/02_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/02_mask.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/02_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/02_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/02_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/02_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/02_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/02_diff.jpg} \\
        \rule{0pt}{6ex}

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/03_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/03_mask.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/03_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/03_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/03_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/03_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/03_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/03_diff.jpg} \\
        \rule{0pt}{6ex}

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/04_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/04_mask.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/04_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/04_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/04_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/04_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/04_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/04_diff.jpg} \\
        \rule{0pt}{6ex}

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/05_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/05_mask.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/05_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/05_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-full/05_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/05_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/05_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/inpaint-mask/05_diff.jpg} \\
        \bottomrule \\
    \end{tabular}
    \caption{
        \label{chap3/fig:supp-inpaint} Qualitative results for inpainting on ImageNet with original or watermarked generative models.
        We consider 2 scenarios: 
        (middle) the full image is modified to fill the masked area, 
        (right) only the masked area is filled.
        Since our model is not fine-tuned for inpainting, the last scenario introduces copy-paste artifacts.
        From a watermarking point of view, it is also the more interesting, since the watermark signal is only present in the masked area (and erased wherever the image to inpaint is copied).
        Even in this case, the watermark extractor achieves bit accuracy significantly higher than random.
    }
\end{figure}

\begin{figure}[H]
    \centering
    \scriptsize
    \newcommand{\imwidth}{0.124\textwidth}
    \setlength{\tabcolsep}{0pt}
    \begin{tabular}{cccc@{\hskip 2pt}cccc}
        \toprule
        Low resolution & Original & Watermarked & Difference & Low resolution & Original & Watermarked & Difference \\
        \midrule
        \hspace{0pt}
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/00_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/00_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/00_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/00_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/05_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/05_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/05_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/05_diff.jpg} \\
        \rule{0pt}{6ex}

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/01_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/01_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/01_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/01_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/06_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/06_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/06_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/06_diff.jpg} \\
        \rule{0pt}{6ex}

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/03_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/03_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/03_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/03_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/07_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/07_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/07_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/07_diff.jpg} \\
        \rule{0pt}{6ex}

        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/04_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/04_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/04_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/04_diff.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/08_ori.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/08_nw.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/08_w.jpg} &
        \includegraphics[width=\imwidth]{chapter-3/figs/supp/sr/08_diff.jpg} \\
        \bottomrule \\
    \end{tabular}
    \caption{
        \label{chap3/fig:supp-sr} Qualitative results for super-resolution on ImageNet, with original and watermarked generative models.
        Low resolution images are $128\times128$, and upscaled to $512\times512$ with an upscaling factor $f=4$.
    }
\end{figure}






\begin{table}[t!]
    \centering
    \caption{
        Generation quality and comparison to post-hoc watermarking on 512$\times$512 images and $48$-bit signatures.
        PSNR and SSIM are computed between generations of the original and watermarked generators.
        For FID, we show in {\color{orange} (color)} the difference with regards to original.
        Post-hoc watermarking is evaluated on text-generated images.
        Overall, Stable Signature has minimal impact on generation quality. 
        It has comparable robustness to post-hoc methods while being rooted in the generation itself.
        \autoref{chap3/app:implementation-details} gives additional details on methods, baselines, metrics and transformations.
    }\label{chap3/tab:quality-watermarking} 
    \footnotesize
    \setlength{\tabcolsep}{4pt}
        \begin{tabular}{ c l @{\hspace{2pt}} l  *{2}{c} *{4}{p{25pt}}}
        \toprule
       & & \multirow{2}{*}{}          & \multirow{2}{*}{PSNR / SSIM $\uparrow$} & \multirow{2}{*}{FID $\downarrow$} &\multicolumn{4}{c}{Bit accuracy $\uparrow$ on:} \\ 

    &                                         &                           &           &                                            &  None & Crop & Brigh. & Comb.  \\ \midrule
\multirow{6}{*}{\rotatebox[origin=c]{90}{Tasks}}  
        & Text-to-Image                      & LDM             & $30.0$ / $0.89$   & $19.6$ \color{orange}{($-0.3$)} & $0.99$ & $0.95$ & $0.97$ & $0.92$ \\ \cmidrule{2-9}
       & Image Edition                       & DiffEdit                  & $31.2$ / $0.92$ & $15.0$ \color{orange}{($-0.3$)}       & $0.99$ & $0.95$ & $0.98$ & $0.94$ \\ \cmidrule{2-9}
       & Inpainting - Full          & \multirow{2}{*}{Glide}  & $31.1$ / $0.91$  & $16.8$ \color{orange}{($+0.6$)} & $0.99$ & $0.97$ & $0.98$ & $0.93$ \\ 
       & {\color{white}Inpa} - Mask only          &                                   & $37.8$ / $0.98$  & $9.0$~~ \color{orange}{($+0.1$)} & $0.89$ & $0.76$ & $0.84$ & $0.78$\\ \cmidrule{2-9}
       & Super-Resolution & LDM  & $34.0$ / $0.94$ & $11.6$ \color{orange}{($+0.0$)}      & $0.98$ & $0.93$ & $0.96$ & $0.92$ \\ 
    \midrule \rule{0pt}{8pt} \rule{0pt}{8pt} 
\multirow{7}{*}{\rotatebox[origin=c]{90}{WM Methods}} 
           & \emph{Post generation} \\
           & DCT-DWT                      & $0.14$ (s/img)      &  $39.5$ / $0.97$  & $19.5$ \color{orange}{($-0.4$)} & $0.86$ & $0.52$ & $0.51$ & $0.51$ \\ 
           & SSL Watermark  & $0.45$ (s/img)      &  $31.1$ / $0.86$  & $20.6$ \color{orange}{($+0.7$)} & $1.00$ & $0.73$ & $0.93$ & $0.66$ \\ 
           & FNNS          & $0.28$ (s/img)      &  $32.1$ / $0.90$  & $19.0$ \color{orange}{($-0.9$)} & $0.93$ & $0.93$ & $0.91$ & $0.93$ \\ 
           & HiDDeN                        & $0.11$ (s/img)      &  $32.0$ / $0.88$  & $19.7$ \color{orange}{($-0.2$)} & $0.99$ & $0.97$ & $0.99$ & $0.98$ \\ \cmidrule{2-9}
           & \emph{Merged in generation} \\
           & Stable Signature                            & $0.00$ (s/img)             &  $30.0$ / $0.89$ & $19.6$ \color{orange}{($-0.3$)}     & $0.99$ & $0.95$ & $0.97$ & $0.92$ \\ 
        \bottomrule
    \end{tabular}
\end{table}





\subsection{Watermark robustness}\label{chap3/subsec:robustness}

We evaluate the robustness of the watermark to different image transformations applied before extraction.
For each task, we generate $1$k images with $10$ models fine-tuned for different messages, and report the average bit accuracy in Tab.~\ref{chap3/tab:quality-watermarking} (as a reminder, the watermark is a $48$-bit binary key).
Additionally, \autoref{chap3/tab:robustness} reports results on more image transformations for images generated from COCO prompts, and \autoref{chap3/tab:supp-robustness} reports robustness results on more tasks and transformations.




\begin{table}[t!]
    \centering
    \caption{
        Watermark robustness to transformations.
        We report the bit accuracy, averaged over $10\times1$k images generated from COCO prompts with $10$ different keys.
    }\label{chap3/tab:robustness}
    \footnotesize
    \setlength{\tabcolsep}{4pt}
    \resizebox{0.96\linewidth}{!}{
        \begin{tabular}{ll|ll|ll|ll}
            \toprule
            \bf{Attack}             & \bf{Bit acc.}     & \bf{Attack}         & \bf{Bit acc.} & \bf{Attack} & \bf{Bit acc.} & \bf{Attack} & \bf{Bit acc.} \\
            \midrule
            None                    & $0.99$            & Crop $0.1$          & $0.95$        & JPEG $50$   & $0.88$        & Comb.       & $0.92$ \\
            Sharpness $2.0$         & $0.99$            & Bright. $2.0$       & $0.97$        & Cont. $2.0$ & $0.98$        & Sat. $2.0$  & $0.99$ \\
            Med. Filter $k$=7       & $0.94$            & Resize $0.7$        & $0.91$        & Text overlay & $0.99$       &             &        \\
            \bottomrule
        \end{tabular}
    }
\end{table}


\newcommand{\rota}[1]{\rotatebox{25}{\footnotesize\hspace{-0cm}#1}}
\begin{table}[t]
\centering
\caption{
    Watermark robustness on different tasks and image transformations applied before decoding.
    We report the bit accuracy, averaged over $10\times1$k images generated with $10$ different keys.
    The combined transformation is a combination Crop $50\%$, Brightness $1.5$ and JPEG $80$.
    More detail on the evaluation is available in Sec.~~\ref{chap3/app:generative-tasks}. \\
}\label{chap3/tab:supp-robustness}
\vspace*{-0.5cm}
\resizebox{1.0\linewidth}{!}{
    \footnotesize
    \begin{tabular}{ *{2}{l} *{11}{p{1.0cm}} }
    \toprule
    \multirow{2}{*}{Task}                       & \multirow{2}{*}{}       & \multicolumn{9}{c}{Image transformation} \\ \cmidrule{3-12}
                                                &                       &  \rota{None} & \rota{Crop $0.1$} & \rota{JPEG $50$} & \rota{Resi. $0.7$} & \rota{Bright. $2.0$} & \rota{Cont. $2.0$} & \rota{Sat. $2.0$} & \rota{Sharp. $2.0$} & \rota{Text over.} & \rota{Comb.}\\ \midrule
     Text-to-Image          & LDM                         & $0.99$ & $0.95$ & $0.88$ & $0.91$ & $0.97$ & $0.98$ & $0.99$ & $0.99$ & $0.99$ & $0.92$ \\ \midrule
     Image Edition          & DiffEdit & $0.99$ & $0.95$ & $0.90$ & $0.91$ & $0.98$ & $0.98$ & $0.99$ & $0.99$ & $0.99$ & $0.94$\\ \midrule
     Inpainting - Full      & \multirow{2}{*}{Glide}     & $0.99$ & $0.97$ & $0.88$ & $0.90$ & $0.98$ & $0.99$ & $0.99$ & $1.00$ & $0.99$ & $0.93$ \\ 
    {\color{white}Inpa} - Mask only   &                                         & $0.89$ & $0.76$ & $0.73$ & $0.77$ & $0.84$ & $0.86$ & $0.89$ & $0.91$ & $0.89$ & $0.78$ \\  \midrule
     Super-Resolution & LDM & $0.98$ & $0.93$ & $0.86$ & $0.85$ & $0.96$ & $0.96$ & $0.97$ & $0.98$ & $0.98$ & $0.92$\\ 
    \bottomrule
    \end{tabular}
}
\end{table}

We see that the watermark is indeed robust for several tasks and across transformations, and most often yields above $0.9$ bit accuracy.
\emph{With regards to the tasks}, the bit accuracy is not really altered, except for inpainting, when replacing only the masked region of the image (between $1-50$\% of the image, with an average of $27\%$ across masks).
This is expected, as the watermark is not present in the masked region.
\emph{With regards to the transformations}, the resize and JPEG $50$ transformations seem to be the most challenging ones, and sometimes get bellow $0.9$.
Note that the crop location is not important but the visual content of the crop is, \eg, there is no way to decode the watermark on crops of blue sky (this is the reason we only show center crop).
Besides, the bit accuracy is not perfect even without edition, mainly because there are images that are hard to watermark (\eg, the ones that are very uniform, like the background in Fig.~\ref{chap3/fig:qualitative}) and for which the accuracy is lower.

Note that the robustness comes even without any transformation during the LDM fine-tuning phase:
it is due to the watermark extractor.
If the watermark embedding pipeline is learned to be robust against an augmentation, then the LDM learns how to produce watermarks that are robust against it during fine-tuning.






\subsection{Comparison to post-hoc watermarking}\label{chap3/subsec:watermarking}

An alternative way to watermark generated images is to process them after the generation (post-hoc). 
This may be simpler, but less secure and efficient than Stable Signature.
We compare our method to a frequency based method, DCT-DWT~\cite{invisible-watermark},
iterative approaches (SSL Watermark~\citep{fernandez2022sslwatermarking} and FNNS~\citep{kishore2021fixed}), and an encoder/decoder one like HiDDeN~\citep{zhu2018hidden}.
We choose DCT-DWT since it is employed by the Stable Diffusion repository~\citep{2022stablediffusion}, and the other methods because of their performance and their ability to handle arbitrary image sizes and number of bits.
We use our implementations (see details in Sec.~\ref{chap3/app:watermarking}).

\autoref{chap3/tab:quality-watermarking} compares the generation quality and the robustness over $5$k generated images.
Overall, we achieve comparable results in terms of robustness. 
HiDDeN's performance is a bit higher but its output bits are not i.i.d. meaning that it cannot be used with the same guarantees as the other methods.
We also observe that our post-hoc watermarking tend to present artifacts (see Fig.~\ref{chap3/fig:supp-watermark}).
One explanation is that Stable Signature is merged into the high-quality generation process with the LDM autoencoder model, which is able to modify images in a more subtle way.




























