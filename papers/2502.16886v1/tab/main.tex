\begin{table*}[!t]
\centering
\resizebox{\textwidth}{!}{
\begin{tabular}{c|ccccccccccccccc}
\toprule[1.3pt]
                & \multirow{4}{*}{~~\textbf{Methods}} & \multicolumn{3}{c}{\textbf{Math \& Science}}  & \multicolumn{2}{c}{\textbf{CR}} & \multicolumn{2}{c}{\textbf{Single-Doc QA}} & \multicolumn{2}{c}{\textbf{Multi-Doc QA}} & \multicolumn{2}{c}{\textbf{Summarization}} & \multicolumn{1}{c}{\textbf{FSL}}  & \textbf{Code} &\multirow{4}{*}{~~\textbf{Avg.}} \\  \cmidrule(lr){3-5} \cmidrule(lr){6-7}  \cmidrule(lr){8-9} \cmidrule(lr){10-11} \cmidrule(lr){12-13} \cmidrule(lr){14-14} \cmidrule(lr){15-15}             
          &                          & \rotatebox[origin=c]{45}{GSM8K}&\rotatebox[origin=c]{45}{GPQA}&\rotatebox[origin=c]{45}{TheoQA} & \rotatebox[origin=c]{45}{ThQA}  & \rotatebox[origin=c]{45}{CoQA}                  & \rotatebox[origin=c]{45}{NrtvQA}           & \rotatebox[origin=c]{45}{Qasper}            & \rotatebox[origin=c]{45}{2WkMQA}        & \rotatebox[origin=c]{45}{Musique}        & \rotatebox[origin=c]{45}{QMSum}         & \rotatebox[origin=c]{45}{M-News}                    & \rotatebox[origin=c]{45}{TriviaQA}              & \rotatebox[origin=c]{45}{Lcc} & \\ \hline
\multirow{6}{*}{\rotatebox{90}{\textbf{Llama3-8B-Instruct  }}}      & \cellcolor{blue!20}Full                      & \cellcolor{blue!20}75.28 & \cellcolor{blue!20}29.02&\cellcolor{blue!20}21.29 & \cellcolor{blue!20}25.59 
  &\cellcolor{blue!20}52.74                 & \cellcolor{blue!20}24.06              & \cellcolor{blue!20}43.91             & \cellcolor{blue!20}35.33           & \cellcolor{blue!20}14.77          & \cellcolor{blue!20}22.27         & \cellcolor{blue!20}27.37                  & \cellcolor{blue!20}70.26                 &   \cellcolor{blue!20}19.16  &\cellcolor{blue!20}100\% \\
          & \cellcolor{teal!20}Ours$_{k=1}$                     & \cellcolor{teal!20}\textbf{76.50} &\cellcolor{teal!20}\textbf{30.13} & \cellcolor{teal!20}\textbf{23.03} &  \cellcolor{teal!20}\textbf{26.09}  &  \cellcolor{teal!20}\textbf{52.86}            &\cellcolor{teal!20} 23.44              & \cellcolor{teal!20}37.38             &   \cellcolor{teal!20}\textbf{36.21}              & \cellcolor{teal!20}\textbf{15.96}          & \cellcolor{teal!20}21.95         & \cellcolor{teal!20}\textbf{27.88}                    &        \cellcolor{teal!20}64.24                &  \cellcolor{teal!20}19.31  &\cellcolor{teal!20}\textbf{+0.12\%}  \\
          & \cellcolor{pink!30}\textit{Budget}              & \cellcolor{pink!30}\textit{93.2\%} & \cellcolor{pink!30}\textit{86.7\%}& \cellcolor{pink!30}\textit{92.8\%}& \cellcolor{pink!30}\textit{78.7\%}   & \cellcolor{pink!30}\textit{81.5\%}                 & \cellcolor{pink!30}\textit{48.7\%}              & \cellcolor{pink!30}\textit{46.4\%}             &      \cellcolor{pink!30}\textit{45.8\%}           & \cellcolor{pink!30}\textit{43.7\%}          & \cellcolor{pink!30}\textit{15.0\%}        & \cellcolor{pink!30}\textit{76.4\%}                   &     \cellcolor{pink!30}\textit{41.0\%}                 &   \cellcolor{pink!30}\textit{78.0\%}  & \cellcolor{pink!30}\textit{63.68}\%\\
          & H2O$_{0.9}$           & 74.60   &28.13& 21.69 & 25.41& 52.83  &    \textbf{24.55}                &     41.73              &       33.95          &         15.23       &      \textbf{22.51}         &   27.64                        &    69.77                 &   19.13        &-0.39\%    \\
          & SLM$_{0.9}$       &   72.78 &28.79& 20.75 &25.15 &  52.83            &  23.75                  &      43.63             &   32.68              &  15.86              &      22.48         &      27.21                                      & 69.97          &  \textbf{19.66} &-0.59\%   \\
          & SnapKV$_{0.9}$                   &  70.20 &27.90& 20.08  &25.38 & 52.72                      &     24.04               &\textbf{43.93}            &   33.92              &       15.56         &   22.49            &  27.65                         &     \textbf{70.18}                &   19.05  &-1.12\% \\ 
        & H2O$_{0.5}$  & 31.08 & 2.90 &16.47&17.99 & 42.37 & 23.14&43.05 & 32.79 & 15.77 & 22.79 & 26.24 &69.83 & 19.18 & -17.63\% \\
        & SLM$_{0.5}$  & 3.41  & 6.03&8.84&18.75&44.68&20.94& 37.73 & 31.20 & 15.29 & 21.80 & 25.93 & 67.79 & 19.12 & -24.73\% \\
        & SnapKV$_{0.5}$  & 12.96 &   7.81 & 16.87& 19.52 & 42.84 & 23.40 & \textbf{43.93} & 33.98 & 15.94 & 22.67 & 26.07 & 69.66 & 19.19 & -17.03\%\\ 
          \hline \hline
\multirow{6}{*}{\rotatebox{90}{\textbf{Mistral-7B-Instruct }}} & \cellcolor{blue!20}Full                    & \cellcolor{blue!20}33.36&\cellcolor{blue!20}29.24& \cellcolor{blue!20}6.83  & \cellcolor{blue!20}20.82 & \cellcolor{blue!20}39.68                 & \cellcolor{blue!20}28.74              & \cellcolor{blue!20}37.80             & \cellcolor{blue!20}33.87           & \cellcolor{blue!20}22.88          & \cellcolor{blue!20}22.19         & \cellcolor{blue!20}22.94                     & \cellcolor{blue!20}86.87                       &  \cellcolor{blue!20}16.08&\cellcolor{blue!20}100\%    \\
          & \cellcolor{teal!20}Ours$_{k=1}$                     & \cellcolor{teal!20}\textbf{31.54}&\cellcolor{teal!20}\textbf{29.02}& \cellcolor{teal!20}6.71& \cellcolor{teal!20}\textbf{20.81} & \cellcolor{teal!20}\textbf{39.80}                 & \cellcolor{teal!20}27.20              & \cellcolor{teal!20}\textbf{38.93}             &    \cellcolor{teal!20}33.46             & \cellcolor{teal!20}22.15          & \cellcolor{teal!20}\textbf{22.39}         & \cellcolor{teal!20}22.67                       &     \cellcolor{teal!20}\textbf{86.81}                    &   \cellcolor{teal!20}15.33  &\cellcolor{teal!20}\textbf{-1.50\%} \\
          & \cellcolor{pink!30}\textit{Budget}              & \cellcolor{pink!30}\textit{89.6\%} &\cellcolor{pink!30}\textit{90.5\%}&\cellcolor{pink!30}\textit{84.2\%}& \cellcolor{pink!30}\textit{92.3\%} &\cellcolor{pink!30}\textit{84.1\%}                & \cellcolor{pink!30}\textit{78.0\%}              & \cellcolor{pink!30}\textit{97.9\%}             &     \cellcolor{pink!30}\textit{86.7\%}            & \cellcolor{pink!30}\textit{74.4\%}         &\cellcolor{pink!30}\textit{84.3\%}         & \cellcolor{pink!30}\textit{89.1\%}                    &      \cellcolor{pink!30}\textit{87.2\%}          &  \cellcolor{pink!30}\textit{89.4\%}   &\cellcolor{pink!30}\textit{86.75\%} \\
          & H2O$_{0.9}$                      & 19.18  &  24.11  &   6.96 &       20.61      &   39.74  &    27.36              &  38.38                 &        35.23         &       \textbf{23.24}         & 22.13              &             \textbf{23.41}            &     86.46                       &  16.01   &-4.29\% \\
          & SLM$_{0.9}$          &        31.16     & 27.68 &   5.89       &   19.88          & 39.15  &  27.26                  &       37.66            &      35.06           &   21.94       &    22.31             &         21.73                    & 86.63   &13.67  &-4.44\%\\
          & SnapKV$_{0.9}$                   & 27.60 &  25.67   &   \textbf{7.10}     &     20.23      &  39.76 &    \textbf{27.43}                &    38.27               &       \textbf{35.66}                          &    22.99           &           22.16        &    23.31                            &   86.46        &  16.07   &-1.90\% \\ 
    & H2O$_{0.5}$  & 2.50   &8.26 & 5.89&20.28 & 38.53 & 27.62 & 36.97 & 34.31 & 23.17 & 22.32 & 22.60 & 86.52 & \textbf{16.45} & -14.31\%  \\
    & SLM$_{0.5}$  & 2.43   & 6.47 & 1.14 &18.27 & 32.76 & 24.91 & 33.80 & 32.73 & 20.68 & 21.48 & 18.54 & 86.45 & 13.58 &  -27.61\%  \\
    & SnapKV$_{0.5}$   & 3.03  & 8.93 & 6.83 &19.03 & 39.22 & 27.15 & 38.27 & 34.60 & 22.94 & 21.93 & 22.68 & 86.31 & 16.18 &-13.41\%\\ 
          
          \hline
          \hline
\multirow{6}{*}{\rotatebox{90}{\textbf{Qwen2.5-7B-Instruct  }}}      &\cellcolor{blue!20} Full                      & \cellcolor{blue!20}88.02 & \cellcolor{blue!20}31.70&\cellcolor{blue!20}29.85 &\cellcolor{blue!20}24.55 &\cellcolor{blue!20}61.43                 & \cellcolor{blue!20}\textit{20.81}              & \cellcolor{blue!20}43.17             & \cellcolor{blue!20}47.15           & \cellcolor{blue!20}30.70          & \cellcolor{blue!20}23.64         & \cellcolor{blue!20}24.24                & \cellcolor{blue!20}87.64                    &   \cellcolor{blue!20} 2.44 &  \cellcolor{blue!20}100\% \\
          & \cellcolor{teal!20}Ours$_{k=1}$                     & \cellcolor{teal!20}88.02&\cellcolor{teal!20}\textbf{31.25}&\cellcolor{teal!20}\textbf{30.39} & \cellcolor{teal!20}\textbf{24.48} & \cellcolor{teal!20}60.01                 & \cellcolor{teal!20}20.66              & \cellcolor{teal!20}42.74             &      \cellcolor{teal!20}47.20           & \cellcolor{teal!20}29.56          & \cellcolor{teal!20}22.64         & \cellcolor{teal!20}24.04                        &            \cellcolor{teal!20}\textbf{87.65}              & \cellcolor{teal!20}\textbf{3.58} &\cellcolor{teal!20}\textbf{+2.63\%}    \\
          & \cellcolor{pink!30}\textit{Budget}              & \cellcolor{pink!30}\textit{90.7\%}& \cellcolor{pink!30}\textit{88.8\%} &  \cellcolor{pink!30}\textit{86.5\%}& \cellcolor{pink!30}\textit{69.2\%} &  \cellcolor{pink!30}\textit{84.1\%}                 & \cellcolor{pink!30}\textit{65.1\%}              & \cellcolor{pink!30}\textit{69.2\%}             &    \cellcolor{pink!30}\textit{73.3\%}             & \cellcolor{pink!30}\textit{64.4\%}          & \cellcolor{pink!30}\textit{70.6\%}         & \cellcolor{pink!30}\textit{85.4\%}                      &     \cellcolor{pink!30}\textit{56.6\%}             & \cellcolor{pink!30}\textit{84.4\%}    &\cellcolor{pink!30}\textit{76.02\%} \\
          & H2O$_{0.9}$                &  83.47   & 26.56 & 30.25&24.40 & \textbf{61.29}            &      20.85           &        43.26            &    \textbf{47.90}             &  30.73              &    23.42           &   \textbf{24.35}                             &           87.57               &   2.45  &-1.46\% \\
          & SLM$_{0.9}$                       & \textbf{88.93}  & 30.80 &28.25& 24.30 &  60.91                     &            19.86        &    42.54               &   46.02              &       28.75         &  23.06             &    23.42                         &    87.03                      &   3.05 &-0.41\%  \\
          & SnapKV$_{0.9}$                    &80.14   &30.13& 28.11   & 24.30&  61.26                    &         20.90           &    43.31               &   47.81              &          30.69      &      \textbf{23.90}         &    24.29                    &       87.57                   &    2.55  & -1.01\% \\ 
          
    & H2O$_{0.5}$   &34.12 & 14.73& 20.88 &23.10 &59.69&\textbf{21.59}&\textbf{43.37}&47.60& \textbf{30.81}  & 21.00 &22.95 & 85.54 & 2.24 & -13.47\% \\
    & SLM$_{0.5}$  &3.26&1.34&10.58 &23.75&49.87& 19.29 &36.45&42.42&25.33&21.24&22.77&87.33&3.40&-23.56\%\\
    & SnapKV$_{0.5}$  &20.77&12.28&22.76 & 22.25 & 60.21 & 20.93 & 43.22 & 47.45 & 30.61 & 23.76 & 22.70&87.57&2.21& -14.39\% \\  \bottomrule[1.3pt]  
\end{tabular}}
\caption{Performance of \method and its comparison with three KV cache pruning models on 13 datasets. \textbf{Bold} numbers indicate the best results \textbf{aside from full-cache}. \textit{Italics} represent the real budget utilized by \method. The correspondence between abbreviations and their full names of tasks and datasets can be found in Appendix. \textbf{Avg.} calculates the mean ratio of the model's performance using different KV cache compression methods to its performance with the full cache. All average results (except for budget) are adjusted by subtracting 1 to provide a more intuitive understanding of the effectiveness of different pruning methods.\label{main_result}}
% \vspace{-0.5em}
\end{table*}