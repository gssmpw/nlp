\vspace{-0.1cm}
\section{Introduction}
\vspace{-0.1cm}
\label{sec:intro}
Recent works like SwinUNet\cite{cao2022swin}, MambaUNet \cite{wang2024mamba} and MONAI \cite{cardoso2022monai} develop medical-tailored foundation models on large-scale medical image datasets. 
Intense interest has emerged in adapting these foundation models for specific medical image analysis tasks. 
%allowing for the development of generalizable models with limited training samples.
%Intense interest in applying these foundation models in specific medical image analysis tasks is widespread.
However, the generalization capability of foundation models is limited by the large variability in training data, due to complex modalities, intricate anatomical structures, and wide-range object scales in medical images.
Therefore, we seek to answer this critical question: how to effectively adapt these foundation models to our desired medical image processing tasks? 
% \input{figures/intro}

Unlike natural image analysis with large-scale labeled datasets, in medical image analysis, another major challenge is the lack of labeled data, as 
annotating disease-specific medical images is not only time-consuming but also demands %costly, 
specialty-oriented skills, leading to the problem of few-shot domain adaptation (FSDA). 
Most solutions to conventional domain adaptation problems either assume access to source data \cite{bermudez2018domain}, which is not always feasible in real-world medical scenarios with various regulatory standards and ethical considerations,
or they require a substantial amount of unlabeled target data to reduce the distribution gap across domains, as seen in unsupervised domain adaptation (UDA) methods  \cite{wu2021unsupervised}.
FSDA, on the other hand, addresses the situation when only a limited number of target examples are available for training, whether labeled or unlabeled.
Previous FSDA methods \cite{gu2019progressive} propose to use intermediate/auxiliary domains to facilitate domain adaptation.
However, this multi-step domain adaptation strategy requires fine-tuning the model twice or more.
In this work, we propose to incorporate auxiliary datasets to solve the FSDA problem in a source-free manner through a single-round fine-tuning.

Training with auxiliary data introduces an inductive bias that helps models capture meaningful representations and reduces the risk of overfitting to spurious correlations \cite{navon2021auxiliary}.
Multi-task learning methods \cite{graham2023one} cannot extend to a large number of tasks because the complexity of the search space will be exponentially explosive \cite{albalak2024improving}.
Other strategies in auxiliary learning and transfer learning hand-pick which auxiliary data to use based on heuristics \cite{yang2021joint} or metrics \cite{yu2020gradient} prior to training, sometimes resulting in sub-optimal outcomes.
Recent dynamic auxiliary learning works \cite{navon2021auxiliary} propose to dynamically combine auxiliary objectives through task or data schedulers, but these methods involve complex and computationally demanding bi-level optimization steps.

To address the above issues, we propose an \textbf{A}ctive and \textbf{S}equential domain \textbf{A}da\textbf{P}tation (ASAP) framework for FSDA.
Using a novel dynamic dataset selection strategy,
%By designing dynamic and efficient dataset selection algorithms, 
the proposed framework prioritizes training on auxiliary datasets with similar solution spaces to the target task in a \textbf{single-round} computational complexity.
Specifically,
we formulate FSDA as a multi-armed bandit problem in active learning \cite{macready1998bandit} and relate the set of auxiliary datasets to the arms.
We introduce the classic trace upper confidence bound algorithm \cite{auer2002finite} to solve the multi-armed bandit problem.
By balancing the trade-off between the exploration of unobserved arms and the exploitation of high-reward arms, we actively and sequentially select the auxiliary dataset at each turn, maximizing their benefits.
The reward functions we design add minimal memory and computational overhead.

Extensive experiments on three public medical datasets validate the effectiveness of our proposed ASAP framework.
We efficiently adapt pre-trained 
UNet \cite{ronneberger2015u}, SwinUNet \cite{cao2022swin} and MambaUNet \cite{wang2024mamba} from Flemme
\cite{zhang2024flemme}, 
a flexible and modular learning medical platform, for various target medical image segmentation tasks.
% a freely available open-source medical resource platform, for various target medical image segmentation tasks. 
%Our algorithms outperform direct fine-tuning by 32.34\% on MRI and 12.82\% on CT datasets in terms of segmentation Dice score. 
%When incorporating the collection of auxiliary datasets,
Our method outperforms the FSDA auxiliary learning methods with lower computation costs.
Our main contributions are as follows:
\begin{itemize}
    \item \textbf{\textit{An active and sequential domain adaptation framework}}: we propose a novel framework that incorporates auxiliary datasets to effectively adapt foundation models in a single-round fine-tuning for various medical segmentation tasks, optimizing the use of public medical resources.
    \item \textbf{\textit{An exploration-exploitation balanced  FSDA algorithm}}: we design an efficient reward function and successfully apply the multi-armed bandit algorithm to dynamic auxiliary dataset selection through the ASAP framework.
\end{itemize}




