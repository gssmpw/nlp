% \begin{table*}[t!]
% \caption{Performance comparison of different defense methods on AgentDojo datasets using \gpt, \othree, and \llama. We report benign utility (BU column, $\uparrow$), false positive rate (FPR column, $\downarrow$), utility under attack (UA column, $\uparrow$), and average success rate (ASR column, $\downarrow$). Results are grouped by defense categories: undefended baseline (\raisebox{0pt}[\height][0pt]{\colorbox{lightgray}{gray\vphantom{g}}}), prompt augmentation methods (\raisebox{0pt}[\height][0pt]{\colorbox{lightblue}{blue\vphantom{g}}}), detection methods (\raisebox{0pt}[\height][0pt]{\colorbox{lightred}{red\vphantom{g}}}), and our proposed methods (\raisebox{0pt}[\height][0pt]{\colorbox{lightgreen}{green}}). The best results for each column are marked as \textbf{bold}.}
% \label{table-overall results}
% \centering
% \resizebox{\textwidth}{!}{
% \begin{tblr}{
%   width=\textwidth,
%   colspec={c c c|c c|c | c|c | c|c | c|c | c c },
%   row{3}={bg=lightgray},
%   row{4-6}={bg=lightblue},
%   row{7-8}={bg=lightred},
%   row{9-10}={bg=lightgreen},
%   row{11}={bg=lightgray},
%   row{12-14}={bg=lightblue},
%   row{15-16}={bg=lightred},
%   row{17-18}={bg=lightgreen},
%   row{19}={bg=lightgray},
%   row{20-22}={bg=lightblue},
%   row{23-24}={bg=lightred},
%   row{25-26}={bg=lightgreen},
%   row{1-2}={font=\bfseries},
%   column{1}={bg=white},
%   column{1}={font=\bfseries},
%   hline{1}={1.5pt},
%   hline{2}={1pt},
%   hline{3}={1pt},
%   hline{4}={0.5pt},
%   hline{7}={0.5pt},
%   hline{9}={0.5pt},
%   hline{11}={1pt},
%   hline{12}={0.5pt},
%   hline{15}={0.5pt},
%   hline{17}={0.5pt},
%   hline{19}={1pt},
%   hline{20}={0.5pt},
%   hline{23}={0.5pt},
%   hline{25}={0.5pt},
%   hline{Z}={1.5pt},
%   vline{2,3,4,5,6,8,10,12,14}={0.5pt},
%   cell{1}{1}={c},
%   cell{1}{2-3}={c},
% }
% \SetCell[r=2]{c} \textbf{Model} & \SetCell[r=2]{c} \textbf{Attacks}
% & \SetCell[c=2]{c} \textbf{No Attack} & & \SetCell[c=2]{c} \textbf{Direct} & & \SetCell[c=2]{c} \textbf{Ignore Previous} & & \SetCell[c=2]{c} \textbf{System Message} & & \SetCell[c=2]{c} \textbf{Important Messages} & & \SetCell[c=2]{c} \textbf{Avg.} \\
% & & \textbf{BU} & \textbf{FPR} & \textbf{UA} & \textbf{ASR} & \textbf{UA} & \textbf{ASR} & \textbf{UA} & \textbf{ASR} & \textbf{UA} & \textbf{ASR} & \textbf{UA} & \textbf{ASR} \\

%  \SetCell[r=8]{c} \textbf{GPT-4o} 
%  & \textbf{No Defense} & 80.41\% & - & 76.79\% & 3.50\% & 70.75\% & 5.56\% & 74.72\% & 4.13\% & 54.05\% & 51.03\% & 69.08\% & 16.06\% \\
%  & \textbf{Delimiting} & 82.47\% & - & 75.52\% & 4.13\% & 72.81\% & 2.70\% & 73.77\% & 3.18\% & 56.92\% & 43.56\% & 69.75\% & 13.39\% \\
%  & \textbf{Repeat Prompt} & \textbf{83.51\%} & - & \textbf{81.40\%} & 3.82\% & \textbf{80.45\%} & 2.38\% & \textbf{80.76\%} & 1.59\% & \textbf{68.84\%} & 28.93\% & \textbf{77.86\%} & 9.18\% \\
%  & \textbf{Tool Filter} & 65.98\% & - & 67.73\% & 0.64\% & 65.34\% & 0.79\% & 67.89\% & 1.43\% & 61.21\% & 6.52\% & 65.54\% & 2.34\% \\
%  & \textbf{DeBERTa Detector} & 38.14\% & 61.86\% & 32.59\% & 0.64\% & 12.72\% & \textbf{0.00\%} & 27.19\% & 1.27\% & 12.88\% & 8.43\% & 21.34\% & 2.58\% \\
%  & \textbf{LLM Detector} & 81.44\% & \textbf{0.00\%} & 39.59\% & 1.43\% & 17.49\% & 0.95\% & 15.10\% & 0.16\% & 11.13\% & 2.54\% & 20.83\% & 1.27\% \\
%  & \textbf{\method} & 68.04\% & 9.28\% & 68.52\% & \textbf{0.00\%} & 66.93\% & \textbf{0.00\%} & 66.77\% & \textbf{0.00\%} & 32.91\% & \textbf{0.95\%} & 58.78\% & \textbf{0.24\%} \\
%  & \textbf{\method-Aug} & 76.29\% & 9.28\% & 73.93\% & \textbf{0.00\%} & 74.72\% & \textbf{0.00\%} & 73.77\% & \textbf{0.00\%} & 52.46\% & 1.27\% & 68.72\% & 0.32\% \\

%  \SetCell[r=8]{c} \textbf{o3-mini} 
%  & \textbf{No Defense} & 57.73\% & - & 48.97\% & 6.20\% & 42.93\% & 14.15\% & 49.13\% & 12.40\% & \textbf{44.99\%} & 30.37\% & 46.50\% & 15.78\% \\
%  & \textbf{Delimiting} & 55.67\% & - & \textbf{56.12\%} & 4.13\% & \textbf{51.35\%} & 8.90\% & \textbf{54.21\%} & 8.43\% & 44.67\% & 31.16\% & \textbf{51.59\%} & 13.16\% \\
%  & \textbf{Repeat Prompt} & 53.61\% & - & 51.35\% & 3.50\% & 48.65\% & 4.45\% & 47.38\% & 5.41\% & 38.16\% & 13.51\% & 46.38\% & 6.72\% \\
%  & \textbf{Tool Filter} & 4.12\% & - & 5.72\% & \textbf{0.00\%} & 5.72\% & \textbf{0.00\%} & 5.72\% & \textbf{0.00\%} & 5.72\% & \textbf{0.00\%} & 5.72\% & \textbf{0.00\%} \\
%  & \textbf{DeBERTa Detector} & 38.14\% & 40.21\% & 29.57\% & 1.11\% & 12.88\% & \textbf{0.00\%} & 23.37\% & 2.86\% & 18.76\% & 4.93\% & 21.14\% & 2.23\% \\
%  & \textbf{LLM Detector} & \textbf{58.76\%} & \textbf{0.00\%} & 28.14\% & 1.43\% & 9.86\% & 1.43\% & 9.86\% & 0.16\% & 8.59\% & \textbf{0.00\%} & 14.11\% & 0.76\% \\
%  & \textbf{\method} & 50.52\% & 7.22\% & 49.60\% & 0.32\% & 40.38\% & 0.95\% & 23.05\% & 0.79\% & 32.11\% & 1.75\% & 36.29\% & 0.95\% \\
%  & \textbf{\method-Aug} & 55.67\% & 5.15\% & 26.55\% & 0.32\% & 44.36\% & 0.00\% & 43.08\% & 0.79\% & 35.14\% & 1.11\% & 37.28\% & 0.56\% \\

%  \SetCell[r=8]{c} \textbf{Llama-3.3-70B} 
%  & \textbf{No Defense} & 74.88\% & - & 37.20\% & 63.43\% & 45.79\% & 35.29\% & 68.20\% & 9.06\% & 67.41\% & 6.20\% & 54.65\% & 28.50\% \\
%  & \textbf{Delimiting} & 75.26\% & - & 38.16\% & 63.75\% & 51.19\% & 29.09\% & 68.20\% & 7.63\% & 65.50\% & 5.88\% & 55.76\% & 26.59\% \\
%  & \textbf{Repeat Prompt} & 72.16\% & - & \textbf{49.76\%} & 48.65\% & \textbf{61.84\%} & 16.85\% & \textbf{69.48\%} & 4.61\% & \textbf{69.16\%} & 3.18\% & \textbf{62.56\%} & 18.32\% \\
%  & \textbf{Tool Filter} & 4.12\% & - & 6.36\% & \textbf{0.00\%} & 6.04\% & \textbf{0.00\%} & 6.04\% & \textbf{0.00\%} & 6.36\% & \textbf{0.00\%} & 6.20\% & \textbf{0.00\%} \\
%  & \textbf{DeBERTa Detector} & 35.05\% & 69.07\% & 13.04\% & 6.20\% & 12.88\% & 0.95\% & 13.67\% & 1.91\% & 12.08\% & 1.59\% & 12.92\% & 2.66\% \\
%  & \textbf{LLM Detector} & \textbf{81.44\%} & \textbf{0.00\%} & 10.17\% & 3.02\% & 13.35\% & 2.86\% & 34.18\% & 3.02\% & 12.72\% & 0.00\% & 17.61\% & 2.23\% \\
%  & \textbf{\method} & 63.92\% & 16.49\% & 23.53\% & 2.86\% & 43.08\% & 1.27\% & 59.30\% & 0.16\% & 59.30\% & 0.79\% & 46.30\% & 1.27\% \\
%  & \textbf{\method-Aug} & 67.01\% & 7.22\% & 33.39\% & 2.07\% & 54.69\% & 0.48\% & 61.84\% & 0.16\% & 61.84\% & 0.16\% & 52.94\% & 0.72\%\\
% \end{tblr}
% }
% \end{table*}



\begin{table*}[t!]
\vspace{-.15in}
\caption{Performance comparison of different defense methods on AgentDojo datasets using \gpt, \othree, and \llama. We report benign utility (BU column, $\uparrow$), utility under attack (UA column, $\uparrow$), and average success rate (ASR column, $\downarrow$). Results are grouped by defense categories: undefended baseline (\raisebox{0pt}[\height][0pt]{\colorbox{lightgray}{gray\vphantom{g}}}), prompt augmentation methods (\raisebox{0pt}[\height][0pt]{\colorbox{lightyellow}{yellow\vphantom{g}}}), tool filter method (\raisebox{0pt}[\height][0pt]{\colorbox{lightblue}{blue\vphantom{g}}}), model-based detection methods (\raisebox{0pt}[\height][0pt]{\colorbox{lightred}{red\vphantom{g}}}), and our proposed methods (\raisebox{0pt}[\height][0pt]{\colorbox{lightgreen}{green}}).}
\label{table-overall results}
\centering
\resizebox{0.98\textwidth}{!}{
\begin{tblr}{
  width=\textwidth,
  colspec={c c c c|c | c|c | c|c | c|c | c|c },
  row{3}={bg=lightgray},
  row{4-5}={bg=lightyellow},
  row{6}={bg=lightblue},
  row{7-8}={bg=lightred},
  row{9-10}={bg=lightgreen},
  row{11}={bg=lightgray},
  row{12-13}={bg=lightyellow},
  row{14}={bg=lightblue},
  row{15-16}={bg=lightred},
  row{17-18}={bg=lightgreen},
  row{19}={bg=lightgray},
  row{20-21}={bg=lightyellow},
  row{22}={bg=lightblue},
  row{23-24}={bg=lightred},
  row{25-26}={bg=lightgreen},
  row{1-2}={font=\bfseries},
  column{1}={bg=white},
  column{1}={font=\bfseries},
  hline{1}={1.5pt},
  hline{2}={1pt},
  hline{3}={1pt},
  hline{4}={0.5pt},
  hline{6}={0.5pt},
  hline{7}={0.5pt},
  hline{9}={0.5pt},
  hline{11}={1pt},
  hline{12}={0.5pt},
  hline{14}={0.5pt},
  hline{15}={0.5pt},
  hline{17}={0.5pt},
  hline{19}={1pt},
  hline{20}={0.5pt},
  hline{22}={0.5pt},
  hline{23}={0.5pt},
  hline{25}={0.5pt},
  hline{Z}={1.5pt},
  vline{2,3,4,5,6,8,10,12}={0.5pt},
  cell{1}{1}={c},
  cell{1}{2-3}={c},
}
\SetCell[r=2]{c} \textbf{Model} & \SetCell[r=2]{c} \textbf{Attacks}
& \SetCell[c=1]{c} \textbf{No Attack} & \SetCell[c=2]{c} \textbf{Direct} & & \SetCell[c=2]{c} \textbf{Ignore Previous} & & \SetCell[c=2]{c} \textbf{System Message} & & \SetCell[c=2]{c} \textbf{Important Messages} & & \SetCell[c=2]{c} \textbf{Avg.} \\
& & \textbf{BU} & \textbf{UA} & \textbf{ASR} & \textbf{UA} & \textbf{ASR} & \textbf{UA} & \textbf{ASR} & \textbf{UA} & \textbf{ASR} & \textbf{UA} & \textbf{ASR} \\

 \SetCell[r=8]{c} \textbf{GPT-4o} 
 & \textbf{No Defense} & 80.41\% & 76.79\% & 3.50\% & 70.75\% & 5.56\% & 74.72\% & 4.13\% & 54.05\% & 51.03\% & 69.08\% & 16.06\% \\
 & \textbf{Delimiting} & 82.47\% & 75.52\% & 4.13\% & 72.81\% & 2.70\% & 73.77\% & 3.18\% & 56.92\% & 43.56\% & 69.75\% & 13.39\% \\
 & \textbf{Repeat Prompt} & 83.51\% & 81.40\% & 3.82\% & 80.45\% & 2.38\% & 80.76\% & 1.59\% & 68.84\% & 28.93\% & 77.86\% & 9.18\% \\
 & \textbf{Tool Filter} & 65.98\% & 67.73\% & 0.64\% & 65.34\% & 0.79\% & 67.89\% & 1.43\% & 61.21\% & 6.52\% & 65.54\% & 2.34\% \\
 & \textbf{DeBERTa Detector} & 38.14\% & 32.59\% & 0.64\% & 12.72\% & 0.00\% & 27.19\% & 1.27\% & 12.88\% & 8.43\% & 21.34\% & 2.58\% \\
 & \textbf{LLM Detector} & 81.44\% & 39.59\% & 1.43\% & 17.49\% & 0.95\% & 15.10\% & 0.16\% & 11.13\% & 2.54\% & 20.83\% & 1.27\% \\
 & \textbf{\method} & 68.04\% & 68.52\% & 0.00\% & 66.93\% & 0.00\% & 66.77\% & 0.00\% & 32.91\% & 0.95\% & 58.78\% & 0.24\% \\
 & \textbf{\method-Aug} & 76.29\% & 73.93\% & 0.00\% & 74.72\% & 0.00\% & 73.77\% & 0.00\% & 52.46\% & 1.27\% & 68.72\% & 0.32\% \\

 \SetCell[r=8]{c} \textbf{o3-mini} 
 & \textbf{No Defense} & 57.73\% & 48.97\% & 6.20\% & 42.93\% & 14.15\% & 49.13\% & 12.40\% & 44.99\% & 30.37\% & 46.50\% & 15.78\% \\
 & \textbf{Delimiting} & 55.67\% & 56.12\% & 4.13\% & 51.35\% & 8.90\% & 54.21\% & 8.43\% & 44.67\% & 31.16\% & 51.59\% & 13.16\% \\
 & \textbf{Repeat Prompt} & 53.61\% & 51.35\% & 3.50\% & 48.65\% & 4.45\% & 47.38\% & 5.41\% & 38.16\% & 13.51\% & 46.38\% & 6.72\% \\
 & \textbf{Tool Filter} & 4.12\% & 5.72\% & 0.00\% & 5.72\% & 0.00\% & 5.72\% & 0.00\% & 5.72\% & 0.00\% & 5.72\% & 0.00\% \\
 & \textbf{DeBERTa Detector} & 38.14\% & 29.57\% & 1.11\% & 12.88\% & 0.00\% & 23.37\% & 2.86\% & 18.76\% & 4.93\% & 21.14\% & 2.23\% \\
 & \textbf{LLM Detector} & 58.76\% & 28.14\% & 1.43\% & 9.86\% & 1.43\% & 9.86\% & 0.16\% & 8.59\% & 0.00\% & 14.11\% & 0.76\% \\
 & \textbf{\method} & 50.52\% & 49.60\% & 0.32\% & 40.38\% & 0.95\% & 23.05\% & 0.79\% & 32.11\% & 1.75\% & 36.29\% & 0.95\% \\
 & \textbf{\method-Aug} & 55.67\% & 26.55\% & 0.32\% & 44.36\% & 0.00\% & 43.08\% & 0.79\% & 35.14\% & 1.11\% & 37.28\% & 0.56\% \\

 \SetCell[r=8]{c} \textbf{Llama-3.3-70B} 
 & \textbf{No Defense} & 74.88\% & 37.20\% & 63.43\% & 45.79\% & 35.29\% & 68.20\% & 9.06\% & 67.41\% & 6.20\% & 54.65\% & 28.50\% \\
 & \textbf{Delimiting} & 75.26\% & 38.16\% & 63.75\% & 51.19\% & 29.09\% & 68.20\% & 7.63\% & 65.50\% & 5.88\% & 55.76\% & 26.59\% \\
 & \textbf{Repeat Prompt} & 72.16\% & 49.76\% & 48.65\% & 61.84\% & 16.85\% & 69.48\% & 4.61\% & 69.16\% & 3.18\% & 62.56\% & 18.32\% \\
 & \textbf{Tool Filter} & 4.12\% & 6.36\% & 0.00\% & 6.04\% & 0.00\% & 6.04\% & 0.00\% & 6.36\% & 0.00\% & 6.20\% & 0.00\% \\
 & \textbf{DeBERTa Detector} & 35.05\% & 13.04\% & 6.20\% & 12.88\% & 0.95\% & 13.67\% & 1.91\% & 12.08\% & 1.59\% & 12.92\% & 2.66\% \\
 & \textbf{LLM Detector} & 74.23\% & 10.17\% & 3.02\% & 13.35\% & 2.86\% & 34.18\% & 3.02\% & 12.72\% & 0.00\% & 17.61\% & 2.23\% \\
 & \textbf{\method} & 63.92\% & 23.53\% & 2.86\% & 43.08\% & 1.27\% & 59.30\% & 0.16\% & 59.30\% & 0.79\% & 46.30\% & 1.27\% \\
 & \textbf{\method-Aug} & 67.01\% & 33.39\% & 2.07\% & 54.69\% & 0.48\% & 61.84\% & 0.16\% & 61.84\% & 0.16\% & 52.94\% & 0.72\%\\
\end{tblr}
}
\vspace{-.2in}
\end{table*}
