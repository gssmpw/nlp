\algrenewcommand\algorithmicindent{0.4em}%

\begin{lstlisting}[language=C++,
                   label=algorithm:demonstrator:blueprint-rewritten,
                   caption=Manual rewrite of the blueprint code from Listing~\ref{algorithm:demonstrator:blueprint} into a temporal local variant,
                   basicstyle=\footnotesize]
void ForAllParticlePairs(list<Particle*> &localParticles,
                         list<Particle*> &activeParticles) {
  double *soa_lParticle_density = new double[localParticle.size()];
  double *soa_lParticle_pressure = new double[localParticle.size()];
  // ... declare buffers for local and active sets
  
  int idx = 0;
  for (auto *particle : localParticles) {
    soa_lParticle_density[idx] = particle->getDensity();
    soa_lParticle_pressure[idx] = particle->getPressure();
    // ... copy data from AoS to SoA buffers
    idx++;
  }
  
  for (int iLoc=0; iLoc<localParticles.size(); iLoc++) {
    for (int iAct=0; iAct<activeParticles.size(); iAct++) {
      if (DensityPredicate(/* operate on SoA data */)) {
        Density(/* operate on SoA data */);
      }
    }
  }
  
  idx = 0;
  for (auto *particle : localParticles) {
    particle->setDensity(soa_lParticle_density[idx]);
    particle->setPressure(soa_lParticle_pressure[idx]);
    // ... copy data from SoA to AoS buffers
    idx++;
  }
  
  delete[] soa_lParticle_density;
  delete[] soa_lParticle_pressure;
  // ... clean up buffers
}
\end{lstlisting}
