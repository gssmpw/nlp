%
% MOMENT GENERATING FUNCTION OF X0| XT
%
To state our next result, it is convenient to denote the Euclidean norm by $\vert\vert\cdot\vert\vert$. We present a Tweedie's formula for the Moment Generating Function (MGF) of $\mathbf{x}_{0}\vert\mathbf{x}_{t}$.
\begin{proposition}[Tweedie's Formula for Moment Generating Function of $\mathbf{x}_{0}\vert\mathbf{x}_{t}$]
\label{prop-moment-generating-function}
Let $p_{\mathbf{x}_t}(\mathbf{x}_{t})$ be the marginal density of $\mathbf{x}_t$. The MGF of $\mathbf{x}_{0}\vert \mathbf{x}_{t}$ is given by 
\begin{equation}
\label{eq-moment-generating-function-tweedie}
    M_{\mathbf{x}_{0}\vert\mathbf{x}_{t}}(\mathbf{t}) := \mathbb{E}_{p_{\mathbf{x}_{0}\vert\mathbf{x}_{t}}}[e^{\mathbf{x}_0^T \mathbf{t}}] = \exp\left(||\mathbf{t}||^2\frac{v_{t}}{2\alpha_{t}} + \frac{1}{\sqrt{\alpha_{t}}}\mathbf{t}^{\top}\mathbf{x}_{t} + \log\left(\frac{p_{\mathbf{x}_{t}}\left(\mathbf{x}_{t}+\frac{v_{t}}{\sqrt{\alpha_t}}\mathbf{t}\right)}{p_{\mathbf{x}_{t}}\left(\mathbf{x}_{t}\right)}\right)\right)
\end{equation}
for $\mathbf{t}=(t_{1},\ldots,t_{d})\in\mathbb{R}_{+}^{d}$.
\end{proposition}
The proof of Proposition~\ref{prop-moment-generating-function} is postponed to Appendix~\ref{sec:prop-moment-generating-function}. 
%
% MOMENT GENERATING FUNCTION OF X0i | XT
%
In order to present our next result, we introduce the following notation. We denote by $\mathbf{t}_{i}$ a vector whose entries are given by $(\mathbf{t}_{i})_{j} = t \: \delta_{ij}$ where $\delta_{ij}$ is the Kronecker delta and $t\geq 0$. Notice that the only non-zero entry in $\mathbf{t}_i$ is the $i^{\text{th}}$ entry. Additionally, the special case where $t = 0$ results in a vector of zeros of length $d$ which we denote by $\mathbf{0}_d$.
\begin{corollary}[Tweedie's Formula for Moment Generating Function of ${x}_{0,i}\vert\mathbf{x}_{t}$] \label{corollary:moment-generating-function-i}
The MGF of ${x}_{0,i}\vert\mathbf{x}_{t}$ is given by
\begin{equation}
\begin{aligned}
\label{eq-one-d-mgf}
   M_{{x}_{0,i}\vert\mathbf{x}_{t}}(\mathbf{t}_{i}) 
   &= \mathbb{E}_{p_{\mathbf{x}_0\vert \mathbf{x}_t}}[e^{\mathbf{x}_{0}^{\top} \mathbf{t}_{i}}] = \mathbb{E}_{p_{{x}_{0,i}\vert \mathbf{x}_t}}[e^{tx_{0,i}}] \\
   &= \exp\left(t^{2}\frac{v_{t}}{2\alpha_{t}} + t \frac{x_{t,i}}{ \sqrt{\alpha_{t}}}  + \log\left(\frac{p_{\mathbf{x}_t}\left(\mathbf{x}_{t}+\frac{v_{t}}{\sqrt{\alpha_t}}\mathbf{t}_{i}\right)}{p_{\mathbf{x}_t}\left(\mathbf{x}_{t}\right)}\right)\right)
\end{aligned}
\end{equation}
\end{corollary}
%
% DERIVATIVES OF MOMENT GENERATING FUNCTION OF X0i | XT
%
In order to present our next result, it is convenient to define the following quantities. We define the cumulant generating function (CGF) of $x_{0,i} \vert \mathbf{x}_t$ evaluated at $\mathbf{t}_{i}$ as
\begin{equation}
\label{eq:cumulant_generating_function}
K_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i}) = t^{2}\frac{v_{t}}{2\alpha_{t}} + t\frac{x_{t,i}}{\sqrt{\alpha_{t}}} + \log\left(\frac{p_{\mathbf{x}_t}\left(\mathbf{x}_{t}+\frac{v_{t}}{\sqrt{\alpha}}\mathbf{t}_{i}\right)}{p_{\mathbf{x}_t}\left(\mathbf{x}_{t}\right)}\right).
\end{equation} 
We define the $n^{\text{th}}$ derivative of the CGF evaluated at $\mathbf{t}_{i}$ with
\begin{align}
\label{eq:derivative_cumulant_generating_function}
    \kappa^{(n)}_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i}) := \frac{\mathrm{d}^{n}}{\mathrm{d}t^{n}} K_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_i)
\end{align}
where
\begin{equation}
\begin{aligned}
\kappa^{(1)}_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i})  &= \frac{v_{t}}{\alpha_{t}} t_{i} + \frac{1}{\sqrt{\alpha_{t}}} x_{t,i} + \frac{v_{t}}{\sqrt{\alpha_{t}}}\left[\nabla_{\mathbf{z}_{t}}\log\left(p_{\mathbf{x}_t}\left(\mathbf{z}_{t}\right)\right) \vert_{\mathbf{z}_{t}=\mathbf{x}_{t}+\frac{v_{t}}{\sqrt{\alpha}}\mathbf{t}_{i}}\right]_{i} \\  
\kappa^{(2)}_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i})&=  \frac{v_{t}}{\alpha_{t}} +\frac{v_{t}^{2}}{\alpha_{t}}\left[ \nabla_{\mathbf{z}_t}^{2}\log\left(p_{\mathbf{x}_t}\left(\mathbf{z}_t\right)\right)\vert_{\mathbf{z}_t = \mathbf{x}_{t}+\frac{v_{t}}{\sqrt{\alpha_t}}\mathbf{t}_{i}}\right]_{ii}\\
\kappa^{(n)}_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i}) &=\left(\frac{v_{t}} {\sqrt{\alpha_{t}}}\right)^n\left[ \nabla_{\mathbf{z}_t}^{n}\log\left(p_{\mathbf{x}_t}\left(\mathbf{z}_t\right)\right)\vert_{\mathbf{z}_t = \mathbf{x}_{t}+\frac{v_{t}}{\sqrt{\alpha_t}}\mathbf{t}_{i}}\right]_{\underbrace{i \ldots i}_{\text{n times}}}, \quad \text{for } n >2.
\end{aligned}
\end{equation}
Notice that $\kappa^{(1)}_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i})$ and $\kappa^{(2)}_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i})$ evaluated at $\mathbf{t}_{i} = \mathbf{0}_d$ correspond to the mean and variance of $x_{0,i} \vert \mathbf{x}_t$. Hence to favor interpretability, we will use the following special notation 
\begin{equation}
\begin{aligned}
\label{eq-mu-sigma-mgf}
    \mu_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i})  &:= \kappa^{(1)}_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i}) \\
    \sigma^2_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i}) &:= \kappa^{(2)}_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i}).
\end{aligned}
\end{equation}
We now present a recursive formula to obtain the $n^{\text{th}}$-derivative of the MFG of $x_{0,i}\vert \mathbf{x}_{t}$. This formula can then be immediately used to obtain the $n^{\text{th}}$-moments of $x_{0,i}\vert \mathbf{x}_{t}$.
\begin{proposition}[Tweedie's Recursive Formula for Derivatives of Moment Generating Function of $x_{0,i}\vert \mathbf{x}_{t}$]
\label{prop-recursive-derivative-mgf}
Let $M_{x_{0,i}\vert \mathbf{x}_{t}}(\mathbf{t}_{i})$ be the MGF of $x_{0,i}\vert \mathbf{x}_{t}$ defined in~\eqref{eq-one-d-mgf}. Moreover, recall the definition of the CGF of $x_{0,i}\vert \mathbf{x}_{t}$, $K_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i})$ in~\eqref{eq:cumulant_generating_function} and its $n^{\text{th}}$ derivative, $\kappa^{(n)}_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i})$, in~\eqref{eq:derivative_cumulant_generating_function}. Lastly, recall the notation for $\mu_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i})$ and $\sigma^2_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_{i})$ introduced in~\eqref{eq-mu-sigma-mgf}. Then, the $n^{\text{th}}$ derivative of $M_{x_{0,i}\vert \mathbf{x}_{t}}(\mathbf{t}_{i})$ with respect to $t$ is given by 
\begin{equation}
\frac{\mathrm{d}^{n}}{\mathrm{d}t^{n}}M_{{x}_{0,i}\vert\mathbf{x}_{t}} (\mathbf{t}_i) = M_{{x}_{0,i}\vert\mathbf{x}_{t}}(\mathbf{t}_i) B_{n,{x}_{0,i}|{\mathbf{x}_t}}(\mathbf{t}_i)
\end{equation}
where $B_{n, {x}_{0,i}|{\mathbf{x}_t}}(\mathbf{t}_i)$ satisfies the following recursive relationship
\begin{equation}
\label{eq-recursion-derivative}
\begin{aligned}
&B_{n,{x}_{0,i}|{\mathbf{x}_t}}(\mathbf{t}_i)= L_{n,{x}_{0,i}|{\mathbf{x}_t}}(\mathbf{t}_i) + F_{n,{x}_{0,i}|{\mathbf{x}_t}}(\mathbf{t}_i)
\end{aligned}
\end{equation}
where $L_{n,{x}_{0,i}|{\mathbf{x}_t}}$ is given by
\begin{equation}
\begin{aligned} \label{eq:bell_polynomial_L}
&L_{0,{x}_{0,i}|{\mathbf{x}_t}}(\mathbf{t}_i) = 1, \\
&L_{1,{x}_{0,i}|{\mathbf{x}_t}}(\mathbf{t}_i) = \mu_{{x}_{0,i}\vert{\mathbf{x}_t}} (\mathbf{t}_i),\\
&L_{2,{x}_{0,i}|{\mathbf{x}_t}}(\mathbf{t}_i) = (\mu_{{x}_{0,i}\vert{\mathbf{x}_t}}(\mathbf{t}_i))^2+ \sigma_{{x}_{0,i}\vert{\mathbf{x}_t}}^2(\mathbf{t}_i),\\
&L_{n,{x}_{0,i}|{\mathbf{x}_t}}(\mathbf{t}_i) = B_{n-1,{x}_{0,i}\vert{\mathbf{x}_t}}(\mathbf{t}_i) \mu_{{x}_{0,i}\vert{\mathbf{x}_t}}(\mathbf{t}_i)+ (n-1)B_{n-2,{x}_{0,i}\vert{\mathbf{x}_t}}(\mathbf{t}_i)\sigma_{{x}_{0,i}\vert{\mathbf{x}_t}}^2(\mathbf{t}_i), \quad \text{for } n>2\\
\end{aligned}
\end{equation} 
and $F_{n,{x}_{0,i}|{\mathbf{x}_t}}(\mathbf{t}_i)$ is given by
\begin{equation}
\begin{aligned} \label{eq:bell_polynomial_F}
&F_{0,{x}_{0,i}\vert{\mathbf{x}_t}}(\mathbf{t}_i) = F_{1,{x}_{0,i}\vert{\mathbf{x}_t}}(\mathbf{t}_i) = F_{2,{x}_{0,i}\vert{\mathbf{x}_t}}(\mathbf{t}_i) = 0\\
&F_{n,{x}_{0,i}|{\mathbf{x}_t}}(\mathbf{t}_i) = \sum_{k=2}^{n-1}{n-1\choose k}B_{n-k-1,{x}_{0,i}\vert{\mathbf{x}_t}}(\mathbf{t}_i)\kappa^{(k+1)}_{{x}_{0,i}\vert \mathbf{x}_t} (\mathbf{t}_i), \quad \text{for } n>2
\end{aligned}
\end{equation}
for $i=1,\ldots,d$.
\end{proposition}
The proof of Proposition~\ref{prop-recursive-derivative-mgf} is postponed to Appendix~\ref{sec:prop-recursive-moment}. 
%
% MOMENT OF X0i | XT
%
For the next corollary, it is convenient to denote the $n^{\text{th}}$ derivative of the MGF of $x_{0,i}\vert \mathbf{x}_{t}$ evaluated at $\mathbf{0}_d$ by
\begin{align}
\label{eq:derivative_moment_generating_function}
    m^{(n)}_{x_{0,i} \vert \mathbf{x}_t} := \frac{\mathrm{d}^{n}}{\mathrm{d}t^{n}} M_{x_{0,i} \vert \mathbf{x}_t}(\mathbf{t}_i)|_{\mathbf{t}_i =\boldsymbol{0}_d}
\end{align}
The following corollary follows immediately from Proposition~\ref{prop-recursive-derivative-mgf} and the fact that $M_{x_{0,i}\vert\mathbf{x}_{t}}(\mathbf{0}_d) = 1 $.
\begin{corollary}
\label{corollary-moment-tweedie}
The $n^{\text{th}}$ moment of $x_{0,i}\vert \mathbf{x}_{t}$ is given by:
\begin{equation}
\mathbb{E}_{p_{x_{0,i}\vert\mathbf{x}_{t}}}[x_{0,i}^{n}] = m^{(n)}_{x_{0,i} \vert \mathbf{x}_t}  = B_{n,{x}_{0,i}\vert\mathbf{x}_{t}}(\boldsymbol{0}_d)
\end{equation}
for $B_{n,{x}_{0,i}\vert\mathbf{x}_{t}}(\cdot)$ defined as in~\eqref{eq-recursion-derivative}-\eqref{eq:bell_polynomial_F}.
\end{corollary}
%
% STRUCTURE OF TWEEDIE'S TYPE FORMULAS
%
\begin{remark}
    We note that the MGF of ${x}_{0,i}\vert\mathbf{x}_{t}$ presented in Corollary~\ref{corollary:moment-generating-function-i} as well as the recursive formula of its derivatives in Proposition~\ref{prop-recursive-derivative-mgf} shares the same conceptual structure as other Tweedie's-type formulas. Specifically, it is composed of the maximum likelihood estimate of the MGF, supplemented by a Bayesian correction term. 
\end{remark}
