% \newtheorem{theorem}{Theorem}
% \newtheorem{corollary}{Corollary}[theorem]
% \newtheorem{lemma}[theorem]{Lemma}
% \theoremstyle{definition}
% \newtheorem{definition}{Definition}
% \newtheorem{prop}{Proposition}
% \newtheorem{assumption}{Assumption}


% \newrefformat{lem}{Lemma \ref{#1}}
% \newrefformat{lm}{Lemma \ref{#1}}
% \newrefformat{prop}{Proposition \ref{#1}}
% \newrefformat{ex}{Example \ref{#1}}
% \newrefformat{as}{Assumption \ref{#1}}

\definecolor{pierLink}{RGB}{189, 72, 80}
\definecolor{pierCite}{RGB}{0, 73, 112}
\definecolor{pierComment}{RGB}{100, 143, 255}


\crefname{as}{assumption}{assumptions}
\Crefname{as}{Assumption}{Assumptions}
\newcommand{\robset}{\mathcal{P}_{\text{rob}}}
\newcommand{\betaShat}{\hat{\beta}^{\cS}}

\newcommand{\PSM}{\hat{M}_{\mathrm{seen}}}
\newcommand{\PSMpop}{M_{\mathrm{seen}}}
\newcommand{\PSperpM}{\hat{R}\hat{R}^\top}
\newcommand{\PSperpMpop}{RR^\top}
\newcommand{\noisecov}{\cov_{\noisevec}}
\newcommand{\Cov}{\mathrm{Cov}}
\newcommand{\noisevec}{U}
\newcommand\bE{\mathbb{E}}
\newcommand\bP{\mathbb{P}}
\newcommand\bR{\mathbb{R}}
\newcommand\bN{\mathbb{N}}
\newcommand\cB{\mathcal{B}}
\newcommand\bQ{\mathbb{Q}}
\newcommand\cM{\mathcal{M}}
\newcommand\cI{\mathcal{I}}
\newcommand\cP{\mathcal{P}}
\newcommand\cF{\mathcal{F}}
\newcommand\cH{\mathcal{H}}
\newcommand\cK{\mathcal{K}}
\newcommand\cN{\mathcal{N}}
\newcommand\cS{\mathcal{S}}
\newcommand\cR{\mathcal{R}}
\newcommand\cU{\mathcal{U}}
\newcommand\cX{\mathcal{X}}
\newcommand\cY{\mathcal{Y}}
\newcommand\cC{\mathcal{C}}
\newcommand\cA{\mathcal{A}}
\newcommand\cE{\mathcal{E}}
\newcommand\by{\bar{y}}
\newcommand\tY{\tilde{Y}}
\newcommand\tX{\tilde{X}}
\newcommand{\noisecovv}{\Sigma_v}
\def\mybigplus{\mathop{\mathchoice{%display:
   \vcenter{\hbox to12bp{\vrule height15bp width0pt \pdfliteral{
   q 1 J .8 w 0 7.5 m 12 7.5 l S 6 1 m 6 14 l S Q
}\hss}}}{%text:
   \vcenter{\hbox to12bp{\kern1bp\vrule height10bp width0pt \pdfliteral{
   q 1 J .65 w 0 5 m 10 5 l S 5 0 m 5 10 l S Q
}\hss}}}{+}{+}%script, scriptscript not defined
}}

\newcommand{\Loss}{\mathcal{R}}
\newcommand{\R}{\mathbb{R}}
 \newcommand\indp{\perp\!\!\!\!\perp} 
\newcommand\br[1]{\left(#1\right)}
\newcommand\bs[1]{\left[#1\right]}
\newcommand\fminimax{f_{\diamond}}
\newcommand\cov{\Sigma}
\newcommand\Del[1]{\Delta_{#1}}
\newcommand{\Mtest}{M_{\mathrm{test}}}
\newcommand{\Mseen}{M_{\mathrm{seen}}}
\newcommand{\Mseenemp}{\hat{M}_{\mathrm{seen}}}
\newcommand{\Munseenemp}{\hat{M}_{\mathrm{unseen}}}
\newcommand{\Mtestperp}{\Mtest^{\perp}}
\newcommand{\PAtrain}{P_{A, \mathrm{train}}}
\newcommand{\PAtest}{P_{A, \mathrm{test}}}
\newcommand{\Ecal}{\mathcal{E}}
\newcommand{\Eall}{\mathcal{E}_{\mathrm{all}}}
\newcommand{\Etrain}{E_{\mathrm{train}}}
\newcommand{\Ecaltrain}{\mathcal{E}_{\mathrm{train}}}
\newcommand{\Ecaltest}{\mathcal{E}_{\mathrm{test}}}
\newcommand{\Pv}{\bP_v}
\newcommand{\setB}{\mathcal{B}}
\newcommand{\setPv}{\mathcal{P}_v}
\newcommand{\minimax}{\mathfrak{M}}
\newcommand{\dist}[1]{\rho(#1)}
\newcommand{\Invset}{\Theta_{\mathrm{eq}}}
\newcommand{\InvsetC}{\Theta_{\mathrm{eq}}^C}
\newcommand{\Invsetsub}{\Thetainv^{\star}}
\newcommand{\rank}{\text{rank}}
\newcommand\independent{\protect\mathpalette{\protect\independenT}{\perp}}
\def\independenT#1#2{\mathrel{\rlap{$#1#2$}\mkern2mu{#1#2}}}
\newcommand{\scalar}[2]{ \langle #1 , \; #2 \rangle}
% Comments
\definecolor{tolblue}{HTML}{4477AA}
\newcommand{\fy}[1]{{\color{blue} Fanny: {#1}}}
\newcommand{\Yaxi}[1]{{\color{orange} Yaxi: {#1}}}
\newcommand{\Nicola}[1]{{\color{violet} Nicola: {#1}}}
\newcommand{\rmnico}[1]{{\color{lightgray}[Rm(N): {#1}]}}
\renewcommand{\todo}[1]{{\color{red} TODO: {#1}}}
\newcommand{\thetainv}{\theta_{inv}}
\newcommand{\Thetainv}{\Theta_{inv}}
\newcommand{\Lossrob}{\Loss_{\mathrm{rob}}}
\newcommand{\betarob}{\beta^{rob}}
\newcommand{\betarobarg}[1]{\beta^{rob}_{#1}}
\newcommand{\cBrob}{\cB^{rob}_{\Invset}}
\newcommand{\cBrobfull}{\cB^{rob}_{\Invset}}
\newcommand{\distparam}{\rho_{inv}}
\newcommand{\thetatil}{\widetilde{\thetainv}}
\newcommand{\betabar}{\overline{\beta}}
\newcommand{\alphahat}{\hat{\alpha}}
\newcommand{\gammaprime}{\gamma'}
\newcommand{\gammatilde}{\tilde{\gamma}}
\newcommand{\wtilde}{\tilde{w}}
\newcommand{\deltahat}{\hat{\delta}}
\newcommand{\thetainvhat}{\hat{\theta}_{inv}}
\newcommand{\setP}{\mathcal{P}}
\newcommand{\distv}[2]{\rho^{(#1)}(#2)}
\newcommand{\asymdistv}[2]{\tilde{\rho}^{(#1)}(#2)}
\newcommand\betatilde{\tilde{\beta}}
\newcommand\minimaxrate{\psi_n}
\newcommand\datavec{\begin{pmatrix}X\\Y\end{pmatrix}}
\newcommand{\errv}{err^{(\Pv, \cov_U)}}
\newcommand\red[1]{{\color{red}#1}}

\newcommand{\labeledtarget}{\targetset_c}
\newcommand{\F}{\mathcal{F}}
\newcommand{\iddist}{\mathbb{P}}
\newcommand{\ooddist}{\mathbb{Q}}
\newcommand{\hypclass}{\widetilde{\mathcal{F}}}
\newcommand{\estclass}{\widehat{\mathcal{F}}}
\newcommand{\sourceset}{S}
\newcommand{\sourcesetval}{\sourceset_{\text{val}}}
\newcommand{\targetset}{T}
\newcommand{\poploss}{\mathcal{L}}
\newcommand{\emploss}{\mathcal{L}_n}
\newcommand{\targetidset}[0]{T_{\mathrm{ID}}}
\newcommand{\targetoodset}[0]{T_{\mathrm{OOD}}}
\newcommand{\oodsupp}{\X_T}
\newcommand{\idsupp}{\X_S}

\newcommand{\algo}{\mathcal{A}}
\newcommand{\idjoint}[0]{P}
\newcommand{\OODdetectargs}[2]{\mathcal{O}_{#1, #2}}
\newcommand{\OODdetect}[0]{\OODdetectargs{\idsupp}{\Freg}}
\newcommand{\regclass}{\mathcal{F}}
\newcommand{\reggenclass}{\mathcal{F}^\star}
\newcommand{\X}{\mathcal{X}}
\newcommand{\Y}{\mathcal{Y}}
\newcommand{\Yhat}{\widehat{Y}}
\newcommand{\robgamma}{\robpred(\testenvs,\thetaivgt)}
\newcommand{\thetainvgt}{\thetaivgt}
\newcommand{\robparam}[2]{\robpred(#1, #2)}
\newcommand{\robpred}{\robvec^{\text{rob}}}
\newcommand{\robvec}{\beta}
\newcommand{\optparam}{\robvec^\star}
\newcommand{\betastar}{\beta^{\star}}
\newcommand{\noisecovstar}{\noisecov^\star}
\newcommand{\covvup}{M_v}
\newcommand{\Ker}{\text{Ker}}
\newcommand{\im}{\mathrm{im}}
\newcommand{\noisecovxx}{\cov_{\eta}}
\newcommand{\noisecovxxstar}{\cov^\star_{\eta}}
\newcommand{\noisecovxxS}{\cov^{\cS}_{\eta}}
\newcommand{\noisecovxy}{\cov_{\eta,\xi}}
\newcommand{\noisecovxystar}{\cov^\star_{\eta,\xi}}
\newcommand{\noisecovxyS}{\cov^{\cS}_{\eta,\xi}}
\newcommand{\Mxx}{\Gamma_{XX}}
\newcommand{\Mxy}{\Gamma_{XY}}
\newcommand{\noisecovyy}{(\sigma_\xi)^2}
\newcommand{\noisecovyystar}{{(\sigma_\xi^\star)}^2}
\newcommand{\noisecovyyS}{({\sigma_\xi^\cS})^2}

\newcommand{\DAG}{\mathcal{G}}
\newcommand{\disanchors}{\widetilde{\Sigma}_A}
\newcommand{\meanv}{m_v}
\newcommand{\covvset}{\bf{\Sigma}_v}
\newcommand{\norm}[1]{\|#1\|}
\newcommand{\param}{\theta}
\newcommand{\paramstar}{\param^\star}
\newcommand{\ballp}[2]{B_p(#1; #2)}
\newcommand{\pertset}{S_{\text{pert}}}
%\newcommand{\loss}{\ell}
\newcommand{\advrisk}{R_{\text{adv}}}
\newcommand{\EE}{\mathbb{E}\,}
\newcommand{\eps}{\epsilon}
\newcommand{\Null}{\text{Null}}
\newcommand{\Proj}{\Pi}
\newcommand{\perfectfit}{\mathcal{I}}
\newcommand{\G}{\mathcal{G}}
\newcommand{\prob}{\mathbb{P}}
\newcommand{\probsource}{\mathbb{P}_X}
\newcommand{\probx}{\mathbb{P}_x}
\newcommand{\probxset}{\probset_x}
\newcommand{\outprobx}{\mathbb{Q}_x}
\newcommand{\probset}{\mathcal{P}}
\newcommand{\probtrain}{\cP_{\Ecaltrain}}
\newcommand{\ptrain}{\prob^{X,Y}_{\mathrm{train}}}
\newcommand{\probtrainarg}[1]{\cP_{#1, \Ecaltrain}}
\newcommand{\PeX}{\prob_e^{X}}
\newcommand{\PeXY}{\prob_e^{X,Y}}
\newcommand{\PrefXY}{\prob_{\mathrm{ref}}^{X,Y}}
\newcommand{\PoXY}{\prob_0^{X,Y}}
\newcommand{\PeXYarg}[1]{\prob^{X,Y}_{#1, e}}
\newcommand{\PoXYarg}[1]{\prob^{X,Y}_{#1, 0}}
\newcommand{\PeA}{\prob^{A}_{e}}
\newcommand{\PeXYA}{\prob_e^{X,Y,A}}
\newcommand{\PXYgivenA}{\prob^{X,Y | A}}
\newcommand{\PeYgivenX}{\prob^{Y | X}_e}
\newcommand{\probtrainalt}[1]{\prob^{\mathrm{train}}^{#1}}
\newcommand{\probtest}{{\prob_{\mathrm{test}}}}
\newcommand{\probtestXY}{\prob_{\mathrm{test}}^{X,Y}}
\newcommand{\probtestXYarg}[1]{\prob_{#1, \mathrm{test}}^{X,Y}}
\newcommand{\probtestXYAarg}[1]{\prob_{#1, \mathrm{test}}^{X,Y,A}}
\newcommand{\probtestA}{\prob^A_{\mathrm{test}}}
\newcommand{\probtestarg}[1]{\prob^{#1, \mathrm{test}}}
\newcommand{\probsettest}{\probset^{\Mtest}}
\newcommand{\probsettestarg}[1]{\probset^{#1, \Mtest}}
\newcommand{\probtarget}{\tilde{\mathbb{P}}_X}
\newcommand{\probgt}{\PP^{\star}}
\newcommand{\thetainds}{I}
\newcommand{\thetasubinds}{I_{\text{IV}}}
\newcommand{\thetavarinds}{I_{\text{V}}}
\newcommand{\circprod}{\otimes}
\newcommand{\matspaceone}{M_1}
\newcommand{\matspacetwo}{M_2}
\newcommand{\Thetaiv}{\Theta_{\text{inv}}}
\newcommand{\thetaiv}{\thetainv}
\newcommand{\thetastar}{\theta^{\star}}
\newcommand{\thetacS}{\theta^{\cS}}
\newcommand{\thetaivgt}{\thetainv^{\star}}
\newcommand{\Spaceproj}{P_{\text{iv}}}
\renewcommand{\minimax}{\mathfrak{M}}
\newcommand{\powerset}{\mathfrak{P}}
\newcommand{\trainsets}{S_{\text{tr}}}
\newcommand{\testsets}{S_{\text{te}}}
\newcommand{\Xpa}{X_{\text{pa(Y)}}}
\newcommand{\TVdist}{\text{TV}}
\newcommand{\probone}{\probset_1}
\newcommand{\probd}{\probset_d}
\newcommand{\probnoise}{\prob_{\eps}}
\newcommand{\probjoint}{\probset_{d+1}}
\newcommand{\minimaxrob}{\minimax_R}
\newcommand{\trainindexset}{I(\trainenvs)}
\newcommand{\probseterror}{\prob_{\text{err}}}
\newcommand{\thetav}{\theta_{\text{V}}}
\newcommand{\Thetav}{\Theta_{\text{V}}}
\newcommand{\Thetaivsup}{\widetilde{\Theta}_{\text{IV}}}
\newcommand{\normal}{\mathcal{N}}
\newcommand{\tildeP}{\tilde{\mathbb{P}}}
\newcommand{\envs}{\mathcal{E}}
\newcommand{\testenvs}{\mathcal{E}_{\text{all}}}
\newcommand{\trainenvs}{\mathcal{E}_{\text{tr}}}
\newcommand{\modeldist}{\mathcal{M}}
\newcommand{\distprob}{D}
\newcommand{\Covexo}{\Sigma_U}
\newcommand{\paraminv}{\theta_{\text{iv}}}
\newcommand{\paraminvstar}{\paraminv^{\star}}
\newcommand{\epstil}{\tilde{\epsilon}}
% \newcommand{\argmin}{\text{arg}\min}

\newcommand{\Inv}{\text{Inv}}
\newcommand{\Id}{\text{Id}}
\newcommand{\Abar}{\overline{A}}
\newcommand{\diag}{\text{diag}}
\newcommand{\sgn}{\text{sgn}}
\newcommand{\Rbar}{\overline{R}}
\newcommand{\Rtilde}{\tilde{R}}
\newcommand{\wstarbar}{\overline{w}^\star}
\newcommand{\betapp}{\betastar^{pp}}
\newcommand{\betaadv}{\betastar_{\mathrm{adv}}}
\newcommand{\thetaadv}{\theta_{\mathrm{adv}}}
\newcommand{\betakp}{\betastar^{kp}}
\newcommand{\what}{\hat{w}}
\newcommand{\betappstar}{\betastar^{pp}}
\newcommand{\betakpstar}{\betastar^{kp}}
\newcommand{\betastarker}{\betastar^{\perp}}
\newcommand{\betarobpi}{\beta^{\mathrm{rob}}_{\Invset}}
\newcommand{\betarobpihat}{\hat{\beta}^{\mathrm{rob}}_{\Invset}}
\newcommand{\Lossrobpi}{\mathfrak{R}_{\mathrm{rob}}}
\newcommand{\Lossrobpihat}{\hat{\mathcal{R}}_{\mathrm{rob, ID}}}
\newcommand{\betahat}{\hat{\beta}}
\newcommand{\eref}{e_0}
\newcommand{\Canchor}{C_{\mathrm{anchor}}}
\newcommand{\Cnew}{C_{\mathrm{new}}}
\newcommand{\Manchor}{M_{\mathrm{anchor}}}
\newcommand{\Mdrig}{M_{\mathrm{DRIG}}}
\newcommand{\Mnew}{M_{\mathrm{new}}}
\newcommand{\N}{\mathcal{N}}
\newcommand{\Cker}{C_{\mathrm{ker}}}
\newcommand{\Ckerhat}{\hat{C}_{\mathrm{ker}}
}
\newcommand{\range}{\mathrm{range}}
\newcommand{\Rperp}{R^\perp}
\newcommand{\Stot}{S_\mathrm{tot}}

\newcommand{\Mperp}{M_{\perp}}
\newcommand{\Mperpv}{M_{\perp, v}}
\newcommand{\MperpO}{M_{\perp,0}}
\newcommand{\Ms}{M_s}
\newcommand{\wbar}{\overline{w}}
\newcommand{\indicator}{\mathbb{I}}
\newcommand{\betao}{\beta_{\text{OLS}}}
\newcommand{\betaa}{\beta_{\text{anchor}}}
\newcommand{\betap}{\betastar^{\perp}}
\newcommand{\Xe}{X_e}
\newcommand{\Xref}{X_{\mathrm{ref}}}
\newcommand{\Yref}{Y_{\mathrm{ref}}}
\newcommand{\Ye}{Y_e}
\newcommand{\Ae}{A_e}
\newcommand{\mue}{\mu_e}
\newcommand{\muref}{\mu_{\mathrm{ref}}}
\newcommand{\Sigmae}{\Sigma_e}
\newcommand{\Sigmaref}{\Sigma_{\mathrm{ref}}}
\newcommand{\Sigmastar}{\Sigma^{\star}}
\newcommand{\spn}{\mathrm{span}\,}
\newcommand{\rnk}{\text{rank }}
\newcommand{\idset}{observationally equivalent set\,}
\newcommand{\idsetN}{observationally equivalent set}
\newcommand{\Idset}{Observationally equivalent set\,}
\newcommand{\betaOLS}{\beta_{\mathrm{OLS}}}
\newcommand{\betaOLShat}{\hat{\beta}_{\mathrm{OLS}}}
\newcommand{\betaahat}{\hat{\beta}_{\mathrm{anchor}}}
\newcommand{\betaDRIG}{\beta_{\mathrm{DRIG}}}
\newcommand{\betaprior}{\beta_{\mathrm{prior}}}
\newcommand{\Etest}{\cE_{\text{test}}}
\newcommand{\given}{\, | \,}
\newcommand{\Cat}{\text{Cat}}
\newcommand{\Xtest}{X^{\text{test}}}
\newcommand{\Ytest}{Y^{\text{test}}}
\newcommand{\Atest}{A_{\text{test}}}
\newcommand{\projM}{\Pi_{\cM}}
\newcommand{\mutest}{\mu_{\text{test}}}
\newcommand{\Sigmatest}{\Sigma_{\text{test}}}
\newcommand{\cSperp}{\cS^\perp}
\newcommand{\cShat}{\hat{\cS}}
\newcommand{\cSperphat}{\hat{\cS}^\perp}
\newcommand{\Shat}{\hat{S}}
\newcommand{\Rhat}{\hat{R}}
\newcommand{\SShat}{\Shat \Shat^\top}
\newcommand{\RRhat}{\Rhat \Rhat^\top}
\newcommand{\PicShat}{\Pi_{\cShat}}
\newcommand{\PicSperphat}{\Pi_{\cSperphat}}
\newcommand{\betastarS}{\beta^{\cS}}
\newcommand{\betaS}{\beta^{\cS}}
\newcommand{\thetastarS}{\theta^{\cS}}
\newcommand{\betastarperp}{\beta^{\cSperp}}
\newcommand{\PS}{\mathcal{P}_{\cS}}
\newcommand{\Pperp}{\mathcal{P}_{\cSperp}}
\newcommand{\PMperp}{P_{\Mperp}}
\newcommand{\covAe}{\Sigma_e}
\newcommand{\Robset}{\cP(\gamma \projM)}
\newcommand{\gammath}{\gammaprime_{\mathrm{th}}}
\newcommand{\Robsetarg}[1]{\cP_{#1}(\Mtest)}
\newcommand{\Robsettwoarg}[2]{\cP_{#1}(#2)}
\newcommand{\Robsetarganchor}{\cP_{\thetastarS}(\gamma, S)}
\newcommand{\supalpha}{\sup_{\substack{\alpha \in \cSperp, \\ \| \alpha \|_2 \leq \Cker} }}
\newcommand\+{\mkern2mu}

\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%
\newcommand{\minimaxPIloss}{\mathfrak{M}(\Invset, \Mtest)}
\newcommand{\minimaxPIlossarg}[1]{\mathfrak{M}(\Invset, #1)}
\newcommand{\idRRs}{worst-case robust risk }
\newcommand{\idRR}{worst-case robust risk}
\newcommand{\IdRR}{Worst-case robust risk }
\newcommand{\idpreds}{worst-case robust prediction model }
\newcommand{\idpred}{worst-case robust predictor}
\newcommand{\MM}{\tilde{\cR}}
\newcommand{\trace}{\mathrm{tr}\,}
\newcommand{\Iobs}{\mathcal{O}}
\newcommand{\Iint}{\mathcal{I}}
\newcommand{\Dtrain}{\mathcal{D}^{\text{train}}}
\newcommand{\Dtest}{\mathcal{D}^{\text{test}}}
\newcommand{\cD}{\mathcal{D}}
\newcommand{\LL}{\mathcal{L}}
\newcommand{\LLref}{\mathcal{L}_{\mathrm{ref}}}
\newcommand{\LLinv}{\mathcal{L}_{\mathrm{inv}}}
\newcommand{\LLid}{\mathcal{L}_{\mathrm{id}}}
\newcommand{\refenv}{\mathrm{ref}}
\newcommand{\Petaxi}{\mathbb{P}^{\eta,\xi}}

\definecolor{asparagus}{rgb}{0.53, 0.66, 0.42}
\definecolor{dollarbill}{rgb}{0.52, 0.73, 0.4}

\newcommand{\noteby}[3]{{\colorbox{#2}{\bfseries\sffamily\scriptsize\textcolor{white}{#1}}}{\textcolor{#2}{\sf\small\textit{#3}}}}
\newcommand{\julia}[1]{\noteby{Julia}{blue!80!green}{ #1}}
\newcommand{\nico}[1]{\noteby{Nicola}{violet!80}{ #1}}
\renewcommand{\fy}[1]{\noteby{Fanny}{dollarbill}{ #1}}

