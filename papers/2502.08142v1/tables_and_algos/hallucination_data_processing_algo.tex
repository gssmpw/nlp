
\begin{algorithm}[!t]
\textbf{Inputs:} 
$\mathcal{D}$: a training dataset that contains ``context'', ``inputs'', ``llm\_answer'', and ``labels'' for hallucination; %\textit{response\_template}: for indicating the start of the response, e.g., ``{\#\#\# Response:}''; 
\textit{\text{prompt}\_\text{template}}: for formulating the hallucination detection data, see Figure~\ref{fig: training_data_example}; \textit{\text{GPT}\_\textit{reasoning}\_\text{template}}: for generating prompts for GPT API, see Figure~\ref{fig: training_data_example}.

\textbf{Outputs:} $\mathcal{D}_t$: the training dataset.


\nl{\bf Function $\boldsymbol{\mathit{process\_data}(\mathcal{D})}$} \nllabel{ln:function_process_data}
\Begin{

\nl $\mathcal{D}_t\leftarrow \phi$

\nl \For{$d \in $ $\mathcal{D}$}{

\nl \eIf{$\mathit{is}\_\mathit{hallucination}$($d$)}{

\nl $\mathit{halu}\_\mathit{reason}\leftarrow\mathit{GPT}\_\mathit{API}$(\textit{GPT}\_\textit{reasoning}\_\textit{template}($d$[``$\mathit{question}$''], $d$[``$\mathit{context}$''], $d$[``$\mathit{llm}\_\mathit{answer}$'']))

\nl $\mathit{response}\leftarrow$ ``Yes, '' + $\mathit{halu}\_\mathit{reason}$


\nl $d^\prime\leftarrow$\textit{prompt}\_\textit{template}($d$[``$\mathit{question}$''], $d$[``$\mathit{context}$''], $d$[``$\mathit{llm}\_\mathit{answer}$''], $\mathit{response}$)

}{

\nl $d^\prime\leftarrow$\textit{prompt}\_\textit{template}($d$[``$\mathit{question}$''], $d$[``$\mathit{context}$''], $d$[``$\mathit{llm}\_\mathit{answer}$''], ``$\mathit{No.}$'')


}

\nl $\mathcal{D}_t$.$\mathit{add}(d^\prime)$

}

\nl \textbf{return $\mathcal{D}_t$}
}

\caption{Hallucination detection training data processing.}
\label{alg:hallucination_data_processing}
\end{algorithm}
