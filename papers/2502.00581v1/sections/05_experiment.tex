\section{Results}
\label{sec:Experimental_Results}


\begin{figure}[!t]
  \centering
  \includegraphics[width=\columnwidth]{figs/mission_plan.pdf}
  \caption{Planned Mission: Two loiter trajectories (yellow) and centered in $L_1$ and $L_2$ are linked together by two Bernstein trajectories passing through the set of waypoints $S_{\mathcal{B}_1} = [B_1, \dots, B_4]$ and $S_{\mathcal{B}_2} =[B_5, \dots, B_7]$ with a visualization of the replanning strategy (top right). 
  \label{fig:planned_mission}}
  \vspace{-10pt}
\end{figure}


In this section, we outline the mission planning for the fixed-wing using the combination of Bernstein polynomials and circular loiter trajectories. We conduct multiple experiments in a simulation environment, as shown in Fig.~\ref{fig:software_architecture} and in real-world settings in our outdoor flying arena located at Calvert Park in New York City. The design of the platform is inspired by the system proposed in \cite{wuest2022accurate}. The FW aircraft used in our experiments, shown in Fig. \ref{fig:fig1}, is a Hobby King Bixler 3 model, which is equipped with a Holybro\textsuperscript{{\textregistered}} PX4\footnote{\url{https://px4.io/}} Pixhawk autopilot for low-level attitude controller. Onboard computation is handled by an NVIDIA\textsuperscript{{\textregistered}} Jetson Xavier Orin board, running Ubuntu 20.04 and the ROS\footnote{\url{www.ros.org}} framework for intra-processes communications. For localization, we use a Drotek\textsuperscript{{\textregistered}} F9P GNSS receiver module, integrated with the PX4 EKF2-based state estimator.
We modeled the aerodynamic parameters described in Section \ref{sec:Aerodynamics_and_prop} following the approach outlined in \cite{Beard_book}. The planner and trajectory manager, as illustrated in Fig. \ref{fig:software_architecture}, operate at $100~\si{Hz}$ to ensure smooth and continuous control. Mission data is transmitted to the trajectory manager via the QGroundControl\textsuperscript{{\textregistered}} interface, running on a separate ground station. The interface also provides a real-time visualization of the vehicleâ€™s status. %through telemetry data.  

\begin{figure}[!t]
  \centering
  \includegraphics[width=\columnwidth]{figs/optimization_time_boxplot.pdf}
  \caption{The average optimization computation time $\bar{t}_{opt}$ increases linearly with the number of waypoints remaining unaffected by the trajectory length.
  \label{fig:optimization_time}}
  \vspace{-20pt}
\end{figure}

\begin{figure*}[!t]
  \centering
  \includegraphics[width=1.0\textwidth]{figs/sim_tests_plot.pdf}
    \vspace{-20pt}
  \caption{Simulation results obtained using the SITL PX4 simulator with Gazebo as the physics engine with a planned mission similar to Fig.~\ref{fig:planned_mission}. In $2~\si{m/s}$ NE wind conditions. The results show good position and attitude tracking performance. The yaw $\psi$ (green) is not a control variable. 
  \label{fig:experiment_result}}
  \vspace{-10pt}
\end{figure*}


\begin{figure*}[!t]
  \centering
  \includegraphics[width=1.0\textwidth]{figs/real_tests_plot_attitude.pdf}
    \vspace{-20pt}
  \caption{Results obtained in real experimentation with our platform, leveraging the differential flatness equations and forwarding desired attitude commands to an onboard PX4 controller, in the mission proposed in Fig. \ref{fig:planned_mission}. Despite a recorded wind with $3.4~\si{m/s}$, the results show a very close sim-to-real gap with good tracking capability of the reference trajectory.
  \label{fig:real_experiment_result}}
  \vspace{-20pt}
\end{figure*}


%To put iterations instead of traj
\begin{figure}[t]
  \centering
  \includegraphics[width=1.0\columnwidth]{figs/curvature_k.pdf}
  \caption{Bernstein Trajectory replanning over multiple iterations for curvature constraint feasibility. 
  \label{fig:curvature_k_result}}
  \vspace{-20pt}
\end{figure}

\subsection{Mission Planning}
For both simulation and real-world experiments, we plan the mission using the QGroundControl (QGC) interface as visible in Fig. \ref{fig:planned_mission}. The waypoints are uploaded to the onboard computer, referencing map coordinates, with each waypoint serving a specific purpose. We designed an experiment that combined multiple consecutive trajectories. The loiter waypoints, denoted by $L_1$ and $L_2$, generate circular loiter trajectories depicted in yellow. Two additional intermediate Bernstein polynomial trajectories are generated through Bernstein waypoints ($B_1, B_2, B_3, B_4$) and ($B_5, B_6, B_7$), visible in black. 
The trajectory is optimized online using the C++ OSQP library~\cite{osqp}, which computes kilometers long trajectories in less than a second, as visible in Fig.~\ref{fig:optimization_time}, where an average optimization time $\bar{t}_{opt}$ has been computed between $4$ consecutive optimization run with an increasing waypoints number. 
In the setup proposed in Fig. \ref{fig:planned_mission}, we measure $\bar{t}_{opt} = 0.083~\si{ms}$. To impose the non-linear constraint $\kappa$, we run a continuous trajectory replanning at $10~\si{Hz}$. 

%In Section \ref{section:sim_results}, we present the simulation results. Then, in Section \ref{section:rw_results}, we provide the outcomes from performing the same mission in a real-world scenario.

\subsection{Simulation Results}
\label{section:sim_results}
We validate our proposed solution in multiple simulation experiments. To decrease the sim-to-real gap, we leverage the PX4 SITL simulator, which provides the possibility of accurate simulated fixed-wing dynamics and the advantage of planning the mission directly in the location where the real tests are going to be performed. As visible in Fig. \ref{fig:planned_mission}, the mission is composed of two loiter trajectories with a radius $r = 45~\si{m}$ each and connected at the tangential points by two Bernstein trajectories. The entire length of the trajectory is $1143.24~\si{m}$, and a wind of $2~\si{m/s}$ has been simulated in the NE direction. 
The trajectory tracking results are shown in Fig.~\ref{fig:experiment_result}. We define with $RMSE_{pos}$ and $RMSE_{vel}$  the combined Root Mean Square Error across the three Cartesian directions for positions and velocities, respectively, which is $RMSE_{pos} = 6.031~\si{\meter}$ and $RMSE_{vel} = 3.316~\si{m/s}$. 
The maximum and minimum values of roll recorded during the overall trajectory length are $\phi_{max} = 0.572~\si{rad}$ and $\phi_{min} = 0.561~\si{rad}$ respectively.
An example of the proposed replanning technique along the trajectory connecting waypoint $B_5 - B_7$  is visualized in Fig. \ref{fig:curvature_k_result}. As visible, after a distance of $d = 120~\si{m}$ the curvature of the trajectory computed at iteration $i= 1$ exceeds the desired value of $\kappa=\pm 0.02$, but the continuous replanning strategy ensures that the trajectory computed at $i = 5$ is shaped respecting locally the curvature constraint presented in eq.~\eqref{eq:curvature}.

\subsection{Real World Experiments}
\label{section:rw_results}
Next, to validate the performances of our control and planning solutions, we conduct several experiments in real-world scenarios, leveraging our in-house developed platform visible in Fig. \ref{fig:fig1} and introduced in Section \ref{sec:Experimental_Results}.

The results are illustrated in Fig. \ref{fig:real_experiment_result}, showing the aircraft's behavior during a 5-minute experiment. The total distance traveled is 3256.81~\si{m}, with a desired airspeed of $Va = 14~\si{m/s}$. The mission setup is similar to that depicted in Fig. \ref{fig:planned_mission} and discussed in the previous section. During the experiment, wind conditions are at an intensity of 3.4~\si{m/s} from a southeast direction. 
As noticeable, our approach provides good planning and tracking results showing similar performance with respect to simulation results with a global tracking error in positions and velocities of $RMSE_{pos} = 13.441~\si{m}$ and $RMSE_{vel} = 10.895~\si{m/s}$ respectively.
Moreover, during the test, the Bernstein trajectories are continuously generated by the optimizer, requiring an average optimization time $\bar{t}_{opt} =  0.0623~\si{s}$, proving the reliability and the applicability of our method also in continuous real-time flight conditions. 
During the experiment, the aircraft achieves a maximum and minimum value of a roll of $\phi_{max} = 0.87~\si{rad}$ and $\phi_{min} = -0.649~\si{rad}$ respectively. Our successful experimental results prove the applicability and reliability of the proposed approach for controlling FW-UAVs in real scenarios.




% --------------------------------------------------------------------------
% Extra writing:


%The mission waypoints are uploaded to the onboard computer prior to the flight, where they are stored and later used to generate real-time trajectories through our trajectory generation algorithm. Uploading waypoints in advance ensures that there is no risk of information loss during the flight due to communication interruptions, providing a more reliable and robust mission execution. In our experiments, we conducted several missions, including straight-line paths and continuous circular motion. However, in this paper, we focus on the key experiment, which is a horizontal figure-eight path that combines straight lines, circular segments, and a Bernstein polynomial trajectory. All missions were executed consistently in both simulation and real-world environments.

%To further explore and test more complex mission maneuvers, we designed an experiment that combined multiple trajectories, as shown in Figure \ref{fig:planned_mission}. We used a similar QGroundControl (QGC) interface to upload the waypoints, with each waypoint serving a specific purpose. 

% The mission is visible in Fig. \ref{fig:planned_mission}, and it is the same for both the simulation and real-world scenarios. Given the two loitering waypoints, respectively $L_1$ and $L_2$, two Bernstein trajectories $\mathcal{B}_1$ and $\mathcal{B}_2$, respectively visible in black,  are generated for both the connection of the two circular trajectories $\mathcal{C}_1$ and $\mathcal{C}_2$, visible in yellow and generated around $L_1$ and $L_2$. As visible in Fig. \ref{fig:fig3}, $\mathcal{B}_1$ is generated through the waypoints set $S_{\mathcal{B}_1} = [B_1, B_2, B_3, B_4]$, where $B_1$ and $B_4$ are teh start and ending waypoints connecting  $\mathcal{C}_1$ to $\mathcal{C}_2$. In the opposite direction, the trajectory $\mathcal{B}_2$ is generated through the waypoints set $S_{\mathcal{B}_2}  = [B_5, B_6, B_7]$. 

% In both the cases, and similar in the real world experiments, our planner formulation based on the C++ OSQP library [22], required an average of .. ms for the formulation of a ... meters long trajectory. A $10 Hz$ based replanning strategy has been adopted in order to continuously recompute the trajectory applying the linearized curvature constraints visible in Section .. and equation 23. Due to the non linearity nature of this constraint formulation, the result of its linearization is valid only in the proximity of the desired tracking point $\rho(s(t))_{j}$, requiring a continuous re-evaluation of the optimized bernestein trajectory as the point moves forward. 

% In order to avoid discontinuities between the current trajectory $\mathcal{B}_{j}$ and the replanned one, defined as $\mathcal{B}_{j+1}$, we consider as initial point of $\mathcal{B}_{j+1}$ the point  $\rho(s(t))_{j+1} = \rho(s(t))_{j} + t_{opt}$, where $t_{opt}$ is the expected optimization time required by the solver. A sketch of teh proposed solution is visible in Figure \ref{fig:fig3}. With this approach, we consider the distance $s_{opt}$ traversed by the tracking point during the actual time the solver is computing a solution, avoiding that the initial point of $\mathcal{B}_{j+1}$ will be already passed by the tracking point $\rho(s(t))_{j}$.

% \subsubsection{Circular loiter mission}

% As mentioned in the Trajectory Planning section, loiter trajectories are crucial for fixed-wing motion, as these vehicles cannot hover in place like multicopters and must maintain continuous forward motion. A loiter trajectory ensures this by enabling smooth transitions between two planned paths. It is a constant-speed trajectory characterized by a predefined radius and initiated from the endpoint of the previous trajectory. Once the previous path is completed, the aircraft immediately enters the loiter phase. In our first mission, we validated our approach and software architecture by executing continuous loitering. The loiter waypoint was defined in world coordinates using QGroundControl (QGC). When the simulator started, it retrieved this waypoint, as previously described. After takeoff, the fixed-wing aircraft activated offboard mode and followed a straight path toward the loiter waypoint. Upon reaching the waypoint, it transitioned smoothly into the loiter trajectory, remaining in the loop until a new waypoint mission was assigned. To simulate real-world conditions in PX4 SITL, we integrated wind speeds of up to $5 m/s$, reflecting typical conditions at our outdoor test site. The tracking results are shown in Figure [..].

% Compared to other methods that rely on a combination of bank-turn mechanisms and Dubins paths, our polynomial-based loiter trajectory offers smoother transitions and improved computational efficiency.


% \subsubsection{Horizontal eight with Bernstein flight}



% \begin{table}[t]
%     \addtolength{\tabcolsep}{-0.54em}
%     \centering
% \centering
% \begin{tabular}{ccc}
%         \toprule\toprule
% No of Waypoints & Trajectory Length ($\si{m}$) & Optimization Time~($\si{ms}$) \\
%         \toprule\toprule
%  2  & 118.67    & 0.041968 \\
%  \hline
%  3  & 273.98    & 0.084043 \\
%  \hline
%  4  & 377.45    & 0.122251 \\
%  \hline
%  6  & 690.32    & 0.208286 \\
%     & 1121.87   & 0.204270 \\
% \hline
%  8  & 791.46    & 0.298645 \\  
%     & 1401.74   & 0.292280 \\  
% \hline
%  12 & 1193.917  & 0.472905 \\  
%     & 1600.587  & 0.485299 \\
% \hline
%  16 & 2362.78   & 0.655619 \\
%     & 6209.62   & 0.681113 \\
%    \bottomrule\bottomrule
% \end{tabular}
% \caption{Computatio time for trajectory generation. The variance in computation time is primarily influenced by the number of waypoints, showing minimal variance with changes in trajectory length for the same waypoint count.}
% \label{tab:optimization_time}
% \end{table}




