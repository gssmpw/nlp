\section{Numerical Results}\label{sec:numerical-results}

In order to show that the theory holds numerically, we have devised some tests for the
non-homogeneous vector Laplace problem and the Maxwell eigenvalue problem. We focus on these
tests, which are formulated using vector fields, since the homogeneous boundary conditions
that arise in the weak formulations of these problems, both essential and natural, imply the
non-existence of harmonic scalar fields.

For all the ensuing examples, we chose to work with \(h\)-refinement for primarily two
reasons. First, it makes for more visually compelling examples of what sorts of refinements
are problematic or not. Second, using \(p\)-refinement precludes the use of maximally smooth
B-splines, which is one of the major advantages of IGA. Despite this, all the results in
\Cref{sec:exact-meshes} still hold for such refinement schemes.

\subsection{Vector Laplace problem}

Let the domain  \(\domain \subseteq \mathbb{R}^2\) be the unit square \([0,1]^2\). Since the
domain is simply connected, the continuous de Rham complex has no harmonic vector fields,
and as such, neither should our discretized complex. Considering the mixed weak formulation
of the vector Laplace problem with natural, homogeneous boundary conditions,  the relevant objects we wish to find are \(\scltrial \in
\Hone\) and \(\vectrial \in \Hcurl\) such that   
\begin{alignat*}{2}
	\langle \scltrial, \scltest\rangle - \langle \vectrial, \grad\scltest \rangle &= 0,\quad
	&&\forall \scltest \in \Hone,\\
	\langle \grad\scltrial, \vectest \rangle + \langle \curl \vectrial, \curl \vectest
	\rangle &= \langle \forcing, \vectest \rangle,\quad &&\forall \vectest\in \Hcurl.
\end{alignat*}
For the first test, we will take as the analytical solution 
\begin{equation}
    \label{eq:1-form-example-solution}
    \solution(x, y) = 
    \begin{bmatrix}
        x(1-x) \\
        0
    \end{bmatrix}.
\end{equation}
We will try to solve the problem on two different meshes ― one exact and the other not ―
just to illustrate the spurious results that can arise from  refinement that does not respect the conditions for exactness. The
two meshes are shown in \cref{fig:1-form-example}. We will denote the computed solution
using the \cref{fig:1-form-example-a,fig:1-form-example-b} meshes as \(\vectrial^a_h\) and
\(\vectrial^b_h\), respectively.
\begin{figure}[htbp]
    \centering
    \hfill
    \begin{subfigure}[b]{0.35\textwidth}
        \centering
        \input{1-form-example-a.tex}
        \caption{}
        \label{fig:1-form-example-a}
    \end{subfigure}
    \begin{subfigure}[b]{0.35\textwidth}
        \centering
        \input{1-form-example-b.tex}
        \caption{}
        \label{fig:1-form-example-b}
    \end{subfigure}
    \hfill
    \strut

	\caption{Two hierarchical meshes. The mesh in \cref{fig:1-form-example-a} has two
	problematic intersections while the one in \cref{fig:1-form-example-b} is the result of
	applying \cref{alg:exact-mesh} to the mesh in \cref{fig:1-form-example-a} and therefore
	has none.}
    \label{fig:1-form-example}
\end{figure}

The discrete version of the problem is then to find \(\scltrial_h \in \thbspace^{0}_{L}\)
and \(\vectrial_h \in \thbspace^{1}_{L}\) such that   
\begin{alignat*}{2}
	\langle \scltrial_h, \scltest\rangle - \langle \vectrial_h, \grad\scltest \rangle &=
	0,\quad &&\forall \scltest \in \thbspace^{0}_{L}\;,\\ \langle \grad\scltrial_h, \vectest
	\rangle + \langle \curl \vectrial_h, \curl \vectest \rangle &= \langle \forcing,
	\vectest \rangle\;,\quad &&\forall \vectest\in \thbspace^{1}_{L},
\end{alignat*}
and \(p_{(\level, k)}=3\) for all \(\level\) and \(k\). It is easy to see that \(u \subseteq
\thbspace^{1}_{L}\), and therefore we should be able to compute the solution exactly, up to
machine precision, in the case of \cref{fig:1-form-example-b}. However, due to the
problematic intersections in \cref{fig:1-form-example-a} we expect to introduce spurious
harmonic vector fields. This is evidenced after computing the corresponding \(L^2\)-norm
errors, as we get the values
\begin{equation*}
    \|\vectrial^a_h - \vectrial \| \approx 0.084037,
	\quad
	\|\vectrial^b_h - \vectrial \| \approx 4.946255\times10^{-16}.
\end{equation*}
The appearance of spurious harmonic vector fields introduced by the problematic intersections can also be seen in \Cref{fig:1-form-example-harmonics}.
\begin{figure}[htbp]
    \centering
	\begin{minipage}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=0.85\textwidth]{1-form-example-harmonics.png}
        \caption{
			Plot of the magnitude of the vector field \(\vectrial^a_h - \vectrial\), for
			\(\vectrial\) in \cref{eq:1-form-example-solution}, showcasing the spurious
			harmonic vector fields.
        }
        \label{fig:1-form-example-harmonics}
    \end{minipage}\hfill
	\begin{minipage}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=0.9\textwidth]{1-form-adaptive-solution.png}
        \caption{
			Magnitude of the analytical solution in \cref{eq:1-form-adaptive-solution}.
		}
        \label{fig:1-form-adaptive-solution}
    \end{minipage}
\end{figure}

In the second test, the analytical solution is 
\begin{equation}
    \label{eq:1-form-adaptive-solution}
    \solution(x,y) =
    \begin{bmatrix}
        \sin(\pi x)(1-\tanh(100((x-0.5)^2+ (y-0.5)^2-0.3^2))) \\
        \sin(\pi y)(1-\tanh(100((x-0.5)^2+ (y-0.5)^2-0.3^2)))
    \end{bmatrix}.
\end{equation} 
To get a better sense of the circular feature present in the problem, we show a plot of the
analytical solution in \cref{fig:1-form-adaptive-solution}. 

We will perform an adaptive refinement scheme, using the analytical solution to calculate
the \(L^2\)-error per element and a Dörfler parameter \(\theta=0.06\) to mark elements for
refinement. This parameter determines the cut-off error from which elements are no longer
refined. We refer the reader to \cite{Doerfler1996, Buffa2017} for extra details.

The starting finite element space of \(\stensorsplinespace{0}{0}\),
corresponding to a tensor product B-spline space, has polynomial degree \(p_{(0,k)}=3\) for
both dimensions, and it will be kept as such for all further refinement levels. 
\Cref{fig:1-form-adaptive-problematic,fig:1-form-adaptive-lchain}  demonstrate the difference
between the adaptive refinement techniques both with and without the refinement scheme of \Cref{alg:exact-mesh}. There, it is easy
to see the kind of behaviour that can arise when exact refinements are not considered during
the refinement process.

\begin{figure}[htbp]
    \centering
    \def\subfigwidth{0.95} 
    \def\halfsubfigwidth{0.475} 
    \begin{minipage}{0.32\textwidth}
        \begin{subfigure}[t]{\subfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{
				1-form-adaptive-problematic-step-1.png
			}
            \caption{Step 1.}
        \end{subfigure}
        \begin{subfigure}[t]{\subfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{
				1-form-adaptive-problematic-step-4.png
			}
            \caption{Step 4.}
        \end{subfigure}
    \end{minipage}
    \begin{minipage}{0.32\textwidth}
        \begin{subfigure}[t]{\subfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{
				1-form-adaptive-problematic-step-2.png
			}
            \caption{Step 2.}
        \end{subfigure}
        \begin{subfigure}[t]{\subfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{
				1-form-adaptive-problematic-step-5.png
			}
            \caption{Step 5.}
        \end{subfigure}
    \end{minipage}
    \begin{minipage}{0.32\textwidth}
        \begin{subfigure}[t]{\subfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{
				1-form-adaptive-problematic-step-3.png
			}
            \caption{Step 3.}
        \end{subfigure}
        \begin{subfigure}[t]{\subfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{
				1-form-adaptive-problematic-step-6.png
			}
            \caption{Step 6.}
        \end{subfigure}
    \end{minipage}
    \begin{minipage}{0.64\textwidth}
        \centering
        \begin{subfigure}[t]{\halfsubfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{
				1-form-adaptive-problematic-step-7.png
			}
            \caption{Step 7.}
        \end{subfigure}
        \begin{subfigure}[t]{\halfsubfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{
				1-form-adaptive-problematic-step-8.png
			}
            \caption{Step 8.}
        \end{subfigure}
    \end{minipage}
    \caption{
		Adaptive refinement without \cref{alg:exact-mesh} for the vector Laplace problem with
		analytical solution \eqref{eq:1-form-adaptive-solution}. After the first refinement
		4 problematic intersections are introduced. Moreover, each intersection is
		responsible for an error with a different order of magnitude than rest, making it
		hard to resolve this issue in a single step of the adaptive loop. As a consequence,
		4 steps of the process are wasted refining these intersections until, by mere
		chance, this is fixed in Step 6.
	}
    \label{fig:1-form-adaptive-problematic}
\end{figure}

\begin{figure}[htbp]
    \centering 
    \def\subfigwidth{0.99} 
    \begin{minipage}{0.35\textwidth}
        \begin{subfigure}[t]{\subfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{1-form-adaptive-lchain-step-1.png}
            \caption{Step 1.}
        \end{subfigure}
        \begin{subfigure}[t]{\subfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{1-form-adaptive-lchain-step-3.png}
            \caption{Step 3.}
        \end{subfigure}
    \end{minipage}
    \begin{minipage}{0.35\textwidth}
        \begin{subfigure}[t]{\subfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{1-form-adaptive-lchain-step-2.png}
            \caption{Step 2.}
        \end{subfigure}
        \begin{subfigure}[t]{\subfigwidth\textwidth}
            \centering
            \includegraphics[width = \textwidth]{1-form-adaptive-lchain-step-4.png}
            \caption{Step 4.}
        \end{subfigure}
    \end{minipage}
    \caption{
		Adaptive refinement using \cref{alg:exact-mesh} for the vector Laplace problem with
		analytical solution \eqref{eq:1-form-adaptive-solution}. By adding \lchains
		according to \cref{alg:exact-mesh}, we avoid the problematic intersections
		encountered in \cref{fig:1-form-adaptive-problematic} and arrive at a similar final
		refined mesh in half the number of steps.
	}
    \label{fig:1-form-adaptive-lchain}
\end{figure}

\subsection{Maxwell eigenvalue problem}

Consider now the domain \(\domain \subseteq \mathbb{R}^2\) as the square \([0,\pi]^2\). In
this case, problem in question is to find \(\omega \in \mathbb{R}\) and \(\vectrial \in
\Hcurlzero\) such that \[
	\langle \curl \vectrial, \curl \vectest \rangle = \omega^2\langle \vectrial, \vectest
	\rangle,\ \forall \vectest \in \Hcurlzero,
\]
where \[
	\Hcurlzero := \left\{ \vectest \in \Hcurl : \vectest \times \boldvec{n} = 0 \text{ on }
	\partial \domain \right\},
\]
where \(\boldvec{n}\) is the outward unit normal to the boundary of \(\domain\). It is well
known that the eigenvalue solutions satisfy \(\omega^2 = m^2+n^2\) with \(m,n \in
\{0,1,\dots\}\). Once again, no harmonic vector fields are expected due to the topology of
the domain. We will also solve this problem on two distinct meshes, see
\cref{fig:maxwell-example}, to highlight how spurious harmonic vector fields can alter the
solution in subtler ways than before.
\begin{figure}[htbp]
    \centering
    \hfill
    \begin{subfigure}[b]{0.4\textwidth}
        \centering
        \input{maxwell-example-a.tex}
        \caption{}
        \label{fig:maxwell-example-a}
    \end{subfigure}
    \hspace{10pt}
    \begin{subfigure}[b]{0.4\textwidth}
        \centering
        \input{maxwell-example-b.tex}
        \caption{}
        \label{fig:maxwell-example-b}
    \end{subfigure}
    \hfill
    \strut

    \caption{
		Two hierarchical meshes. The mesh in \cref{fig:maxwell-example-a} has four
		problematic intersections while the one in \cref{fig:maxwell-example-b} is the
		result of applying \cref{alg:exact-mesh} to the mesh in \cref{fig:maxwell-example-a}
		and therefore has none.
	}
	\label{fig:maxwell-example}
\end{figure}
After discretizing the relevant weak form, we wish to find \(\omega_h \in \mathbb{R}\) and
\(\vectrial_h \in \mathring{\thbspace}^{1}_{L}\) such that   \[
   \langle \curl \vectrial_h, \curl \vectest \rangle = \omega^2_h \langle \vectrial_h,
   \vectest \rangle,\quad \forall \vectest\in \mathring{\thbspace}^{1}_{L},
\]
where \(\mathring{\thbspace}^{1}_{L} \coloneqq \thbspace^{1}_{L} \cap \Hcurlzero\). We will
use \(p_{(\level, k)}=4\) for all \(\level\) and \(k\). Due to the calculus identity \(\curl
\grad \equiv \boldvec{0}\) and the boundary conditions on \(\mathring{\thbspace}^{1}_{L}\),
the kernel of the operator is precisely composed of the gradients of functions in
\(\thbspace^{0}_{L}\)with null-tangential components, because these are the gradients we can
represent in \(\mathring{\thbspace}^{1}_{L}\). Which means that, after assembling our finite
dimensional system, the number of null-eigenvalues in the spectrum is exactly
\(\dim(\thbspace^{0}_{L})\) minus the number of \dofs that contribute to values on the
boundary. As such, after accounting for this offset, we can look at the eigenvalues given by
solving the problem on the two meshes of \cref{fig:maxwell-example}. The results are shown
in \cref{tab:maxwell-example}.
\begin{table}[htbp]
    \centering
    \begin{tabular}{@{}S[table-format=2.5]S[table-format=2.5]S[table-format=2.5]@{}}
        \toprule
		{Exact} & {Mesh \cref{fig:maxwell-example-a}} & {Mesh \cref{fig:maxwell-example-b}}
		\\ \midrule
        01.000000 &  00.000000 & 01.000000 \\ 
        01.000000 &  00.000000 & 01.000000 \\ 
        02.000000 &  00.000000 & 02.000000 \\ 
        04.000000 &  00.000000 & 04.000000 \\ 
        04.000000 &  01.000000 & 04.000000 \\ 
        05.000000 &  01.000000 & 05.000000 \\ 
        05.000000 &  02.000000 & 05.000000 \\ 
        08.000000 &  04.000000 & 08.000000 \\ 
        \bottomrule
    \end{tabular}
    \caption{
		First 8 exact and computed eigenvalues for the maxwell eigenvalue problem using the
		meshes of \cref{fig:maxwell-example}. In this case, the non-null spectrum-rank
		offset is 429 and 456 for the two meshes, since \(\dim(\thbspace^{0}_{L})=501\) and
		\(\dim(\thbspace^{0}_{L})=528\), respectively, and the number of relevant boundary
		\dofs is 72 in both cases. Notice that the offset of mesh
		\cref{fig:maxwell-example-a} is wrong by precisely 4 ranks, because the mesh has 4
		problematic intersections. This is to be expected since each problematic
		intersection is responsible for introducing harmonic forms, which belong to
		\(\ker(\curl)\).
	}
    \label{tab:maxwell-example}
\end{table}
It is important to mention that not only the null-space offset is wrong, as shown in
\cref{tab:maxwell-example}, but spurious eigenvalues are also introduced. The comparison
between the two cases is shown in \cref{fig:maxwell-example-eigenvalues}
\begin{figure}[htbp]
    \centering
    \hfill
    \begin{subfigure}[b]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{maxwell-example-a-eigenvalues.png}
        \caption{}
        \label{fig:maxwell-example-a-eigenvalues}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{maxwell-example-b-eigenvalues.png}
        \caption{}
        \label{fig:maxwell-example-b-eigenvalues}
    \end{subfigure}
    \hfill
    \strut
    \caption{
		Comparison of the eigenvalues computed using the two meshes of
		\cref{fig:maxwell-example}. We are now accounting for both the offset of the
		gradients of scalar B-splines and the harmonic forms introduced by problematic intersections,
		which is 4 and 0 for the cases \cref{fig:maxwell-example-a} and
		\cref{fig:maxwell-example-b}, respectively. Once again, due to the 4 problematic
		intersections, we introduce 4 spurious eigenvalues, that in this case are around
		27.2, 27.2, 30.4, and 42.8, completely meaningless values. This behaviour is of
		course not present when problematic intersections are absent.
	}
	\label{fig:maxwell-example-eigenvalues}
\end{figure}

