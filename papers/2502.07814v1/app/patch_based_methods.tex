\section{Patch-based Methods}
The scale of the ERA5 maps used as input for SGD reaches $25km\times 25km$. 
To address the downscaling task at this resolution, we employed a patch-based method during the sampling process of the conditional DDPM. 
The detailed introduction of this method is shown in \cref{app_alg}, the patch-based method partitions the low-resolution ERA5 maps into several sub-regions based on a fixed stride and size. 
For each individual sub-region, the gradient term of the distance loss between the ERA5 maps obtained from convolution kernels and the corresponding low-resolution sub-region map is computed separately. 
Subsequently, the mean of the Gaussian distribution and the parameters of the convolution kernels in each sub-region are updated based on these gradient terms. 
The overall map is then updated by averaging the updated values across all sub-regions, each weighted by a binary patch mask that quantifies the regional scope, thereby refining the overall mean and convolution kernel parameters of the sampled high-resolution ERA5 map, resulting in smoother generated maps. 
By leveraging this strategy, SGD is capable of downscaling ERA5 maps to any desired resolution, further enhancing the practicality of the model. 

\begin{algorithm}[t]\small
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\caption{Patch-based Methods of SGD: Guided diffusion model with the guidance of low-resolution ERA5 map $z$. Given a conditional diffusion model pre-trained on ERA5 and GridSat maps $\epsilon_\theta(x_t,y,t)$. }
\label{app_alg}
\begin{algorithmic}[1]
\REQUIRE Conditional input GridSat satellite observation map $y$, low-resolution ERA5 map $z$. Downscaling convolutional kernel $\mathcal{D}$ with parameter $\varphi$. Pre-trained encoder module $f$ with parameter $\phi$. Learning rate $l$ and guidance scale $s$. Distance measure function $\mathcal{L}$. Overlapping patch stride $r$, overlapping patch size $v=720\times 1440$. Overlapping patch set $K$, each patch commences its traversal from the top-left block of the $720\times 1440$ grid on the maps, progressing sequentially with a displacement of stride $r$. A binary patch mask set $\left \{ P^k \right \} ,k\in K$.
\ENSURE Output high resolution ERA5 map $x_0$.
\STATE Sample $x_T$ from $\mathcal{N}(0,I)$ 
\STATE $y'=f_\phi(y)$
    \FORALL{t from T to 1}
    
        \STATE $\tilde{x} _0=\frac{x_t}{\sqrt{\bar{\alpha}_t }}-\frac{\sqrt{1-\bar{\alpha}_t}\epsilon_\theta(x_t,t)}{\sqrt{\bar{\alpha}_t }}$\

        \FORALL{i from 1 to $\left | K \right | $}
        \STATE $\mathcal{L}_{\varphi^i,\tilde{x}_0} =\mathcal{L}(z\circ P^i,\mathcal{D}^{\varphi^i}(\tilde{x}_0\circ P^i))$\

        \STATE $\varphi^i \gets \varphi^i-l\nabla_{\varphi^i}\mathcal{L}_{\varphi^i,\tilde{x}_0}$\

        \STATE $\tilde{x}_0^i \gets \tilde{x}_0^i-\frac{s(1-\bar{\alpha}_t) }{\sqrt{\bar{\alpha}_{t-1}}\beta_t}\nabla_{{\tilde{x}}_0}\mathcal{L}_{\varphi^i,\tilde{x}_0}$\

        \STATE $\tilde{\mu}_t^i=\frac{\sqrt{\bar{\alpha}_{t-1}}\beta_t}{1-\bar{\alpha}_t}\tilde{x}_0^i+\frac{\sqrt{\bar{\alpha}_{t}}(1-\bar{\alpha}_{t-1})}{1-\bar{\alpha}_t}{x}_t$\

        \ENDFOR
        
        \STATE $\varphi =\frac{1}{\left | K \right | }\sum_{j=1}^{\left | K \right | } \varphi^j \circ P^j$\
        
       \STATE $\tilde{\mu}_t=\frac{1}{\left | K \right | }\sum_{j=1}^{\left | K \right | } \tilde{\mu}_t^j \circ P^j$\

        \STATE $\tilde{\beta}_t=\frac{1-\bar{\alpha}_{t-1}}{1-\bar{\alpha}_t}\beta_t$\
        \ENDFOR
        
        \STATE Sample $x_{t-1}$ from $\mathcal{N}(\tilde{\mu}_t,\tilde{\beta}_tI)$\
    
\textbf{return} $x_0$
    \end{algorithmic}
\end{algorithm}
