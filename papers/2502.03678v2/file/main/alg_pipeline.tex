\begin{algorithm}[t]
    % \DontPrintSemicolon
    \caption{Reflection-Window Decoding with Selective Refinement for Text Generation}
    \label{alg:overall_pipeline}
    % --> The input output relation
    \Input{%
        The prompt $X_{\leq 0}$, the reflection window size $d$, as well as hyperparameter-enclosed functions for the pause criterion $\mathrm{IfPause}(\cdot)$ and the refine/correct method $\mathrm{ReGenerate}(\cdot)$.
    }
    \Output{%
        Text generated with selective refinement $\xbf$.
    }

    $t^{\mathrm{(slow)}} \leftarrow 0$, $t^{\mathrm{(fast)}} \leftarrow 1$\tcp*[r]{slow/fast pointer}
    response $\xbf \leftarrow$ empty string\;

    \While{not stopped, or response not completed}{
    regular decoding for the next token $w_{t^{\mathrm{(fast)}}}$\;
    \uIf{$t^{\mathrm{(fast)}} - t^{\mathrm{(slow)}} < d$}{
        $\xbf \leftarrow \big( \xbf_{1 : t^{\mathrm{(fast)}} - 1}, w_{t^{\mathrm{(fast)}}} \big)$\;
    }
    \Else{
    concatenate and get temporary sequence $\widehat{\xbf} \leftarrow \big( \xbf_{1 : t^{\mathrm{(fast)}} - 1}, w_{t^{\mathrm{(fast)}}} \big)$\;
    \uIf{$\texttt{True} = \mathrm{IfPause}\big( \widehat{\xbf}_{t^{\mathrm{(fast)}} - d + 1 : t^{\mathrm{(fast)}}} \big)$}{
    \Comment{Refine upon reflection}
    obtain a length-$d$ replacement text 
    $\xbf^*_{t^{\mathrm{(fast)}} - d + 1 : t^{\mathrm{(fast)}}} \leftarrow \mathrm{ReGenerate} \big( \xbf_{1 : t^{\mathrm{(fast)}} - d} \big)$\;
    $\xbf \leftarrow \big( \xbf_{1 : t^{\mathrm{(fast)}} - d}, \xbf^*_{t^{\mathrm{(fast)}} - d + 1 : t^{\mathrm{(fast)}}} \big)$\;
    $t^{\mathrm{(slow)}} \leftarrow t^{\mathrm{(fast)}}$\tcp*[r]{update slow ptr}
    }
    \Else{
        \Comment{Continue to generate}
        $\xbf \leftarrow \widehat{\xbf}$\;
    }
    }
    $t^{\mathrm{(fast)}} \leftarrow t^{\mathrm{(fast)}} + 1$\tcp*[r]{update fast ptr}
    }
    
    \Return{$\xbf$}.
\end{algorithm}