\small
\caption{\small Mask2Alpha Training}
\label{algo:train}
\definecolor{codeblue}{rgb}{0.25,0.5,0.5}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codekw}{RGB}{207,33,46}
\lstset{
  backgroundcolor=\color{white},
  basicstyle=\fontsize{7.5pt}{7.5pt}\ttfamily\selectfont,
  columns=fullflexible,
  breaklines=true,
  captionpos=b,
  commentstyle=\fontsize{7.5pt}{7.5pt}\color{codegreen},
  keywordstyle=\fontsize{7.5pt}{7.5pt}\color{codekw},
  escapechar={|}, 
}
\begin{lstlisting}[language=python]
def train(F, M_fine, M_coarse, T):
  """
  F: image features, M_fine: ground truth alpha
  M_coarse: coarse mask, T: total iteration steps
  """

  # Initialize mask and binary state
  m_0 = M_fine
  x_0 = [1] # Binary mask: 1 represents the fine state

  # Sample time step and transition matrix
  t = uniform(0, 1)     # time step
  q = schedule_q(t)      # generate transition matrix

  # Sample and apply pixel transition
  x_t = sample(q)        # sample from transition matrix
  m_t = x_t * M_coarse + (1 - x_t) * M_fine

  # Decode and compute loss
  alpha_predict, transition_probability = iterate_decoder(F, m_t, x_t)
  loss = compute_loss(alpha_predict, M_fine)

  # Update parameters
  update_parameters(loss)
\end{lstlisting}
