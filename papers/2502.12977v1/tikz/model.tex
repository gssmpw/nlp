% tikzpic.tex
\documentclass[crop,tikz]{standalone}
% 'crop' is the default for v1.0, before it was 'preview'
%\usetikzlibrary{...}% tikz package already loaded by 'tikz' option
\usetikzlibrary{bayesnet}
\usetikzlibrary{positioning, calc}

\input{../math.tex}

\iffalse
    \factor [options] {name} {caption} {inputs} {outputs}
    \plate [options] {name} {fitlist} {caption}
    \gate [options] {name} {fitlist} {inputs}
    \vgate {name} {fitlist-left} {caption-left} {fitlist-right} {caption-right} {inputs}
    \hgate {name} {fitlist-top} {caption-top} {fitlist-bottom} {caption-bottom} {inputs}
    \edge [options] {inputs} {outputs}
    \factoredge [options] {inputs} {factors} {outputs}
\fi

\begin{document}
\begin{tikzpicture}
    \node[obs] (reference) at (0,0) {$\xx_t$};
    \node[obs, right = 2 of reference] (negative) {$\xx_{\tilde t}$};
    \node[obs, left = 2 of reference] (positive) {$\xx_{t'}$};
    
    \foreach \name/\argument in {reference/t,negative/\tilde t,positive/t'} {
        \node[below = 1.5 of \name] (\name features) {$\ff(\xx_{\argument})$};
        \draw[->] (\name) to node [left] {$\ff(\cdot)$}  (\name features);
        
        \node[obs, above = 0.15 of \name] (\name context) {$\cc_{\argument}$};
        \plate {\name-plate} {(\name)(\name context)} {};
        
        \node [above = 0.1 of \name context]{\name};
        
        %\draw (\name) to (\name context);
    };
    
    \factor [right = 0.75 of positivecontext] {posdist} {$p$} {referencecontext} {positivecontext};
    \factor [left = 0.75 of negativecontext] {posdist} {$q$} {referencecontext} {negativecontext};
    %\factoredge {reference} {posdist} {positive};
    %\factoredge {reference} {q} {negative};
    
    %\draw[->] (reference) to node[above] {$p(\cdot|\xx)$} (positive);
    %\draw[->] (reference) to node[above] {$q(\cdot|\xx)$} (negative);
    
    \draw[<->]
        ($(referencefeatures)!0.3!(positivefeatures)$)
        to node [below] {attract}
        ($(referencefeatures)!0.7!(positivefeatures)$);
    \draw[<->]
        ($(referencefeatures)!0.3!(negativefeatures)$)
        to node [below] {repel}
        ($(referencefeatures)!0.7!(negativefeatures)$);
        
    
\end{tikzpicture}

\begin{tikzpicture}
    \node[latent] (latent) at (0,0) {$z$};
    \node[obs,right = 1 of latent] (obs) {$x$};
    \node[obs,above = 0.5 of latent] (label) {$u$};
    
    \draw (latent) to (label);
    \draw[->] (latent) to node[above]{$\gg$} (obs);
    
    \node[left = 0 of latent]{latent};
    \node[right = 0 of obs]{observation};
    \node[left = 0 of label]{label};
\end{tikzpicture}

\end{document}