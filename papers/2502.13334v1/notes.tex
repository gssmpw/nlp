
\section{The Effect of Enforced Purchases}
In this setting, we assume that the agent lack the observation of the realized quality level or is required to purchase no matter what the quality level is, the problem can be formulated as 
\begin{align*}
    \max_{x, w, \xi}\quad &\expec_{t \sim \mu}\sum_{j=1}^n \left(\sum_{i = 1}^m \xi^{t}_i p_j^{i, t}\right)  x^{t}_j  +w^{t} - \sum_{i = 1}^m \xi_i^{t} c_i \\
    &\sum_{j=1}^n \left(\sum_{i = 1}^m \xi^{t}_i p_j^{i, t}\right) (v_j^t - x_j^{t})- w^{t} \geq \sum_{j=1}^n \left(\sum_{i = 1}^m \xi^{t'}_i p_j^{i, t}\right)(v_j^t - x_j^{t'})- w^{t'}, \forall t, t', \\
    &\sum_{j=1}^n \left(\sum_{i = 1}^m \xi^{t}_i p_j^{i, t}\right)(v_j^t - x_j^{t})- w^{t} \geq 0,  \forall t, \quad \text{Ex-ante IR}.
\end{align*}


\textbf{Proposition 1. } Assuming the enforced purchases, $\opt_{full} = \opt_{x}$. Additionally, if the transition kernel is type-independent,  $\opt_{full} = \opt_{x} = \opt_w$. 
\begin{align*}
    \max_{x, \xi}\quad &\expec_{t \sim \mu}\sum_{j=1}^n \left(\sum_{i = 1}^m \xi^{t}_i p_j^{i, t}\right)  x^{t}_j  - \sum_{i = 1}^m \xi_i^{t} c_i \\
    &\sum_{j=1}^n \left(\sum_{i = 1}^m \xi^{t}_i p_j^{i, t}\right) (v_j^t - x_j^{t}) \geq \sum_{j=1}^n \left(\sum_{i = 1}^m \xi^{t'}_i p_j^{i, t}\right)(v_j^t - x_j^{t'}), \forall t, t', \\
    &\sum_{j=1}^n \left(\sum_{i = 1}^m \xi^{t}_i p_j^{i, t}\right)(v_j^t - x_j^{t}) \geq 0,  \forall t.
\end{align*}
Let $z_j^{i,t} = \xi_i^t x_j^t$, to recover $x_j^t$ from $z_j^{i,t}$, we need the bilinear constraint $\xi_i^t \sum_{i'} z_j^{i',t} = z_j^{i,t}$. 
\yzcomment{If we assume that the payment $x$ also depends on the effort level $i$, i.e., $x_j^{i,t}$, then the problem can be formulated as a linear program. Let $z_j^{i,t} = \xi_i^t x_j^{i,t}$,
then the problem is reformulated as 
\begin{align*}
    \max_{z, \xi}\quad &\expec_{t \sim \mu}\sum_{j=1}^n \sum_{i = 1}^m p_j^{i, t}  z_j^{i,t} - \sum_{i = 1}^m \xi_i^{t} c_i \\
    &\sum_{j=1}^n \sum_{i = 1}^m p_j^{i, t} \left( \xi^{t}_i v_j^t - z_j^{i,t} \right) \geq \sum_{j=1}^n 
 \sum_{i = 1}^m p_j^{i, t} \left( \xi^{t'}_i  v_j^t -  z_j^{i,t'} \right), \forall t, t', \\
    &\sum_{j=1}^n \sum_{i = 1}^m p_j^{i, t} \left( \xi^{t}_i v_j^t - z_j^{i,t} \right) \geq 0,  \forall t, \\
    & z_j^{i,t} \leq x_j^{i,t} 
\end{align*}
upper bound for $x_j^{i,t}$
}

\hfcomment{We further relax $x_{j}^t$ to $x_{i, j}^t$ to allow payment dependent on $i$ as well. We can check by experiments to see whether this relaxation is TIGHT?} 