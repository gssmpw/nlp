\section{Envy-free Profit Maximization with Non-strategic Contributors}
\label{sec:buyerside}

We begin by studying a simplified version of our problem, assuming contributors are not strategic. Our goal is twofold:  
First, we establish a baseline for profit optimization. This baseline  only
considers buyer incentives while ignoring contributor incentives. This serves as an upper bound for profit, which we later approximate while incorporating strategic contributor behavior.  
Second, the procedures we develop here can later be adapted to settings where contributors are strategic.  
We start by describing the environment. Notably, our ideas here extend beyond mean estimation and apply to general data marketplaces.  



\parahead{Data Marketplace}  
A data marketplace consists of three key actors:  
\emph{(i)} a finite set of data \emph{contributors} $\contributors = \{1,\dots,|\contributors|\}$,  
\emph{(ii)} a finite set of \emph{buyers} $\buyers$, and  
\emph{(iii)} a \emph{trusted broker} who facilitates transactions between contributors and buyers.  

\subparahead{Contributors}  
Contributors collect samples from the same but \emph{unknown} distribution. Contributor $i$ incurs a cost of $\costi$ to collect a sample.  
Without loss of generality, we assume that costs are ordered as $\cost_1 \leq \cost_2 \leq \dots \leq \cost_{|\contributors|}$.  
In this section, we assume contributors are non-strategic, meaning they
will collect the  amount of data requested by the broker and submit it truthfully.  


\subparahead{Buyers}  
Each buyer $i$ has a valuation function $\vali: \mathbb{N} \to [0,1]$, where $\vali(m)$ represents her value for $m$ data points.  
Since more data is preferable, $\vali(m)$ is non-decreasing in $m$.  
If a buyer pays price $\pricei \in [0,1]$ for $\mmi \in \mathbb{N}$ data points, her
utility is given by  
$\utili(\mmi, \pricei) = \vali(\mmi) - \pricei$.

\subparahead{Broker}  
The broker requests each contributor $i\in\contributors$ to collect $\nni \in \mathbb{N}$ data points.  
Let $N = \sum_{i\in\contributors} \nni$ denote the total data collected.  
The broker then allocates subsets of size $\{\mmj\}_{j\in\buyers} \in [N]^{|\buyers|}$ from all contributors' submissions to each buyer, and charges them prices $\{\pricej\}_{j \in \buyers} \in [0,1]^{|\buyers|}$.  
We denote the broker's mechanism\footnote{To reduce verbiage, we use the term mechanism here, even though neither the buyer or contributor needs to incentivized to report truthfully in this setting. Later, we will use the term mechanism again when we need to incentivize
contributors to report truthfully.} as  
$\efscheme = \big(\{\mmj\}_{j\in\buyers}, \{\pricej\}_{j \in \buyers}, \{\nni\}_{i\in\contributors}\big)$.

\parahead{Envy-Free Profit Maximization}  
The cumulative profit of the contributors is given by  
$\efprofit(\efscheme) = \sum_{j \in \buyers} \pricej - \sum_{i \in \contributors} \costi$.
The broker aims to design a mechanism $\efscheme$ that maximizes profit while satisfying the following two constraints:  
\begin{enumerate}[leftmargin=0.2in]
    \item \emph{Individually Rational for Buyers (IRB):}  
    $\efscheme$ is IRB if $\valitemj(\mmj) \geq \pricej$ for all buyers $j \in \buyers$.
    \item \emph{Envy-Free for Buyers (EFB):}  
    $\efscheme$ is EFB if no buyer prefers another's allocation and price over her own, i.e., 
    $\utilbj(\mmoptj, \priceoptj) \geq \utilbj(\mmoptk, \priceoptk) \quad \forall j,k \in \buyers$.
\end{enumerate}  
The first constraint ensures that buyers benefit from the market, as they would otherwise choose not to participate.  
The second constraint ensures fairness, as otherwise the broker could sell all $N$ points collected to all buyers and charge each buyer $\pricej = \valitemj(N)$.
This maximizes profit while satisfying IRB;
however, in this scheme different buyers would pay different prices for the same dataset, which would be unfair to buyers who have to pay more.  

In the remainder of \S\ref{sec:buyerside}, we develop an envy-free profit maximization scheme.  
In \S\ref{sec:efrevenueoptimal}, we assume the broker has collected $N$ points and design envy-free revenue-optimal pricing schemes.  
Then, in \S\ref{sec:efprofitoptimal}, we build on this to develop profit-optimal pricing schemes.



% The contributors collect datasets incurring some costs, the broker sells subsets of the combined dataset to buyers, and redistributes the revenue among contributors.
% The interaction between the three actors proceeds as follows:
% %\vspace{-0.15in}
% \begin{enumerate} [leftmargin=0.2in]


%     \item \emph{Data collection and submission}:
%     \label{itm:datacollection}
%     The broker asks each contributor to collect $\nni\in\NN$ points.
%     The contributors collect this data  at cost $\cost_i \nni$, and submit this to the broker.
%     Denote $N = \sum_{i\in\contributors} \nni$.

%     \item \emph{Data allocation and purchases}:
%     \label{itm:pricing}
%      The broker allocates subsets of size
%      $\{\mmj\}_{j\in\buyers} \in [N]^{|\buyers|}$ of
%      all contributors' submissions 
%      to each buyer, and charges them \emph{prices} $\{\pricej\}_{j \in \buyers}\in[0,1]^{|\buyers|}$.

% %\vspace{-0.1in}
%     \item \emph{Revenue redistribution}: \hspace{-0.05in}
%     \label{itm:revenueredistribution}
%     The broker redistributes the total revenue $\sum_{j \in \buyers} \pricej'$ from buyers via \emph{payments} $\{\payi'\}_{i \in \contributors} \in \RR^{|\contributors|}$  to contributors.
%     \ac{why does the notation for (4) and (5) involve ``primes''? to not conflict with function notation under ``mechanism'' section?}
% \end{enumerate}


% \subparahead{Verbiage}
% As noted above, the amount charged to a buyer for a dataset is referred to as the \emph{price}, while the amount given to a contributor for their work is called a \emph{payment}.  



\subsection{Revenue-optimal Envy-free data pricing schemes}
\label{sec:efrevenueoptimal}

Assume the seller has received $N$ total data points from contributors.  
Our goal is to develop a mechanism $\efrevscheme = (\{\mmj\}_{j \in \buyers}, \{\pricej\}_{j \in \buyers})$ that maximizes revenue by selling the data to buyers.  
Our key insight is that designing an envy-free mechanism in this setting reduces to creating a revenue-optimal pricing curve (Lemma~\ref{lem:equal_two_problem}), where the seller posts a curve $\itemprice: [N] \to [0,1]$ and buyers choose how much to buy to maximize their utility;  in contrast, the broker's mechanism in our case directly determines the amounts and prices for each buyer.  

When buyers have monotonic valuations for data, designing a revenue-optimal pricing curve aligns with an ordered item pricing problem~\citep{chawla2022pricing}, enabling us to leverage existing algorithms for such problems.  
We first describe the ordered item pricing below.
To simplify the exposition, we describe this in the context of data pricing\footnote{In the original formulation, the seller has $\numdata \in \mathbb{N}$ items, and a set of \emph{unit-demand} buyers (those who wish to purchase only a single item) with non-decreasing valuations $\valitemi: [\numdata] \to [0,1]$. While buyers may have different valuations for the same good, their preference ranking is the same. The seller's task is to choose a pricing function $\itemprice: [\numdata] \to \mathbb{R}_+$ to maximize revenue.}.



%\begin{definition}[Ordered item pricing~\citep{chawla2022pricing}]

\parahead{Ordered item pricing\textnormal{~\citep{chawla2022pricing}}}
Suppose that the broker  has $\numdata \in\NN$ data.
The broker should choose and post a pricing function $\itemprice:[\numdata]\rightarrow \RR_+$.
Buyers will then purchase based on $\itemprice$.
A utility-maximizing buyer 
buyer $j$ will choose an amount of data $m\in[\numdata]$ to maximize her own utility, $\valitemj(m) - \itemprice(m)$.
If there are multiple such utility-maximizing
amounts of data, $\mjpset(\numdata, \itemprice)  \subset[N]$, buyers
will choose the largest dataset size.
Therefore, a buyer $j$ will purchase $\mjp(\numdata, \itemprice)$ data where,
\begin{align*}
\mjpset(\numdata, \itemprice) \defeq
% \argmax_{m\in[\numdata]}
\argmax_{m\leq N}
\big(\,\valitemj(m) - \itemprice(m) \,\big),
\hspace{0.4in}
\mjp(\numdata, \itemprice) \defeq \argmax_{m\in\mjpset} \itemprice(m).
    \numberthis
    \label{eqn:buyerpurchasemodel}
\end{align*}
It follows that the revenue from buyer $j$ is $\itemprice(\mjp(\numdata, \itemprice))$.
Hence, he total revenue $\ExpectREV(\buyers, \numdata, \itemprice)$ of a pricing curve
$\itemprice$ is as defined below.
The broker wishes  to find a pricing
function $\optitemprice$ which (approximately) maximizes the
cumulative revenue.
The optimal revenue $\OPTREV$ can be defined as:
% \vspace{-0.075in}
\begin{align*}
    \ExpectREV(\buyers, \numdata, \price) \defeq
        \textstyle\sum_{i\in\buyers} \price\left(\mip(\numdata, \price)\right),
    \hspace{0.5in}
    \OPTREV(\buyers, \numdata) \defeq \max_p \;\ExpectREV(\buyers,  \numdata, p).
    \numberthis
    \label{eqn:revenue}
\end{align*}
%\end{definition}

\subparahead{Algorithms for ordered item pricing}
The ordered item pricing problem is known to be \textsf{NP}-hard~\citep{chawla2007algorithmic,hartline2005near}.
Hence, prior work have developed approximation algorithms.
Table~\ref{tb:approxresults} summarizes algorithms from prior work applicable for this problem, under various assumptions on buyer valuations.

An algorithm for ordered item pricing takes as input the set of buyers $\buyers$, the total
amount of data $N$, and approximation parameter $\eps$.
It returns a pricing curve $\itemprice$
whose cumulative revenue satisfies
$\ExpectREV(\buyers, N, \itemprice) \geq \OPTREV(\buyers, N) - |\buyers|\bigO(\epsilon)$.



% \begin{definition}[Ordered item pricing~\citep{chawla2022pricing}]
% Suppose that a seller has $\numdata \in\NN$ items, denoted $[N]$.
% There are a finite set  of buyers $\buyers$. Each buyer $i\in\buyers$ is interested in buying a \emph{single item}, and has a non-decreasing valuation
% $\valitemi:[\numdata]\rightarrow [0,1]$.
% That is, while different buyers may have different valuations for the same good,
% they have the same preference ranking over these items.
% The seller chooses a pricing function $\itemprice:[\numdata]\rightarrow \RR_+$.
% A utility-maximizing buyer 
% buyer $i$ will choose an item $m\in[\numdata]$ to maximize her own utility, $\valitemi(m) - q(m)$.
% If there are multiple such utility-maximizing
% items, $\mipset(\numdata, \price)  \subset[N]$, buyers
% will choose the highest ranked one.
% Therefore, a buyer $i$ will purchase $\mip(\numdata, \itemprice)$ goods where,
% \begin{align*}
% \mipset(\numdata, \itemprice) \defeq
% % \argmax_{m\in[\numdata]}
% \argmax_{m\leq N}
% \big(\,\vali(m) - \itemprice(m) \,\big),
% \hspace{0.4in}
% \mip(\numdata, \itemprice) \defeq \argmax_{m\in\mipset} \itemprice(m).
%     \numberthis
%     \label{eqn:buyerpurchasemodel}
% \end{align*}
% It follows that the revenue from the buyer is $\itemprice(\mip(\numdata, \itemprice))$.
% The seller wishes  to find a pricing
% function $\optitemprice$ which (approximately) maximizes the
% cumulative revenue
% $\ExpectREV(\buyers, \numdata, \itemprice)$ defined below.
% The optimal revenue $\OPTREV$ can also be defined as follows:
% % \vspace{-0.075in}
% \begin{align*}
%     \ExpectREV(\buyers, \numdata, \price) \defeq
%         \textstyle\sum_{i\in\buyers} \price\left(\mip(\numdata, \price)\right),
%     \hspace{0.5in}
%     \OPTREV(\buyers, \numdata) \defeq \max_p \;\ExpectREV(\buyers,  \numdata, p).
%     \numberthis
%     \label{eqn:revenue}
% \end{align*}
% Table~\ref{tb:approxresults} summarizes algorithms from prior work applicable for this problem, under various assumptions on buyer valuations.
% \end{definition}



\insertTableApproxResults 

\begin{definition}
    Envy Free pricing problem: Given the input $\left\{ v_j \right\}_{i \in \buyers} $, and all buyers agree to participate in the mechanism, an Envy Free pricing scheme outputs a set of $(\hat{\mu}_j,\pricej), \; \forall j \in \buyers$ maximizing the contributors' revenue. Here,  $\left\{(\hat{\mu}_j,\pricej)\right\}_{j \in \buyers}$ represents the assignment: an estimator and a price offered to each buyer. It satisfies the following properties:

    \emph{(i)} Individual Rationality (IR): for any $j \in \buyers$, \[ \utilityb_j(M,\strat)\geq 0 .\] 

    \emph{(ii)} Envy Free (EF): for any $j$ and any $k \neq j$, we have 
    \[ v_j(M, \hat{\mu}_j) -\mathbb{E}\sbr{\price_j} \geq   v_j(M, \hat{\mu}_k) -\mathbb{E}\sbr{\price_k}. \]    

\textcolor{red}{need to be fixed}
     \begin{align*}
         \EE_{M, \sigma, P}\left[ \valitemj(\muhatj, \strat) - \pricej \right]  \\ \geq  \EE_{M, \sigma, P}\left[ \valitemj(\muhatk, \strat) - \pricek \right] 
     \end{align*}
     
\end{definition}



We demonstrate that the Envy-free pricing problem is equivalent to the Revenue-optimal data pricing problem \ref{def:rev_optpricing}. Thus, any solution to the Envy-free pricing problem is also a solution to the Revenue-optimal data pricing problem. Therefore, we convert our problem (\ref{itm:pricing}) into finding an optimal price curve that maximizes the contributors' revenue: \textcolor{red}{proof of equivalence is in Appendix Lemma}

    \begin{align*}
        n^{\star}_i(\pricecurv) = \max \rbr{\underset{n}{\arg\max} \rbr{v_i(n)-\pricecurv(n) }}
    \end{align*}

    \begin{align*}
       \mathrm{rev}(\pricecurv^{\star}) = \underset{\pricecurv}{\max} \rbr{\sum_{i \in \buyers} \pricecurv \rbr{ n^{\star}_i(\pricecurv) }}
    \end{align*}



This section is about buyers' purchase model when assuming the data submitted are truthful. 

Suppose that the contributors already submitted $N$ i.i.d. samples from the distribution $P$. The broker produces a dataset $\dataset_i$, and a price $\pricecurv_i$ for each buyer. Here, $\dataset_i$ is a subset  containing $\mmi \in [0,N]$ data points, and the price $\pricecurv_i$ reflects the cost the buyer $i$ should pay for accessing the dataset $\dataset_i$.      



\textbf{Buyers' valuation for truthful data.} Let $\muhatsm(\dataset_i)=\frac{1}{|\dataset_i|}\sum_{x \in  \dataset_i} x$ represent the sample mean, buyer $i$'s estimating error for $\nn$ i.i.d. data points is:
\begin{align*}
    \err(\muhatsm, \geniid_{\nn}) & = \sup_{P \in \Pcal} \EE_{X \sim P^{\nn}} \big[(\muhatsm(X) - \mu(P))^2\big] \\ & = \sigma^2/n,
\end{align*}
and buyer $i$'s valuation for $\nn$ i.i.d. data points is given by
\begin{align*}
    \vali(\muhatsm, \geniid_{\nn}) \defeq \valfunci(\err(\muhatsm, \geniid_{\nn})) = \valfunci(\sigma^2/n).
    \label{eqn:buyerval}
\end{align*} 

The broker aims to satisfy the following properties:

1. Individual Rationality for the buyer: \[\vali( \mmi )- \pricecurv_i \geq 0 , \; i \in \buyers  \]

2. The assignment $\left\{ \mmi, \pricecurv_i \right\}_{i \in \buyers }$ is \emph{envy-free} for the buyer, i.e, no buyer has a higher utility for the assignment offered to another buyer. For any $i$ and any $j \neq i$, the following inequality holds: 
    \[ \vali(\mmi) - \pricecurv_i  \geq   \vali(\mmj) - \pricecurv_j. \]

3. Maximize the revenue, i.e, the sum of payment from the buyer is optimal, \[ \sum_{i \in \buyers} \pricecurv_i \]



This problem is referred to as the \emph{Profit-optimal Envy-free data pricing}.



\begin{definition} \label{def:EF_pricing}
    Profit-optimal Envy-free data pricing problem: Given the input $\left\{ \vali \right\}_{i \in \buyers} $, and all buyers agree to participate in the mechanism, a Profit-optimal Envy-free pricing scheme outputs a set of $(\mmi,\pricecurv_i), \; \forall i \in \buyers$ maximizing the sellers' revenue. Here,  $\left\{(\mmi,\pricecurv_i)\right\}_{i \in \buyers}$ represents the number of data each buyer  will going to purchase, and the price each buyer will going to pay. It satisfies the following properties:

    \emph{(i)} Individual Rationality (IR): for any $i \in \buyers$, \[ \vali(\mmi)\geq \pricecurv_i .\] 

    \emph{(ii)} Envy Free (EF): for any $i$ and any $j \neq i$, we have 
    \[ \vali(\mmi) - \pricecurv_i  \geq   \vali(\mmj) - \pricecurv_j. \]
    
   \emph{(iii)} For any other Envy-free assignment $\left\{ \tilde{n}_i^{\rm b}, \tilde{q}_i\right\}_{i \in \buyers}$, we have 
   \[ \sum_{i \in \buyers} \pricecurv_i \geq \sum_{i \in \buyers} \tilde{q}_i \]
\end{definition}

Note that the data is truthful and i.i.d., the price can be treated as a constant. We will extend this definition to incorporate stochastic pricing in a future section.

We next show that, under the monotonicity assumption of valuation curves, the problem reduces to the Profit-Optimal Ordered Data Pricing problem, which is defined in Definition~\ref{def:rev_optpricing}. 


\begin{definition} \label{def:rev_optpricing}
    Profit-optimal ordered data pricing problem: Given a price curve $\pricecurv: [N] \to [0,1]$, each buyer then chooses the amount of data that maximize their utility:
    \begin{align*}
        \mmi(\pricecurv) = \max \rbr{\underset{n}{\arg\max} \rbr{\vali(n)-\pricecurv(n) }}
    \end{align*}
    Then the revenue of the seller is 
    \begin{align*}
       \mathrm{rev}(\pricecurv) = \sum_{i \in \buyers} \pricecurv \rbr{ \mmi(\pricecurv) }
    \end{align*}
    A Profit-optimal ordered data pricing takes as input the valuation curves $\left\{ \vali \right\}_{i \in \buyers} $, and output an optimal price curve $\pricecurv^{\star}: [N] \to [0,1]$ which satisfies,
    \[\pricecurv^{\star} \in \arg\max_\pricecurv \mathrm{rev}(\pricecurv)  \]

    
    Such a price scheme satisfies the following properties:

    \emph{(i)} Individual Rationality (IR): for any $i \in \buyers$, \[ \vali(\mmi)\geq \pricecurv(\mmi) .\] 

    \emph{(ii)} Envy Free (EF): for any $i$ and any $j \neq i$, we have 
    \[ \vali(\mmi) -\pricecurv(\mmi) \geq   \vali(\mmj) -\pricecurv(\mmj). \]


\end{definition}

The profit-optimal Envy-free problem is known to be computationally hard to solve, as established in prior work such as \textcolor{red}{check this}[cite papers that discuss the complexity]. However, under the monotonicity assumption, it can be proven that the Profit-optimal Envy-free problem and the Profit-optimal ordered item pricing problem are equivalent, they sharing the same solution. Lemma~\ref{lem:equal_two_problem} establishes this equivalence. The proof is provided in Appendix~\ref{app:tech}.



\begin{restatable}{lem}{lemEqual} 
\label{lem:equal_two_problem}
Under the buyer population $\buyers$, the Profit-optimal Envy-free data pricing problem is equivalent to the Profit-optimal ordered data pricing problem.
\end{restatable}

The profit-optimal ordered data pricing problem has been studied extensively in the literature. Though it is known to be NP-hard~\citep{chawla2022pricing}, previous works~\citep{chawla2022pricing}, ~\citep{chen2024learning} have focused on approximating the optimal pricing curves via some pricing algorithms.


A \textbf{Price algorithm} takes as input a population $\buyers$ of buyers, a dataset of size $n$, and an error margin \( \epsilon \). It outputs a price curve $\pricecurv$, as long as a set of \( \mm_1, \mm_2, \ldots, \mm_{|\buyers|} \), which represents the amount of data buyer \( i \) would purchase at the price. A Price algorithm \( \algori \) is said to be \( \mathbf{\epsilon} \)-\textbf{revenue optimal} if the revenue under price $\pricecurv$ is within $\eps$ additive error from the optimum:

\[
\mathrm{rev}_{A}(\buyers, n) \geq \mathrm{rev}^{\star} (\buyers,n)- \epsilon
\]

In this equation,  $\mathrm{rev}^{\star}(\buyers, \nn)$ denote the maximum revenue when selling $\nn$ data points to the population $\buyers$, and $ \mathrm{rev}_A(\buyers,n) $ denotes the near-optimal revenue generated by setting the price curve as $\pricecurv$. Both $  \mathrm{rev}_A(\buyers,n)$ and  $\mathrm{rev}^{\star} (\buyers, \nn)$ are based on  buyers' valuation with respect to the number of truthful data, $\left\{\valitemj \right\}_{j= 1}^{|\buyers|}$. The contributor has access to the ex-post valuation curve and uses the ex-ante value along with a pricing algorithm to compute a near-optimal price that maximizes revenue. The ex-ante value is utilized because it allows us to determine the maximum revenue achievable under truthful data submission.

Table~\ref{tb:approxresults} presents the assumptions and time complexities of several $\eps$-optimal algorithms from previous papers. All methods achieve a $\bigO(\eps)$ additive approximation to the optimal revenue.  % \citet{hartline2005near}  proposed an approximation algorithm with near-linear runtime in the number of buyers, given a fixed number of items. 
Assuming that valuation curves are monotonic, \citet{chawla2022pricing} introduced a polynomial-time approximation scheme (PTAS) with respect to number of data $\mm$. Meanwhile,  \citet{chen2024learning} reduced the dependence on $\eps^{-1}$ when the number of buyers $|\buyers|$ is small, and the time complexity is further reduced under the two following assumptions.

\begin{assumption}[Smoothness]
    \label{asm:smoothness}
    %The valuation curves are
    %$(L/N)$-Lipschitz, i.e. for all types $i\in[m]$,
    For all $n, n' \in [N]$, we have
    $ \;\vali(n+n') - \vali(n)\leq 
        \frac{L}{N}n'$ for all buyer $i \in \buyers$.
        % \end{align*}
\end{assumption}

\begin{assumption}[Diminishing returns]
    \label{asm:diminishingreturns} 
    There exists some $\drconstant>0$ such that,
    for all buyers $i\in \buyers$, and for all $n\in[N]$,
    we have $\vali(n+1) - \vali(n) \leq \frac{\drconstant}{n}$.

\end{assumption}

\rcomment{check the statement }



In the previous section, we focused on the buyersâ€™ side of the problem, defining their purchase model under truthful data submission and discussing algorithms to achieve near-optimal revenue for the brokers. 
In this section, we remove the truthfulness assumption on the contributors and design a mechanism for incentivizing them to truthfully submit their collected data.
% contributors to truthfully submit their data.
Our objective is to create a mechanism 
that satisfies the propeties~\ref{mech:requirements}


ensures, under the recommended strategy, the expected profit of buyers approximates the optimal profit, $ \mathrm{profit}^{\star}$, within an additive error $ \epsilon $. Here $ \mathrm{profit}^{\star} $ represents the maximum profit attainable by the contributors and is given by
\begin{equation*}
    \mathrm{profit}^{\star} = 
    \underset{\datanum_1,\dots,\datanum_d}{\max}
    \rbr{
        \mathrm{rev}^{\star} 
        \rbr{ 
            \buyers,\sum_{i \in \contributors}\datanum_i
        }
        - \sum_{i=1}^{d} \cost_i \datanum_i  
    }.
\end{equation*}
The broker will utilize the $\eps$-revenue optimal price algorithm to approximate the contributors' profit. We let $\mathrm{profit}_A( \datanum_1^{\star},\dots,\datanum_{|\contributors|}^{\star})$ denote the profit of contributors when contributor $i$ collects $\datanum_i$ points,
\begin{equation} 
    \label{eq:profit_A}
    \mathrm{profit}_A(  \datanum_1,\dots, \datanum_{|\contributors|})
    =
    \mathrm{rev}_A \rbr{
        \buyers, \sum_{i \in \contributors}\datanum_i
    } 
    -\sum_{i=1}^{d} \cost_i \datanum_i .
\end{equation}
Then the broker selects the set $\left\{ \datanum_i \right\}_{i \in \contributors}$ which maximizes the function $\mathrm{profit}_A(  \datanum_1,\dots, \datanum_{|\contributors|})$, i.e. the best profit achievable under the pricing algorithm $A$:
\begin{align} \label{eq:n_i_star}
    \{ \datanum_i^{\star} \}_{i=1}^d = \underset{\datanum_1,\dots,\datanum_d}{\arg\max}\ \mathrm{profit}_A( \datanum_1,\dots,\datanum_{|\contributors|}),
\end{align}
         
In Lemma 
~\ref{lem:main_prop5}, 
% ~\ref{lem:profit_appro},
we show that $\mathrm{profit}_A(  \datanum_1^{\star},\dots, \datanum_{|\contributors|}^{\star})$ approximates $\mathrm{profit}^{\star}$ within an additive error $\eps$,    




The $\eps$-reveue optimal price algorithm $A$ takes as input  a population $buyers$ of buyers, a dataset of size $\sum_i \datanum_i^{\star}$, and an error
margin $\eps$. The algorithm outputs a price curve $\pricecurv$, along with a set of \( \mm'_1, \mm'_2, \ldots, \mm'_{|\buyers|} \), which represents the amount of data buyer \( i \) would purchase at the price curve $\pricecurv$. 

To be specific, $\pricecurv$ is the price curve that achieves the revenue of $\mathrm{rev}_A
\rbr{ \buyers,\sum_i {\datanum}_i^{\star}}$, and let $\pricecurv_j$ be defined as the price that a buyer with valuation $\valitemj$ pays at the price curve $\pricecurv$. For each buyer $j$, the optimal data size $\mmj'$ is determined by the following expression:

\begin{align*}
\mmj'
% & 
= \max \left( \underset{n}{\arg\max} \left( \valitemj(n) - \pricecurv(n) \right) \right), 
% \\
\quad
\pricecurv_j 
% & 
= \pricecurv \left( \mmj' \right).
\end{align*}

Let $\profi$ denote the profit of contributors, 
\begin{align}
    \profi \defeq \mathrm{profit}_A(  \datanum_1^{\star},\dots, \datanum_{|\contributors|}^{\star})= \mathrm{rev}_A
\rbr{ \buyers,\sum_{i \in \contributors} {\datanum}_i^{\star}}- \sum_{i \in \contributors} \cost_i \datanum_i^{\star}
\end{align}