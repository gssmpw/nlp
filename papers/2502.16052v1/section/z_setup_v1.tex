\section{Problem set up}

We now formally define our problem. 
First, we will briefly review mean estimation to motivate our modeling choices.

\parahead{Review of mean estimation}
%In this work, we are interested in designing a marketplace for mean estimation.
Let $\Pcal$ be the class of all one-dimensional distributions whose variance is at most $\sigma^2$.
We wish to estimate the mean $\mu(P) = \EE_{Z\sim P}[X]$ of some \emph{unknown} distribution $P\in\Pcal$.
A dataset $X$ is collected from $P$ via some \emph{generating process} $\genprocess(P)$.
An \emph{estimator} $\muhat$ is a function which maps this dataset to a scalar, to approximates $\mu$.
Below, we define $\err(\muhat, \genprocess)$ to be
the maximum $L_2$ error\footnote{%
Our ideas can be extended to $|\muhat(X)-\mu(P)|^p$ errors as well.} of an estimator $\muhat$ under the generating process $\genprocess$,
\begin{align}
    \label{eqn:err}
    \err(\muhat, \genprocess) = %\inf_{\muhat}
        \sup_{P\in\Pcal} \EE_{X\sim \genprocess(P)}\left[
        (\muhat(X) - \mu(P))^2
    \right]      
\end{align}
The $\sup_{P\in\Pcal}$ accounts for the fact that $P$ is unknown
\emph{a priori}, and hence $\muhat$ should do well on all $P\in\Pcal$;
for instance, the (nonsensical) estimator $\muhat(X) = 1.234$ achieves zero error when $\mu(P) = 1.234$, but does poorly elsewhere.



The simplest case occurs when the generating process $\genprocess = \geniidn$ draws $n$ i.i.d. samples from $P$. Here, the sample mean $\muhatsm(X) = \frac{1}{|X|}\sum_{x \in X} x$ achieves 
$\err(\muhatsm, \geniidn) = \sup_{P \in \Pcal} \EE_{X \sim P^n} \big[(\muhatsm(X) - \mu(P))^2\big] = \sigma^2/n$.
It is well-known
that $\muhatsm$ minimizes $\err(\muhat, \geniidn)$ over all estimators $\muhat: \bigcup_{n=0}^\infty \RR^n \to \RR$~\citep{stein1956inadmissibility}.



In our marketplace, although data is sampled i.i.d., it is reported by strategic contributors who may misreport to maximize their personal benefit. Additionally, based on buyer valuations, we will find it useful to intentionally design suboptimal estimators to maximize profit.
%An example of such an estimator would be one which discards a random subset of the data and computes the sample mean over the remaining points.


% A dataset $X \in \bigcup_{n=0}^{\infty} \RR^n$ consists of any number of i.i.d points drawn from an \emph{unknown} distribution $P\in\Pcal$. We wish to estimate the mean $\mu(P) = \EE_{Z\sim P}[X]$ of $P$.
% An \emph{estimator} $\muhat:\bigcup_{n=0}^{\infty} \RR^n\rightarrow \RR$ maps this dataset to a scalar, which approximates $\mu$.
% When there are $n$ i.i.d points, the maximum $L_2$ error\footnote{%
% Our ideas can be extended to $L_p$ error as well, which use the $p$-norm instead of the $2$-norm.} of an estimator $\muhat$ is,

% \begin{align}
%     \label{eqn:err}
%     \err(\muhat, n) = %\inf_{\muhat}
%         \sup_{P\in\Pcal} \EE_{X\sim P^n}\x\left[
%         \|\muhat(X) - \mu(P)\|_2^2
%     \right]      
% \end{align}


% The $\sup_{P\in\Pcal}$ accounts for the fact that $P$ is unknown
% \emph{a priori}, and hence $\muhat$ should do well on all $P\in\Pcal$;
% for instance, the (nonsensical) estimator $\muhat(X) = 1.234$ achieves zero error when $\mu(P) = 1.234$, but does poorly elsewhere.

% The most natural estimator, and one which minimizes $\err(\muhat, n)$
% is the sample mean $\muhatsm(X) = \frac{1}{|X|}\sum_{x\in X} x$.
% That said, in our marketplace, we will find it useful to intentionally construct worse estimators to maximize profit;
% for instance, an estimator which intentionally throws away a random subset of the data and takes the sample mean of the remaining points will necessarily do worse than $\muhatsm$.

% Hence, $\err(n)$ is is the best possible worst-case risk we can achieve via an appropriately defined estimator.

\parahead{Marketplace}
A marketplace for mean estimation involves three key actors:  
\emph{(i)} a finite set of data \emph{contributors} $\contributors$,
\emph{(ii)} a finite set of \emph{buyers} $\buyers$,
and
\emph{(iii)} a \emph{trusted broker}, who facilitates transactions between contributors and buyers.  



Each contributor draws samples from the same but \emph{unknown} distribution $P \in \Pcal$, and submit it (potentially misreported) to the broker.
Buyers wish to estimate $\mu(P)$, but have different valuations $\{\vali\}_{i\in\buyers}$ for how accurate this estimate is (we will define $\vali$ shortly).
No party---the contributors, buyers, or the broker---has any additional information, such as a prior, about $P$, other than knowing $P \in \Pcal$.


Using the datasets submitted by contributors, the broker sells estimates of $\mu(P)$ to buyers and redistributes the revenue among contributors. These interactions proceed as follows:
\vspace{-0.15in}
\begin{enumerate} [leftmargin=0.16in]
    \item \emph{Mechanism design}:
    \label{itm:mechanismdesign}
    The broker designs and publishes a mechanism  to evaluate data submissions from
contributors, compute estimates and set prices for buyers, and redistribute the revenue back to contributors.
\vspace{-0.10in}
    \item \emph{Data collection}:
    \label{itm:datacollection}
Each contributor $i \in \contributors$ collects $\nni \in \NN$ data points at cost $\cost_i \nni$, to produce a dataset $\initdatai \in \RR^{\nni}$.
\vspace{-0.1in}
    \item \emph{Data submission}:
    \label{itm:datasubmission}
    Each contributor submits $\subdatai = f_i(\initdatai) \in \bigcup_{\ell=0}^\infty \RR^\ell$, where the submission function $f_i$ may modify the collected dataset. This enables strategic
alterations (\eg fabrication) to maximize personal benefit by reducing costs and/or
increasing their payment. \hspace{-0.5in}
\vspace{-0.26in}

    \item \emph{Purchases}:
    \label{itm:pricing}
     Based on the contributors' submissions, the broker's mechanism produces datasets $\cbr{\datasetj}_{j \in \buyers} \in \buyers\in \bigcup_{\ell=0}^\infty \RR^\ell $ for each buyer and charges them \emph{prices} $\{\pricej'\}_{j \in \buyers}\in\RR^{|\buyers|}$.
     %It generates total revenue $\sum_{j\in\buyers}\pricej'$.

\vspace{-0.1in}
    \item \emph{Revenue redistribution}: \hspace{-0.05in}
    \label{itm:revenueredistribution}
    The broker disburses the revenue $\sum_{j \in \buyers} \pricej'$ via \emph{payments} $\{\payi'\}_{i \in \contributors} \in \RR^{|\contributors|}$  to contributors.
\end{enumerate}


\subparahead{Verbiage}
As noted above, the amount charged to a buyer for a dataset is referred to as the \emph{price}, while the amount given to a contributor for their work is called a \emph{payment}.  


%A contributor's submission function $\subfunci : \Dcal \rightarrow \Dcal$ maps their collected dataset to a (potentially different) dataset they choose to submit.


\subparahead{Problem instance}
Let  $\cost \defeq \{\costi\}_{i \in \contributors} \in \RR_+^{|\contributors|}$ denote all contributor costs, and $\val \defeq \{\valj\}_{j \in \buyers}$ denote all buyer valuations.
An instance of this market design problem is specified by the tuple $(\cost, \val)$, which we will assume is \emph{public information},
\ie known to the broker and all contributors and buyers.
% We will
% The data collection costs $\cost$ and buyer valuations $\val$ are \emph{public information}. Hence, .



\parahead{Mechanism}
The broker's mechanism determines buyers' datasets, buyers' prices, and contributors' payments based on the public information $(\cost,\val)$ and datasets reported by contributors.
To define this formally, let $\Dcal = \bigcup_{\ell=0}^\infty \RR^\ell$
be the space of datasets that each contributor may submit.
A \emph{deterministic mechanism} is specified by  
$M = \left(\{\datasetj\}_{j \in \buyers}, \{\pricej\}_{j \in \buyers}, \{\payi\}_{i \in \contributors}\right)
$,
where $\datasetj : \Dcal^{|\contributors|} \to \bigcup_{\ell=0}^\infty \RR^\ell$ is the dataset for buyer $j$,  
$\pricej : \Dcal^{|\contributors|} \to \RR$ is the pricing rule for buyer $j$, and  
$\payi : \Dcal^{|\contributors|} \to \RR$ is the payment rule for contributor $i$. 
In all three cases, we have suppressed the dependence on $(\cost,\val)$, as they will remain fixed.
A \emph{randomized mechanism} $M$ is a distribution over such tuples, from which a sample is drawn and executed at runtime.

Due to the stochastic nature of data collection and the mechanism's randomness, prices and payments will also be random. We allow \emph{ex post} (\ie stochastic) negative prices (where the broker pays a buyer) and negative payments (where a contributor pays the broker). Although unconventional, this enables the design of mechanisms with strong guarantees. Notably, in our mechanism, the expected prices and payments are always non-negative.


% The broker's mechanism should determine the buyers' estimates, the buyers' prices, and contributors' payments, based on the 
% datasets reported by the contributors.
% Hence, a \emph{deterministic} mechanism for this problem can be specified via 
% $\left(\{\muhatj\}_{j\in\buyers}, \{\pricej\}_{j\in\buyers}, \{\payi\}_{i\in\contributors}\right)$.
% Here, $\muhatj:\Dcal^{|\contributors|}\rightarrow \RR$ is the estimator
% for buyer $j$,
% $\pricej:\Dcal^{|\contributors|}\rightarrow \RR$ is the pricing rule for buyer $j$,
% and $\payi:\Dcal^{|\contributors|}\rightarrow \RR$ is the payment rule for contributor $j$.
% A randomized mechanism $M$ is a distribution over all possible values for $\left(\{\muhatj\}_{j\in\buyers}, \{\pricej\}_{j\in\buyers}, \{\payi\}_{i\in\contributors}\right)$, from which a sample is drawn and executed at run time.


\parahead{Contributors}
After the mechanism is published, each contributor decides how much data to collect and what to submit to the broker. A \emph{deterministic strategy} for contributor $i$ is a pair $\strati = (\nni, \subfunci)$. First, the contributor samples $\nni \in \NN$ points to collect an initial dataset $\initdatai = \{x_{i,j}\}_{j=1}^{\nni}$, incurring a cost of $\costi \nni$. Here, each $x_{i,j}$ is drawn independently from $P$. She then submits $\subdatai = \{y_{i,j}\}_j = \subfunci(\initdatai)$, where $\subfunci : \Dcal \to \Dcal$ maps the collected dataset to a possibly altered dataset of potentially different size.  
A \emph{randomized (mixed) strategy} $\strati$ is a distribution over $(\nni, \subfunci)$ pairs, from which a sample is drawn and executed at runtime.



\subparahead{(Un)truthful submissions}
To provide reliable mean estimates for buyers, 
we wish to incentivize agents to submit data truthfully, \ie 
$\subfunci=\identity$, where $\identity$ is the identity function which maps the data to itself.
In naive mechanisms, contributors may find it beneficial to use $\subfunci\neq\identity$, to fabricate, falsify, or otherwise misreport their data.
Note that our formalism allows contributors to alter their submission based on the collected dataset $\initdatai$. For example, she may collect a small dataset, fit a distribution to it, and fabricate additional points by sampling from this fitted distribution.



\subparahead{Strategy profiles and generating process}
Let $\strat = \{\stratj\}_{j \in \contributors}$ denote the strategy profile of all contributors, and $\stratmi = \{\stratj\}_{j \in \contributors \setminus \{i\}}$ the strategies of all contributors except $i$. We use $\genstrat$ to represent the generating process for the combined dataset $\subdata \defeq \{\subdatai\}_{i \in \contributors}$ received by the broker (see~\eqref{eqn:err}). This process accounts for each contributor sampling $\nni$ i.i.d. points $\initdatai$ and submitting $\subdatai = \subfunci(\initdatai)$.
In particular, $\subdata$ may not be i.i.d. if any contributor uses $\subfunci \neq \identity$.


\subparahead{Contributor utility} \hspace{-0.1in}
If a contributor samples $\nni$ points and receives payment $\payi' \in \RR$, her \emph{ex post} utility is $\payi' - \costi \nni$.
As these quantities depend on the mechanism, the contributors' strategies, and possibly the distribution $P \in \Pcal$ from which data is drawn, her \emph{ex ante} utility can be written as:
\begin{align*}
    \utilci(\mech, \strat)
        &= \inf_{P\in\Pcal} \utilci(\mech, \strat; P)
        \hspace{0.3in}\text{where, }\hspace{0.1in}
          \numberthis  \label{eqn:utilc}
        \\
    \utilci(\mech, \strat; P)
        &= \EE_{M, \sigma, P}\left[ \payi\big(\{\subfunci(\initdatai)\}_{i\in\contributors}\big)
                - \costi \nni\right]
    % \utilci(\mech, \strat)
    %     &= \inf_{P\in\Pcal}  \EE_{M, \sigma, P}\left[ \payi\big(\{\subfunci(\initdatai)\}_{i\in\contributors}\big)
    %             - \costi \nni\right]
    %        \numberthis  \label{eqn:utilc}
\end{align*}
The expectation $\EE_{M, \sigma, P}$ is taken over the randomness in the mechanism, the contributor strategies $\strati = (\nni, \subfunci)_{i \in \contributors}$, and the stochasticity of i.i.d. datasets $\{\initdatai\}_{i \in \contributors}$ drawn from $P$. The $\inf_{P \in \Pcal}$ serves a similar purpose as the $\sup_{P \in \Pcal}$ in~\eqref{eqn:err}, ensuring the quantity is well-defined in the frequentist setting; it reflects the fact that $P$ is unknown and requires the mechanism to perform well for all $P \in \Pcal$ under reasonable strategies $\strat$. Notably, in our mechanism, $\utilci(\mech,\strat; P)$ will be constant with respect to $P$ when agents report truthfully, \ie independent of $P$.
\kkcomment{@Keran: check if this is this correct?}


\parahead{Buyers}
Buyers are not strategic players in our marketplace.
However, each buyer may individually choose whether to participate, and expects fair treatment relative to other buyers.
Buyers wish to estimate $\mu(P)$, \ie achieve small error, as defined in~\eqref{eqn:err}.
This error depends on the dataset $\datasetj$ provided by the mechanism and the generating process $\genstrat$ induced by the contributors' strategies $\strat$ (see paragraph titled "Strategy profiles and generating process").
Buyers may have differing valuations for varying errors, modeled by buyer-specific non-increasing functions $\valfunci: \RR_+ \rightarrow \RR_+$.
%This is illustrated in Fig.~\ref{fig:buyervalfuncs}.
A buyer's \emph{valuation} $\vali$ is thus given by:
\begin{align}
    \vali(\muhatj, \strat) \defeq \valfunci(\err(\muhatj, \genstrat)).
    \label{eqn:buyerval}
\end{align}
Finally, a buyer's \emph{utility} $\utili$ is her valuation minus her payment,
and is defined as follows:
%We have,
\begin{align}
\hspace{-0.07in}
    \utilbi(M, \strat) \defeq \EE_{M, \sigma, P}\left[ \vali(\muhatj, \strat) - \pricei\big(\{\subfunci(\initdatai)\}_{i\in\contributors}\big) \right].
    \hspace{-0.03in}
    \label{eqn:buyerutil}
\end{align}

\textbf{The mechanism's objectives}

We aim to design a mechanism that satisfies the following properties under the recommended strategy $\strategy^{\star}_{i \in \contributors}$.



1. IR for the contributors: \[\utilci (M,\strategy) = \underset{\distrifamily}{\inf} \ \mathbb{E}\left[  p_i(M,\strategy)\right]-\cost_i \datanum_i \geq 0 , \; i \in \contributors \] 

2. IR for the buyer: \[\utilityb_j(M,\strategy  ) \geq 0 , \; j \in \buyers  \] 

3. The assignment is \emph{envy-free} for the buyer, i.e, no buyer has a higher utility for the assignment offered to another buyer.

4. Collecting the recommended amount of data and truthful submission is NIC: when others follow the best strategy by the mechanism, for any $\strategy_i \neq \strategy_i^{\star} $,
\[ \utilci (M,\strategy_i,\strategy_{-i}^{\star}) \leq \utilci (M,\strategy_i^{\star},\strategy_{-i}^{\star})  \]


5. Efficiency: Maximize contributors' total profit. 

6. Budget balance: \[  \sum_{j=1}^{\numtypes} \pricej(M,\strategy) = \sum_{i=1}^{\numcontributors} \pay_i(M,\strategy) \] 




\textcolor{red}{contents below are not needed}

\textbf{Contributors: }There are $\numcontributors$ contributors, each capable of collecting a dataset $\data_i$ containing data points drawn independently and identically from a distribution $\distri \in \distrifamily$. Each contributor $i$ incurs a cost $\cost_i$ per data point collected.


\textbf{Contributors’ strategy space: } Under this mechanism, contributors collect $\datanum_i$ data points, denoted as $X_i$, and then submit $\subdata_i = \function_i(X_i)$ to the mechanism, where $\function_i : \bigcup_{n\geq 0}^{}\mathbb{R}^n \to \bigcup_{n\geq 0}^{}\mathbb{R}^n$ is a function specific to the contributor that maps the collected dataset to a potentially fabricated dataset of a different size. The strategy space for each contributor is represented by $\strategy_i = (\datanum_i, f_i)$, indicating how many data points to collect and how to report their data. 
%Buyers then purchase data from the mechanism to estimate the true mean value $\mu$. 
We write the strategy
space of a contributor as $\mathcal{S}= \mathbb{N} \times \mathcal{F}$, where $ \mathbb{N}$ represents the space for number of data collected, and $\mathcal{F}$ is the space of functions mapping the dataset collected to the
dataset submitted. 

In the case of \textbf{Truthful submission}, contributors submit their data unaltered (“i.e., $f_i = \mathbf{I}$”).






\textbf{Buyers: } The buyer population $\buyers$ consists of $\numtypes$ types of buyers. Each buyer $j \in \buyers$ has a non-decreasing valuation curve $v_j$, representing their value for the data points received. The valuation curves will be formally defined in Equation \ref{eq:buyervalue}.

\textbf{Mechanism: } The mechanism takes as input the submitted data \( \subdata_1, \dots, \subdata_d \), and outputs:

\begin{itemize}
    \item An estimator $\hat{\mu}$ for the distribution mean. (\ref{itm:pricing})
    \item Payments $\pi$ for buyers. (\ref{itm:pricing})
    \item Revenue redistribution among contributors $p$. (\ref{itm:revenueredistribution})
\end{itemize}

The mechanism space is defined as:
\[
\mathcal{M} = \left\{ M = (p,  \pi, \hat{\mu}) \right\},
\]
where $p : \left(\bigcup_{n \geq 0} \mathbb{R}^n\right)^d \to \mathbb{R}^d$, $\pi : \left(\bigcup_{n \geq 0} \mathbb{R}^n\right)^d \to \mathbb{R}^\numtypes$, and $\hat{\mu}:  \left(\bigcup_{n \geq 0} \mathbb{R}^n\right)^d \to  \mathbb{R} $.

\textbf{Buyer's ex-post valuation and utility: } The valuation of buyer $j$ is based on estimation error. Given contributors' strategy $\strategy=(\strategy_1,\dots, \strategy_\numcontributors)$ and a mechanism $M$, buyer $j$'s estimation \emph{error} is:

\begin{align}
   \mathrm{error} =  \underset{p \in \distrifamily}{\sup} \; \mathbb{E}\left[ \rbr{\hat{\mu}_j-\mu }^2 \right] ,
\end{align}

and buyer $j$'s \emph{valuation} is a decreasing function of error:
\begin{align} \label{eq:buyervalue}
     \tilde{v}_j(M,s) = \phi_j(\mathrm{error}).
\end{align}

Where $\phi : R_{+}\to [0,1]$ is a decreasing function on $[0,\infty]$.

For any buyer $j \in \buyers$, the \emph{utility} is defined as 
\begin{align*}
    \utilityb_j (M,s) = \tilde{v}_j(M,s) - \mathbb{E}\sbr{\pi_j(M,s)} .
\end{align*}

\textbf{Buyer's ex-ante valuation of dataset: }  Let $Z=(Z_1,\dots,Z_n)$ be a sample drawn from the distribution $\distri^n$. We denote  $\hat{\mu}(Z)$ as sample mean, i.e, $\hat{\mu}(Z) \overset{d}{=} \frac{\sum_i Z_i}{n}$. Buyer $j$’s valuation under truthful data is defined as: 

\begin{align}
   \mathrm{error} =  \underset{p \in \distrifamily}{\sup} \; \mathbb{E}\left[ \rbr{\hat{\mu}(Z)-\mu }^2 \right] ,
\end{align}

and buyer $j$'s valuation is a decreasing function of error:
\begin{align} \label{eq:buyervalue}
     v_j(n) = \phi_j(\mathrm{error}).
\end{align}

\textbf{Contributors' profit: }Contributors $i$'s profit
\[ u_i(M,s) = \underset{\distrifamily}{\inf}\; \mathbb{E}\sbr{p_i(M,s)}- c\datanum_i . \]


\textbf{Recommended strategies for the contributors: } The broker recommend strategy $\strategy^{\star}_{i \in C}$ to each contributor to (\emph{i}) incentivize truthful contribution.




%\[n^* =\max \sbr{ \arg\max_{n \in [N]} \left[ v(n) - \price(n) \right]}\]


\begin{definition}
    Envy Free pricing problem: Given the input $\left\{ v_j \right\}_{i \in \buyers} $, and all buyers agree to participate in the mechanism, an Envy Free pricing scheme outputs a set of $(\hat{\mu}_j,\pricej), \; \forall j \in \buyers$ maximizing the contributors' revenue. Here,  $\left\{(\hat{\mu}_j,\pricej)\right\}_{j \in \buyers}$ represents the assignment: an estimator and a price offered to each buyer. It satisfies the following properties:

    \emph{(i)} Individual Rationality (IR): for any $j \in \buyers$, \[ \utilityb_j(M,\strategy)\geq 0 .\] 

    \emph{(ii)} Envy Free (EF): for any $j$ and any $k \neq j$, we have 
    \[ v_j(M, \hat{\mu}_j) -\mathbb{E}\sbr{\price_j} \geq   v_j(M, \hat{\mu}_k) -\mathbb{E}\sbr{\price_k}. \]    

\textcolor{red}{need to be fixed}
     \begin{align*}
         \EE_{M, \sigma, P}\left[ \valj(\muhatj, \strat) - \pricej \right]  \\ \geq  \EE_{M, \sigma, P}\left[ \valj(\muhatk, \strat) - \pricek \right] 
     \end{align*}
     
\end{definition}



We demonstrate that the Envy-free pricing problem is equivalent to the Revenue-optimal data pricing problem \ref{def:rev_optpricing}. Thus, any solution to the Envy-free pricing problem is also a solution to the Revenue-optimal data pricing problem. Therefore, we convert our problem (\ref{itm:pricing}) into finding an optimal price curve that maximizes the contributors' revenue: \textcolor{red}{proof of equivalence is in Appendix Lemma}

    \begin{align*}
        n^{\star}_i(\pricecurv) = \max \rbr{\underset{n}{\arg\max} \rbr{v_i(n)-\pricecurv(n) }}
    \end{align*}

    \begin{align*}
       \mathrm{rev}(\pricecurv^{\star}) = \underset{\pricecurv}{\max} \rbr{\sum_{i \in \buyers} \pricecurv \rbr{ n^{\star}_i(\pricecurv) }}
    \end{align*}

