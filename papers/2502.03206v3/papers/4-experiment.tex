\section{Simulations and Experiment}
In this section, we conduct comprehensive experiments in both simulation and the real-world robot to address the following questions:
\begin{itemize}[leftmargin=*]
    \item \textbf{Q1(Sim)}: How does the \our policy perform in tracking across different commands?
    \item  \textbf{Q2(Sim)}: How to reasonably combine various commands in the general command space? % Command Analysis
    \item \textbf{Q3(Sim)}: How does large-scale noise intervention training help in policy robustness? % Ablation Study
    \item \textbf{Q4(Real)}: How does \our behave in the real world? % Real World Demo
\end{itemize}

\noindent\textbf{Robot and Simulator.} 
Our main experiments in this paper are conducted on the Unitree H1 robot, which has 19 Degrees of Freedom (DOF) in total, including 
two 3-DOF shoulder joints, two elbow joints, one waist joint, two 3-DOF hip joints, two knee joints, and two ankle joints.
The simulation training is based on the NVIDIA IsaacGym simulator~\citep{makoviychuk2021isaac}. It takes 16 hours on a single RTX 4090 GPU to train one policy.

\noindent\textbf{Command analysis principle and metric.}
One of the main contributions of this paper is an extended and general command space for humanoid robots. Therefore, we pay much attention to command analysis (regarding Q1 and Q2). This includes analysis of single command tracking errors, along with the combination of different commands under different gaits.
% we categorize the commands into three groups: \emph{movement}, \emph{foot}, and \emph{posture}. The \emph{movement} commands include the linear velocity and angular velocity, forming the foundational locomotion commands and are considered the most critical aspect of the tasks. The \emph{foot} commands include the gait frequency and foot swing height, representing the mode of leg movement. The \emph{posture} commands include body height, body pitch and waist yaw, which determine the desired body posture.
For analysis, we evaluate the averaged episodic command tracking error (denoted as $E_\text{cmd}$), which measures the discrepancy between the actual robot states and the command space using $L_1$ norm.
% The tracking error is measured in units of $m/s$, $rad/s$, $Hz$, $m$, and $rad$, corresponding to linear velocity, angular velocity, frequency, position, and rotation, respectively.
All commands are uniformly sampled within a pre-defined command range, as shown in \tb{tab:commands}\footnote{Note that the hopping gait keeps a different command range, due to its asymmetric type of motion. More details can be referred to \ap{ap:Hopping}.}.

\input{tables/commands}

\subsection{Single Command Tracking}
We first analyze each command separately while keeping all other commands held at their default values. The results are shown in \tb{tab:Single commands}.
It is easily observed that the tracking errors in the walking and standing gaits are significantly lower than those in the jumping and hopping, with hopping exhibiting the largest tracking errors.
For hopping gaits, the robot may fall during the tracking of specific commands, like high-speed tracking, body pitch, and waist-yaw control.
This can be attributed to the fact that hopping requires rather high stability. Moreover, the complex postures and motions further exacerbate the risk of instability. Consequently, the policy prioritizes learning to maintain the balance, which, to some extent, compromises the accuracy of command tracking.

We conclude that the tracking accuracy of each gait aligns with the training difficulty of that gait in simulation. For example, the walking and standing patterns can be learned first during training, while the jumping and hopping gaits appear later and require an extended training period for the robot to acquire proficiency.
Similarly, the tracking accuracy of robots under low velocity is significantly better than those under high velocity, since 1) the locomotion skills under low velocity are much easier to master, and 2) the dynamic stability of the robot decreases at high speeds, leading to a trade-off with tracking accuracy.

We also found that the tracking accuracy for longitudinal velocity commands $v_x$ surpasses that of horizontal velocity commands $v_y$, which is due to the limitation of the hardware configuration of the selected Unitree H1 robots. In addition, the {foot swing height} $l$ is the least accurately tracked.
Furthermore, the tracking reward related to foot placement outperforms the tracking performance associated with posture control, since adjusting posture introduces greater challenges to stability. In response, the policy adopts more conservative actions to mitigate balance-threatening postural changes.
% In contrast, the influence of foot placement on stability is comparatively less pronounced, allowing for more precise tracking.

\input{tables/single-commands-tracking-error}
\input{tables/intervention-mean-foot-movement}

\subsection{Command Combination Analysis}
To provide an in-depth analysis of the command space and to 
reveal the underlying interaction of various commands under different gaits.
Here, we aim to analyze the \emph{orthogonality} of commands based on the interference or conflict between the tracking errors of these commands across their reasonable ranges. For instance, when we say that a set of commands are \emph{orthogonal}, each command does not significantly affect the tracking performance of each other in its range. To this end, we plot the tracking error $E_\text{cmd}$ as heat maps, generated by systematically scanning the command values for each pair of parameters, revealing the correlation of each command.
We leave the full heat maps at \ap{ap:heatmaps}, and conclude our main observation for all gaits.

\noindent\textbf{Walking.} Walking is the most basic gait, which preserves the best performance of the robot hardware.
\begin{itemize}[leftmargin=*]
    \item The {linear velocity} $v_x$, the {angular velocity yaw} $\omega$, the {body height} $h$, and the {waist yaw} $w$ are orthogonal during walking.
    \item When the {linear velocity} $v_x$ exceeds $1.5m/s$, the orthogonality between $v_x$ and other commands decreases due to reduced dynamic stability and the robot's need to maintain body stability over tracking accuracy.
    \item The {gait frequency} $f$ shows discrete orthogonality, with optimal tracking performance at frequencies of 1.5 or 2. High-frequency gait conditions reduce tracking accuracy.
    \item The {linear velocity} $v_y$, the {foot swing height} $l$, and the {body pitch} $p$ are orthogonal to other commands only within a narrow range.
\end{itemize}

\noindent\textbf{Jumping.} The command orthogonality in jumping is similar to walking, but the overall orthogonal range is smaller, due to the increased challenge of the jumping gait, especially in high-speed movement modes.
During each gait cycle, the robot must leap forward significantly to maintain its speed. To execute this complex jumping action continuously, the robot must adopt an optimal posture at the beginning of each cycle. Both legs exert substantial torque to propel the body forward. Upon landing, the robot must quickly readjust its posture to maintain stability and repeat the actions. Consequently, during movement, the robot can only execute other commands within a relatively narrow range.

\noindent\textbf{Hopping.}
The hopping gait introduces more instability, and the robot's control system must focus more on maintaining balance, making it difficult to simultaneously handle complex, multi-dimensional commands.
\begin{itemize}[leftmargin=*]
    \item Hopping gait commands lack clear orthogonal relationships.
    \item Effective tracking is limited to the x-axis {linear velocity} $v_x$, the y-axis {linear velocity} $v_y$, the {angular velocity yaw} $\omega$, and the {body height} $h$.
    \item Adjustments to $h$ can be understood that a lower body height improves dynamic stability, therefore, it plays a positive role in maintaining the target body posture.
    % enhancing the robot's hopping performance.
\end{itemize}

\noindent\textbf{Standing.} As for the standing gait, we tested the tracking errors of commands related to posture. The results showed that the tracking errors were similar to those observed during walking with zero velocity.

\begin{itemize}[leftmargin=*]
    \item The {waist yaw} $w$ command is almost orthogonal to the other two commands.
    \item As the range of commands increases, orthogonality between the {body height} $h$ and the {body pitch} $p$ decreases. This is because the H1 robot has only one degree of freedom at the waist, limiting posture adjustments to the hip pitch joint.
    \item A 0.3 m decrease of the body height relative to the default height reduces the range of motion of the hip pitch joint to almost zero, hindering precise tracking of body pitch.
\end{itemize}

Furthermore, we conclude that {gait frequency} $f$ highly affects the tracking accuracy of \emph{movement} commands when it is excessively high and low; the \emph{posture} commands can significantly impact the tracking errors of other commands, especially when they are near the range limits.
% We categorize the commands into three groups: \emph{movement}, \emph{foot}, and \emph{posture}. 1) The \emph{movement} commands include the linear velocity $v_x, v_y$ and angular velocity $\omega$, forming the foundational locomotion commands, and are considered the most critical aspect of the tasks. 2) The \emph{foot} commands include the {foot swing height} $l$, which is the least accurately tracked; and the {gait frequency} $f$, which can affect the tracking accuracy of \emph{movement} commands when it is excessively high and low. 3) The \emph{posture} commands, which include body height $h$, the body pitch $p$, and waist yaw $w$, determine the desired body posture, and can significantly impact the tracking errors of other commands, especially when the command is challenging. 
For different gaits, the orthogonality range between commands is greatest in the walking gait and smallest in the hopping gait.

\subsection{Ablation on Intervention Training Strategy}
\label{sec:InterventionExp}
% The three policies use the same random seeds and training time.
To validate the effectiveness of the intervention training strategy on the policy robustness when external upper-body intervention is involved, we compare the policies trained with different strategies, including noise curriculum (\our), filtered AMASS data~\citep{he2024omnih2o}, and no intervention. We test the tracking errors under two different intervention tasks, \textit{i.e.}, uniform noise, AAMAS dataset, along with a no-intervention setup. The results under the walking gait are shown in \tb{tab:Intervetion Tracking Error}, and we leave other gaits in \ap{ap:SingleCommandsTracking-REMAIN}. 
It is obvious that the noise curriculum strategy of \our achieved the best performance under almost all test cases, except the posture-related tracking with no intervention. 
In particular, \our showed less of a decrease in tracking accuracy with various interventions, indicating our noise curriculum intervention strategy enables the control policy to handle a large range of arm movements, making it very useful and supportive for loco-manipulation tasks.
In comparison, the policy trained with AMASS data shows a significant decrease in the tracking accuracy when intervening with uniform noise, due to the limited motion in the training data. The policy trained without any intervention only performs well without external upper-body control.

It is worth noting that when intervention training is involved, the tracking error related to the movement and foot is also better than those of the policy trained without intervention, and \our provides the most accurate tracking. This shows that intervention training also contributes to the robustness of the policy. During our real robot experiments, we further observed that the robot behaves with a harder force when in contact with the floor, indicating a possible trade-off between motion regularization and tracking accuracy when involving intervention.

\noindent\textbf{Stability under standing gait.}
Adjusting posture in the standing state introduces additional requirements for stability, since the robot pacing to maintain balance may increase the difficulty of achieving manipulation tasks that require stand still. To investigate the necessity of noise curriculum for manipulation, we further measured the averaged foot displacement (in meters) under the standing gait, which computes the total movement of both feet in one episode (20 seconds) while tracking the posture behavior commands. Results in \tb{tab:Intervention Mean Foot Movement} show that \our exhibits minimal foot displacement. On the contrary, the strategy trained on AMASS data requires frequent small steps to adjust the posture and maintain stability for noise interventions. 
Without intervention training, the policy tends to tip over when involving intervention, leading to failure of the entire task.

%  鲁棒性测试的结果分析
\begin{figure}[t]
    \centering
    \includegraphics[width=\linewidth]{imgs/radar_chart_V2.pdf}
    \vspace{-13pt}
    \caption{\small \textbf{External disturbance tolerance}. Left: A constant and continuous force is applied to the robot. Right: A one-second force is exerted on the robot. The experiment is conducted under a standing gait with default commands. If the robot's survival ratio exceeds $98\%$, it is deemed capable of tolerating such external disturbance. 
    The survival ratio computes the trajectory ratio of non-termination (ends of timeout) during 4096 rollouts.}
    \label{fig:Robust}
    \vspace{-12pt}
\end{figure}
\noindent\textbf{Robustness for external disturbance.}
Finally, we test the contribution of intervention training and noise curriculum to the robustness of external disturbance. In particular, we evaluated the robot's maximum tolerance to external disturbance forces in eight directions and compared the policy trained without intervention. Results illustrated in \fig{fig:Robust} demonstrate that \our preserves greater tolerance for external disturbances in both pushing and loading scenarios across most of the directions. The reason behind this is that the intervention brings the robot exposed to various disturbances originating from its upper body, and thereby enhances the overall stability by dynamically adjusting leg strength.

% \our has a significantly higher tolerance for external disturbance forces in almost all directions compared to the strategy without intervention training.
% This is attributed to the fact that, during large-scale noise intervention training, the robot effectively explored a wide range of extreme scenarios and learned to enhance body stability by adjusting leg movements.

\subsection{Real-World Experiments}
We deploy \our on a real-world robot to verify its effectiveness. In \fig{fig:teaser}, we illustrate the humanoid capabilities supported by \our, showing the versatile behavior of the Unitree H1 robot. In particular, we demonstrate the intriguing potential of the comprehensive task range that \our is able to achieve, with a flexible combination of commands in high dynamics. To qualitatively analyze the performance of \our, we estimate the tracking error of two pose parameters (body pitch $p$ and waist rotation $w$ from the motor readings) on real robots, since other commands are hard to measure without a highly accurate motion capture system. The results are shown in \tb{tb:track-real}, where $E^{\text{real}}_{\text{cmd}}$ illustrates the tracking error of the posture command.
We observe that the tracking error in real-world experiments is slightly higher than in simulation environments, primarily due to sensor noise and the wear of the robot's hardware. Among different gaits, the tracking error for the waist rotation $w$ is smaller compared to that for the body pitch $p$, as waist control has less impact on the robot’s overall stability. In both error tests, the jumping gait exhibited the smallest $E_{cmd}$, while the walking gait showed slightly higher errors, consistent with the findings observed in the simulation environment.

\begin{table}[t]
\centering
\caption{\small \textbf{Tracking error in real world.} We conducted five tests to measure the tracking error for each command under three gaits. The tracking error for each command was calculated during each control step. The tested commands gradually increased from the minimum to the maximum values within a predefined range, while the remaining commands were kept at their default values.} % To account for the impact of communication delays on the actual tracking error, we introduced a 0.1-second delay in the command execution.
\label{tb:track-real}
\begin{tabular}{c|cc} \toprule
Gait     & $E_p^{\text{real}}$ & $E_w^{\text{real}}$ \\ \midrule
Standing & 0.0712 $\pm$ 0.0425 & 0.0718 $\pm$ 0.0614 \\
Walking  & 0.1006 $\pm$ 0.0581  & 0.0571 $\pm$ 0.0489 \\
Jumping  & 0.0674 $\pm$ 0.0569  & 0.0552 $\pm$ 0.0469 \\ \bottomrule
\end{tabular}
\end{table}
