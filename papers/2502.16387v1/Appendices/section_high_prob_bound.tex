\section{Deferred proofs in Section \ref{sec:bound_calibration}}\label{app:hp_bound}
\subsection{Proof of Theorem \ref{thm:high_prob_bound}}
Our proof of Theorem \ref{thm:high_prob_bound} crucially relies on the following version of Freedman's inequality from \cite{beygelzimer2011contextual}. Refer therein for a proof. 
\begin{lemma}\label{lem:Freedman} Let $X_{1}, \dots, X_{n}$ be a martingale difference sequence adapted to the filtration $\cF_{1} \subseteq \dots \subseteq \cF_{n}$, where $\abs{X_{i}} \le B$ for all $i = 1, \dots, n$, and $B$ is a fixed constant. Define $\cV \coloneqq \sum_{i = 1} ^ {n} \mathbb{E}[X_{i}^2 | \cF_{i - 1}]$. Then, for any fixed $\mu \in \bigs{0, \frac{1}{B}}, \delta \in [0, 1]$, with probability at least $1 - \delta$, we have \begin{align*}
    \abs{\sum_{i = 1} ^ {n} X_{i}} \le \mu \cV + \frac{\log \frac{2}{\delta}}{\mu}.
\end{align*}
\end{lemma}

\begin{proof}[Proof of Theorem \ref{thm:high_prob_bound}]
    Before discussing the proof, we introduce some notation. Let $\cZ$ be enumerated as $\cZ = \{z_{0}, \dots, z_{K}\}$, where $K = \abs{\cZ} - 1$. Observe that at time $t$, $\cA_{\cal}$ can be equivalently described by the following procedure: (a) it samples $i_{t}$ from the set $\{0, \dots, K\}$ with $\mathbb{P}_{t}(i_{t} = i) = \cP_{t}(z_{i})$, which we write as $\cP_{t, i}$ for convenience; (b) forecasts $p_{t} = z_{i_{t}}$.
Clearly, $\ind{p_{t} = z_{i}} = \ind{i_{t} = i}$. For simplicity, we denote $\rho_{z_{i}} = \rho_{i}$ and $\tilde{\rho}_{z_{i}} = \tilde{\rho}_{i}$. Under this notation, $\rho_{i}, \tilde{\rho}_i$ can be expressed as \begin{align*}
    \rho_{i} = \frac{\sum_{t = 1} ^ {T} y_{t} \ind{i_{t} = i}}{\sum_{t = 1} ^ {T} \ind{i_{t} = i}}, \quad \tilde{\rho}_{i} = \frac{\sum_{t = 1} ^ {T} y_{t} \cP_{t, i}}{\sum_{t = 1} ^ {T} \cP_{t, i}}.
\end{align*} 
We begin by bounding $\abs{\rho_{i} - \tilde{\rho}_{i}}$ using Lemma \ref{lem:Freedman}. Fix a $i \in \{0, \dots, K\}$ and define the martingale difference sequences $X_{t} \coloneqq y_{t} (\cP_{t, i} - \ind{i_{t} = i})$ and $Y_{t} \coloneqq \cP_{t, i} - \ind{i_{t} = i}$. Observe that $\abs{X_{t}} \le 1, \abs{Y_{t}} \le 1$ for all $t$. Fix a $\mu_{i} \in [0, 1]$. Applying Lemma \ref{lem:Freedman} to the sequences $X, Y$ and taking a union bound (over $X, Y$), we obtain that with probability at least $1 - \delta$,\begin{align}\label{eq:bounding_X_and_Y}
    \abs{\sum_{t = 1} ^ {T} y_{t}(\cP_{t, i} - \ind{i_{t} = i})} \le \mu_{i} \cV_{X} + \frac{\log \frac{4}{\delta}}{\mu_{i}}, \quad \abs{\sum_{t = 1} ^ {T} \cP_{t, i} - \ind{i_{t} = i}} \le \mu_{i}\cV_{Y} + \frac{\log \frac{4}{\delta}}{\mu_{i}},
\end{align}
where $\cV_{X}, \cV_{Y}$ are given by \begin{align*}
    \cV_{X} &= \sum_{t = 1} ^ {T} \mathbb{E}\bigs{X_{t} ^ 2 | \cF_{t - 1}} = \sum_{t = 1} ^ {T} y_{t} \cdot \cP_{t, i} (1 - \cP_{t, i}) \le \sum_{t = 1} ^ {T} \cP_{t, i}, \text{\,\,and} \\
    \cV_{Y} &= \sum_{t = 1} ^ {T} \mathbb{E}\bigs{Y_{t} ^ 2 | \cF_{t - 1}} = \sum_{t = 1} ^ {T} \cP_{t, i} (1 - \cP_{t, i}) \le \sum_{t = 1} ^ {T} \cP_{t, i}.\end{align*}
    
    The upper tail $\rho_{i} - \tilde{\rho}_{i}$ can then be bounded in the following manner: \begin{align*}
    \rho_{i} - \tilde{\rho}_{i} &= \frac{\sum_{t = 1} ^ {T} y_{t} \ind{i_{t} = i}}{\sum_{t = 1} ^ {T} \ind{i_{t} = i}} - \frac{\sum_{t = 1} ^ {T} y_{t} \cP_{t, i}}{\sum_{t = 1} ^ {T} \cP_{t, i}} \\
    &\le \frac{\sum_{t = 1} ^ {T} y_{t} \ind{i_{t} = i}}{\sum_{t = 1} ^ {T} \ind{i_{t} = i}} + \frac{\mu_{i} \sum_{t = 1} ^ {T} \cP_{t, i} + \frac{\log \frac{4}{\delta}}{\mu_{i}} -  \sum_{t = 1} ^ {T} y_{t}\ind{i_{t} = i}}{\sum_{t = 1} ^ {T} \cP_{t, i}} \\
    &= \frac{\sum_{t = 1} ^ {T} y_{t} \ind{i_{t} = i}}{\bigc{\sum_{t = 1} ^ {T} \ind{i_{t} = i}} \bigc{\sum_{t = 1} ^ {T} \cP_{t, i}}} \cdot \bigc{\sum_{t = 1} ^ {T} \cP_{t, i} - \ind{i_{t} = i}} + \frac{\mu_{i} \sum_{t = 1} ^ {T} \cP_{t, i} + \frac{\log \frac{4}{\delta}}{\mu_{i}}}{\sum_{t = 1} ^ {T} \cP_{t, i}} \\
    &\le \frac{\sum_{t = 1} ^ {T} y_{t} \ind{i_{t} = i}}{\bigc{\sum_{t = 1} ^ {T} \ind{i_{t} = i}} \bigc{\sum_{t = 1} ^ {T} \cP_{t, i}}} \cdot \bigc{\mu_{i} \sum_{t = 1} ^ {T} \cP_{t, i} + \frac{\log \frac{4}{\delta}}{\mu_{i}}} + \frac{\mu_{i} \sum_{t = 1} ^ {T} \cP_{t, i} + \frac{\log \frac{4}{\delta}}{\mu_{i}}}{\sum_{t = 1} ^ {T} \cP_{t, i}} \\
    &\le 2\mu_{i} + \frac{2\log \frac{4}{\delta}}{\mu_{i} \sum_{t = 1} ^ {T} \cP_{t, i}}, 
\end{align*} 
where the first and second inequalities follow from \eqref{eq:bounding_X_and_Y}, while the last inequality follows by bounding $y_{t} \ind{i_{t} = i} \le \ind{i_{t} = i}$. The lower tail can be bounded in an exact same manner as \begin{align*}
    \tilde{\rho}_{i} - \rho_{i} &= \frac{\sum_{t = 1} ^ {T} y_{t} \cP_{t, i}}{\sum_{t = 1} ^ {T} \cP_{t, i}} - \frac{\sum_{t = 1} ^ {T} y_{t} \ind{i_{t} = i}}{\sum_{t = 1} ^ {T} \ind{i_{t} = i}} \\
    &\le \frac{\sum_{t = 1} ^ {T} y_{t}\ind{i_{t} = i} + \mu_{i} \sum_{t = 1} ^ {T} \cP_{t, i} + \frac{\log \frac{4}{\delta}}{\mu_{i}}}{\sum_{t = 1} ^ {T} \cP_{t, i}} - \frac{\sum_{t = 1} ^ {T} y_{t} \ind{i_{t} = i}}{\sum_{t = 1} ^ {T} \ind{i_{t} = i}} \\
    &= \frac{\sum_{t = 1} ^ {T} y_{t} \ind{i_{t} = i}}{\bigc{\sum_{t = 1} ^ {T} \cP_{t, i}} \bigc{\sum_{t = 1} ^ {T} \ind{i_{t} = i}}} \cdot \bigc{\sum_{t = 1} ^ {T} \ind{i_{t} = i} - \cP_{t, i}} + \frac{\mu_{i} \sum_{t = 1} ^ {T} \cP_{t, i} + \frac{\log \frac{4}{\delta}}{\mu_{i}}}{\sum_{t = 1} ^ {T} \cP_{t, i}} \\
    & \le \frac{\sum_{t = 1} ^ {T} y_{t} \ind{i_{t} = i}}{\bigc{\sum_{t = 1} ^ {T} \ind{i_{t} = i}} \bigc{\sum_{t = 1} ^ {T} \cP_{t, i}}} \cdot \bigc{\mu_{i} \sum_{t = 1} ^ {T} \cP_{t, i} + \frac{\log \frac{4}{\delta}}{\mu_{i}}} + \frac{\mu_{i} \sum_{t = 1} ^ {T} \cP_{t, i} + \frac{\log \frac{4}{\delta}}{\mu_{i}}}{\sum_{t = 1} ^ {T} \cP_{t, i}} \\
    &\le 2\mu_{i} + \frac{2\log \frac{4}{\delta}}{\mu_{i}\sum_{t = 1} ^ {T} \cP_{t, i}} .
\end{align*}
Combining both the bounds, we have shown that for a fixed $\mu_{i} \in [0, 1]$, $\abs{\rho_{i} - \tilde{\rho}_{i}} \le 2\mu_{i} + \frac{2\log \frac{4}{\delta}}{\mu_i\sum_{t = 1} ^ {T} \cP_{t, i}}$ holds with probability at least $1 - \delta$. Taking a union bound over all $i$, with probability $1 - \delta$, we have (simultaneously for all $i$)
   \begin{align}
    \abs{\sum_{t = 1} ^ {T} y_{t}(\cP_{t, i} - \ind{i_{t} = i})} &\le \mu_{i} \sum_{t = 1} ^ {T} \cP_{t, i} + \frac{\log \frac{4(K + 1)}{\delta}}{\mu_{i}}, \nn\\
    \abs{\sum_{t = 1} ^ {T} \cP_{t, i} - \ind{i_{t} = i}} &\le \mu_{i}\sum_{t = 1} ^ {T} \cP_{t, i} + \frac{\log \frac{4(K + 1)}{\delta}}{\mu_{i}}, \label{eq:bounding_diff_p_ind} \\
    \abs{\rho_{i} - \tilde{\rho_{i}}} &\le 2\mu_{i} + \frac{2\log \frac{4 (K + 1)}{\delta}}{\mu_{i} \sum_{t = 1} ^ {T} \cP_{t, i}}\label{eq:bounding_rho_union_bound}.
\end{align}
Consider the function $g(\mu) \coloneqq \mu + \frac{a}{\mu}$, where $a \ge 0$ is a fixed constant. Clearly, $\min_{\mu \in [0, 1]} g(\mu) = 2\sqrt{a}$ when $a \le 1$, and $1 + a$ otherwise. Minimizing the bound in \eqref{eq:bounding_rho_union_bound} with respect to $\mu_{i}$, we obtain
\begin{align*}
    \abs{\rho_{i} - \tilde{\rho}_{i}} \le 4 \sqrt{\frac{\log \frac{4(K + 1)}{\delta}}{\sum_{t = 1} ^ {T} \cP_{t, i}}}, \text{when } \log \frac{4(K + 1)}{\delta} \le \sum_{t = 1} ^ {T} \cP_{t, i}.
\end{align*}
However, when $\log \frac{4(K + 1)}{\delta} > \sum_{t = 1} ^ {T} \cP_{t, i}$, we obtain that $\abs{\rho_{i} - \tilde{\rho}_{i}} \le 2 + \frac{2\log \frac{4(K + 1)}{\delta}}{\sum_{t = 1} ^ {T} \cP_{t, i}}$. In particular, when $\sum_{t = 1} ^ {T} \cP_{t, i}$ is tiny, which is possible if $\cA_{\cal}$ does not allocate enough probability mass to the index $i$, the bound obtained is large making it much worse than the trivial bound $\abs{\rho_{i} - \tilde{\rho}_i} \le 1$ which follows since $\rho_{i}, \tilde{\rho}_{i} \in [0, 1]$ by definition. Based on this reasoning, we define the set \begin{align}\label{eq:defintion_I}
    \cI \coloneqq \bigcurl{i \in \{0, \dots, K\} \text{\,s.t.\,} \log \frac{4(K + 1)}{\delta} \le \sum_{t = 1} ^ {T} \cP_{t, i}},
\end{align}
and bound ${(\rho_{i} - \tilde{\rho}_{i})} ^ 2$ as \begin{align}\label{eq:final_bound_rho_tilde_rho}
    {(\rho_{i} - \tilde{\rho}_{i})^2} \le \begin{cases}
         {\frac{16\log \frac{4(K + 1)}{\delta}}{\sum_{t = 1} ^ {T} \cP_{t, i}}} & \text{\,if\,}i \in \cI,  \\
        1 & \text{\,otherwise}.
    \end{cases}
\end{align}
Similarly, $\abs{\sum_{t = 1} ^ {T} \cP_{t, i} - \ind{i_{t} = i}}$ can be bounded by substituting the optimal $\mu_{i}$ obtained above in \eqref{eq:bounding_diff_p_ind}; we obtain 
\begin{align}\label{eq:final_bound_diff_p_ind}
    \abs{\sum_{t = 1} ^ {T} \cP_{t, i} - \ind{i_{t} = i}} \le \begin{cases}
        2\sqrt{\log \frac{4 (K + 1)}{\delta}\sum_{t = 1} ^ {T} \cP_{t, i}} & \text{\,if\,} i \in \cI, \\
        \sum_{t = 1} ^ {T} \cP_{t, i} + \log \frac{4(K + 1)}{\delta} & \text{\,otherwise}.
    \end{cases}
\end{align}
Equipped with \eqref{eq:final_bound_rho_tilde_rho}, \eqref{eq:final_bound_diff_p_ind}, we proceed to bound $\cal_{2}$ in the following manner: \begin{align*}
    \cal_{2} &= \sum_{i = 0} ^ {K} \sum_{t = 1} ^ {T} \ind{i_{t} = i} \bigc{z_{i} - \rho_{i}} ^ 2  \le 2\sum_{i = 0} ^ {K}\sum_{t = 1} ^ {T} \ind{i_{t} = i} \bigc{\bigc{z_{i} - \tilde{\rho}_i} ^ 2 + (\rho_{i} - \tilde{\rho}_i) ^ 2},
\end{align*}
where the inequality is because $(a + b)^2 \le 2 a^2 + 2b ^ 2$ for all $a, b \in \Rn$. To further bound the term above, we split the summation into two terms $\cT_{1}, \cT_{2}$ defined as \begin{align*}
    \cT_{1} \coloneqq \sum_{i \in \cI} \sum_{t = 1} ^ {T} \ind{i_{t} = i} \bigc{\bigc{z_{i} - \tilde{\rho}_i} ^ 2 + (\rho_{i} - \tilde{\rho}_i) ^ 2}, \\
    \cT_{2} = \sum_{i \in \bar{\cI}} \sum_{t = 1} ^ {T} \ind{i_{t} = i} \bigc{\bigc{z_{i} - \tilde{\rho}_i} ^ 2 + (\rho_{i} - \tilde{\rho}_i) ^ 2},
\end{align*}
and bound $\cT_{1}$ and $\cT_{2}$ individually. We bound $\cT_{1}$ as \begin{align*}
    \cT_{1} &\le \sum_{i \in \cI} \bigc{\sum_{t = 1} ^ {T} \cP_{t, i} + 2 \sqrt{\log \frac{4 (K + 1)}{\delta}\sum_{\tau = 1} ^ {T} \cP_{\tau, i}}} \bigc{\bigc{z_{i} - \tilde{\rho}_i} ^ 2 + \frac{16 \log \frac{4(K + 1)}{\delta}}{\sum_{\tau = 1} ^ {T} \cP_{\tau, i}}} \\
    &= \sum_{i \in \cI} \sum_{t = 1} ^ {T} \cP_{t, i} \bigc{z_{i} - \tilde{\rho}_{i}} ^ 2 + 16 \log \frac{4(K+1)}{\delta}\abs{\cI} + \\
    &\hspace{45mm} 2 \sum_{i \in \cI} \sqrt{\log \frac{4 (K + 1)}{\delta}\sum_{\tau = 1} ^ {T} \cP_{\tau, i}} \bigc{\bigc{z_{i} - \tilde{\rho}_i} ^ 2 +  \frac{16 \log \frac{4(K+1)}{\delta}}{\sum_{\tau = 1} ^ {T} \cP_{\tau, i}}} \\
    & \le \sum_{i \in \cI} \sum_{t = 1} ^ {T} \cP_{t, i} \bigc{z_{i} - \tilde{\rho}_{i}} ^ 2 + 16 \log \frac{4(K+1)}{\delta}\abs{\cI} + 2 \sum_{i \in \cI} \sum_{\tau = 1} ^ {T} \cP_{\tau, i} \bigc{\bigc{z_{i} - \tilde{\rho}_i} ^ 2 +  \frac{16 \log \frac{4(K+1)}{\delta}}{\sum_{\tau = 1} ^ {T} \cP_{\tau, i}}} \\
    &=  3\sum_{i \in \cI} \sum_{t = 1} ^ {T} \cP_{t, i} \bigc{z_{i} - \tilde{\rho}_{i}} ^ 2 + 48 \log \frac{4(K+1)}{\delta}\abs{\cI},
\end{align*}
where the first inequality follows by substituting the bounds from \eqref{eq:final_bound_rho_tilde_rho}, \eqref{eq:final_bound_diff_p_ind}, while the final inequality follows since by the definition of $\cI$ in \eqref{eq:defintion_I}, we have $\sqrt{\log \frac{4(K + 1)}{\delta} \sum_{\tau = 1} ^ {T} \cP_{\tau, i}} \le \sum_{\tau = 1} ^ {T} \cP_{\tau, i}$. Next, we bound $\cT_{2}$ as \begin{align*}
    \cT_{2} &\le \sum_{i \in \bar{\cI}} \bigc{2\sum_{t = 1} ^ {T} \cP_{t, i} + \log \frac{4 (K + 1)}{\delta}} \bigc{\bigc{z_{i} - \tilde{\rho}_i} ^ 2 + 1} \\
    &\le 2 \sum_{i \in \bar{\cI}} \sum_{t = 1} ^ {T} \cP_{t, i} \bigc{z_{i} - \tilde{\rho}_i}^2 + 2 \sum_{i \in \bar{\cI}} \sum_{t = 1} ^ {T} \cP_{t, i} + 2 \log \frac{4 (K + 1)}{\delta} \abs{\bar{\cI}} \\
    & \le 2 \sum_{i \in \bar{\cI}} \sum_{t = 1} ^ {T} \cP_{t, i} \bigc{z_{i} - \tilde{\rho}_i}^2 + 4 \log \frac{4 (K + 1)}{\delta} \abs{\bar{\cI}},
\end{align*}
where the first inequality follows by substituting the bounds from \eqref{eq:final_bound_rho_tilde_rho}, \eqref{eq:final_bound_diff_p_ind}; the second inequality follows by bounding $(z_{i} - \tilde{\rho}_i)^2 \le 1$; the final inequality follows from the definition of $\cI$ \eqref{eq:defintion_I}.
Collecting the bounds on $\cT_{1}$ and $\cT_{2}$, we obtain \begin{align*}
    \cT_{1} + \cT_{2} &\le 3 \sum_{i = 0} ^ {K} \sum_{t = 1} ^ {T} \cP_{t, i} \bigc{z_{i} - \tilde{\rho}_{i}} ^ 2 + 48 \log \frac{4(K+1)}{\delta}\abs{\cI} + 4 \log \frac{4 (K + 1)}{\delta} \abs{\bar{\cI}} \\
    &\le 3 \pcal_{2} + 48 (K + 1)\log \frac{4(K + 1)}{\delta},
\end{align*}
where the last inequality follows from the definition of $\pcal_{2}$ and since $\abs{\cI} + \abs{\bar{\cI}} = K + 1$. Since $\cal_{2} \le 2(\cT_{1} + \cT_{2})$, we have shown that \begin{align}\label{eq:hp_bound_cal_2}
    \cal_{2} \le 6 \pcal_{2} + 96 (K + 1)\log \frac{4(K + 1)}{\delta}
\end{align}
with probability at least $1 - \delta$. This completes the proof.
\end{proof}

\subsection{Proof of Corollary \ref{cor:cal_2_hp_bound}}
 \begin{proof}
Since Algorithm \ref{alg:BM_log_loss} ensures that $\pcal_{2} = \cO\bigc{\frac{T}{K ^ {2}} + K \log T}$ (refer Section \ref{sec:pseudo-KL-Cal}), we obtain \begin{align*}
    \cal_{2} = \cO\bigc{\frac{T}{K ^ {2}} + K \log T + K \log \frac{K}{\delta}}
\end{align*}
with probability at least $1 - \delta$, which is $\cO\bigc{\frac{T ^ {\frac{1}{3}}}{(\log T) ^ {\frac{1}{3}}} \log \frac{T}{\delta}}$ on substituting $K$. The high probability bound on $\msr_{\cL_{G}}$ follows since $\msr_{\cL_{G}} \le G \cdot \cal_{2}$. To bound $\mathbb{E}\bigs{\cal_{2}}$, we let $\cE$ denote the event that $\cal_{2} \le \Delta$, where $\Delta \coloneqq 6 \pcal_{2} + 96 (K + 1) \log \frac{4(K + 1)}{\delta}$. We then have, \begin{align*}
    \mathbb{E}[\cal_{2}] = \mathbb{E}[\cal_{2} | \cE]\cdot \mathbb{P}(\cE) + \mathbb{E}[\cal_{2} | \bar{\cE}] \cdot \mathbb{P}(\bar{\cE}) = \cO\bigc{\frac{T}{K ^ 2} + K \log T + K\log \frac{K}{\delta} + \delta \cdot T}
\end{align*}
which is $\cO(T^{\frac{1}{3}} (\log T)^{\frac{2}{3}})$ on substituting $\delta = \frac{1}{T}$ and $K$. Note that the second equality above follows since $\mathbb{E}[\cal_{2} | \cE] \le \Delta$ and $\mathbb{P}(\cE) \le 1$, $\cal_{2} \le T$ and $\mathbb{P}(\bar{\cE}) < \delta$. Finally, bounding $\msr_{\cL_{G}} \le G \cdot \cal_{2}$ finishes the proof.
\end{proof}
