\begin{document}

\begin{theorem} \label{thm:PARGS}
  \label{thm:full_for_partial}
  A value function $V$ trained to minimize the Bradley-Terry loss on partial sequences $\rvy^{1:\abs{\rvy}}$ \eqref{eq:partial-seq-objectives}  using full-sequence preference data $\rvy^{1:i}$, may prefer sub-optimal continuations at decoding.
\end{theorem}

\begin{proof}
    Let $r_\phi$ be the full sequence reward model, $\mathbf{V}_{\theta}$ be the partial sequence reward model and $\rvy^{(p)} = y_1, \cdots, y_{i-1}$ be a partial sequence following the prompt $\rvx$. Suppose that $\rvs^* = \rvx, \rvy^{(p)}, y^*_{i}, y^*_{i+1}, \cdots, y^*_{n}$ is the optimal full sequence extended from ${\rvx, \rvy^{(p)}}$. Let $\rvs^{**} = \rvx, \rvy^{(p)}, y^*_{i}, y^{**}_{i+1} \cdots, y^{**}_{n}$ be a sequence extended from ${\rvx, \rvy^{(p)}, y^*_{i}}$ and $\rvs' = \rvx, \rvy^{(p)}, y'_{i}, y'_{i+1} \cdots, y'_{n}$: be a sequence extended from ${\rvx, \rvy^{(p)}}$. Suppose that $\mathcal{P} = \{\rvs^{**}, \rvs'\}$ is a pair in the preference dataset. 

    Suppose $r_{\phi}(s^*)=6, \:r_{\phi}(s^{**})=-6, \:r_{\phi}(s')=5$, then $\rvs'$ is the winning sequence in $\mathcal{P}$. By the assumption that "the prefixes of a winning full sequence is also wining against the prefix of the corresponding losing full sequence", partial sequence $(\rvx, \rvy^{p}, y'_{i})$ is also winning $(\rvx, \rvy^{p}, y^*_{i})$.  Following the Bradley-Terry loss, we maximize
$$
\begin{aligned}
     \log \sigma \left( \mathbf{V}_{\theta} (\rvy^{(p)}, y'_{i}|\rvx) - \mathbf{V}_{\theta} (\rvy^{(p)}, y^*_{i}|\rvx)\right)
\end{aligned}
$$
That is, $\mathbf{V}_{\theta} (\rvy^{(p)}, y'_{i}|\rvx) - \mathbf{V}_{\theta} (\rvy^{(p)}, y^*_{i}|\rvx)$ is maximized results in $\mathbf{V}_{\theta} (\rvy^{(p)}, y'_{i}|\rvx) > \mathbf{V}_{\theta} (\rvy^{(p)}, y^*_{i}|\rvx)$

Next, suppose $\piref(y^{*}|\rvx, \rvy^{(p)}) = \piref(y'|\rvx, \rvy^{(p)}) = \frac{1}{2}$, at inference time we follow the policy:
$$ 
\begin{aligned}
&\pi(y_{i} \vert \rvx,\rvy^{(p)}) \propto \piref(y_{i} \vert \rvx,\rvy^{(p)}) \exp(\beta \mathbf{V}_{\theta}(\rvy^{(p)}, y_{i} \vert \rvx))\\
\Rightarrow ~~ &\pi(y'_{i} \vert \rvx,\rvy^{(p)}) > \pi(y^{*}_{i} \vert \rvx,\rvy^{(p)})
\end{aligned}
$$

Again, following $\pi$ would generate $y'_{i}$ which is sub-optimal.
\end{proof}
    
\end{document}