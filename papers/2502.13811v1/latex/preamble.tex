\usepackage{booktabs}
\usepackage{siunitx}
\usepackage{multirow}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xspace}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{comment}
\usepackage{listings}
\usepackage{changepage}
\usepackage[flushleft]{threeparttable}
\usepackage{bbm}
\usepackage{xfp}
\usepackage[hidelinks,colorlinks,citecolor=blue]{hyperref}
\usepackage[labelfont=bf,font=small]{caption}
\usepackage{tikz}
\usepackage{circledsteps}
\usepackage{adjustbox}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{booktabs}

\DeclareRobustCommand{\circled}[2]{\tikz[baseline=(char.base)]{\node[shape=circle, draw, inner sep=1pt, scale=0.825, fill=#2] (char) {#1};}}

\newcommand{\BetterCircled}[1]{%
    \Circled{\footnotesize\sffamily #1}%
}

\newcommand\independent{\protect\mathpalette{\protect\independenT}{\perp}}
\def\independenT#1#2{\mathrel{\rlap{$#1#2$}\mkern2mu{#1#2}}}

\usepackage{amsthm}
\usepackage{thmtools}
\usepackage{cleveref}
\DeclareTextSymbolDefault{\ohorn}{T5}
\DeclareTextSymbolDefault{\uhorn}{T5}

\crefname{section}{\S}{\S\S}
\Crefname{section}{\S}{\S\S}
\crefname{table}{Tab.}{}
\crefname{figure}{Fig.}{}
\crefname{algorithm}{Algorithm}{}
\crefname{equation}{eq.}{eqs.}
\crefname{appendix}{App.}{}
\crefname{thm}{Theorem}{Theorems}
\crefname{tcb@cnt@theorem}{Theorem}{Theorems}
\crefname{prop}{Proposition}{Propositions}
\crefname{tcb@cnt@proposition}{Proposition}{Propositions}
\crefname{cor}{Corollary}{Corollaries}
\crefname{tcb@cnt@corollary}{Corollary}{Corollaries}
\crefname{observation}{Observation}{Observations}
\crefname{assumption}{Assumption}{Assumptions}
\crefformat{section}{\S#2#1#3}
\crefname{theorem}{Thm.}{Thms.}
\crefname{corollary}{Cor.}{Cors.}
\crefname{proposition}{Prop.}{Props.}


\usepackage{bm}
\usepackage{fix-cm}
\usepackage{amssymb}
\usepackage{subcaption}


\usepackage{enumerate}
\usepackage[shortlabels]{enumitem}
\usepackage{bbm}

\usepackage{todonotes}

\usepackage[most]{tcolorbox}


\tcbset {
  base/.style={
    arc=0mm, 
    bottomtitle=0.5mm,
    boxrule=0mm,
    colbacktitle=black!10!white, 
    coltitle=black, 
    fonttitle=\bfseries, 
    left=2.5mm,
    leftrule=1mm,
    right=3.5mm,
    title={#1},
    toptitle=0.75mm, 
    breakable,
  }
}

\definecolor{brandblue}{rgb}{0.34, 0.7, 1}
\tcbset {
  mainbox/.style={
    colframe=black!30!white,
    base={#1}
  }
}

\tcbset {
  subbox/.style={
    colframe=black!30!white,
    base={#1}
  }
}





\makeatletter
\newcommand*\iftodonotes{\if@todonotes@disabled\expandafter\@secondoftwo\else\expandafter\@firstoftwo\fi}  %
\makeatother
\newcommand{\noindentaftertodo}{\iftodonotes{\noindent}{}}
\newcommand{\fixme}[2][]{\todo[color=yellow,size=\scriptsize,fancyline,caption={},#1]{#2}} %
\newcommand{\note}[4][]{\todo[author=#2,color=#3,size=\scriptsize,fancyline,caption={},#1]{#4}} %
\newcommand{\response}[1]{\vspace{3pt}\hrule\vspace{3pt}\textbf{#1:} }

\newcommand{\notewho}[3][]{\note[#1]{#2}{blue!40}{#3}}     %
\newcommand{\Fixme}[2][]{\fixme[inline,#1]{#2}\noindentaftertodo}
\newcommand{\Notewho}[3][]{\notewho[inline,#1]{#2}{#3}\noindentaftertodo}
\definecolor{dandelion}{HTML}{FFD464}
\definecolor{limegreen}{HTML}{32CD32}
\newcommand{\lucas}[2][]{\note[#1]{lucas}{dandelion!60}{#2}}
\newcommand{\Lucas}[2][]{\lucas[inline,#1]{#2}\noindentaftertodo}

\newcommand{\hunter}[2][]{\note[#1]{hunter}{blue!30}{#2}}
\newcommand{\Hunter}[2][]{\hunter[inline,#1]{#2}\noindentaftertodo}

\newcommand{\yoon}[2][]{\note[#1]{yoon}{purple!60}{#2}}
\newcommand{\Yoon}[2][]{\yoon[inline,#1]{#2}\noindentaftertodo}

\newcommand{\han}[2][]{\note[#1]{han}{green!60}{#2}}
\newcommand{\Han}[2][]{\hunter[inline,#1]{#2}\noindentaftertodo}

\DeclareMathOperator*{\argmax}{argmax}
\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathOperator*{\argsup}{argsup}
\DeclareMathOperator*{\arginf}{arginf}
\DeclareMathOperator*{\Expect}{\mathbb{E}}
\DeclareMathOperator{\expect}{\mathbb{E}}
\DeclareMathOperator*{\Cov}{\text{Cov}}
\DeclareMathOperator{\cov}{\text{Cov}}
\DeclareMathOperator*{\Otimes}{\otimes}
\DeclareMathOperator*{\Oplus}{\oplus}
\DeclareMathOperator*{\Var}{\text{Var}}
\DeclareMathOperator{\var}{\text{Var}}





\newcommand{\needref}{({\color{orange} ref})}
\newcommand{\needcite}{({\color{red} cite})}
\newcommand{\needcitefor}[1]{({\color{red} #1})}
\newcommand{\fillin}{({\color{blue} fill-in})}
\newcommand{\fillinwith}[1]{({\color{blue} #1})}
\newcommand{\defn}[1]{\textbf{#1}}

\newtheorem{theorem}{Theorem}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{definition}{Definition}
\newtheorem{example}{Example}
\theoremstyle{remark}
\newtheorem*{remark}{Remark}
\newcommand{\diag}{\operatorname{diag}}
\newcommand{\kron}{\otimes}
\newcommand{\hadamard}{\circ}
\DeclareMathOperator{\mkvec}{vec}
\newcommand{\detbar}[1]{\left\vert#1\right\vert}
\newcommand{\inv}{^{-1}}
\newcommand{\defeq}{\stackrel{\rm def}{=}}
\newcommand{\Exp}{\mathbb{E}}

\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\SetSize}[1]{\lvert #1\rvert}
\def\calA{{\mathcal{A}}}
\def\calB{{\mathcal{B}}}
\def\calC{{\mathcal{C}}}
\def\calD{{\mathcal{D}}}
\def\calF{{\mathcal{F}}}
\def\calG{{\mathcal{G}}}
\def\calH{{\mathcal{H}}}
\def\calI{{\mathcal{I}}}
\def\calJ{{\mathcal{J}}}
\def\calK{{\mathcal{K}}}
\def\calL{{\mathcal{L}}}
\def\calM{{\mathcal{M}}}
\def\calN{{\mathcal{N}}}
\def\calO{{\mathcal{O}}}
\def\calP{{\mathcal{P}}}
\def\calQ{{\mathcal{Q}}}
\def\calR{{\mathcal{R}}}
\def\calS{{\mathcal{S}}}
\def\calT{{\mathcal{T}}}
\def\calU{{\mathcal{U}}}
\def\calV{{\mathcal{V}}}
\def\calW{{\mathcal{W}}}
\def\calX{{\mathcal{X}}}
\def\calY{{\mathcal{Y}}}
\def\calZ{{\mathcal{Z}}}
\def\dtrain{{\sD_\textrm{train}}}
\def\dtest{{\sD_\textrm{test}}}

\def\vzero{{\mathbf{0}}}
\def\vone{{\mathbf{1}}}
\def\va{{\mathbf{a}}}
\def\vb{{\mathbf{b}}}
\def\vc{{\mathbf{c}}}
\def\vd{{\mathbf{d}}}
\def\ve{{\mathbf{e}}}
\def\vf{{\mathbf{f}}}
\def\vg{{\mathbf{g}}}
\def\vh{{\mathbf{h}}}
\def\vi{{\mathbf{i}}}
\def\vj{{\mathbf{j}}}
\def\vk{{\mathbf{k}}}
\def\vl{{\mathbf{l}}}
\def\vm{{\mathbf{m}}}
\def\vn{{\mathbf{n}}}
\def\vo{{\mathbf{o}}}
\def\vp{{\mathbf{p}}}
\def\vq{{\mathbf{q}}}
\def\vr{{\mathbf{r}}}
\def\vs{{\mathbf{s}}}
\def\vt{{\mathbf{t}}}
\def\vu{{\mathbf{u}}}
\def\vv{{\mathbf{v}}}
\def\vw{{\mathbf{w}}}
\def\vx{{\mathbf{x}}}
\def\vy{{\mathbf{y}}}
\def\vz{{\mathbf{z}}}
\def\vtheta{{\boldsymbol{\theta}\xspace}}
\def\vlambda{{\boldsymbol{\lambda}\xspace}}
\def\vmu{{\boldsymbol{\mu}\xspace}}
\def\vbeta{{\boldsymbol{\beta}\xspace}}
\def\vtau{{\boldsymbol{\tau}\xspace}}
\def\vnu{{\boldsymbol{\nu}\xspace}}
\def\vpi{{\boldsymbol{\pi}\xspace}}
\def\vphi{{\boldsymbol{\phi}\xspace}}

\newcommand{\Unsure}[1]{{\textcolor{red}{#1}}}

\newcommand{\Matrix}[1]{\mathbf{#1}}
\def\mA{{\Matrix{A}}}
\def\mB{{\Matrix{B}}}
\def\mC{{\Matrix{C}}}
\def\mD{{\Matrix{D}}}
\def\mE{{\Matrix{E}}}
\def\mF{{\Matrix{F}}}
\def\mG{{\Matrix{G}}}
\def\mH{{\Matrix{H}}}
\def\mI{{\Matrix{I}}}
\def\mJ{{\Matrix{J}}}
\def\mK{{\Matrix{K}}}
\def\mL{{\Matrix{L}}}
\def\mM{{\Matrix{M}}}
\def\mN{{\Matrix{N}}}
\def\mO{{\Matrix{O}}}
\def\mP{{\Matrix{P}}}
\def\mQ{{\Matrix{Q}}}
\def\mR{{\Matrix{R}}}
\def\mS{{\Matrix{S}}}
\def\mT{{\Matrix{T}}}
\def\mU{{\Matrix{U}}}
\def\mV{{\Matrix{V}}}
\def\mW{{\Matrix{W}}}
\def\mX{{\Matrix{X}}}
\def\mY{{\Matrix{Y}}}
\def\mZ{{\Matrix{Z}}}
\def\mPhi{{\boldsymbol{\Phi}\xspace}}
\def\mSigma{{\boldsymbol{\Sigma}\xspace}}
\def\mLambda{{\boldsymbol{\Lambda}\xspace}}

\newcommand{\gauss}{\mathcal{N}}
\newcommand{\tstudent}{\mathcal{T}}

\newcommand{\half}{\mbox{$\frac{1}{2}$}}
\newcommand{\real}{\mbox{$\mathbb{R}$}}
\newcommand{\indep}{\mbox{$\perp$}}
\newcommand{\given}{\mid}
\newcommand{\lra}{\mbox{$\leftrightarrow$}}
\newcommand{\Ra}{\mbox{$\Rightarrow$}}
\newcommand{\la}{\mbox{$\leftarrow$}}
\newcommand{\indicator}[1]{\mathbbm{1}_{#1}}
\newcommand{\order}[1]{\ensuremath{\mathcal{O}\left(#1\right)}}

\newcommand{\rnd}[1]{\left(#1\right)}
\newcommand{\sqr}[1]{\left[#1\right]}
\newcommand{\crl}[1]{\left\{#1\right\}}
\newcommand{\myang}[1]{\langle#1\rangle}
\renewcommand{\complement}[1]{{\overline{#1}}}



\def\defequals{\triangleq}


\renewcommand{\cot}[1]{\overline{#1}}
\newcommand{\ip}[2]{\langle #1, #2 \rangle}
\newcommand{\nullspace}[1]{\operatorname{null} #1}
\newcommand{\range}[1]{\operatorname{range} #1}
\newcommand{\norm}[1]{||#1||}
\newcommand{\Tr}{\text{Tr}}
\newcommand{\rank}{\text{rank}}
\newcommand{\detach}[1]{\text{detach}(#1)}
\newcommand{\paramStep}[2]{{#1}^{(#2)}}
\newcommand{\proj}[1]{{#1}_\text{proj}}
\newcommand{\vectext}{\operatorname{vec}}
\renewcommand{\vec}[1]{\vectext\left(#1\right)}
\newcommand{\vecinvtext}{\operatorname{vec}^{-1}}
\newcommand{\vecinv}[1]{\vecinvtext\left(#1\right)}


\newcommand{\galore}{GaLore\xspace}
\newcommand{\galora}{GaLoRA\xspace}
\newcommand{\XX}{\textcolor{red}{XX}\xspace}
\newcommand{\ourformer}{{GaLoRA}\xspace}
\newcommand{\qourformer}{{QGaLoRA}\xspace}
\newcommand{\tinyB}{200M\xspace}
\newcommand{\largeB}{1.3B\xspace}


\newcommand{\optimStateGeneral}{\xi}
\newcommand{\updateGeneral}{\Delta}
\newcommand{\optimState}[2]{\optimStateGeneral_{#1}^{(#2)}}
\newcommand{\update}[2]{\updateGeneral_{#1}^{(#2)}}
\newcommand{\param}[2]{{#1}^{(#2)}}
\newcommand{\grad}[2]{{\cot{#1}}^{(#2)}}
\newcommand{\projoptimState}[2]{\hat{\xi}_{#1}^{(#2)}}
\newcommand{\projupdate}[2]{\hat{\Delta}_{#1}^{(#2)}}

\newcommand{\optimStateW}[1]{\optimState{W}{#1}}
\newcommand{\updateW}[1]{\update{W}{#1}}
\newcommand{\paramW}[1]{\param{W}{#1}}
\newcommand{\gradW}[1]{\grad{W}{#1}}
\newcommand{\projoptimStateW}[1]{\projoptimState{W}{#1}}
\newcommand{\projupdateW}[1]{\projupdate{W}{#1}}

\newcommand{\optimStateA}[1]{\optimState{A}{#1}}
\newcommand{\updateA}[1]{\update{A}{#1}}
\newcommand{\paramA}[1]{\param{A}{#1}}
\newcommand{\gradA}[1]{\grad{A}{#1}}
\newcommand{\projoptimStateA}[1]{\projoptimState{A}{#1}}
\newcommand{\projupdateA}[1]{\projupdate{A}{#1}}


\newcommand{\optimStateT}[1]{\optimState{\Theta}{#1}}
\newcommand{\updateT}[1]{\update{\Theta}{#1}}
\newcommand{\paramT}[1]{\param{\Theta}{#1}}
\newcommand{\gradT}[1]{\grad{\Theta}{#1}}
\newcommand{\projoptimStateT}[1]{\projoptimState{\Theta}{#1}}
\newcommand{\projupdateT}[1]{\projupdate{\Theta}{#1}}


\newcommand{\optimStateTprime}[1]{\optimState{\Theta'}{#1}}
\newcommand{\updateTprime}[1]{\update{\Theta'}{#1}}
\newcommand{\paramTprime}[1]{\param{\Theta'}{#1}}
\newcommand{\gradTprime}[1]{\grad{\Theta'}{#1}}
\newcommand{\projoptimStateTprime}[1]{\projoptimState{\Theta'}{#1}}
\newcommand{\projupdateTprime}[1]{\projupdate{\Theta'}{#1}}


\newcommand{\X}[1]{X^{(#1)}}
\newcommand{\Y}[1]{Y^{(#1)}}
\newcommand{\Ylora}{Y_\lora}
\newcommand{\adj}{\top}

\newcommand{\lora}{\text{LoRA}\xspace}
\newcommand{\Ind}[1]{\mathbbm{1}\{#1\}}
\renewcommand{\P}{\mathbb{P}}

\newcommand{\gradLoss}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\gradLossft}[1]{\gradLoss{L(f^{(t)})}{#1}}
\newcommand{\gradLossftilt}[1]{\gradLoss{L(\tilde f^{(t)})}{#1}}

\newcommand{\optimizer}{\operatorname{Optimizer}}
\newcommand{\optimizerUpdate}{\optimizer_\updateGeneral}
\newcommand{\optimizerState}{\optimizer_\optimStateGeneral}

\newcommand{\linearMap}[1]{{\mathbf{#1}}}
\newcommand{\Loss}{\calL}

\sisetup{
  round-mode = places,
  round-precision = 2,
  table-format = 2.2
}

\DeclareSIUnit\gigabyte{GB}


\newcommand{\gb}[1]{\num[round-mode=places, round-precision=2]{\fpeval{#1/1e9}}}


\newcommand{\vcram}[1]{}
