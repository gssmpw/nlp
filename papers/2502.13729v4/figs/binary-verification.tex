% \tikzset{cross/.style={cross out, draw=orange, fill=none}, cross/.default={2pt}}
\begin{tikzpicture}[node distance=1.4em,font=\fontsize{8pt}{8pt}\selectfont]
    % RNN
    \node[rounded rectangle,draw,align=center] (RNN1) at (0,0) {SSM\\or\\RNN};
    \node[rounded rectangle,draw,right=of RNN1,align=center] (RNN2) {SSM\\or\\RNN};
    \node[rounded rectangle,draw,right=of RNN2,align=center] (RNN3) {SSM\\or\\RNN};
    \node[right=of RNN3] (RNN_dots) {$\cdots$};
    \node[rounded rectangle,draw,right=of RNN_dots,align=center] (RNN4) {SSM\\or\\RNN};
    \node[rounded rectangle,draw,right=of RNN4,align=center] (RNN5) {SSM\\or\\RNN};
    % \node[right=of RNN5] (RNN_dots2) {$\cdots$};
    \node[rounded rectangle,draw,right=of RNN5,align=center] (RNN6) {SSM\\or\\RNN};
    \node[rounded rectangle,draw,right=of RNN6,align=center] (RNN7) {SSM\\or\\RNN};
    \node[right=of RNN7] (RNN_dots2) {$\cdots$};
    \node[rounded rectangle,draw,right=of RNN_dots2,align=center] (RNN8) {SSM\\or\\RNN};
    \draw[->,ultra thick] (RNN1) -- (RNN2);
    \draw[->,ultra thick] (RNN2) -- (RNN3);
    \draw[->,ultra thick] (RNN3) -- (RNN_dots);
    \draw[->,ultra thick] (RNN_dots) -- (RNN4);
    \draw[->,ultra thick] (RNN4) -- (RNN5);
    \draw[->,ultra thick] (RNN7) -- (RNN_dots2);
    \draw[->,ultra thick] (RNN_dots2) -- (RNN8);
    \draw[->,ultra thick] (RNN6) -- (RNN7);
    \draw[->,ultra thick] (RNN5) -- (RNN6);
    % % Embedding
    % % t=1
    % \node[below=1.5em of RNN1,rectangle,fill=black!6.3822,minimum size=0.025em] (embed1_1) {};
    %     \node[anchor=north,rectangle,fill=black!71.1932,minimum size=0.025em] (embed1_2) at (embed1_1.south) {};
    %     % \node[anchor=north,rectangle,minimum size=0.05em] (embed1_3) at (embed1_2.south) {\scalebox{0.5}{$\mathbb{\vdots}$}};
    %     \node[anchor=north,rectangle,fill=black!28.4883,minimum size=0.05em,yshift=-0.5em] (embed1_4) at (embed1_2.south) {};
    %     \draw[densely dotted,thick] (embed1_2.south) -- (embed1_4.north);
    %     \draw[violet,ultra thick] (embed1_1.north west) rectangle (embed1_4.south east);
    % % t=2
    % \node[below=1.5em of RNN2,rectangle,fill=black!43.4254,minimum size=0.025em] (embed2_1) {};
    %     \node[anchor=north,rectangle,fill=black!28.9347,minimum size=0.025em] (embed2_2) at (embed2_1.south) {};
    %     % \node[anchor=north,rectangle,minimum size=0.05em] (embed2_3) at (embed2_2.south) {\scalebox{0.5}{$\mathbb{\vdots}$}};
    %     \node[anchor=north,rectangle,fill=black!99.3098,minimum size=0.05em,yshift=-0.5em] (embed2_4) at (embed2_2.south) {};
    %     \draw[densely dotted,thick] (embed2_2.south) -- (embed2_4.north);
    %     \draw[violet,ultra thick] (embed2_1.north west) rectangle (embed2_4.south east);
    % % t=3
    % \node[below=1.5em of RNN3,rectangle,fill=black!13.5946,minimum size=0.025em] (embed3_1) {};
    %     \node[anchor=north,rectangle,fill=black!78.9994,minimum size=0.025em] (embed3_2) at (embed3_1.south) {};
    %     % \node[anchor=north,rectangle,minimum size=0.05em] (embed3_3) at (embed3_2.south) {\scalebox{0.5}{$\mathbb{\vdots}$}};
    %     \node[anchor=north,rectangle,fill=black!5.0599,minimum size=0.05em,yshift=-0.5em] (embed3_4) at (embed3_2.south) {};
    %     \draw[densely dotted,thick] (embed3_2.south) -- (embed3_4.north);
    %     \draw[violet,ultra thick] (embed3_1.north west) rectangle (embed3_4.south east);
    % % dots
    % \node[] (embed_dots) at (RNN_dots|-embed1_2.south) {$\cdots$};
    % % t=4
    % \node[below=1.5em of RNN4,rectangle,fill=black!24.0146,minimum size=0.025em] (embed4_1) {};
    %     \node[anchor=north,rectangle,fill=black!44.4282,minimum size=0.025em] (embed4_2) at (embed4_1.south) {};
    %     % \node[anchor=north,rectangle,minimum size=0.05em] (embed4_3) at (embed4_2.south) {\scalebox{0.5}{$\mathbb{\vdots}$}};
    %     \node[anchor=north,rectangle,fill=black!15.9579,minimum size=0.05em,yshift=-0.5em] (embed4_4) at (embed4_2.south) {};
    %     \draw[densely dotted,thick] (embed4_2.south) -- (embed4_4.north);
    %     \draw[violet,ultra thick] (embed4_1.north west) rectangle (embed4_4.south east);
    % % t=5
    % \node[below=1.5em of RNN5,rectangle,fill=black!13.5946,minimum size=0.025em] (embed5_1) {};
    %     \node[anchor=north,rectangle,fill=black!78.9994,minimum size=0.025em] (embed5_2) at (embed5_1.south) {};
    %     % \node[anchor=north,rectangle,minimum size=0.05em] (embed5_3) at (embed5_2.south) {\scalebox{0.5}{$\mathbb{\vdots}$}};
    %     \node[anchor=north,rectangle,fill=black!5.0599,minimum size=0.05em,yshift=-0.5em] (embed5_4) at (embed5_2.south) {};
    %     \draw[densely dotted,thick] (embed5_2.south) -- (embed5_4.north);
    %     \draw[blue,ultra thick] (embed5_1.north west) rectangle (embed5_4.south east);
    % % dots2
    % \node[] (embed_dots2) at (RNN_dots2|-embed1_2.south) {$\cdots$};
    % % t=6
    % \node[below=1.5em of RNN6,rectangle,fill=black!33.8048,minimum size=0.025em] (embed6_1) {};
    %     \node[anchor=north,rectangle,fill=black!17.7876,minimum size=0.025em] (embed6_2) at (embed6_1.south) {};
    %     % \node[anchor=north,rectangle,minimum size=0.05em] (embed6_3) at (embed6_2.south) {\scalebox{0.5}{$\mathbb{\vdots}$}};
    %     \node[anchor=north,rectangle,fill=black!42.1924,minimum size=0.05em,yshift=-0.5em] (embed6_4) at (embed6_2.south) {};
    %     \draw[densely dotted,thick] (embed6_2.south) -- (embed6_4.north);
    %     \draw[orange,ultra thick] (embed6_1.north west) rectangle (embed6_4.south east);
    % % t=7
    % \node[below=1.5em of RNN7,rectangle,fill=black!24.0146,minimum size=0.025em] (embed7_1) {};
    %     \node[anchor=north,rectangle,fill=black!44.4282,minimum size=0.025em] (embed7_2) at (embed7_1.south) {};
    %     % \node[anchor=north,rectangle,minimum size=0.05em] (embed7_3) at (embed7_2.south) {\scalebox{0.5}{$\mathbb{\vdots}$}};
    %     \node[anchor=north,rectangle,fill=black!15.9579,,minimum size=0.05em,yshift=-0.5em] (embed7_4) at (embed7_2.south) {};
    %     \draw[densely dotted,thick] (embed7_2.south) -- (embed7_4.north);
    %     \draw[blue,ultra thick] (embed7_1.north west) rectangle (embed7_4.south east);
    % % t=8
    % \node[below=1.5em of RNN8,rectangle,fill=black!36.3285,minimum size=0.025em] (embed8_1) {};
    %     \node[anchor=north,rectangle,fill=black!60.9385,minimum size=0.025em] (embed8_2) at (embed8_1.south) {};
    %     % \node[anchor=north,rectangle,minimum size=0.05em] (embed8_3) at (embed8_2.south) {\scalebox{0.5}{$\mathbb{\vdots}$}};
    %     \node[anchor=north,rectangle,fill=black!68.8193,minimum size=0.05em,yshift=-0.5em] (embed8_4) at (embed8_2.south) {};
    %     \draw[densely dotted,thick] (embed8_2.south) -- (embed8_4.north);
    %     \draw[orange,ultra thick] (embed8_1.north west) rectangle (embed8_4.south east);
    % \draw[->,ultra thick,violet] (embed1_1) -- (RNN1);
    % \draw[->,ultra thick,violet] (embed2_1) -- (RNN2);
    % \draw[->,ultra thick,violet] (embed3_1) -- (RNN3);
    % \draw[->,ultra thick,violet] (embed4_1) -- (RNN4);
    % \draw[->,ultra thick,blue] (embed5_1) -- (RNN5);
    % \draw[->,ultra thick,orange] (embed6_1) -- (RNN6);
    % \draw[->,ultra thick,blue] (embed7_1) -- (RNN7);
    % \draw[->,ultra thick,orange] (embed8_1) -- (RNN8);
    % Embedding layer
    \path let \p1=(RNN1.west), \p2=(RNN8.east) in (RNN1) to (RNN8)
        node[anchor=west, minimum width=\x2-\x1+0.5em, rounded rectangle, draw,yshift=-2em] (embed_layer)
        at (RNN1.west|-RNN8.south)%embed8_4.south)
        {Embedding};
    \draw[->,ultra thick,violet] (RNN1|-embed_layer.north) -- (RNN1);%(embed1_4);
    \draw[->,ultra thick,violet] (RNN2|-embed_layer.north) -- (RNN2);%(embed2_4);
    \draw[->,ultra thick,violet] (RNN3|-embed_layer.north) -- (RNN3);%(embed3_4);
    \draw[->,ultra thick,violet] (RNN4|-embed_layer.north) -- (RNN4);%(embed4_4);
    \draw[->,ultra thick,blue] (RNN5|-embed_layer.north) -- (RNN5);%(embed5_4);
    \draw[->,ultra thick,orange] (RNN6|-embed_layer.north) -- (RNN6);%(embed6_4);
    \draw[->,ultra thick,blue] (RNN7|-embed_layer.north) -- (RNN7);%(embed7_4);
    \draw[->,ultra thick,orange] (RNN8|-embed_layer.north) -- (RNN8);%(embed8_4);
    % inputs
    \node[yshift=-2em,text=violet] (input1) at (RNN1|-embed_layer.south) {8};
    \node[text=violet] (input2) at (RNN2|-input1) {29};
    \node[text=violet] (input3) at (RNN3|-input1) {2};
    \node[text=violet] (input_dots) at (RNN_dots|-input1) {$\cdots$};
    \node[text=violet] (input4) at (RNN4|-input1) {11};
    \node[text=blue] (input5) at (RNN5|-input1) {2};
    \node[text=blue] (input_dots2) at (RNN_dots2|-input1) {$\cdots$};
    \node[text=blue,shape=cross out,draw=orange,thick] (input6) at (RNN6|-input1) {8};
    \node[text=orange,anchor=north] (input6other) at (input6.south) {17};
    \node[text=blue] (input7) at (RNN7|-input1) {11};
    \node[text=blue,shape=cross out,draw=orange,thick] (input8) at (RNN8|-input1) {29};
    \node[text=orange,anchor=north] (input8other) at (input8.south) {34};
    \draw[->,ultra thick,violet] (input1) -- (RNN1|-embed_layer.south);
    \draw[->,ultra thick,violet] (input2) -- (RNN2|-embed_layer.south);
    \draw[->,ultra thick,violet] (input3) -- (RNN3|-embed_layer.south);
    \draw[->,ultra thick,violet] (input4) -- (RNN4|-embed_layer.south);
    \draw[->,ultra thick,blue] (input5) -- (RNN5|-embed_layer.south);
    \draw[->,ultra thick,orange] (input6) -- (RNN6|-embed_layer.south);
    \draw[->,ultra thick,blue] (input7) -- (RNN7|-embed_layer.south);
    \draw[->,ultra thick,orange] (input8) -- (RNN8|-embed_layer.south);
    \node[anchor=north west,align=center,text=violet] (input_ann) at (input1.south west) {\textbf{Study Items}\\(Non-Repeating Random Integers)};
    % Filler
    \node[anchor=north,align=center,text=orange,yshift=0.5em] (other) at (input6other.south-|input_dots2) {\textbf{Replacement w/ Distractors}\\(Random Non-Repeating Complements)};
    % Reaout layer
    \path let \p1=(RNN5.west), \p2=(RNN8.east) in (RNN5) to (RNN8)
        node[above=2em of RNN5.north west, anchor=west, minimum width=\x2-\x1+0.5em, rounded rectangle, draw] (readout_layer) {Linear$\to$Sigmoid};
    \draw[->,ultra thick,blue] (RNN5) -- (RNN5|-readout_layer.south);
    \draw[->,ultra thick,orange] (RNN6) -- (RNN6|-readout_layer.south);
    \draw[->,ultra thick,blue] (RNN7) -- (RNN7|-readout_layer.south);
    \draw[->,ultra thick,orange] (RNN8) -- (RNN8|-readout_layer.south);
    % output for palindrome
    \node[text=blue,yshift=2em] (sort5) at (RNN5|-readout_layer.north) {1};
    \node (sort_dots) at (RNN_dots2|-sort5) {$\cdots$};
    \node[text=orange] (sort6) at (RNN6|-sort5) {0};
    \node[text=blue] (sort7) at (RNN7|-sort5) {1};
    \node[text=orange] (sort8) at (RNN8|-sort5) {0};
    \draw[->,ultra thick,blue] (RNN5|-readout_layer.north) -- (sort5);
    \draw[->,ultra thick,orange] (RNN6|-readout_layer.north) -- (sort6);
    \draw[->,ultra thick,blue] (RNN7|-readout_layer.north) -- (sort7);
    \draw[->,ultra thick,orange] (RNN8|-readout_layer.north) -- (sort8);
    \node[anchor=south] (sort_ann) at (sort7.north) {\textbf{{\color{blue}{In\,Study\,Items\,(1)}} OR \color{orange}{Not\,(0)}}};
    \path let \p1=(input1.west), \p2=(input4.east) in (input1) to (input4)
        node[anchor=west, minimum width=\x2-\x1+1em, rounded rectangle, draw, dotted,thick,violet] (inputs) at (input1.west|-input4.east) {\phantom{M}};
    \path let \p1=(input5.west), \p2=(input8.east) in (input5) to (input8)
        node[anchor=west, minimum width=\x2-\x1+1em, rounded rectangle, draw, dotted,thick,blue] (shuffled) at (input5.west|-input8.east) {\phantom{M}};
    % \draw [decoration={brace,mirror,amplitude=0.5em},decorate,ultra thick,violet] (input1.south west) -- (input4.south east);
    % \draw [decoration={brace,mirror,amplitude=0.5em},decorate,ultra thick,violet] (input5.south west) -- (input8.south east);
    \draw[->,ultra thick,blue] (input4.south west) to [bend right=45] node [below,anchor=north west] {\textbf{Shuffle}} (input5.south east);
    \end{tikzpicture}