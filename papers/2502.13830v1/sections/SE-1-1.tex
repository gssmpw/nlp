%!TEX root = ../main.tex

\subsection{Converting $\mcal{K}$ to \textnormal{$\SimExt$}}
\label{sec:sim-less-to-sim:1-1}

In this part, we build the simulation-extractor $\SimExt$ as required by \Cref{lem:simext:closeness}. This eventually finishes the proof of \Cref{lem:simext:closeness}, which is the only left piece in the proof of 1-1 non-malleability of \Cref{protocol:BB-NMCom}. 


The existence of the desired $\SimExt$ relies on \Cref{pq:lem:small-tag:proof:se:proof:K,lem:Noisy-SimExt} that we established previously. Roughly speaking, we will use \Cref{lem:Noisy-SimExt} to convert the simulation-less extractor $\mcal{K}$ from \Cref{pq:lem:small-tag:proof:se:proof:K} to the desired $\SimExt$ satisfying the stipulated property in \Cref{lem:simext:closeness}. However, we remark that this must be done with proper choice of the parameters. In the following, we show how this can be done.

We first define machines $\mcal{K}'$ and $\mcal{G}'$, which are ``wrappers'' for the machines $\mcal{K}$ and $\mcal{G}_1$ in \Cref{pq:lem:small-tag:proof:se:proof:K}. These machines will help us set parameters properly so we can invoke \Cref{lem:Noisy-SimExt}:

\subpara{Machine $\mcal{G}'$:} it takes as input $(1^\secpar, 1^{\gamma^{-1}}, \msf{pref}')$ and proceeds as follows:
\begin{enumerate}
\item
Set $\epsilon\coloneqq 8\gamma$.
\item
Compute $\epsilon_1$ from $\epsilon$. Note that this can be done because \Cref{pq:lem:small-tag:proof:se:proof:K} stipulates the there is a noticeable $\epsilon_1 \le \epsilon$ that is efficiently computable from $\epsilon$.
\item
Run machine $\mcal{G}_1(1^\secpar, 1^{\epsilon_1^{-1}}, \msf{pref}')$ (as per \Cref{pq:lem:small-tag:proof:se:proof:K}) and output whatever it outputs.
\end{enumerate}

\subpara{Machine $\mcal{K}'$:} it takes as input $(1^\secpar,1^{\gamma^{-1}}, 1^{\zeta^{-1}},\msf{pref}')$ and proceeds as follows:
\begin{enumerate}
\item
Set $\epsilon\coloneqq 8\gamma$.
\item
Compute $\epsilon_1$ from $\epsilon$. Note that this can be done because \Cref{pq:lem:small-tag:proof:se:proof:K} stipulates the there is a noticeable $\epsilon_1 \le \epsilon$ that is efficiently computable from $\epsilon$.
\item
Set $\epsilon_2 \coloneqq \zeta$.
\item
Run machine $\mcal{K}(1^\secpar, 1^{\epsilon_1^{-1}}, 1^{\epsilon_2^{-1}}, \msf{pref}')$ (as per \Cref{pq:lem:small-tag:proof:se:proof:K}) and output whatever it outputs.
\end{enumerate}
In the following, we invoke \Cref{lem:Noisy-SimExt} with $\mcal{G}'$, $\mcal{K}'$, $(\msf{st}_{\mcal{M}}, \msf{st}_R, \tau,\eta,\msf{VI}_{\eta})$, $\tilde{\tau}$, and $\msf{val}(\tilde{\tau})$  playing the role of $\mcal{G}$,  $\mcal{K}$, $\rho_\secpar$, $z_\secpar$, and $s^*_{z_\secpar}$ respectively in \Cref{lem:Noisy-SimExt}. To do that, we first prove the  $\mcal{G}'$ and $\mcal{K}'$ indeed satisfy the conditions \Cref{item:s_star_or_bot,item:gamma_delta} in \Cref{lem:Noisy-SimExt}. 

\para{For \Cref{item:s_star_or_bot} in \Cref{lem:Noisy-SimExt}.} First, by \Cref{pq:lem:small-tag:proof:se:proof:K}, we know that the machine $\mcal{K}$ when invoked with parameters $(1^\secpar, 1^{\epsilon_1^{-1}}, 1^{\epsilon_2^{-1}}, \msf{pref}')$ outputs $\msf{val}(\tilde{\tau})$ with probability at most $\epsilon_2(\secpar) + \negl(\secpar)$. Since $\epsilon_2$ is set to $\zeta$ in machine $\mcal{K}'$, this implies that $\mcal{K}'$ outputs $\msf{val}(\tilde{\tau})$ with probability at most $\zeta(\secpar) + \negl(\secpar)$, satisfying \Cref{item:s_star_or_bot} in \Cref{lem:Noisy-SimExt}.

\para{For \Cref{item:gamma_delta} in \Cref{lem:Noisy-SimExt}.} First, we claim that if $\mcal{G}'(1^\secpar, 1^{\gamma^{-1}}, \msf{pref}')$ output $\tilde{d}  = \top$ with probability $8\gamma$, then it must hold that $p_\msf{pref}^{\msf{Sim}}[\epsilon_1] \ge \epsilon$, with the $\epsilon_1$ defined in $\mcal{G}'$. To see that, first notice that  
\begin{align*}
\Pr[\tilde{d} = \top ~:~ (\OUT, \tilde{d}) \la \mcal{G}'(1^\secpar, 1^{\gamma^{-1}}, \msf{pref}')] =
\Pr[\tilde{d} = \top ~:~ (\OUT, \tilde{d}) \la \mcal{G}_1(1^\secpar, 1^{\epsilon_1^{-1}}, \msf{pref}')] 
\end{align*}
where $\epsilon_1$ is defined in the description of $\mcal{G}'$. Thus, if the LHS of the above equation is greater than $8\gamma$, then it must hold that 
\begin{align*}
p_\msf{pref}^{\msf{Sim}}[\epsilon_1] = \Pr[\tilde{d} = \top ~:~ (\OUT, \tilde{d}) \la \mcal{G}_1(1^\secpar, 1^{\epsilon_1^{-1}}, \msf{pref}')] \ge 8\gamma = \epsilon. 
\end{align*}

Next, recall from \Cref{pq:lem:small-tag:proof:se:proof:K} that under the condition of $p_\msf{pref}^{\msf{Sim}}[\epsilon_1] \ge \epsilon$, it must hold that 
$$\Pr[\Val = \msf{val}(\tilde{\tau}) : \Val \gets \mcal{K}{(1^\secpar, 1^{\epsilon_1^{-1}},1^{\epsilon_2^{-1}}, \msf{pref}')}] \ge {\frac{\epsilon'(\secpar)-\epsilon_2(\secpar)}{\tilde{t}}},$$
where  $\epsilon' = \frac{\epsilon(\secpar)}{10t^2}$. Then, by definition of $\mcal{K}'$, it must hold that 
\begin{align*}
\Pr[\Val = \msf{val}(\tilde{\tau}) : \Val \gets \mcal{K}'{(1^\secpar, 1^{\gamma^{-1}},1^{\zeta^{-1}}, \msf{pref}')}] &= \Pr[\Val = \msf{val}(\tilde{\tau}) : \Val \gets \mcal{K}{(1^\secpar, 1^{\epsilon_1^{-1}},1^{\epsilon_2^{-1}}, \msf{pref}')}] \\ 
&\ge 
{\frac{\epsilon'(\secpar)-\epsilon_2(\secpar)}{\tilde{t}}}\\
& =
\delta(\secpar) - \frac{\zeta(\secpar)}{\tilde{t}}  \\ 
& \ge 
\delta(\secpar) - \zeta(\secpar) -\negl(\secpar),
\end{align*}
where we $\delta(\secpar) \coloneqq \frac{\epsilon'(\secpar)}{\tilde{t}}$ with $\epsilon' = \frac{\epsilon(\secpar)}{10t^2}$. (Also note that $\epsilon_2 = \zeta$ by definition of $\mcal{K}'$.)

The above shows that the \Cref{item:gamma_delta} in \Cref{lem:Noisy-SimExt} is satisfied.

\para{Invoking \Cref{lem:Noisy-SimExt}.} Since $\mcal{K}'$ and $\mcal{G}'$ satisfy the conditions in \Cref{lem:Noisy-SimExt}, we can invoke it to claim the existence of a machine $\SimExt$ such that
 for any noticeable $\epsilon(\secpar)$, there exists a noticeable $\gamma(\secpar) \le \epsilon(\secpar)$ such that
$$\{\SimExt(1^\secpar,1^{\epsilon^{-1}},\msf{pref}')\}_{\secpar \in \Naturals}
~\statind_{\epsilon}~ 
\{(\OUT, \msf{val}_{\tilde{d}}(\tilde{\tau}))~:~(\OUT,  \tilde{d})\leftarrow \mcal{G}'(1^\secpar,1^{\gamma^{-1}},\msf{pref}')\}_{\secpar \in \Naturals}.$$

Finally, recall that $\mcal{G}'(1^\secpar,1^{\gamma^{-1}},\msf{pref}')$ is identical to machine $\mcal{G}_1(1^\secpar,1^{\epsilon_1^{-1}},\msf{pref}')$ where $\epsilon_1 \le \epsilon (=8\gamma)$ is efficiently computable from $\gamma$ as in the description of $\mcal{G}'$. Thus, the above implies that: 
For any noticeable $\epsilon(\secpar)$, there exists a noticeable $\epsilon'(\secpar) \le 8 \epsilon(\secpar)$ that is efficiently computable from $\epsilon(\secpar)$, such that
$$\{\SimExt(1^\secpar,1^{\epsilon^{-1}},\msf{pref}')\}_{\secpar \in \Naturals}
~\statind_{\epsilon}~ 
\{(\OUT, \msf{val}_{\tilde{d}}(\tilde{\tau}))~:~(\OUT, \tilde{d})\leftarrow \mcal{G}_1(1^\secpar,1^{\epsilon'^{-1}},\msf{pref}')\}_{\secpar \in \Naturals},$$
which is exactly \Cref{lem:simext:closeness}.