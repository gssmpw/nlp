% !TEX root =  ../main.tex

\section{Stiefel manifold}\label{app:stiefel}
We now provide a short review of the Stiefel manifold, referring the interested reader to \citeSupp{absil2008optimizationSupp,boumal2023introductionSupp} for a comprehensive discussion.

Given $\ell, \, h \in \nat, \, h < \ell$, the Stiefel manifold is the set of $\ell \times h$ matrices with orthonormal columns, mathematically
\begin{equation}\label{eq:stiefel_manifold}
    \stiefel{\ell}{h} \coloneqq \{ \V \in \rmatdim \, \mid \, \V^\top\V = \identity_h \}\,.
\end{equation}
Consider the function $g: \rmatdim \rightarrow \sym{h}$, $g(\V) \coloneqq \V^\top \V - \identity^h$.
It is well-known that $g$ is a generating function for \stiefel{\ell}{h}, thus making it an embedded submanifold of $\rmatdim$, with dimension $\mathrm{dim}\, \rmatdim - \mathrm{dim}\, \sym{h} = \ell h - h(h+1)/2$.
Given a point of the manifold $\V$, the tangent space to \stiefel{\ell}{h} can be defined implicitly as the kernel of the differential of $g$ at $\V$,
\begin{equation}\label{eq:Stiefel_t_space}
    \tangentspace{\V}{\stiefel{\ell}{h}}\coloneqq \{ \G \in \rmatdim \, | \, \V^\top \G + \G^\top \V = 0 \}\,.
\end{equation}
We consider the Riemannian metric as the restriction of the Eucliden product between two matrices in $\rmatdim$ to $\stiefel{\ell}{h}$.
Accordingly, given $\mathbf{A}, \, \mathbf{B} \in \tangentspace{\V}{\stiefel{\ell}{h}}$, we have $\Eprod{\mathbf{A}}{\mathbf{B}}{\V}= \Tr \mathbf{A}^\top \mathbf{B}$.
The tangent space linearizes the manifold around $\V$, then, we can move away from $\V$ along the directions in \tangentspace{\V}{\stiefel{\ell}{h}}. 
However, to make such a movement smooth along the manifold, we employ the \emph{retraction map} $\Retr{}{\V}: \tangentspace{\V}{\stiefel{\ell}{h}} \rightarrow \stiefel{\ell}{h}$.
The retraction has to satisfy the following conditions
\begin{equation}
        \text{\emph{(i)}} \; \Retr{}{\V}{\zeros_{\ell \times h}}=\V, \quad \text{and} \quad \text{\emph{(ii)}} \; \lim_{\G \rightarrow \zeros_{\ell \times h}} \frac{\frob{\Retr{}{\V}{\G} - (\V + \G)}}{\frob{\G}} = 0\,.
\end{equation}

Among the canonical retractions, we have 
\begin{equation}\label{eq:stiefel_retractions}
    \begin{aligned}
        \Retr{\mathrm{QR}}{\V}{\G} &= \mathrm{qf}(\V + \G)\,, \quad \text{[QR retraction]}\\
        \Retr{\mathrm{Polar}}{\V}{\G} &= (\V + \G)(\identity^h - \V^\top \V)^{\frac{1}{2}}\,, \quad \text{[Polar retraction]}\\
        \Retr{\mathrm{Caley}}{\V}{\G} &= (\identity^\ell -\frac{1}{2}\mathbf{W}(\G))^{-1}(\identity^\ell +\frac{1}{2}\mathbf{W}(\G))\V \,; \quad \text{[Caley retraction]}
    \end{aligned}
\end{equation}
where $\mathrm{qf}$ indicates the $\mathbf{Q}$ factor of the $\mathrm{QR}$ decomposition, and $\mathbf{W}(\G)=(\identity^\ell - \frac{1}{2}\V\V^\top)\G \V^\top- \V\G^\top (\identity^\ell - \frac{1}{2}\V\V^\top)$. 

Finally, the normal space to the manifold at $\V$ has the following explicit form
\begin{equation}\label{eq:explicit_normal_space}
    \normalspace{\V}{\stiefel{\ell}{h}}\coloneqq \{ \V \mathbf{S} \, \mid \, \mathbf{S} \in \sym{h} \}\,.
\end{equation}

Starting from \Cref{eq:explicit_normal_space}, the orthogonal projection to \tangentspace{\V}{\stiefel{\ell}{h}}, namely \projectiontangentspace{\V}{}, has to be such that $\G - \projectiontangentspace{\V}{\G}$ lies onto \normalspace{\V}{\stiefel{\ell}{h}}, i.e.,
\begin{equation}\label{eq:stiefel_proj_diff}
    \G - \projectiontangentspace{\V}{\G} = \V \mathbf{S}\,.
\end{equation}

Plugging \Cref{eq:stiefel_proj_diff} into \Cref{eq:Stiefel_t_space}, it can be derived that
\begin{equation}\label{eq:stiefel_projection}
    \projectiontangentspace{\V}{\G} = \left(\identity^\ell - \V \V^{\top} \right) \G + \V \frac{ \left(\V^{\top} \G - \G^\top \V \right)}{2} \,.
\end{equation}

Finally, for $\stiefel{\ell}{h}$ (and in general for Riemannian submanifolds) the Riemannian gradient of $f$ at $\V$ is the orthogonal projection of \Egrad{\V}{f} to \tangentspace{\V}{\stiefel{\ell}{h}}.
Mathematically, starting from \Cref{eq:stiefel_projection}, we have 
\begin{equation}\label{eq:stiefel_grad}
    \Rgrad{\V}{f}=\projectiontangentspace{\V}{\Egrad{\V}{f}} \,.    
\end{equation}