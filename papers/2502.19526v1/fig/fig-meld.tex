\begin{figure}[!htp]
\centering


\definecolor{mPurple}{rgb}{0.58,0,0.82}
\lstset{
  basicstyle=\footnotesize\fontfamily{ttfamily}\selectfont, % set the font
  keywordstyle={\color{mPurple}}, % set the keyword style
  morecomment=[l]{//},
  commentstyle=\rmfamily\slshape,
  % commentstyle=\itshape, % set the comment style
  showstringspaces=false, % don't show spaces in strings
  columns=fullflexible, % use proportional spacing
  morekeywords={fun,func,let,val,in,end,case,of,SOME, NONE, and, structure, if, else, then, return, def}, % define additional keywords
  mathescape=true, % enable math mode
  keepspaces=true,
  breaklines=true,
  numbers=left,
  xleftmargin=20pt
}

\begin{minipage}[t]{0.45\textwidth}
\begin{lstlisting}[escapechar=@]
$\Omega$: int
Oracle: circuit $\rightarrow$ circuit
cost: circuit $\rightarrow$ int

def meld$(C_1, C_2)$:
  $d_1, d_2$ = (depth($C_1$), depth($C_2$))
  $W$ = $C_1 [d_1 - \Omega : d_1] + C_2 [0 : \Omega]$ @\label{line:combine}@
  $W'$ = Oracle$(W)$
  if $\costof{W'} = \costof{W}$:
    return $C_1 + C_2$
  else:
    $M$ = meld$(C_1[0 : d_1 - \Omega], W')$
    return meld ($M, C_2[\Omega : d_2]$)@
\end{lstlisting}
\end{minipage}
\begin{minipage}[t]{0.45\textwidth}
\begin{lstlisting}[firstnumber = 14, escapeinside={@}{@}]
def $\mathsf{SOAM}$($C$):
  $d$ = depth$(C)$
  if $d \leq 2\Omega$:
    return Oracle$(C)$
  else:
    $m$ = $\lfloor d/2 \rfloor$
    $C_1$, $C_2$ = ($C[0 : m]$, $C[m : d]$)
    $C_1'$ = $\mathsf{SOAM}$($C_1$)
    $C_2'$ = $\mathsf{SOAM}$($C_2$)
    return meld$(C_1', C_2')$@
\end{lstlisting}
\end{minipage}

\caption{
The function $\mathsf{SOAM}$ shows the algorithm for optimizing a circuit
$C$, using an off-the-shelf oracle optimizer, such that the circuit is
$\Omega-$optimal w.r.t. the oracle.
%
It uses the function $\mathsf{meld}$, which takes two $\Omega$-optimal
circuits and merges them such that the result is $\Omega$-optimal.
%
}
% \vspace{-1.5in}
\label{fig:algo}
\end{figure}

