\def\smsize{0.6cm}
\def\smpos{1}
\def\rsize{1cm}
\def\dist{1.0}
\def\logpos{0}
\def\logh{0.5}
\def\logw{12.7}

\definecolor{darkcola}{RGB}{140, 140, 180} %
\definecolor{cola}{RGB}{230, 230, 250} %
\definecolor{colb}{RGB}{100, 200, 100} %
\definecolor{colc}{RGB}{200, 100, 100} %
\definecolor{cold}{RGB}{100, 180, 180} %

\tikzset{
  arrow-record-a/.style={->, thick, color=#1},
  arrow-record-b/.style={->, thick, >={latex'}, color=#1},
  arrow-notify-a/.style={<-, thick, color=#1},
  arrow-notify-b/.style={<-, thick, >={latex'}, color=#1},
  arrow-local/.style={->, thick, dashed},
  arrow-sh/.style={xshift=#1*\arrowspacing},
}

\tikzset{
  label/.style={midway, yshift=-2pt, font=\scriptsize, fill=white, fill opacity=1, text opacity=1, inner sep=1.5pt},
  legend/.style={left, font=\scriptsize},
  box/.style={draw, rectangle, minimum width=\smsize, minimum height=\smsize},
  replica/.style={draw, rectangle, minimum width=\rsize, minimum height=\smsize},
  sensor-box/.style={box, text=white, preaction={fill=#1}},
  monitor-box/.style={box, text=white, preaction={fill=#1}},
  replica-box/.style={replica, preaction={fill=#1}},
  legend-box/.style={font=\scriptsize, draw, rectangle, minimum width=4cm, minimum height=0.35cm, text=white, preaction={fill=#1}, anchor=west, inner sep=0pt, align=right, text height=1.5ex, text depth=.25ex},
}

\begin{tikzpicture}

  \draw[thick, fill=cola] (0.5, 2.1) rectangle (\logw, \logpos+0.5) node[anchor=north east] at (\logw, 2.1) {Replica \na};

  \node[sensor-box=light-yellow]  (LS) at (1*\dist, \smpos)   {\textsf{LS}};
  \node[monitor-box=light-yellow] (LM) at (2*\dist, \smpos)   {\textsf{LM}};
  \node[sensor-box=light-blue]    (MS) at (3.5*\dist, \smpos) {\textsf{MS}};
  \node[monitor-box=light-blue]   (MM) at (4.5*\dist, \smpos) {\textsf{MM}};
  \node[sensor-box=light-red]     (SS) at (6*\dist, \smpos)   {\textsf{SS}};
  \node[monitor-box=light-red]    (SM) at (7*\dist, \smpos)   {\textsf{SM}};
  \node[sensor-box=light-green]   (CS) at (8.5*\dist, \smpos) {\textsf{CS}};
  \node[monitor-box=light-green]  (CM) at (9.5*\dist, \smpos) {\textsf{CM}};
  \node[replica-box=light-blue]  (RSM) at (12*\dist, \smpos) {RSM};

  \draw[arrow-local] (LM.north) to[out=60, in=120, looseness=0.5] (SS.north);
  \draw[arrow-local] (LM.north) node[font=\scriptsize, above] {\lm} to[out=60, in=120, looseness=0.4] (CS.north);
  \draw[arrow-local] (MM.north) node[font=\scriptsize, above] {\Faulty} to[out=60, in=120, looseness=0.5] (SM.north);
  \draw[arrow-local] (SM.east) -- (CS.west) node[midway, yshift=-2pt, font=\scriptsize, above] {\Cand, \un};
  \draw[arrow-local] (CM.east) -- (RSM.west) node[midway, yshift=-3pt, font=\scriptsize, above] {Reconfigure};

  \draw[arrow-record-a=darkcola] (LS.south) -- (1*\dist, \logpos) node[label] {\latm{Prop}{A}{B}};
  \draw[arrow-record-a=darkcola] (MS.south) -- (3.5*\dist, \logpos) node[label] {\compm};
  \draw[arrow-record-a=darkcola] (SS.south) -- (6*\dist, \logpos) node[label] {\suspm{Slow}{A}{B}};
  \draw[arrow-record-a=darkcola] (CS.south) -- (8.5*\dist, \logpos) node[label] {\cfgm};

  \begin{scope}[shift={(\logw+0.5, \logpos+0.5)}]
    \node[legend-box=light-yellow] at (0, 1.5) {\textsf{LS/LM: Latency Sensor/Monitor}};
    \node[legend-box=light-blue]   at (0, 1.0) {\textsf{MS/MM: Misbehavior Sensor/Monitor}};
    \node[legend-box=light-red]    at (0, 0.5) {\textsf{SS/SM: Suspicion Sensor/Monitor}};
    \node[legend-box=light-green]  at (0, 0.0) {\textsf{CS/CM: Config Sensor/Monitor}};
  \end{scope}
\end{tikzpicture}
