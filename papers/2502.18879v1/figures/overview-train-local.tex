\begin{figure}
  \begin{center}
  \begin{sllisting}
    \slconstant A, B, F, k, \sigma \\
    \slunknown f(*) \\
    \slassume \\
      \slind A > 0 \commasep B > 0 \commasep T > 0 \commasep k > 0 \commasep \sigma > 0 \commasep F < B \commasep A + F > 0 \commasep \\
      \slind (\lforall x -A \le f(x) \le F) \commasep (\lforall x \lforall y |f(x) - f(y)| \le k |x - y|) \\
    \slbound %
      \TrainFxMax: f(x) \le \TrainFxMax
    \\
    \slcontroller \\
      \slind y \dlassign \min(y, \TrainFxMax) \seq \\
      \slind ((a \dlassign -B) \ \cup \\
      \slind \phantom{(}(?(x + vT + \frac{1}{2}(A + F)T^2 + \bdist{v+(A+F)T}{B - \min(F, \, y + k(vT + \frac{1}{2}(A + F)T^2) \ + \\
      \slind[2] k \cdot \bdist{v + (A+F)T}{B-F})} \le e) \seq a \dlassign A) \\
    \slplant t \dlassign 0 \seq \dlode{x'=v, v'=a+f(x), y'=kv, t'=1 \dldom t \le T \land v \ge 0} \\
    \slsafe x \le e \\
    \slinvariant \,(v \ge 0) \land
      (y \ge f(x)) \land (x + \bdist{v}{B - \min(F, \,y + k \!\cdot\! \bdist{v}{B-F})} \le e)
       \\
    \slnoise \eta \sim \slnormal(0, \sigma^2) \\
    \slobserve \omega = f(x) - \eta \\
    \slinfer
      \TrainFxMax \slassign F \seq
      \TrainFxMax \slassign \slbest i: \TrainFxMax_i + k|x - x_i| \seq
      \TrainFxMax \slassign \slaggregate i: \omega_i + k|x - x_i| \sland \eta_i \\
  \end{sllisting}
  \end{center}
  \caption{An adaptive shield for a train control system where the railway tracks are assumed to follow an unkown, space-varying slope function. We write $\bdist{v}{b} \equiv v^2/2b$. For simplicity, the train faces a \emph{binary} choice between \emph{acceleration} and \emph{braking} (as in Figure~\ref{fig:overview-etcs} and unlike in Figure~\ref{fig:overview-train-global}).}\label{fig:overview-train-local}
  \Description[]{}
\end{figure}
