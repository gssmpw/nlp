\begin{figure}
  \centering
  \tikzset{
  diagonal fill/.style 2 args={fill=#2, path picture={
  \fill[#1, sharp corners] (path picture bounding box.south west) -|
			   (path picture bounding box.north east) -- cycle;}},
  reversed diagonal fill/.style 2 args={fill=#2, path picture={
  \fill[#1, sharp corners] (path picture bounding box.north west) |- 
			   (path picture bounding box.south east) -- cycle;}}
  }
  \begin{tikzpicture}
      \def\offset{0.1}
      \def\scale{0.35}
      \def\steps{2}
      \def\y{-0.75}

      \draw (0,\y*0) edge[thick,->] node[pos=0,left,font=\scriptsize,anchor=east,xshift=-2pt,yshift=8pt] {$[T^{DS}_1, B^{NW}]$} (7,\y*0);
      \draw (0,\y*1) edge[thick,->] node[pos=0,left,font=\scriptsize,anchor=east,xshift=-2pt,yshift=8pt] {$[T^{DS}_2, B^{NW}]$} (7,\y*1);
      \draw (0,\y*2) edge[thick,->] node[pos=0,below,font=\scriptsize,anchor=east,xshift=-2pt,yshift=8pt] {$B^{NW}$ (PSFP)} (7,\y*2);
      \draw (0,\y*3) edge[thick,->] node[pos=0,below,font=\scriptsize,anchor=east,xshift=-2pt,yshift=8pt] {$[B^{NW}, B_1]$} (7,\y*3);
      \draw (0,\y*4) edge[thick,->] node[pos=0,below,font=\scriptsize,anchor=east,xshift=-2pt,yshift=8pt] {$[T_3, B_1]$} (7,\y*4);
      \draw (0,\y*5) edge[thick,->] node[pos=0,below,font=\scriptsize,anchor=east,xshift=-2pt,yshift=8pt] {$[B_1, L_1]$} (7,\y*5);
      \draw (0,\y*6) edge[thick,->] node[pos=0,below,font=\scriptsize,anchor=east,xshift=-2pt,yshift=8pt] {$[B_1, L_2]$} (7,\y*6);

      % T_1 -> B^NW
      \draw[rounded corners=1mm, fill=f1] (\scale*0+\offset,\y*0) rectangle ++(\scale*1.5,0.4) node[pos=0.5,font=\scriptsize] {$f_1$};
      \draw (\scale*1.5+\offset,\y*0+0.5) edge[thick,-{Latex[length=1.5mm]}] node[above=1.5mm,font=\scriptsize] {$tx$} (\scale*1.5+\offset,\y*0);

      % T_2 -> B^NW
      \draw[rounded corners=1mm, fill=f2] (\scale*0+\offset,\y*1) rectangle ++(\scale*1.5,0.4) node[pos=0.5,font=\scriptsize] {$f_2$};
      \draw (\scale*1.5+\offset,\y*1+0.5) edge[thick,-{Latex[length=1.5mm]}] node[above=1.5mm,font=\scriptsize] {$tx$} (\scale*1.5+\offset,\y*1);

      % B^NW PSFP
      \draw[pattern=north east lines] (0,\y*2) rectangle ++(\scale*4+\offset,0.5);
      \draw[diagonal fill={f2}{f1}] (\scale*4+\offset,\y*2) rectangle ++(\scale*4,0.5);  
      \draw[pattern=north east lines] (\scale*8+\offset,\y*2) rectangle ++(\scale*10.5+\offset,0.5);

      % B^NW -> B_1
      \draw[rounded corners=1mm, diagonal fill={f2}{f1}] (\scale*4+\offset,\y*3) rectangle ++(\scale*4.5,0.4) node[pos=0.5,font=\scriptsize] {$\{f_1,f_2\}$};
      \draw (\scale*8.5+\offset,\y*3+0.5) edge[thick,-{Latex[length=1.5mm]}] node[above=1.5mm,font=\scriptsize] {$tx$} (\scale*8.5+\offset,\y*3);
      % T_3 -> B_1
      \draw[rounded corners=1mm, fill=f3] (\scale*8.5+\offset,\y*4) rectangle ++(\scale*1.5,0.4) node[pos=0.5,font=\scriptsize] {$f_3$};
      \draw (\scale*10+\offset,\y*4+0.5) edge[thick,-{Latex[length=1.5mm]}] node[above=1.5mm,font=\scriptsize] {$tx$} (\scale*10+\offset,\y*4);

      % B_1 -> L_1
      \draw[rounded corners=1mm, fill=f1] (\scale*8.5+\offset,\y*5) rectangle ++(\scale*1.5,0.4) node[pos=0.5,font=\scriptsize] {$f_1$};
      \draw (\scale*10+\offset,\y*5+0.5) edge[thick,-{Latex[length=1.5mm]}] node[above=1.5mm,font=\scriptsize] {$tx$} (\scale*10+\offset,\y*5);

      % B_1 -> L_2
      \draw[rounded corners=1mm, fill=f2] (\scale*8.5+\offset,\y*6) rectangle ++(\scale*1.5,0.4) node[pos=0.5,font=\scriptsize] {$f_2$};
      \draw (\scale*10+\offset,\y*6+0.5) edge[thick,-{Latex[length=1.5mm]}] node[above=1.5mm,font=\scriptsize] {$tx$} (\scale*10+\offset,\y*6);
      \draw[rounded corners=1mm, fill=f3] (\scale*10.1+\offset,\y*6) rectangle ++(\scale*1.5,0.4) node[pos=0.5,font=\scriptsize] {$f_3$};
      \draw (\scale*11.6+\offset,\y*6+0.5) edge[thick,-{Latex[length=1.5mm]}] node[above=1.5mm,font=\scriptsize] {$tx$} (\scale*11.6+\offset,\y*6);
  \end{tikzpicture}
  \caption{FIPS configuration when batching $\{f_1, f_2\}$ at $[B^{NW}, B_1]$ and choosing $f_2 \prec f_3$ at $[B_1, L_2]$.} \label{fig:fips}
\end{figure}
