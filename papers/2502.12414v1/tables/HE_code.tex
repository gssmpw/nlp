
\begin{table*}[h]
    \centering
    \renewcommand{\arraystretch}{1.5}
    \begin{tabular}{|p{16cm}|}
        \hline
        \multicolumn{1}{|c|}{\textbf{Controlled Dataset Construction For Human Evaluation}} \\
        \hline

Initialize:  
  max_word_count = 100  
  min_word_count = 1  
  wer_threshold = 60  
  total_samples = 500  
  evaluators = 20  

\\ Step 1: Aggregate and filter data  
for each (hypothesis, reference) in raw_data:  
  if WER(hypothesis, reference) > wer_threshold:  
    if min_word_count ≤ len(hypothesis) ≤ max_word_count:  
      filtered_data.append((hypothesis, reference))  

\\ Step 2: Inject artificial hallucinations  
hallucination_subset = randomly_select(filtered_data, n=50)  
for (hypothesis, reference) in hallucination_subset:  
  shuffled_hyp = shuffle_words(hypothesis)  
  hallucination_data.append((shuffled_hyp, reference, label="hallucination"))  

\\ Step 3: Prepare final dataset  
remaining_data = filtered_data - hallucination_subset  
remaining_data.label = "unknown"  
final_dataset = hallucination_data + remaining_data  
final_dataset = shuffle(final_dataset)  

\\ Step 4: Human evaluation  
for i = 1 to evaluators:  
  assigned_samples = randomly_select(final_dataset, n=50)  
  for (hypothesis, reference, label) in assigned_samples:  
    human_label = annotate_hallucination(hypothesis, reference)  
    annotations[i].append(human_label)  

\\ Step 5: Compute agreement  
for each sample in final_dataset:  
  evaluator1_label, evaluator2_label = get_two_annotations(sample)  
  agreement_score += calculate_kappa(evaluator1_label, evaluator2_label)  

return final_dataset, agreement_score 
        \hline
    \end{tabular}
    \caption{Finegrained Hallucination Detection Prompt}
    \label{tab:HE_code}
\end{table*}
