% \pdfoutput=1

\documentclass[11pt]{article}
%\usepackage{fullpage}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
% \usepackage[colorlinks=true, allcolors=blue]{hyperref}
\usepackage{hyperref}
\hypersetup{colorlinks,allcolors=blue}
\usepackage{appendix}
\usepackage{amsmath}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{xcolor}
\usepackage{listings}
%\usepackage{csvsimple}
\usepackage{graphicx}
\usepackage{amssymb, amsthm, amsfonts, graphicx, color, subcaption, enumerate, bm, enumitem, array, mathtools}
\usepackage{thmtools, thm-restate}
%\usepackage{amsmath, amssymb, amscd, amsthm, amsfonts}
\usepackage{mathdots}
%\usepackage{thm-restate}

\usepackage{tikz}
\usetikzlibrary{arrows.meta}
%\usepackage{cellspace}
%\usepackage{cleveref}
%\usepackage{xspace}
\usepackage{csquotes}
\usepackage{enumitem}
\usepackage[style=trad-alpha,natbib=true,maxcitenames=4]{biblatex}
\addbibresource{ref.bib}
% \usepackage{refcheck}



% \usepackage{multirow}
%Handles more characters
%General math stuff
%amsfonts for mathbb and such
%amssymb for $\therefore$
% \usepackage{amsmath, amsfonts, amssymb}
%inserting headers/footers
%\usepackage{fancyhdr}
%get last page number
\usepackage{lastpage}
%paper size/margins
\usepackage[margin=1in]{geometry}
%for font colors
% \usepackage[dvipsnames]{xcolor}
%for inseting images
% \usepackage{graphicx}
% \graphicspath{{./figs}}
% for nice colored boxes
% \usepackage{tcolorbox}
%https://stackoverflow.com/questions/1398127/breaking-a-list-into-multiple-columns-in-latex
% \usepackage{multicol}
%https://tex.stackexchange.com/questions/39227/no-indent-in-the-first-paragraph-in-a-section
%\usepackage{indentfirst}
%https://tex.stackexchange.com/questions/10123/defining-my-own-proof-environment
%\usepackage{amsthm}
%Better tikz arrows

%Augmented matrices command
\newenvironment{amatrix}[1]{%
  \left(\begin{array}{@{}*{#1}{c}|c@{}}
}{%
  \end{array}\right)
}



% \newtheorem{theorem}{Theorem}[section]
% \declaretheorem[name=Theorem,numberwithin=section,sibling=theorem]{thm}
% \newtheorem{lemma}[theorem]{Lemma}
% \declaretheorem[name=Lemma,numberwithin=section,sibling=theorem]{lm}
% \newtheorem{observation}[theorem]{Observation}
% \newtheorem{property}[theorem]{Property}
% \newtheorem{corollary}[theorem]{Corollary}
% \newtheorem{conjecture}[theorem]{Conjecture}
% \newtheorem{remark}{Remark}
% \newtheorem{example}{Example}
% \newtheorem{definition}[theorem]{Definition}

\newcommand{\mb}[1]{\mathbf{#1}}
\newcommand{\note}[1]{{\color{teal} #1}}
\newcommand{\comm}[1]{{\color{purple} #1}}
\newcommand{\dist}{\operatorname{dist}}

\newcommand{\CONGEST}{\mathsf{CONGEST}}
\newcommand{\ID}{\operatorname{ID}}
\newcommand{\poly}{\operatorname{poly}}

\newcommand{\Tsssp}{T_{\mathsf{SSSP}}}

\newcommand{\rpath}{RPaths}
\newcommand{\apxrpath}{Apx-\rpath{}}
\newcommand{\secsisp}{2-SiSP}

\newcommand{\TODO}{{\color{red}\textsf{TODO}}}

\usepackage[colorinlistoftodos,prependcaption,textsize=tiny,disable]{todonotes}
\newcommand{\yanyu}[1]{\todo[backgroundcolor=red!25]{Yanyu: #1}}
\newcommand{\gopinath}[1]{\todo[backgroundcolor=purple!25]{Gopinath: #1}}
\newcommand{\yijun}[1]{\todo[backgroundcolor=cyan!25]{Yijun: #1}}
\newcommand{\hung}[1]{\todo[backgroundcolor=pink!25]{Hung: #1}}
\newcommand{\homu}[1]{\todo[backgroundcolor=orange!25]{Bryce: #1}}
\newcommand{\dipan}[1]{\todo[backgroundcolor=olive!25]{Dipan: #1}}

\title{Optimal Distributed Replacement Paths}
% \author{12-1 Bryce Sanchez 12-1 王竣宏 }
%\author{Chang Yi-Jun, Dey Dipan, Yanyu Chen, Mishra Gopinath, \\ Nguyen Thuan Hung, Sanchez Bryce}
%\author{Anonymous authors}
 \author{Yi-Jun Chang\footnote{National University of Singapore. ORCID: 0000-0002-0109-2432. Email: cyijun@nus.edu.sg} 
 \and Yanyu Chen\footnote{National University of Singapore. ORCID: 0009-0008-8068-1649. Email: yanyu.chen@u.nus.edu}
 \and Dipan Dey\footnote{Tata Institute of Fundamental Research, India. ORCID: 0009-0001-0675-8790. Email: dipan.dey@tifr.res.in}
 \and Gopinath Mishra\footnote{National University of Singapore. ORCID: 0000-0003-0540-0292. Email: gopinath@nus.edu.sg}  
 \and Hung Thuan Nguyen\footnote{National University of Singapore. ORCID: 0009-0006-7993-2952.  Email: hung@u.nus.edu}
 \and Bryce Sanchez\footnote{National University of Singapore. ORCID: 0009-0000-5807-297X. Email: bryce\_sanchez\_21@u.nus.edu} }
\date{}

%\pagestyle{fancy}
%\fancyhf{}
%\lhead{}
%\rhead{Distributed Replacement Paths}
%\rfoot{Page \thepage \hspace{1pt} of \pageref{LastPage}}





\usepackage{cleveref}
\newtheorem{theorem}{Theorem}
\declaretheorem[name=Theorem,sibling=theorem]{thm}
\newtheorem{lemma}{Lemma}[section]
\newtheorem{claim}[lemma]{Claim}
\newtheorem{fact}[lemma]{Fact}
\newtheorem{definition}[lemma]{Definition}
\newtheorem{corollary}[lemma]{Corollary}
\newtheorem{observation}[lemma]{Observation}
\newtheorem{proposition}[lemma]{Proposition}
\newtheorem{problem}[lemma]{Problem}

\begin{document}
%\nocite{*}

\maketitle

\begin{abstract}
We study the \emph{replacement paths} problem in the $\CONGEST$ model of distributed computing.  Given an $s$-$t$ shortest path $P$, the goal is to compute, for every edge $e$ in $P$, the shortest-path distance from $s$ to $t$ avoiding $e$. For \emph{unweighted} directed graphs, we establish the \emph{tight} randomized round complexity bound for this problem as $\widetilde{\Theta}(n^{2/3} + D)$ by showing matching upper and lower bounds. Our upper bound extends to $(1+\epsilon)$-approximation for \emph{weighted} directed graphs. 
Our lower bound applies even to the \emph{second simple shortest path} problem, which asks only for the smallest replacement path length.
These results improve upon the very recent work of Manoharan and Ramachandran (SIROCCO 2024), who showed a lower bound of $\widetilde{\Omega}(n^{1/2} + D)$ and an upper bound of $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$, where $h_{st}$ is the number of hops in the given $s$-$t$ shortest path $P$.  

\yijun{make sure to hide all todo-comments before arxiv submission}
%\yijun{I plan to use three levels: theorem (main results in intro), proposition (main results in sections), lemma/observation (remaining ones).}
\end{abstract}


\thispagestyle{empty}
\newpage
\thispagestyle{empty}
\tableofcontents
\newpage
\pagenumbering{arabic}


\section{Introduction}
%\gopinath{May be we mention bout the results for undirected graph by \cite{manoharan2024computing} some where in the introduction or related work?}\yijun{Added in the conclusions and open problems section.}\gopinath{Okay. Thanks!}
% The replacement path problem in a distributed context involves a graph where each vertex is a computer that can communicate along the edges of the graph. The input to the problem consists of an unweighted directed graph $G = (V,E)$, a source vertex $s$, a target vertex $t$, and a shortest path $P$ from $s$ to $t$. The output of the problem is that for every edge $(u,v)$ on $P$, at least one of $u$ or $v$ should know the shortest distance from $s$ to $t$ when the edge $(u,v)$ is deleted from $G$. The new path from $s$ to $t$ after the deletion of one of the edges of $P$ is referred to as a replacement path.
We study the \emph{Replacement Paths (\rpath{})} problem.  Given an $s$-$t$ shortest path $P$, the goal is to compute, for every edge $e$ in $P$, the shortest-path distance from $s$ to $t$ avoiding $e$. This problem has applications in network reliability, transportation systems, and distributed computing, where efficiently rerouting traffic in response to edge failures is critical.


We focus on the $\CONGEST$ model of distributed computing~\cite{peleg2000distributed}, where the network is modeled as a graph $G=(V,E)$. The communication proceeds in synchronous rounds. In each round, each vertex can send each neighbor an $O(\log n)$-bit message.
%is a synchronous message-passing model used to analyze communication networks. In this model, the network is represented by an undirected graph $G$ with $n$ vertices, where each vertex corresponds to a processor and each edge represents a bidirectional communication link with \emph{limited bandwidth}. Each vertex is assigned a unique identifier consisting of $O(\log n)$ bits, initially known only to the vertex itself and its immediate neighbors. Communication occurs in discrete rounds: in each round, a vertex first receives any messages sent to it in the previous round, performs local computation, and then sends a message of $O(\log n)$ bits to each of its neighbors. The performance of an algorithm in this model is measured by the number of communication rounds required in the worst case, disregarding the time spent on local computation.
Shortest paths computation plays a critical role in distributed computing. Many classical shortest paths problems, and their related problems, are well-studied in the $\CONGEST$ model of distributed computing: \emph{Single-Source Shortest Path (SSSP)}~\cite{ashvinkumar2024parallel,elkin2020distributed, cao2023parallel,chechik2020single,forster2018faster,ghaffari2018improved,Rozhon2023}, \emph{All-Pairs Shortest Paths (APSP)}~\cite{agarwal2018deterministic,agarwal2020faster,bernstein2019distributed,holzer2012optimal,huang2017distributed,lenzen2015fast,nanongkai2014distributed}, and \emph{reachability}~\cite{chechik_et_al:LIPIcs.DISC.2019.11,jambulapati2019parallel}.
%Graph algorithms\yijun{can restrict our attention to shortest path problems here, and say that while many classical shortest paths problems (including reachability) are already well-studied in the distributed setting, very little is known about replacement paths computation} (for both undirected and directed graphs) in the {CONGEST} model address fundamental challenges in distributed computing by optimizing communication complexity for key problems. Notable results include efficient algorithms for \emph{connectivity}\yijun{reachability?} \cite{awerbuch1989sparse,das2011distributed,daga2021distributed, augustine2019distributed}, . Another important problem related to shortest paths is the \emph{Replacement Paths (\rpath{})} problem.


The \rpath{} problem, as well as its many variants, has been extensively studied in the centralized setting~\cite{Roditty2012a,hershberger2003difficulty,hershberger2001vickrey,NardelliPW03,MalikMG89,weimann2013replacement,grandoni2019faster,chechik2019near,gupta2020multiple,grandoni2012improved,gu2021faster,bilo2021near,DeyGupta22,bhosle2004replacement,williams2010subcubic,williams2018subcubic,williams2022algorithms}. Surprisingly, despite having applications in fault-tolerant distributed computing, the \rpath{} problem has not received much attention in distributed computing yet. 
Ghaffari and Parter~\cite{ghaffari2016near} showed an $O(D \log n)$-round algorithm for single-source \rpath{} in undirected unweighted graphs, where $n=|V|$ is the number of vertices and $D$ is the diameter of the graph $G=(V,E)$. The first systematic study of the \rpath{} problem was done very recently by \citet{manoharan2024computing}. They consider both directed and undirected graphs, weighted and unweighted graphs. In particular, they obtained a \emph{tight} bound $\widetilde{\Theta}(n)$ for the \rpath{} problem in \emph{weighted directed} graphs by showing matching upper and lower bounds.\footnote{The notations $\widetilde{O}(\cdot)$, $\widetilde{\Omega}(\cdot)$, and $\widetilde{\Theta}(\cdot)$ suppress any $1/\poly(\log n)$ and $\poly(\log n)$ factor.}

%\citeauthor*{manoharan2024computing} studied the \rpath{} problem for both directed and undirected graphs, (almost) resolving the complexities for undirected graphs and providing non-trivial algorithms for directed graphs. In this work, we study the \rpath{} problem on directed (weighted) graphs in the $\CONGEST$ model, improving upon the results of \citeauthor*{manoharan2024computing}.

%The \emph{Replacement Paths (\rpath{})} problem\yijun{def should be earlier} is a fundamental problem in graph theory that involves finding alternative shortest paths in a graph when specific edges are removed. Given a directed graph, a source vertex $s$, a destination vertex $t$, and a shortest path $P$ from $s$ to $t$, the objective is to determine, for each edge $e$ on $P$, the shortest path from $s$ to $t$ that avoids $e$. Importantly, for each edge $e$, the new path must differ from $P$ by avoiding $e$. 

However, the complexities of the \rpath{} problem become more complicated in some other cases.
\citet{manoharan2024computing} presented an algorithm that solves the \rpath{} problem on \emph{unweighted directed} graphs in $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$ rounds,  where $h_{st}$ is the number of hops
in of the given shortest path $P$ from $s$ to $t$. They complemented their upper bound with a lower bound of $\widetilde{\Omega}\left(\sqrt{n} + D\right)$, which holds even when $h_{st}$ and $D$ are as small as $O(\log n)$. 
Given the large gap between the upper and lower bounds, as mentioned by \citet{manoharan2024computing}, it is natural to investigate the following questions:

\begin{center}
\begin{description}
    \item[(Q1)] Is it possible to narrow or close the gap between the upper bound $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$ and the lower bound $\widetilde{\Omega}\left(\sqrt{n} + D\right)$?
    \item[(Q2)] Is it possible to reduce or eliminate the dependence on $h_{st}$?
\end{description}    
\end{center}

Beyond \emph{unweighted directed} graphs, these two questions also apply to other cases of the \rpath{} problem. \citet{manoharan2024computing} also studied the \emph{Approximate Replacement Paths (\apxrpath{})} problem. In this setting, given an $s$-$t$ shortest path $P$, the goal is to compute, for every edge $e$ in $P$, an $(1+\epsilon)$-approximation of the shortest-path distance from $s$ to $t$ avoiding $e$. \citeauthor*{manoharan2024computing} showed that \apxrpath{} on \emph{weighted directed graphs} also admit the same upper bound $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$ and lower bound $\widetilde{\Omega}\left(\sqrt{n} + D\right)$ for any constant $\epsilon \in (0, 1)$. 

% The dependence on $h_{st}$ also appears in other settings.
% For \emph{weighted undirected} graphs, \citet{manoharan2024computing}  obtained an upper bound of $O(\Tsssp + h_{st})$ for \rpath{}, nearly matching their lower bound of $\widetilde{\Omega}(\sqrt{n}+D)$. Here $\Tsssp$ is the round complexity of the SSSP problem in weighted undirected graphs. It is known that $\Tsssp = \widetilde{\Omega}(\sqrt{n}+D)$~\cite{peleg2000near} and $\Tsssp = \widetilde{O}(\sqrt{n}+D) + n^{(2/5) + o(1)} \cdot O(D^{2/5})$~\cite{cao2023parallel}. For small-diameter graphs, the upper and lower bounds are matched up to the additive term $O(h_{st})$. It is noteworthy that all the lower bounds obtained by \citet{manoharan2024computing} are independent of $h_{st}$. 




\subsection{Our Contribution}
We answer both questions (Q1) and (Q2) affirmatively. For \emph{unweighted directed} graphs, we establish the \emph{tight} randomized round complexity bound for the \rpath{} problem as $\widetilde{\Theta}(n^{2/3} + D)$ by showing matching upper and lower bounds. Throughout the paper, we say that an algorithm succeeds \emph{with high probability} if it succeeds with probability $1 - 1/\poly(n)$.

\begin{restatable}[Upper bound for unweighted directed \rpath{}]{thm}{mainUB}
    \label{thm:main_UB}
    There exists an $\widetilde{O}(n^{2/3}+D)$-round randomized algorithm that solves \rpath{} in unweighted directed graphs with high probability.
\end{restatable}

Our lower bound applies even to the \emph{Second Simple Shortest Path (\secsisp{})} problem, which asks only for the smallest replacement path length, over all choices of $e$ in $P$. In other words, the goal is to find a shortest path from $s$ to $t$ that avoids at least one edge in the given shortest path $P$.

\begin{restatable}[Lower bound for unweighted directed \rpath{}]{thm}{mainLB}
    \label{thm:main_LB}
    Any algorithm that solves \rpath{} or \secsisp{} with constant probability in unweighted directed graphs requires $\widetilde{\Omega}(n^{2/3}+D)$ rounds.
\end{restatable}

\Cref{thm:main_LB} is a simplified statement of our lower bound. In our actual lower bound proof, we demonstrate an infinite sequence of graphs with $D = \Theta(\log n)$ in which \secsisp{} requires $\widetilde{\Omega}(n^{2/3})$ rounds to solve. Our lower bound is established using the framework of Das Sarma~et~al.~\cite{das2011distributed}. This framework has been extremely useful in proving tight lower bounds of $\widetilde{\Omega}(\sqrt{n})$ for most problems in the complexity class $\widetilde{\Theta}(\sqrt{n})$. 
%A key technical contribution of our work is demonstrating that this framework can extend beyond the $\widetilde{\Omega}(\sqrt{n})$ barrier, whereas all previous applications of this framework have only established $\widetilde{\Omega}(\sqrt{n})$ lower bounds. 
% \yanyu{comment 3: I am not sure how to address, given their comment, is the last sentence not valid? should we remove it? or say something else in remedy?}\yijun{I removed this sentence}

Our results place unweighted directed \rpath{} among the rare problems whose complexity is strictly between $o(n)$ and $\omega(\sqrt{n})$. Similar intermediate complexities arise in the area of \emph{distributed subgraph finding}. In particular, the problem of listing all $k$-cliques has a tight round complexity bound of $\widetilde{\Theta}(n^{1-2/k})$~\cite{censor2021tight}. However, these subgraph finding problems differ fundamentally from \rpath{} and other shortest path problems: Distributed subgraph finding is inherently \emph{local}, meaning it can be solved in $O(1)$ rounds given unlimited bandwidth. 

Using the techniques from \citet{das2011distributed} to obtained lower bounds of complexity other than $\Omega(\sqrt{n})$ is known previously. Specifically, computing $k$-source shortest paths in an unweighted directed graph is known to admit a lower bound of $\widetilde{\Omega}(\sqrt{nk} + D)$, which spans the spectrum between $\sqrt{n}$ and $n$ as the number $k$ of sources varies~\cite{manoharan2024distributed}. The lower bound is known to be \emph{tight} when $k \geq n^{1/3}$~\cite{manoharan2024computingMinWeightCycleCONGEST}.
% \yijun{comment 3 is addressed here}

 

%Most known problems in this complexity class exhibit fundamentally different characteristics. For instance, listing all $k$-cliques~\cite{censor2021tight} has a tight round complexity of $\widetilde{\Theta}(n^{1-2/k})$.


 
Our upper bound extends to $(1+\epsilon)$-\apxrpath{} for \emph{weighted directed} graphs. 

\begin{restatable}[Upper bound for weighted directed $(1+\epsilon)$-\apxrpath{}]{thm}{apxUB}
    \label{thm:apx_UB}
    For any constant $\epsilon \in (0,1)$, there exists an $\widetilde{O}(n^{2/3}+D)$-round randomized algorithm that solves $(1+\epsilon)$-\apxrpath{} in weighted directed graphs with high probability.
\end{restatable}



Our lower bound proof inherently does not apply to approximation algorithms, so closing the gap between our upper bound of $\widetilde{O}(n^{2/3} + D)$ and the lower bound of $\widetilde{\Omega}(\sqrt{n} + D)$ by \citet{manoharan2024computing} remains an intriguing open question.


% Our techniques for removing the dependence on $h_{st}$ also work for \emph{weighted undirected} \rpath{}, allowing us to obtain the following improved upper bound.

% \begin{restatable}{thm}{undirectedUB}
%     \label{thm:undirected_UB}
%     There exists an $O(\Tsssp + \sqrt{n})$-round randomized algorithm that solves \rpath{} in unweighted undirected graphs with high probability.
% \end{restatable}

% Concretely, we show that \rpath{} in unweighted undirected graphs can be solved by two SSSP computations followed by a \emph{deterministic}  $O(\sqrt{n} + D)$-round procedure. Therefore, the algorithm is deterministic if the SSSP algorithm in use is deterministic.

% Recall that $\Tsssp = \widetilde{\Omega}(\sqrt{n}+D)$~\cite{peleg2000near} and $\Tsssp = \widetilde{O}(\sqrt{n}+D) + n^{(2/5) + o(1)} \cdot O(D^{2/5})$~\cite{cao2023parallel}, so the round complexity of our algorithm can be written as $O(\Tsssp + \sqrt{n}) = \widetilde{O}(\Tsssp)$. In the regime of $D \leq n^{(1/4)-\epsilon}$ for some constant $\epsilon > 0$, our upper bound $O(\Tsssp + \sqrt{n}) = \widetilde{O}(\sqrt{n} + D)$ matches the lower bound of $\widetilde{\Omega}(\sqrt{n}+D)$ by \citet{manoharan2024computing}.

%The dependence on $h_{st}$ also appears in other settings.
%For \emph{weighted undirected} graphs, \citet{manoharan2024computing}  obtained an upper bound of $O(\Tsssp + h_{st})$ for \rpath{}, nearly matching their lower bound of $\widetilde{\Omega}(\sqrt{n}+D)$. Here $\Tsssp$ is the round complexity of the SSSP problem in weighted undirected graphs. It is known that $\Tsssp = \widetilde{\Omega}(\sqrt{n}+D)$~\cite{peleg2000near} and $\Tsssp = \widetilde{O}(\sqrt{n}+D) + n^{(2/5) + o(1)} \cdot O(D^{2/5})$~\cite{cao2023parallel}. For small-diameter graphs, the upper and lower bounds are matched up to the additive term $O(h_{st})$.


%Also, to the best of our knowledge, there is no known problem in the $\CONGEST$ model with a round complexity between $\omega(\sqrt{n})$ and $o(n / \log n)$.\yijun{need to be more careful. There actually is such a problem (e.g., in the area of distributed subgraph finding)! However, such problems are of a very different nature. In particular, the lower bound is not proved using the framework of Das Sarma~et~al.}
%In particular, we improve the round complexity of the \rpath{} problem to $\widetilde{O}(n^{2/3}+D)$. Additionally, we show a lower bound of $\widetilde{\Omega}(n^{2/3}+D)$, hence resolving the round complexity of the \rpath{} problem on unweighted graphs and answering the open questions posed by \citet{manoharan2024computing}. It is also mportant to note that the lower bound of $\widetilde{\Omega}(n^{2/3}+D)$ (for the \rpath{} problem) also works for \emph{Second Simple Shortest Path (2-SiSP)} problem. In 2-SiSP problem, the objective is to find a shortest simple path from $s$ to $t$ that avoids at least one edge on the original shortest path $P_{st}$.

%For weighted graphs, \citet{manoharan2024computing} showed that the \rpath{} problem admits an upper bound of $\widetilde{O}(n)$ and a lower bound of $\Omega(n / \log n)$. They also studied the \emph{Approximate Replacement Paths (\apxrpath{})} problem, where the edge weights are polynomially bounded in $n$. In this setting, given $\varepsilon > 0$, the objective is to determine, for each edge $e$ on the shortest path $P$ from $s$ to $t$, a path $P'$ from $s$ to $t$ that avoids $e$, such that the length of $P'$ is at most a multiplicative factor of $(1 + \varepsilon)$ times the shortest path from $s$ to $t$ that avoids $e$. \citeauthor*{manoharan2024computing} showed that \apxrpath{} on weighted graphs can be solved in $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$ rounds. In this work, we improve the round complexity to $\widetilde{O}(n^{2/3} + D)$. Notably, \apxrpath{} on weighted graphs admit a lower bound of $\widetilde{\Omega}(\sqrt{n} + D)$ \cite{manoharan2024computing}. Closing the gap between the upper bound of $\widetilde{O}(n^{2/3} + D)$ and the lower bound of $\widetilde{\Omega}(\sqrt{n} + D)$ (for the \apxrpath{} problem) remains an interesting open question. For additional open questions, please refer to \Cref{sec:conclusions}.

We summarize our new results, along with a comparison with previous work, in \Cref{table:main}.
%\yijun{make it clear about weighted/unweighted in the table}

\begin{table}[ht!]
\centering
\begin{tabular}{lllll}
 & \multicolumn{2}{l}{\textbf{Upper bounds}} & \multicolumn{2}{l}{\textbf{Lower bounds}} \\ \hline
\multicolumn{1}{|l|}{\bf\rpath{}} & $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$ & \multicolumn{1}{l|}{\cite{manoharan2024computing}} & $\widetilde{\Omega}(\sqrt{n}+D)$ & \multicolumn{1}{l|}{\cite{manoharan2024computing}} \\ \cline{2-5} 
\multicolumn{1}{|l|}{\small Unweighted directed graphs} & $\widetilde{O}(n^{2/3}+D)$ & \multicolumn{1}{l|}{\Cref{thm:main_UB}} & $\widetilde{\Omega}(n^{2/3}+D)$ & \multicolumn{1}{l|}{\Cref{thm:main_LB}} \\ \hline
\multicolumn{1}{|l|}{\bf \apxrpath{}} & $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$ & \multicolumn{1}{l|}{\cite{manoharan2024computing}} & $\widetilde{\Omega}(\sqrt{n}+D)$ & \multicolumn{1}{l|}{\cite{manoharan2024computing}} \\ \cline{2-3}
\multicolumn{1}{|l|}{\small Weighted directed graphs} & $\widetilde{O}(n^{2/3}+D)$ & \multicolumn{1}{l|}{\Cref{thm:apx_UB}} &  & \multicolumn{1}{l|}{} \\ \hline
\end{tabular}
\caption{Summary of our results and comparison with previous work.}\label{table:main}
\end{table}

% \begin{table}[ht!]
% \centering
% \begin{tabular}{lllll}
%  & \multicolumn{2}{l}{\textbf{Upper bounds}} & \multicolumn{2}{l}{\textbf{Lower bounds}} \\ \hline
% \multicolumn{1}{|l|}{\bf\rpath{}} & $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$ & \multicolumn{1}{l|}{\cite{manoharan2024computing}} & $\widetilde{\Omega}(\sqrt{n}+D)$ & \multicolumn{1}{l|}{\cite{manoharan2024computing}} \\ \cline{2-5} 
% \multicolumn{1}{|l|}{\small Unweighted directed graphs} & $\widetilde{O}(n^{2/3}+D)$ & \multicolumn{1}{l|}{\Cref{thm:main_UB}} & $\widetilde{\Omega}(n^{2/3}+D)$ & \multicolumn{1}{l|}{\Cref{thm:main_LB}} \\ \hline
% \multicolumn{1}{|l|}{\bf \apxrpath{}} & $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$ & \multicolumn{1}{l|}{\cite{manoharan2024computing}} & $\widetilde{\Omega}(\sqrt{n}+D)$ & \multicolumn{1}{l|}{\cite{manoharan2024computing}} \\ \cline{2-3}
% \multicolumn{1}{|l|}{\small Weighted directed graphs} & $\widetilde{O}(n^{2/3}+D)$ & \multicolumn{1}{l|}{\Cref{thm:apx_UB}} &  & \multicolumn{1}{l|}{} \\ \hline
% \multicolumn{1}{|l|}{\bf\rpath{}} & $O(\Tsssp +h_{st})$ & \multicolumn{1}{l|}{\cite{manoharan2024computing}} & $\widetilde{\Omega}(\sqrt{n}+D)$ & \multicolumn{1}{l|}{\cite{manoharan2024computing}} \\ \cline{2-3}
% \multicolumn{1}{|l|}{\small Weighted undirected graphs} & $O(\Tsssp + \sqrt{n})$ & \multicolumn{1}{l|}{\Cref{thm:undirected_UB}} &  & \multicolumn{1}{l|}{} \\ \hline
% \end{tabular}
% \caption{Summary of our results and comparison with previous work.}\label{table:main}
% \end{table}


% \begin{table}[h!]
% \centering
% \begin{tabular}{||c|c|c||}
% \hline \hline
%    & \rpath{} & \apxrpath{} \\
%    & for unweighted graphs & for weighted graphs\\
%    \hline \hline
% \multirow{2}{*}{Upper bound} & $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$ \cite{manoharan2024computing} & $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$ \cite{manoharan2024computing}  \\ 
%    &  $\widetilde{O}(n^{2/3} + D)$ (Theorem) & $\widetilde{O}(n^{2/3} + D)$ (Theorem) \\ \hline \hline
% \multirow{2}{*}{Lower bound} & $\widetilde{\Omega}(\sqrt{n} + D)$ \cite{manoharan2024computing} & \multirow{2}{*}{$\widetilde{\Omega}(\sqrt{n}+D)$\cite{manoharan2024computing}}  \\ 
%    & $\widetilde{\Omega}(n^{2/3} + D)$ (Theorem) & \\   \hline \hline
% \end{tabular}
% \caption{Summary of our results and comparison with prior work.}\label{table:main}
% \end{table}









% \subsection{Our Contribution and comparison with prior work}

% \begin{restatable}{theorem}{upperbound}
%    \label{thm:upperbound}
%    There exists a randomized algorithm that solves the Replacement Paths problem on any directed, unweighted graph in $\widetilde{O}(D + n^{2/3})$ rounds of $\CONGEST$.
% \end{restatable}

% \begin{restatable}{theorem}{upperboundapx}
%    \label{thm:upperboundapx}
%    For any $\epsilon \geq 0$, there exists a randomized algorithm that solves the Approximate Replacement Paths problem on any directed, weighted graph in $\widetilde{O}(D + n^{2/3})$ rounds of $\CONGEST$.
% \end{restatable}

% \begin{restatable}{theorem}{lowerbound}
%    \label{thm:lowerbound}
%    Any (randomized) algorithm that solves the Second Simple Shortest Path problem on any directed, unweighted graph requires $\widetilde{\Omega}(D + n^{2/3})$ rounds of $\CONGEST$.
% \end{restatable}

\paragraph{Remark.} While we establish that $\widetilde{\Theta}(n^{2/3} + D)$ is a tight bound for the unweighted undirected \rpath{} problem in terms of $n$ and $D$, the trivial $O(h_{st} \cdot \Tsssp)$-round algorithm---which computes SSSP in $G \setminus e$ for each edge $e$ in $P$---is faster than our $\widetilde{O}(n^{2/3} + D)$-round algorithm when $h_{st}$ is small. Here $\Tsssp = \widetilde{O}(\sqrt{n}+D) + n^{(2/5) + o(1)} \cdot O(D^{2/5})$ is the round complexity of the SSSP problem in unweighted directed graphs~\cite{cao2023parallel}. Our lower bound construction requires $h_{st} = \Theta(n^{2/3})$, whereas the previous $\widetilde{\Omega}(\sqrt{n}+D)$ lower bound of~\citet{manoharan2024computing} applies even for constant $h_{st}$.
% \yijun{comment 4 addressed here} 
% While your results are existentially optimal, mentioning the case of small h_st  in your write-up would offer a more complete picture.


\subsection{Additional Related Work}

The \rpath{} problem has a long line of research in the centralized setting. Hershberger and Suri \cite{hershberger2001vickrey} first introduced this problem and solved it for undirected graphs in $O(m+n \log n)$ time, where $m = |E|$ is the number of edges in the input graph $G=(V,E)$. Later, Hershberger, Suri, and Bhosle~\cite{hershberger2003difficulty} provided a lower bound of $\Omega(m \sqrt{n})$ time in the ``path comparison model'' for directed graphs with $m=O(n \sqrt{n})$. Roditty and Zwick~\cite{Roditty2012a} designed a Monte Carlo algorithm with running time $\widetilde{O}(m \sqrt{n})$ for unweighted directed graphs, matching the lower bound. The classical algorithm by Yen~\cite{yen1971finding} solves the \rpath{} problem in $\widetilde{O}(mn)$ time, which is \emph{conditionally} optimal assuming the \emph{MWC conjecture} proposed by \citet{AgarwalR18}.

A more general version of the \rpath{} problem considers all possible targets $t \in V\setminus\{s\}$ in the graph after fixing a source $s \in V$. This is known as the \emph{Single-Source Replacement Paths (SSRP)} Problem. For the SSRP problem, Chechik and Cohen~\cite{chechik2019near} and Gupta, Jain, and Modi~\cite{gupta2020multiple} presented $\widetilde{O}(m \sqrt{n}+n^2)$ time randomized algorithms for undirected unweighted graphs. Chechik, and Magen~\cite{ChechikM20} presented a randomized algorithm with the same runtime for directed unweighted graphs. For undirected unweighted graphs, Bil\`{o}, Cohen, Friedrich, and Schirneck~\cite{bilo2021near} designed the first deterministic algorithm with the same runtime. Later, Dey and Gupta \cite{DeyGupta22} improved the runtime to $\widetilde{O}(m \sqrt{n}+|R|)$, where $|R|$ is the output size. 

The \rpath{} problem in weighted directed graphs is known to belong to the fine-grained complexity classes of $\widetilde{\Theta}(n^3)$~\cite{williams2010subcubic} and $\widetilde{\Theta}(mn)$~\cite{AgarwalR18}.
Many of the problems in these complexity classes were known to have an $\widetilde{\Omega}(n)$ lower bound in the $\CONGEST$ model of distributed computing: APSP~\cite{nanongkai2014distributed}, diameter and radius~\cite{AbboudCK16,AnconaCDEW20}, and minimum weight cycle~\cite{manoharan2024computingMinWeightCycleCONGEST}.

In the area of fault-tolerant distributed computing, distributed algorithms for fault-tolerant distance preservers~\cite{BodwinP23, Parter20} and fault-tolerant spanners~\cite{DinitzR20, Parter22} have been shown in the $\CONGEST$ model of distributed computing.

%, Ghaffari and Parter \cite{GhaffariP16} have designed an algorithm solving SSRP problem with $O(D \log n)$ rounds ($D$ is the diameter of the graph) in undirected unweighted graphs. The only result in the CONGEST model for replacement paths and second simple shortest path problem is due to Manoharan and Ramachandran \cite{ManoharanR24}.

%Distributed algorithms to construct fault-tolerant distance preservers can be found in \cite{BodwinP23, Parter20} . Also, in \cite{DinitzR20, Parter22} there are algorithms to construct fault-tolerant spanners in CONGEST models. 



%Results related to some other variants of replacement path problems can be found in \cite{NardelliPW03,MalikMG89,weimann2013replacement,grandoni2019faster,chechik2019near,gupta2020multiple,grandoni2012improved,gu2021faster,bilo2021near,DeyGupta22,bhosle2004replacement,williams2010subcubic,williams2018subcubic,williams2022algorithms}.

%\yijun{can highlight the results in fine-grained complexity, and say that many of the problems in the cubic-time class were known to have $\widetilde{\Omega}(n)$ LB in the CONGEST model (see the previous SIROCCO paper)}


%\yijun{Can discuss distributed fault-tolerant spanners and preservers (see the previous SIROCCO paper)}


\subsection{Paper Organization}
We begin with preliminaries in \Cref{sec:prelim}, followed by a technical overview of our results in \Cref{sec:overview}. Our \rpath{} algorithm for unweighted directed graphs is presented in \Cref{sec:short,sec:long}, where we consider replacement paths with short detours in \Cref{sec:short} and those with long detours in \Cref{sec:long}.
We establish our lower bound for unweighted directed graphs in \Cref{sec:lowerbound}.
We present our $(1+\epsilon)$-\apxrpath{} algorithm for weighted directed graphs in \Cref{sec:wapprox}.
%and our \rpath{} algorithm for weighted undirected graphs (\Cref{thm:undirected_UB}) in \Cref{sec:undirected}.
 We conclude with open problems in \Cref{sec:conclusions}.



\section{Preliminaries}
\label{sec:prelim}

We start with introducing the basic notations used throughout the paper.
\begin{itemize}
    \item $G = (V,E)$ is the input graph. 
    \item $s \in V$ and $t \in V$ are the source and target, respectively.
    \item $P = (v_1, v_2, \ldots, v_{h_{st}-1})$ is the given shortest path from $s$ to $t$ in $G$, where $h_{st}$ is the number of edges in $P$.
    \item The length of the path \( P \), denoted as \( |P| \), is the number of edges in \( P \) if the underlying graph is unweighted. If the graph is weighted, \( |P| \) is the sum of the weights of the edges in \( P \).
    \item $uv \diamond e$ is any shortest path from vertex $u$ to vertex $v$ avoiding edge $e$. More generally, for any path $R$, $uv \diamond R$ is any shortest path from vertex $u$ to vertex $v$ avoiding all the edges in $R$.
    \item $n = |V|$ is the number of vertices in the graph $G$.
    \item $m = |E|$ is the number of edges in the graph $G$.
    \item $D$ is the \emph{unweighted undirected} diameter of $G$.
    \item $\zeta = n^{2/3}$ is the threshold between a short detour and a long detour.%\yijun{to do: maybe change to other symbol}
\end{itemize}
Given the notations, we define \rpath{}, \apxrpath{}, and \secsisp{} formally and succinctly.

\begin{definition}[Replacement Paths (\rpath{})]
The goal of the \rpath{} problem is to let the first endpoint of each edge $e$ in $P$ compute $|st \diamond e|$.
\end{definition}

\begin{definition}[Approximate Replacement Paths (\apxrpath{})]
The goal of the $(1+\epsilon)$-\apxrpath{} problem is to let the first endpoint of each edge $e$ in $P$ compute a value $x$ such that $|st \diamond e| \leq x \leq (1+\epsilon)\cdot|st \diamond e|$.
\end{definition}

\begin{definition}[Second Simple Shortest Path (\secsisp{})]
The goal of the \secsisp{} problem is to let all vertices in $P$ compute the minimum value of $|st \diamond e|$ over all edges $e$ in $P$.
\end{definition}

\paragraph{Detour.} To search for a shortest replacement path for $e=(v_i, v_{i+1})$ (i.e., $st \diamond e$), it suffices to consider replacement paths of the form $(s, \ldots, v_j, \ldots, v_l, \ldots, t)$ with $j \leq i$ and $l \geq i+1$ such that both $(s, \ldots, v_j)$ and $(v_l, \ldots, t)$ are subpaths of $P$, and $(v_j, \ldots, v_l)$ does not share any edge with $P$.
We call $(v_j, \ldots, v_l)$ the \emph{detour} of the replacement path. If the detour has at most $\zeta$ hops, then it is a \emph{short} detour. Otherwise, it is a \emph{long} detour. 

A replacement path with a short detour is called a short-detour replacement path. Similarly, a replacement path with a long detour is called a long-detour replacement path. For both \Cref{thm:main_UB} and \Cref{thm:apx_UB}, we set $\zeta = n^{2/3}$ to minimize the overall round complexity of our algorithms.  
%For \Cref{thm:undirected_UB}, we set $k = \sqrt{n}$. 
The idea of considering replacement paths with short and long detours separately was from \citet{Roditty2012a}.




\paragraph{The $\CONGEST$ model.} In the $\CONGEST$ model of distributed computing, a network is represented by a graph \( G = (V, E) \), where each vertex corresponds to a computational device, and each edge corresponds to a communication link between. Each vertex $v$ has a unique $O(\log n)$-bit identifier \( \ID(v) \), initially known only to $v$ and its neighbors $N(v)$. The communication proceeds in \emph{synchronous} rounds. In each round, each vertex can send a (possibly distinct) message of  \( O(\log n) \) bits to each of its neighbors. If $G$ is a weighted graph, then we assume that the edge weights are positive integers in $\poly(n)$, ensuring that each edge weight fits within an $O(\log n)$-bit message. Each vertex is allowed to perform unlimited local computation.
the primary measure of complexity in the $\CONGEST$ model is the number of \emph{rounds} required for an algorithm to complete.
The following useful tool is well-known.

%Sometimes, we must broadcast some messages to all the vertices in the network. For that, we will use the following result which is a folklore.
%given by \cite{LenzenPeleg}.\yijun{I think this lemma should be a folklore.}

\begin{lemma}[Broadcast~\cite{peleg2000distributed}]\label{LP}
     Consider the routing task where each vertex $v$ wants to broadcast $m_v$ messages of $O(\log n)$ bits to all the vertices in the network. The task can be done in $O(M+D)$ rounds deterministically, where $M = \sum_{v \in V} m_v$ is the total number of messages.
\end{lemma}


\paragraph{Basic knowledge.}
Throughout the paper, we assume that each vertex $v_i$ in $P$ initially knows its index $i$, the distance from $s$ to $v_i$, and the distance from $v_i$ to $t$. These are reasonable assumptions, as they can be computed using \emph{weighted undirected} SSSP by setting all the edge weights outside $P$ to be $\infty$. Alternatively, the indices can be computed using  \emph{unweighted directed} SSSP by redirecting all the edges outside $P$ and incident to $P$ towards $P$. In the following lemma, we show a simple algorithm to let all vertices in $P$ learn the basic information in $\widetilde{O}(\sqrt{n}+D)$ rounds. 

\begin{lemma}[Obtaining basic knowledge]\label{lem:basic_tool}
There exists an $\widetilde{O}(\sqrt{n}+D)$-round randomized algorithm that lets each vertex $v_i$ in $P$ learn its index $i$, the distance from $s$ to $v_i$, and the distance from $v_i$ to $t$ with high probability.
\end{lemma}
\begin{proof}
Sampling each vertex in $P$ with probability $1/\sqrt{n}$ independently. For every two consecutive sampled vertices $v_j$ and $v_l$ in $P$, let every vertex in the $v_j$-$v_l$ subpath of $P$ learn the following information:
\begin{itemize}
    \item $\ID(v_j)$ and $\ID(v_l)$.
    \item The number of hops and the distance to both $v_j$ and $v_l$ in $P$.
\end{itemize}
Such a learning task can be done in $O(\sqrt{n} \log n)$ rounds with high probability, as the number of hops between any two consecutive sampled vertices in $P$ is $O(\sqrt{n} \log n)$ with high probability by a Chernoff bound. Using the algorithm of \Cref{lem:basic_tool}, all sampled vertices can broadcast their learned information, which consists of $O(\log n)$ bits, in ${O}(\sqrt{n}+D)$ rounds with high probability, as the total number of sampled vertices is $O(\sqrt{n})$ with high probability by a Chernoff bound. After the broadcast is done, each vertex $v_i$ has sufficient information to infer its index $i$, its distance from $s$, and its distance to $t$.
\end{proof}

Using \Cref{lem:basic_tool}, the number of rounds required to obtain the basic knowledge is within the target round complexity for both \Cref{thm:main_UB} and \Cref{thm:apx_UB}.


\section{Technical Overview}
\label{sec:overview}

In this section, we provide a technical overview of our proofs. For each result, we first examine the approach used in prior work and then discuss how our method achieves an improvement. 
In \Cref{subsec:UB}, we discuss the proof idea behind \Cref{thm:main_UB}. 
In \Cref{subsec:LB}, we discuss the proof idea behind \Cref{thm:main_LB}. 
In \Cref{subsec:APX}, we discuss the proof idea behind \Cref{thm:apx_UB}. 



% \gopinath{The part below may be we move to technical overview section?}\yijun{yes}
 %They introduce the concept of detour paths, which refers to the part of the replacement path that does not overlap with the original shortest path $P$, and divide the problem into two cases based on the length of these detour paths: short and long detour paths.

%Building upon this framework, we present a new algorithm that solves the \rpath{} problem in $O(n^{2/3})$ communication rounds, independent of the detour length or the graph diameter. \TODO{}\hung{What is the novelty technique in our algo?} Additionally, we prove that our algorithm is \emph{optimal} by providing a matching communication lower bound.



%First, we briefly discuss the approach of \citet{manoharan2024distributed} for their Directed Unweighted and Unweighted \rpath{} algorithms together with their lower bound. Then we discuss our idea and highlight the difference with the prior approach.

\subsection{Upper Bound}\label{subsec:UB}
We start with the \rpath{} problem in unweighted directed graphs. Following an existing approach in centralized algorithms~\cite{Roditty2012a}, \citet{manoharan2024computing} approached the problem by separately handling replacement paths with short and long detours, using a threshold $\zeta$ to distinguish between them. For short-detour replacement paths, they compute a $\zeta$-hop BFS simultaneously from each vertex in $P$, requiring $O(h_{st} + \zeta)$ rounds. 

For long-detour replacement paths, a set of \emph{landmark} vertices $L$ is sampled randomly, and a hop-constrained BFS is performed from each vertex in $L$ in parallel. With high probability, the landmark vertices partition each long detour into segments of length $O\left(\frac{n}{|L| \log n}\right)$. As a result, the shortest replacement paths with long detours can be found via hop-constrained BFS from each landmark vertex. The idea of using landmark vertices to solve the \rpath{} problem originates from~\citet{BernsteinK08} and can be traced back even earlier for other graph problems~\cite{ullman1990high}.


To facilitate distance computation, \citet{manoharan2024computing} let each vertex in $L$ and $P$ broadcast all the distances computed during the BFS. This broadcasting step is the most time-consuming part of the algorithm, requiring $O(|L|^2 + |L|h_{st} + D)$ rounds. Finally, by propagating the learned information along the path $P$, the optimal replacement path distances for all edges in $P$ can be obtained in $O(h_{st})$ rounds. By properly selecting the sampling probability for $L$ and the threshold $\zeta$, they obtained their round complexity upper bound $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$.

\paragraph{New approach.} Now, we present our improvement, which reduces the upper bound to $\widetilde{O}(n^{2/3} + D)$ and eliminates the dependence on $h_{st}$. 



%all vertices learn the all-pair distance within $L$ and the distances between $P$ and $L$.  This broadcast task is the most costly part of the algorithm, requiring $O(|L|^2 + |L|h_{st} + D)$ rounds. Finally, by propagating the learned information from $s$ to $t$ along the path $P$, in $O(h_{st})$ rounds, the optimal replacement path distances for all edges in $P$ can be obtained. By properly selecting the size $|L|$ and the threshold $k$, they obtain their round complexity upper bound $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$.


%\paragraph{Short detours.} 

For short-detour replacement paths, we show that the shortest replacement path distances for all edges $e$ in $P$ can be computed deterministically in $O(\zeta)$ rounds. We still perform a $\zeta$-hop BFS from each vertex in $P$ in parallel but with a key modification that enables us to achieve this within $O(\zeta)$ rounds deterministically.  
A crucial observation is that it is unnecessary to fully expand all BFS trees. Instead, at each time step, we allow each vertex to propagate only the BFS tree originating from the \emph{furthest} vertex in $P$. This approach is sufficient for computing replacement paths while also resolving any potential congestion issues.  
After the BFS computation, leveraging the locality of short detours, we show that an additional $O(\zeta)$ rounds of information exchange within $P$ are sufficient to determine the optimal short-detour replacement paths.  




%\paragraph{Long detours.} 

Next, we consider the more challenging case of long-detour replacement paths. To minimize round complexity, we only let the landmark vertices broadcast the distances, reducing the broadcast cost to $O(|L|^2 + D)$ rounds. By setting $|L| = \widetilde{\Theta}(n^{1/3})$, we ensure that the overall round complexity remains within the target bound of $\widetilde{O}(n^{2/3} + D)$.  
However, this approach introduces some challenges. Unlike previous work, the distances between vertices in $P$ and those in $L$ are no longer globally known. In the previous work, the best replacement path for each edge $e$ was determined by propagating information sequentially from the start to the end of $P$, requiring $O(h_{st})$ rounds. For short-detour replacement paths, we leveraged locality to reduce this to $O(\zeta)$ rounds. However, this strategy does not apply to long-detour replacement paths, as a detour can start and end at two vertices in $P$ that are far apart.



To address these challenges, we partition the path $P$ into $\Theta(n^{1/3})$ segments, each of length $\Theta(n^{2/3})$. If the optimal detour starts and ends within the same segment, it can be found locally in the segment in $O(n^{2/3})$ rounds. For detours that cross two segments, we have each segment compute its best detour to every landmark vertex and broadcast the results. A key observation is that the total number of messages broadcast is now only $O(n^{2/3})$. With these messages, along with the all-pairs distances within $L$, the optimal replacement paths with long detours can be efficiently computed.



 %To address these issues, we divide the path $P$ into $O(n^{1/3})$ segments of length $O(n^{2/3})$. If the optimal detour starts and ends within the same segment, then it can be found locally in each segment in $O(n^{2/3})$ rounds. To handle detours that starts and ends at different segments, we let each segment computes its best detour to each landmark vertex and broadcasts the result. The key observation is that now the total number of messages to be broadcast is $O(n^{2/3})$. With this information, together with the all-pair distances within $L$, the best optimal replacement paths with long detours can be computed efficiently within each segment.


%previous approach sample landmark vertices to construct a reduced representation of the graph, known as a ``skeleton graph,'' and use broadcast operations to propagate distance information efficiently. Previous approaches relied on a brute-force method, broadcasting all-pair distances for $L \times L$ and $L \times P$, where $L$ is the number of landmark vertices , resulting in high round complexity dependent on $h_{st}$.

%For short detours with hop length $\leq h$, in their algorithm, each vertex in $P$ uses $h$-hop breadth-first search (BFS) and pipelines the information through using $O(h_{st} + h)$ rounds where $h_{st}$ is the length of $P$. That is why their complexity depends on $h_{st}$. We use the same technique but we optimized the algorithm by instead of keeping all the information, each vertex only keep the $\ID$ of the vertex whose BFS reaches it first. By doing that, all the vertex keep the information of the shortest short detour that reach it instead of all short detour reach it, and only use $O(h)$ rounds complexity.
%\yijun{and also discuss the info pipelining: after doing these bfs, $O(h)$ rounds are sufficient to get the best short detour, as $h$ is our hop bound. In the prior work, to propagate the info to calculate the best replacement path for each edge $e$, they do this from the beginning of $P$ to the end of $P$, which takes $h_{st}$ rounds.} To handle long detours, the previous approach sample landmark vertices to construct a reduced representation of the graph, known as a ``skeleton graph,'' and use broadcast operations to propagate distance information efficiently. Previous approaches relied on a brute-force method, broadcasting all-pair distances for $L \times L$ and $L \times P$, where $L$ is the number of landmark vertices , resulting in high round complexity dependent on $h_{st}$. Our approach optimizes this process by broadcasting all-pair distances only for $L \times L$ while employing a more structured method for $L \times P$. Specifically, we decompose the path into segments and apply local dynamic programming within each segment. Some broadcasting remains necessary to share critical information across segments, but now the communication cost scales with the number of segments rather than $h_{st}$.\yijun{The previous work use a very brute-force approach of broadcasting all-pair distances for $L \times L$ and $L \times P$, resulting in a high round complexity depending on $h_{st}$. We only do this for $L \times L$ and use a more clever approach to handle the distances in $L \times P$. In particular, we break the path into segments, within each segment we do dynamic programming locally. We do perform some broadcasting to learn the necessary info for other segments, but now the number of messages depends on the number of segments and not $h_{st}$.}


\subsection{Lower Bound}\label{subsec:LB} 


\citet{manoharan2024computing} established a lower bound of $\widetilde{\Omega}(\sqrt{n} + D)$ for the \rpath{} problem in unweighted directed graphs by reducing it from the undirected $s$-$t$ subgraph connectivity problem, which was known to admit an $\widetilde{\Omega}(\sqrt{n} + D)$ lower bound, as shown by Das Sarma~et~al.~\cite{das2011distributed}. We briefly outline the framework of the lower bound proof by Das Sarma~et~al., which has been applied to derive $\widetilde{\Omega}(\sqrt{n} + D)$ lower bounds for a variety of distributed problems.

To obtain the lower bound, $\Theta(\sqrt{n})$ paths of length $\Theta(\sqrt{n})$ are created between two players, Alice and Bob, with one bit of information stored at the endpoint of each path on Bob's side. A constant-degree overlay tree of depth $O(\log n)$ on the set of all vertices is added to shrink the diameter to $O(\log n)$. The goal is to design the graph so that, to solve the considered problem correctly, Alice must learn all the bits stored on Bob's side. This can be achieved in two ways: The bits can either be transmitted along the paths or across the trees. In the first case, the dilation is $\Omega(\sqrt{n})$, while in the second case, the congestion is $\Omega(\sqrt{n})$.

%\citet{manoharan2024computing} showed an $\widetilde{\Omega}(\sqrt{n} + D)$ lower bound for the \rpath{} problem in unweighted directed graphs by a reduction from the undirected $s$-$t$ subgraph connectivity problem, which admits an $\widetilde{\Omega}(\sqrt{n} + D)$ lower bound by the work of Das Sarma~et~al.~\cite{das2011distributed}. We briefly sketch the framework of lower bound proof of Das Sarma~et~al.~\cite{das2011distributed}, which has been used to give $\widetilde{\Omega}(\sqrt{n} + D)$ lower bounds for a wide range of problems. Construct $\Theta(\sqrt{n})$ paths of length $\Theta(\sqrt{n})$ across the two players, Alice and Bob, where we store one bit of information at the endpoint of each path in Bob's side. Add a constant-degree overlay tree of depth $O(\log n)$ on the set of all vertices to shrink the diameter to $O(\log n)$. The goal is to show that, to solve the considered problem correctly, Alice must learn all the bits stored in Bob' side. This can be done in two ways. The bits can be transmitted either across the paths or across the trees, In the first case, the dilation is $\Omega(\sqrt{n})$. In the second case, the congestion is $\Omega(\sqrt{n})$.

\paragraph{New approach.} We extend this framework to establish a higher lower bound of $\widetilde{\Omega}(n^{2/3} + D)$. To achieve this bound, we construct $\Theta(n^{1/3})$ paths of length $\Theta(n^{2/3})$ between two players.  

On Bob's side, we create a complete bipartite graph on the set of $\Theta(n^{1/3})$ endpoints, storing $\Theta(n^{2/3})$ bits of information as the orientations of the edges in the bipartite graph. On Alice's side, we construct an $s$-$t$ path $P$ of length $\Theta(n^{2/3})$.  

The core idea of our construction is to establish a one-to-one correspondence between each edge $e$ in $P$ and each edge $e'$ in the complete bipartite graph, such that the shortest replacement path length for $e$ is determined by the orientation of the edge $e'$. To achieve this, we will design the lower bound graph carefully: For a given edge orientation, the shortest replacement path for $e$ will go through $e'$, but this is not possible if $e'$ is oriented in the opposite direction, resulting in a higher replacement path length.


While the idea of encoding quadratic information using a complete bipartite graph has been utilized in various lower bound proofs in the $\CONGEST$ model~\cite{frischknecht2012networks,manoharan2024computingMinWeightCycleCONGEST,manoharan2024computing}, our lower bound graph construction differs significantly from previous approaches. For instance, in the proof of an $\Omega(\sqrt{nk})$ lower bound for $k$-source shortest paths and distance sensitivity oracle queries by \citet{manoharan2024distributed}, the construction is symmetric on both sides, with bipartite graphs present in both Alice’s and Bob’s parts. In their construction, the horizontal paths connecting Alice and Bob are used \emph{unidirectionally}, with only one side of each bipartite graph linked to these paths.

In contrast, our construction is asymmetric and leverages horizontal paths in a \emph{bidirectional} manner, connecting both sides of the bipartite graph to these paths and forming a detour-shaped network topology. This key distinction allows us to establish the desired lower bound for the \rpath{} problem in unweighted directed graphs. %encode a quadratic amount of information at the far end to create a hard instance. 
% \yijun{comments 1 and 2: moved to the technical overview section}


%A related line of work by \citet{manoharan2024distributed} established an $\Omega(\sqrt{nk})$ lower bound for $k$-source SSSP and lower bounds for Distance Sensitivity Oracle queries by extending the \citet{das2011distributed} framework with two bipartite graphs on both sides of the horizontal path structure. While both our construction and theirs utilize bipartite graphs as key components, they differ significantly in their structure and complexity. Specifically, their construction uses horizontal paths unidirectionally, with only one side of each bipartite graph connected to the horizontal paths. In contrast, our construction employs horizontal paths bidirectionally, with both sides of the bipartite graph connected to these paths, creating a detour-shaped network topology. This distinction in our approach enables us to encode a quadratic amount of information at the far end to create a hard instance.


%A related line of work by \citet{manoharan2024distributed} established an $\Omega(\sqrt{nk})$ lower bound for $k$-source SSSP and lower bounds for Distance Sensitivity Oracle queries by extending the \citet{das2011distributed} framework with two bipartite graphs on both sides of the horizontal path structure. While both our construction and theirs utilize bipartite graphs as key components, they differ significantly in their structure and complexity. Specifically, their construction uses horizontal paths unidirectionally, with only one side of each bipartite graph connected to the horizontal paths. In contrast, our construction employs horizontal paths bidirectionally, with both sides of the bipartite graph connected to these paths, creating a detour-shaped network topology. This distinction in our approach enables us to encode a quadratic amount of information at the far end to create a hard instance.
%\yanyu{address comment 1}
%The idea of encoding quadratic information through edge configurations has been previously explored in several contexts, including the weighted RPaths construction in \citet{manoharan2024computing}, minimum weight cycle computations in \citet{manoharan2024computingMinWeightCycleCONGEST}, and earlier work by \citet{frischknecht2012networks}.
%\yanyu{comment 2}


%In this work, we extend this framework to show a higher lower bound of $\widetilde{\Omega}(n^{2/3} + D)$. To achieve the desired bound, we construct $\Theta(n^{1/3})$ paths of length $\Theta(n^{2/3})$ across the two players.
%In Bob's side, we build a complete bipartite graph on the set of $\Theta(n^{1/3})$ endpoints, and we store  $\Theta(n^{2/3})$ bits of information as the orientation of the edges in the complete bipartite graph. In Alice's side, we create an $s$-$t$ path $P$ of length  $\Theta(n^{2/3})$. The idea of our construction is to get an one-to-one correspondence between each edge $e$ in $P$ and each edge $e'$ in the complete bipartite graph in such a way that the shortest replacement path length for $e$ is determined by the edge orientation of $e'$. We will design the lower bound graph properly to achieve this: For one choice of the edge orientation, we get a shorter replacement path by going through $e'$, and this is not possible if $e'$ is oriented in the other direction. 



%In this problem, given an undirected network $G$ with $n$ vertices, a subgraph $H$, and two vertices $s$ and $t$, the goal is to determine whether $s$ and $t$ are in the same connected component of $H$. Each vertex knows which of its incident edges are part of $H$, and there is a lower bound of $\Omega\left(\frac{\sqrt{n}}{\log n} + D\right)$ communication rounds, as shown in \cite{das2011distributed}, where $D$ is the diameter of $G$. The construction of $G'$ consists of two copies of $G$, one representing the subgraph $H$ (with bidirectional edges) and the other representing a directed shortest path between copies of the vertices $s$ and $t$. A third copy of $G$ is added to bound the undirected diameter of $G'$, ensuring that any communication in $G'$ can be simulated in a constant number of rounds in the original network. This construction shows that the lower bound for the \secsisp{} problem is $\Omega\left(\frac{\sqrt{n}}{\log n} + D\right)$, where $n$ is the number of vertices in $G$ and $D$ is the diameter of $G$. The \secsisp{} problem reduces to the \rpath{} problem with the same round complexity, as Alice and Bob can use the \rpath{} algorithm to compute a replacement path for each edge and output the shortest one. Additionally, this bound holds for any $\alpha$-approximation algorithm with $\alpha > 1$.  \TODO{}\hung{Input the idea of the lower bound.}


% For long detours, they use sampled vertices, constructing a reduced representation of the graph called a ``skeleton graph'' and broadcast operations to propagate distance information. 

% \gopinath{May be it is important to highlight why their approach had a dependency on $h_{st}$ and why we are able to remove it?}
% \hung{Done}
    
\subsection{Approximation Algorithm}\label{subsec:APX} %\citet{manoharan2024computing} present an $\widetilde{O}(n)$-round algorithm\yijun{this is not the algo that we want to compare with... the exact setting is very different} in the CONGEST model to compute Replacement Paths (\rpath{}) in directed weighted graphs. Their main idea is to transform the graph into a new graph, $G'$, by adding extra vertices and edges that help represent the replacement paths. After the transformation, they use a fast algorithm for all-pairs shortest paths (APSP) on $G'$, which can be efficiently simulated in the original network, to output \rpath{} of the original graph. For shorter paths, a simpler method using multiple single-source shortest path (SSSP) computations is used. 


\citet{manoharan2024computing} demonstrated that their algorithm for the \rpath{} problem in \emph{unweighted directed} graphs can be adapted to solve the $(1 + \epsilon)$-\apxrpath{} problem in \emph{weighted directed} graphs, maintaining the same round complexity of $ \widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$. The primary modification required is to replace the $k$-hop BFS computation with the $(1 + \epsilon)$-approximation $k$-hop shortest paths. It was shown by Nanongkai~\cite[Theorem 3.6]{nanongkai2014distributed} that the $(1 + \epsilon)$-approximation $k$-hop shortest paths from $c$ sources can be computed in $ \widetilde{O}(k + c + D)$ rounds with high probability.


%\citet{manoharan2024computing} showed that their algorithm for the \rpath{} problem in \emph{unweighted directed} graphs can be adapted to solve the $(1 + \epsilon)$-\apxrpath{} problem in \emph{weighted directed} graphs with the same round complexity $\widetilde{O}(n^{2/3} + \sqrt{n h_{st}} + D)$. Essentially the only modification needed is to replace the $k$-hop BFS computation with the $(1 + \epsilon)$-approximation $k$-hop SSSP. It was shown by Nanongkai~\cite[Theorem 3.6]{nanongkai2014distributed} that $(1 + \epsilon)$-approximation $k$-hop SSSP from $c$ sources can be computed in $\widetilde{O}(k+c+D)$ rounds with high probability.

\paragraph{New approach.} 
While the transformation into an approximation algorithm is straightforward in prior work, this is not the case for us, as we aim to avoid any dependence on $h_{st}$. In particular, we cannot afford to perform $k$-hop shortest paths simultaneously from all vertices in $P$, as this would result in a round complexity of $\widetilde{O}(k + h_{st} + D)$, which has a linear dependence on $h_{st}$. Such a congestion issue seems inherent to weighted directed graphs: It is possible that the $k$-hop BFS from all vertices in $P$ overlap at the same edge. 

To overcome this issue, we use rounding to reduce the weighted case to the unweighted case. This allows us to apply our approach for running BFS in the short-detour case mentioned above, which does not suffer from any congestion issues, as each vertex only propagates one BFS in each step.

Additionally, we need a different approach to utilize the BFS distances for computing the replacement path length, as a short detour can start and end at two vertices that are arbitrarily far apart in $P$. The high-level idea is similar but different to how we handle long detours in the unweighted case. We break the path into segments and handle \emph{nearby} and \emph{distant} short detours separately. Detours that start or end within the same segment can be handled locally within the segment. For detours that cross two segments, the rough idea is to let each segment locally compute the best detour to every other segment and broadcast the result. 




%\yijun{This is the algo that we want to compare with. The same idea (replacing BFS with SSSP) works everywhere, except for one place: We cannot afford to do $h$-hop SSSP simultaneously for all vertices in $P$. Doing this (using \cite{nanongkai2014distributed}) leads to a complexity of $h + h_{st}$, which has a linear dependence on $h_{st}$, which we don't want. To overcome this issue, we develop a rounding method to reduce the weighted case to unweighted case, allowing us to use our BFS algo directly: recall that our approach of running BFS does not have any congestion issue, as we only keep and propagate the best in each step. Also, we need to use a different approach to extract the BFS distances to compute replacement path length, as now a short detour can span a long hop-length in $P$. At a high level, the idea is similar to how we deal with long detour in the unweighted case. We break the path into segments and do dynamic programming internally and broadcast some information about the segments.}  \TODO{}\hung{Input our algorithm idea}



\input{shortdet}

\input{longdetour}

\input{lowerbound}

\input{wapprox}

% \section{Exact Algorithm for Weighted Directed Graphs}\label{sec:undirected}

% In this section, we prove \Cref{thm:undirected_UB}.

% \undirectedUB*

% \begin{proof}
% We may assume that each vertex $v_i$ in $P$ initially knows the basic information: its index $i$, the distance from $s$ to $v_i$, and the distance from $v_i$ to $t$. As discussed in \Cref{sec:prelim}, using \emph{weighted undirected} SSSP, we can let every vertex $v_i$ in $P$ learn the basic information in $O(\Tsssp)$ rounds.


% \end{proof}

% note: here learning the index/distance of all vertices in the given path $P$ can be done by SSSP, so no need to worry.
% \yijun{note: for Undirected Weighted Graphs, the UB and UB are also not matched due to an additive $h_{st}$, can we close it with our technique?}\yijun{Update: I think the answer is YES: we first use our short-detour algo (using $\sqrt{n}$ as the threshold) and then modify the proof of p17 of https://arxiv.org/pdf/2205.14797 to take care of only long detour. Specifically, divide the path into segments of length  $\sqrt{n}$ and compute the best detour avoiding each segment. This costs only SSSP + the number of segments $\leq\sqrt{n}$ rounds.}
% \yijun{ohhh.. it is actually a bit more complicated... cannot  }



\section{Conclusions and Open Problems}
\label{sec:conclusions}
In this work, by showing improved upper and lower bounds, we established that $\widetilde{\Theta}(n^{2/3} + D)$ is the \emph{tight} randomized round complexity bound for the replacement path problem in \emph{unweighted} directed graphs. Moreover, our upper bound extends to $(1+\epsilon)$-approximation for \emph{weighted} directed graphs.  Several intriguing questions remain open.

\begin{description}
\item[Weighted undirected graphs:] \citet{manoharan2024computing}  showed an upper bound of $O(\Tsssp + h_{st})$ for \rpath{} in \emph{weighted undirected} graphs, nearly matching their lower bound of $\widetilde{\Omega}(\sqrt{n}+D)$. Here $\Tsssp$ is the round complexity of the SSSP problem in weighted undirected graphs. It is known that $\Tsssp = \widetilde{\Omega}(\sqrt{n}+D)$~\cite{peleg2000near} and $\Tsssp = \widetilde{O}(\sqrt{n}+D) + n^{(2/5) + o(1)} \cdot O(D^{2/5})$~\cite{cao2023parallel}. For small-diameter graphs, the upper and lower bounds are matched up to the additive term $O(h_{st})$. Is it possible to eliminate this term?

    \item[Further lower bounds:] %A technical contribution of our work is to demonstrate that there is no inherent barrier to extending the lower bound framework of Das Sarma et~al.~\cite{das2011distributed} beyond $\widetilde{\Omega}(\sqrt{n})$. 
    A promising direction for future research is to develop new lower bounds from the lower bound framework of Das Sarma et~al.~\cite{das2011distributed} that are not restricted to the form $\widetilde{\Omega}(\sqrt{n})$, similar to our $\widetilde{\Omega}(n^{2/3})$ lower bound for the replacement path problem. Some potential problems to consider are as follows. For depth-first search, the state-of-the-art upper bound is $\widetilde{O}(\sqrt{Dn} + n^{3/4})$~\cite{ghaffari_et_al:LIPIcs.DISC.2017.21}, but no lower bound is known. For girth computation, there is still a gap between the upper bound $O(n)$~\cite{holzer2012optimal} and the lower bound $\widetilde{\Omega}(\sqrt{n})$~\cite{frischknecht2012networks}. More generally, for the problem of computing a minimum-weight cycle, the upper and lower bounds are not matched in many scenarios~\cite{manoharan2024computingMinWeightCycleCONGEST}.
    \item[Deterministic algorithms:] In our $\widetilde{O}(n^{2/3} + D)$-round algorithms, the way we compute long-detour replacement paths is inherently randomized. It remains an open question to determine the optimal deterministic complexity for the replacement path problem. Could the derandomization techniques developed in the deterministic APSP algorithms by Agarwal and Ramachandran~\cite{agarwal2018deterministic,agarwal2020faster} be applied to design efficient deterministic algorithms for the replacement path problem?
    \item[Approximation algorithms:] For $(1+\epsilon)$-approximation in weighted directed graphs, there is still a gap between our new upper bound $\widetilde{O}(n^{2/3} + D)$ and the existing lower bound $\widetilde{\Omega}(\sqrt{n} + D)$~\cite{manoharan2024computing}, as our new lower bound $\widetilde{\Omega}(n^{2/3} + D)$ does not extend to this setting. Is it possible to break the upper bound  $\widetilde{O}(n^{2/3} + D)$ for any constant-factor approximation? Even for the \emph{reachability} version of the replacement path problem, we do not know how to break the upper bound $\widetilde{O}(n^{2/3} + D)$.
    \item[Universal optimality:] A \emph{universally optimal} algorithm is one that, for any given input graph, achieves a round complexity matching that of the best algorithm specifically designed for that graph. Recent studies~\cite{universally_optimal_stoc2021,haeupler2022hop} demonstrated that several problems within the complexity class $\widetilde{\Theta}(\sqrt{n} + D)$---such as minimum spanning tree, $(1+\epsilon)$-approximate single-source shortest paths, and $(1+\epsilon)$-approximate minimum cut---admit approximately universally optimal algorithms in the $\CONGEST$ model. Given the similarities between the replacement path problem and these problems, particularly in the techniques used for both upper and lower bounds, is it possible to develop approximately universally optimal algorithms for the replacement path problem?
    \item[Distance sensitivity oracle:] In the \emph{distance sensitivity oracle} problem, the goal is to process the input graph so that future queries about the shortest-path distance from $s$ to $t$ avoiding $e$ can be answered efficiently, for any $s$, $t$, and $e$.
    Very recently, Manoharan and Ramachandran~\cite{manoharan2024distributed} presented the first distributed algorithms for the distance sensitivity oracle problem in the $\CONGEST$ model. Could the techniques introduced in our work help resolve the remaining open questions about the distance sensitivity oracle problem? Notably, a gap still exists between the upper and lower bounds for directed weighted graphs.

   % \item[Approximation for Weighted Case] \TODO{}
\end{description}

\section*{Acknowledgements}
We would like to thank Vignesh Manoharan and Vijaya Ramachandran for helpful discussions and comments.


% \nocite{*}
\printbibliography

\end{document}
