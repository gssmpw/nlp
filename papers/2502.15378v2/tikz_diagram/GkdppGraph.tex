\begin{tikzpicture}[scale=1.1]
\scriptsize
    % Define styles for different types of vertices
    \tikzset{
        vertex/.style={circle, draw, minimum size=4pt, inner sep=1pt, fill=white},
        filled/.style={circle, draw, fill=black, minimum size=4pt, inner sep=1pt},
        symbol/.style={inner sep=0pt, font=\small, text height=12pt},
        small/.style={font=\small},
        mapping/.style={teal!60!blue, thick},
        dir/.style={arrows = {-Stealth[inset=0.7pt, length=5pt, angle'=25]}},
        widedir/.style={arrows = {-Stealth[inset=0.7pt, length=5pt, angle'=35]}},
        highlight/.style={teal!70!green, thick},
        hlar/.style={highlight, dir},
        line/.style={gray, very thin, dir},
    }
    
    % Draw vertices on level A with labels
    \node[] at (-0.4,0) {$\mathcal{P}^1$};
    \node[vertex] (a) at (0,0) [label=below:$v^1_0$] {};
    \node[vertex] (b) at (1,0) [label=below:$v^1_1$] {};
    \node[vertex] (c) at (2,0) [label=below:$v^1_2$] {};
    \node[] (ca) at (3.5,0) {};
    % \node[] (ca2) at (3.5,0) {};
    \node[small] at (4,0) {$\cdots$};
    \node[] (cb) at (4.5,0) {};
    \node[vertex] (d) at (7.5,0) [label=right:{$v^1=v^1_{d^p-1}$}] {};

    \node[symbol] (dda) at (0,-0.7) {$\vdots$};
    \node[symbol] (ddb) at (1,-0.7) {$\vdots$};
    \node[symbol] (ddc) at (2,-0.7) {$\vdots$};
    \node[symbol] (ddd) at (6.6,-0.6) {$\iddots$};
    
    \node[symbol] (ddda) at (0,-3.8) {$\vdots$};
    \node[symbol] (dddb) at (1,-3.8) {$\vdots$};
    \node[symbol] (dddc) at (2,-3.8) {$\vdots$};
    \node[symbol] (dddd) at (6.6,-3.4) {$\ddots$};
    
    % Draw vertices on level B with labels
    \node[] at (-0.4,-1.2) {$\mathcal{P}^k$};
    \node[vertex] (e) at (0,-1.2) [label=below:$v^k_0$] {};
    \node[vertex] (f) at (1,-1.2) [label=below:$v^k_1$] {};
    \node[vertex] (g) at (2,-1.2) [label=below:$v^k_2$] {};
    \node[] (ga) at (3.5,-1.2) {};
    \node[small] at (4,-1.2) {$\cdots$};
    \node[] (gb) at (4.5,-1.2) {};
    \node[vertex] (h) at (6,-1.2) [label=below left:{$v^k$}] {};

    % Draw vertices on level C with labels
    \node[] at (-0.5,-2.8) {$\mathcal{P}^{k+1}$};
    \node[vertex] (e2) at (0,-3) [label=below:$w^1_0$] {};
    \node[vertex] (f2) at (1,-3) [label=below:$w^1_1$] {};
    \node[vertex] (g2) at (2,-3) [label=below:$w^1_2$] {};
    \node[] (ga2) at (3.5,-3) {};
    \node[small] at (4,-3) {$\cdots$};
    \node[] (gb2) at (4.5,-3) {};
    \node[vertex] (h2) at (6,-3) [label=below:{$w^1$}] {};
    
    
    % Draw vertices on level D with labels
    \node[] at (-0.5,-4) {$\mathcal{P}^{2k}$};
    \node[vertex] (i) at (0,-4.2) [label=below:$w^k_0$] {};
    \node[vertex] (j) at (1,-4.2) [label=below:$w^k_1$] {};
    \node[vertex] (k) at (2,-4.2) [label=below:$w^k_2$] {};
    \node[] (ka) at (3.5,-4.2) {};
    \node[small] at (4, -4.2) {$\cdots$};
    \node[] (kb) at (4.5,-4.2) {};
    \node[vertex] (l) at (7.5,-4.2) [label=below:{$w^k=w^k_{d^p-1}$}] {};
    
    % Draw tree structure vertices
    \begin{scope}[xshift=1.5mm, yshift=0mm]
        \node at (5,3) {$\mathcal{T}$};
        \node[vertex] (o) at (3.3,3.6) [label=right:$u_0^0$] {};
        
        \node (left) at (2.7,3.2) {};
        \node (right) at (4.1,3.0) {};
        
        \node[symbol] (eleft) at (2.4,3.1) {$\iddots$};
        \node[symbol] (eright) at (4.5,2.7) {$\ddots$};
        \node[small] (mid) at (4,1) {$\cdots$};
        \node[vertex] (pq) at (2,2.8) {};
        
        \node[vertex] (p) at (1,2) [label=right:$u^{p-1}_0$] {};
        \node[vertex] (q) at (2.9,2) [label=right:$u^{p-1}_1$] {};
        \node[vertex] (qq) at (5.1,2) {};
        
        \node[filled] (s) at (0.5,) [label=above left:{$\alpha=u^p_0$}] {};
        \node[vertex] (m) at (1.5,1) [label=left:$u^p_1$] {};
        \node[vertex] (n) at (2.5,1) [label=left:$u^p_2$] {};
        \node[vertex] (nn) at (3.3,1) {};
        \node[vertex] (rl) at (4.7,1) {};
        \node[filled] (r) at (5.5,1) [label=above right:{$\beta=u^p_{d^p-1}$}] {};
    \end{scope}
    % Draw path connections
    \draw[dir, highlight] (a) -- (b) -- (c) -- (ca);
    \draw[dir] (e) -- (f) -- (g) -- (ga);
    \draw[dir] (ga2) -- (g2) -- (f2) -- (e2);
    \draw[dir, highlight] (ka) -- (k) -- (j) -- (i);
    \draw[dir, highlight] (cb) -- (d);
    \draw[dir] (gb) -- (h);
    \draw[dir] (h2) -- (gb2);
    \draw[dir, highlight] (l) -- (kb);
    
    % Draw tree connections
    \draw[line] (o) -- (left);
    \draw[line] (o) -- (right);
    \draw[line] (pq) -- (p);
    \draw[line] (pq) -- (q);
    \draw[line] (p) -- (s);
    \draw[line] (p) -- (m);
    \draw[line] (q) -- (n);
    \draw[line] (q) -- (nn);
    \draw[line] (qq) -- (r);
    \draw[line] (qq) -- (rl);
    
    \draw[line] (s) to [out=269,in=35] (a);
    \draw[line] (s) to [out=269,in=50] (e);
    \draw[line] (s) to [out=272,in=60] (e2);
    \draw[line] (s) to [out=275,in=60] (i);
    
    \draw[line] (m) to [out=269,in=35] (b);
    \draw[line] (m) to [out=269,in=50] (f);
    \draw[line] (m) to [out=272,in=60] (f2);
    \draw[line] (m) to [out=275,in=60] (j);
    
    \draw[line] (n) to [out=268,in=35] (c);
    \draw[line] (n) to [out=269,in=50] (g);
    \draw[line] (n) to [out=272,in=60] (g2);
    \draw[line] (n) to [out=275,in=60] (k);
    
    \draw[line] (r) to [out=355,in=115] (d);
    \draw[line] (r) to [out=300,in=85] (h);
    \draw[line] (r) to [out=260,in=120, looseness=1] (h2);
    \draw[line] (r) to [out=258,in=175, looseness=1.2] (l);

    % Bipartite graph mapped from the string y
    \node (vl) at (6.95,-0.25) {};
    \node (wl) at (6.95,-3.85) {};
    \draw[dir, mapping] (d) -- (h2);
    \draw[dir, mapping] (d) -- (wl);
    \draw[dir, mapping] (vl) -- (l);
    \draw[dir, mapping] (wl) -- (vl);
    \draw[dir, mapping] (vl) -- (h2);
    \draw[dir, mapping] (h) -- (l);
    \draw[dir, mapping] (h2) -- (h);
    \draw[dir, mapping] (wl) -- (h);
    \draw[widedir, highlight, very thick] (d) -- (l);

    \begin{scope}[xshift=-35mm, yshift=-1mm]
        \node[vertex] (s0) at (0,-4) [label=left:{$s=s_0$}] {};
        \node[vertex] (s1) at (0,-3) [label=left:$s_1$] {};
        \node[symbol] (s2) at (0,-2) {$\vdots$};
        \node[vertex] (sj) at (0,-1) [label=below left:$s_{i-1}$] {};
        \node[vertex] (si) at (0,0) [label=below left:$s_i$] {};
        \node[symbol] (s5) at (0,1) {$\vdots$};
        \node[vertex] (st) at (0,2) [label=below left:{$t=s_{k^2}$}] {};
        \node[symbol] (Pstar) at (-0.1,2.52)  {$\mathcal{P}^*$};

        \draw[dir, highlight] (s0) -- (s1);
        \draw[dir, highlight] (s1) -- (s2);
        \draw[dir, highlight] (s2) -- (sj);
        \draw[dir, red, thick] (sj) -- (si);
        \draw[dir, highlight] (si) -- (s5);
        \draw[dir, highlight] (s5) -- (st);

        \node[symbol] (Q)  at (1.2,2.5)    {$\mathcal{Q}^1$};
        \node[vertex] (q0)  at (1.3,-4)     [label=right:{$q^1_0$}] {};
        \node[vertex] (q05) at (1.3,-3.5) [label=right:{$q^1_1$}] {};
        \node[vertex] (q1)  at (1.3,-3)    [label=right:{$q^1_2$}] {};
        \node[symbol] (q2)  at (1.3,-2) {$\vdots$};
        \node[vertex] (qj)  at (1.3,-1)    [label=below right:$q^1_{2i-2}$]{};
        \node[vertex] (qji) at (1.3,-0.5) [label=right:$q^1_{2i-1}$]{};
        \node[vertex] (qi)  at (1.3,0)     [label=right:$q^1_{2i}$] {};
        \node[symbol] (q5)  at (1.3,1) {$\vdots$};
        \node[vertex] (qt)  at (1.3,2)     [label=below right:{$q^1_{2k^2}$}] {};

        \draw[dir] (q0)  -- (q05);
        \draw[dir] (q05) -- (q1);
        \draw[dir] (q1)  -- (q2);
        \draw[dir] (q2)  -- (qj);
        \draw[dir, highlight] (qj)  -- (qji);
        \draw[dir, highlight] (qji) -- (qi);
        \draw[dir, highlight] (qi)  -- (q5);
        \draw[dir, highlight] (q5)  -- (qt);

        \node[symbol] (r)  at (-1.5,2.55)    {$\mathcal{R}^k$};
        \node[vertex] (r0)  at (-1.5,-4)    [label=left:{$r^k_0$}] {};
        \node[vertex] (r05) at (-1.5,-3.5)  [label=left:{$r^k_1$}] {};
        \node[vertex] (r1)  at (-1.5,-3)    [label=left:{$r^k_2$}] {};
        \node[symbol] (r2)  at (-1.5,-2) {$\vdots$};
        \node[vertex] (rj)  at (-1.5,-1)    [label=left:$r^k_{2i-2}$]{};
        \node[vertex] (rji) at (-1.5,-0.5)  [label=left:$r^k_{2i-1}$]{};
        \node[vertex] (ri)  at (-1.5,0)     [label=above left:$r^k_{2i}$] {};
        \node[symbol] (r5)  at (-1.5,1) {$\vdots$};
        \node[vertex] (rt)  at (-1.5,2)     [label=below left:{$r^k_{2k^2}$}] {};

        \draw[dir, highlight] (r0)  -- (r05);
        \draw[dir, highlight] (r05) -- (r1);
        \draw[dir, highlight] (r1)  -- (r2);
        \draw[dir, highlight] (r2)  -- (rj);
        \draw[dir, highlight] (rj)  -- (rji);
        \draw[dir, highlight] (rji) -- (ri);
        \draw[dir] (ri)  -- (r5);
        \draw[dir] (r5)  -- (rt);
        
        \draw[hlar] (ri)  to [out=20,in=165] (si);
        \draw[hlar] (sj)  to [out=345,in=200] (qj);
    \end{scope}

    \draw[dir, highlight] (qt)  to [out=30,in=120] (a);
    \draw[dir, highlight] (i)  to [out=200,in=320] (r0);
    \node[symbol] (PPP)  at (-1.5,-5) {{\color{teal!70!green}$P$}};
\end{tikzpicture}