%%
%% This is file `sample-sigconf.tex',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% samples.dtx  (with options: `all,proceedings,bibtex,sigconf')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from sample-sigconf.tex.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file samples.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
%%
%%
%% Commands for TeXCount
%TC:macro \cite [option:text,text]
%TC:macro \citep [option:text,text]
%TC:macro \citet [option:text,text]
%TC:envir table 0 1
%TC:envir table* 0 1
%TC:envir tabular [ignore] word
%TC:envir displaymath 0 word
%TC:envir math 0 word
%TC:envir comment 0 0
%%
%%
%% The first command in your LaTeX source must be the \documentclass
%% command.
%%
%% For submission and review of your manuscript please change the
%% command to \documentclass[manuscript, screen, review]{acmart}.
%%
%% When submitting camera ready or to TAPS, please change the command
%% to \documentclass[sigconf]{acmart} or whichever template is required
%% for your publication.
%%
%%

\documentclass[sigconf]{acmart}
\usepackage{url}
\usepackage{array}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{amsmath}
\usepackage{wrapfig}
\usepackage{multirow}
% \usepackage{changes}
\usepackage{subcaption}
\usepackage{fvextra}
\usepackage{listings}
\usepackage{float}

%%
%% \BibTeX command to typeset BibTeX logo in the docs
\AtBeginDocument{%
  \providecommand\BibTeX{{%
    Bib\TeX}}}
    

\copyrightyear{2025}
\acmYear{2025}
\setcopyright{cc}
\setcctype{by}
\acmConference[WWW Companion '25]{Companion Proceedings of the ACM Web
Conference 2025}{April 28-May 2, 2025}{Sydney, NSW, Australia}
\acmBooktitle{Companion Proceedings of the ACM Web Conference 2025 (WWW
Companion '25), April 28-May 2, 2025, Sydney, NSW, Australia}
\acmDOI{10.1145/3701716.3715225}
\acmISBN{979-8-4007-1331-6/2025/04}


%% end of the preamble, start of the body of the document source.
\begin{document}

%%
%% The "title" command has an optional parameter,
%% allowing the author to define a "short title" to be used in page headers.
\title{Flow-of-Action: SOP Enhanced LLM-Based Multi-Agent System for Root Cause Analysis}


\author{Changhua Pei}
\email{chpei@cnic.cn}
\affiliation{%
  \institution{Computer Network Information Center, Chinese Academy of Sciences}
  \city{Beijing}
  \country{China}
}
\additionalaffiliation{
  \institution{Hangzhou Institute for Advanced Study, University of Chinese Academy of Sciences}
  \city{Hangzhou}
  \country{China}
}


\author{Zexin Wang}
% \authornotemark[1]
\email{wangzexin@cnic.cn}
\affiliation{%
  \institution{Computer Network Information Center, Chinese Academy of Sciences}
  \city{Beijing}
  \country{China}
}
\additionalaffiliation{%
  \institution{University of Chinese Academy of Sciences}
  \city{Beijing}
  \country{China}
}
\authornote{Also with ByteDance. Work done during the internship at ByteDance.}



\author{Fengrui Liu}
\email{liufengrui.work@bytedance.com}
\author{Zeyan Li}
\email{lizeyan.42@bytedance.com}
\affiliation{%
  \institution{ByteDance}
  \city{Beijing}
  \country{China}
}

\author{Yang Liu}
\authornotemark[2]
\email{liuyang@cnic.cn}
\affiliation{%
  \institution{Computer Network Information Center, Chinese Academy of Sciences}
  \city{Beijing}
  \country{China}
}
% \additionalaffiliation{%
%   \institution{University of Chinese Academy of Sciences}
%   \city{Beijing}
%   \country{China}
% }

\author{Xiao He}
\email{xiao.hx@bytedance.com}
\affiliation{%
  \institution{ByteDance}
  \city{Hangzhou}
  \country{China}
}

\author{Rong Kang}
\email{kangrong.cn@bytedance.com}
\affiliation{%
  \institution{ByteDance}
  \city{Beijing}
  \country{China}
}

\author{Tieying Zhang}
\authornotemark[4]
\email{tieying.zhang@bytedance.com}
\author{Jianjun Chen}
\email{jianjun.chen@bytedance.com}
\affiliation{%
  \institution{ByteDance}
  \city{San Jose}
  \country{United States}
}


\author{Jianhui Li}
\authornote{ Corresponding Authors.}
\email{lijh@cnic.cn}
\author{Gaogang Xie}
\email{xie@cnic.cn}
\affiliation{%
  \institution{Computer Network Information Center, Chinese Academy of Sciences}
  \city{Beijing}
  \country{China}
}

\author{Dan Pei}
\email{peidan@tsinghua.edu.cn}
\affiliation{%
  \institution{Tsinghua University}
  \city{Beijing}
  \country{China}
}


\renewcommand{\shortauthors}{Changhua Pei et al.}


\begin{abstract}
In the realm of microservices architecture, the occurrence of frequent incidents necessitates the employment of Root Cause Analysis (RCA) for swift issue resolution. It is common that a serious incident can take several domain experts hours to identify the root cause. Consequently, a contemporary trend involves harnessing Large Language Models (LLMs) as automated agents for RCA. Though the recent ReAct framework aligns well with the Site Reliability Engineers (SREs) for its thought-action-observation paradigm, its hallucinations often lead to irrelevant actions and directly affect subsequent results. Additionally, the complex and variable clues of the incident can overwhelm the model one step further. To confront these challenges, we propose \textbf{Flow-of-Action}, a pioneering Standard Operation Procedure (SOP) enhanced LLM-based multi-agent system. By explicitly summarizing the diagnosis steps of SREs, SOP imposes constraints on LLMs at crucial junctures, guiding the RCA process towards the correct trajectory. To facilitate the rational and effective utilization of SOPs, we design an SOP-centric framework called \textbf{SOP flow}. SOP flow contains a series of tools, including one for finding relevant SOPs for incidents, another for automatically generating SOPs for incidents without relevant ones, and a tool for converting SOPs into code. This significantly alleviates the hallucination issues of ReAct in RCA tasks. We also design multiple auxiliary agents to assist the main agent by removing useless noise, narrowing the search space, and informing the main agent whether the RCA procedure can stop. Compared to the ReAct method's 35.50\% accuracy, our Flow-of-Action method achieves 64.01\%, meeting the accuracy requirements for RCA in real-world systems.
\end{abstract}



\begin{CCSXML}
<ccs2012>
   <concept>
       <concept_id>10011007.10011006.10011073</concept_id>
       <concept_desc>Software and its engineering~Software maintenance tools</concept_desc>
       <concept_significance>300</concept_significance>
       </concept>
 </ccs2012>
\end{CCSXML}

\ccsdesc[300]{Software and its engineering~Software maintenance tools}

\keywords{Root Cause Analysis, Multi-Agent System, Large Language Model}

\maketitle

\section{Introduction}
\input{intro}
\label{intro}

\section{Flow-of-Action}
\input{method}
\label{method}

\section{Evaluation}
\input{evaluation}
\label{evaluation}

\section{Conclusion}
\input{conclusion}
\label{conclusion}

\section{Acknowledgment}
\input{acknowledgement}

% \begin{acks}
% To Robert, for the bagels and explaining CMYK and color spaces.
% \end{acks}

%%
%% The next two lines define the bibliography style to be used, and
%% the bibliography file.
\bibliographystyle{ACM-Reference-Format}
\bibliography{ref}


%%
%% If your work has an appendix, this is the place to put it.
\appendix

\section{Multimodal Data Collection}
\label{multidata}

We first deploy various data collection systems (Figure \ref{prometheus}, Figure \ref{deepflow}, Figure \ref{jaejer}, Figure \ref{elastic}). For metrics, we start by deploying Prometheus, which collects architecture-level metrics, such as pod-level and node-level indicators that are generally standardized and unrelated to business logic. Additionally, we deploy DeepFlow to gather business-level metrics, such as business traffic data. For anomaly detection, we use traditional rule-based methods because they are fast and convenient.

For trace data, we deploy Jaeger to collect all trace data, where each trace represents a call chain containing multiple spans, with each span corresponding to a single call. Anomalies can occur within any span. In the current environment, detecting trace anomalies is relatively straightforward, as a span failure typically includes an associated error message. Therefore, we directly extract error messages to generate alert reports. For log data, we use Elastic for collection. Since abnormal logs usually contain specific keywords, extracting anomalies based on keywords has become widely accepted. We also adopt this keyword-based approach for log anomaly detection.



% \begin{figure}[H]
%     \centering
%     \includegraphics[width=\textwidth]{pic/prometheus.png}
%     \caption{Prometheus Dashboard.}
%     \label{fig:example}
% \end{figure}

\begin{figure}[H]
\centerline{\includegraphics[scale=0.24]{pic/prometheus.png}}
\caption{Prometheus Dashboard.}
\label{prometheus}
\end{figure}

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=\textwidth]{pic/deepflow.png}
%     \caption{Deepflow Dashboard.}
%     \label{fig:example}
% \end{figure}

\begin{figure}[H]
\centerline{\includegraphics[scale=0.14]{pic/deepflow.png}}
\caption{Deepflow Dashboard.}
\label{deepflow}
\end{figure}

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=\textwidth]{pic/jaeger.png}
%     \caption{Jaeger Dashboard.}
%     \label{fig:example}
% \end{figure}


\begin{figure}[H]
\centerline{\includegraphics[scale=0.12]{pic/jaeger.png}}
\caption{Jaeger Dashboard.}
\label{jaejer}
\end{figure}

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=\textwidth]{pic/elastic.png}
%     \caption{Elastic Dashboard.}
%     \label{fig:example}
% \end{figure}


\begin{figure}[H]
\centerline{\includegraphics[scale=0.12]{pic/elastic.png}}
\caption{Elastic Dashboard.}
\label{elastic}
\end{figure}

\section{Tools}
\label{apendixb}

\begin{table}[H]
\centering
\caption{Description of Tools}
\label{tab:tools}
\small
\begin{tabular}{p{0.15\textwidth}p{0.22\textwidth}} 
\toprule
\multicolumn{1}{c}{Tool} & \multicolumn{1}{c}{Description}                                                                                                                                                                                                                                                                                                     \\ 
\midrule
pod\_analyze             & Analyzing all pods' status.                                                                                                                                                                          \\
node\_analyze            & Analyzing all nodes' status.                                                                                                                                                                     \\
service\_analyze         & Analyzing all services' status.                                                                                                                                                         \\
deployment\_analyze      & Analyzing all deployments' status.    \\
statefulset\_analyze     & Analyzing all statefulsets' status.                                                                                                                                                                                       \\
run\_kubectl\_command    & Executing kubectl commands generated by LLMs.                                                                                                                                          \\
get\_all\_namespace      & Obtaining a list of all namespaces.                        \\

get\_relevant\_metric      & Obtaining relevant metric names according to query.                        \\
\bottomrule
\end{tabular}
\end{table}

\end{document}
\endinput
%%
%% End of file `sample-sigconf.tex'.
