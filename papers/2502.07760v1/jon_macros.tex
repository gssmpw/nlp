\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\QQ}{\mathbb{Q}}
\DeclareMathOperator{\EE}{\mathbb{E}}
\DeclareMathOperator{\PP}{\mathbb{P}}
\newcommand{\MM}{\mathbb{M}}

\newcommand{\blank}{\mathrel{\,\cdot\,}}

\DeclareMathOperator{\trace}{Tr}
\DeclareMathOperator{\vspan}{span}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\range}{range}
\DeclareMathOperator{\nullity}{nullity}
\DeclareMathOperator{\proj}{proj}
\DeclareMathOperator{\mvec}{vec}
\DeclareMathOperator{\var}{Var}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\spec}{spec}
\DeclareMathOperator{\symdif}{\vartriangle}
\DeclareMathOperator*{\argmax}{\arg\!\max}
\DeclareMathOperator*{\argmin}{\arg\!\min}
\DeclarePairedDelimiter\angles{\langle}{\rangle}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\DeclarePairedDelimiter\del{\lparen}{\rparen}
\let\set\relax
\DeclarePairedDelimiter\set{\lbrace}{\rbrace}
\DeclarePairedDelimiter\abs{\lvert}{\rvert}
\usepackage{etoolbox}
\DeclarePairedDelimiterX\norm[1]\lVert\rVert{\ifblank{#1}{\blank}{#1}}
\DeclarePairedDelimiter\sbr{\lbrack}{\rbrack}
\DeclarePairedDelimiter\inner{\langle}{\rangle}
\DeclarePairedDelimiter\intoc{\lparen}{\rbrack}
\DeclarePairedDelimiter\intco{\lbrack}{\rparen}
\DeclarePairedDelimiter\eval{}{\rvert}

\newcommand{\dif}{\mathop{}\!\mathrm{d}}
\newcommand{\Dif}{\mathop{}\!\mathrm{D}}
\newcommand{\nleftrightharpoons}{\not\hspace{-1pt}\leftrightharpoons}
\newcommand{\textmultinom}[2]{\bigl(\kern-0.3em{\binom{#1}{#2}}\kern-0.3em\bigr)}
\newcommand{\displaymultinom}[2]{\left(\kern-0.5em{\binom{#1}{#2}}\kern-0.5em\right)}
\newcommand\multinom[2]{\mathchoice{\displaymultinom{#1}{#2}}{\textmultinom{#1}{#2}} {\textmultinom{#1}{#2}}{\textmultinom{#1}{#2}}}

\providecommand\given{\errmessage{\noexpand\given used outside \noexpand\DelGivenX}}
\DeclarePairedDelimiterX{\DelGivenX}[1]{\lparen}{\rparen}{%
  \renewcommand\given{\mathclose{}\,\delimsize\vert\allowbreak\,\mathopen{}}#1%
}
\DeclarePairedDelimiterX{\SbrGivenX}[1]{\lbrack}{\rbrack}{%
  \renewcommand\given{\mathclose{}\,\delimsize\vert\allowbreak\,\mathopen{}}#1%
}
\DeclarePairedDelimiterX{\SetGivenX}[1]{\lbrace}{\rbrace}{%
  \renewcommand\given{\mathclose{}\,\delimsize\vert\allowbreak\,\mathopen{}}#1%
}
\providecommand\from{\errmessage{\noexpand\from used outside \noexpand\DelGivenX}}
\DeclarePairedDelimiterX{\DelFromX}[1]{\lparen}{\rparen}{%
  \renewcommand\from{\mathclose{}\,\delimsize\Vert\allowbreak\,\mathopen{}}#1%
}
\newcommand{\ent}{\operatorname{\mathsf S}\DelFromX}
\newcommand{\kldiv}{\operatorname{\mathsf{KL}}\DelFromX}
\newcommand{\info}{\operatorname{\mathsf I}\DelGivenX}
\newcommand{\entangle}{\operatorname{\mathsf E}\del}
\newcommand{\sqent}{\operatorname{\mathsf E}^{\mathrm{sq}}\del}

\makeatletter
\newcommand{\spx}[1]{%
\if\relax\detokenize{#1}\relax
\expandafter\@gobble
\else
\expandafter\@firstofone
\fi
{^{#1}}%
}

\newcommand\pd[3][]{\frac{\partial\spx{#1}#2}{\partial#3\spx{#1}}}
\newcommand\tpd[3][]{\tfrac{\partial\spx{#1}#2}{\partial#3\spx{#1}}}
\newcommand\dpd[3][]{\dfrac{\partial\spx{#1}#2}{\partial#3\spx{#1}}}
\newcommand\spd[3][]{\sfrac{\partial\spx{#1}#2}{\partial#3\spx{#1}}}

\newcommand{\md}[6]{\frac{\partial\spx{#2}#1}{\partial#3\spx{#4}\partial#5\spx{#6}}}
\newcommand{\tmd}[6]{\tfrac{\partial\spx{#2}#1}{\partial#3\spx{#4}\partial#5\spx{#6}}}
\newcommand{\dmd}[6]{\dfrac{\partial\spx{#2}#1}{\partial#3\spx{#4}\partial#5\spx{#6}}}
\newcommand{\smd}[6]{\sfrac{\partial\spx{#2}#1}{\partial#3\spx{#4}\partial#5\spx{#6}}}

\newcommand{\od}[3][]{\frac{\dif\spx{#1}#2}{\dif#3\spx{#1}}}
\newcommand{\tod}[3][]{\tfrac{\dif\spx{#1}#2}{\dif#3\spx{#1}}}
\newcommand{\dod}[3][]{\dfrac{\dif\spx{#1}#2}{\dif#3\spx{#1}}}
\newcommand{\sod}[3][]{\sfrac{\dif\spx{#1}#2}{\dif#3\spx{#1}}}

\makeatother

\newcommand{\z}[1]{\rlap{\,#1}}

\renewcommand{\Pr}{\mathbb{P}\DelGivenX}
\newcommand{\E}{\mathbb{E}\SbrGivenX}
\newcommand{\ind}{\mathbf{1}\set}
\newcommand{\vsmask}[2]{\Pi_{#2}\del{#1}}
\newcommand{\setcompl}[1]{\overline{#1}}
\newcommand{\ssep}{\mid}
\newcommand{\dpsd}{d_{\mathrm{PD}}}
\newcommand{\bigO}{O}