% CVPR 2025 Paper Template; see https://github.com/cvpr-org/author-kit

\documentclass[twocolumn,letterpaper]{article}

%%%%%%%%% PAPER TYPE  - PLEASE UPDATE FOR FINAL VERSION
% \usepackage{cvpr}              % To produce the CAMERA-READY version
\usepackage{cvpr}      % To produce the REVIEW version
\usepackage{times}  % DO NOT CHANGE THIS
\usepackage{helvet}  % DO NOT CHANGE THIS
\usepackage{courier}  % DO NOT CHANGE THIS
\usepackage[hyphens]{url}  % DO NOT CHANGE THIS
\usepackage{graphicx} % DO NOT CHANGE THIS
\urlstyle{rm} % DO NOT CHANGE THIS
\def\UrlFont{\rm}  % DO NOT CHANGE THIS
\usepackage{natbib}  % DO NOT CHANGE THIS AND DO NOT ADD ANY OPTIONS TO IT
\usepackage{caption} % DO NOT CHANGE THIS AND DO NOT ADD ANY OPTIONS TO IT
\frenchspacing  % DO NOT CHANGE THIS
\setlength{\pdfpagewidth}{8.5in} % DO NOT CHANGE THIS
\setlength{\pdfpageheight}{11in} % DO NOT CHANGE THIS
%
% These are recommended to typeset algorithms but not required. See the subsubsection on algorithms. Remove them if you don't have algorithms in your paper.
\usepackage{algorithm}
\usepackage{algorithmic,amssymb,amsmath}
\usepackage{pifont,bbding,multirow}
\usepackage{array}
%
% These are are recommended to typeset listings but not required. See the subsubsection on listing. Remove this block if you don't have listings in your paper.
\usepackage{newfloat}
\usepackage{listings}
\usepackage{xcolor}

\definecolor{mypink1}{rgb}{0.858, 0.188, 0.478}
\definecolor{green}{rgb}{0.158, 0.8, 0.3}
\newcommand{\bbrevised}[1]{\textcolor{mypink1}{#1}}


\DeclareCaptionStyle{ruled}{labelfont=normalfont,labelsep=colon,strut=off} % DO NOT CHANGE THIS
\lstset{%
	basicstyle={\footnotesize\ttfamily},% footnotesize acceptable for monospace
	numbers=left,numberstyle=\footnotesize,xleftmargin=2em,% show line numbers, remove this entire line if you don't want the numbers.
	aboveskip=0pt,belowskip=0pt,%
	showstringspaces=false,tabsize=2,breaklines=true}
\floatstyle{ruled}
\newfloat{listing}{tb}{lst}{}
\floatname{listing}{Listing}
%
% Keep the \pdfinfo as shown here. There's no need
% for you to add the /Title and /Author tags.
\pdfinfo{
/TemplateVersion (2025.1)
}

\setcounter{secnumdepth}{0} %May be changed to 1 or 2 if section numbers are desired.


%%%%%%%%% TITLE - PLEASE UPDATE
\title{Supplemental Material: Expertized Caption Auto-Enhancement for Video-Text Retrieval}

%%%%%%%%% AUTHORS - PLEASE UPDATE
\author{
Junxiang Chen\\
WeChat, Tencent\\
{\tt\small caryjxchen@tencent.com}
\and
Wenbin Yao\\
WeChat, Tencent\\
{\tt\small wenbinyao@tencent.com}
\and
Baoyao Yang\thanks{Corresponding author.}\\
Guangdong University of Technology\\
{\tt\small ybaoyao@gdut.edu.cn}
}


\setlength{\parskip}{0pt}
\usepackage{bibentry}
\raggedbottom


\begin{document}
\maketitle

\subsection*{A. Prompts and examples of video-derived captions}
%We designed an algorithm that leverages GPT-4 to automate the enhancement of prompts for video caption generation. 

Table \ref{tab:prompt} lists the refined prompts obtained by the \textit{Prompt Engineer} in the CSI module. Initially, we start with a basic prompt aimed at producing captions from various perspectives, \textit{i.e.}, \textit{``Generate 10 captions from different perspectives about this video."} With iterations of CSI module, the prompt asking the \textit{Captioner} would include more precise and relevant terms, such as actions, behaviors, and detailed visual elements, as shown in the last row of Table \ref{tab:prompt}. More intuitively, we show examples of generated captions in Table \ref{tab:captions}.

\begin{table}[h]
    \centering
    \begin{tabular}{@{}c|m{6.8cm}@{}}
        \hline
        \textbf{\textit{Iter.}} & \textbf{Prompt} \\
        \hline
        0 & Generate 10 captions from different perspectives about this video. \\
        \hline
        1 & Generate 10 unique captions for the provided video frame, each from a different perspective. \\
        \hline
        2 & ...\\
        \hline
        last/2 & Generate 10 unique captions for the provided video frame, each from a different perspective. Ensure that each caption captures key elements such as actions, emotions, and visual details. The captions should be concise yet descriptive, providing a clear understanding of what is happening in the frame. \\
        \hline
        ... & ... \\
        \hline
         last & Generate 10 unique captions from different perspectives for the provided video frames. The goal is to create captions that accurately reflect the content and context of the video frames, capturing key elements such as actions, emotions, and visual details. Each caption should be concise yet descriptive, providing a clear understanding of what is happening in the frame. The target captions should indicate that this is a car review video. Example target caption:... \\
        \hline
    \end{tabular}
    \caption{Prompt of each iteration in the CSI module}
    \label{tab:prompt}
\end{table}

\subsection*{B. Pseudo code of the CSI module}
Pseudo code of the CSI module is shown in Algorithm \ref{alg:CSI}. Take the initial prompt \textit{(init)} and video-text pairs (data) as inputs, CSI iteratively update the best prompt by comparing current score to the best one until there is no improvement. 

\begin{algorithm}[h]
\caption{Caption Self-improvement (CSI) algorithm}
\label{alg:algorithm}
\begin{algorithmic}[1] 
\REQUIRE init, data
\ENSURE best\_prompt, best\_score
\STATE prompt, best\_prompt $\leftarrow$ init
\STATE best\_score, score $\leftarrow -\infty, -\infty$
\STATE no\_improve, max\_no\_improve $\leftarrow 0, 2$
\WHILE{no\_improve \textless max\_no\_improve}
    \STATE improved $\leftarrow$ \textbf{false}
    \FOR{batch in data}
        \STATE \textit{// Generate captions}
        \STATE g\_captions $\leftarrow$ GenCaps(batch.video, prompt) 
        \STATE \textit{// Current score calculation}
        \STATE score\_sim $\leftarrow$ Sim(batch.caption, g\_captions) 
        \STATE score\_div $\leftarrow$ Div(g\_captions)  
        \STATE score $\leftarrow$ (score\_sim + score\_div) / batch\_size  
        \STATE \textit{// Update for the best score}
        \IF{score \textgreater ~ best\_score}  
            \STATE best\_score $\leftarrow$ score
            \STATE best\_prompt $\leftarrow$ prompt
            \STATE improved $\leftarrow$ \textbf{true}
        \ENDIF
        \STATE prompts $\leftarrow$ RePrompt(batch.video, batch.caption, best\_prompt)
        \STATE prompt $\leftarrow$ SumPrompts(prompts)
    \ENDFOR
    \STATE no\_improve $\leftarrow$ 0 \textbf{if} improved \textbf{else} no\_improve + 1
\ENDWHILE

\RETURN best\_prompt, best\_score

\end{algorithmic}
\label{alg:CSI}
\end{algorithm}



\begin{table*}[ht!]
	\centering
	\begin{tabular}{c|l|p{12cm}}
	\hline
  Dataset &  ID & Video-derived captions\\
    \hline
  \multirow{10}{*}{} & \multirow{10}{*}{} & 1. Women conversing in an office, one asking the other to hand over a cigarette pack. \\
   & & 2. A woman with curly hair smiles as she responds to a question in the office. \\
   & & 3. A serious woman with black hair asks for confirmation about giving her cigarette pack. \\
   & & 4. The black-haired woman shows a shocked or confused expression in the office. \\
   MSR-VTT&video6480 & 5. The black-haired woman driving a car, looking stern, while surrounded by motorcycles in traffic. \\
   & & 6. A close-up of the woman driving, looking alarmed as motorcycles pass by her car. \\
   & & 7. A silhouette of the woman peering through a doorway into a dark room. \\
   & & 8. Walking down a dimly lit street, a man tells the woman that introducing him will resolve a conflict. \\
   & & 9. The woman and the man continue their conversation about introductions while walking at night. \\
   & & 10. The woman gestures emphatically towards the man as they discuss introductions on the nighttime street. \\
        \hline
   \multirow{10}{*}{} & \multirow{10}{*}{} & 1. A man in a blue shirt demonstrates precision, swinging a sword towards a water bottle in a serene outdoor setting. \\
   & & 2. The moment of impact captured as the sword meets the water bottle, sending a splash into the air. \\
   & & 3. Focused and intense, the man prepares for his next move against the stationary water bottle. \\
   & & 4. In a split second, the water bottle begins to shatter under the force of the expertly wielded sword. \\
   MSVD & -8y1Q0rA3n8 & 5. Partially sliced, the water bottle stands, seconds before it succumbs to the powerful swing. \\
   & \_108\_115 & 6. A decisive swing catches the water bottle in mid-air, showcasing the mans skill and control. \\
   & & 7. Captured mid-action, the clear arc of the sword as it slices through the bottle in an outdoor environment. \\
   & & 8. Splashes of water glisten in the sunlight as they are flung into the air from the force of the sword strike. \\
   & & 9. The cut through the water bottle is clean, demonstrating the sharpness of the sword and the precision of the man wielding it. \\
   & & 10. Amidst the greenery and under bright skies, the swordâ€™s blade comes down on the water bottle in a display of martial skill. \\
	\hline
   \multirow{10}{*}{} &  & 1. A busy kitchen counter with a glistening knife and a bucket of coleslaw nearby, ready for meal preparations. \\
   & & 2. Thin slices of succulent brisket fall onto the wooden counter, the chef meticulous with each cut. \\
   & & 3. A gloved hand expertly carves the meat, revealing the juicy pink interior of the brisket. \\
   & 80591230 & 4. Seasoned brisket is carefully sliced, the chef ensuring each piece is perfectly cut for serving. \\
   DiDeMo & @N00\_3471997189 & 5. Chunks of meat and crumbs scatter across the counter as the brisket is dissected with precision. \\
   &\_4394214f13 & 6. The kitchens bustling environment captured in the midst of preparing a delicious brisket meal. \\
   &  & 7. Well-worn knife and coleslaw bucket set the scene for a busy day in the kitchen. \\
   & & 8. Brisket being sliced with finesse, ready to be plated alongside fresh slices of bread. \\
   & & 9. The chefs hands move quickly and efficiently, turning a large chunk of brisket into thin, delectable servings. \\
   & & 10. Using a knife to precisely slice through meat. \\
	\hline
	\end{tabular}
 \caption{Examples of video-derived captions}
	\label{tab:captions}
\end{table*}
\begin{figure*}[h]
	\centering
	\includegraphics[width=0.98\textwidth]{sec/images/t2v_demo_msvd.png}
        % \vspace{-0.5em}
	\caption{Examples of text-to-video retrieval results on MSVD dataset.  \textit{(The ground truths are marked in a red box.)}}
	\label{fig.msvd_comp_t2v_example}
\end{figure*}
\begin{figure*}[h]
	\centering
	\includegraphics[width=0.98\textwidth]{sec/images/v2t_demo_msvd.png}
        % \vspace{-0.5em}
	\caption{Examples of video-to-text retrieval results on MSVD dataset. Base: without caption enhancement; Ours: ExCae;  \textit{(The ground truths are marked in a red box.)}}
	\label{fig.msvd_comp_v2t_example}
\end{figure*}
\begin{figure*}[h]
	\centering
	\includegraphics[width=0.98\textwidth]{sec/images/t2v_demo_didemo.png}
        % \vspace{-0.5em}
	\caption{Examples of text-to-video retrieval results on DiDeMo dataset.  \textit{(The ground truths are marked in a red box.)}}
	\label{fig.didemo_comp_t2v_example}
\end{figure*}
\begin{figure*}[h]
	\centering
	\includegraphics[width=0.98\textwidth]{sec/images/v2t_demo_didemo.png}
        % \vspace{-0.5em}
	\caption{Examples of video-to-text retrieval results on DiDeMo dataset. Base: without caption enhancement; Ours: ExCae;  \textit{(The ground truths are marked in a red box.)}}
	\label{fig.didemo_comp_v2t_example}
\end{figure*}
\clearpage

\subsection*{C. Detailed formula of caption scoring}
In the original formula \textit{(Eq. (1) in the manuscript)} for caption scoring, the term $sim(\cdot)$ computes the similarity between generated captions and original text. In specific, $sim(\psi(c^t_{i,k}),\psi(t_i))=\frac{\psi(c^t_{i,k}) \cdot \psi(t_i)}{\|\psi(c^t_{i,k})\| \|\psi(t_i)\|}$.
Moreover, the term \( \text{div}(\psi(c^t_i)) \) calculates the diversity of samples in the caption list, which can be defined as \( \text{div}(S_i) \), where \( S_i \) is the similarity matrix between captions, defined as \( S_i[p,q] = \text{sim}(\psi(c^t_{i,p}), \psi(c^t_{i,q})) \), \( p \neq q \). Then, $div(\psi(c_i^t))$ can be rewritren as:

\begin{equation}
div(\psi(c_i^t))= \frac{1}{K(K-1)} \sum_{p \neq q} (1 - S_i[p,q])
\end{equation}where $K$ denotes the caption number in the caption list.This definition ensures that higher diversity is achieved when the similarity between different captions is lower, thus effectively promoting multi-angle descriptions.

\subsection*{D. Examples of video-text retrieval results}
Examples of video-text retrieval results on MSVD and DiDeMo datasets are displayed in Figures \ref{fig.msvd_comp_t2v_example} to  \ref{fig.didemo_comp_v2t_example}. 
These examples show results consistent with observations obtained in the MSR-VTT dataset.


\subsection*{E. Instructions for Special cases}
\enlargethispage{\baselineskip}
\enlargethispage{\baselineskip}
\enlargethispage{\baselineskip}
\enlargethispage{\baselineskip}
\enlargethispage{\baselineskip}
\enlargethispage{\baselineskip}
\enlargethispage{\baselineskip}
\enlargethispage{\baselineskip}
When using GPT-4o to generate multi-angle captions for videos, it may trigger GPT-4o's safety protocols if the video contains minor adult content, causing failure in caption generation. To address these specific cases, we consider an offline fallback operation and deploy an offline multimodal large model (InternVL2-8B) to substitute GPT-4o for handling these few video issues.

\subsection*{F. Source codes}
The source codes of this paper is summarized in code.zip, zipped in the supplemental materials.

\clearpage

\end{document}
