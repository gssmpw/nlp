%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%
%%%%%     section:  model checking
%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Model checking $\StpLTL$}

\label{sec:model-checking}

Let $\models$ be one of the five satisfaction relations defined in
Section \ref{sec:semantics}. The task of the $\StpLTL$ model checking problem
is as follows. Given a $\StpLTL$ structure 
$\fT = \bigl(\cT_0,(\cT_a)_{a\in \Ag}\bigr)$
and an $\StpLTL$ formula $\phi$, decide whether
$\fT \models \phi$.

We present a generic model checking algorithm for the five semantics,
which can be seen as an adaption of the standard CTL*-like model checking 
procedure \cite{EmerSistla-CTLstar-MC-InfCon84,Emerson-Lei-87} 
and its variant for LTLK and CTL*K under the perfect-recall semantics
\cite{MC-LTLK-and-beyond-2024}.
%
The essential idea is an inductive approach to compute 
deterministic finite automata (DFA)
$\cD_\chi$ for all standpoint subformulas $\chi = \StMod{a}{\varphi}$
of $\phi$. 
The automaton for $\chi$, called history-DFA, represents the language 
of all histories $h \in (2^P)^+$ with
$(*,h) \InnerModels{\chi} \chi$
where $\InnerModels{\chi}$ stands for one of the satisfaction
relations
$\stepmodels$, $\pobsmodels$, $\publicmodels$,
$\decrmodels{Q}$ or $\incrmodels{Q}$ 
with $Q \in \{ Q_{\chi}^{\tinydecr}, Q_{\chi}^{\tinyincr}\}$ as in Remark \ref{remark:context-dependency-syntax-tree}.

The inductive computation corresponds to a bottom-up approach where the innermost standpoint  subformulas, i.e., 
subformulas $\chi = \StMod{a}{\psi}$ where 
$\psi$ is an LTL formula, are treated first.
When computing $\cD_{\chi}$ for
a subformula $\chi=\StMod{a}{\psi}$ where $\psi$ contains 
standpoint modalities,
we may assume that history-DFA 
for the maximal standpoint subformulas $\chi_1,\ldots,\chi_k$
of $\psi$ have been computed before.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\paragraph{Preprocessing for $\decrmodels{}$ and $\incrmodels{}$.}
When dealing with the decremental and incremental semantics,
our iterative bottom-up approach requires the computation of the relevant parameters $Q \subseteq P$ of 
the satisfaction relations $\decrmodels{Q}$ and $\incrmodels{Q}$
over which subformulas of $\phi$ are interpreted.
This can be done in time linear in the length of $\phi$ by a top-down analysis
of the syntax tree of $\phi$ 
(see Remark \ref{remark:context-dependency-syntax-tree}).
In what follows, we shall write $Q_{\chi}$ to denote
the corresponding subset $Q_{\chi}^{\tinydecr}$ or $Q_{\chi}^{\tinyincr}$, respectively,
of $P$ for (an occurrence of) a
subformula $\chi$. 
%
\optional{
Thus, if $\chi$ is 
not in the scope of a standpoint modality
or a maximal standpoint subformulas of $\phi$ then
$Q_{\chi} =P$ under the decremental semantics and
$Q_{\chi} =\varnothing$ under the incremental semantics.
If $\chi= \StMod{a}{\psi}$ is (an occurrence) of a 
standpoint subformula of $\phi$ and
$\chi'$ a subformula of $\psi$ that -- as a subformula of $\psi$ -- is 
not in the scope of a standpoint modality or
a maximal standpoint subformula of $\psi$ then
$Q_{\chi'} =Q_{\chi} \cap P_a$ for the decremental semantics
and $Q_{\chi'}=Q_{\chi}\cup P_a$ for the incremental semantics.}

\paragraph{\bf Observation sets $\Obsset_{\chi}$.}
Our algorithm 
uses subsets $\Obsset_{\chi}\subseteq P$ for the standpoint subformulas
$\chi = \StMod{a}{\varphi}$ of $\phi$, whose
definition 
depends on the considered semantics:
$\Obsset_{\chi} = \varnothing$ for $\stepmodels$, 
$\Obsset_{\chi} = P_a$ for $\probsmodels$,
$\Obsset_{\chi} = P$ for $\publicmodels$,
$\Obsset_{\chi} = Q_{\chi}^{\tinydecr} \cap P_a$ for $\decrmodels{}$
and $\Obsset_{\chi} = Q_{\chi}^{\tinyincr} \cup P_a$ for $\incrmodels{}$.
Let $\obs_{\chi} : (2^P)^* \to (2^{\Obsset_{\chi}})^*$ 
be the induced observation function
$\obs_{\chi}(h)=\proj{h}{\Obsset_{\chi}}$.

\paragraph{Transition systems $\cT_a^R$.}
From $\Obsset_{\chi}$ we will derive a superset $R = R_{\chi} = P_a \cup \Obsset_{\chi}$ of $P_a$
and switch from $\cT_a$ to a transition system $\cT_a^R$ over $R$ 
that behaves as
$\cT_a$, but makes nondeterministic guesses for the truth values
of propositions in $R \setminus P_a$ for the starting state, as well as
in every step of a computation.
So, the states of $\cT_a^R$ are pairs
$(s,O)$ with $s \in S_a$ and $O \subseteq R$ such that
$L_a(s) = O \cap P_a$.
For the precise definition of $\cT_a^R$, see
Definition \ref{def:T-a-R} in the appendix.
The switch from $\cT_a$ to $\cT_a^R$ 
will be needed to deal with the constraints
$\last(h')=\first(f')$ in the definitions of
$\publicmodels{}$ and $\incrmodels{}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{remark}
\label{T-a-R}
{\rm 
If $R =P_a$ then $\cT_a^R$ and $\cT_a$ are isomorphic, so the switch from
$\cT_a$ to $\cT_a^R$ is obsolete. (Note that then $O=L_a(s)$ for all states $(s,O)$ in $\cT_a^R$.)
This applies to $\stepmodels$ where $\Obsset_{\chi}=\varnothing$,
$\probsmodels$ where $\Obsset_{\chi}= P_a$,
and $\decrmodels{}$ where 
$\Obsset_{\chi} \subseteq P_a$.
  }
\end{remark}


%%%%%%%%%%%%%%%%%%%  definition of history DFA  

\begin{definition}
 \label{def:history-DFA}
  Let $\chi$ be a standpoint subformula of $\phi$.
  A history-DFA for $\chi$ is a DFA $\cD$ over the alphabet $2^P$
  such that 
  \begin{enumerate}
  \item [(1)] 
        The language of $\cD$ is
        $\{h \in (2^P)^+ : (*,h) \InnerModels{\chi} \chi \}$. 
  \item [(2)] 
        $\cD$ is $\Obsset_{\chi}$-deterministic 
        in the following sense:
        Whenever $h_1,h_2 \in (2^P)^+$ such that
        $\proj{h_1}{\Obsset_{\chi}}=\proj{h_2}{\Obsset_{\chi}}$ then 
        $\delta_{\chi}(\init_{\chi},h_1)=\delta_{\chi}(\init_{\chi},h_2)$, where  $\delta_{\chi}$ denotes the transition relation of $\cD$.
   \end{enumerate}
\end{definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection*{Generic $\StpLTL$ model checking algorithm}


%%%%%%%%%%%   basis of induction

\paragraph{Basis of induction.}
In the basis of induction we are given a standpoint formula
$\chi = \StMod{a}{\varphi}$ with $\varphi$ an LTL formula.
Let $\cT_{\chi} = \cT_a^R$ where $R = R_{\chi}= P_a \cup \Obsset_{\chi}$.
We apply a mild variant of standard LTL model checking techniques 
\cite{VarWolp-LICS86,VarWolp-InfComp94,BK08,CGKPV18}
%
(see Section \ref{sec:LTL-MC} in the appendix)
%
to compute the set $\Sat_{\cT_a^R}(\exists \varphi)$ 
of states $(s,O)$ in $\cT_a^R$ for which 
there is a $f \in \Traces^P(\cT_a^R,(s,O))$ with 
$f \LTLmodels \varphi$.
We then use a powerset construction
applied to $\cT_a^{R}$ (see Definition \ref{def:default-history-DFA} below) to construct an $\Obsset_{\chi}$-deterministic 
history-DFA $\cD_{\chi}$.



%%%%%%%%%%%%%%%%%%%%%%   step of induction

\paragraph{Step of induction.}
Suppose now 
$\chi = \StMod{a}{\varphi}$ and $\varphi$ has standpoint subformulas.
%
Let $\chi_1,\ldots,\chi_k$ be the maximal standpoint subformulas of $\varphi$,
say $\chi_i = \StMod{b_i}{\psi_i}$ for $i=1,\ldots,k$, and let
$\cD_1=\cD_{\chi_1}, \ldots, \cD_k=\cD_{\chi_k}$ be their history-DFAs 
over
$2^P$.
Let $\cD_i = (X_i,\delta_i,\init_i,F_i)$ and $\Obsset_i = \Obsset_{\chi_i}$. Further, let $R_{\chi}Â = P_a \cup \Obsset_{\chi}$.
%
We consider the transition system
\begin{center}
  $\cT_{\chi} = \cT_a^{R_{\chi}} \bowtie \cD_1 \bowtie \ldots \bowtie \cD_k$
\end{center}
that is obtained by putting $\cT_a^{R_{\chi}}$ in parallel to
the product of the $\cD_i$'s. 
For this, we introduce pairwise distinct, fresh atomic propositions
$p_1,\ldots,p_k$ for each of the $\chi_i$'s and define the components
$\cT_{\chi} = (Z_{\chi},\to_{\chi},\Init_{\chi},\cP_{\chi},L_{\chi})$ 
as follows (where we write $R$ instead of $R_{\chi}$).
  The state space is 
  $Z_{\chi} \ = \ S_a^{R} \times X_1 \times \ldots \times X_k$.
  The transition relation satisfies:
  $((s,O),x_1,\ldots,x_k) \to_{\chi} ((s',O'),x_1',\ldots,x_k')$
  iff there are $H, H' \subseteq P$ such that
  $H \cap \Obsset_{\chi} = H' \cap \Obsset_{\chi}$, 
  $H \cap R=O$, $(s,O) \to_a^{R} (s',O')$  
  and
  $x_i'=\delta_i(x_i,H')$ for $i=1,\ldots,k$.
  The set of atomic propositions is $\cP_{\chi} = R \cup \{p_1,\ldots,p_k\}$.
  The labeling function $L_{\chi} : Z_{\chi} \to 2^{\cP_{\chi}}$ is given by
  $L_{\chi}((s,O),x_1,\ldots,x_k) \cap R = O$ 
  and 
  $p_i\in L_{\chi}(s,x_1,\ldots,x_k)$ iff $x_i \in F_i$ for $i=1,\ldots,k$.
  Lastly, $\Init_{\chi}$ contains all states
  $((\init_a,O),x_1,\ldots,x_k)$ such that 
  $(\init_a,O)\in \Init_a^R$  (i.e., $O\cap P_a = L_a(\init_a)$)
  and
  there exists $H' \subseteq P$
  with $x_i=\delta_i(\init_i,H')$ for $i=1,\ldots,k$ and
  $O\cap \Obsset_{\chi}= H'\cap \Obsset_{\chi}$.

We now replace $\varphi$ with the LTL formula 
$\varphi' \ = \ \varphi[\chi_1/p_1,\ldots,\chi_k/p_k]$
over $\cP=P \cup \{p_1,\ldots,p_k\}$ that results
from $\varphi$ by syntactically 
replacing the maximal standpoint subformulas $\chi_i$ of $\varphi$ with $p_i$.
%
We then apply standard LTL model checking techniques 
%
(see Section \ref{sec:LTL-MC} in the appendix)
%
to compute $\Sat_{\cT_{\chi}}(\exists \varphi') = \{ z \in Z_{\chi} : \exists f \in 
\Traces^{\cP}(\cT_{\chi},z) \text{ s.t. } f \LTLmodels \varphi' \}$.


Having computed $\Sat_{\cT_{\chi}}(\exists \varphi')$,  
the atomic propositions $p_1,\ldots,p_k$ are no longer needed.
We therefore switch from $\cT_{\chi}$ to
$\cT_{\chi}'= \proj{\cT_{\chi}}{R}$ 
which agrees with $\cT_{\chi}$ except that $\cP_{\chi}' = R$ and 
$L_{\chi}'(s,x_1,\ldots,x_k)= L_{\chi}(s,x_1,\ldots,x_k) \cap R$.
By applying a powerset construction to $\cT_{\chi}'$ we get
an $\Obsset_{\chi}$-deterministic history DFA $\cD_{\chi}$
for the language $\{h \in (2^P)^+ : (*,h)\InnerModels{\chi} \chi\}$
(see Definition \ref{def:default-history-DFA} below, 
applied to $\cT=\cT_{\chi}'$,
$\Obsset_{\chi}$ and 
the set $U_{\chi}=\Sat_{\cT_{\chi}}(\exists \varphi')$ for the declaration
of the final states in $\cD_{\chi}$).

%%%%%%%%%%  final step: evaluation over StpLTL structure

\paragraph{Final step.}
After treating all maximal standpoint subformulas of $\phi$,
we need to check whether $\phi$ holds for all traces
of $\cT_0$. This is done via similar techniques as in the first part 
of the step of induction, i.e., we build the product $\cT_{\phi}$ 
of $\cT_0$ with the history-DFAs that have been
constructed for the maximal standpoint subformulas of $\phi$ and
replace them with fresh atomic propositions, yielding an LTL formula
$\phi'$ over an extension of $P$. We then apply
standard LTL model checking techniques to check whether all traces
of $\cT_{\phi}$ satisfy $\phi'$. 
%
\optional{%
This can be done using an algorithm that is polynomially space-bounded 
in the size of $\cT_{\phi}$ and the length of $\phi'$ (and $\phi$).}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%
%%%%%%    history-DFA via powerset construction
%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection*{Computation of history-DFA}

\label{sec:default-history-DFA}

The history-DFA $\cD_{\chi}$ 
for standpoint subformulas $\chi=\StMod{a}{\varphi}$ 
can be obtained by applying a
powerset construction to the transition system 
$\cT=\cT_{\chi}$ over $R=R_{\chi}$.
%
This construction is an adaption of the classical powerset construction
for nondeterministic finite automata and can be seen as a one-agent variant
of the powerset construction introduced by Reif \cite{Reif-JCSS84}
for partial-information
two-player games and its variant for CTL*K model checking 
\cite{MC-LTLK-and-beyond-2024}.
%
The acceptance condition in $\cD_{\chi}$ is derived from  
the set $U = \Sat_{\cT}(\exists \varphi)$ in the basis of induction and
$U = \Sat_{\cT}(\exists \varphi')$ in the step of induction.


%%%%%%%%%%%  definition default history-DFA

\begin{definition}
\label{def:default-history-DFA}
Let $\cT = (S,\to,\Init,R,L)$ 
with $R \subseteq P$,
$\Obsset \subseteq P$ an observation set,
and $U \subseteq S$.
Then,
$\pow(\cT,\Obsset,U)$
is the following
DFA $\cD= (\cX_{\cD},\delta_{\cD},\init_{\cD},F_{\cD})$ over the alphabet $2^P$.
   The state space is $\cX_{\cD} = 2^S \cup \{\init_{\cD}\}$.
  The transition function $\delta_{\cD} : \cX_{\cD} \times 2^P \to \cX_{\cD}$ is 
  given by (where $x \in 2^S$):
  \begin{center}
  \begin{tabular}{l}
  \begin{tabular}{r}
    $\delta_{\cD}(x,H)$  =          
    $\bigr\{ s' \in S : \text{ there exists } s \in x \text{ with }$
      \ \ \\
        
        $s \to s'$ \text{ and } $L(s') \cap \Obsset = H \cap \Obsset \bigr\}$
    \\[1ex]
   \end{tabular}   
   \\
   \begin{tabular}{l}
   $\delta_{\cD}(\init_{\cD},H)$  =   
        $\bigl\{ s \in \Init :  L(s) \cap \Obsset = H \cap \Obsset 
        \bigr\}$
   \end{tabular}
   \end{tabular}
  \end{center}
  The set of final states is
  $F_{\cD}= 
   \bigl\{  x \in \cX_{\cD} :  x \cap U \not= \varnothing  \bigr\}$.
\end{definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

For the soundness proof, see
Section \ref{sec:soundness-history-DFA} in the Appendix.



