\begin{tikzpicture}[
    mynode/.style={circle, draw=black, thick, inner sep=0pt, minimum size=5mm},
    myarrow/.style={->, thick, gray},
    mybox/.style={draw, text width=1.7cm, text centered, minimum height=1cm},
    myboxbig/.style={draw, text width=2.3cm, text centered, minimum height=1.5cm},
    myboxbig2/.style={draw, text width=3.3cm, text centered, minimum height=1.5cm},
    mylabel/.style={text width=4cm, align=center},
    mycylinder/.style={ % Define the cylinder style
        draw,
        shape=cylinder,
        shape border rotate=90,
        aspect=0.25,
        minimum height=1.0cm,
        minimum width=1.7cm,
        fill=orange,
        text width=1.4cm,
        align=center
    }
]
    % Define colors
    \definecolor{lightyellow}{RGB}{255, 255, 200}
    \definecolor{lightblue}{RGB}{173, 216, 230}
    \definecolor{mediumblue}{RGB}{190, 230, 255}
    \definecolor{lightgreen}{RGB}{200, 255, 200}
    \definecolor{lightorange}{RGB}{255, 210, 150}
    \definecolor{lightpurple}{RGB}{220, 208, 255}

    \tikzstyle{mynode}=[thick,draw=blue,fill=blue!20,circle,minimum size=0.02]
    % Draw sections
    % \fill[lightorange] (-4,-4.5) rectangle (0,5);
    % \fill[lightblue] (0,-4.5) rectangle (6.5,5);
    % \fill[lightgreen] (6.5,-4.5) rectangle (12,5);
    \draw[dotted, thick] (-4.2,-4.5) rectangle (0,5);
    \draw[dotted, thick] (0.2,-4.5) rectangle (6.3,5);
    \draw[dotted, thick] (6.5,-4.5) rectangle (12,5);

    

    \begin{scope}[shift={(-2.5, 4.5)}]
        \node at (0.4, 0) {\textbf{Inputs}};

        \node[above=1cm, align=center, font=\bfseries] at (-0.5, -3.3) {DuT ($M$)};
        \coordinate (neuralnet) at (0.2, -2);
        
        \begin{scope}[x=0.6cm, y=0.6cm, shift=(neuralnet)]         
            \readlist\Nnod{3,4,3}
            \foreachitem \N \in \Nnod{
                \foreach \i [evaluate={\x=\Ncnt; \y=\N/2-\i+0.5; \prev=int(\Ncnt-1);}] in {1,...,\N}{
                    \node[mynode] (N\Ncnt-\i) at (\x,\y) {};
                    \ifnum\Ncnt>1
                        \foreach \j in {1,...,\Nnod[\prev]}{
                            \draw[thick] (N\prev-\j) -- (N\Ncnt-\i);
                        }
                    \fi
                }
            }
        \end{scope}

        \begin{scope}[shift={(0.9, -4.5)}]
            \node[anchor=south] at (-1.7, -0.6) {\shortstack{\textbf{Dataset} \\ ($\mathcal{D}$)}};

            % Set the images inside the rectangle
            \node[inner sep=0pt] (image1) at (0, -0.5) {\includegraphics[width=1.5cm]{images/workflow/000023.png}};
            \node[inner sep=0pt] (image2) at (0.25, -0.25) {\includegraphics[width=1.5cm]{images/workflow/000146.png}};
            \node[inner sep=0pt] (image3) at (0.5, 0) {\includegraphics[width=1.5cm]{images/workflow/000089.png}};
            \node[inner sep=0pt] (image1) at (0.75, 0.25) {\includegraphics[width=1.5cm]{images/workflow/000012.png}};
        \draw[->] (-0.6,0.5) .. controls (-0.6,1.5) .. (-0.6,2);

        \end{scope}
        \begin{scope}[shift={(0.1, -6)}]
            \node at (0.3, -0.7) {\textbf{ODD} ($\mathcal Z$)};
            \node[
                    draw=blue,
                    % fill=blue!10,
                    rounded corners,
                    inner xsep=0.01cm, 
                    inner ysep=0.1cm,
                    % minimum width=2cm,
                    align=left
                ] (table_ODD) 
                  at (0.4, -1.9) % Replace with your desired coordinates
                  {                     
                    \setlength{\tabcolsep}{1.7pt} % Minimal padding between columns
                    \begin{tabular}{p{1.1cm}|ll}                    
                        Dim. & Attr. \\
                        \hline                        
                        Gender & Male & Female \\
                        Age & Adult & Young\\
                        $\dots$ & $\dots$ & $\dots$ \\                        
                    \end{tabular}
                };
        \end{scope}
    \end{scope}     
    
    \begin{scope}[shift={(0, 4.5)}]
        \node at (3, -0.15) {\textbf{\makecell{Unstructured \\ to \\ Structured Data}}};
        \draw[->] (-0.1,-2.2) .. controls (1.5,-2.2) .. (1.7,-2.2);

        \node at (3.5, -1.1) {\textbf{Per-Object Performance}};
        \node[
                    draw=blue,
                    % fill=blue!10,
                    rounded corners,
                    inner xsep=0.0001cm, 
                    inner ysep=0.1cm,
                    % minimum width=2cm,
                    align=left
                ] (table_PERF) 
          at (3.5, -2.5) 
          { 
            \setlength{\tabcolsep}{1.5pt} 
            \begin{tabular}{l|l}
                Samples & \makecell{Binarized \\ Errors} \\
                \hline
                $s_1$ & $e_1$ \\
                 $s_2$ &  $e_2$ \\
                $\dots$ & $\dots$ \\
            \end{tabular}
        };     
        \begin{scope}[shift={(1.75, -5.0)}]      
            \draw[->] (-1.8,-0) .. controls (-1.5,-0) .. (-1.3,-0);
            \draw[->] (-1.8,-2) .. controls (-1.5,-1) .. (-1.3,-0.5);
            \draw[->] (1.6,-0.5) .. controls (1.6,-1) .. (1.6,-1.9);

            
            \node[draw=blue,  thick, inner sep=0.25em] (block1) {\parbox{2cm}{Foundational \\ Models \\ (e.g., CLIP)}};
            % Right block (Sensors)
            \node[draw=blue,  thick, inner sep=0.25em, right=0.95cm of block1] (block2) {\parbox{2cm}{Sensors \\ (e.g., Depth \\ Sensors)}};
        
            % Dots in between
            \node[right=0cm of block1] (ellipsis) {...};
        
            % Two-arrowed line with label
            \draw[<->, thick, dash pattern=on 4pt off 2pt on 1pt off 2pt] ([yshift=-3mm]block1.south) -- node[below] {Noisy to Accurate} ([yshift=-3mm]block2.south);

        
            % Outer block enclosing all elements
             \node[draw=blue, thick, fit=(block1)(ellipsis)(block2), inner sep=0.25em, label=above:{\textbf{Metadata Generation Module}}] (outerblock) {};
        
            \node[
                    draw=blue,
                    % fill=blue!10,
                    rounded corners,
                    inner xsep=0.0001cm, 
                    inner ysep=0.1cm,
                    % minimum width=2cm,
                    align=left
                ] 
                (metatable) at (1.5, -2.9)
            { 
            \renewcommand{\arraystretch}{0.7} % Minimal padding between rows
            \begin{tabular}{llll}
                % \multicolumn{4}{c}{\rule[1ex]{0.26\linewidth}{0.4pt}} \\ % Top line for header
                $\mathcal{D}$ & Gender & Age & $\dots$ \\
                \multicolumn{4}{c}{\rule[1ex]{0.26\linewidth}{0.4pt}} \\ % Line after header
                $s_1$ & Female & Adult & $\dots$ \\
                $s_2$  & Female & Young  & $\dots$ \\
                $\dots$ & $\dots$ & $\dots$ & $\dots$ \\
                % \multicolumn{4}{c}{\rule[1ex]{0.26\linewidth}{0.4pt}} \\ % Bottom line
            \end{tabular}
            };  
        \end{scope}
    \end{scope}
    
    \begin{scope}[shift={(9, 4.5)}]
        \node at (0, 0) {\textbf{Weak Slice Discovery}};

        % \draw[->] (-4.5,-2.2) .. controls (-2,-2.2) .. (-1,-3);
        % \draw[->] (-4.5,-2.2) .. controls (-1,-2.2) .. (0.5,-2.8);
        \draw[->] (-3.8,-2.2) 
                to[out=0, in=180] (-3,-2.2)
                to[out=360, in=100] (0.5,-3.0);
        
        \draw[->] (-3,-8) 
                to[out=50, in=260] (-2.8,-2)
                to[out=70, in=100] (0.6,-3.0);
        \draw[->] (-3,-8) 
                to[out=50, in=260] (-2.8,-2)
                to[out=70, in=180] (0,-1.3);
                

        \draw[->] (1.5,-2.0) .. controls (1.0,-2.3) .. (0.7,-3.0);

        
        \draw[->] (0.5,-6.2) .. controls (0.5,-6.2) .. (0.5,-6.9);
        

        \node[draw=blue, thick, inner sep=0.1em] (heading) at (1.5, -1.4){\parbox{2.3cm}{Sample-based Metadata \\ Quality Check}};
        
        \node[draw=blue, thick, inner sep=0.3em] (heading) at (0.2, -3.8){\textbf{\makecell{Systematic Weakness \\ Detector~\ref{algo:combined_sliceline}}}};

        \node[draw=blue, thick, below=0.3cm of heading, align=left, inner sep=0.2em] (content) {
            \textbf{SWD-1:}\ SL + observed error \\ 
            \textbf{SWD-2:}\ SL + corrected error  \\
            \textbf{SWD-3:}\ Combined  

        };
        \node[draw=blue, thick, fit=(heading)(content), inner sep=0.5em] {};
        \node at (-0.6, -6.5) {\textbf{Results}};       
            \node[
            draw=blue, 
            % fill=blue!10, 
            rounded corners, 
            inner xsep=0.1pt,
            inner ysep=0.1pt,
            % outer ysep=0.1pt
            ] 
          (table_results) 
          at (0.1, -7.9) 
          { 
            \setlength{\tabcolsep}{4pt} 
           

            \begin{tabular}{l|l}                
                \makecell{Slice \\ Desc.} &  \makecell{Slice \\ Statistics} \\
                \hline                
                 Age = Adult  & $|S_1|$, \dots \\
                 Gender = Female & $|S_2|$, \dots \\
                               
        \end{tabular}
        };
    \end{scope}  

    \draw[dotted] (-4, 3.75) -- (12, 3.75);

\end{tikzpicture}


