\begin{table}[t]
\centering
\caption{Statistics of the downstream datasets for evaluation.}
\label{tab:downstream_datasets}
\scriptsize % reduce font size further
\setlength{\tabcolsep}{3pt} % adjust column separation if needed
\begin{tabular}{lcccc}
\toprule
\textbf{Disease} & \textbf{Number of Regions} & \textbf{Sampling Rate} & \textbf{Respiratory} & \textbf{Total Length} \\
\midrule
ILI USA   & 1   & Weekly & Yes & 966 \\
ILI Japan & 1   & Weekly & Yes & 348 \\
Measles    & 1   & Weekly & Yes & 1{,}108 \\
Dengue     & 23  & Mixed  & No & 10{,}739 \\
RSV        & 13  & Weekly & Yes & 4{,}316 \\
MPox       & 1   & Daily  & No & 876 \\
Covid      & 16  & Daily  & Yes & 12{,}800 \\
\bottomrule
\end{tabular}
\end{table}


\begin{table*}[t]
    \centering
    \caption{Univariate forecasting results with horizons ranging from 1 to 16 future steps. The lookback window length is set to 36 and all models are evaluated using MSE. \textit{Imp.} shows the improvement compared to the best baseline. \textit{Note: \cellcolor{low1}{\color{red} Best},  \cellcolor{low2}{\color{green} Second Best}, \cellcolor{low3}{\color{yellow} Third Best}.}}
    \label{tab: baselines}
    \small
    \resizebox{.9\textwidth}{!}{%
    \begin{tabular}{llccccccccccccc}
        \toprule
        \textbf{Dataset} & \textbf{Horizon} 
            & \textbf{ARIMA} & \textbf{LSTM} & \textbf{GRU} 
            & \textbf{Dlinear} & \textbf{Informer} & \textbf{Autoformer} 
            & \textbf{Fedformer} & \textbf{PEM} & \textbf{Moment} 
            & \textbf{PatchTST} & \textbf{CAPE} & \textbf{Imp.} \\
        \midrule
        \multirow{6}{*}{ILI USA} 
            & 1  & \cellcolor{low1}0.138 & 0.338 & 0.259 & 0.220 
                  & \cellcolor{low3}0.175 & 0.457 & 0.368 & 0.179 
                  & 0.269 & 0.195 & \cellcolor{low2}0.155 
                  & -12.32\% \\[2pt]
            & 2  & \cellcolor{low2}0.203 & 0.377 & 0.301 & 0.247 
                  & 0.370 & 0.710 & 0.380 & \cellcolor{low3}0.226 
                  & 0.321 & 0.264 & \cellcolor{low1}0.200 
                  & 1.48\% \\[2pt]
            & 4  & \cellcolor{low3}0.354 & 0.458 & 0.386 & 0.376 
                  & 0.517 & 0.670 & 0.433 & \cellcolor{low2}0.304 
                  & 0.397 & 0.385 & \cellcolor{low1}0.270 
                  & 23.73\% \\[2pt]
            & 8  & 0.701 & 0.579 & 0.529 & \cellcolor{low2}0.506 
                  & 0.597 & 0.842 & 0.570 & 0.538 
                  & \cellcolor{low3}0.510 & 0.535 & \cellcolor{low1}0.404 
                  & 20.16\% \\[2pt]
            & 16 & 1.121 & 0.691 & 0.626 & 0.617 
                  & 0.812 & 0.835 & 0.701 & \cellcolor{low3}0.570 
                  & 0.610 & \cellcolor{low1}0.485 & \cellcolor{low2}0.516 
                  & -6.39\% \\[2pt]
            & \textbf{Avg} & 0.503 & 0.489 & 0.420 & \cellcolor{low3}0.393 
                  & 0.494 & 0.703 & 0.490 & \cellcolor{low2}0.363 
                  & 0.421 & 0.373 & \cellcolor{low1}\textbf{\underline{0.309}}
                  & 14.88\% \\
        \midrule        
        \multirow{6}{*}{ILI Japan} 
            & 1  
              & \cellcolor{low3}0.358 & 1.426 & 1.213 & 1.016 
              & 0.405 & 0.515 & 0.525 & 0.470 
              & \cellcolor{low2}0.325 & 0.413 & \cellcolor{low1}0.290 
              & 10.77\% \\[2pt]
            & 2  
              & 0.772 & 1.635 & 1.458 & 1.294 
              & \cellcolor{low3}0.666 & 0.855 & 1.151 & 0.755 
              & \cellcolor{low2}0.586 & 0.698 & \cellcolor{low1}0.535 
              & 8.70\% \\[2pt]
            & 4  
              & 1.720 & 1.975 & 1.870 & 1.758 
              & 1.234 & \cellcolor{low3}1.150 & 1.455 & 1.207 
              & \cellcolor{low2}1.082 & 1.147 & \cellcolor{low1}0.944 
              & 12.76\% \\[2pt]
            & 8  
              & 2.981 & 2.373 & 2.365 & 2.285 
              & \cellcolor{low2}1.688 & 1.866 & 2.012 & 1.810 
              & \cellcolor{low3}1.706 & 1.708 & \cellcolor{low1}1.650 
              & 2.25\% \\[2pt]
            & 16 
              & 2.572 & 2.023 & 2.010 & 2.007 
              & \cellcolor{low1}1.551 & 2.654 & 4.027 & \cellcolor{low3}1.766 
              & 2.054 & \cellcolor{low2}1.688 & 1.911 
              & -23.20\% \\[2pt]
            & \textbf{Avg} 
              & 1.680 & 1.886 & 1.783 & 1.672 
              & \cellcolor{low2}1.109 & 1.408 & 1.834 & 1.202 
              & 1.151 & \cellcolor{low3}1.131 & \cellcolor{low1}\textbf{\underline{1.066}}
              & 3.88\% \\
        \midrule
        \multirow{6}{*}{Measles} 
              & 1  
                & \cellcolor{low2}0.071 & 0.182 & 0.143 & 0.133 
                & \cellcolor{low1}0.066 & 0.203 & 0.321 & 0.085 
                & 0.113 & 0.094 & \cellcolor{low3}0.083 
                & -25.76\% \\[2pt]
              & 2  
                & \cellcolor{low2}0.120 & 0.223 & 0.176 & 0.184 
                & 0.153 & 0.257 & 0.817 & 0.128 
                & 0.138 & \cellcolor{low3}0.127 & \cellcolor{low1}0.112 
                & 6.67\% \\[2pt]
              & 4  
                & 0.225 & 0.310 & 0.258 & 0.296 
                & 0.288 & 0.331 & 0.226 & 0.213 
                & \cellcolor{low2}0.186 & \cellcolor{low3}0.205 & \cellcolor{low1}0.161
                & 13.44\% \\[2pt]
              & 8  
                & 0.483 & 0.567 & 0.471 & 0.512 
                & 0.501 & 0.671 & 0.403 & 0.417 
                & \cellcolor{low2}0.351 & \cellcolor{low3}0.377 & \cellcolor{low1}0.310 
                & 11.68\% \\[2pt]
              & 16 
                & 1.052 & 1.110 & 1.013 & 1.088 
                & 0.904 & 1.115 & \cellcolor{low3}0.754 & 0.806 
                & 0.818 & \cellcolor{low1}0.722 & \cellcolor{low2}0.752
                & -4.15\% \\[2pt]
              & \textbf{Avg} 
                & 0.390 & 0.478 & 0.412 & 0.443 
                & 0.382 & 0.515 & 0.504 & 0.330 
                & \cellcolor{low3}0.321 & \cellcolor{low2}0.305 
                & \cellcolor{low1}\textbf{\underline{0.269}}
                & 11.80\% \\
        \midrule
        \multirow{6}{*}{Dengue} 
          & 1  
            & 0.244 & 0.250 & 0.261 & \cellcolor{low2}0.224 
            & 0.255 & 0.525 & 0.521 & \cellcolor{low3}0.225 
            & 0.420 & 0.240 & \cellcolor{low1}0.223 
            & 0.45\% \\[2pt]
          & 2  
            & 0.373 & 0.343 & 0.343 & \cellcolor{low3}0.316 
            & 0.450 & 0.807 & 0.670 & \cellcolor{low2}0.314 
            & 0.579 & 0.334 & \cellcolor{low1}0.302
            & 3.82\% \\[2pt]
          & 4  
            & 0.696 & \cellcolor{low3}0.564 & 0.579 & \cellcolor{low1}0.560 
            & 0.798 & 0.957 & 0.766 & 0.571 
            & 0.661 & 0.586 & \cellcolor{low2}0.561 
            & -0.18\% \\[2pt]
          & 8  
            & 1.732 & \cellcolor{low2}1.168 & \cellcolor{low3}1.183 & 1.256 
            & 1.239 & 1.684 & 1.539 & 1.223 
            & 1.308 & 1.292 & \cellcolor{low1}1.046 
            & 10.44\% \\[2pt]
          & 16 
            & 4.082 & 3.876 & 3.315 & 3.109 
            & 2.659 & 3.364 & 2.934 & 3.376 
            & \cellcolor{low2}2.532 & \cellcolor{low3}2.537 & \cellcolor{low1}2.509
            & 0.91\% \\[2pt]
          & \textbf{Avg} 
            & 1.426 & 1.240 & 1.136 & 1.093 
            & \cellcolor{low3}1.080 & 1.467 & 1.286 & 1.142 
            & 1.100 & \cellcolor{low2}1.000 & \cellcolor{low1}\textbf{\underline{0.892}}
            & 10.80\% \\
        \midrule
        \multirow{6}{*}{Covid} 
          & 1  
            & 33.780 & \cellcolor{low2}22.592 & \cellcolor{low3}22.009 & 23.811 
            & 34.161 & 42.049 & 28.130 & 25.088 
            & 32.376 & 23.645 & \cellcolor{low1}21.548
            & 2.09\% \\[2pt]
          & 2  
            & 33.193 & 23.460 & \cellcolor{low2}22.542 & 24.809 
            & 24.883 & 30.631 & 28.059 & \cellcolor{low3}23.123 
            & 35.418 & 25.047 & \cellcolor{low1}22.224
            & 1.41\% \\[2pt]
          & 4  
            & 32.482 & 24.729 & 24.816 & 26.345 
            & 31.328 & 41.029 & 29.432 & \cellcolor{low2}23.889 
            & 36.251 & \cellcolor{low3}24.224 & \cellcolor{low1}22.476
            & 5.92\% \\[2pt]
          & 8  
            & 36.573 & \cellcolor{low2}31.019 & 33.934 & 33.081 
            & 35.964 & 55.812 & 41.791 & \cellcolor{low3}31.217 
            & 40.429 & 31.548 & \cellcolor{low1}28.403
            & 8.44\% \\[2pt]
          & 16 
            & \cellcolor{low3}42.910 & 43.820 & \cellcolor{low2}41.432 & 47.561 
            & 50.244 & 47.993 & 69.976 & 51.265 
            & 52.590 & 43.309 & \cellcolor{low1}40.555
            & 2.12\% \\[2pt]
          & \textbf{Avg} 
            & 35.787 & \cellcolor{low3}29.124 & \cellcolor{low2}28.947 & 31.121 
            & 35.316 & 43.503 & 39.478 & 30.917 
            & 39.413 & 29.555 & \cellcolor{low1}\textbf{\underline{26.559}}
            & 8.25\% \\
        \bottomrule
    \end{tabular}
    }
\end{table*}


\begin{table*}[hpt]
    \centering
    \caption{Few-shot learning results with horizons ranging from 1 to 16 future steps. The length of the lookback window is set to 36. Each model is evaluated after being trained on 20\%, 40\%, 60\% and 80\% of the full training data.}
    \label{tab: few_shot}
    \resizebox{\textwidth}{!}{%
    \begin{tabular}{ll*{5}{c}*{5}{c}*{5}{c}*{5}{c}*{5}{c}}
        \toprule
        \multirow{2}{*}{\textbf{Dataset}} & \multirow{2}{*}{\textbf{Horizon}} & \multicolumn{5}{c}{\textbf{CAPE}} & \multicolumn{5}{c}{\textbf{PatchTST}} & \multicolumn{5}{c}{\textbf{Dlinear}} & \multicolumn{5}{c}{\textbf{MOMENT}} & \multicolumn{5}{c}{\textbf{PEM}} \\
        \cmidrule(lr){3-7} \cmidrule(lr){8-12} \cmidrule(lr){13-17} \cmidrule(lr){18-22} \cmidrule(lr){23-27}
        & & \textbf{20\%} & \textbf{40\%} & \textbf{60\%} & \textbf{80\%} & \textbf{100\%} 
        & \textbf{20\%} & \textbf{40\%} & \textbf{60\%} & \textbf{80\%} & \textbf{100\%}
        & \textbf{20\%} & \textbf{40\%} & \textbf{60\%} & \textbf{80\%} & \textbf{100\%}
        & \textbf{20\%} & \textbf{40\%} & \textbf{60\%} & \textbf{80\%} & \textbf{100\%}
        & \textbf{20\%} & \textbf{40\%} & \textbf{60\%} & \textbf{80\%} & \textbf{100\%} \\
        \midrule
        \multirow{6}{*}{ILI USA} 
            & 1  & 1.155 & 0.535 & 0.307 & 0.178 & 0.155 & 1.361 & 0.662 & 0.355 & 0.191 & 0.195 & 1.430 & 1.000 & 0.460 & 0.230 & 0.170 & 2.859 & 1.274 & 0.608 & 0.267 & 0.216 & 1.424 & 0.620 & 0.330 & 0.189 & 0.145 \\
            & 2  & 1.396 & 0.925 & 0.465 & 0.220 & 0.200 & 1.389 & 0.806 & 0.489 & 0.234 & 0.264 & 2.210 & 1.090 & 0.660 & 0.280 & 0.220 & 3.242 & 1.709 & 0.695 & 0.342 & 0.271 & 1.463 & 0.829 & 0.434 & 0.256 & 0.210 \\
            & 4  & 1.770 & 1.154 & 0.640 & 0.306 & 0.270 & 1.923 & 1.215 & 0.656 & 0.387 & 0.385 & 2.500 & 1.670 & 0.720 & 0.380 & 0.310 & 3.910 & 1.901 & 0.891 & 0.399 & 0.356 & 1.889 & 1.186 & 0.625 & 0.393 & 0.312 \\
            & 8  & 2.611 & 1.912 & 0.978 & 0.519 & 0.404 & 2.713 & 1.623 & 0.833 & 0.544 & 0.535 & 3.510 & 1.970 & 0.980 & 0.530 & 0.450 & 4.706 & 2.013 & 1.120 & 0.615 & 0.482 & 2.649 & 1.690 & 0.966 & 0.580 & 0.573 \\
            & 16 & 3.674 & 2.473 & 1.411 & 0.622 & 0.516 & 3.182 & 1.789 & 1.056 & 0.649 & 0.485 & 4.460 & 2.240 & 1.260 & 0.640 & 0.580 & 5.233 & 2.335 & 1.251 & 0.669 & 0.580 & 3.294 & 1.979 & 1.049 & 0.679 & 0.526 \\
            & Avg & \textbf{2.121} & \textbf{1.400} & \textbf{0.760} & \cellcolor{low1}\textbf{0.369} & \cellcolor{low1}\textbf{0.309} 
            & \textbf{2.114} & \textbf{1.219} & \textbf{0.677} & \textbf{0.401} & \textbf{0.373} 
            & \textbf{2.822} & \textbf{1.594} & \textbf{0.816} & \textbf{0.412} & \textbf{0.346} 
            & \textbf{3.990} & \textbf{1.847} & \textbf{0.913} & \textbf{0.459} & \textbf{0.381} 
            & \textbf{2.143} & \textbf{1.261} & \textbf{0.681} & \textbf{0.419} & \textbf{0.353} \\
        \midrule
        \multirow{6}{*}{Dengue} 
            & 1  & 3.254 & 1.384 & 0.489 & 0.384 & 0.218 & 3.700 & 1.580 & 0.657 & 0.389 & 0.203 & 3.600 & 1.470 & 0.550 & 0.350 & 0.220 & 4.585 & 2.480 & 0.689 & 0.423 & 0.383 & 3.383 & 1.613 & 0.558 & 0.350 & 0.206 \\
            & 2  & 4.463 & 2.340 & 0.735 & 0.487 & 0.301 & 5.832 & 2.159 & 0.846 & 0.507 & 0.296 & 7.090 & 2.170 & 0.820 & 0.510 & 0.310 & 6.609 & 2.990 & 0.922 & 0.587 & 0.521 & 5.404 & 2.257 & 0.869 & 0.507 & 0.300 \\
            & 4  & 7.563 & 3.728 & 1.250 & 0.817 & 0.540 & 9.525 & 3.636 & 1.517 & 1.069 & 0.588 & 11.190 & 4.130 & 1.520 & 0.940 & 0.560 & 12.877 & 4.106 & 1.644 & 0.966 & 0.669 & 8.782 & 4.428 & 1.608 & 1.037 & 0.522 \\
            & 8  & 15.526 & 7.276 & 2.836 & 1.922 & 1.193 & 19.052 & 9.530 & 3.597 & 2.133 & 1.296 & 21.910 & 9.690 & 3.470 & 2.160 & 1.250 & 23.298 & 9.229 & 3.625 & 2.135 & 1.235 & 17.023 & 8.117 & 3.323 & 2.249 & 1.295 \\
            & 16 & 35.870 & 17.204 & 6.469 & 3.946 & 2.210 & 30.451 & 19.616 & 7.238 & 4.289 & 2.536 & 35.350 & 24.640 & 7.890 & 4.780 & 3.060 & 31.115 & 18.877 & 7.200 & 4.551 & 3.984 & 29.934 & 18.861 & 7.368 & 4.390 & 2.497 \\
            & Avg & \textbf{13.335} & \cellcolor{low1}\textbf{6.386} & \cellcolor{low1}\textbf{2.356} & \cellcolor{low1}\textbf{1.511} & \cellcolor{low1}\textbf{0.892} 
            & \textbf{13.712} & \textbf{7.304} & \textbf{2.771} & \textbf{1.678} & \textbf{0.984} 
            & \textbf{15.828} & \textbf{8.420} & \textbf{2.850} & \textbf{1.748} & \textbf{1.080} 
            & \textbf{15.697} & \textbf{7.536} & \textbf{2.816} & \textbf{1.733} & \textbf{1.358} 
            & \textbf{12.90} & \textbf{7.055} & \textbf{2.745} & \textbf{1.707} & \textbf{0.964} \\
        \midrule
        \multirow{6}{*}{Measles} 
            & 1  & 0.168 & 0.158 & 0.107 & 0.095 & 0.069 & 0.400 & 0.217 & 0.121 & 0.091 & 0.094 & 0.560 & 0.470 & 0.190 & 0.150 & 0.100 & 1.211 & 0.316 & 0.138 & 0.108 & 0.102 & 0.227 & 0.200 & 0.106 & 0.106 & 0.084 \\
            & 2  & 0.229 & 0.256 & 0.165 & 0.134 & 0.096 & 0.511 & 0.325 & 0.186 & 0.148 & 0.127 & 0.680 & 0.400 & 0.320 & 0.220 & 0.150 & 1.376 & 0.367 & 0.159 & 0.167 & 0.138 & 0.313 & 0.339 & 0.155 & 0.153 & 0.127 \\
            & 4  & 0.371 & 0.399 & 0.267 & 0.198 & 0.155 & 0.663 & 0.510 & 0.297 & 0.243 & 0.205 & 1.050 & 0.920 & 0.360 & 0.310 & 0.240 & 1.444 & 0.516 & 0.278 & 0.228 & 0.196 & 0.497 & 0.451 & 0.258 & 0.240 & 0.196 \\
            & 8  & 0.564 & 0.776 & 0.451 & 0.339 & 0.280 & 1.050 & 1.269 & 0.479 & 0.414 & 0.378 & 1.580 & 1.340 & 0.660 & 0.540 & 0.450 & 1.895 & 1.181 & 0.507 & 0.386 & 0.883 & 0.865 & 1.213 & 0.487 & 0.441 & 0.382 \\
            & 16 & 1.086 & 1.408 & 0.917 & 0.658 & 0.743 & 1.692 & 1.847 & 1.157 & 0.900 & 0.723 & 2.100 & 2.520 & 1.480 & 1.170 & 1.030 & 2.379 & 2.192 & 1.041 & 1.468 & 1.183 & 1.448 & 2.275 & 1.145 & 0.880 & 0.740 \\
            & Avg & \cellcolor{low1}\textbf{0.483} & \cellcolor{low1}\textbf{0.600} & \cellcolor{low1}\textbf{0.381} & \cellcolor{low1}\textbf{0.285} & \cellcolor{low1}\textbf{0.269}
            & \textbf{0.863} & \textbf{0.834} & \textbf{0.448} & \textbf{0.359} & \textbf{0.306} 
            & \textbf{1.194} & \textbf{1.130} & \textbf{0.602} & \textbf{0.478} & \textbf{0.394} 
            & \textbf{1.661} & \textbf{0.915} &  \textbf{0.425} & \textbf{0.471} & \textbf{0.500} 
            & \textbf{0.670} & \textbf{0.896} & \textbf{0.430} & \textbf{0.364} & \textbf{0.306} \\
        \bottomrule
    \end{tabular}
    }
\end{table*}

\begin{table}[hpt]
    \centering
    \caption{Zero-shot performance with a lookback window length of 12. All results are averaged over 4 weeks or days in the future.
    \textit{Note: \cellcolor{low1}{\color{red} Best},  \cellcolor{low3}{\color{green} Second Best}, \cellcolor{low2}{\color{yellow} Third Best}}.}
    \label{tab:zero_shot_performance}
    \scalebox{0.61}{
    \begin{tabular}{lcccccc}
            \toprule
            \textbf{Dataset} & \textbf{CAPE} & \textbf{PatchTST} & \textbf{PEM} & \textbf{MOMENT} & \textbf{Naïve} & \textbf{ARIMA} \\
            \midrule
            ILI USA & \cellcolor{low1}\textbf{0.147} & \cellcolor{low2}\textbf{0.164} & \cellcolor{low3}\textbf{0.162} & 0.549 & 0.261 & 0.313   \\
            ILI Japan & \cellcolor{low1}\textbf{0.705} & \cellcolor{low2}\textbf{0.907} & \cellcolor{low3}\textbf{0.850} & 2.062 & 1.194 & 2.019    \\
            Measles & \cellcolor{low1}\textbf{0.145} & \cellcolor{low2}\textbf{0.167} & \cellcolor{low3}\textbf{0.159} & 0.533 & 0.194 & 0.258   \\
            Monkey Pox & \cellcolor{low1}\textbf{0.0004} & \cellcolor{low3}\textbf{0.0005} & \cellcolor{low2}\textbf{0.0005} & 0.0013 & 0.0012 & 0.0014   \\
            Dengue (mixed) & \cellcolor{low1}\textbf{0.371} & \cellcolor{low2}\textbf{0.427} & \cellcolor{low3}\textbf{0.413} & 1.624 & 0.611 & 0.841   \\
            RSV & \cellcolor{low1}\textbf{0.834} & \cellcolor{low3}\textbf{1.128} & \cellcolor{low2}\textbf{1.260} & 1.849 & 1.560 & 2.531   \\
            Covid (daily interval) & \cellcolor{low1}\textbf{5.173} & \cellcolor{low3}\textbf{6.001} & \cellcolor{low2}\textbf{6.320} & 18.881 & 30.350 & 30.315    \\
            \bottomrule
        \end{tabular}
    }
\end{table}



\begin{table*}[hpt]
    \centering
    \caption{Ablation study of removing components from the CAPE framework.}
    \label{tab:ablation_study}
    % \small  % 调整整个表格的字体大小为 small
    \resizebox{0.9\textwidth}{!}{%
    \begin{tabular}{@{}l *{18}{S[table-format=1.3]}@{}}
        \toprule
        \textbf{Horizon} & 
        \multicolumn{6}{c}{\textbf{ILI USA}} & 
        \multicolumn{6}{c}{\textbf{Measles}} & 
        \multicolumn{6}{c}{\textbf{Dengue}} \\
        \cmidrule(lr){2-7} \cmidrule(lr){8-13} \cmidrule(lr){14-19}
         & {1} & {2} & {4} & {8} & {16} & {Avg} 
         & {1} & {2} & {4} & {8} & {16} & {Avg} 
         & {1} & {2} & {4} & {8} & {16} & {Avg} \\
        \midrule
        CAPE & 0.155 & 0.200 & 0.270 & 0.404 & 0.516 & \textbf{0.309} 
             & 0.069 & 0.096 & 0.155 & 0.280 & 0.743 & \textbf{0.269} 
             & 0.218 & 0.301 & 0.540 & 1.193 & 2.210 & \textbf{0.892} \\
        w/o Env & 0.326 & 0.448 & 0.508 & 0.642 & 0.735 & 0.532 
               & 0.083 & 0.111 & 0.168 & 0.407 & 0.755 & 0.304
               & 0.232 & 0.316 & 0.484 & 1.089 & 3.622 & 1.149 \\
        w/o Contrast & 0.174 & 0.241 & 0.335 & 0.492 & 0.570 & 0.363 
                      & 0.090 & 0.124 & 0.276 & 0.431 & 0.801 & 0.344 
                      & 0.198 & 0.273 & 0.460 & 1.128 & 3.329 & 1.078 \\
        w/o Pretrain & 0.158 & 0.202 & 0.283 & 0.408 & 0.545 & 0.319
                      & 0.074 & 0.113 & 0.223 & 0.402 & 0.816 & 0.326
                      & 0.210 & 0.276 & 0.449 & 1.115 & 3.759 & 1.162 \\
        \bottomrule
    \end{tabular}
    }
\end{table*}


\section{Experiment}
\subsection{Experiment Setup}
\textbf{Datasets.} We evaluate the performance of our proposed CAPE model on 5 downstream datasets with different diseases across various locations: the influenza-like illness in the USA (ILI USA)~\cite{cdc_ili_usa} and Japan (ILI Japan)~\cite{cdc_ili_japan}, the novel COVID-19 infections~\cite{dong2020interactive} in the USA, Measle infections in England~\cite{lau2020competing}, and Dengue infections across countries~\cite{opendengue}. Additionally, we incorporated RSV~\cite{cdc_rsv} and Monkey Pox~\cite{cdc_monkeypox} infections in the US for testing the zero-shot performance of the pre-trained models.
A summary of the datasets we used is shown in Table~\ref{tab:downstream_datasets}. All datasets are normalized using z-score normalization and no further pre-processing is performed. To pretrain our model as well as PatchTST and PEM, we manually collect 17 datasets, with a weekly sampling rate, from Project Tycho~\cite{van2018project} and merge the data to the country level for each dataset. A detailed description of the pre-training dataset is shown in Appendix~\ref{Append_A}.

\textbf{Baselines.} We include various baselines including simple statistical models (ARIMA), RNN-based models (LSTM and GRU), a linear model (Dlinear), and transformer-based models (Informer, etc.). We also include self-supervised PatchTST, PEM, and a time series foundation model MOMENT to demonstrate the effectiveness of pre-training on epidemic-specific datasets. Due to the limitation of our univariate time series setting, models requiring external knowledge like SIR are not included as baselines.
% need to mention why SIR is not included? univariate setting 

\textbf{Settings.} 
For the ILI\_USA, Measles, and Dengue datasets, we use 60\% of the data for training, 10\% for validation, and 30\% for testing. For the remaining datasets, we use 40\% for training, 20\% for validation, and 40\% for testing. During the testing phase, we employ the model checkpoint that yields the best performance on the validation set.
Due to the limited length of epidemic time series data, we choose an input length of 36, following common practice~\cite{wu2023timesnet, wang2024tssurvey}. For models requiring patching, the patch size is set to 4 weeks. In the case of CAPE, we adopt a shared weight $w_k$ for all environment representations, initialized orthogonally. This approach simplifies Eq.~\ref{eq11} to an \textit{attention score}.
All reported results are evaluated using the Mean Squared Error (MSE). Additional implementation and experimental details are provided in Appendix~\ref{Append_B}.

\textbf{Reproducibility.} All data and code is available at \url{}.



\subsection{Baseline Comparison}

In this section, we demonstrate the effectiveness of our proposed CAPE model by comparing it with all kinds of baselines in three different settings: Fine-tuning, Few-shot Fine-tuning, and Zero-shot Forecasting.

\subsubsection{Fine-tuning} % main table 1
After the model is pre-trained, we replace the reconstruction head with a forecasting head and fine-tune the entire model on the downstream datasets. As shown in Table~\ref{tab: baselines}, CAPE consistently shows state-of-the-art performance in terms of average result across short and long range forecasting, from 1 week to 16 weeks. 

\textbf{Cross-Location.} We include the measles infections in the USA during pre-training, and then fine-tune on the measles dataset in the UK. Despite the regional difference, the pre-trained CAPE performs better compared to the model not pre-trained including itself, as shown in Table~\ref{tab:ablation_study}. Besides, we also included the Influenza dataset in the US during pre-training, and the model is able to generalize well on the Influenza infections in Japan (ILI Japan). 
% Specifically, CAPE performs best in forecasting from 2 weeks to 16 weeks on the Measle dataset, and 1 week to 8 weeks on the ILI Japan dataset.


\textbf{Cross-Disease.} Besides testing on diseases already seen, CAPE also shows strong transferability to unseen diseases, for example, Dengue and COVID-19. As shown in Table~\ref{tab: baselines}, CAPE outperforms the best baseline by 10.8\% on the Dengue dataset and 8.25\% on the Covid Dataset.

\textbf{Cross-Interval.} Though we only pre-trained our model on the datasets with weekly sampling rate, we found that the model still performs well on dataset with daily or mixed sampling rate. For example, the Dengue dataset contains weekly, monthly, and yearly data, which tends to be more stably sampled in a weekly rate for the more recent data. 
% Though our data splitting strategy does not include much weekly data, the model still performs well against baselines and the version not pre-trained, as shown in the ablation study. In addition, CAPE also generalizes well on the Covid dataset with a daily sampling rate.

% \textbf{In-domain Evaluation.} Besides proving the effectiveness of our model on the downstream datasets which are not included during pre-training, we also show that our pre-trained model is better than some other pre-trained models on the pre-training dataset. For the 17 pre-train datasets, we use the last 30\% of data for testing, which was not included in the pre-training process. As shown in the Appendix~\ref{}, CAPE outperforms the pre-trained PatchTST on 13/17 datasets. Though with a similar backbone model, CAPE achieves an average improvement of \%.



\subsubsection{Few-shot Performance} % main table 3

In the real world, the outbreak of unknown diseases or diseases at new locations could be hard for pure data-driven models to predict, as they only produce a limited amount of data in the beginning. Therefore, it is crucial for epidemic models to have few-shot or zero-shot forecasting ability. In this study, we further shrink the original training data from 100\% to 20\% to simulate the few-shot scenario, as shown in Table~\ref{tab: few_shot}. Compared with the Dlinear model directly trained on the limited data, most pre-trained models, including CAPE, PatchTST, MOMENT, and PEM show superior performance. 
% Among them, the proposed CAPE surpasses the best baseline by \% in terms of average performance, demonstrating a stronger few-shot learning ability.



\subsubsection{Zero-shot Performance} % main table 4
To further demonstrate the potential of our model, We also examine CAPE in the zero-shot setting. Specifically, we retain the pre-training head for transformer-based models and freeze all the parameters, except for the ARIMA model, during testing. All models accept a short period of input with 12 time steps (12 weeks) and predict future 4 weeks infections. As shown in Table~\ref{tab:zero_shot_performance}, the proposed CAPE yields sota performance across all baselines, even the ARIMA model that is fitted on the input data. 







\subsection{Ablation Study}
We conduct the ablation study to demonstrate the effectiveness of the designed components, as shown in table~\ref{tab:ablation_study}. First, we remove the environment estimators by replacing them with self-attention layers, resulting in a decrease in performance on three datasets, particularly ILI USA. Next, we keep the environment estimators and remove the contrastive loss which caused a drastic decrease in performance on the measles dataset. Lastly, we directly trained the CAPE model on the downstream datasets, and found a decreased performance, mostly on the measles and dengue datasets.

\subsection{Deeper Analysis}
\textbf{Impact of pre-train epochs.} To further explore the sensitivity to the number of environments as well as the impact of pre-training epochs, we plot the performance under different settings on four different downstream datasets, as shown in Figure~\ref{fig:num_envs}. In terms of pre-train epochs, we observe a consistent improvement in the measles and COVID datasets. However, the reverse is true for the ILI USA dataset. In terms of the number of environments, we observe that a large number of environments tend to perform better with more pre-train epochs.


% \begin{figure*}[t]
%     \centering
%     \begin{subfigure}[b]{0.66\textwidth}
%     \centering
%     \includegraphics[width=\textwidth]{figures/analysis_envs.pdf}
%     \caption{Downstream performance with different numbers of environments and pre-training epochs.}
%     \label{fig:num_envs}
%     \end{subfigure}
%     \hfill
%     \begin{subfigure}[b]{0.33\textwidth}
%     \centering
%     \includegraphics[width=\textwidth]{figures/envs/tsne_ILI_USA.pdf}
%     \caption{Visualization of the estimated environments on the ILI USA dataset using t-SNE.}
%     \label{fig:num_envs}
%     \end{subfigure}

% \end{figure*}

\begin{figure*}[ht]
    \centering
    % First Minipage for the first figure (66% width)
    \begin{minipage}[b]{0.7\textwidth}
        \centering
        \includegraphics[height=4.3cm, width=\textwidth]{figures/analysis_envs.pdf}
        \captionof{figure}{Downstream performance with different numbers of environments and pre-training epochs.}
        \label{fig:num_envs}
    \end{minipage}
    \hfill % Horizontal space between the figures
    % Second Minipage for the second figure (33% width)
    \begin{minipage}[b]{0.29\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/envs/tsne_ILI_USA.pdf}
        \captionof{figure}{Visualization of the estimated environments on the ILI USA dataset using t-SNE.}
        \label{fig:tsne_ILI_USA}
    \end{minipage}
\end{figure*}

% \begin{figure*}[ht]
%     \centering
%     % First Minipage for the first figure (65% width)
%     \begin{minipage}[t]{0.65\textwidth}
%         \centering
%         \includegraphics[height=5cm, keepaspectratio]{figures/analysis_envs.pdf}
%         \captionof{figure}{Downstream performance with different numbers of environments and pre-training epochs.}
%         \label{fig:num_envs}
%     \end{minipage}
%     % \hspace{0.05\textwidth} % Fixed horizontal space between the figures
%     \hfill
%     % Second Minipage for the second figure (30% width)
%     \begin{minipage}[t]{0.30\textwidth}
%         \centering
%         \includegraphics[height=5cm, keepaspectratio]{figures/envs/tsne_ILI_USA.pdf}
%         \captionof{figure}{Visualization of the estimated environments on the ILI USA dataset using t-SNE.}
%         \label{fig:tsne_ILI_USA}
%     \end{minipage}
% \end{figure*}



% \begin{figure*}[t]
%     \centering  % 确保整个图表居中
%     % 子图 1
%     \begin{subfigure}[b]{0.32\textwidth}
%         \centering
%         \includegraphics[width=\textwidth]{figures/alabtion_envs/epochs_envs_ILI_USA.pdf}
%         \caption{ILI USA}
%         \label{fig:num_envs_ili}
%     \end{subfigure}
%     % \hfill  % 子图之间添加水平间距
%     % 子图 2
%     \begin{subfigure}[b]{0.32\textwidth}
%         \centering
%         \includegraphics[width=\textwidth]{figures/alabtion_envs/epochs_envs_Measles.pdf}
%         \caption{Measles}
%         \label{fig:num_envs_measles}
%     \end{subfigure}
%     % \hfill  % 子图之间添加水平间距
%     % 子图 3
%     \begin{subfigure}[b]{0.32\textwidth}
%         \centering
%         \includegraphics[width=\textwidth]{figures/alabtion_envs/epochs_envs_Covid_daily.pdf}
%         \caption{Covid Daily}
%         \label{fig:num_envs_covid}
%     \end{subfigure}
    
%     \caption{Downstream performance with different numbers of environments and pre-training epochs.}
%     \label{fig:num_envs}
% \end{figure*}


\textbf{Impact of pre-train Materials.}
Previous studies have demonstrated that pre-training datasets significantly influence downstream performance~\cite{}. To further investigate potential biases in our pre-training dataset, we divide it based on respiratory and non-respiratory disease. Then we pre-train our model separately on each subset, and evaluate both pre-trained models using the Measle dataset, which pertains to respiratory diseases. As shown in Figure~\ref{fig: respiratory}, the model pre-trained on the respiratory disease dataset outperformed the one pre-trained on non-respiratory diseases. This outcome is expected, as respiratory diseases share more similar patterns, and pre-training on such data enhances the model's ability to generalize to datasets with comparable patterns.



\begin{figure}[htbp]
    \centering
    \includegraphics[scale=0.42]{figures/respiratory_Measles.pdf}
    \caption{Downstream performance on Measle dataset. The proposed model is pre-trained on datasets with either respiratory or non-respiratory diseases only.}
    
    \label{fig: respiratory}
\end{figure} 



\textbf{Impact of the scale of pre-train materials.}
To demonstrate the relationships between the scale of the pre-train materials and the downstream performance, we further scale the original pre-train dataset and test the performance on the downstream datasets. as shown in Figure ~\ref{fig: pretrain_scale}.  We observe a sudden increase in performance at around 60\% reduction for both measle and dengue datasets.

% \begin{figure}[htbp]
%     \centering
%     \begin{subfigure}[b]{\columnwidth}
%     \centering
%         \includegraphics[scale=0.42]{figures/pretrain_ratio_Dengue.pdf}
%         \caption{Dengue}
%     \end{subfigure}
    
%     \begin{subfigure}[b]{\columnwidth}
%     \centering
%         \includegraphics[scale=0.42]{figures/pretrain_ratio_Measles.pdf}
%         \caption{Measles}
%     \end{subfigure}
    
%     \caption{Downstream performance with different ratios of pre-training datasets. The input length is set to 36 and all MSE results are averaged over \{1,2,4,8,16\} future steps.}
    
%     \label{fig: pretrain_scale}
% \end{figure} 


\begin{figure}[htbp]
    \centering
    \includegraphics[scale=0.27]{figures/pretrain_ratio.pdf}
    
    \caption{Downstream performance with different ratios of pre-training datasets. The input length is set to 36 and all MSE results are averaged over \{1,2,4,8,16\} future steps.}
    
    \label{fig: pretrain_scale}
\end{figure} 



\textbf{Tackling Distribution Shift.} 
To measure the ability of the model to mitigate distribution shift, we adopt central moment discrepancy (CMD) score~\cite{jin2022empowering}. As shown in Figure~\ref{fig:CMD}, our model with environment estimation achieves the lowest CMD, confirming that modeling environments effectively mitigate the temporal distribution shifts described in Appendix~\ref{Append_F}.


\begin{figure}[htbp]
    \centering
    \includegraphics[width=\linewidth]{figures/CMD.pdf}

    \caption{CMD scores (lower values indicate better performance) of the embeddings produced by CAPE on the ILI USA and Measles datasets. We compare versions trained with and without environment estimation.}
    \label{fig:CMD}
\end{figure}


% \begin{figure}[htbp]
%     \centering
%     \begin{subfigure}[b]{0.23\textwidth} % Adjusted width to fit side by side
%         \centering
%         \includegraphics[width=\linewidth]{figures/CMD_ILI_USA.pdf}
%         \caption{ILI USA}
%         \label{fig:CMD_ILI_USA}
%     \end{subfigure}
%     \hfill % Adds horizontal space between subfigures
%     \begin{subfigure}[b]{0.23\textwidth}
%         \centering
%         \includegraphics[width=\linewidth]{figures/CMD_Measles.pdf}
%         \caption{Measles}
%         \label{fig:CMD_Measles}
%     \end{subfigure}
    
%     \caption{CMD scores (lower values indicate better performance) of the embeddings produced by CAPE on the ILI USA and Measles datasets. We compare versions trained with and without environment estimation.}
%     \label{fig:CMD}
% \end{figure}









