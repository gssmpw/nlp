\section{Introduction}
% epidemic forecasting background
Infectious disease outbreaks consistently challenge public health systems, affecting both individual well-being and economic stability~\cite{nicola2020socio}. Effective management of these outbreaks hinges on accurate epidemic forecasting, which involves predicting future incidences like infection cases and hospitalizations~\cite{liu2024review, wan2024epidemiology, adhikari2019epideep}. Over the years, various models have been developed to address this need. These include mechanistic models like SIR~\cite{cooper2020sir} and statistical models like ARIMA~\cite{sahai2020arima, kontopoulou2023review}, as well as advanced machine learning methods such as LSTM and GRU~\cite{shahid2020predictions}, which have proven instrumental in forecasting disease spread and supporting informed public health decision-making.


% Despite these advancements, many models are trained specifically for certain diseases in particular geographic regions and do not leverage valuable insights from past outbreaks from various sources. This narrow focus can hinder the ability to fully understand disease dynamics when data is scarce, potentially compromising quick and effective responses to existing diseases. This limitation becomes even more pronounced during emergent disease outbreaks, where observed data is often highly limited. Considering that numerous public health and research initiatives have amassed data across various diseases, spanning several decades and different geographic scales, pre-training on this large corpus may help the model learn useful and general knowledge of disease outbreaks. Therefore, an important question arises: 
% \textit{Can we leverage the collective lessons from diverse historical disease time series to develop a unified system that enhances the accuracy of epidemic forecasting?}

Despite the advancements, current models are typically trained for specific diseases within particular geographic regions, limiting their ability to integrate insights from diverse sources spanning multiple pathogens and spatiotemporal contexts. This narrow focus can impede a comprehensive understanding of disease dynamics and the design of effective outbreak responses, especially during novel or emergent outbreaks when observations are typically scarce. Given the extensive and diverse outbreak data collected over decades and across various geographies, pre-training on such a broad dataset could potentially enable the development of more generalizable models with greater applicability and adaptability across different pathogens and contexts. This raises an important question:
\textit{Can we leverage lessons from diverse historical disease time series to develop a generalized model that enhances epidemic forecasting accuracy?}



% Despite these advancements, many models are tailored specifically for certain diseases in particular geographic regions, which may overlook valuable insights from past outbreaks. This narrow focus can hinder the ability to fully understand disease dynamics when data is scarce, potentially compromising quick and effective responses to existing diseases. This limitation becomes even more pronounced during emergent disease outbreaks, where observed data is often highly limited. Considering that numerous public health and research initiatives have amassed data across various diseases, spanning several decades and different geographic scales, an important question arises: 
% \textit{Can we leverage the collective lessons from diverse historical disease time series to develop a unified system that enhances the accuracy of epidemic forecasting?}


% \begin{center}
%     { \textbf{\textit{\textcolor{teal}{Can we leverage the collective lessons from diverse historical disease time series to develop a unified system that enhances the accuracy of epidemic forecasting?}}}}
% \end{center}


% Unlike other time series datasets like electricity and climate~\cite{zhou2021informer}, the size of epidemic time series data is usually small due to a higher sampling interval, e.g., weekly, or bi-weekly.

% Nevertheless, several challenges hinder the effectiveness of these models in epidemic forecasting. First, unlike other time series datasets like electricity and climate~\cite{zhou2021informer}, the size of epidemic time series data is usually small due to a higher sampling interval, e.g., weekly, or bi-weekly. Second, the quality of data is not guaranteed. Missing data and noise could be introduced during the data collection phase. Such limitation of data scarcity hinders the power of deep learning, as it can be hard for these models to uncover the underlying disease dynamics with limited data and without external knowledge like mechanistic priors~\cite{gao2021stan}. 


% Lastly, as environmental factors like climate, urbanization, and mobility become increasingly complex and novel viruses like COVID-19 emerge, the dynamics of disease behavior have also become more difficult to predict without contexts like environments and interventions. 



 
 % In addition to the challenge of data sparsity and noise, the transferability of epidemic models is also in a very early stage of exploration. While traditional models are only fitted for one particular dataset with a single type of disease and region, the heterogeneous nature of epidemic data makes the transfer of these models a non-trivial problem. With diverse factors like regions, diseases, and the prediction targets (mortality, hospitality, infections, etc.), the performance of epidemic models could be hard to directly transfer to another dataset.  

% recent transformer-based models. only tested on one epidemic dataset, effectiveness unclear to epidemic scenario
% \wei{one or two sentences to summarize existing solutions...}
% \wei{describe the limitations of the existing solutions...}
% \wei{you mentioned three challenges in the above; but the following paragraph about pre-training/fine-tuning is disconnected with them.  We need cohesive transitions. You may highlight that pre-training/fine-tuning can address the first two challenges?} 
% \wei{One promissing  solution is xxxx (pretrained time series models...). However, they may fall short in modeling the epidemic characteristics well... }

% To address the above question, we draw inspiration from the success of large pre-trained transformer-based models~\cite{zhao2023survey}, and aim to develop a \textit{pre-trained epidemic forecasting model} using extensive disease time series data and subsequently fine-tune it for specific diseases or region. The pre-trained model will be capable of extracting universal patterns from the extensive epidemic time series data and swiftly adapting to downstream tasks for existing or novel diseases across various regions. While it is feasible to adapt general time series foundation models~\cite{liang2024foundation, ma2024survey} to epidemic forecasting, their pre-trained corpus often contains significant amounts of data from domains vastly different from epidemic curves, which could detrimentally affect forecasting accuracy. 



To address the above question, we draw inspiration from the success of large pre-trained transformer-based models~\cite{zhao2023survey} and develop a \textit{pre-trained epidemic forecasting model} using extensive disease time series data to distill generalizable knowledge across pathogens and contexts. 
The pre-trained model can be subsequently fine-tuned for specific diseases or geographical regions. While it is possible to adapt general time series foundation models~\cite{liang2024foundation, ma2024survey} to epidemic forecasting, their pre-trained corpus mostly consists of non-epidemic data, which may not accurately capture epidemic dynamics and infection trajectories, potentially degrading forecasting accuracy. Although an early effort has been made in epidemic pre-training~\cite{kamarthi2023pems}, it overlooks critical external factors such as temperature, elevation, and public health policies and interventions – factors are known to influence the dynamics of disease spread in space and time~\cite{lau2020characterizing} – potentially yielding suboptimal performance.
For instance, dengue infection spread may exhibit distinct dynamics in different geographical regions due to variations in temperature and humidity~\cite{chen2012modeling}. Without accounting for these external factors, models risk failing to capture their complex interplay with pathogens and producing inaccurate forecasts.
Throughout this paper, we refer to these external factors as \textit{environments}.


Nevertheless, the need to robustly and effectively account for the environment further intensifies the challenge of developing an epidemic pre-training framework that is generalizable across varying pathogens and contexts.
%disentangling disease dynamics from the influence of ever-changing environments. 
A major obstacle is the shift in the temporal distribution of infection trajectories between training and test datasets, often driven by the changes in the environment.
Insufficient consideration of such distribution shifts can obscure the relationship between historical infection data and future predictions (for a detailed discussion, see Appendix~\ref{Append: ds}), compromising a model's ability to make accurate forecasts.
As such, it is crucial to disentangle the influence of changing environments from other more intrinsic factors (e.g., a pathogen's infection rate) affecting disease transmission dynamics. Yet, exact and explicit mechanisms by which the environment influences the disease dynamics of a particular pathogen are often not fully understood, which necessitates a sophisticated modeling approach to identify and separate these latent environmental influences.
%Specifically, training data collected under specific environments may not accurately represent disease dynamics under changed environments, thereby complicating accurate forecasting. 
%Specifically, the environments influencing the training data may not be identical to those associated with the test data. Thus, to achieve accurate (future) forecasting, it is crucial to disentangle the influence of changing environments from other intrinsic factors affecting disease transmission dynamics.
%Moreover, the acquisition of precise environmental data adds another layer of complexity, as these data are often difficult to obtain consistently due to variability in data availability and quality. 
%Therefore, addressing these challenges to develop a robust model that consistently delivers accurate predictions despite environmental fluctuations is urgently needed.

% With rapidly evolving infection dynamics caused by changing environments, temporal distribution shifts may arise between the training and testing datasets, creating unstable relation between the data and the . These shifts occur when the statistical properties of the data evolve over time, making patterns learned during training less applicable during test~\cite{chen2024calibration, zhang2022dynamic}.  For instance, variations in public health policies, or seasonal factors can alter transmission rates and recovery patterns, resulting in distinct infection trajectories across different periods (see a detailed discussion in Appendix~\ref{Append: ds}). 

% Second, detailed environmental information are highly complex and can be challenging to obtain due to variability in data availability and quality. Thus, deisnging a mechanism to incoporate the environmental influence of of essnece.

% For example, a model trained on disease data from regions where certain infectious diseases are prevalent might struggle when applied to areas with different climate conditions or health infrastructures. Without accounting for these diverse environmental elements, models might generate inaccurate forecasts, failing to capture the complex interactions between the pathogen and its surroundings.

% With rapidly evolving infection dynamics caused by changing environments, temporal distribution shifts may arise between the training and testing datasets. These shifts occur when the statistical properties of the data evolve over time, making patterns learned during training less applicable during test~\cite{chen2024calibration, zhang2022dynamic}. For instance, variations in public health policies, or seasonal factors can alter transmission rates and recovery patterns, resulting in distinct infection trajectories across different periods (see a detailed discussion in Appendix~\ref{Append: ds}).


% The epidemic infection trajectory fundamentally results from the interactions between the disease and its surrounding environment~\cite{jutla2013environmental}, which can fluctuate rapidly within a few weeks and require special treatments during modeling. \textit{Firstly}, while pre-training aims to capture universal patterns from diverse disease dynamics, it can be hard for the model to disentangle the disease dynamics from the environmental influence. From a causal perspective, as shown in Figure~\ref{fig: causal_graph}, such disentanglement means removing the causal effects of the environment variable on other variables(e.g. historical infection trajectory). \textit{Secondly}, with rapidly evolving infection dynamics caused by changing environments, temporal distribution shifts may arise between the training and testing datasets. These shifts occur when the statistical properties of the data evolve over time, making patterns learned during training less applicable during test~\cite{chen2024calibration, zhang2022dynamic}. For instance, variations in public health policies, or seasonal factors can alter transmission rates and recovery patterns, resulting in distinct infection trajectories across different periods (see a detailed discussion in Appendix~\ref{Append: ds}).



% {Moreover, although mechanistic models do not heavily rely on the training data, as they directly define the disease transmissions through differential equations, they fail to account for exogenous factors changing the behaviors that influence infection transmission (e.g. quarantine policy reduces infection rate). In this paper, we term such factors as the \textit{environment}.}

% Moreover, these models typically fail to account for \textit{environment} or \textit{environmental factors}, which complicate predictions of infection trajectories as factors like policies and mobility play increasingly complex roles in the spread of novel viruses such as COVID-19. Notably, although an existing work~\cite{kamarthi2023pems} has made an attempt to develop a pre-trained epidemic forecasting model, it also overlooks the modeling of environment and tends to deliver suboptimal performance, as we will demonstrate in our experiments.

% \textbf{Why is it necessary to model the environment for epidemic pre-training?} 
% The epidemic infection trajectory fundamentally results from the interactions between the disease and its surrounding environment~\cite{jutla2013environmental}, which can fluctuate rapidly within a few weeks and require special treatments during modeling. \textit{Firstly}, while pre-training aims to capture universal patterns from diverse disease dynamics, it can be hard for the model to disentangle the disease dynamics from the environmental influence. From a causal perspective, as shown in Figure~\ref{fig: causal_graph}, such disentanglement means removing the causal effects of the environment variable on other variables(e.g. historical infection trajectory). \textit{Secondly}, with rapidly evolving infection dynamics caused by changing environments, temporal distribution shifts may arise between the training and testing datasets. These shifts occur when the statistical properties of the data evolve over time, making patterns learned during training less applicable during test~\cite{chen2024calibration, zhang2022dynamic}. For instance, variations in public health policies, or seasonal factors can alter transmission rates and recovery patterns, resulting in distinct infection trajectories across different periods. More analysis is in Appendix~\ref{Append: ds}.

% correlations intrinsic to disease behavior from those caused by environmental influences

% \textbf{Why is it necessary to model the environment for epidemic pre-training?} 
% The epidemic infection trajectory fundamentally results from the interactions between the disease and its surrounding environment~\cite{jutla2013environmental}, which can fluctuate rapidly within a few weeks and require special treatments during modeling. \textit{Firstly}, while pre-training aims to capture universal patterns from diverse disease dynamics, it can be hard for the model to disentangle the correlations intrinsic to disease behavior from those caused by environmental influences. \textit{Secondly}, with rapidly evolving infection dynamics caused by changing environments, temporal distribution shifts may arise between the training and testing datasets. These shifts occur when the statistical properties of the data evolve over time, making patterns learned during training less applicable during test~\cite{chen2024calibration, zhang2022dynamic}. For instance, variations in public health policies, or seasonal factors can alter transmission rates and recovery patterns, resulting in distinct infection trajectories across different periods. More analysis is in Appendix~\ref{Append: ds}.



% \textbf{Challenge of modeling the environment in the epidemic setting.} Though the important role of the environment is recognized in epidemic forecasting, incorporating environmental factors during pre-training is difficult for numerous reasons: 
% \textbf{(1) Attribute Scarcity:} While intuitively a wide range of factors can influence infection trajectories, the number of attributes in the pre-training dataset is small, which may not represent the most influential factors on epidemic forecasting.
% \textbf{(2) Heterogeneity:} Furthermore, since the pre-training dataset is comprised of data from various sources, the collected attributes may not align with each other, therefore hard to identify the universal environment factors that are able to be identified in all datasets.
% To deal with these challenges, we propose to learn the universal environment from the observed infection trajectories in a data-driven manner.

% \zw{\textbf{Challenges in Modeling Environmental Factors for Epidemic Forecasting.} Although the critical role of the environment is acknowledged in epidemic forecasting, incorporating environmental factors during pre-training poses several challenges: \textbf{(1) Attribute Scarcity:} Despite the intuitive understanding that a wide range of factors influence infection trajectories, pre-training datasets often include a limited number of attributes. This scarcity may prevent the inclusion of the most impactful factors necessary for accurate epidemic forecasting. \textbf{(2) Heterogeneity:} Additionally, pre-training datasets are typically compiled from diverse sources, resulting in inconsistent or non-aligned attributes. This heterogeneity makes it difficult to identify universal environmental factors that are applicable across all datasets. To overcome these challenges, we propose learning universal environmental factors directly from the observed infection trajectories using a data-driven approach.} while pre-training aims to capture universal patterns from diverse disease dynamics, it can be hard for the model to disentangle the disease dynamics from the environmental influence. From a causal perspective, as shown in Figure~\ref{fig: causal_graph}, such disentanglement means removing the causal effects of the environment variable on other variables(e.g. historical infection trajectory).  Thus, xxx.

% Furthermore, though a large pre-training dataset is given, missing values as well as a limited number of attributes make it hard to determine the major factors influencing the disease dynamics.
% \wei{i feel mentioing missing value and likited attributes make the narrative mote complex. it is not straightforward to see the connections between and the modeling of environments; they are more like general problems for edpidemic forecasting.}

% \sout{An illustrative example of such a temporal distribution shift is shown in Figure~\ref{fig: ds}, where the characteristics of the training data present significantly different patterns compared to the testing data. 
% Therefore, to adapt to evolving dynamics and mitigate the effects of temporal distribution shifts, it is essential to incorporate environmental factors into epidemic modeling.}

% As a supportive example, while the classic SIR model gives an infection trajectory totally determined by the initial state, as well as the infection and recovery rates, recent advanced models have been trying to use dynamic infection rates in the SIR model~\cite{}, which reflects the involvement of 
% Consider a negative example of the ode-based SIR model. The initial condition as well as the fixed infection and recovery rates completely determine the infection trajectory, ignoring potential variations during the generation of forecasts. Eventually, such limitation drives the design of models using dynamic infection and recovery rates~\cite{cao2022mepognn}, highlighting the importance of modeling environments.
% Therefore, to mitigate the temporal distribution shifts, it is important to model the root of the cause, which is the environment.
% as the environment changes, the infection dynamics may also evolve, leading to temporal distribution shifts between the training and testing datasets.


% First, the epidemic spreading is naturally the interactions between the disease and the environment. While diseases may not evolve so fast, the environments may change rapidly in weeks. Therefore, to account for a more complete modeling of disease dynamics, it is necessary to take the dynamically changing environment into account. In practice, however, classic SIR applies a fixed infection and recovery rate, implicitly assuming a constant environment. Realizing this, MepoGNN~\cite{cao2022mepognn} introduces dynamic infection rates for the SIR model, allowing the model to adapt to changing environments. Second, as the changing environment produces evolving infection dynamics, temporal distribution shifts can arise between the training and testing sets, an example of which is shown in Figure~\ref{fig: ds}. 
% Even worse, data scarcity could exacerbate these shifts as the training sets are shrunk, which hinders the learning for the model. 


% First, as demonstrated by previous studies, environmental factors can play a pivotal role in the changing disease dynamics. While SIR implicitly assumes a constant environment by using fixed infection and recovery rates, MepoGNN~\cite{cao2022mepognn} infers these parameters, allowing the model to adapt to changing environments. Second, as the environment shifts produce evolving disease dynamics, temporal distribution shifts can arise between the training and testing sets, an example of which is shown in Figure~\ref{fig: ds}. What's more, data scarcity could exacerbate these shifts by shrinking the training sets, further hindering the model’s generalizability. 


% Though Nevertheless, integrating environments into the model can inadvertently introduce spurious correlations~\cite{ming2022impact}, which arise when variables are correlated not due to a direct causal link, but through their mutual association with a third variable, in this case, the environment. To mitigate the effects of these spurious correlations, covariate adjustment~\cite{runge2023causal} serves as a standard methodological tool that controls for confounding variables to isolate the true causal effect of interest, thereby enhancing the model's generalizability across diverse epidemiological scenarios. Nonetheless, effective covariate adjustment requires a comprehensive set of valid confounders to accurately control for all potential sources of bias, which can be challenging to achieve. 
% \wei{we should highlight some specific challenges of modeling environments (or covariate adjustment) in pre-trainig. If you do not know, please think about what challenges your proposed approaches (environment learning, contrastive learning, EM optimization) are addressing }




% Since the environment can influence both the historical infection trajectory and the future trajectory that we want to predict, it resembles the confounder in causal modeling~\cite{wu2024graph}. Therefore, we can model the environment as a component in the causal graph shown in Figure~\ref{fig: causal_graph}. Nevertheless, incorporating these factors can introduce spurious correlations~\cite{ming2022impact}, which could lead to over-fitting and reduce the model’s ability to generalize across different diseases. To mitigate effects brought by these spurious correlations, covariate adjustment~\cite{runge2023causal} serves as a standard tool. However, a comprehensive set of valid confounders is required, which may not be available due to data scarcity.


% Switching to the view of causal inference, environmental factors impacting both inputs and prediction targets are identified as confounders~\cite{wu2024graph}. Therefore, we can model the environments as a component in the causal graph as shown in Figure~\ref{fig: causal_graph}. Nevertheless, incorporating these factors can introduce spurious correlations~\cite{ming2022impact}, which could lead to over-fitting and reduce the model’s ability to generalize across different contexts and datasets. To mitigate effects brought by these spurious correlations, covariate adjustment~\cite{runge2023causal} serves as a standard tool but requires a comprehensive set of valid confounders, which may not be available.

% \textbf{Challenge 2: Modeling Environments for Epidemic Forecasting.} 
% Beyond directly learning the diverse patterns from the pre-training datasets, hidden variables underlying the data can also be highly informative~\cite{zhu2024causal, wu2024graph}. Traditional models like the SIR model use fixed infection and recovery rates, implicitly assuming a constant environment. However, real-world environments, including factors like temperature, humidity and population mobility, are highly dynamic and continuously affect disease transmissions. Recognizing the pivotal role of these environmental factors, MepoGNN~\cite{cao2022mepognn} infers the infection rate at each time point based on historical data, allowing the model to adapt to changing conditions. Nonetheless, MepoGNN does not explicitly model the environments and study the transferability of the model.
% Switching to the view of causal inference, environmental factors impacting both inputs and prediction targets are identified as confounders~\cite{wu2024graph}, as shown in Figure~\ref{fig: causal_graph}. Incorporating these factors can introduce spurious correlations~\cite{ming2022impact}, which could lead to over-fitting and reduce the model’s ability to generalize across different contexts and datasets. To mitigate effects brought by these spurious correlations, covariate adjustment~\cite{runge2023causal} serves as a standard tool but requires a comprehensive set of valid confounders, which are often unavailable in real-world epidemic datasets. In addition, collecting and identifying all potential confounders is also challenging.

% % Last but not least, incorporating environmental factors can introduce spurious correlations~\cite{ming2022impact}. Such misleading associations can lead to over-fitting and reduce the model’s ability to generalize across different contexts or datasets. 

% \textbf{Challenge 3: Tackling Temporal Distribution Shift.} Beyond the above challenge, temporal distribution shifts~\cite{chen2024calibration, zhang2022dynamic} add another layer of obstacle. As Figure~\ref{fig: ds} shows, a large gap could exist between the distributions of training and testing data. Therefore, with underlying dynamics evolving, models trained on specific datasets may struggle to recognize new patterns both temporally and spatially. While pre-training can mitigate this issue by expanding the training set to capture a wider range of patterns and employing effective pretext tasks~\cite{guo2023ehr}, it does not resolve confounding issues that lead to spurious correlations. Thus, integrating environment estimation into the pre-training process serves as a novel and promising approach. 


% \begin{figure*}[t]
%     \centering
%     \begin{subfigure}[b]{0.73\textwidth}
%         \centering
%         \includegraphics[width=\linewidth]{figures/CAPE.pdf}
%         \caption{Overview of the CAPE framework: (a) CAPE encoder and environment estimator with fixed Environment representations; (b) Contrastive learning for temporal representations and environment estimates; (c) Self-supervised learning by masking and reconstructing input patches to capture universal patterns; (d) EM algorithm optimization to iteratively learn model parameters and environment representations.}
%         \label{fig:CAPE}
%     \end{subfigure}
%     \hfill
%     \begin{subfigure}[b]{0.26\textwidth}
%         \centering
%         \includegraphics[width=\linewidth]{figures/causal_graph.pdf}
%         \caption{ Structural causal model (SCM) for epidemic foresting, where $Z$ refers to the environment variable as the confounder, and $X_s$ and $X_c$ refer to the spurious and causal factors of the input.}
%         \label{fig: causal_graph}
%     \end{subfigure}
    
% \end{figure*}


\begin{figure*}[t!]
    \centering
    \begin{minipage}{0.68\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/CAPE.pdf}
        % \vskip -1em
        \caption{(a) CAPE encoder and environment estimator with latent representations; (b) Hierarchical environment contrasting for temporal and environment representations; (c) Random masking and reconstruction with environment estimation to capture universal patterns; (d) EM algorithm to iteratively optimize model parameters and environment representations.}
        \label{fig:CAPE}
    \end{minipage}
    \hfill
    \begin{minipage}{0.31\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/causal_graph.pdf}
        % \vskip -1em
        \caption{Structural causal model for epidemic foresting, where $Z$ refers to the environment states, and $X_s$ and $X_c$ refer to the spurious and causal factors of the input.}
        \label{fig: causal_graph}
    \end{minipage}
    % \vskip -1.5em
\end{figure*}


% \begin{figure*}[t]
%     \centering
%     \includegraphics[scale=0.4]{figures/CAPE.pdf}
%     \caption{Overview of the CAPE framework: (a) CAPE encoder and environment estimator with fixed Environment representations; (b) Contrastive learning for temporal representations and environment estimates; (c) Self-supervised learning by masking and reconstructing input patches to capture universal patterns; (d) EM algorithm optimization to iteratively learn model parameters and environment representations.}
%     \label{fig:CAPE}
% \end{figure*} 

% \begin{figure}[t]
% \centering
% \includegraphics[scale=0.35]{figures/causal_graph.pdf}
% \caption{ Structural causal model (SCM) for epidemic foresting, where $Z$ refers to the environment variable as the confounder, and $X_s$ and $X_c$ refer to the spurious and causal factors of the input.}
% \label{fig: causal_graph}
% \end{figure}

% \caption{Overview of the proposed CAPE framework: (a) The structure of CAPE involves both the transformer encoder and the environment estimator, powered by a set of fixed exogenous representations. (b) Hierarchical contrastive learning for both the final temporal representations of all patches and the estimated environments. (c) Self-supervised learning from the pre-train datasets. The input patches are randomly masked and reconstructed to learn universal patterns. (d) CAPE is optimized using the EM algorithm, which iteratively learns the model parameters and the environment representations.}


% current challenges + our goal + contributions
% \wei{highlight Pre-training...} 
% \wei{How about Covariate-Adjusted Pre-training in Epidemic forecasting (CAPE)} 
% \wei{we need to better connect  this paragraph with the above paragraphs. }

% \wei{I feel our focus should be pre-training. Other components are serving for enhancing pre-training instead of using pre-training to enhance other components. Keep this in mind and revisit your previous and following paragraphs. I had similar comments for the methodology section}


\textbf{Our Solution.} 
% To integrate insights from a wide range of historical diseases and effectively model environmental factors, we propose \textbf{C}ovariate-\textbf{A}djusted \textbf{P}retraining for \textbf{E}pidemic forecasting (\textbf{CAPE}), as shown in Figure~\ref{fig:CAPE}. Our approach addresses the challenges of limited observations in time series data and the complex influence of environmental factors by combining a pre-training framework with explicit environmental modeling and covariate adjustment. Specifically, we draw inspiration from the covariate adjustment framework~\cite{runge2023causal} and make a nontrivial design for epidemic pre-training by leveraging extensive datasets across diverse diseases and regions to capture the universal patterns of disease dynamics. During the pre-training phase, CAPE utilizes epidemics-aware self-supervised learning, including mask reconstruction (Figure~\ref{fig:CAPE}(c)) and hierarchical environment contrastive learning (Figure~\ref{fig:CAPE}(b)), to enhance its understanding of the disease dynamics and environmental influence. Furthermore, an environment estimator is introduced, which estimates dynamic environments based on a set of latent environment representations learned during pre-training using \textit{Expectation-Maximization} algorithm. In summary, this combined approach of leveraging large-scale pre-training and explicit environment estimation enables CAPE to forecast epidemic trends more accurately. Our contributions can be summarized as follows:
To integrate insights from extensive historical diseases and effectively model environmental factors, we propose \textbf{C}ovariate-\textbf{A}djusted \textbf{P}retraining for \textbf{E}pidemic forecasting (\textbf{CAPE}) to capture the universal patterns of disease dynamics, as shown in Figure~\ref{fig:CAPE}. Our approach addresses the challenges of optimizing the model with limited observations of a single disease infection trajectory and the complex influence of the environment by \textit{combining a pre-training framework with explicit environment modeling}. Drawing on principles from causal analysis and covariate adjustment~\cite{runge2023causal}, CAPE aims to estimate the latent environments and control for their influences for epidemic forecasting. Specifically, during the pre-training phase, CAPE utilizes environment-aware self-supervised learning, including random masking (Figure~\ref{fig:CAPE}(c)) and hierarchical environment contrasting (Figure~\ref{fig:CAPE}(b)), to enhance its understanding of the disease dynamics and environmental influence. Furthermore, an environment estimator is introduced, which estimates dynamic environments based on latent environment representations learned during pre-training using \textit{Expectation-Maximization} algorithm. Our contributions can be summarized as follows:

\begin{compactenum}[\textbullet]
    \item We propose a novel epidemic pre-training framework, namely CAPE, that learns representations of environments and performs covariate adjustment on the input epidemic time series data, which aims to disentangle the inherited disease dynamics from the environment. 
    % \item We propose a novel epidemic pre-training framework, namely CAPE, that learns representations of environments and performs covariate adjustment on the input epidemic time series data, which aims to reduce the impact of temporal distribution shift and disentangle the inherited disease dynamics from the environment. 

    \item We assemble a diverse collection of epidemic time series datasets from various diseases and regions, serving as {a crucial testbed} for evaluating pre-trained epidemic forecasting models. This allows for extensive testing across multiple scenarios, including few-shot, zero-shot, cross-location, and cross-disease evaluations.
    % \wei{spurious correlation?} \wei{I don't hope to repeat this multiple times but we really need to pay attention to the connections of your words/sentences/paragraphs. (1) this is the first place we mention spurious correlation; readers will not understand what we mean here (2) again, in the above paragraphs you mentioned some specific challenges like distribution shifts, like disentangling the correlations; just calling  them back here and we do not need new concepts like spurious correlation which will only confuse people}
    % \wei{to solve waht issue}

    % \item We bridge the gap between Neural Discrete Representation Learning and Backdoor Adjustment...

    % \item \zw{The proposed layer-wise covariate adjustment procedure as well as the learned environment representations can be easily transferred to other models to boost the performance.}

    % \item To unlock the full potential of epidemic models and establish a large cohesive data repository for benchmarking epidemic forecasting, we gather and create an epidemic pile for pre-training and evaluating epidemic models, spanning various types of diseases and regions. 
    % \wei{if we claim this to be a contribution our method or experiment section should highlight this more like the MOMENT paper}
    
    \item We demonstrate the effectiveness of pre-training on epidemic datasets, showcasing superior performance across various downstream datasets and settings. Notably, CAPE surpasses the best baseline by an average of 9.9\% in the full-shot setting and 18.1\% in the zero-shot setting across all tested downstream datasets.
    
    % \wei{highlight some numbers} 

    \item We provide an in-depth analysis of how pre-training and environment estimation affect downstream performance and mitigate the impact of distribution shifts.

% and strong transferability across diseases, regions, and time intervals.

    
    
\end{compactenum}




% Challenges and Motivations:

% Lack of a large collection of public epidemic data

% Lack of a unified benchmark and pipeline for epi-data

% Epi data are relatively small, making the model hard to learn all patterns for a disease in different environments

% The underlying dynamics are influenced by many external factors, and some of them are unable to observe, causing the model

% The temporal dynamics change over time, which could be hard for a fixed model to adapt to new patterns



% We resolve the above challenges by using pre-training and an environment estimator:

% pre-training helps the model generalize on small downstream tasks (1 or 2 paper supporting this)

% We adopt a unified perspective, viewing all variables that could have an impact on the disease dynamics as multiple environments. R_m -> R_e

% We model the external factors influencing the target dynamics in a way similar to covariate adjustment, codebook, conditional generation, RAG and Invariant Learning

% We assume that, for a specific type of disease, the transmission pattern does not change given a fixed environment.So that the temporal dynamics change is only influenced by the environment, and our stored environments thus enables query of the current environment, making the model environment-aware and able to handle the dynamics change caused by the environment change.

% Most importantly, instead of directly modeling y=f(x), we use : y=f(x | E), where E is learned during pre-training.


% *** Logic

% Epidemic data is usually small and limited: 1. length 2. frequency, comparing to datasets in other domains, ECL, ETH...

% The limited length of the data provides little information from a longitudinal perspective. However, since we can collect information on multiple diseases across various regions simultaneously, we can obtain a wealth of information from a cross-sectional perspective.

% To fully utilize cross-sectional information, pre-training has demonstrated a strong increase in performance for transformer-based models.

% Besides explicitly learning useful information across datasets, environments or the context of the diseases also plays an important role in influencing the behavior of the epidemic. Previous studies.... However, since the epidemic datasets are usually small, we can only obtain limited knowledge of the interactions between the the environments and the current diseases. To improve generalization on the future epidemic, inferring environments during pre-training is a promising direction, as the same environments can appear in both training and testing sets. Pre-training on those training set could potentially help improve test set performance for another disease.

