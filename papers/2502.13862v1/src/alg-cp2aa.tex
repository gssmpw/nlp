\begin{algorithm}[hbtp]
\caption{Our Concurrent Pow-of-2 Arena Allocator (CP2AA).}
\label{alg:cp2aa}
\begin{algorithmic}[1]
\Require{$\textsc{pool\_size}_a$: Size of each memory pool (constant)}

\Statex

\State \textbf{struct} $CP2AA \langle \textsc{pool\_size}_a \rangle ()$
\State \ \ $\textsc{pool\_size} \gets \textsc{pool\_size}_a$ \Comment{Size of each memory pool} \label{alg:cp2aa--init-const}
\State \ \ $p2aa_T \gets \{P2AA \langle \textsc{pool\_size} \rangle (),\ \dots\}$ \Comment{Per-thread allocator} \label{alg:cp2aa--init}

\Statex

\State $\rhd$ Allocate memory of size that is a power of 2
\Function{allocate}{$size$} \textbf{of} CP2AA
  \State $t \gets$ Current thread \label{alg:cp2aa--allocate-begin}
  \Return{$p2aa_T[t].allocate(size)$} \label{alg:cp2aa--allocate-end}
\EndFunction

\Statex

\State $\rhd$ Free allocated memory
\Function{deallocate}{$ptr, size$} \textbf{of} CP2AA
  \State $t \gets$ Current thread \label{alg:cp2aa--deallocate-begin}
  \State $p2aa_T[t].deallocate(ptr, size)$ \label{alg:cp2aa--deallocate-end}
\EndFunction

\Statex

\State $\rhd$ Free all allocated memory
\Function{reset}{$ $} \textbf{of} CP2AA
  \ForAll{$t \in threads$} \label{alg:cp2aa--reset-begin}
    \State $p2aa_T[t].reset()$
  \EndFor \label{alg:cp2aa--reset-end}
\EndFunction

\Statex

\State $\rhd$ Get recommended allocation size, for a desired size
\Function{allocationSize}{$size$} \textbf{of} CP2AA
  \Return{$P2AA \langle \textsc{pool\_size} \rangle.allocationSize(size)$} \label{alg:cp2aa--allocationsize}
\EndFunction
\end{algorithmic}
\end{algorithm}

% NOTE: Per-thread allocators are well-separated in memory to avoid false sharing.
