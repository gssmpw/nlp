\begin{algorithm}[hbtp]
\caption{Subtract a graph's edges from another graph.}
\label{alg:sub}
\begin{algorithmic}[1]
\Require{$G(V, E)$: Input graph to subtract from}
\Require{$G_S(V_S, E_S)$: Graph containing the edges to subtract}
\Require{$G'(V', E')$: Output graph, with edges from $G_S$ removed}
\Ensure{$\Delta M$: Number of edges deleted from $G$}

\Statex

\Function{subtractGraphInplace}{$G, G_S$}
  \State $\Delta M \gets 0$
  \State $\rhd$ Remove the edges in-place
  \ForAll{$u \in V_S$ \textbf{in parallel}} \label{alg:sub--inplace-for-begin}
    \If{\textbf{not} $G.hasVertex(u)$} \textbf{continue} \label{alg:sub--inplace-check}
    \EndIf
    \State $\Delta M \gets \Delta M + G.removeEdges(u, G_S.edges(u))$ \label{alg:sub--inplace-remove}
  \EndFor \label{alg:sub--inplace-for-end}
  \State $\rhd$ Update the edge count
  \State $|E| \gets |E| - \Delta M$ \label{alg:sub--inplace-update-edges}
  \Return{$G$} \label{alg:sub--inplace-return}
\EndFunction

\Statex

\Function{subtractGraph}{$G, G_S$}
  \State $G' \gets \{\}$ \textbf{;} $\Delta M \gets 0$ \label{alg:sub--init}
  \State $\rhd$ Reserve space for vertices
  \State $G'.reserve(maxVertexId(G) + 1)$ \label{alg:sub--reserve-vertices}
  \State $\rhd$ Add vertices
  \ForAll{$u \in V$ \textbf{in parallel}} \label{alg:sub--add-vertices-begin}
    \State $G'.addVertex(u)$
  \EndFor \label{alg:sub--add-vertices-end}
  \State $\rhd$ Reserve space for edges
  \ForAll{$u \in V$ \textbf{in parallel}} \label{alg:sub--alloc-edges-begin}
    \State $G'.allocateEdges(u, G.degree(u))$
  \EndFor \label{alg:sub--alloc-edges-end}
  \State $\rhd$ Add edges of vertices that are untouched
  \ForAll{$u \in V$ \textbf{in parallel}} \label{alg:sub--copy-untouched-begin}
    \If{$G_S.hasVertex(u)$} \textbf{continue}
    \EndIf
    \State $G'.edges(u) \gets G.edges(u)$
    \State $G'.degree(u) \gets G.degree(u)$
  \EndFor \label{alg:sub--copy-untouched-end}
  \State $\rhd$ Add edges of vertices that are touched
  \ForAll{$u \in V$ \textbf{in parallel}} \label{alg:sub--copy-touched-begin}
    \If{\textbf{not} $G_S.hasVertex(u)$} \textbf{continue}
    \EndIf
    \State $G'.edges(u) \gets G.edges(u) \setminus G_S.edges(u)$
    \State $G'.degree(u) \gets |G'.edges(u)|$
    \State $\Delta M \gets \Delta M + |G.edges(u)| - |G'.edges(u)|$
  \EndFor \label{alg:sub--copy-touched-end}
  \State $\rhd$ Update the vertex and edge count
  \State $|V'| \gets |V|$ \textbf{;} $|E'| \gets |E| - \Delta M$ \label{alg:sub--update-counts}
  \Return{$G'$} \label{alg:sub--return}
\EndFunction
\end{algorithmic}
\end{algorithm}
