\begin{algorithm}[hbtp]
\caption{A Power-of-2 size Arena Allocator (P2AA).}
\label{alg:p2aa}
\begin{algorithmic}[1]
\Require{$\textsc{pool\_size}_a$: Size of each memory pool (constant)}

\Statex

\State \textbf{struct} $P2AA \langle \textsc{pool\_size}_a \rangle ()$
\State \ \ $\textsc{pool\_size} \gets \textsc{pool\_size}_a$ \Comment{Size of each memory pool} \label{alg:p2aa--init-const}
\State \ \ $aa16 \gets AA \langle 16, \textsc{pool\_size} \rangle ()$ \Comment{For $16$-byte allocations} \label{alg:p2aa--init-begin}
\State \ \ $aa32 \gets AA \langle 32, \textsc{pool\_size} \rangle ()$ \Comment{For $32$-byte allocations}
\State \ \ $\cdots$ \Comment{For $64$ to $4096$-byte allocations}
\State \ \ $aa8192 \gets AA \langle 8192, \textsc{pool\_size} \rangle ()$ \Comment{For $8192$-byte allocations} \label{alg:p2aa--init-end}

\Statex

\State $\rhd$ Allocate memory of size that is a power of 2
\Function{allocate}{$size$} \textbf{of} P2AA
  \State \textbf{switch} $(size)$
  \State \ \ \textbf{case} $16$: \ReturnInline{$aa16.allocate()$} \label{alg:p2aa--allocate-pow2-begin}
  \State \ \ \textbf{case} $32$: \ReturnInline{$aa32.allocate()$}
  \State \ \ $\cdots$
  \State \ \ \textbf{case} $8192$: \ReturnInline{$aa8192.allocate()$} \label{alg:p2aa--allocate-pow2-end}
  \State \ \ \textbf{default}: \ReturnInline{Allocate $size$ bytes} \label{alg:p2aa--allocate-other}
\EndFunction

\Statex

\State $\rhd$ Free allocated memory
\Function{deallocate}{$ptr, size$} \textbf{of} P2AA
  \State \textbf{switch} $(size)$
  \State \ \ \textbf{case} $16$: $aa16.deallocate(ptr)$ \label{alg:p2aa--deallocate-pow2-begin}
  \State \ \ \textbf{case} $32$: $aa32.deallocate(ptr)$
  \State \ \ $\cdots$
  \State \ \ \textbf{case} $8192$: $aa8192.deallocate(ptr)$ \label{alg:p2aa--deallocate-pow2-end}
  \State \ \ \textbf{default}: Free memory at $ptr$ \label{alg:p2aa--deallocate-other}
\EndFunction

\Statex

\State $\rhd$ Free all allocated memory
\Function{reset}{$ $} \textbf{of} P2AA
  \State $aa16.reset()$ \label{alg:p2aa--reset-begin}
  \State $aa32.reset()$
  \State $\cdots$
  \State $aa8192.reset()$ \label{alg:p2aa--reset-end}
\EndFunction

\Statex

\State $\rhd$ Get recommended allocation size, for a desired size
\Function{allocationSize}{$size$} \textbf{of} P2AA
  \If{$size \leq 16$} \ReturnInline{$16$} \label{alg:p2aa--allocationsize-16}
  \ElsIf{$size < 8192$} \ReturnInline{$nextPow2(size)$} \label{alg:p2aa--allocationsize-8192}
  \Else\ \ReturnInline{$\lceil size / \textsc{page\_size} \rceil * \textsc{page\_size}$} \label{alg:p2aa--allocationsize-other}
  \EndIf
\EndFunction
\end{algorithmic}
\end{algorithm}
