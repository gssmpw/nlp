\renewcommand{\thetable}{A\arabic{table}}
\setcounter{table}{0}

\section*{Appendix A: Complete Device Profile}
\label{appendix: profile}
This appendix provides the complete device profile of an off-the-shelf device, Sensi Thermostat in Table \ref{tab: sensi thermostat profile detailed}. The partial profile of this device is shown in Figure \ref{fig: profile example} of Section \ref{sec:design}.
    \begin{table*}[t!]
	\centering
        \caption{Complete Device Profile of Sensi Thermostat.}
        \footnotesize
\begin{tabularx}{\textwidth}{p{3cm} p{4cm} p{4cm} p{2cm} p{2cm}} 
  \toprule
    \textbf{DEVICE MAC} & \textbf{PACKET DIRECTION} & \textbf{EXTERNAL ADDRESS} &  \textbf{PACKET LENGTH} & \textbf{Device Name}\\ \hline
34:6f:92:1d:ba:50 &	USER\_TO\_DEVICE   &   	192.168.4.1	&			62 &	Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &   	224.0.0.251	&			46 &	Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &   	icda.sensicomfort.com &	58 &	Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	USER\_TO\_DEVICE   &   	192.168.4.1			  &	86 &	Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &   	icda.sensicomfort.com &	58 &	Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &   	icda.sensicomfort.com &	54 &	Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &   	icda.sensicomfort.com &	104 &	Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &   	icda.sensicomfort.com &	54 &   	Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &   	icda.sensicomfort.com &	144 &   Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &   	icda.sensicomfort.com &	255 &   Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	129	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	129	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	139	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	139	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	539	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	155	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	427	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	619	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	299	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	491	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	299	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	267	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	443	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	219	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	107	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	107	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	635	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	619	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	283	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	459	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	155	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	1450 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	172	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	864	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	512	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	917	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	61	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	192.168.47.2		  &	54	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	330	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	61	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	475	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	411	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	171	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	571	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	118  & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	224	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	384	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	192	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	315	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	SERVER\_TO\_DEVICE &	icda.sensicomfort.com &	789	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	315	 & Sensi Thermostat \\ \hline
34:6f:92:1d:ba:50 &	DEVICE\_TO\_SERVER &	icda.sensicomfort.com &	347	 & Sensi Thermostat \\ 
\bottomrule
\end{tabularx}
\vspace{-1em}
    \label{tab: sensi thermostat profile detailed}
\end{table*}

\renewcommand{\thefigure}{B\arabic{figure}}
\setcounter{figure}{0}



\section*{Appendix B: Difference Between Malware Packets \& IoT Device Packets}
\label{appendix: packet  difference}
In this appendix we briefly describe the difference between malware packets and IoT device packets that we observed in the course of developing \system.

\parheading{External Addresses.}
Packets generated by malware binaries have completely different external addresses from external addresses of packets generated by the observed IoT devices. Most malware programs try to connect with their CCC using static IP addresses. \system is sometimes able to map these IP addresses to hostnames through reverse DNS lookup. Interestingly, we observe that none of those hostnames indicates a service hosted in AWS cloud, whereas most hostnames found through reverse DNS lookup for IoT devices belong to AWS cloud. However, few malware programs use hostnames resolved through DNS lookup. Figure~\ref{fig: malware address} shows a partial list of external addresses found for malware packets.

\begin{figure}[!ht]
    \centering
    %\captionsetup{justification=centering}
    \includegraphics[width=0.6\linewidth]{figures/malware_servers.png}
    \caption{Some of the external addresses used by malware.} 
    \label{fig: malware address}
\end{figure}

\begin{figure}[!ht]
    \centering
    %\captionsetup{justification=centering}
    \includegraphics[width=\linewidth]{figures/malware_packet_lengths.png}
    \caption{Length Distribution of Malware Packets.} 
    \label{fig: malware packet length}
\end{figure}
\begin{figure}[!ht]
    \centering
    %\captionsetup{justification=centering}
    \includegraphics[width=\linewidth]{figures/device_packet_lengths.png}
    \caption{Length Distribution of IoT Device Packets.} 
    \label{fig: device packet length}
\end{figure}

\parheading{Packet Lengths.}
The length distribution of malware packets is also drastically different from the length distribution of IoT device packets. This is because observed malware packets are mostly TCP SYN, ACK, and RST packets. Figure \ref{fig: malware packet length} and Figure \ref{fig: device packet length} show the length distributions for malware packets and device packets respectively. 