\FloatBarrier
\newpage
\section{Pseudocode}

\begin{figure}[htb!]
    \noindent\fbox{\begin{minipage}{\textwidth}
        \textbf{\textit{\underline{Mixture Density Particle Filtering:}}}\\
        
        Given observations $y_{1:T}$ and actions $a_{1:T}$ with $N$ being the number of particles
        \begin{enumerate}%[itemsep=4mm]
            \item Initialize particle set $\{x^{(:)}_{1}, w^{(:)}_{1}, \beta\}$ using initial known state or via some other method. Normalize weights such that $\sum_{i=1}^{N} w^{(i)}_{1} = 1$
            \item For $t=2,...,T$ \textbf{and} $i=1,...,N$
            \begin{enumerate}%[itemsep=4mm]
                \item Resample particle from mixture distribution
                \[
                \widetilde{x}^{(i)}_{t} \sim m(x^{(:)}_{t-1}, w^{(:)}_{t-1}, \beta), \qquad \widetilde{w}^{(i)}_{t} = \frac{1}{N}
                \]
                \item Apply noisy system dynamics to particle: \\
                \[
                x^{(i)}_{t} = f(\widetilde{x}^{(i)}_{t}, a_t, \eta),\qquad \eta \sim N(0, 1)
                \]
                
                \item Compute particle weight (normalized such that $\sum_{i=1}^{N} w^{(i)}_{t} = 1$)\\
                \[
                w^{(i)}_{t} = \widetilde{w}^{(i)}_{t} \cdot l(x^{(i)}_{t}; y_t)
                \]
            \end{enumerate}
            \item \textbf{Output:} $\{x^{(:)}_{1:T}, \widetilde{w}^{(:)}_{1:T}, w^{(:)}_{1:T}, \beta\}$
        \end{enumerate}
    \end{minipage}}
    \label{alg:pf_algorithm}
    \caption{The Mixture Density Particle Filter}
\end{figure}




\begin{figure}[htb!]
    \noindent\fbox{\begin{minipage}{\textwidth}
        \textbf{\textit{\underline{Mixture Density Particle Smoothing:}}}\\
        
        Given observations $y_{1:T}$ and actions $a_{1:T}$ with $N$ being the number of particles
        \begin{enumerate}%[itemsep=4mm]
            \item Compute forward filter particle sets using Mixture Density Particle Filtering with $y_{1:T}$ and $a_{1:T}$: 
            \[\{\overrightarrow{x}^{(:)}_{1:T}, \overrightarrow{\widetilde{w}}^{(:)}_{1:T}, \overrightarrow{w}^{(:)}_{1:T}, \overrightarrow{\beta}\}\]

            \item Compute backward filter particle sets using Mixture Density Particle Filtering with $y_{T:1}$ and $a_{T:1}$ (with time reversed): 
            \[\{\overleftarrow{x}^{(:)}_{1:T},\overleftarrow{\widetilde{w}}^{(:)}_{1:T}, \overleftarrow{w}^{(:)}_{1:T}, \overleftarrow{\beta}\}\]
            
            \item For $t=1,...,T$ \textbf{and} $i=1,...,N$
            \begin{enumerate}%[itemsep=4mm]
                \item Define:
                \[
                q(x) = \frac{1}{2} m(x; \overrightarrow{x}^{(:)}_{1:T}, \overrightarrow{\widetilde{w}}^{(:)}_{1:T}, \overrightarrow{\beta}) + \frac{1}{2} m(x; \overleftarrow{x}^{(:)}_{1:T}, \overleftarrow{\widetilde{w}}^{(:)}_{1:T}, \overleftarrow{\beta})
                \]
                \item Sample particles:
                \[
                \overleftrightarrow{x}^{(i)}_{t} \sim q(x)
                \]

                \item Compute weights
                \[
                \overleftrightarrow{w}^{(i)}_{t} = \frac{l\Big(\overleftrightarrow{x}^{(i)}_{t}; y_t, m(\overleftrightarrow{x}^{(i)}_{t}; \overrightarrow{x}^{(:)}_{1:T}, \overrightarrow{\widetilde{w}}^{(:)}_{1:T}, \overrightarrow{\beta}), m(\overleftrightarrow{x}^{(i)}_{t}; \overleftarrow{x}^{(:)}_{1:T}, \overleftarrow{\widetilde{w}}^{(:)}_{1:T}, \overleftarrow{\beta})\Big)}{q(\overleftrightarrow{x}^{(i)}_{t})}
                \]

                
            \end{enumerate}
            \item \textbf{Output:} $\{\overleftrightarrow{x}^{(:)}_{1:T}, \overleftrightarrow{w}^{(:)}_{1:T}, \overleftrightarrow{\beta}\}$
        \end{enumerate}
    \end{minipage}}
    \label{alg:ps_algorithm}
    \caption{The Mixture Density Particle Smoother}
\end{figure}



