\begin{algorithm}[t]
\caption{\iotrgen}\label{alg:iotrgen}
\begin{algorithmic}[1]
\REQUIRE
User \textsf{role}, query $Q$, large language model $\mathcal{M}$, and retrievers $\{\mathcal{R}_i\}_{i=1}^n$.

\ENSURE
Generated answer $A$.

\STATE
\textcolor{gray}{$\triangleright$ \textbf{Procedure of Selector:}}

\STATE
Set prompt $\mathsf{SPT} = (\mathsf{Task}, \mathsf{role}, Q, \{\mathcal{R}_i\}_{i=1}^n)$, where $\mathsf{role}$ includes user's background implicitly and $\mathcal{R}_i$ indicates its description here.
\STATE
Inputting $\mathsf{SPT}$ to $\mathcal{M}$ and get $\{S_i\}_{i=1}^n = \mathcal{M}(\mathsf{SPT})$, where $S_i\in \{\mathsf{True}, \mathsf{False}\}$.

\STATE 
\textcolor{gray}{$\triangleright$ \textbf{Procedure of Self-Querying Retrieval:}}
\FORALL{$i=1, \dots, n$}
\IF{$\mathcal{S}_i = \mathsf{True}$}
\STATE
Execute self-querying retriever $\mathcal{R}_i$ and get documents $D_i=\mathcal{R}_i(Q)$
\ELSE
\STATE
Set $D_i = \mathsf{NULL}$.
\ENDIF
\ENDFOR

\STATE
\textcolor{gray}{$\triangleright$ \textbf{Procedure of Guided Generation:}}

\STATE
Set prompt $\mathsf{UPT} = (\mathsf{Task}, \mathsf{role}, Q, \{\mathcal{D}_i\}_{i=1}^n)$

\RETURN
$A = \mathcal{M}(\mathsf{UPT})$.


\end{algorithmic}
\end{algorithm}