\section{Template for multi-task instruction fine-tuning}
\label{sec:templates}

Figure~\ref{fig:finetuning_template} shows the template used to process the inputs for {\oursys}. The template first informs about the domains involved in the dialog. Next, it provides task-specific instructions and provides the domain schemas. The dialog history is provided and the model is instructed to generate a system response based on the dialog history, search results, and the task instructions.


% \begin{figure*}
%     \centering
%     \includegraphics[width=0.97\linewidth]{assets/finetuning_template.pdf}
%     \caption{
% Multi-task instruction finetuning template}
%     \label{fig:finetuning_template}
% \end{figure*}

\begin{figure}[htbp]
    \centering
\begin{tcolorbox}[colframe=gray!20, colback=gray!10, coltitle=black, arc=5mm, boxrule=0.4mm, width=\columnwidth, left=3mm, right=3mm, top=3mm, bottom=3mm]
\setlength{\baselineskip}{1.5em}
You are an expert chat assistant for the domains: \textcolor{cyan!90}{[domains]}. \\
\textcolor{purple!90}{Instructions:} As an expert, you must generate the most appropriate response for the chat assistant. \\
The response can be an api call or a response to the user. \\
Based on the \textcolor{purple!90}{Last User Utterance}, you must find the relevant \textcolor{purple!90}{Intent} from the \textcolor{purple!90}{Schema} and your request should use the \textcolor{purple!90}{required slots} and \textcolor{purple!90}{optional slots} from that \textcolor{purple!90}{Intent}. \\
You will be provided with the Schema for domains: \textcolor{cyan!90}{[domains]}\\
\textcolor{cyan!90}{[schemas]}\\
You will be provided an incomplete dialog between a user and a chat assistant, and an optional search results.\\
\textcolor{purple!90}{Dialog History}: \textcolor{cyan!90}{[dialog history]}\\
Using the \textcolor{purple!90}{Dialog History}, \textcolor{purple!90}{Search Results}, and by following the \textcolor{purple!90}{Instructions} please generate the response for the chat assistant.
\end{tcolorbox}
    \caption{Multi-task instruction finetuning template. Items in blue are dynamic elements and those in purple are important aspects of the prompt.}
    \label{fig:finetuning_template}
\end{figure}