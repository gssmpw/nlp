\documentclass[a4paper,12pt]{article}

\usepackage[utf8]{inputenc}
\usepackage{fullpage}
\usepackage{graphicx}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{breakcites}
\usepackage[left]{lineno}
\usepackage{blindtext}
\usepackage{subfig}
\usepackage{hyperref}
\usepackage{lineno}
\usepackage{url}
\usepackage{multicol}

\theoremstyle{definition}
\newtheorem{definition}{Definition}%[section]

%there's no option "example" for theoremstyle, there's plain, definition and remark

\newtheorem{plain}{Plain}%[section]

\theoremstyle{remark}
\newtheorem{remark}{Remark}%[section]
\newtheorem{exam}{Example}

\usepackage{changes}
\colorlet{cMat}{Orchid}
\definechangesauthor[name={Mateusz}, color=cMat]{Mateusz}
\newcommand{\madd}[2][]{\added[id=Mateusz,comment=#1]{#2}}
\newcommand{\mdel}[2][]{\deleted[id=Mateusz,comment=#1]{#2}}
\newcommand{\mat}[1]{\todo[inline,color=cMat]{\color{black}#1}}

\colorlet{cal}{olive}%Dandelion}
\definechangesauthor[name={Alex}, color=cal]{Alex}
\newcommand{\aadd}[2][]{\added[id=Alex,comment=#1]{#2}}
\newcommand{\adel}[2][]{\deleted[id=Alex,comment=#1]{#2}}
\newcommand{\al}[1]{\todo[inline,color=cal]{\color{black}#1}}

\colorlet{cbar}{ForestGreen}
\definechangesauthor[name={Bartek}, color=cbar]{Bartek}
\newcommand{\badd}[2][]{\added[id=Bartek,comment=#1]{#2}}
\newcommand{\bdel}[2][]{\deleted[id=Bartek,comment=#1]{#2}}
\newcommand{\bart}[1]{\todo[inline,color=cbar]{\color{black}#1}}

\colorlet{cmwa}{Maroon}%BurntOrange}
\definechangesauthor[name={Mwawi}, color=cmwa]{Mwawi}
\newcommand{\mwadd}[2][]{\added[id=Mwawi,comment=#1]{#2}}
\newcommand{\mwdel}[2][]{\deleted[id=Mwawi,comment=#1]{#2}}
\newcommand{\mwa}[1]{\todo[inline,color=cmwa]{\color{black}#1}}

\colorlet{cgok}{RoyalBlue}
\definechangesauthor[name={Gokhan}, color=cgok]{Gokhan}
\newcommand{\gadd}[2][]{\added[id=Gokhan,comment=#1]{#2}}
\newcommand{\gdel}[2][]{\deleted[id=Gokhan,comment=#1]{#2}}
\newcommand{\gok}[1]{\todo[inline,color=cgok]{\color{black}#1}}

\colorlet{cag}{TealBlue}
\definechangesauthor[name={Ola}, color=cag]{Ola}
\newcommand{\agadd}[2][]{\added[id=Ola,comment=#1]{#2}}
\newcommand{\agdel}[2][]{\deleted[id=Ola,comment=#1]{#2}}
\newcommand{\ag}[1]{\todo[inline,color=cag]{\color{black}#1}}

\newcommand{\HH}{\mathcal{H}}
\newcommand{\bHH}{\overline{\mathcal{H}}}
\newcommand{\tHH}{\tilde{\mathcal{H}}}

\newcommand{\V}{\mathcal{V}}
\newcommand{\mG}{\mathcal{G}}
\newcommand{\mH}{\mathcal{H}}
\newcommand{\mU}{\mathcal{U}}
\newcommand{\bV}{\overline{\mathcal{V}}}
\newcommand{\tV}{\tilde{\mathcal{V}}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\bE}{\overline{\mathcal{E}}}
\newcommand{\tE}{\tilde{\mathcal{E}}}
\newcommand{\tphi}{\tilde{\phi}}

\newcommand{\EG}{E_{\mathcal{G}}}
\newcommand{\EH}{E_{\mathcal{H}}}
\newcommand{\EU}{E_{\mathcal{U}}}

\newcommand{\tin}{\mathrm{in}} %like text in
\newcommand{\out}{\mathrm{out}}
\newcommand{\mI}{\mathcal{I}}
\newcommand{\inci}{\mathcal{I}^{\tin}}
\newcommand{\inco}{\mathcal{I}^{\out}}
\newcommand{\adji}{\mathcal{A}^{\tin}}
\newcommand{\adjo}{\mathcal{A}^{\out}}

\newcommand{\vtx}{\text{v}}
\newcommand{\Ph}{\vtx_\text{P}}
\newcommand{\A}{\vtx_\text{A}}
\newcommand{\Sc}{\vtx_\text{S}}
\newcommand{\B}{\vtx_\text{B}}

\newcommand{\RR}{\mathbb{R}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}


\title{Ubergraphs as models of higher-order \\
interactions in ecosystems}
%\author{Mateusz Iskrzyński, Bartłomiej Morawski, G\"okhan M\"otlu, \\ Mwawi Nyirenda, Aleksandra Puchalska} %an alphabetic placeholder, the order will be input-based 


\begin{document}

\maketitle

A food web is the physical basis of an ecosystem and classically in the literature it is represented by a graph. Hypergraphs and multilayer networks were proposed lately to introduce non-trophic interactions and in a consequence build a more holistic ecosystem model. However, in this approach we lose information about the underlying processes, the roles of vertices involved as well as about quantities of a mass flow. We suggest instead to model an ecosystem and its dynamics through a different object called an ubergraph. Ubergraphs combine the strengths of previously proposed approaches of multilayer networks and hypergraphs and allow to map all ecological phenomena more precisely.

In this paper we analyze a new tool by generalising graph measures to ubergraphs. Consequently, we arrive at new conclusions since generalised measures take into account the differing orders of interactions. We also propose a duality between systems of ordinary differential equations describing ecological dynamics and a weighted ubergraph structure.
  

\tableofcontents

I added package changes. \newline
\bart{Do not put 'add' around equations and multiple paragraphs, because text renders multiple times. It's better to put just a single paragraph in brackets for one command}

\madd{This text is written by Mateusz.}\mdel{This text is crossed out by Mateusz.}\mat{This is Mateusz's comment.}

\aadd{This text is written by Aleksandra.}\adel{This text is crossed out by Aleksandra.}\al{This is Aleksandra's comment.}

\badd{This text is written by Bartek.}\bdel{This text is crossed out by Bartek.}\bart{This is Bartek's comment.}

\mwadd{This text is written by Mwawi.}\mwdel{This text is crossed out by Mwawi.}\mwa{This is Mwawi's comment.}

\gadd{This text is written by Gokhan.}\gdel{This text is crossed out by Gokhan.}\gok{This is Gokhan's comment.}

\agadd{This text is written by Ola.}\agdel{This text is crossed out by Ola.}\ag{This is Ola's comment.}

\section{Ecological motivation and our main points}


Ecosystems consist of species of organisms that exchange matter with each other and with the environment. The physical foundation of an ecosystem can be described through stocks of elements assembled into organisms and their non-living pools as well as flows between them. Their values constitute a food web, which \adel{mathematically} \aadd{classically} is \aadd{represented by} a weighted digraph \adel{. The groups of } \aadd{with } organisms \aadd{denoted by} \adel{are represented as} vertices (vertices) and flows \adel{as}\aadd{by} edges. 

A variety of ecological interactions governs the dynamics of these stocks and flows. Parasites, competitors, mutualists and scavengers~\cite{Moleon_scavenging} were shown to influence e.g. the predatory relationships between two other groups of organisms. 

Researchers embedded such interactions in the topology of ecological networks by creating a multilayer network~\cite{Pilosof_2015, Lurgi_2020, Hutchinson2019}\adel{. It}\aadd{which} maps trophic and non-trophic relationships to separate layers. It was known, however, that some interactions do not fit into this picture, as they connect more than two vertices. Such higher-order interactions were represented in hypergraphs~\cite{GOLUBSKI2016344, Mayfield2017}, that generalise the notion of an edge to a set of an arbitrarily many vertices \aadd{abandoning however the direction of edges. It seems natural to include the information about affecting and affected entities that brings us to the notion of a dihypergraph. In our considerations we go one step further} \adel{We suggest instead to} add\aadd{ing} these non-trophic interactions as \aadd{diuberedges}\adel{(hyper)edges}\aadd{, namely dihyperedges pointing} from the influencing vertices to the impacted food web flows. \aadd{In ecosystems considered in this paper} they contain \aadd{at least} one \adel{or more} vertex and \aadd{exactly} one edge. \mat{part to add: directions/signs and weights}

Such a framework becomes most natural when we attempt to \adel{map}\aadd{associate} the equations determining ecosystem dynamics \adel{to}\aadd{with} a graph-like structure of the underlying interactions. \madd{All ecological models use some underlying interaction structure. Therefore ubergraphs remain appropriate,} independently of whether one employs differential, or difference equations, an individual-based model, or even distinguish life stages in populations. For clarity, we describe the case of an ordinary differential equation.

The biomass changes are physically possible through the food web flows, which can be identified as terms on the right hand side of the equations. Each term appears twice - for one vertex (target) with a plus sign, and for another (source) with a minus sign. Their functional dependence on vertices other than the source and the target is mapped to the added edges connecting vertices and the physical flows.

Even if other variables and groups of organisms change the value of a physical flow, it has one source and one target at a given time. Combining the physical accuracy of food web flows and the functional impact of non-trophic interactions in an ubergraph we do not lose quantitative information and distinction between types of interactions while making space for higher-order interactions. %edit later, shorter sentences

\section{Main idea}

We propose weighted and directed ubergraphs as a framework to represent all ecological interactions by a graph-like structure. In a particular application, a modeller firstly maps a phenomenon to an ubergraph and, as the next step, chooses appropriate dynamical model that reflects existing ubergraph structure. We also show how an existing dynamical model can be translated to an ubergraph, so that one to one representation is built.

We discuss the ecological modelling procedure that starts by defining the phenomena and ecological interactions of interest. They are mapped to a network, and finally to equations. We also describe a reciprocal procedure, mapping equations to an ubergraph.

\section{Definitions}
Graphs are portraits of interactions within a set $V$ of vertices. Each interaction is represented by a subset of vertices, called an edge. In the simplest case it consists of just two vertices. Hypergraphs allow an edge to consist of an arbitrary number of vertices. This makes them able to represent higher-order, or non-pairwise interactions that are known to exist in nature. A vertex could also influence an interaction between other vertices. To be able to describe such cases without loss of information about roles of interaction's participants a yet more general structure has been proposed. Ubergraphs allow an edge to be a nested set, containing both vertices as well as other edges.

Every edge can carry additional information about the direction of influence by marking a vertex to be its source and another, its target. The strength of interaction is quantified as a real weight assigned by a map $\phi$.



In this section we present first a basic definition of multilayer weighted digraph in the form that clearly suggests its possible generalisations. Then we smoothly proceed to the notions of weighted diubergraph using a weighted dihypergraph as an intermediate step. According to our best knowledge, diubergraph was presented only in unweighed and undirected framework so we summarise natural properties of this newly defined object and set it in the context of the recent advances of network theory. Finally, we specify how to relate weighted diubergraphs with ecographs which is the main scope of this research. 

\subsection{Graph theory toolbox}\label{sec:graph_intro}
\al{I have made significant changes, the copy of previous text is in the backup. I have also created a new file called appendix with all backup files to make the article compile easier. }
\subsubsection{Weighted multilayer digraph}\label{sec:m_graph}
Let us change the classical definition of weighted multilayer  digraph $\mG = (V,V_L,E,\aadd{\Phi})$, \cite[Sec.~2.1]{KivArena2014}, into one that is slightly more complicated, but allows for easy generalisation. Let us denote by $\mathcal{P}^*(\cdot)$ a power set in which an empty set is excluded.
%\mat{I have a feeling that it risks confusing the reader at the very beginning - at worst losing his interest in reading further. If we would like to keep this insightful version of digraph definition, we could start from the gently built diubergraph definition and then show that digraphs are a special case, satisfying the equation (1). After we agree on the general order of presentation I will also try making it all easier for general readers.}
%\begin{definition}%[Weighted digraph]
%    \label{def:WeightedDigraph}
%     \aadd{\textbf{A weighted multilayer digraph} is an ordered tuple $\mG= (V,L,V_L,\EG,\phi)$ where}
 %   \begin{enumerate}
 %       \item \aadd{$V = \{v_i\; | \; i \in I\}$, $|I|=n$, is a set of vertices;}
 %       \item \aadd{$L=\{L_j\; | \; j \in J\}$, $|J|=d$, is a set of layers;}
 %       \item \aadd{$V_L \subset L\times V$ is a set of layer-vertex pairs; }
 %       \item \aadd{$E = \{e_k\; | \; k \in K\}\subseteq \mathcal{P}^*(V_L) \times \mathcal{P}^*(V_L)$, $|K|=m$,   such that}
 %   \begin{equation}\label{eq:edge}
 %       \aadd{\forall_{(E_{in},E_{out})\in E}\,\,|E_{in}|=|E_{out}|=1,}
 %       \end{equation}
 %       \aadd{is a set of edges;}
 %       \item \aadd{function $\phi: E \xrightarrow{} \mathbb{R}$ assigns a weight to each edge.}
 %$   \end{enumerate} 
%\end{definition}

\begin{definition}%[Weighted digraph]
    \label{def:WeightedDigraph}
     \textbf{A weighted digraph} is an ordered tuple $\mG= (V,E, \aadd{\Phi})$ where
    \begin{enumerate}
        \item $V = \{v_i\; | \; i \in I\}$, $|I|=n$, is a set of vertices;
        \item $E = \{(e_k^{\tin},e_k^{\out})\; | \; k \in K\}\subseteq \mathcal{P}^*(V) \times \mathcal{P}^*(V)$, $|K|=m$,   such that for any $e=(e^{\tin},e^{\out})\in E$
    \begin{equation}\label{eq:edge}
        |e^{\tin}|=|e^{\out}|=1,
        \end{equation}
        is a set of edges;
        \item $\Phi=\text{diag}(\phi(e):\,e\in E)$ is a weight matrix, while $\phi: E \xrightarrow{} \mathbb{R}$ is a weight function.
    \end{enumerate} 
    \aadd{We say that a weighted digraph $\mathcal{G}$ is \textbf{multilayer} if there exists a partition of V into a family of nonempty subsets $L=\{L_j\subset V\; | \; j \in J\}$. We write $\mG_L= (V,L, E,\adel{\phi}\aadd{\Phi})$ and we call $J$ a set of layers of cardinality $d=|J|$, $d_j=|L_j|$ a number of layers and number of vertices in layer $L_j$, $j\in J$. }
\end{definition}

\madd{Note that in this approach no vertex can belong to more than one layer. Layers are essentially labels offering additional information about vertices $V$.}. According to standard nomenclature it is a special type of multilayer digraph called \textbf{layer-disjoint}. It is also equivalent to explicitly treating the instances of a vertex in different layers as different vertices in any multilayer digraph. If the graph in question consists of just one layer, we call it a weighted digraph and denote by $\mG= (V,\EG,\aadd{\Phi})$.

An edge $(e^{\tin},e^{\out})\in E$ represents a connection from its tail $e^{\tin}$ to its head $e^{\out}$. Following standard definitions edges that stay within a single layer are called \textbf{intra-layer}, while those which cross layers are called \textbf{inter-layer} edges. \textcolor{red}{Consequently we define an intra-layer graph, an inter-layer graph and a coupling graph. }
\al{To be elaborated if needed}

\mdel{We summarise a few standard matrices that characterise digraphs.} \madd{The interactions in a (multilayer) digraph can be encoded in its incoming and outgoing (supra-)adjacency matrices,}
\begin{multicols}{2}
    \begin{equation}
        \adji_{i\, j}=\phi((v_i,v_j)),
    \end{equation}
\break
    \begin{equation}
        \adjo_{i\, j}=\phi((v_j,v_i)).
    \end{equation}
\end{multicols}

\mdel{In this approach we treat the multilayer digraph $(V,L,E,\aadd{\Phi})$ as a digraph $(V \mdel{\times L}, E,\aadd{\Phi})$.} \mdel{Denote by $D_i$ the number of vertices in layers having index lower then $i$, namely}
%\begin{equation*}
%\aadd{D_i=\sum_{j<i}d_j.}
%\end{equation*}
\mdel{$n\times n$ matrix $\mathbb{A}=(\mathbb{A}^{ij})_{i,j\in J}$ is supra-adjacency matrix if it is a block matrix where, for any fixed $i,j\in J$, $\mathbb{A}^{ij}$ is $d_i\times d_j$ matrix such that for any $p=1,\ldots,d_i$, $q=1,\ldots,d_j$}
\mat{This condition is not a necessary one, e.g. transport networks with transition between stops in various layers, plus self-loops.}
$$
\mdel{\mathbb{A}^{ij}_{pq}=\phi\left((v_{D_i+p}^i,v_{D_j+q}^j)\right).}
$$

A supra-adjacency matrix describes a multilayer digraph as if it were \mdel{is} \mat{subjunctive grammar construct for hypothetical stuff} an ordinary digraph, storing the layer information in vertex order. \mdel{It agrees with standard definition of adjacency matrix, namely for $p,q\in I$}
%    \begin{equation}\label{eq:adjacency}
%        \mathbb{A}_{pq}=\sum_{\left\{e:\,\, v_p \in e^{\mathrm{in}}, \, v_q \in e^{\mathrm{out}}\right\}} \phi(e),
    %\end{equation}
Therefore, we \madd{usually} \mdel{most} \adel{rest} of the article we drop the layer indices \aadd{as it does not cause an ambiguity.} 
\mdel{We also write $\mathbb{A}^{\mathcal{G}}$ and $\mathbb{A}^{\mathcal{G}_{L}}$ to indicate the type of network to which adjecency matrix is considered, weighted digraph and the multilayer one respectively.} \mat{Let us wait if it will be really necessary anywhere.}

\mdel{Now let us move to in- and out-} Incidence matrices $\inci, \inco: V \times E \rightarrow \left\{0,1\right\}$ offer an alternative definition of digraph interactions. They state which vertex is a tail/a head of which edge.
\begin{multicols}{2}
\begin{equation}\label{eq:I_in}
    \inci_{ij}=\begin{cases}
        1, \quad \text{if} \quad v_{i} \in e_{j}^{\mathrm{in}}\\
        0, \quad \text{otherwise}.
    \end{cases}
\end{equation}
\break
\begin{equation}\label{eq:I_out}
    \inco_{ij}=\begin{cases}
        1, \quad \text{if} \quad v_{\adel{j}\aadd{i}} \in e_{\adel{i}\aadd{j}}^{\mathrm{out}} \\
        0, \quad \text{otherwise}.
    \end{cases}
\end{equation}
\end{multicols}

\madd{The adjacency and incidence matrices are connected by the relation}
\begin{equation}
\adjo=\inco \Phi (\inci)^T.
\end{equation}


\subsubsection{Weighted multilayer dihypergraph}\label{sec:H_graph}
One can also allow each edge to have more than one head and one tail. A \textbf{weighted multilayer dihypergraph} $\mH = (V,L,\EH,\adel{\phi}\aadd{\Phi})$ satisfies all conditions of Definition \ref{def:WeightedDigraph} except \eqref{eq:edge}. In order to distinguish elements from a set $\EG$ from those in $\EH$ we call the latter hyperedges. This notion has been already used in ecological context in the undirected version, see \cite{Bretto2013}.

Let us summarise standard objects defined for dihypergraphs that will be generalised in the next subsection. Unlike in a digraph, there may be several different hyperedges all containing the same vertex $v_i$ as a head and the same $v_j$ as a tail. Thus, there is no one-to-one correspondence between a dihypergraph and its adjacency matrix $\mathbb{A}^{\HH}=(\mathbb{A}_{ij}^{\HH})_{i,j\in I}$~\cite{BATTISTON20201}, defined as the extension of definition in \eqref{eq:adjacency} into a hypergraph. 
\aadd{In the theory of hypergraphs there are some generalisations know as adjacency tensor \cite{Michoel2012}, degree normalized k-adjacency tensor \cite{COOPER2012}, eigenvalues normalized k-adjacency tensor \cite{Hu2013} etc. To avoid this ambiguity it the paper we use the notation related to \emph{in- and out-incidence matrices}     
 $(\mathcal{I}^{\tin})^{\HH}, (\mathcal{I}^{\out})^{\HH}$, defined as the extension of definitions in \eqref{eq:I_in}-\eqref{eq:I_out} into a hypergraph, that uniquely determines the it.}

\subsubsection{Weighted diubergraph}\label{sec:U_graph}

The final step of digraph generalisation allows an edge to join any number of objects that \adel{could}\aadd{can} be vertices as well as edges. \adel{This}\aadd{The new} recursive definition \aadd{of sets $e^{in}$, $e^{out}$ in Def. \ref{def:WeightedDigraph}} creates an ubergraph, introduced in its unweighted form in \cite{Joslyn2017UbergraphsAD}. We generalise it to a weighted diubergraph \aadd{and examine its basic properties}. This requires a modification to the definition of \adel{its}\aadd{the} incidence (Levi) graph \aadd{in order} to \adel{store}\aadd{capture the whole} information about the original ubergraph directions.

Given a set of vertices $V$, we introduce a series $(P_k(V))_{k\in \NN}$ recursively
%\begin{equation}\label{eq:P sets}
%       P_0(V) = V, \quad P_{k}(V) =\mathcal{P}^* \left( \bigcup_{i=0}^{k-1} P_i(V) \right), \quad k\geq 1.
%\end{equation}
\begin{equation}
       P_0(V) = V, \quad P_{k}(V) =\mathcal{P}^* \left( \bigcup_{i=0}^{k-1} P_i(V)\right) \times \mathcal{P}^* \left(\bigcup_{i=0}^{k-1} P_i(V)\right) , \quad k\geq 1.
\end{equation}

$P_k(V)$ is a set of all ordered pairs of elements belonging to $\mathcal{P}^* \left( \bigcup_{i=0}^{k-1} P_i(V)\right)$. $P_k(V)$ contains thus ordered pairs of any subset of elements already present in the former series elements.
\mat{Or for us: "a cartesian product of sets is a set of cartesian products"}

\begin{definition} 
\label{def:weighted_diubergraph}
\textbf{A weighted $k$-depth diubergraph} is an ordered triple $\mU= (V,\EU,\aadd{\Phi})$ where
    \begin{enumerate}
        \item $V = \{v_i\; | \; i \in I\}$, $|I|=n$, is a set of \textbf{fundamental vertices};
        \item $E_{\mU} = \{e_j =(e_{j}^{\tin},e_{j}^{\out}) \; | \; j \in K\}\subseteq P_{k}(V)$, is a set of \textbf{diuberedges} such that heads and tails of all diuberedges contain \mdel{either} fundamental vertices or other diuberedges, namely
        \begin{equation}\label{eq:uEdge}
         \forall_{(e^{\tin},\, e^{\out}) \in \EU} \quad e^{\tin},\, e^{\out}  \subset V \cup \EU.  
        \end{equation}
        %\begin{equation}\label{eq:uEdge}
        %\aadd{\forall_{(e^{\mathrm{out}},e^{\mathrm{in}})\in \EU}\,\forall_{x\in\{\mathrm{out,in}\}}\forall_{u\in e^{\mathrm{x}}\setminus V}\,\,u\in E. }
        %\end{equation}
        
        %\begin{equation}
        % \gadd{ \forall (e^{\mathrm{out}},e^{\mathrm{in}}) \in \EU, e^{\mathrm{out}},e^{\mathrm{in}}  \in V \cup \EU.}   
        %\end{equation}
        
        \item   $\Phi=\text{diag}(\phi(e):\,e\in E)$ is a weight matrix, while $\phi: E \xrightarrow{} \mathbb{R}$ is a weight function
        
    \end{enumerate} 
    \adel{If a diuberedge $e$ belongs to $P_{k}(V)$, its depth $L(e)=k$.}
\end{definition} 


%\gok{I am confused about above definition, in particular \ref{eq:uEdge} and \ref{eq:U_ver}. Therefore, I suggest to consider an example. Let $V=\{ 1,2,3,4\}$ be set of fundamental vertices and $E_{\mU}=\{ e_1 = (\{1\},\{2\}), e_2 = (\{3\},\{4\} ), e_3 =(\{1\}, e_2 ), e_4 =( e_1 , e_2 ), e_5 = (\{1\},\{3,4\}) \} $ be the set of diuberedges. Firstly, notice that $e_3 =(\{1\}, (3,4) )$ is different from $e_5 =(\{1\},\{3,4\})$ since $e_3$ is depth-2 diuberedge whereas $e_5$ is a depth-1 diuberedge. Note also that the expression $E_{\mU} = \{e_j =(e_{j}^{out},e_{j}^{in}) \; | \; j \in K\}\subseteq P_{k}(V) \times P_{k}(V)$ is not true since $e_{3}^{in}=e_2 \notin P_{2}(V)$. Therefore, I suggest}
%\madd{We have changed the definition. Now $e_2 \in P_{1}(V)$, so $e_{3} \in P_2(V)$.}
%\gok{$E_{\mU} = \{e_j =(e_{j}^{out},e_{j}^{in}) \; | \; j \in K\}$, is a set of \textbf{diuberedges} such that heads "$e_{j}^{out} $" and tails "$e_{j}^{in} $" of all diuberedges are either a subset of fundamental vertices or another diuberedge, namely}
%\gok{\begin{equation}
         %\forall_{(e^{\mathrm{out}},\, e^{\mathrm{in}}) \in \EU} \quad e^{\mathrm{out}},\, e^{\mathrm{in}}  \subset V \ \text{or} \ e^{\mathrm{out}},\, e^{\mathrm{in}} \in \EU.  
        %\end{equation}}
%\gok{Moreover, I think the following definition of set of vertices is better:
%\begin{equation}
%    V_{\mU}:=V\cup \{ e_j \in E_{\mU} : \exists e=(e^{out},e^{in}) \in E_{\mU} ; \ e \neq e_j , \ e_j =e^{out} \text{or} \ e_j =e^{in} \}  
%\end{equation}}

Condition \eqref{eq:uEdge} ensures that heads and tails of any element from $E_{\mU}$ are included either in the set of uberedges $E_{\mU}$ or in the set of fundamental vertices $V$. \aadd{Let us consider the example which visualises the construction of uberedges.}

\aadd{\begin{exam}
Consider $\mU=(V,\EU,\Phi)$ such that $V=\{ 1,2,3,4\}$ is a set of fundamental vertices, 
\begin{eqnarray*}
E_{\mU}=\left\{ e_1 = (\{1\},\{2\}), e_2 = (\{3\},\{4\} ), e_3 =(\{1\}, \{e_2\} ), e_4 =( \{e_1\} , \{e_2\} ),\right. \\
\left.e_5 = (\{ 1\},\{4,e_2\}),e_6=(\{1\}, (\{2\},\{3\})\right\}
\end{eqnarray*} 
is a set of diuberedges and the weight matrix equals $\Phi=\mathcal{I}$.
Notice that in this case we have
$$
e_1, e_2 \in P_1(V),\qquad e_3, e_4, e_5, e_6\in P_2(V). 
$$
Furthermore $\{1\},\{2\},\{3\},\{4\}, e_1 , e_2, \{4,e_2\} \in V \cup \EU $, but $ (\{2\},\{3\})\notin V \cup \EU $ hence $\mU$ is not well-defined. Considering $\mU'=(V,\EU \setminus \{e_6\},\Phi)$, $\mathcal{U}'$ is $2$-depth diubergraph. Both $\mathcal{U}$ and $\mathcal{U}'$ are presented in the Figure xx. 
\end{exam}}
\al{Figure xx to be added.}
Uberedges that become heads or tails of others begin to play a role akin to vertices, influencing others or being influenced. \madd{At the same time, those that are not part of another, are just carriers of such influences. This leads us to define the set of vertices excluding such carriers} \aadd{from a set of $V\cup E$},

\begin{eqnarray}\label{eq:U_ver}
\aadd{V_{\mU}:=V\cup E_{\mU}\setminus \left\{v\in P_1(V):\quad \forall_{e\in E_{\mU}}\,\,v\notin e^{\mathrm{out}}\cup e^{\mathrm{in}}\right\}}.
\end{eqnarray}
\aadd{The elements of a set $V_{\mU}$ we call vertices. }

\aadd{Based on Definition \ref{def:weighted_diubergraph} we easily note that weighted $1$-depth diubergraph is the weighted dihypergraph. All hyperedges can only contain vertices hence condition \ref{eq:uEdge} is always satisfied. Furthermore, in this case sets of vertices and fundamental vertices coincide and are equal to the standard notion of vertex in a hypergraph $V_\mU=V$. }
%For $k>0$ more variable uberedges may appear.
%\begin{plain}
%Consider 1-depth diubergraph $\mU= %(V,\EU,\phi)$ such that
%\begin{equation}
%V=\{v_1,v_2,v_3\}; \qquad \EU=P_2(V)\times P_2(V); \qquad \forall_{e\in E}\,\,\phi(e)=1.
%\end{equation}
%\end{plain}
On the other hand a digraph is a $1$-depth diubergraph. Elements of $P_k(X)$ are called \textbf{$k$-depth uberedges}\footnote{We correct the definition of \cite{Joslyn2017UbergraphsAD} where $P_0$ was inconsistent with the recursive formula.} and in particular $0$-depth uberedges we call simply edges.

We note that each uberedge can be explicitly written as a nested ordered set of fundamental vertices from $V$. We call it a \emph{fundamental form of an uberedge}, and denote as $e(V)$. For example, let $V=\{v_1, v_2,v_3\}$, $e_1=(v_1,v_2)$ and $e_2=(v_3,e_1)$.  Then,
\begin{equation}\label{Fuedge}
    e_2(V)=(v_3, (v_1, v_2)).
\end{equation}





\subsubsection{Incidence digraph representation of a weighted diubergraph}\label{sec:inc_U_graph}

The considerations above show that ubergraph's concept is a natural generalisation of digraph. It is also the structure we immediately imagine when we think of vertices impacting processes (edges) rather than vertices themselves. Now we show that the above idea can also be represented through its incidence (Levi \footnote{vertices from V plus U}) digraph. In order to visualise the transformation of ubergraph into its incidence digraph let us imagine that we add a vertex in the middle of every uberedge, to represent it. The set of fundamental vertices $V$ and the set of uberedges $\EU$ become the new vertex set $V \cup \EU$. The relation of being a head or tail of an uberedge translates into a digraph edge to or from the vertex in question. An example of a diubergraph and with its incidence graph is shown in Fig.~\ref{fig:PASB_ubergraph_incidence_graph}.

\begin{figure}[h!]
	\begin{center}
        \subfloat{\includegraphics[width=0.4\linewidth]{./fig/Azteca_example/4_node_Azteca_v_labels.png}
		}
        \subfloat{\includegraphics[width=0.5\linewidth]{./fig/Azteca_example/incidence_4_node_Azteca.png}}
        \caption{A 4-node subgraph of the coffee agroecosystem model of \cite{GOLUBSKI2016344} (left) and its incidence digraph representation (right). Nodes $\Ph$, $\A$, $\Sc$, $\B$ represent Phorid, Azteca, Scale and Beetle of the original article. Colours map the incidence graph layers, identical to the depth of respective uberedges, and match those used in the original paper. Fundamental vertices (zero-depth) are green, one-depth edges are black, two-depth two are blue and the three-depth edge is red.} 
    	\label{fig:PASB_ubergraph_incidence_graph}
    \end{center}
    \end{figure}




\mdel{The adjacency matrix of such incidence graph indicates whether a corresponding diubergraph vertex $v\in (V \cup \EU)$ is a tail or a head of another vertex $w$ (or vice versa),}


\madd{The weights associated in Def.~\ref{def:weighted_diubergraph} with diuberedges become the property of the incidence graph vertices. To encode transitions in a diubergraph as matrix operations, we introduce a \emph{weight matrix} $\Phi: (V \cup \EU) \times (V \cup \EU) \rightarrow \mathbb{R}$,}
\begin{equation}\label{eq:weight_matrix}
    \Phi(e_i, e_j)=\begin{cases}
    \phi(e_i), \quad \text{if} i=j  \quad\text{and} \quad e_i \in \EU \\
    1, \quad \text{if} i=j \quad \text{and} \quad e_i \in V.
    \end{cases}
\end{equation}


\madd{Then, the product $\Phi\mathcal{I}$ defines the adjacency matrix of a diubergraph. It can also be explicitly defined as $ \lvert V_{\mU} \rvert \times \lvert  V_{\mU} \rvert$ matrix such that }
\begin{equation}\label{def:ubergraph_adjacency_matrix}
        A_{ij}^{\mathrm{U}}=\sum_{\left\{e=(e^{\mathrm{out}}, e^{\mathrm{in}} ) \in \EU :\\ v_i \in e^{\mathrm{out}}, v_j \in e^{\mathrm{in}}\right\}} \phi(e) + 1\left[v_j \in v^{\mathrm{out}} \right].
\end{equation}
    
The presence of ones in the adjacency matrix enables us to represent walks through a higher order edge and and an edge containing the final vertex as products of the adjacency matrix. Tables~\ref{tab:incidence_matrix_PASB}~and~\ref{tab:adjacency_matrix_PASB} contain incidence and adjacency matrices of the diubergraph shown in Fig.~\ref{fig:PASB_ubergraph_incidence_graph}.

\input{./numerical_results/tex_tables/incidence_formatted.tex}
\input{./numerical_results/tex_tables/adjacency_formatted.tex}

%The depth $L$ of a vertex allows to reconstruct the original diubergraph from $I$.
%\begin{equation}\label{eq:ubergraph_incidence}
%    \text{If} \quad I_{vw}^{\mathrm{U}} \neq 0 \text{, then}\begin{cases}
%        \phi(v)=I_{vw}, \quad \text{iff} \quad L(v)>L(w) \\
%        \phi(w)=I_{vw}, \quad \text{iff} \quad L(v)<L(w).
%    \end{cases}
%\end{equation}




\begin{definition}\label{uber_levi_graph}
    A digraph incidence representation (or a Levy digraph) of an $k$-depth ubergraph $\mathcal{U}=(V, \EU, \adel{\phi}\aadd{\Phi})$ is a multilayer digraph $\mathcal{G}_{\mathcal{U}}=(V \cup \EU, V_L, E',\adel{\phi'}\aadd{\Phi'})$, $|V_L|=k+1$, where for any $v, w \in V \cup \EU$:
    \begin{enumerate}
        \item $(v,w) \in E' \iff (v \in w^{\mathrm{out}} \quad or \quad w \in v^{\mathrm{in}})$,
        \item $v \in L_j \iff v \in P_{j+1}(V)$, for $j=1,\ldots,k$, $P_{j+1}(V)$ defined in \eqref{eq:P sets} and $L_j$ from Def.\ref{def:WeightedDigraph}.2.
        \al{Correct def. of layer}
        \item $\phi'(v,w)=\left\{\begin{array}{ll}
             \phi(w)&\text{for }v\in w^{\mathrm{out}},  \\
             \phi(v)&\text{for }w \in v^{\mathrm{in}}. 
        \end{array}\right.$
    \end{enumerate} 
 
\end{definition}

Fig.\ref{fig:PASB_ubergraph_incidence_graph} shows an example of an ubergraph and its digraph incidence representation.




 \madd{The incidence graph is $k$-partite. It does not contain intra-layer edges.}
 
 Deeper layers contain higher order interactions which are expected to be weaker than  a direct one. \aadd{Furthermore, the direction of a path represents the direction of the interaction.} \mdel{order which should not be neglected in the research.} \aadd{Further sections describe various graph measures expressed for ubergraphs as well as their incidence digraph representations to learn which is simple in particular application.} 

\subsection{Classes of hyper- and uberedges}\label{sec:classes_of_hyper_uber}
Hyperedges of differing cardinality can be expected to be of different physical and causal nature. The same applies to uberedges which in addition differ by the way they are composed of fundamental vertices. This leads us to define classes of hyper-/uberedges $\mathcal{\tE}_e$ as the sets of existing edges that could be obtained from a given edge $e$ by renaming the fundamental vertices. 

\begin{definition}\label{def:classes_of_hyper_uber}
Edges $e$ and $e'$ belong to the same class $\mathcal{E}_e$ $\iff \exists$ a \madd{map} $\Pi: V\rightarrow V$, such that $e(V)=e'(\Pi(V))$.
\end{definition}
In a way, an uberedge defines its class through the way the brackets are placed in its fundamental form. Def.\ref{def:classes_of_hyper_uber} partitions the set of uberedges into equivalence classes.
\begin{plain}
	Let us consider an ubergraph $U=(\{u,v,w\},\{e_1=(u,(v,w)), e_2=((u,v),w),$ $e_3=(w,(u,v)),e_4=(u,(v,v))\})$. The edge set consists of two classes:
	$\mathcal{E}_1=\{e_1,e_3,e_4\}$ and $\mathcal{E}_2=\{e_2\}$.
\end{plain}


\subsection{Ecograph - flows of matter and their functional dependence}
\begin{definition}%[Food web]
\label{def: FoodWeb}
\textbf{A food web} is a connected weighted digraph $\mathcal{G} = (V,E,\adel{\phi}\aadd{\Phi}, x)$ with flows $\phi: E \rightarrow \mathbb{R}_+ $ and biomasses $x: V \rightarrow \mathbb{R}_+ $. Vertices $V$ are subdivided into living, and non-living (detrital). 
\begin{equation*}
    V=\{v_i: i\in I_L\} \cup \{v_i: i\in I_{nL}\}, 
\end{equation*}
where $I_L=\left\{1,\ldots,l\right\}$, $I_{nL}=\left\{l+1,\ldots,n \right\}$ and $I=I_L\cup I_{nL}$.
\end{definition}

\madd{We propose an explicit structure to represent ecosystem interactions, which we call an ecograph. Ubergraphs can model all the examples from ecological literature without loss of information. However, a less general object suffices to represent them.  
All the reported ecological examples contain food web flows (or abundance changes) and interactions in which one vertex influences other interactions.}
\begin{definition}[Alternative Definition]
An ecograph is an ordered triple $\mathcal{G} = (V,U, \adel{\phi}\aadd{\Phi})$ where $V=\{v_i : i \in I \}$ is the set of fundamental vertices, $U=\{ u_j : j \in J\}$ is the set of uberedges such that an uberedge $u_j$ can consist of either any number of fundamental vertices (i.e. $ u_j = \{v_i, \ldots, v_j \}$) or some fundamental vertices and only one uberedge (i.e. $ u_j = \{v_i, \ldots, v_j, u_k \}$). The weights of the uberedges are assigned via the function $\phi$. 
\end{definition}

\badd{A vertex in a food web represents a single species participating in trophic relationships or a resource supplying energy or matter to the ecosystem. However, representing higher-order interactions might necessitate the inclusion of other vertices which do not serve either of these roles, although they do influence them. Such vertices could represent both biotic and abiotic external factors, e.g. luminosity, temperature or pesticide presence~\cite{Cervantes_2021, Polatto2014}. }
%TO DO: example of influence of another species as an external factor
%Could we not also have several fundamental vertices influencing an uberedge?

\badd{Since the interacitons involving these vertices are of different kind, they could be represented in a separate way. An approach similar to multilayer networks could be considered, as one of their common purposes is representation of multiple interaction types, including non-trophic ones~\cite{Kefi2016}. A simpler approach would be to incorporate the external factors as vertices on a par with those involved in trophic relationships. Any of these special vertices could be involved in multiple uberedges, although each of them would consist only of said vertex and a single edge representing the influenced interaction. This means the depth of any uberedge involving this vertex would be equal to at least $2$. 
}

\section{Network measures generalised for hypergraphs and ubergraphs [HERE TO DO]}

In this section we review how commonly used graph measures might be generalised for use with hypergraphs and ubergraphs. 

Graph measures can be ordered in groups applying different concepts or using differing tools to capture a structural property. We highlight the core aspect of each group and how it influences the generalisation.

\subsection{Notation}
We use upper-case letters for matrices and lower-case for vectors. Replacing an index with a bullet denotes summation over the whole range of an index of a vector $v$, or a matrix $M$: $v_{\bullet}=\sum^n_{i=1}v_{i}$, $M_{i\bullet}=\sum^n_{j=1}M_{ij}$, $M_{\bullet j}=\sum^n_{i=1}M_{ij}$, $M_{\bullet \bullet}=\sum^n_{i=1}\sum^n_{j=1}M_{ij}$.

\madd{When referring to a matrix of weights $\phi$ we use the capital letter $\Phi$.}

\mat{Or is it standard to use weight function - weight matrix interchangeably with the same symbol?
In fact we could also avoid the explicit index notation or redefine it - defining the partial sums over classes made me aware sth else might be more consistent. We work with sums over set elements.}

\subsection{Domains of vertex-level measures}
\madd{
In digraphs and hypergraphs, graph measures are functions defined over the vertex set $V$. In diubergraphs this could naturally be $V$ or $V_U$, depending on the measure's purpose. Quantifiers of indirect influences and recursive measures, suggest independent versions that use either of those sets. Each captures a different aspect of the system in question. 
}

Many of the measures are computed for every vertex or edge and then aggregated to present one number characterising a property of the whole graph:
\begin{align}
    \mu^{\mathrm{G}}&=\xi_V(\{\mu(v): v \in V \}), \\
    \sigma^{\mathrm{G}}&=\xi_E(\{\sigma(e): e \in E \}).
\end{align}
Common aggregating functions $\xi$ are the sum, average, median, minimum.

In hypergraphs and ubergraphs one may also take into account the subdivisions of edges into classes (see Sec.\ref{sec:classes_of_hyper_uber}),
\begin{equation}
    \sigma^{\mathrm{H}}=\xi_E(\{\xi_{\mathcal{E}}(\{\sigma(e): e \in \mathcal{E} \}): \mathcal{E}\subset E \}).
\end{equation}

\subsection{Adjacency-incidence duality}
\madd{Diubergraphs, as well as hypergraphs, can be represented to show adjacency~\ref{def:weighted_diubergraph} or incidence~\ref{uber_levi_graph} relations. This leads to dual definitions of graph measures that either aim to capture adjacency relations between vertices or their incidence in interactions. At the core of this distinction is the question - are we counting an edge once if it means adjacency with multiple neighbours or as many times as there are neighbours?}


\subsection{Degree Centrality}

Degree centrality measure is based on the notion of adjacency/incidence of vertices. As stated in Subsection \ref{sec:graph_intro} this notions can be used interchangeably in the case of graphs and consequently the degree of a vertex $v$ can be defined by either using its incidence matrix or adjacency matrix. Namely, it is defined as the sum of entries of the corresponding row of incidence or adjacency matrix (i.e. the number of edges that are incident to $v$ or equivalently the number of vertices that are adjacent to $v$).

However, as for hypergraphs/ubergraphs, these two numbers can differ significantly as one hyperedge/uberedge can contain arbitrary number of adjacent vertices and two adjacent vertices can be contained in more than one hyperedge/uberedge. Therefore, the degree of a vertex in a hypergraph/ubergraph can be defined in two separate ways: incidence degree and adjacency degree. We shall define these degrees for ubergraphs since they generalise hypergraphs. 

Let us start with incidence degree of a vertex in an ubergraph which measures the number of interactions in which the vertex is involved in. Considerations in Section \ref{sec:U_graph} specify three candidates for which the new notion can be defined. Namely, fundamental vertices from $V$, vertices from $V_{\mU}$ and elements of $V\cup E_{\mU}$. It is natural to ask for which of the three candidates should we define the notion of incidence degree. The choice of vertices $V_{\mU}$ allows to capture the largest number of objects without loosing the coherence of mathematical definition. 
\begin{definition}[Incidence degree in a weighted diubergraph]\label{def:incidence-deg}
    Let $\mathcal{U}=(V,E_{\mathcal{U}},\adel{\phi}\aadd{\Phi})$ be a weighted diubergraph and let $V_{\mU}$ be a set of vertices defined in \eqref{eq:U_ver}. \textbf{Incidence in-degree (resp. out-degree)} $ \kappa_{I}^{in}(v)$ (resp. $ \kappa_{I}^{out}(v)$) of a vertex $v \in V_{\mU}$ is the sum of weights of the directed uberedges $e=(e^{\mathrm{in}}, e^{\mathrm{out}} )$ such that $v \in e^{out}$ (resp. $v \in e^{in}$). Namely,
    \begin{equation} \label{eq:incidence-deg}
    \kappa_{I}^{\mathrm{in}}(v):=\sum_{v \in e_{j}^{\mathrm{out}} }\phi(e_{j}), \quad \kappa_{I}^{\mathrm{out}}(v):=\sum_{v \in e_{j}^{\mathrm{in}}}\phi(e_{j}).
\end{equation}
\end{definition}

Note that the formula \eqref{eq:incidence-deg} can be applied to $v\in E_{\mU}\setminus V_{\mU}$. However, since $v$ is not a head or tail of any other uberedge, then $\kappa_{I}^{\mathrm{in}}(v)=\kappa_{I}^{\mathrm{out}}(v)=0$. Thus, it does not bear any valuable information. On the other hand, if we decide to define incidence degree for all $v\in V\cup E_{\mU}$, then for a digraph, hence depth-1 ubergraph, it simplifies to a set $V\cup E_{\mG}$ and this does not agree with a standard definition of degree. On the contrary, $V_{\mU}=V$ for a digraph and hence Definition \ref{def:incidence-deg} can be considered as generalisation of classical notion of vertex degree.
\al{To do: The comparison of ubergraph $\mU$ incidence degrees and Levi graph $\mG_{\mU}$ counterparts. 
\begin{eqnarray*}
(\mU\kappa)_i^{\mathrm{in/out}}(v)&=&(\mathcal{L}\kappa)_i^{\mathrm{in/out}}(v)\qquad \text{for }v\in V\\
(\mU\kappa)_i^{\mathrm{in/out}}(v)&=&(\mathcal{L}\kappa)_i^{\mathrm{in/out}}(v)\mp \sum_{v_j\in V:\, v_j\in v^{\mathrm{out/in}}}\phi(v)\qquad \text{for }v\in V_{\mU}\setminus V
\end{eqnarray*}}

\gadd{On the other hand, adjacency degree of $k$ (which will be denoted by $\kappa_A (k)$) measures the number of vertices $k$ interacts with, where each interaction (hyperedge or uberedge) that contain $k$ and its adjacent vertices are counted separately and added together. To be more precise, consider the hypergraph where $k$ is only incident in two hyperedges $e_1 =\{k,m\}$ and $e_2 =\{k,m,n\}$. Then, $k$ is interacting with $m$ in two distinct hyperedges and interacting with $n$ once in one hyperedge. Hence, the adjacency degree of $k$ is 3 whereas it is adjacent to two vertices $m,n$. This simple example also demonstrates the fact that adjacency and incidence degrees of a vertex are different in hypergraphs since $\kappa_I (k)=2$ and $\kappa_A (k)=3$.}

\gadd{We remark that an alternative definition of adjacency degree of a vertex $k$ can be given as the number of vertices that interact with $k$ without taking into account the contributions coming from different hyperedges. In this case, adjacency degree of $k$ in above example would be 2. However, this definition neglects the adjacency relations in different interactions (hyperedges). Namely, in this setting all vertices $k,m$ and $n$ would have the same adjacency degree whereas $n$ is less involved in interactions and has less ties than $k$ and $m$. Besides, the removal of the hyperedge $e_1$ wouldn't change the adjacency degrees of vertices. Therefore, we assume the former definition of adjacency degree which incorporates all interactions separately.}


\begin{definition}[Adjacency degree in a weighted diubergraph]
     Let $\mathcal{U}=(V,E_{\mathcal{U}},\adel{\phi}\aadd{\Phi})$ \gadd{be a weighted diubergraph. Adjacency in-degree (resp. out-degree) $ \kappa_{a}^{in}(v)$ (resp. $ \kappa_{a}^{out}(v)$) of a vertex $v \in V_{\mU}$ is defined as the sum of weights in the corresponding column (resp. row) of adjacency matrix i.e.
    \begin{equation*}
        \kappa_{A}^{in}(v):=\sum_{j=1}^{\lvert V_{\mU} \rvert}A_{jv}^{\mathrm{U}}, \quad \kappa_{A}^{out}(v):=\sum_{j=1}^{\lvert V_{\mU} \rvert}A_{vj}^{\mathrm{U}} .
    \end{equation*}}
\end{definition}


\gadd{As a summary, when considering hypergraphs, one has to be careful about the meaning of degree of a vertex, namely whether it is defined in terms of its incident hyperedges (incidence degree) or in terms of its adjacent vertices (adjacency degree). In most papers, the authors prefer to restrict the notion of degree to only one of these two possibilities either for simplicity or because one of them is more relevant to their model. For example, in \cite{Kapoor2013}, degree of a vertex in a hypergraph is defined as the number of its adjacent vertices. Moreover, the weighted degree centrality of a node is defined as the sum of weights of the ties of the node with the other nodes in the hypergraph \cite{Kapoor2013}. The weight of a tie
between two nodes in the hypergraph can be defined as the number of the hyperedges they both belong to \cite{Kapoor2013}. Then, weighted degree of a node coincides with adjacency degree in our definition. They attempt to generalise this definition by taking into account different hyperedge weights. Namely, they suggest that hyperedge weights are dependent on two parameters: multiplicity (frequency of the hyperedge’s occurrence) and size of the hyperedge \cite{Kapoor2013}. Subsequently, they define five different weighted node degrees according to hyperedge weights that are defined as functions of their multiplicity and size \cite{Kapoor2013}. However, we choose to give a more general exposition and thus to take into account both notions of degree centrality for hypergraphs.}

\gadd{One can naturally consider degree centrality of hyper/uberedges. In a hypergraph, the degree or order of a hyperedge is defined as the number of vertices contained in it. If the hyperedges are weighted, then the centrality of a hyperedge is measured according to its weight. As for ubergraphs, the degree (order) of an uberedge can be defined as either number of vertices contained in it or number of fundamental vertices in the fundamental form of it. Let us consider the uberedge $ e=\{ 1,\{2,3\} \}$. In the former definition, the degree of $e$ is 2 whereas it is 3 in the latter definition. Note that uberedge $f=\{1,2,3\}$ has degree 3 in second definition whereas two uberedges have completely different structures. Therefore, it is more natural to define the degree of an uberedge as the number of vertices that are incident in it. Similarly, if the uberedges are weighted, then the weight of an uberedge determines its centrality.}



\subsection{Paths and path-based measures}
For a simple graph $G=(V,E)$, a walk of length $k$ is a sequence of vertices $v_0 , v_1, \ldots, v_k$ such that each pair of successive vertices
are adjacent. Two vertices are adjacent if and only if they belong to exactly one
edge. Moreover, two incident edges intersect in exactly one vertex. Therefore, any graph walk can be equivalently described as either a sequence of adjacent vertices or
as a sequence of incident edges i.e. the walk $v_0 , v_1, \ldots, v_k$ can be equivalently represented by $e_1 , e_2, \ldots, e_k$ where $e_j =\{v_{j-1}, v_j \}$ for $j=1,2,\ldots,k$. 

This equivalence holds neither for hypergraphs nor ubergraphs. Two uberedges
can intersect at any number of vertices, and two vertices can belong to any number
of shared uberedges. This yields two options for walks on ubergraphs: walks on the vertex level (consisting of successively adjacent vertices), and walks on the edge level (consisting of successively intersecting edges). It is easier to focus on the latter. Therefore, for simplicity, we define a walk of length $k$ on an ubergraph $U=(V,E)$ as a sequence of uberedges $ e_1 , e_2, \ldots, e_k$ such that each pair of successive uberedges share at least one common vertex. This notion can be generalised to $s$-walks on uberedges analogous to hypergraphs \cite{Aksoy2020} in which consecutive uberedges can share at least $s$ vertices. 

In digraphs, such as food webs, paths often have the possible interpretation of an actual path matter can take. In ubergraphs, they resemble more a causal path.

%\mwadd{\begin{definition}
 %   Let $ \mU = (V, \EU, \phi) $ be a directed weighted ubergraph. Let $ v, w \in V \cup \EU $. A $ v w $-walk on $ \mU $ of length $ l $ is a sequence, \[ v, V_l, w \] where $ V_l $ is a sequence of $v_{l_j} $  and $ e_{l_j} $ with $v_{l_j}, e_{l_j} \in V \cup \EU $,  $ l_j \in \{1,2,\ldots, l-1 \} $ such that either of the following is true, 
%\end{definition}}
 %\begin{enumerate}
  %      \item \mwadd{$ v_{l_j}, e_{l_{j+1}}$ vertex to edge}
   %     \item \mwadd{ $ e_{l_j}, v_{l_{j+1}}$ edge to vertex}
    %    \item \mwadd{$ e_{l_j}, e_{l_{j+1}}$ edge to edge}
     %   \item \mwadd{ $ v_{l_j}, v_{l_{j+1}}$ vertex to vertex, (within the same edge or to a different edge)}
%\end{enumerate}

\begin{definition}
    Let $ \mU = (V, \EU, \phi) $ be a directed weighted ubergraph. Let $ v, w \in V \cup \EU $. A $ v w $-walk on $ \mU $ of length $ l $ is a sequence, \[ v, e_{1},e_{2}, \ldots,e_{l-1}, w: \forall_{i \in \{1,\ldots, l-2\}} \quad e_i \cap e_{i+1} \neq \emptyset \] where $ e_j \in \EU $, $ j \in \{1,2,\ldots, l-1 \} $.
\end{definition}

\madd{Here we differ from ubergraph paper by Joslyn}
\mat{Discussion note: we have seen that path as a sequence of edges generalizes from digraphs to ubergraphs, but as uberedges connect to uberedges it might not have a formulation as a sequence of vertices. }

\mwadd{\begin{plain}
    Consider an Ubergraph $ U = (V,E) $ with fundamental vertices $ V = \{ v_1, v_2, v_3, v_4 \}$ and uberedges $ E = \{ e_1, e_2, e_3, e_4, e_5\} = \{ e_1, e_2, e_3, e_4, (v_1,e_4) \} = \{ e_1, e_2, e_3, (v_2,e_3), (v_1,(v_2,e_3))\} $. The following are $v_1v_4$-walks on $U$, \\ $W1: v_1, e_1, e_2,e_3,v_4 $,\\ $ W2: v_1, e_5, e_4,e_3, v_4 $, \\$ W3:v_1,e_5,e_4,e_2,e_3,v_4.$
\end{plain}}
\mat{The paper by Golubski makes the right remark, that a hyperpath might still require presence of nodes other than entrance or exit (to a hyper/uberedge) and cites Gallo G. (1993) Directed hypergraphs and applications. Discrete Appl. Math. 42, 177-201}

\mwa{Gao et al. \cite{gao2014dynamic} define a hyperpath from $ v $ to $ w$,where $v,w \in V $, as a sequence of edges $e_0,e_1,\ldots, e_l $ such that $ v\in e_0 $, $w \in e_l$, $e_i \cap e_{i+1} \ne \emptyset $  }

\subsubsection{Additive and multiplicative path measures}
Traditionally, path lenght as the sum of weights, natural in transport, static networks. For edges with modifiers, a product of at least some weight on the path is necessary. Full product if e.g. contribution to the influence of a node from a given path is considered. (the full influence would be akin to Katz centrality)

\mwadd{\begin{definition}
    \textbf{Shortest path} A shortest path between vertices $ v $ and $ w $ in a weighted ubergraph $ U $ is a \mdel{path} \madd{walk} with minimum sum of the \madd{absolute values of the} weights along the \mdel{path} \madd{walk} from vertex $v $ to $ w $.
\end{definition}}

\madd{The shortest walk does not repeat vertices on the way - these would be loops so the shortest walk is also the shortest path}

\mwadd{\begin{definition}
    \textbf{Eccentricity} The Eccentricity of a vertex is the maximum distance between the vertex to any other vertex in the Ubergraph.
\end{definition}}
\bart{Maybe we should add what we mean by path exactly for hyper- and ubergraphs, as (I think) in most definions for a usual graph a path is a walk with no repeated vertices (and therefore edges: there's also a trail, for which only edges have to be distinct). But for edges with more than one element it's possible for an edge to repeat while veritces do not. I don't know how it's treated in literature, the issue came up when I read about clustering coefficients}
https://www.overleaf.com/project/63b551c2e7df58b60a1c6417
\mat{Actually, if sth has many tails and heads it could be traversed in different 'directions' and enable more paths in a directed graph. So I guess allowing multiple traversal is ok unless explicitly useful in some application.}
\mwadd{\begin{definition} Let $i,j,k \in V \cup \EU $. The betweeness centrality of vertex $ i $ is,
    \[C_B(i) = \sum_{j<k} \frac{p_{jk}(i)}{p_{jk}}\] where $ p_{jk}(i) $ is the number shortest directed paths from j to k containing i and $p_{jk}$ is the number of directed paths from $ j $ to $ k $. For a weighted directed network, $p_{jk}(i), p_{jk} $ is the sum of the weights on the shortest paths that passes through $ i $ over all the paths from $ j $ to $ k $ respectively. 
\end{definition}}

\mwadd{Note that the paths in $ p_{jk}(i) $ and $ p_{jk}$  exists only where the direction is meaningful i.e. a $jk$-path exists if there exists edges connected head-to-tail from the edges containing vertices $j$ until reaching $k$.}

\begin{figure}[h]
    \centering\includegraphics[width=0.7\linewidth]{fig/coffee agroecosystem.jpeg}
\end{figure}
\mwa{The hypergraph picture for illustration purposes only $ \rightarrow $ to be removed.}
\mwa{Some researchers argue that defining path based measures on directed weighted graphs based on the sum of the weights on the edges looses the information of the number of intermediary vertices/edges between the end points.}

\subsection{Information-based measures}
\madd{The graph measures that take inspiration from information theory rely on sums of weights. Their generalisation from digraph to an ubergraph requires the proper choice of the summation domain as well as taking into account multiple heads and tails in an uberedge. The natural summation domains are the uberedge classes (see Def.~\ref{def:classes_of_hyper_uber}).}
The distribution of edge weights in empirical graphs differs from purely random, containing information about structural properties specific to the system. Ecological network analysis~\cite{Ulanowicz2004} quantifies this information amount as flow diversity~\cite{MacArthur_1955} using Shannon entropy. In a digraph, such as a food web, it takes the form 
\begin{equation}
			H=-\sum^{n}_{i=1}\sum^{n}_{j=1}\frac{\phi_{ij}}{\phi_{\bullet \bullet}}\log\frac{\phi_{ij}}{\phi_{\bullet \bullet}}.
\end{equation}
It can be decomposed into two parts. The first, called the average mutual information (AMI)~\cite{Rutledge_1976} is interpreted as a measure of the system efficiency~\cite{Ulanowicz_1987}. It compares the observed flows with ones guided by the total outflows and inflows to their origin and target vertices.
\begin{equation}
			\text{AMI}=\sum^{n}_{i=1}\sum^{n}_{j=1}\frac{\phi_{ij}}{\phi_{\bullet \bullet}} \log\frac{\phi_{ij}\phi_{\bullet \bullet}}{\phi_{i\bullet}\phi_{\bullet j}}.
\end{equation}
In the summation, the terms for which $\phi_{ij}$ is zero are omitted. 

The remainder, the residual pathway diversity $H_{\mathrm{c}}=H-\text{AMI}$~\cite{Rutledge_1976} describes flow redundancy:
\begin{equation}
			H_{\text{c}}=-\sum^{n}_{i=1}\sum^{n}_{j=1}\frac{\phi_{ij}}{\phi_{\bullet \bullet}}\log\frac{{\left(\phi_{ij}\right)}^2}{\phi_{i\bullet}\phi_{\bullet j}}.
\end{equation}

Robert Ulanowicz introduced an indicator of robustness~\cite{Ulanowicz_1997, Ulanowicz_2009},  that balances efficiency and redundancy in a graph:
\begin{equation}
	-e\frac{\mathrm{AMI}}{H}\mathrm{log}\left(\frac{\mathrm{AMI}}{H}\right).
\end{equation}
where $e$ is a normalization factor.



These information-based measures normalise the contribution of an individual edge using quantities characterising the whole set of edges ($H$) or edges around a given vertex ($\mathrm{AMI}$). This mirrors the assumption about the prior weight distribution the empirical one is compared to. A uniform distribution is used in the context of flow diversity, and one guided by inflows and outflows for AMI.
Both for ubergraphs and hypergraphs it seems natural to compare edges within the class $\mathcal{E}$ they belong to (see Def.\ref{def:classes_of_hyper_uber}). We present explicit formulas for ubergraphs as they take the same form for hypergraphs. We replace $\phi_{\bullet \bullet}$ with a class-specific normalisation, 
\begin{align}
    \omega_e&=\sum_{e' \in \tE_e} \tphi_{e'} \\
    H^U&=-\sum_{e \in E } \frac{\tphi_{e}}{\omega_e}\log\frac{\tphi_{e}}{\omega_e}.
\end{align}
The observed weight of an edge is compared by digraph AMI to the product of in- and out-strengths of its head and tail, respectively (see Eq.~\ref{eq:degree_def}). For ubergraphs, these are further summed for all heads and tails,
\begin{align}
    \omega_e^{\text{in}}&=\sum_{u \in e^{\mathrm{in}}} \kappa_{u}^{in} \\
    \omega_e^{\text{out}}&=\sum_{u \in e^{\mathrm{out}}} \kappa_{u}^{out} \\
    \text{AMI}^U&=\sum_{e \in E}
    \frac{\tphi_e}{\omega_e} \log\frac{\tphi_e\omega_e}{\omega_e^{\text{in}} \omega_e^{\text{out}}}.
\end{align}

\mat{The $\text{AMI}^U$ looks like it would differ from digraph AMI because individual weight $\tphi_e$ can contribute multiple times to all normalisations as every uberedge contains many vertices. But I have to check it out in detail.}

\subsection{Recursive measures}
A number of digraph measures are defined implicitly, relying on recurrence relations. This happens, if the value of a vertex measure depends on its value in neighbouring vertices.

\madd{Recursive measures can be generalised to ubergraphs in a straightforward manner, thanks to appropriate definition of the adjacency matrix~\ref{def:ubergraph_adjacency_matrix}.} The notion of neighbouring vertices finds its natural meaning in the set $V_{\mU}$.

Certain applications might prefer to consider both the measure's general and a basic version, restricted to a certain class of uberedges. Trophic level could continue to use just the pairwise consumption flows. We propose to define \emph{trophic influence} that represents which trophic levels a vertex influences.  

\subsubsection{Eigenvector centrality}\mwadd{The degree centrality has been described earlier on is a degree based centrality measure that consider the influence of a vertex on the directly linked vertices. Some path based measures, betweeness centrality and closeness centrality have also been discussed. However, it is known that the recursive measure of eigenvector centrality provides more information on the importance of a node based on the importance of other nodes.}

\mwadd{For undirected graphs, the eigenvector centrality is given by}
\mwadd{\[\textbf{x}=\frac{1}{\lambda_1}A\textbf{x} \]}
\mwadd{$ \textbf{x} $, the vector of centralities, $ A $ the adjacency matrix which is a symmetric matrix, $\lambda_1$ the largest eigenvalue of $ A $. For directed graphs, $ A $ is not necessarily symmetric. There are two centrality measures based on out-degree (importance of a node) and in-degree (achievements of a node). Out-degree centrality increases with increasing nodes which in turn have more out-degree and the in-degree centrality is the opposite. In literature, the right eigenvector $\textbf{x}$ is considered ($A\textbf{x} = \lambda \textbf{x}$) most times as compared to the left eigenvector $\textbf{y}$, ($y^HA = \lambda y^H $) because it is the in-degrees that gives a node power.}

\subsubsection{Katz centrality} \madd{A classical example of such a measure is \textbf{Katz centrality} that defines vertex importance as being connected to (many) important vertices. The contribution from a neighbour is multiplied by the weight of the connecting (uber)edge and then a universal damping factor $\alpha$. The $i$-th entry of a vector of Katz centrality values $C_{\mathrm{Katz}}$ is defined as}
\begin{equation}
    C^{\mathrm{Katz}}_i=\alpha \sum_j \Phi_ij C^{\mathrm{Katz}}_j + \beta_i,
\end{equation}
with $\alpha, \beta \in \mathbb{R_+}$
In matrix form,

        \begin{equation}\label{eq:Katz}
            C_{\mathrm{Katz}}=\alpha \Phi C_{\mathrm{Katz}} + \beta. 
        \end{equation}
        For the solution to exist, the damping factor $\alpha \in (0,\rho^{-1})$, $\rho=max(Re(\mathrm{eig}(\Phi)))$, and $\beta \in \mathbb{R_+}^{n}$ \mat{Notation: how to best define it briefly as an eigenvalue?}
\subsubsection{Trophic level and trophic influence} \madd{\textbf{Trophic level}~\cite{Odum1975TheDF} in food webs is an example of Katz centrality restricted to a subgraph. In a seemingly unrelated manner it represents the distance of a vertex from the point of entry of biomass into the system. }
    \madd{
    Non-living vertices and primary producers are assigned trophic level equal to one. The trophic level $\tau$ of the remaining vertices is the mean trophic level of their prey plus one:}
    \begin{align}
        \tau_i=
        \left\{
        \begin{array}{ll}
        1 & \text{if $i>l$ or $\sum_{k=1}^{n} \Phi_{ki}=0$} \\
        1 + \sum_{j=1}^{n}\frac{ \Phi_{ji} }{\Phi_{\bullet i}}\tau_j  & \mbox{   } \text{for other nodes.} \\
        \end{array}
        \right. 
    \end{align}
    For a vector of consumer trophic levels $\tau_c$, that are larger than one,
    \begin{equation}
        \tau_c=\Psi \tau_c + \tau_0 
    \end{equation}
    \madd{where $\Psi_{kl}=\frac{\Phi_{kl}}{\Phi_{k \bullet }}$ with $k$, and $l$ restricted to the consumer nodes; $\tau_0$ is a vector representing the constant contributions (ones and flows from non-consumers).}
\subsubsection{Structural similarity}
\madd{An approach to identify groups of similar vertices was to say that "$i$ is similar to $j$ if $i$ has a network neighbor $v$ that is itself similar to $j$". This led to a definition of a \textbf{structural similarity} matrix $S: V \times V: \mathbb{R}$, \cite{Leicht2006}: }
    \begin{equation}
        S=-\alpha \Phi S+ \mathit{I}.
    \end{equation}
    Here $\Phi$ is the adjacency matrix of a digraph and $\mathit{I}$ is the identity matrix.

\subsection{Clustering coefficient}
\badd{A clustering coefficient is a measure of how much nodes of a graph cluster together, meaning in this case how often neighbors of the same node are neighbors themselves. 
For usual graphs, two versions of the measure are considered: a local and a global clustering coefficient. For the following definitions we assume no self-loops, meaning no edges connecting a vertex to itself.}
\badd{
\begin{definition}[Local clustering coefficient for undirected graphs]
    The local clustering coefficient $C(v)$ of vertex $v$ is defined as proportion of a number of edges between its neighbors to a number of those possible. Denoting the set of vertices connected to $v$ as $N$, $|N|=n>1$ the definition is
    \[
    C(v) = \frac{2 \times |\{(v_i, v_j) \in E: v_i, v_j \in N\}|}{n(n-1)} .
    \]
    For $n \in \{0,1\}$ two approaches can be taken, either to let $C(v) = 0$ or to leave it undefined. Multiplication by $2$ comes from the fact that there are $\frac{1}{2} n(n-1)$ edges between neighbors of $v$ possible.
\end{definition} }
\badd{
The local clustering coeffient takes values in the interval $[0,1]$. In terms of an adjacency matrix it can be expressed as
\[
C(v_i) = \frac{1}{n(n-1)} \sum_{j,k} A_{ij} A_{ik} A_{jk} = \frac{(A^3)_{ii}}{n(n-1)}.
\]
The first equality is justified by the fact that the summed value is equal to $1$ iff $v_i$ is connected to both $v_j$ and $v_k$ and these two are  connected as well. The second equality follows from the fact that the number of walks of length $n$ between vertices $v_i$ and $v_j$ is equal to $(A^n)_{ij}$. Thus the number of pairs of connected neighbors of $v_i$ is the number of walks of length $3$ from $v_i$ to itself.}
    \badd{
\begin{definition}[Global clustering coefficient for undirected graphs]
    Global clustering coefficient measures how clustered the whole network is. It is usually defined for undirected graphs as
    \[
    C = \frac{3 \times \text{number of triangles in a graph}}{\text{number of paths of length two}} .
    \]
    The ``triangles'' are trios of verices, all of which are connected to each other. Multiplication by $3$ is justified by the fact that each triangle corresponds to $3$ paths of length two.
\end{definition} }
\badd{
    The global clustering coeffient takes values in the interval $[0,1]$. In terms of an adjacency matrix it can be expressed as 
    \[
    C = \frac{\text{tr}(A^3)}{\sum_{i \neq j}(A^2)_{ij}} , 
    \]
    because the number of walks of length $n$ between vertices $v_i$ and $v_j$ is equal to $(A^n)_{ij}$, so the number of triangles is equal to $\frac{1}{6}\text{tr}(A^3)$. This is because each triangle corresponds to two walks from each of the three veritces to itself. The number of paths of length $2$ is equal to the expression in the denominator, since all walks of length $2$ apart from loops should be counted. }
    \par
    \badd{
    The global clustering coefficient is also known as transitivity or transitivity coefficient. It is worth noting that the avarage of local clustering coefficients of all vertices is also considered a useful metric. Sometimes this value is called a global clustering coefficient instead.
    }
    \bart{TO DO: add citations}
\subsubsection{Generalization to weighted and directed networks}
\badd{Introducing either edges' directions or weights to networks poses some challanges for generalizing the clustering coefficients. There exist multiple approaches, none of which seems to be universally considered the only proper one. To illustrate the possible issues, let us consider three vertices, all connected by undirected weighted edges. In defining the local clustering coefficient for one of them, the weights can be aggregated by taking their maximum, minimum, the arithmetic or the geometric mean and possibly more. In some cases only the weights of two edges between the vertex and its neighbors are considered; the weight of the edge connecting the neighbors is not considered, only its presence. }
\bart{There's really a lot of possible choices, mainly when dealing with weights. Should one definion be chosen, even just as an example to introduce the weighted case for hyper- and ubergraphs? The issue for hypergraphs I mentioned in the meeting is kind of separate from that.}

    


\section{Comparison of different graph models of higher-order phenomena [TO DO]}
\mat{To do: Find a real example of a true hyperedge that cannot be represented by hierarchical nested pairwise interactions.}


We remark here that ubergraphs can be used to model ecological networks that involve trait-mediated indirect interactions or interaction modifications associated with adaptive behaviors such as coffee agroecosystem web~\cite{GOLUBSKI2016344} or four-way live prey-predator-carrion-scavenger interactions~\cite{Moleon_scavenging} (see Figure \ref{Moleon}). This is because in such systems, some vertices (species) interact with some edges (interactions). However, ubergraphs provide much more flexibility than needed in these systems and therefore creating more complexity for the structure and dynamics. To be more precise, in such systems one uberedge is only linked to some other fundamental vertices whereas general ubergraphs allow uberedges containing arbitrary number of other uberedges and fundamental vertices. For this reason, we need a more specific class of ubergraphs called ecographs. 

In this section, we shall illustrate the differences between our ecograph approach and the hypergraph representations proposed earlier in order to represent higher order interactions in ecology such as coffee agroecosystem web and four-way live prey-predator-carrion-scavenger interactions. For simplicity, we use small subgraphs (motifs) that contain all the features relevant to each case.
\subsection{Coffee agroecosystem}

\madd{A coffee agroecosystem network~\cite{GOLUBSKI2016344} described higher-order interactions among insects and used them as a motivation for hypergraph representation. A minimal example of a four-vertex subgraph of this network is presented in Fig.~\ref{rep_of_coffee_comparison}. We used it as our core ubergraph example in Fig.~\ref{fig:PASB_ubergraph_incidence_graph}.
Ecological expert knowledge was used to describe direct pairwise interactions between species, as well as influences strengthening or weakening other interactions. The described system explicitly portrays a depth-2 ubergraph. Representing it as a hypergraph introduces ambiguity about the role of a vertex in an interaction. The authors used vertex removal and edge addition to test soundness of the representation. They concluded that unweighted undirected hypergraphs might incorrectly inflate centrality measures by higher-order interactions intended as weakening. This is resolved in directed case, that clearly distinguishes between being influenced and influencing. Authors also postulated using different weights for each vertex in a hyperedge, remarking that assigning and combining weights would be a nontrivial task. In our approach the same goal can be achieved with standard graph weights assigned to the whole uberedge in which each vertex role is clear.
 }

%[a bit long and confused in the Golubski paper vs other sources]We consider a subgraph of  representing interactions between four species. The beetles and Azteca ants obtain energy from scale insects, while phorid flies parasitize Azteca ants. Azteca ants protect scale insects from beetles~\footnote{The original article contained a misprint in the figure description}. The phorid flies elicit a defensive behaviour of ants, thus reducing the impact of the Azteca ants on scale:beetle interaction.[Here again I am uncertain about the direction] 

%These interactions have been originally represented as hyperedges  as one can see in Figure \ref{figcoffee2}. For example, the modification of Azteca on the Scale:Beetle interaction is depicted as hyperedge $E$ in \ref{figcoffee2}. However, the hyperedge $E$ consists of $\{ Azteca, Scale, Beetle \}$ and the correct nature of interactions among these three species is ambiguous in this hyperedge representation. Namely, it is not clear which species modifies the interaction between the other two. Similar explanation can be made for the hyperedge $F$ that represents the interaction in which Phorid modifies the modification of Azteca on the Scale:Beetle interaction. Therefore, these hyperedge representations are lacking to reflect the true nature of the interaction modifications between four species. We propose to represent these interactions by using a special class of ubergraphs (we call them ecographs) in the following way. Let us define the set of fundamental vertices $V=\{ P,A,S,B \}$ and set of directed edges $E=\{e_1 =(A,P), e_2 = ( S,A), e_3 = ( S,B) \} $ where we denote Phorid by P, Azteca by A, Scale by S and Beetle by B. The set of directed uberedges is given by $U= \{ u_1 = ( A, e_3 ), u_2 =  (P, u_1 )  \}$ where $u_1$ is a depth-1 uberedge representing the modification of Azteca on the Scale:Beetle interaction and $u_2$ is a depth-2 uberedge representing the modification of Phorid over the previous modification of Azteca on the Scale:Beetle interaction. It is easily seen that in this setting there is no loss of any information about the whole structure of the system. 

\begin{figure}[h]
    \centering\includegraphics[width=0.9\linewidth]{fig/various_PASB_representations.png}
    \caption{Four representations of a fragment of the coffee agroecosystem network~\cite{GOLUBSKI2016344}, the interaction between Phorid, Azteca, Scale and Beetle vertices. Upper left and right: interactions reported together with their signs in the original paper, which are an ubergraph visualisation. Lower left: hypergraph representation. Lower right: digraph incidence representation of an ubergraph.}
    \label{rep_of_coffee_comparison}
\end{figure}
\subsubsection{Comparison of degree centralities}
\gadd{We shall compare the degree centralities (incidence and adjacency) for hypergraph and ubergraph (or maybe ecograph???) representations of minimal subgraph (see Fig.~\ref{rep_of_coffee_comparison}, upper right) of coffee agroecosystem network~\cite{GOLUBSKI2016344} which contains trait-mediated indirect interactions or interaction modifications. Hypergraph representation of this subgraph consisting of four species: Phorid, Azteca, Scale and Beetle, and higher-order interactions among them was presented in ~\cite{GOLUBSKI2016344}. Namely, the authors represented it as the hypergraph $H=(V,E)$ where $V=\{ P,A,S,B \}$ is the set of vertices and $E=\{ b=\{ S,B\}, c=\{A,S\}, d= \{P,A\}, e=\{ A,S,B\} , f=\{ P,A,S,B\} \} $ is the set of hyperedges. The correct nature of interactions among three species $A,S$ and $B$ is ambiguous in the hyperedge $e$, namely, it is not clear which species modifies the interaction between the other two. Therefore, this hypergraph representation is lacking to portray indirect interactions or interaction modifications within ecological networks. For this reason, we propose an ubergraph representation of this subgraph as follows. Let us define the set of fundamental vertices $V=\{ P,A,S,B \}$ and set of uberedges $U_E =\{ e_1 =\{ S,B\}, e_2 =\{A,S\}, e_3 = \{P,A\}, e_4 =\{ A,e_1 \} , e_5 =\{ P,e_4 \} \}$. Notice that $e_4$ is a depth-1 uberedge representing the modification of Azteca on the Scale:Beetle interaction and $e_5$ is a depth-2 uberedge representing the modification of Phorid over the previous modification of Azteca on the Scale:Beetle interaction.} 
\begin{table}[]
    \centering
    \begin{tabular}{|c|c|c|c|c|}
        \hline
       & P & B & S & A   \\
       \hline 
       Incidence degree  & 2 & 3 & 4 & 4 \\
       \hline 
       Adjacency degree & 4 & 6 & 7 & 7 \\
       \hline
    \end{tabular}
    \caption{Degree centralities for hypergraph representation}
    \label{tab1}
\end{table}

\gadd{It can be easily observed from Table \ref{tab1} that incidence and adjacency degrees are different but they are dual to each other in terms of measuring the centrality of nodes.In Table \ref{tab1}, it can be seen that Scale and Azteca are more central than the others with same incidence and adjacency degrees. As for our ubergraph representation, Table \ref{tab2} suggests that Azteca is the most central node. Notice that the incidence degree of an influenced node in hypergraph representation is reduced in the ubergraph representation for each time the node is influenced by others. For example, incidence degree of Azteca changes from 4 to 3 since it is only influenced by the modifier Phorid whereas the incidence degree of Phorid is constant since it is only a modifier. In other words, in the ubergraph representation, a higher-order interaction (depth-$k$ uberedges with $k\geq 1$) contributes only to a modifier node in terms of incidence degree. Moreover, note that incidence and adjacency degrees coincide in the ubergraph picture since every uberedge has two vertices (some vertices may be other uberedges). However, this not true in general. For instance, consider an interaction that is modified by two distinct nodes. In this case incidence and adjacency degrees differ.}

\begin{table}[]
    \centering
    \begin{tabular}{|c|c|c|c|c|}
        \hline
         & P & B & S & A   \\
         \hline
       Incidence degree  & 2 & 1 & 2 & 3 \\
       \hline
       Adjacency degree & 2 & 1 & 2 & 3 \\
       \hline
       Betweeness centrality & 0 & 0 &  $\frac{2}{21}  $& $ \frac{2}{21} $\\
       \hline
    \end{tabular}
    \caption{Degree centralities for ubergraph representation}
    \label{tab2}
\end{table}
\gadd{Now, let us compare degree centralities in the directed hypergraph and ubergraph representations of higher-order interactions between Phorid, Azteca, Scale and Beetle (see Fig.~\ref{rep_of_coffee_comparison}, upper right). Firstly, we note that these representations haven't appeared in the literature, to the best of our knowledge. Therefore, we shall present them explicitly.}

\gadd{Let us start with dihypergraph representation $\mH = (V,\EH)$ where set of vertices $V=\{ P,A,S,B \}$ is the same as undirected case and set of dihyperedges is given by $\EH =\{ \Tilde{b}=(S,B), \Tilde{c}=(S,A), \Tilde{d}= (A,P), \Tilde{e}=( A,\{S,B \}) , \Tilde{f}=( P,\{A,S,B \}) \} $. Here, higher-order interactions are represented by dihyperedges directed from influencing node to influenced nodes. }

\begin{table}[]
    \centering
    \begin{tabular}{|c|c|c|c|c|}
        \hline
       & P & B & S & A   \\
       \hline 
       Incidence in-degree  & 1 & 3 & 2 & 2 \\
       \hline 
       Incidence out-degree  & 1 & 0 & 2 & 2 \\
       \hline 
       Adjacency in-degree & 1 & 6 & 5 & 4 \\
       \hline
       Adjacency out-degree & 3 & 0 & 2 & 3 \\
       \hline
    \end{tabular}
    \caption{Degree centralities for dihypergraph representation}
    \label{tab3}
\end{table}

\gadd{One can easily realise from Tables \ref{tab2} and \ref{tab3} that sum of incidence/adjacency in and out-degrees equals to incidence/adjacency degrees in undirected representation for all vertices. Moreover, Beetle is influenced more times (i.e. it has the highest incidence in-degree) and also the number of other nodes that influence it is the greatest (i.e. it has the highest adjacency in-degree). Notice that since there are no weights, the role of a direct relation is the same as the role of an indirect relation. }


\subsection{Scavenging}
\madd{The intertwined interactions between prey, its predators and scavengers are another example of species influencing interactions between other species~\cite{Moleon_scavenging}. The interactions between live prey, its carcasses, predators and scavengers are shown in Fig.~\ref{fig:scavenging}.}
\begin{figure}[h!]
	\begin{center}
        \includegraphics[width=0.7\linewidth]{./fig/Moleon_1_model.jpg}
        \caption{A model of four-way live prey-predator-carrion-scavenger interactions in \cite{Moleon_scavenging}, adapted from \cite{Getz_2011}.} 
    	\label{fig:scavenging}
    \end{center}
    \end{figure}
\madd{The dynamics of these interactions has been modelled through non-polynomial four-way interaction terms~\cite{Mellard2021}. Predators and scavengers affect each other by changing the time each spends handling its prey.}
 
\section{Ecograph structure analysis}
Network centrality measures try to capture vertex importance for the network structure. Investigating the structure of a more complex object, one can try to generalize the most popular network measures, or tailor an indicator to a particular question.


\subsection{Ecograph centrality from scratch}
For each vertex and interaction we can compare the system with and without it, given the equations defining the model.
\begin{definition}
    A \emph{existential centrality} of a vertex $v \in E$ belonging to a non-trivial ecograph $G=(V,E, \phi, U, \psi)$ is the difference $\mu(G)-\mu(G\setminus v)$, for any chosen ecograph measure $\mu: G \rightarrow \mathbb{R}$.
\end{definition}
$G\setminus v$ is understood as an ecograph without vertex $v$ and its associated flows in $E$ and uberedges in $U$, and an estimate of the changes due to uberedges containing $v$. Choices in such an estimate lead us to two basic versions of the existential centrality. A static existential centrality compares two instances of the ecograph at the same time, or the immediate impacts of a removal of vertex $v$. The value of a flow $e$ indirectly impacted by $v$ is estimated by its defining formula $e=e(x(v))$,
\begin{equation}
e_{G\setminus v}=e_{G}(x(v)=0).
\end{equation}
A dynamical existential centrality would compare instances of an ecograph at two different moments in time, e.g. corresponding to two stationary states of the associated dynamical equations.

Natural choices for $\mu$ could be the sum of all biomasses or the sum of all flows, but also e.g. mass cycling in the food web.   



\section{Mapping a dynamical model to an ubergraph}

We start the translation from a system of differential equations describing how $n$ living and non-living pools of biomass (populations) $x=\{x_1, x_2, \ldots, x_n\}$ evolve in time in an ecosystem. Ecosystems abide to physical mass conservation law. Every biomass change $\dot{x_i}$ must be supported by a biomass inflow $F_{ij}$ or outflow $F_{ki}$, which have a source ($j$) or target ($k$),
\begin{equation}
    \dot{x_i}=\sum_{j=1}^{N}[F_{ij}-F_{ji}]+F_{ii}
\end{equation}
with $F_{ij}\in \mathbb{R_+}$ for $i \neq j$ and $F_{ii} \in \mathbb{R}$.
A food web thus naturally emerges. The flows can depend on some of the biomasses in the system $F_{ij}=F_{ij}(x_{k_1}, \ldots, x_{k_m})$, with $m\leq n$.


All ecological interactions manifest indirectly through the physical food web of biomasses $x$ connected by flows $F$. In assigning the responsibility for the observed value of a flow, we face the following choice:
\begin{enumerate}
    \item We map every functional dependence $F_{ij}(x_{k_1}, \ldots, x_{k_m})$ to an uberedge $(F_{ij}, x_{k_1}, \ldots, x_{k_m})$ with a weight $\tfrac{F_{ij}}{|F_{ii}|+\sum_{k}(|F_{ik}|+|F_{ki}|)}$.
    \item We map every functional dependence $F_{ij}(x_{k_1}, \ldots, x_{k_m})$ to a collection of pairwise edges $\{(F_{ij}, x_{k}): \tfrac{\partial F_{ij}}{\partial x_k}\neq 0\}$ with weights $\tfrac{\partial F_{ij}}{\partial x_k}$.
\end{enumerate}







\bibliographystyle{naturemag} 
\bibliography{hyp_dyn}	
\end{document}
