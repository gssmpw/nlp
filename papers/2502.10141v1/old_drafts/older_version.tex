\documentclass[a4paper,12pt]{article}

\usepackage[utf8]{inputenc}
\usepackage{fullpage}
\usepackage{graphicx}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{breakcites}
\usepackage[left]{lineno}
\usepackage{blindtext}
\usepackage{subfig}
\usepackage{hyperref}
\usepackage{lineno}
\usepackage{url}
\usepackage{multicol}

\theoremstyle{definition}
\newtheorem{definition}{Definition}%[section]

%there's no option "example" for theoremstyle, there's plain, definition and remark

\newtheorem{plain}{Plain}%[section]

\theoremstyle{remark}
\newtheorem{remark}{Remark}%[section]
\newtheorem{exam}{Example}

\usepackage{changes}
\colorlet{cMat}{Orchid}
\definechangesauthor[name={Mateusz}, color=cMat]{Mateusz}
\newcommand{\madd}[2][]{\added[id=Mateusz,comment=#1]{#2}}
\newcommand{\mdel}[2][]{\deleted[id=Mateusz,comment=#1]{#2}}
\newcommand{\mat}[1]{\todo[inline,color=cMat]{\color{black}#1}}

\colorlet{cal}{olive}%Dandelion}
\definechangesauthor[name={Alex}, color=cal]{Alex}
\newcommand{\aadd}[2][]{\added[id=Alex,comment=#1]{#2}}
\newcommand{\adel}[2][]{\deleted[id=Alex,comment=#1]{#2}}
\newcommand{\al}[1]{\todo[inline,color=cal]{\color{black}#1}}

\colorlet{cbar}{ForestGreen}
\definechangesauthor[name={Bartek}, color=cbar]{Bartek}
\newcommand{\badd}[2][]{\added[id=Bartek,comment=#1]{#2}}
\newcommand{\bdel}[2][]{\deleted[id=Bartek,comment=#1]{#2}}
\newcommand{\bart}[1]{\todo[inline,color=cbar]{\color{black}#1}}

\colorlet{cmwa}{Maroon}%BurntOrange}
\definechangesauthor[name={Mwawi}, color=cmwa]{Mwawi}
\newcommand{\mwadd}[2][]{\added[id=Mwawi,comment=#1]{#2}}
\newcommand{\mwdel}[2][]{\deleted[id=Mwawi,comment=#1]{#2}}
\newcommand{\mwa}[1]{\todo[inline,color=cmwa]{\color{black}#1}}

\colorlet{cgok}{RoyalBlue}
\definechangesauthor[name={Gokhan}, color=cgok]{Gokhan}
\newcommand{\gadd}[2][]{\added[id=Gokhan,comment=#1]{#2}}
\newcommand{\gdel}[2][]{\deleted[id=Gokhan,comment=#1]{#2}}
\newcommand{\gok}[1]{\todo[inline,color=cgok]{\color{black}#1}}

\colorlet{cag}{TealBlue}
\definechangesauthor[name={Ola}, color=cag]{Ola}
\newcommand{\agadd}[2][]{\added[id=Ola,comment=#1]{#2}}
\newcommand{\agdel}[2][]{\deleted[id=Ola,comment=#1]{#2}}
\newcommand{\ag}[1]{\todo[inline,color=cag]{\color{black}#1}}

\newcommand{\HH}{\mathcal{H}}
\newcommand{\bHH}{\overline{\mathcal{H}}}
\newcommand{\tHH}{\tilde{\mathcal{H}}}

\newcommand{\V}{\mathcal{V}}
\newcommand{\mG}{\mathcal{G}}
\newcommand{\mH}{\mathcal{H}}
\newcommand{\mU}{\mathcal{U}}
\newcommand{\bV}{\overline{\mathcal{V}}}
\newcommand{\tV}{\tilde{\mathcal{V}}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\bE}{\overline{\mathcal{E}}}
\newcommand{\tE}{\tilde{\mathcal{E}}}
\newcommand{\tphi}{\tilde{\phi}}

\newcommand{\EG}{E_{\mathcal{G}}}
\newcommand{\EH}{E_{\mathcal{H}}}
\newcommand{\EU}{E_{\mathcal{U}}}

\newcommand{\tin}{\mathrm{in}} %like text in
\newcommand{\out}{\mathrm{out}}
\newcommand{\mI}{\mathcal{I}}
\newcommand{\inci}{\mathcal{I}^{\tin}}
\newcommand{\inco}{\mathcal{I}^{\out}}
\newcommand{\adji}{\mathcal{A}^{\tin}}
\newcommand{\adjo}{\mathcal{A}^{\out}}

\newcommand{\eout}{e^{\out}}
\newcommand{\ein}{e^{\tin}}

\newcommand{\vtx}{\text{v}}
\newcommand{\Ph}{\vtx_\text{P}}
\newcommand{\A}{\vtx_\text{A}}
\newcommand{\Sc}{\vtx_\text{S}}
\newcommand{\B}{\vtx_\text{B}}

\newcommand{\RR}{\mathbb{R}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}

\newtheorem{prop}{\small\bf Proposition}

\title{Ubergraphs as models of higher-order \\
interactions in ecosystems}
\author{Mateusz Iskrzy≈Ñski, Aleksandra Puchalska, Aleksandra Grzelik} %for authorship a substantial contribution to the original results obtained is crucial, the order should depend on the size of the contribution


\begin{document}

\maketitle

\begin{abstract}
Graphs portray pairwise interactions within a set of vertices. However, higher-order interactions (HOIs) involving simultaneously more than two objects exist in nature~\cite{GOLUBSKI2016344, Moleon_scavenging}. They should not be mapped as multiple digraph edges, as they require the presence of all constituent vertices in the graph to exist. Hypergraphs resolved this issue by allowing an edge to contain any subset of vertices, and altered conclusions about system stability~\cite{Grilli2017}. 

Some HOIs represent interaction modifications (e.g. inhibition), in which vertices play very asymmetrical roles. Hypergraph representation loses information about these role and e.g. erroneously enhances vertex centralities~\cite{GOLUBSKI2016344}.

We provide a consistent framework for the inclusion of arbitrarily complex and nested higher-order interactions in a quantitative graph generalisation - ubergraphs. They resolve the issues of role mapping and centralities that limited hypergraphs as viable tools for structural analysis of general HOIs. We show all postulated higher-order structures to be special cases of ubergraphs. We show how to adapt concepts such as walks and centrality measures that suit various modelling questions and needs.
\end{abstract}
%Goal: convince readers we have a new tool that is:
%    \begin{itemize}
%        \item simple
%        \item solves a problem
%        \item which we illustrate by a nice application
%    \end{itemize}
%    Intro: digraphs, hypergredges necessary for non-pairwise interactions that would not exist without any of their participants;
%    Result:
%    \begin{itemize}
%        \item sound mapping of vertex roles in interactions (here uderstand Aleksandra's remark about deletion in uberedge, for me now hyperedge already resolves it)
%        \item consistent framework allowing arbitrarily nested interaction modifications and edge-edge interactions~\cite{zhao2022_edge_to_edge} making it possible to develop models applied in various fields without the need to define a new structure for each application separately
%        \item this resolves also quantitative issues e.g. with centrality measures, reported by Golubski
%    \end{itemize}
%A food web is the physical basis of an ecosystem and classically in the literature it is represented by a graph. Hypergraphs and multilayer networks were proposed lately to introduce non-trophic interactions and in a consequence build a more holistic ecosystem model. However, in this approach we lose information about the underlying processes, the roles of vertices involved as well as about quantities of a mass flow. We suggest instead to model an ecosystem and its dynamics through a different object called an ubergraph. Ubergraphs combine the strengths of previously proposed approaches of multilayer networks and hypergraphs and allow to map all ecological phenomena more precisely.

%In this paper we analyze a new tool by generalising graph measures to ubergraphs. Consequently, we arrive at new conclusions since generalised measures take into account the differing orders of interactions. We also propose a duality between systems of ordinary differential equations describing ecological dynamics and a weighted ubergraph structure.
  

\tableofcontents

I added package changes. \newline
\bart{Do not put 'add' around equations and multiple paragraphs, because text renders multiple times. It's better to put just a single paragraph in brackets for one command}

\madd{This text is written by Mateusz.}\mdel{This text is crossed out by Mateusz.}\mat{This is Mateusz's comment.}

\aadd{This text is written by Aleksandra.}\adel{This text is crossed out by Aleksandra.}\al{This is Aleksandra's comment.}

\badd{This text is written by Bartek.}\bdel{This text is crossed out by Bartek.}\bart{This is Bartek's comment.}

\mwadd{This text is written by Mwawi.}\mwdel{This text is crossed out by Mwawi.}\mwa{This is Mwawi's comment.}

\gadd{This text is written by Gokhan.}\gdel{This text is crossed out by Gokhan.}\gok{This is Gokhan's comment.}

\agadd{This text is written by Ola.}\agdel{This text is crossed out by Ola.}\ag{This is Ola's comment.}

\section{Ecological motivation}


Ecosystems consist of species of organisms that exchange matter with each other and with the environment. The physical foundation of an ecosystem can be described through stocks of elements assembled into organisms and their non-living pools\gadd{,} as well as flows between them. Their values constitute a food web, which classically is represented by a weighted digraph with organisms denoted by vertices and flows by edges. 

A variety of ecological interactions governs the dynamics of these stocks and flows. Parasites, competitors, mutualists\gadd{,} and scavengers~\cite{Moleon_scavenging} were shown to influence e.g.\gadd{,} the predatory relationships between two other groups of organisms. 

The first layer of interaction modifications and their quantitative coupling to a  food web has been proposed in~\cite{Goudard_nontrophic_2008}.

Researchers used to embed such interactions in the topology of ecological networks by creating a multilayer graph~\cite{Pilosof_2015, Lurgi_2020, Hutchinson2019}, which maps trophic and non-trophic relationships to separate layers. It was known, however, that some interactions do not fit into this picture, as they connect more than two vertices. Such higher-order interactions were represented in hypergraphs~\cite{GOLUBSKI2016344, Mayfield2017}, that generalise the notion of an edge to a set of \gdel{an} arbitrarily many vertices. It \gdel{seems also} \gadd{also seems} natural to include the information about affecting and affected entities that brings us to the notion of a dihypergraph. In our considerations, we go one step further, adding these non-trophic interactions as diuberedges, namely dihyperedges pointing from the influencing vertices/edges to the impacted food web flows. %In ecosystems considered in this paper we consider they contain at least one vertex and exactly one edge. 
%\mat{part to add: directions/signs and weights}
Unweighted ubergraphs were first introduced in \cite{Joslyn2017UbergraphsAD}. A special case of weighted diubergraph, which constitutes the main topic of this paper, is known as the metabolic graph and describes reactions modified by enhancers/inhibitors~\cite{Metabolic_graphs_McQuade}. The same system has been modeled as a Petri net with catalysts~\cite{Baez_2019_catalysts}. 
%\adel{The treatment of weights and directions is analogous to the metabolic graphs of chemical reactions modified by enhancers/inhibitors~\cite{Metabolic_graphs_McQuade}. Metabolic graphs are special cases of weighted diubergraphs presented here.}

A description based on ubergraphs becomes most natural when we attempt to associate the equations determining ecosystem dynamics with a graph-like structure of the underlying interactions. In all ecological models, some structure of interactions is assumed \aadd{and the final description draws from dynamical properties and the internal network structure}. Therefore, the notion of an ubergraph remains appropriate, \gdel{independently} \gadd{regardless} of whether one employs differential, difference equations, or an individual-based model\adel{, or even distinguish life stages in populations}. For clarity, we describe the case of an ordinary differential equation.

\adel{The biomass changes are physically possible through the food web flows, which can be identified as terms on the right hand side of the equations. Each term appears twice - for one vertex (target) with a plus sign, and for another (source) with a minus sign. Their functional dependence on vertices other than the source and the target is mapped to the added edges connecting vertices and the physical flows.}

%\adel{Even if other variables and groups of organisms change the value of a physical flow, it has one source and one target at a given time. Combining the physical accuracy of food web flows and the functional impact of non-trophic interactions in an ubergraph we do not lose quantitative information and distinction between types of interactions while making space for higher-order interactions. } %edit later, shorter sentences

We propose weighted and directed ubergraphs as a framework to represent all ecological interactions by a graph-like structure. In a particular application, a modeller firstly maps a phenomenon to an ubergraph and, as the next step, chooses \gadd{an} appropriate dynamical model that reflects \gadd{the} existing ubergraph structure. We also show how an existing dynamical model can be translated to an ubergraph, so that one-to-one \gdel{representation} \gadd{correspondence} is built. \aadd{The article is organised as follows. In Section \ref{sec:graph_theo} we introduce known notions of weights, multilayer digraphs and weighted dihypergraphs (resp. Subsections \ref{sec:m_graph} and \ref{sec:H_graph}) as well as \gdel{propose} \gadd{introduce} weighted diubergraph (Subsection \ref{sec:U_graph}) together with its Levy representation (Section \ref{sec:inc_U_graph}). Then, in Section \ref{sec:weights}, we elaborate on possible interpretations of ubergraph in the context of ecological modeling, and in Section \ref{sec:measures} we generalise popular graph measures into the case of \gadd{an} ubergraph. In the one but last part of this paper (Section \ref{sec:real_exam}) we consider a few ecological networks in which \gadd{the} application of new methodology gives a better insight into \gadd{the} ecosystem's properties. Final remarks can be found in Section \ref{sec:final}}

We discuss the ecological modelling procedure that starts by defining the phenomena and ecological interactions of interest. They are mapped to a network and finally to equations. We also describe a reciprocal procedure, mapping equations to an ubergraph.

\section{Graph theory toolbox}\label{sec:graph_theo}
Graphs \aadd{can be interpreted as} portraits of interactions \aadd{between certain species' characteristics (number of individuals/densities) encoded in} \adel{within} a set $V$ of vertices \aadd{and the relation between them given by edges}. Each interaction is \aadd{then} represented by a \aadd{pair of sets, each being a} subset of vertices' set, called an edge. In the simplest case \aadd{each of the mentioned sets} consists of \aadd{only one}\adel{just two vertices}\aadd{vertex}. Hypergraphs allow an edge to consist of an arbitrary number of vertices. This makes them able to represent higher-order, or non-pairwise interactions that are known to exist in nature. A vertex could also influence an interaction between other vertices. To be able to describe such cases without loss of information about \gadd{the} roles of interaction\gdel{'s} participants a yet more general structure has been proposed. \aadd{The definition of di }ubergraphs, \aadd{introduced in this section,} allows an edge to be a nested set, containing both vertices as well as other edges. \adel{Every edge can carry additional information about the direction of influence by marking a vertex to be its source and another, its target.} The strength of \gadd{an} interaction is quantified as a real weight assigned by a map $\phi$.

In this section, we \gdel{present first} first present a basic definition of \gadd{a} multilayer weighted digraph in a form that clearly suggests its possible generalisations. Then we smoothly proceed to the notions of \gadd{a} weighted diubergraph using a weighted dihypergraph as an intermediate step. According to our best knowledge, \gadd{a} diubergraph was presented only in \gadd{an} unweighed and undirected framework, \cite{Joslyn2017UbergraphsAD}, so we summarise \gadd{the} natural properties of this newly defined object and set it in the context of the recent advances of network theory. \adel{Finally, we specify how to relate weighted diubergraphs with ecographs which is the main scope of this research.} 

\subsection{Weighted multilayer digraph}\label{sec:m_graph}
Let us change the classical definition of weighted  digraph $\mG = (V,E,\Phi)$, \cite[Sec.~2.1]{KivArena2014}, into one that is slightly more complicated, but allows for easy generalisation. Let us denote by $\mathcal{P}^*(\cdot)$ a power set in which \gdel{an} \gadd{the} empty set is excluded.
%\mat{I have a feeling that it risks confusing the reader at the very beginning - at worst losing his interest in reading further. If we would like to keep this insightful version of digraph definition, we could start from the gently built diubergraph definition and then show that digraphs are a special case, satisfying the equation (1). After we agree on the general order of presentation I will also try making it all easier for general readers.}
%\begin{definition}%[Weighted digraph]
%    \label{def:WeightedDigraph}
%     \aadd{\textbf{A weighted multilayer digraph} is an ordered tuple $\mG= (V,L,V_L,\EG,\phi)$ where}
 %   \begin{enumerate}
 %       \item \aadd{$V = \{v_i\; | \; i \in I\}$, $|I|=n$, is a set of vertices;}
 %       \item \aadd{$L=\{L_j\; | \; j \in J\}$, $|J|=d$, is a set of layers;}
 %       \item \aadd{$V_L \subset L\times V$ is a set of layer-vertex pairs; }
 %       \item \aadd{$E = \{e_k\; | \; k \in K\}\subseteq \mathcal{P}^*(V_L) \times \mathcal{P}^*(V_L)$, $|K|=m$,   such that}
 %   \begin{equation}\label{eq:edge}
 %       \aadd{\forall_{(E_{in},E_{out})\in E}\,\,|E_{in}|=|E_{out}|=1,}
 %       \end{equation}
 %       \aadd{is a set of edges;}
 %       \item \aadd{function $\phi: E \xrightarrow{} \mathbb{R}$ assigns a weight to each edge.}
 %$   \end{enumerate} 
%\end{definition}

\begin{definition}%[Weighted digraph]
    \label{def:WeightedDigraph}
     \textbf{A weighted digraph} is an ordered tuple $\mG= (V,E, \Phi)$ where
    \begin{enumerate}
        \item $V = \{v_i\; | \; i \in I\}$, $|I|=n$, is a set of vertices;
        \item $E = \{(e_k^{\tin},e_k^{\out})\; | \; k \in K\}\subseteq \mathcal{P}^*(V) \times \mathcal{P}^*(V)$, $|K|=m$, \gadd{is a set of edges} such that \gdel{for any} \gadd{each} $e=(e^{\tin},e^{\out})\in E$ \gadd{satisfies}
    \begin{equation}\label{eq:edge}
        |e^{\tin}|=|e^{\out}|=1,
        \end{equation}
        \gdel{is a set of edges;}
        \item $\Phi=\text{diag}(\phi(e):\,e\in E)$ is a weight matrix, while $\phi: E \xrightarrow{} \mathbb{R}$ is a weight function.
    \end{enumerate} 
    We say that a weighted digraph $\mathcal{G}$ is \textbf{multilayer} if there exists a partition of V into a family of nonempty subsets $L=\{L_j\subset V\; | \; j \in J\}$. We write $\mG_L= (V,L, E,\Phi)$ and we call $L$ a \textbf{set of layers} of cardinality $d=|J|$ and $d_j=|L_j|$ is number of vertices in layer $L_j$, $j\in J$.
\end{definition}

Note that no vertex can belong to more than one layer in this approach. According to standard nomenclature, it is a special type of multilayer digraph called \textbf{layer-disjoint}. It is also equivalent to explicitly treating the instances of a vertex in different layers as different vertices in any multilayer digraph. If the graph in question consists of just one layer, we call it a weighted digraph and denote by $\mG= (V,\EG,\Phi)$.

An edge $(e^{\tin},e^{\out})\in E$ represents a connection from its head $e^{\tin}$ to its tail $e^{\out}$. Following standard definitions, edges that stay within a single layer are called \textbf{intra-layer}, while those \gdel{which} cross layers are called \textbf{inter-layer} edges. \textcolor{red}{Consequently, we define an intra-layer graph, an inter-layer graph, and a coupling graph. }
\al{To be elaborated if needed}

Now let us define basic matrices that characterise the network. Let $\mathcal{A}^{\tin}:V\times V\rightarrow \left\{0,1\right\}$ be an \textbf{adjacency matrix}, namely for $\mathcal{A}^{\tin}=(\mathcal{A}^{\tin}_{i,j})_{i,j\in J}$ we have \gok{what is J in the subscript? Also $\left\{0,1\right\}$ should be $\mathbb{R}$}
\begin{equation}\label{eq:adjacency}
\mathcal{A}^{\tin}_{ij}=\left\{\begin{array}{cc}
\phi(e)&\text{for }e=(v_j, v_i)\in E,\\
0&\text{otherwise.}\end{array}\right.
\end{equation}
\textbf{Incidence matrices} $\inci, \inco: E \times V \rightarrow \left\{0,1\right\}$ offer an alternative definition of digraph interactions. They state which vertex is a tail/head of which edge.
\begin{multicols}{2}
\begin{equation}\label{eq:I_in_bin}
    \inci_{ij}=\begin{cases}
        1, \quad \text{if} \quad v_{j} \in e_{i}^{\mathrm{in}}\\
        0, \quad \text{otherwise}.
    \end{cases}
\end{equation}
\break
\begin{equation}\label{eq:I_out_bin}
    \inco_{ij}=\begin{cases}
        1, \quad \text{if} \quad v_{j} \in e_{i}^{\mathrm{out}} \\
        0, \quad \text{otherwise}.
    \end{cases}
\end{equation}
\end{multicols}

Based on \cite[Eq.~2.7]{Mugnolo2013}, the adjacency and incidence matrices are connected by the relation
\begin{equation}\label{eq:adj_and_inc}
\mathcal{A}^{\tin}=(\inco)^T \Phi \inci,
\end{equation}
where $\Phi$ is a weight matrix.

\subsection{Weighted multilayer dihypergraph}\label{sec:H_graph}
One can also allow each edge to have more than one head and one tail. A \textbf{weighted multilayer dihypergraph} $\mH_L = (V,L,\EH,\Phi)$ satisfies all conditions of Definition \ref{def:WeightedDigraph} modifying \eqref{eq:edge} with 
\begin{equation}\label{eq:edge2}
        |e^{\tin}|,|e^{\out}|\geq 1.
        \end{equation}
In order to distinguish elements from a set $\EG$ from those in $\EH$ we call the latter \textbf{hyperedges}. This notion has been already used in ecological context in the undirected version, see \cite{Bretto2013}.

Let us summarise standard objects defined for dihypergraphs that will be generalised in the next subsection. Unlike in a digraph, there may be several different hyperedges all containing the same vertex $v_i$ as a head and the same $v_j$ as a tail. Thus, there is no one-to-one correspondence between a dihypergraph and its adjacency matrix $\mathcal{A}^{\tin}=(\mathcal{A}_{ij}^{\tin})_{i,j\in I}$~\cite{BATTISTON20201}, defined as the extension of definition in \eqref{eq:adjacency} to a hypergraph. 
The incidence matrices~\eqref{eq:I_in_bin}--\eqref{eq:I_out_bin} generalise naturally to hypergraphs. In directed hypergraphs so does their relation with the adjacency matrix~\eqref{eq:adjacency} as well as the relation in \eqref{eq:adj_and_inc}. %\adel{In undirected (hyper)graphs one could exit an edge towards any of its ends, which necessitated subtraction of edge degrees from the diagonal of the incidence matrix product.} 
The hypergraph literature contains proposals of other generalisations, e.g. an adjacency tensor \cite{Michoel2012}, a degree normalized k-adjacency tensor \cite{COOPER2012}, an eigenvalues normalized k-adjacency tensor \cite{Hu2013} etc. %\adel{To avoid this ambiguity, \aadd{if only it is possible}, we use the notation related to \emph{in- and out-incidence matrices} $\mathcal{I}^{\tin}, \mathcal{I}^{\out}$, defined as the extension of definitions in \eqref{eq:I_in}-\eqref{eq:I_out} into a hypergraph, that uniquely determines it.}

\subsection{Diubergraph}\label{sec:U_graph}

The final step of digraph generalisation allows an edge to join any number of objects that can be vertices as well as other edges. The new recursive definition of sets $e^{\tin}$, $e^{\out}$ in Def. \ref{def:WeightedDigraph} creates an ubergraph, introduced in its unweighted form in \cite{Joslyn2017UbergraphsAD}. We generalise it to a weighted diubergraph and examine its basic properties. This requires a modification to the definition of the incidence (Levi) graph in order to capture the whole information about the original ubergraph directions.

Given a set of vertices $V$, we introduce a series $(P_k(V))_{k\in \NN}$ recursively 
%\begin{equation}\label{eq:P sets}
%       P_0(V) = V, \quad P_{k}(V) =\mathcal{P}^* \left( \bigcup_{i=0}^{k-1} P_i(V) \right), \quad k\geq 1.
%\end{equation}
\begin{equation}
       P_0(V) = V, \quad P_{k}(V) =\mathcal{P}^* \left( \bigcup_{i=0}^{k-1} P_i(V)\right) \times \mathcal{P}^* \left(\bigcup_{i=0}^{k-1} P_i(V)\right) , \quad k\geq 1.
\end{equation}
 $P_k(V)$ is a set of all ordered pairs of elements belonging to $\mathcal{P}^* \left( \bigcup_{i=0}^{k-1} P_i(V)\right)$. $P_k(V)$ contains thus ordered pairs of any subset of elements already present in the former series elements. We correct the definition of \cite{Joslyn2017UbergraphsAD} where $P_0$ was inconsistent with the recursive formula.

\begin{definition} 
\label{def:weighted_diubergraph}
\textbf{A \mdel{weighted} $k$-depth diubergraph}, for $k\geq 1$, is an ordered \madd{tuple} $\mU= (V,\EU\mdel{,\Phi})$ where
    \begin{enumerate}
        \item $V = \{v_i\; | \; i \in I\}$, $|I|=n$, is a set of \textbf{fundamental vertices};
        \item $E_{\mU} = \{e_j =(e_{j}^{\tin},e_{j}^{\out}) \; | \; j \in K\}\subseteq P_{k}(V)$, is a set of \textbf{diuberedges} such that heads and tails of all diuberedges contain fundamental vertices or other diuberedges, namely
        \begin{equation}\label{eq:uEdge}
         \forall_{(e^{\tin},\, e^{\out}) \in \EU} \quad e^{\tin},\, e^{\out}  \subset V \cup \EU.  
        \end{equation}
        %\begin{equation}\label{eq:uEdge}
        %\aadd{\forall_{(e^{\mathrm{out}},e^{\mathrm{in}})\in \EU}\,\forall_{x\in\{\mathrm{out,in}\}}\forall_{u\in e^{\mathrm{x}}\setminus V}\,\,u\in E. }
        %\end{equation}
        
        %\begin{equation}
        % \gadd{ \forall (e^{\mathrm{out}},e^{\mathrm{in}}) \in \EU, e^{\mathrm{out}},e^{\mathrm{in}}  \in V \cup \EU.}   
        %\end{equation}
        
        
        
    \end{enumerate} 
\end{definition} 

\mdel{$\Phi=\text{diag}(\phi(e):\,e\in E)$ is a weight matrix, while $\phi: E \xrightarrow{} \mathbb{R}$ is a weight function}

%\gok{I am confused about above definition, in particular \ref{eq:uEdge} and \ref{eq:U_ver}. Therefore, I suggest to consider an example. Let $V=\{ 1,2,3,4\}$ be set of fundamental vertices and $E_{\mU}=\{ e_1 = (\{1\},\{2\}), e_2 = (\{3\},\{4\} ), e_3 =(\{1\}, e_2 ), e_4 =( e_1 , e_2 ), e_5 = (\{1\},\{3,4\}) \} $ be the set of diuberedges. Firstly, notice that $e_3 =(\{1\}, (3,4) )$ is different from $e_5 =(\{1\},\{3,4\})$ since $e_3$ is depth-2 diuberedge whereas $e_5$ is a depth-1 diuberedge. Note also that the expression $E_{\mU} = \{e_j =(e_{j}^{\out},e_{j}^{\tin}) \; | \; j \in K\}\subseteq P_{k}(V) \times P_{k}(V)$ is not true since $e_{3}^{\tin}=e_2 \notin P_{2}(V)$. Therefore, I suggest}
%\madd{We have changed the definition. Now $e_2 \in P_{1}(V)$, so $e_{3} \in P_2(V)$.}
%\gok{$E_{\mU} = \{e_j =(e_{j}^{\out},e_{j}^{\tin}) \; | \; j \in K\}$, is a set of \textbf{diuberedges} such that heads "$e_{j}^{\out} $" and tails "$e_{j}^{\tin} $" of all diuberedges are either a subset of fundamental vertices or another diuberedge, namely}
%\gok{\begin{equation}
         %\forall_{(e^{\mathrm{out}},\, e^{\mathrm{in}}) \in \EU} \quad e^{\mathrm{out}},\, e^{\mathrm{in}}  \subset V \ \text{or} \ e^{\mathrm{out}},\, e^{\mathrm{in}} \in \EU.  
        %\end{equation}}
%\gok{Moreover, I think the following definition of set of vertices is better:
%\begin{equation}
%    V_{\mU}:=V\cup \{ e_j \in E_{\mU} : \exists e=(e^{\out},e^{\tin}) \in E_{\mU} ; \ e \neq e_j , \ e_j =e^{\out} \text{or} \ e_j =e^{\tin} \}  
%\end{equation}}

Condition \eqref{eq:uEdge} ensures that heads and tails of any element from $E_{\mU}$ are included either in the set of uberedges $E_{\mU}$ or in the set of fundamental vertices $V$. Let us consider the example which visualises the construction of uberedges.
\al{we consider choosing an easier example}
\begin{exam}
Consider $\mU=(V,\EU)$ such that $V=\{ 1,2,3,4\}$ is a set of fundamental vertices, 
\begin{eqnarray*}
E_{\mU}=\left\{ e_1 = (\{1\},\{2\}), e_2 = (\{3\},\{4\} ), e_3 =(\{1\}, \{e_2\} ), e_4 =( \{e_1\} , \{e_2\} ),\right. \\
\left.e_5 = (\{ 1\},\{4,e_2\}),e_6=(\{1\}, (\{2\},\{3\})\right\}
\end{eqnarray*} 
is a set of diuberedges.
Notice that in this case we have
$$
e_1, e_2 \in P_1(V),\qquad e_3, e_4, e_5, e_6\in P_2(V). 
$$
Furthermore $\{1\},\{2\},\{3\},\{4\}, e_1 , e_2, \{4,e_2\} \in V \cup \EU $, but $ (\{2\},\{3\})\notin V \cup \EU $ hence $\mU$ is not well-defined. Considering $\mU'=(V,\EU \setminus \{e_6\},\Phi)$, $\mathcal{U}'$ is $2$-depth diubergraph. Both $\mathcal{U}$ and $\mathcal{U}'$ are presented in the Figure xx. 
\end{exam}
\al{Figure xx to be added.}


Based on Definition \ref{def:weighted_diubergraph} we easily note that a $1$-depth diubergraph is a dihypergraph. All hyperedges can only contain vertices hence condition \ref{eq:uEdge} is always satisfied. \madd{A digraph also} is a $1$-depth diubergraph.

Uberedges that become heads or tails of others begin to play a role akin to vertices, influencing others or being influenced. At the same time, those that are not part of another, are just carriers of such influences. This leads us to define the set of vertices excluding such carriers from a set of $V\cup E$,
\begin{eqnarray}\label{eq:U_ver}
%V_{\mU}:=V\cup E_{\mU}\setminus \left\{v\in P_1(V):\quad \forall_{e\in E_{\mU}}\,\,v\notin e^{\mathrm{out}}\cup e^{\mathrm{in}}\right\}.%\\
V_{\mU}:=V\cup E_{\mU}\setminus \left\{v\in V\cup E_{\mU}:\quad \forall_{e\in E_{\mU}}\,\,v\notin e^{\mathrm{out}}\cup e^{\mathrm{in}}\right\}.
\end{eqnarray}
\aadd{The elements of a set $V_{\mU}$ we call vertices.}

On the other hand if we wish to specify the set of uberedges that compromise a generalisation of a classical edge either due to its definition (their heads/tails consist of edges itself) or the character of other edges defined on them
(they are begining/end of another hyperedge) we have 
\begin{eqnarray}\label{eq:U_edge}
V_{\mU}':=V\cup E_{\mU}\setminus \left\{v\in P_1(V):\quad \forall_{e\in E_{\mU}}\,\,v\notin e^{\mathrm{out}}\cup e^{\mathrm{in}}\right\}.%\\
%V_{\mU}:=V\cup E_{\mU}\setminus \left\{v\in V\cup E_{\mU}:\quad \forall_{e\in E_{\mU}}\,\,v\notin e^{\mathrm{out}}\cup e^{\mathrm{in}}\right\}.
\end{eqnarray}
In general $V\subseteq V_{\mU}\subseteq V_{\mU}'$. It turns out however that $V_{\mU}'$ is useful in generalising further objects for ubergraphs as the largest set such that in the case of hypergraph the sets of vertices, fundamental vertices and $V_{\mU}'$ coincide $V_{\mU}=V=V_{\mU}'$.

%For $k>0$ more variable uberedges may appear.
%\begin{plain}
%Consider 1-depth diubergraph $\mU= %(V,\EU,\phi)$ such that
%\begin{equation}
%V=\{v_1,v_2,v_3\}; \qquad \EU=P_2(V)\times P_2(V); \qquad \forall_{e\in E}\,\,\phi(e)=1.
%\end{equation}
%\end{plain}

Similarly to the hypergraph case we can define an adjacency matrix of an ubergraph 
\begin{equation}
\mathcal{A}^{\tin}\,\, \text{being an extension the formula in \eqref{eq:adjacency} into a set}\,\, V_{\mU}'.
\end{equation}
It is then consistent with definition for digraph but still does not give one-to-one correspondence like in the case of dihypergraph.

\subsection{Categories of edges - order, depth and class}

\madd{Uberedges represent different types of interactions. Quantities associated with distinct interactions generally have distinct units. The way they would involve quantities (stocks, flows etc.) of their constituents would also be different.} 

\madd{The nature of an uberedge is clearly influenced by the number of fundamental objects involved in an interaction (its \emph{order}), as well as how indirect is this involvement (its \emph{depth}). Finally, we define the exact way they are involved as \emph{class}, the most narrow category. This whole design relies on the assumption that fundamental vertices are objects of the same kind.}

Each uberedge can be explicitly written as a nested ordered set of fundamental vertices from $V$. We call it a \emph{fundamental form of an uberedge}, and denote as $e(V)$. It helps understanding and visualising the concepts of order, depth and class. 

\begin{definition}
    The \textbf{order} of an uberedge is the number of times fundamental vertices are involved in it, or its cardinality as a nested ordered set of fundamental vertices,
    \begin{equation}
        \#e=|e|.
    \end{equation}  
    The \textbf{depth} of an uberedge says how nested it is,
    \begin{equation}
        D(e)=\text{min}({k \in \mathbb{N}: e\in P_k(V)})
    \end{equation}
    The \textbf{class} of an uberedge identifies the exact way it composes the fundamental elements, and is the orbit of this composition under any permutation of fundamental vertices, 
    \begin{equation}
        [e]=P_{|V|}V(e),
    \end{equation}
    where $P_{|V|}$ is the general permutation group of fundamental vertices, and $P_{|V|}V$ is its orbit.
\end{definition}

\begin{exam}
    Let $V=\{v_1, v_2,v_3\}$, $e_1=(\left\{v_1\right\},\left\{v_2\right\})$ and $e_2=(\left\{v_3\right\},\left\{e_1\right\})$. 
    Then, $e_2(V)=(v_3, (v_1, v_2))$. Its order $\#e_2=3$. Its depth $D(e_2)=2$. 
    Its class 
    \begin{align}
        [e_2]\equiv (\{.\},(\{.\},\{.\}))\equiv (.,(.,.))=&
        \{(v_1, (v_1, v_1)), (v_2, (v_2, v_2)),(v_3, (v_3, v_3)), \\ 
        &(v_1, (v_2, v_2)),(v_1, (v_3, v_3)),  (v_1, (v_2, v_3)), \\
        &(v_1, (v_3, v_2)), (v_2, (v_1, v_3)),(v_2, (v_3, v_1)), \\
        &(v_3, (v_1, v_1)),(v_3, (v_2, v_1))\}.
    \end{align}
\end{exam}


In particular $1$-depth uberedges are hyperedges in classical sense.

\madd{
\begin{prop}
The depth of an uberedge depends only on the largest depth among its constituents, specifically
    \begin{equation}
        D((e^{\tin},\, e^{\out}))=\text{max}(\{D(e): e \in e^{\tin}\cup e^{\out} \} )+1.
    \end{equation}
\end{prop}
}

\subsection{Incidence digraph representation of a weighted diubergraph}\label{sec:inc_U_graph}

The considerations above show that ubergraph's concept is a natural generalisation of digraph. It is also the structure we immediately imagine when we think of vertices impacting processes (edges) rather than vertices themselves. Now we show that the above idea can also be represented through its incidence (Levi~\cite{Levi}) digraph. In order to visualise the transformation of ubergraph into its incidence digraph let us imagine that we add a vertex in the middle of every uberedge, to represent it. The set of fundamental vertices $V$ and the set of uberedges $\EU$ become the new vertex set $V \cup \EU$. The relation of being a head/tail of an uberedge translates into existence of a digraph edge leading to or from the vertex in question. \madd{Formally, an edge $e=(e^\tin, e^\out)$ becomes a generalised vertex connected by sets of Levi graph edges $\{(e',e), e' \in e^\tin \}$ and $\{(e,e''), e'' \in e^\out \}$.}

\begin{definition}\label{uber_levi_graph}
    A digraph incidence representation (or a Levy digraph) of a $k$-depth ubergraph $\mathcal{U}=(V, \EU \mdel{, \Phi})$ is a multilayer digraph $\mathcal{G}_{\mathcal{U}}=(V \cup \EU, L, E'\mdel{,\Phi'})$, $|L|=k+1$, where for any $v, w \in V \cup \EU$:
    \begin{enumerate}
        \item $v \in L_{D(v)}$
        \item $(v,w) \in E'$ if either $v \in w^{\mathrm{in}}$ or $w \in v^{\mathrm{out}}$.
    \end{enumerate} 
 
\end{definition}
\mdel{$\phi'(v,w)=
             \phi(w)\text{for }v\in w^{\mathrm{in}}, 
             \phi(v)\text{for }w \in v^{\mathrm{out}}. $}

\madd{We define diubergraph incidence matrices $\inci, \inco: (V \cup \EU)^2 \rightarrow \{0,1\}$ as adjacency matrices of its Levi graph:}
\madd{
\begin{multicols}{2}
\begin{equation}\label{eq:I_in}
    \inci_{ij}=\begin{cases}
        1, \quad \text{if} \quad v_{j} \in v_{i}^{\mathrm{in}}\\
        0, \quad \text{otherwise}.
    \end{cases}
\end{equation}
\break
\begin{equation}\label{eq:I_out}
    \inco_{ij}=\begin{cases}
        1, \quad \text{if} \quad v_{j} \in v_{i}^{\mathrm{out}} \\
        0, \quad \text{otherwise}.
    \end{cases}
\end{equation}
\end{multicols}
}

\begin{exam}
\al{add mathematical example} 
\end{exam}

\begin{prop}
There exists one-to-one correspondence between ubergraph and its Levy representation.
\end{prop}
 
Introduction of layers into the Levy graph is crucial to obtain the unique representation. \madd{Without means to identify fundamental vertices $V$, a Levi graph could correspond to many ubergraphs. What are the constraints on them?}

\madd{
\begin{prop}
             All Levi graph vertices with zero in-degree or out-degree are ubergraph's fundamental vertices, and no two fundamental vertices are neighbours.       
\end{prop}
}

\begin{proof}
 By definition, every uberedge is an ordered pair of subsets of ubergraph objects $e=(e^\tin, e^\out)$. Thus, its incidence representation contains an edge $(e',e): e' \in e^\tin$ and an edge $(e,e''): e'' \in e^\out$. Therefore all generalised vertices that are not fundamental have non-zero in- and out-degrees.
 
 Every Levi graph is bipartite. A Levi graph edge connecting two fundamental vertices would imply that one contains another, i.e. is an uberedge and not a fundamental vertex. 
\end{proof}

Let us consider an example of such digraph $\mathcal{G}$ that no matter how do we assign layers to the set of vertices, the resulting object does not correspond to any ubergraph.

\begin{exam}
\al{add mathematical example} 
\end{exam}

The relevant question arrises: what is the group of digraphs for which there exists the division into layers such that the network corresponds to some unique ubergraph.

\begin{prop}

\end{prop}

An example of a diubergraph and its incidence graph is shown in Fig.~\ref{fig:PASB_ubergraph_incidence_graph}.

\begin{figure}[h!]
	\begin{center}
        \subfloat{\includegraphics[width=0.4\linewidth]{./fig/Azteca_example/4_node_Azteca_v_labels.png}
		}
        \subfloat{\includegraphics[width=0.5\linewidth]{./fig/Azteca_example/incidence_4_node_Azteca.png}}
        \caption{A 4-node subgraph of the coffee agroecosystem model of \cite{GOLUBSKI2016344} (left) and its incidence digraph representation (right). Nodes $\Ph$, $\A$, $\Sc$, $\B$ represent Phorid, Azteca, Scale and Beetle of the original article. Colours map the incidence graph layers, identical to the depth of respective uberedges, and match those used in the original paper. Fundamental vertices (zero-depth) are green, one-depth edges are black, two-depth two are blue and the three-depth edge is red.} 
    	\label{fig:PASB_ubergraph_incidence_graph}
    \end{center}
    \end{figure}
    
Fig.\ref{fig:PASB_ubergraph_incidence_graph} shows an example of an ubergraph and its digraph incidence representation. The incidence graph is $k+1$-partite and does not contain intra-layer edges. Deeper layers contain higher order interactions which are expected to be weaker than  a direct one. Furthermore, the direction of a path represents the direction of the interaction. Further sections describe various graph measures expressed for ubergraphs as well as their incidence digraph representations to learn which is simple in particular application.





\section{Weights and how to combine them}\label{sec:weights}

\madd{Weights associated with elements of graphs encode quantitative information about the real-world system. First, we use the duality between ubergraphs and their incidence representation to define weights in ubergraphs. Then we follow the formulas proposed for interaction modifications in ecology and chemistry, defining how to combine effects of higher-order interactions.}

\madd{The duality between ubergraphs and their incidence representation leads to dual definitions of concepts such as weights and graph measures. These dual "adjacency" and "incidence" versions have already been noted for hypergraphs~\cite{Kapoor2013}. Importantly, while the incidence matrix contains the whole information about relations in an ubergraph, the adjacency matrix offers only an aggregate. Thus, it is not surprising that also the natural definition of weights in incidence picture is more general than one emerging in adjacency picture.}

\madd{Let us quantify the roles vertices play in the interactions they are part of by assigning weights to edges of the Levi graph. It is equivalent to introducing non-negative real-valued incidence matrices $\widetilde{\inci}, \widetilde{\inco}: (V \cup \EU)^2 \rightarrow \mathbb{R}$:}

\madd{
\begin{multicols}{2}
\begin{equation}\label{eq:I_in_real}
    \widetilde{\inci}_{ij}=\begin{cases}
        \widetilde{\inci}_{ij} \in \mathbb{R}, \quad \text{if} \quad v_{j} \in v_{i}^{\mathrm{in}}\\
        0, \quad \text{otherwise}.
    \end{cases}
\end{equation}
\break
\begin{equation}\label{eq:I_out_real}
    \widetilde{\inco}_{ij}=\begin{cases}
        \widetilde{\inco}_{ij} \in \mathbb{R}, \quad \text{if} \quad v_{j} \in v_{i}^{\mathrm{out}} \\
        0, \quad \text{otherwise}.
    \end{cases}
\end{equation}
\end{multicols}
}


\madd{This approach is more general. It is necessary to represent the coffee agroecosystem mutualistic network as well as in cases with multiple tail vertices contributing unequally to the interaction the impact of which is then again unequally split among the heads, e.g. for an uberedge $(\{v_1,v_2\} \{v_3,v_4\})$. In Sec.~\ref{sec:other_structures} we shall see that this approach also makes Petri nets a special case of weighted diubergraphs.}

The adjacency matrix defined through~\ref{eq:adj_and_inc} combines these weights into an aggregate measure of the strength of influence of one vertex on another over all existing uberedges,
\begin{equation}\label{eq:uberadjacency}
(\mathcal{A}^{\tin})_{ij}=((\inco)^T  \inci_{ij})=(\sum_{k}\inco_{kl}\inci_{km})\delta_{il}\delta_{jm}=\sum_{k}\inco_{ki}\inci_{kj}.
\end{equation}
For a digraph edge $e_0=(v_1,v_2)$ its standard digraph weight $A_{21}=\phi_{v_2 v_1}=\inco_{02}\inci_{01}$.

\madd{One could also define an aggregate weight of each uberedge in a manner consistent with~\ref{eq:uberadjacency}. The contributions from nodes belonging to the same uberedge are added,}
\begin{equation}\label{eq:uberweight}
    \Phi_{e_k}=(\sum_{v_i\in e_k^{\out}}\inco_{ki})(\sum_{v_j\in e^{\tin}_k}\inci_{kj}).
\end{equation} 


These dual possibilities are illustrated in Fig.~\ref{fig:weights_adjacency_incidence}.
\begin{figure}[h!]
	\begin{center}
        \subfloat{\includegraphics[width=0.4\linewidth]{./fig/Weight_adjacency.png}
		}
  \hfill
        \subfloat{\includegraphics[width=0.4\linewidth]{./fig/Weight_incidence.png}}
        \caption{An example of a 4-vertex uberedge and weights associated with it in adjacency- and incidence-based approach.} 
    	\label{fig:weights_adjacency_incidence}
    \end{center}
    \end{figure}



\subsection{Walks and effective weights}

\madd{Network analysis relies on combining edges, weights and studying walks. Walks are straightforward in digraphs, but uberedges differ by order, depth and class. Thus, the way of traversing the ubergraph and combining weights depends on the particular model and property being studied.}

\madd{The duality between ubergraphs and their incidence representation leads to two main frameworks of ubergraph traversal. One is rooted in adjacency of fundamental vertices, and the other in their incidence with interactions.}

\madd{The proposed ways to traverse ubergraph suit transport (stock and flow) networks, chemical reaction networks and ecosystems. In these networks the deeper interactions modify flow rates, but do not result in any transfer or transformation of matter themselves. In ecosystems the 1-depth edges constitute a food web, while higher-order interactions impact its flows or biomasses in vertices.}

\madd{
The observed flow rates are the focus of the transport/movement walks. They offer an interface with traditional measures on these networks. Causal walks trace the influence of vertices and interactions also through deeper edges.}

\subsubsection{Causal walks - incidence picture}
\madd{Causal walks follow the influence in ubergraphs through standard walks over their Levi graphs.}

\begin{definition}\label{def:transport_walk}
    A \textbf{causal walk} of length $l$ in an ubergraph $(V,\EU)$ is a sequence $L=(v, e_{1},e_{2}, \ldots,e_{l}, w)$:
\begin{enumerate}
    \item $v,w \in V$, and $\{ e_{1},e_{2}, \ldots,e_{l} \} \subset V \cup \EU$,
    \item $v \in e_1^{\tin}$, $w \in e_l^{\out}$, $\forall_{i \in \{1,\ldots, l-1\}} \quad e_i^{\out} \cap e_{i+1}^{\tin} \neq \emptyset $.
\end{enumerate}
\end{definition}

\madd{They enable a straightforward generalisation of standard graph measures to ubergraphs. In effect, the incidence matrices become the basic tool to compute e.g. centralities in ubergraphs.}

%\madd{A modification of an interaction impacts all actors involved in the interaction. This forces a careful treatment of uberedge directions when studying how influence spreads in the network.}

%\madd{
%Two extreme solutions - to neglect all directions when studying indirect influences, or to take into account all directions - lead to loss of information and possibly wrong interpretation of vertex roles in the system. By neglect of directions we forget who is the source of modification. By complete reliance on directions we forget about the tails of all modified interactions, who were impacted by the modification as well as the heads.}

%\madd{An interaction modification impacts also the source of the interaction in question. But further, it impacts only ubergraph objects that this source points towards, not the ones that modify the source. We define a \emph{causal walk} tracing the influence of a modifier by following the direction of modifications, and neglecting the directions of modified interactions. This means that after following the direction, we can go against it. After one went against the direction, the next step though has to follow edge direction.
%}
%\begin{definition}\label{def:causal_walk}
 %   A \textbf{causal walk} of length $l$ in an ubergraph $(V,\EU)$ is a sequence $L=(e_0, e_{1},e_{2}, \ldots,e_{l}, e_{l+1})$:
%\begin{enumerate}
    %\item $\{e_0, e_{1}, \ldots,e_{l+1} \} \subset V \cup \EU$,
  %  \item $e_0^{\out}\cap e_{1}^{\tin} \neq \emptyset $,
 %   \item $\forall_{i \in \{1,\ldots, l\}} \quad 
  %  \begin{cases}
    %    &(e_i^{\out}\cup e_i^{\tin}) \cap (e_{i+1}^{\out}\cup e_{i+1}^{\tin}) \neq \emptyset \text{, if } e_{i-1}^{\out} \cap e_{i}^{\tin} \neq \emptyset \\
    %    & e_i^{\out} \cap e_{i+1}^{\tin} \neq \emptyset \text{, if } e_{i-1}^{\out} \cap e_{i}^{\tin} = \emptyset. 
   % \end{cases}$
%\end{enumerate}
%\end{definition}


\subsubsection{Transport/movement walks - adjacency picture}
\madd{
Transport walks involve only fundamental vertices and 1-depth uberedges, i.e. classical hyperedges. They represent classical movement over a transport network or a physically viable trajectory of matter.
}
\begin{definition}\label{def:transport_walk}
    A \textbf{transport walk} of length $l$ in an ubergraph $(V,\EU)$ is a sequence $L=(v, e_{1},e_{2}, \ldots,e_{l}, w)$:
\begin{enumerate}
    \item $v,w \in V$, and $\{ e_{1},e_{2}, \ldots,e_{l} \} \subset V \cup \EU$,
    \item $v \in e_1^{\tin}$, $w \in e_l^{\out}$, $\forall_{i \in \{1,\ldots, l-1\}} \quad e_i^{\out} \cap e_{i+1}^{\tin} \neq \emptyset $,
    \item $\forall_{e \in L} \quad D(e)\leq 1$.
\end{enumerate}
\end{definition}

\madd{Such flows and walks are physically observable quantities. In designing the ubergraph framework we aim to enable the modeller to quantify both the strengths of interaction modifications as well as their observable impact. An ubergraph model allows us to portray interaction modifications, keeping information about roles of all involved actors. We can describe both the strength of an interaction in absence of any modifiers, and one that includes all present in the system. This naturally brings us to the issue of how to combine modifications.}

\madd{Quantitative modifications are defined in relative terms, so in the first approximation their effect scales with the size of the modified interaction. Such is the case e.g. of the rates of chemical reactions (see Sec.~\ref{sec:other_structures}). Two proposed models of non-trophic ecological interactions~\cite{Arditi_2005_non_trophic_rheagogies, Goudard_nontrophic_2008} have also used this principle as their basis. However, real-world interaction modifications may combine in both non-linear and non-multiplicative way~\cite{Golubski_2011_non_trophic_combining}, so the particular formula for combining the modifications will always depend on the particular applied model.}

\mdel{We aim to include higher-order interactions in a way that possible interventions made in the ubergraph (changing weights of uberedges, deletion of vertices ect.) reflect the real behaviour of the ecosystem when the environmental conditions change.}


\mat{Use the paragraph above in some better way} 

We generalize this observation to uberedges of arbitrary depth recursively.
\begin{definition}\label{def:eff_weight} 
An \textbf{effective weight} of an uberedge $e_0$, 
\begin{equation}
    \psi(e_0)=\begin{cases}
        \phi(e_0), \quad \{e: e_0 \in e^{\out}\}=\emptyset \\
        \phi(e_0) f(\{\psi(e): e_0 \in e^{\out}\}), \quad \text{otherwise},
    \end{cases}
\end{equation}
\end{definition}
where the function $f$ depends on the model, but typically is a multiplication $f(S)=\prod_{s \in S}$.

\madd{\begin{prop}
Every effective weight is well defined. 
\end{prop}    
\begin{proof} 
Let us assume otherwise, that some weights are unknown, and focus on the deepest unknown uberedge $e$. Then its defining equation would either contain only known terms, or some other unknown $\psi(e_R)$. But then $e \in e_R^{\out}$, so $D(e_R)>D(e)$, contrary to the assumption.
\end{proof}}

\madd{
Effective weights enable us to attribute quantities to whole transport walks.
}
\begin{definition}
    Given an aggregation function $g:\mathbb{R}^l \rightarrow \mathbb{R}$, a \textbf{weight of a transport walk} $L$ of length $l$, $\psi(L)=g(L)$.
\end{definition}
\madd{In a classical example the individual weights could represent transition probabilities and a natural aggregation would be to multiply them. This way, a probability of transition over the transport walk can be obtained.}


\madd{Heads of uberedges can be equipped with their vertex effective weights $\Phi$. They determine the effective influence of the uberedge on the head's particular target.}

\begin{definition}\label{def:eff_weight} 
An \textbf{effective weight} of a vertex $v_i \in e_j$, 
\begin{equation}
    \Psi_{ij}^{\text{out}}=\begin{cases}
        \inco_{ij}, \quad \{e: e_j \in e^{\out}\}=\emptyset \\
        \inco_{ij} \prod_{e_k: e_j \in e_k^{\out}} \Psi_{jk}^{\text{out}}, \quad \text{otherwise}.
    \end{cases}
\end{equation}
\end{definition}

\mat{Here a notation ambiguity - we could go with a function $V_U \times E \rightarrow \mathbb{R} $ to be more consistent instead of a weight matrix. }



\subsection{Related structures: food web, mutualistic/relational network, Petri net, metabolic graph}\label{sec:other_structures}

\madd{Network science has seen a proliferation of structures aiming to represent higher-order interactions. Some of them were very specific to a particular field of their application, e.g. chemistry. We show, that they are in fact special cases of ubergraphs, which paves the way to generalisations of results obtained in the particular fields.}



\madd{Food webs are digraphs that represent the physical foundation of ecosystems - the circulation of matter and energy between groups of organisms and non-living reservoirs, such as atmosphere. They can be viewed as stock and flow, or transport networks.}
\begin{definition}
    \textbf{A food web} is a connected weighted digraph $\mathcal{G} = (V,E,\phi)$ with $\phi: E \rightarrow \mathbb{R}_+ $. Vertices $V$ are subdivided into living, and non-living 
\begin{equation*}
    V=\{v_i: i\in J_L\} \cup \{v_i: i\in J_{nL}\}, 
\end{equation*}
where $J_L=\left\{1,\ldots,l\right\}$, $J_{nL}=\left\{l+1,\ldots,n\right\}$.
\end{definition}
One of the non-living vertices usually represents the broad environment, e.g. the atmosphere as carbon reservoir.

\madd{Manifold relations in dynamical systems do not result in a direct transport of mass. Mutualistic~\cite{Bascompte_Mutualistic_networks} and other non-trophic interaction networks in ecosystems, as well as conceptually related causal graphs~\cite{Pearl_2009, Morgan_Winship_2014} are special cases of ubergraphs. The coffee agroecosystem~\cite{GOLUBSKI2016344} is an example belonging to this category.}
\madd{These networks capture relations between variables belonging to a dynamical system, represented as vertices. The edges correspond to entries of the system's Jacobian matrix~\cite{HIGASHI_1995_ecological_interaction_networks, NAKAJIMA_1995_ecological_interaction_networks}. Bilateral relationships - edges $e_{ij}$ and $e_{ji}$ - are frequently represented through one edge with two weights at its ends. Such is the case of the coffee agroecosystem~\cite{GOLUBSKI2016344}, with edges carrying the signs of the Jacobian terms, $(+,-), (-,-), (0,+)$, etc. We denote the lack of a sign/weight as $0$.}

\madd{The real-valued incidence matrices~\eqref{eq:I_in_real} can conveniently accomodate these signed edge ends.}

\madd{These edges can also be represented through a pair of directed edges~\cite{HIGASHI_1995_ecological_interaction_networks}, from the cause to the effect (identified through the signed endpoint). If an edge carries just one sign, it corresponds to just one influence, and thus one edge.}

\begin{figure}
    \centering
    \includegraphics[width=0.7\linewidth]{fig/Minus_minus_representation.png}
    \caption{A $(-,-)$ interaction from a mutualistic network~\cite{GOLUBSKI2016344} (left), and its ubergraph representation through two edges. Each signed edge end in a mutualistic network is a separate influence, mapped to a distinct ubergraph edge.}
    \label{fig:minus_minus_rep}
\end{figure}



\madd{Multilayer ecological networks~\cite{Pilosof_2015, Hutchinson2019} supplement food webs with layers representing other types of interactions, such as parasitism and mutualism. The first such model, portraying the interaction on Chilean rocky shores~\cite{Kefi_multilayer_Chilean}, was qualitative. It indicated the existence of a particular trophic (feeding) or non-trophic interaction. A quantitative model would have to reflect the impacts of non-trophic interactions on the food web, or biomass dynamics in vertices.
}


\madd{It becomes necessary for mutualistic/relational networks like the full coffee agroecosystem that contains links $\{-,+\}, \{-,-\}$, and $\{0,+\}, \{0,-\}$}

\madd{It is most natural to represent these multilayer ecological networks as ubergraphs, portraying also the impacts of non-trophic interactions on edges. The 0-depth uberedges, namely the fundamental vertices, would serve as the notion of population size, quantified most commonly by the density of population or its biomass, that changes in time. Meanwhile the $1$-depth uberedges  represent flows/predation or other direct interactions, while deeper uberedges represent modifications either to other interactions or to the size of the respective population.}


\madd{The weighted Levi graph of an ubergraph is also a generalisation of a Petri net. Petri nets~\cite{Petri_thesis, Petri_Peterson_book, Baez_open_petri_2017} are bipartite graphs, representing objects and transitions between them through separate sets of vertices. }
\begin{definition}
    A \textbf{Petri net} is a bipartite graph $(S,T,M,W)$, with a set of places (species) $S$, a set of transitions $T$, markings
$$M: S \rightarrow \mathbb{Z}^{+},$$
and multiplicities
$$W: T \rightarrow \mathbb{Z}^{+}.$$
\end{definition}
\madd{These graphs were typically employed in the context of chemical reaction networks or ecological interactions. The edge weights (called mutliplicities) represent stoichiometric indices and were thus constrained to natural numbers. Markings, analogous to stocks in stock and flow networks, represent the number of molecules/organisms of a given substance/species.}

\madd{Catalysts in Petri nets~\cite{Baez_2019_catalysts} were proposed as interaction modifiers of one-depth to represent chemical catalysis. Ubergraphs offer a consistent generalisation of Petri nets with catalysts to an arbitrarily complex interaction influences.}

\madd{Ubergraphs generalise the notion of metabolic graphs defined in~\cite{Metabolic_graphs_McQuade} in the same way. We quote here the original definition.}
\begin{definition}
    \textbf{A metabolic graph} is a weighted directed hypergraph endowed with signed depth-2 uberedges connecting nodes to hyperedges. More precisely, a metabolic graph is an ordered quintuplet $G = (V, H, U, \phi_H, \phi_U)$ where $V = \{v_1, ..., v_N\}$ is the set of nodes, $H$ is the set of directed hyperedges, $\phi_H = \{\phi_h : h \in H\}$ is the
set of functions assigning weights to hyperedges, $U$ is the set of diuberedges and $\phi_U: U \rightarrow \{+, -\}$ 
\end{definition}


\begin{prop}
    A metabolic graph is a 2-depth diubergraph.
\end{prop}
\begin{proof}
    A metabolic graph $G = (V, H, U, \phi_H, \phi_U)$ is a diubergraph $\mathcal{U}=(V, H \cup U, \phi)$, with $\phi: H \cup U \rightarrow \mathbb{R}^{+}\cup\{-1\}$
    $$\phi(e)=\begin{cases}
        \phi_h, \quad \text{if} \quad e \in H \\
        \phi_U,\quad \text{if} \quad e \in U.
    \end{cases}$$
    
\end{proof}

\madd{The application of metabolic graphs in differential equations makes in fact use of effective weights~\ref{def:eff_weight} (see Eq. (1.8) in~\cite{Metabolic_graphs_McQuade}).}



\mdel{In the context of chemical reactions,~\cite{Metabolic_graphs_McQuade} defines a metabolic graph as $2$-ubergraph in which hyperedges are restriced to $1$-depth uberedges representing reactions and $2$-depth uberedges representing inhibition/enhancement.}


\section{Network measures for diubergraphs}\label{sec:measures}

In this section we review how commonly used graph measures can be generalised for use with diubergraphs. We elaborate also on conditions when introduction of a diubergrah is justified compared to a situation when considering a multilayer digraph is sufficient.

\subsection{\aadd{Classes of graph measures vs diubergraphs}}

Graph measures can be ordered in groups applying different concepts or using a variety of tools to capture their structural properties. We highlight the core aspects of each group and how they influence the generalisation.

\al{It is good subsection to comment on challenges related with defining particular measures. I suggest to prepare it when other subsections are ready.}
\textbf{Vertex-level measures}

\madd{
In digraphs and hypergraphs, graph measures are functions defined over the vertex set $V$. In diubergraphs this could naturally be $V$ or $V_U$, depending on the measure's purpose. Quantifiers of indirect influences and recursive measures, suggest independent versions that use either of those sets. Each captures a different aspect of the system in question. 
}

\textbf{Graph-level measures} Many of the measures are computed for every vertex or edge and then aggregated to present one number characterising a property of the whole graph:
\begin{align}
    \mu^{\mathrm{G}}&=\xi_V(\{\mu(v): v \in V \}), \\
    \sigma^{\mathrm{G}}&=\xi_E(\{\sigma(e): e \in E \}).
\end{align}
Common aggregating functions $\xi$ are the sum, average, median, minimum.

%\adel{In hypergraphs and ubergraphs one may also take into account the subdivisions of edges into classes (see Sec.\ref{sec:classes_of_hyper_uber}),}
%\adel{
%\begin{equation}
    %\sigma^{\mathrm{H}}=\xi_E(\{\xi_{\mathcal{E}}(\{\sigma(e): e \in \mathcal{E} \}): \mathcal{E}\subset E \}).
%\end{equation}}

\madd{Diubergraphs, as well as hypergraphs, can be represented to show adjacency~\ref{def:weighted_diubergraph} or incidence~\ref{uber_levi_graph} relations. This leads to dual definitions of graph measures that either aim to capture adjacency relations between vertices or their incidence in interactions. At the core of this distinction is the question - are we counting an edge once if it means adjacency with multiple neighbours or as many times as there are neighbours?}


\subsection{Degree Centrality}

\al{In my opinion this subsection is ready.}
Degree centrality measure is based on the notion of adjacency/incidence of vertices. As stated in Subsections \ref{sec:m_graph}-- \ref{sec:H_graph} this notions can be used interchangeably in the case of graphs and consequently the degree of a vertex $v$ can be defined by either using its incidence matrix or adjacency matrix. Namely, it is defined as the sum of entries of the corresponding row of incidence or adjacency matrix (i.e. the number of edges that are incident to $v$ or equivalently the number of vertices that are adjacent to $v$).

However, as for ubergraphs, these two numbers can differ significantly as one uberedge can contain arbitrary number of adjacent vertices and two adjacent vertices can be contained in more than one uberedge. Therefore, the degree of a vertex in a ubergraph can be defined in two separate ways: incidence degree and adjacency degree. 

Let us start with incidence degree of a vertex in an ubergraph which measures the number of interactions in which the vertex is involved in. Considerations in Section \ref{sec:U_graph} specify three candidates for which the new notion can be defined. Namely, fundamental vertices from $V$, vertices from $V_{\mU}$ and elements of $V\cup E_{\mU}$. It is natural to ask for which of the three candidates should we define the notion of incidence degree. The choice of vertices $V_{\mU}$ allows to capture substantial number of objects without loosing the coherence of mathematical definition. 
\begin{definition}[Incidence degree in a weighted diubergraph]\label{def:inci_deg}
    Let $\mathcal{U}=(V,E_{\mathcal{U}},\Phi)$ be a weighted diubergraph and let $V_{\mU}$ be a set of vertices defined in \eqref{eq:U_ver}. \textbf{Incidence in-degree (resp. out-degree)} $ \kappa_{I}^{\tin}(v)$ (resp. $ \kappa_{I}^{\out}(v)$) of a vertex $v \in V_{\mU}$ is the sum of weights of the directed uberedges $e=(e^{\mathrm{\tin}}, e^{\mathrm{\out}} )$ such that $v \in e^{\aadd{\tin}}$ (resp. $v \in e^{\aadd{\out}}$). Namely,
    \begin{equation} \label{eq:incidence_deg}
    \kappa_{I}^{\aadd{\out}}(v):=\sum_{v \in e^{\mathrm{\out}} }\phi(e), \quad \kappa_{I}^{\aadd{\tin}}(v):=\sum_{v \in e^{\mathrm{\tin}}}\phi(e).
\end{equation}
\end{definition}

Note that the formula \eqref{eq:incidence_deg} can be applied to $v\in E_{\mU}\setminus V_{\mU}$. However, since $v$ is not a head nor a tail of any other uberedge, then $\kappa_{I}^{\mathrm{in}}(v)=\kappa_{I}^{\mathrm{out}}(v)=0$. Thus, it does not bear any valuable information. On the other hand, if we decide to define incidence degree for all $v\in V\cup E_{\mU}$, then for a digraph, hence depth-1 ubergraph, it simplifies to a set $V\cup E_{\mG}$ and this does not agree with a standard definition of degree. On the contrary, $V_{\mU}=V$ for a digraph and hence Definition \ref{def:incidence-deg} can be considered as generalisation of classical notion of vertex degree.

On the other hand, adjacency degree of $v$ (which we denote by $\kappa_A (v)$) measures the weighted number of vertices $v$ interacts with. Each interaction that contain $v$ and its adjacent vertices is counted separately and added. To be more precise let us consider an example.

\aadd{\begin{exam}
Consider $\mU=(V,\EU,\Phi)$ such that $V=\{ 1,2,3\}$ is a set of fundamental vertices, 
\begin{eqnarray*}
E_{\mU}=\left\{ e_1 = (\{1\},\{2\}), e_2 = (\{1\},\{2,3\} ), e_3 =(\{1,e_2\}, \{e_1\})\right\}
\end{eqnarray*} 
is a set of diuberedges and the weight matrix equals $\Phi=\mathcal{I}$. Adjacency out-degree of $v=1$ is taking into account four vertices: $v=2$ via edge $e_1$, $v=2,3$ via edge $e_2$ and $v=e_1$ via edge $e_3$. Hence $\kappa_A^{\tin}(1)=4$ while $\kappa^{\tin}_I(1)=3$. Analogously, adjacency in-degree of $v=e_1$ is taking into account two vertices $v=1,e_2$ via $e_3$, consequently $\kappa_A^{\out}(e_1)=2$ while $\kappa^{\out}_I(e_1)=1$.
\end{exam}}

\adel{the ubergraph where $v\in V_{\mU}$ is only incident in two uberedges $e_1 =\{k,m\}$ and $e_2 =\{k,m,n\}$. Then, $k$ is interacting with $m$ in two distinct hyperedges and interacting with $n$ once in one hyperedge. Hence, the adjacency degree of $k$ is 3 whereas it is adjacent to two vertices $m,n$. This simple example also demonstrates the fact that adjacency and incidence degrees of a vertex are different in hypergraphs since $\kappa_I (k)=2$ and $\kappa_A (k)=3$.}

\adel{We remark that an alternative definition of adjacency degree of a vertex $k$ can be given as the number of vertices that interact with $k$ without taking into account the contributions coming from different hyperedges. In this case, adjacency degree of $k$ in above example would be 2. However, this definition neglects the adjacency relations in different interactions (hyperedges). Namely, in this setting all vertices $k,m$ and $n$ would have the same adjacency degree whereas $n$ is less involved in interactions and has less ties than $k$ and $m$. Besides, the removal of the hyperedge $e_1$ wouldn't change the adjacency degrees of vertices. Therefore, we assume the former definition of adjacency degree which incorporates all interactions separately.}


\begin{definition}[Adjacency degree in a weighted diubergraph]\label{def:adj_deg}
     Let $\mathcal{U}=(V,E_{\mathcal{U}},\Phi)$ be a weighted diubergraph. Adjacency in-degree (resp. out-degree) $ \kappa_{A}^{\tin}(v)$ (resp. $ \kappa_{A}^{\out}(v)$) of a vertex $v \in V_{\mU}$ is defined as the sum of weights of incident edges including the multiplicity of their heads (resp. tails) namely 
    \begin{eqnarray*}
        \kappa_{A}^{\out}(v)&:=&\sum_{w:\,(w,v)\in E_{\mU}} \sum_{e=(w,v)} \phi(e)=
        \sum_{v \in e^{\mathrm{\out}} } |e^{\mathrm{\tin}}|\phi(e), \\ \kappa_{A}^{\tin}(v)&:=&\sum_{w:\,(v,w)\in E_{\mU}} \sum_{e=(v,w)} \phi(e)=\sum_{v \in e^{\mathrm{\tin}}}|e^{\out}|\phi(e).
    \end{eqnarray*}
\end{definition}

As a summary, when considering diubergraphs, one has to be careful about the meaning of degree of a vertex, namely whether it is defined in terms of its incident hyperedges (incidence degree) or in terms of its adjacent vertices (adjacency degree). In most papers, the authors prefer to restrict the notion of degree to only one of these two possibilities either for simplicity or because one of them is more relevant to their model. For example, in \cite{Kapoor2013}, degree of a vertex in a hypergraph is defined as the number of its adjacent vertices. Moreover, the weighted degree centrality of a node is defined as the sum of weights of the ties of the node with the other nodes in the hypergraph \cite{Kapoor2013}. The weight of a tie between two nodes in the hypergraph can be defined as the number of the hyperedges they both belong to \cite{Kapoor2013}. Then, weighted degree of a node coincides with adjacency degree in our definition. They attempt to generalise this definition by taking into account different hyperedge weights. Namely, they suggest that hyperedge weights are dependent on two parameters: multiplicity (frequency of the hyperedge‚Äôs occurrence) and size of the hyperedge \cite{Kapoor2013}. Subsequently, they define five different weighted node degrees according to hyperedge weights that are defined as functions of their multiplicity and size \cite{Kapoor2013}. However, we choose to give a more general exposition and thus to take into account both notions of degree centrality for hypergraphs. \aadd{In Section \ref{sec:real_exam}} we present the interpretation of each of this measures in the context of high-order interactions in food webs.

Finally, to understand better the relation between the ubergraph and its Levi graph representation let us compare their incidence degrees for elements $v\in V_{\mU}$, hence elements for which both indices are defined.
\begin{prop}
Let $\mU$ and $\mathcal{G}_{\mU}$ be an ubergraph and its incidence graph representation. For incidence and adjacency degrees of $\mU$ and $\mathcal{G}_{\mU}$, denoted respectively by $\mU \kappa_I$, $\mathcal{L} \kappa_I$ and $\mU \kappa_A$, $\mathcal{L} \kappa_A$, we have the following relation
\aadd{\begin{eqnarray*}
(\mU\kappa_I)_i^{\mathrm{in/out}}(v)&=&(\mathcal{L}\kappa_I)_i^{\mathrm{in/out}}(v)=(\mathcal{L}\kappa_A)_i^{\mathrm{in/out}}(v)\qquad \text{for }v\in V\\
(\mU\kappa_I)_i^{\mathrm{in/out}}(v)&\pm& \sum_{v_j\in L_m: m<D(v), v_j\in v^{\mathrm{out/in}}}\phi(v)=(\mathcal{L}\kappa_I)_i^{\mathrm{in/out}}(v)=(\mathcal{L}\kappa_A)_i^{\mathrm{in/out}}(v) \quad \text{for }v\in V_{\mU}\setminus V
\end{eqnarray*}}
\end{prop}

\begin{proof}
The qualities follow from Definitions \ref{def:inci_deg} and \ref{def:adj_deg}.
\end{proof}

\aadd{The above result indicates that a  subtle difference in the degree of certain vertices $v\in V_{\mU}$ is lost while approximating an diubergraph by its Levi graph since in the case of Levi graph both incidence and adjacency degrees are always equal.}

\adel{One can naturally consider degree centrality of hyper/uberedges. In a hypergraph, the degree or order of a hyperedge is defined as the number of vertices contained in it. If the hyperedges are weighted, then the centrality of a hyperedge is measured according to its weight. As for ubergraphs, the degree (order) of an uberedge can be defined as either number of vertices contained in it or number of fundamental vertices in the fundamental form of it. Let us consider the uberedge $ e=\{ 1,\{2,3\} \}$. In the former definition, the degree of $e$ is 2 whereas it is 3 in the latter definition. Note that uberedge $f=\{1,2,3\}$ has degree 3 in second definition whereas two uberedges have completely different structures. Therefore, it is more natural to define the degree of an uberedge as the number of vertices that are incident in it. Similarly, if the uberedges are weighted, then the weight of an uberedge determines its centrality.}



\subsection{Paths and path-based measures}
For a simple graph $G=(V,E)$, a walk of length $k$ is a sequence of vertices $v_0 , v_1, \ldots, v_k$ such that each pair of successive vertices
are adjacent. Two vertices are adjacent if and only if they belong to exactly one
edge. Moreover, two incident edges intersect in exactly one vertex. Therefore, any graph walk can be equivalently described as either a sequence of adjacent vertices or
as a sequence of incident edges i.e. the walk $v_0 , v_1, \ldots, v_k$ can be equivalently represented by $e_1 , e_2, \ldots, e_k$ where $e_j =\{v_{j-1}, v_j \}$ for $j=1,2,\ldots,k$. 

This equivalence holds neither for hypergraphs nor ubergraphs. In \cite{Vasilyeva}, the authors define the distance between two vertices of a hypergraph by considering its line graph and define it in terms of two variables; the intersection and the union of hyperedges. Two uberedges
can intersect at any number of vertices, and two vertices can belong to any number
of shared uberedges. This yields two options for walks on ubergraphs: walks on the vertex level (consisting of successively adjacent vertices), and walks on the edge level (consisting of successively intersecting edges). It is easier to focus on the latter. Therefore, for simplicity, we define a walk of length $k$ on an ubergraph $U=(V,E)$ as a sequence of uberedges $ e_1 , e_2, \ldots, e_k$ such that each pair of successive uberedges share at least one common vertex. This notion can be generalised to $s$-walks on uberedges analogous to hypergraphs \cite{Aksoy2020} in which consecutive uberedges can share at least $s$ vertices. 

In digraphs, such as food webs, paths often have the possible interpretation of an actual path matter can take. In ubergraphs, they resemble more a causal path.

%\mwadd{\begin{definition}
 %   Let $ \mU = (V, \EU, \phi) $ be a directed weighted ubergraph. Let $ v, w \in V \cup \EU $. A $ v w $-walk on $ \mU $ of length $ l $ is a sequence, \[ v, V_l, w \] where $ V_l $ is a sequence of $v_{l_j} $  and $ e_{l_j} $ with $v_{l_j}, e_{l_j} \in V \cup \EU $,  $ l_j \in \{1,2,\ldots, l-1 \} $ such that either of the following is true, 
%\end{definition}}
 %\begin{enumerate}
  %      \item \mwadd{$ v_{l_j}, e_{l_{j+1}}$ vertex to edge}
   %     \item \mwadd{ $ e_{l_j}, v_{l_{j+1}}$ edge to vertex}
    %    \item \mwadd{$ e_{l_j}, e_{l_{j+1}}$ edge to edge}
     %   \item \mwadd{ $ v_{l_j}, v_{l_{j+1}}$ vertex to vertex, (within the same edge or to a different edge)}
%\end{enumerate}

\begin{definition}
    Let $ \mU = (V, \EU, \phi) $ be a directed weighted ubergraph. Let $ v, w \in V \cup \EU $. A $ v w $-walk on $ \mU $ of length $ l $ is a sequence, \[ v, e_{1},e_{2}, \ldots,e_{l-1}, w: \forall_{i \in \{1,\ldots, l-2\}} \quad e_i \cap e_{i+1} \neq \emptyset \] where $ e_j \in \EU $, $ j \in \{1,2,\ldots, l-1 \} $.
\end{definition}

\madd{Here we differ from ubergraph paper by Joslyn}
\mat{Discussion note: we have seen that path as a sequence of edges generalizes from digraphs to ubergraphs, but as uberedges connect to uberedges it might not have a formulation as a sequence of vertices. }




\mwadd{\begin{plain}
    Consider an Ubergraph $ U = (V,E) $ with fundamental vertices $ V = \{ v_1, v_2, v_3, v_4 \}$ and uberedges $ E = \{ e_1, e_2, e_3, e_4, e_5\} = \{ e_1, e_2, e_3, e_4, (v_1,e_4) \} = \{ e_1, e_2, e_3, (v_2,e_3), (v_1,(v_2,e_3))\} $. The following are $v_1v_4$-walks on $U$, \\ $W1: v_1, e_1, e_2,e_3,v_4 $,\\ $ W2: v_1, e_5, e_4,e_3, v_4 $, \\$ W3:v_1,e_5,e_4,e_2,e_3,v_4.$
\end{plain}}
\mat{The paper by Golubski makes the right remark, that a hyperpath might still require presence of nodes other than entrance or exit (to a hyper/uberedge) and cites Gallo G. (1993) Directed hypergraphs and applications. Discrete Appl. Math. 42, 177-201}

\mwa{Gao et al. \cite{gao2014dynamic} define a hyperpath from $ v $ to $ w$,where $v,w \in V $, as a sequence of edges $e_0,e_1,\ldots, e_l $ such that $ v\in e_0 $, $w \in e_l$, $e_i \cap e_{i+1} \ne \emptyset $  }

\subsubsection{Additive and multiplicative path measures}

We have concluded that we should describer just multiplicative cases (flow systems with inhibitors/stimulants), and have weights in real positive numbers - this we say here, at the beginning the more general definitions is fine.

Traditionally, path length as the sum of weights, natural in transport, static networks. For edges with modifiers, a product of at least some weight on the path is necessary. Full product if e.g. contribution to the influence of a node from a given path is considered. (the full influence would be akin to Katz centrality)

\mwadd{\begin{definition}
    \textbf{Shortest path} A shortest path between vertices $ v $ and $ w $ in a weighted ubergraph $ U $ is a \mdel{path} \madd{walk} with minimum sum of the \madd{absolute values of the} weights along the \mdel{path} \madd{walk} from vertex $v $ to $ w $.
\end{definition}}

\madd{The shortest walk does not repeat vertices on the way - these would be loops so the shortest walk is also the shortest path}

\mwadd{\begin{definition}
    \textbf{Eccentricity} The Eccentricity of a vertex is the maximum distance between the vertex to any other vertex in the Ubergraph.
\end{definition}}
\bart{Maybe we should add what we mean by path exactly for hyper- and ubergraphs, as (I think) in most definions for a usual graph a path is a walk with no repeated vertices (and therefore edges: there's also a trail, for which only edges have to be distinct). But for edges with more than one element it's possible for an edge to repeat while veritces do not. I don't know how it's treated in literature, the issue came up when I read about clustering coefficients}
https://www.overleaf.com/project/63b551c2e7df58b60a1c6417
\mat{Actually, if sth has many tails and heads it could be traversed in different 'directions' and enable more paths in a directed graph. So I guess allowing multiple traversal is ok unless explicitly useful in some application.}
\mwadd{\begin{definition} Let $i,j,k \in V \cup \EU $. The betweeness centrality of vertex $ i $ is,
    \[C_B(i) = \sum_{j<k} \frac{p_{jk}(i)}{p_{jk}}\] where $ p_{jk}(i) $ is the number shortest directed paths from j to k containing i and $p_{jk}$ is the number of directed paths from $ j $ to $ k $. For a weighted directed network, $p_{jk}(i), p_{jk} $ is the sum of the weights on the shortest paths that passes through $ i $ over all the paths from $ j $ to $ k $ respectively. 
\end{definition}}

\mwadd{Note that the paths in $ p_{jk}(i) $ and $ p_{jk}$  exists only where the direction is meaningful i.e. a $jk$-path exists if there exists edges connected head-to-tail from the edges containing vertices $j$ until reaching $k$.}

\begin{figure}[h]
    \centering\includegraphics[width=0.7\linewidth]{fig/coffee agroecosystem.jpeg}
\end{figure}
\mwa{The hypergraph picture for illustration purposes only $ \rightarrow $ to be removed.}
\mwa{Some researchers argue that defining path based measures on directed weighted graphs based on the sum of the weights on the edges looses the information of the number of intermediary vertices/edges between the end points.}

\subsection{Information-based measures}

We use upper-case letters for matrices and lower-case for vectors. Replacing an index with a bullet denotes summation over the whole range of an index of a vector $v$, or a matrix $M$: $v_{\bullet}=\sum^n_{i=1}v_{i}$, $M_{i\bullet}=\sum^n_{j=1}M_{ij}$, $M_{\bullet j}=\sum^n_{i=1}M_{ij}$, $M_{\bullet \bullet}=\sum^n_{i=1}\sum^n_{j=1}M_{ij}$.

\madd{When referring to a matrix of weights $\phi$ we use the capital letter $\Phi$.}

\mat{Or is it standard to use weight function - weight matrix interchangeably with the same symbol?
In fact we could also avoid the explicit index notation or redefine it - defining the partial sums over classes made me aware sth else might be more consistent. We work with sums over set elements.}


\madd{The graph measures that take inspiration from information theory rely on sums of weights. Their generalisation from digraph to an ubergraph requires the proper choice of the summation domain as well as taking into account multiple heads and tails in an uberedge. The natural summation domains are the uberedge classes (see Def.~\ref{def:classes_of_hyper_uber}).}
The distribution of edge weights in empirical graphs differs from purely random, containing information about structural properties specific to the system. Ecological network analysis~\cite{Ulanowicz2004} quantifies this information amount as flow diversity~\cite{MacArthur_1955} using Shannon entropy. In a digraph, such as a food web, it takes the form 
\begin{equation}
			H=-\sum^{n}_{i=1}\sum^{n}_{j=1}\frac{\phi_{ij}}{\phi_{\bullet \bullet}}\log\frac{\phi_{ij}}{\phi_{\bullet \bullet}}.
\end{equation}
It can be decomposed into two parts. The first, called the average mutual information (AMI)~\cite{Rutledge_1976} is interpreted as a measure of the system efficiency~\cite{Ulanowicz_1987}. It compares the observed flows with ones guided by the total outflows and inflows to their origin and target vertices.
\begin{equation}
			\text{AMI}=\sum^{n}_{i=1}\sum^{n}_{j=1}\frac{\phi_{ij}}{\phi_{\bullet \bullet}} \log\frac{\phi_{ij}\phi_{\bullet \bullet}}{\phi_{i\bullet}\phi_{\bullet j}}.
\end{equation}
In the summation, the terms for which $\phi_{ij}$ is zero are omitted. 

The remainder, the residual pathway diversity $H_{\mathrm{c}}=H-\text{AMI}$~\cite{Rutledge_1976} describes flow redundancy:
\begin{equation}
			H_{\text{c}}=-\sum^{n}_{i=1}\sum^{n}_{j=1}\frac{\phi_{ij}}{\phi_{\bullet \bullet}}\log\frac{{\left(\phi_{ij}\right)}^2}{\phi_{i\bullet}\phi_{\bullet j}}.
\end{equation}

Robert Ulanowicz introduced an indicator of robustness~\cite{Ulanowicz_1997, Ulanowicz_2009},  that balances efficiency and redundancy in a graph:
\begin{equation}
	-e\frac{\mathrm{AMI}}{H}\mathrm{log}\left(\frac{\mathrm{AMI}}{H}\right).
\end{equation}
where $e$ is a normalization factor.



These information-based measures normalise the contribution of an individual edge using quantities characterising the whole set of edges ($H$) or edges around a given vertex ($\mathrm{AMI}$). This mirrors the assumption about the prior weight distribution the empirical one is compared to. A uniform distribution is used in the context of flow diversity, and one guided by inflows and outflows for AMI.
Both for ubergraphs and hypergraphs it seems natural to compare edges within the class $\mathcal{E}$ they belong to (see Def.\ref{def:classes_of_hyper_uber}). We present explicit formulas for ubergraphs as they take the same form for hypergraphs. We replace $\phi_{\bullet \bullet}$ with a class-specific normalisation, 
\begin{align}
    \omega_e&=\sum_{e' \in \tE_e} \tphi_{e'} \\
    H^U&=-\sum_{e \in E } \frac{\tphi_{e}}{\omega_e}\log\frac{\tphi_{e}}{\omega_e}.
\end{align}
The observed weight of an edge is compared by digraph AMI to the product of in- and out-strengths of its head and tail, respectively (see Eq.~\ref{eq:degree_def}). For ubergraphs, these are further summed for all heads and tails,
\begin{align}
    \omega_e^{\text{in}}&=\sum_{u \in e^{\mathrm{in}}} \kappa_{u}^{\tin} \\
    \omega_e^{\text{out}}&=\sum_{u \in e^{\mathrm{out}}} \kappa_{u}^{\out} \\
    \text{AMI}^U&=\sum_{e \in E}
    \frac{\tphi_e}{\omega_e} \log\frac{\tphi_e\omega_e}{\omega_e^{\text{in}} \omega_e^{\text{out}}}.
\end{align}

\mat{The $\text{AMI}^U$ looks like it would differ from digraph AMI because individual weight $\tphi_e$ can contribute multiple times to all normalisations as every uberedge contains many vertices. But I have to check it out in detail.}

\subsection{Recursive measures}
A number of digraph measures are defined implicitly, relying on recurrence relations. This happens, if the value of a vertex measure depends on its value in neighbouring vertices.

\madd{Recursive measures can be generalised to ubergraphs in a straightforward manner, thanks to appropriate definition of the adjacency matrix~\ref{def:ubergraph_adjacency_matrix}.} The notion of neighbouring vertices finds its natural meaning in the set $V_{\mU}$.

Certain applications might prefer to consider both the measure's general and a basic version, restricted to a certain class of uberedges. Trophic level could continue to use just the pairwise consumption flows. We propose to define \emph{trophic influence} that represents which trophic levels a vertex influences.  

\subsubsection{Eigenvector centrality}\mwadd{The degree centrality has been described earlier on is a degree based centrality measure that consider the influence of a vertex on the directly linked vertices. Some path based measures, betweeness centrality and closeness centrality have also been discussed. However, it is known that the recursive measure of eigenvector centrality provides more information on the importance of a node based on the importance of other nodes.}

\mwadd{For undirected graphs, the eigenvector centrality is given by}
\mwadd{\[\textbf{x}=\frac{1}{\lambda_1}A\textbf{x} \]}
\mwadd{$ \textbf{x} $, the vector of centralities, $ A $ the adjacency matrix which is a symmetric matrix, $\lambda_1$ the largest eigenvalue of $ A $. For directed graphs, $ A $ is not necessarily symmetric. There are two centrality measures based on out-degree (importance of a node) and in-degree (achievements of a node). Out-degree centrality increases with increasing nodes which in turn have more out-degree and the in-degree centrality is the opposite. In literature, the right eigenvector $\textbf{x}$ is considered ($A\textbf{x} = \lambda \textbf{x}$) most times as compared to the left eigenvector $\textbf{y}$, ($y^HA = \lambda y^H $) because it is the in-degrees that gives a node power.}

\subsubsection{Katz centrality} \madd{A classical example of such a measure is \textbf{Katz centrality} that defines vertex importance as being connected to (many) important vertices. The contribution from a neighbour is multiplied by the weight of the connecting (uber)edge and then a universal damping factor $\alpha$. The $i$-th entry of a vector of Katz centrality values $C_{\mathrm{Katz}}$ is defined as}
\begin{equation}
    C^{\mathrm{Katz}}_i=\alpha \sum_j \Phi_ij C^{\mathrm{Katz}}_j + \beta_i,
\end{equation}
with $\alpha, \beta \in \mathbb{R_+}$
In matrix form,

        \begin{equation}\label{eq:Katz}
            C_{\mathrm{Katz}}=\alpha \Phi C_{\mathrm{Katz}} + \beta. 
        \end{equation}
        For the solution to exist, the damping factor $\alpha \in (0,\rho^{-1})$, $\rho=max(Re(\mathrm{eig}(\Phi)))$, and $\beta \in \mathbb{R_+}^{n}$ \mat{Notation: how to best define it briefly as an eigenvalue?}
\subsubsection{Trophic level and trophic influence} \madd{\textbf{Trophic level}~\cite{Odum1975TheDF} in food webs is an example of Katz centrality restricted to a subgraph. In a seemingly unrelated manner it represents the distance of a vertex from the point of entry of biomass into the system. }
    \madd{
    Non-living vertices and primary producers are assigned trophic level equal to one. The trophic level $\tau$ of the remaining vertices is the mean trophic level of their prey plus one:}
    \begin{align}
        \tau_i=
        \left\{
        \begin{array}{ll}
        1 & \text{if $i>l$ or $\sum_{k=1}^{n} \Phi_{ki}=0$} \\
        1 + \sum_{j=1}^{n}\frac{ \Phi_{ji} }{\Phi_{\bullet i}}\tau_j  & \mbox{   } \text{for other nodes.} \\
        \end{array}
        \right. 
    \end{align}
    For a vector of consumer trophic levels $\tau_c$, that are larger than one,
    \begin{equation}
        \tau_c=\Psi \tau_c + \tau_0 
    \end{equation}
    \madd{where $\Psi_{kl}=\frac{\Phi_{kl}}{\Phi_{k \bullet }}$ with $k$, and $l$ restricted to the consumer nodes; $\tau_0$ is a vector representing the constant contributions (ones and flows from non-consumers).}
\subsubsection{Structural similarity}
\madd{An approach to identify groups of similar vertices was to say that "$i$ is similar to $j$ if $i$ has a network neighbor $v$ that is itself similar to $j$". This led to a definition of a \textbf{structural similarity} matrix $S: V \times V: \mathbb{R}$, \cite{Leicht2006}: }
    \begin{equation}
        S=-\alpha \Phi S+ \mathit{I}.
    \end{equation}
    Here $\Phi$ is the adjacency matrix of a digraph and $\mathit{I}$ is the identity matrix.

\subsection{Clustering coefficient}
\badd{A clustering coefficient is a measure of how much nodes of a graph cluster together, meaning in this case how often neighbors of the same node are neighbors themselves. 
For usual graphs, two versions of the measure are considered: a local and a global clustering coefficient. For the following definitions we assume no self-loops, meaning no edges connecting a vertex to itself.}
\badd{
\begin{definition}[Local clustering coefficient for undirected graphs]
    The local clustering coefficient $C(v)$ of vertex $v$ is defined as proportion of a number of edges between its neighbors to a number of those possible. Denoting the set of vertices connected to $v$ as $N$, $|N|=n>1$ the definition is
    \[
    C(v) = \frac{2 \times |\{(v_i, v_j) \in E: v_i, v_j \in N\}|}{n(n-1)} .
    \]
    For $n \in \{0,1\}$ two approaches can be taken, either to let $C(v) = 0$ or to leave it undefined. Multiplication by $2$ comes from the fact that there are $\frac{1}{2} n(n-1)$ edges between neighbors of $v$ possible.
\end{definition} }
\badd{
The local clustering coeffient takes values in the interval $[0,1]$. In terms of an adjacency matrix it can be expressed as
\[
C(v_i) = \frac{1}{n(n-1)} \sum_{j,k} A_{ij} A_{ik} A_{jk} = \frac{(A^3)_{ii}}{n(n-1)}.
\]
The first equality is justified by the fact that the summed value is equal to $1$ iff $v_i$ is connected to both $v_j$ and $v_k$ and these two are  connected as well. The second equality follows from the fact that the number of walks of length $n$ between vertices $v_i$ and $v_j$ is equal to $(A^n)_{ij}$. Thus the number of pairs of connected neighbors of $v_i$ is the number of walks of length $3$ from $v_i$ to itself.}
    \badd{
\begin{definition}[Global clustering coefficient for undirected graphs]
    Global clustering coefficient measures how clustered the whole network is. It is usually defined for undirected graphs as
    \[
    C = \frac{3 \times \text{number of triangles in a graph}}{\text{number of paths of length two}} .
    \]
    The ``triangles'' are trios of verices, all of which are connected to each other. Multiplication by $3$ is justified by the fact that each triangle corresponds to $3$ paths of length two.
\end{definition} }
\badd{
    The global clustering coeffient takes values in the interval $[0,1]$. In terms of an adjacency matrix it can be expressed as 
    \[
    C = \frac{\text{tr}(A^3)}{\sum_{i \neq j}(A^2)_{ij}} , 
    \]
    because the number of walks of length $n$ between vertices $v_i$ and $v_j$ is equal to $(A^n)_{ij}$, so the number of triangles is equal to $\frac{1}{6}\text{tr}(A^3)$. This is because each triangle corresponds to two walks from each of the three veritces to itself. The number of paths of length $2$ is equal to the expression in the denominator, since all walks of length $2$ apart from loops should be counted. }
    \par
    \badd{
    The global clustering coefficient is also known as transitivity or transitivity coefficient. It is worth noting that the avarage of local clustering coefficients of all vertices is also considered a useful metric. Sometimes this value is called a global clustering coefficient instead.
    }
    \bart{TO DO: add citations}


\subsubsection{Generalization to weighted and directed networks}
\badd{Introducing either edges' directions or weights to networks poses some challenges for generalizing the clustering coefficients. There exist multiple approaches, none of which seems to be universally considered the only proper one. To illustrate the possible issues, let us consider three vertices, all connected by undirected weighted edges. In defining the local clustering coefficient for one of them, the weights can be aggregated by taking their maximum, minimum, the arithmetic or the geometric mean and possibly more. In some cases only the weights of two edges between the vertex and its neighbors are considered; the weight of the edge connecting the neighbors is not considered, only its presence. }
\bart{There's really a lot of possible choices, mainly when dealing with weights. Should one definion be chosen, even just as an example to introduce the weighted case for hyper- and ubergraphs? The issue for hypergraphs I mentioned in the meeting is kind of separate from that.}

    


\subsection{Modularity}
\subsection{Nestedness}
\section{Comparison of different graph models of higher-order phenomena [TO DO]}\label{sec:real_exam}
\mat{To do: Find a real example of a true hyperedge that cannot be represented by hierarchical nested pairwise interactions.}


We remark here that ubergraphs can be used to model ecological networks that involve trait-mediated indirect interactions or interaction modifications associated with adaptive behaviors such as coffee agroecosystem web~\cite{GOLUBSKI2016344} or four-way live prey-predator-carrion-scavenger interactions~\cite{Moleon_scavenging} (see Figure \ref{Moleon}). This is because in such systems, some vertices (species) interact with some edges (interactions). However, ubergraphs provide much more flexibility than needed in these systems and therefore creating more complexity for the structure and dynamics. To be more precise, in such systems one uberedge is only linked to some other fundamental vertices whereas general ubergraphs allow uberedges containing arbitrary number of other uberedges and fundamental vertices. For this reason, we need a more specific class of ubergraphs called ecographs. 

In this section, we shall illustrate the differences between our ecograph approach and the hypergraph representations proposed earlier in order to represent higher order interactions in ecology such as coffee agroecosystem web and four-way live prey-predator-carrion-scavenger interactions. For simplicity, we use small subgraphs (motifs) that contain all the features relevant to each case.

\subsection{Hypergraph and ubergraph representations of interaction modifications}

\madd{The hypergraph representation of interaction modifications~\cite{GOLUBSKI2016344}, maps each of them to a hyperedge connecting all impacted vertices. Although described just for an undirected, unweighted graph, it can be formalised as follows.}

\begin{prop}
Given an ubergraph $\mU = (V, \EU, \phi)$, a related hypergraph $H =(V', \EH, \phi')$ is constructed by the following procedure:
\begin{align}
    V' &= V \\
    \EH &= \EH^0 \cup \EH' \quad \text{where} \quad \EH^0={e \in \EU: D(e) = 1} \\
    \forall_{e \in \EU: D(e) > 1} \EH &= \EH \cup (\ein,\eout), \text{where} \\
    &\ein={v \in V: \exists \text{a walk through uberedges from $v$ to $e$}}, \\
    &\ein={v \in V: \exists \text{a walk through uberedges from $e$ to $v$}}.
\end{align}
\end{prop}

\mat{The above formulation makes the most sense I believe and works for coffee agroecosystem. In general we show that this simplification does not make much sense, so honing this definition might not be worth it. In general there would be a lot of related facts, like does every X-walk like Hamilton satisfying some conditions etc. correspond to exactly one hyperedge...}

\begin{figure}[h]
    \centering\includegraphics[width=0.7\linewidth]{fig/Comparison_Hypergraph_Ubergraph_whole.pnghyperedge_path.jpg}
    \caption{Correspondence between ubergraph walk and a hyperedge. To be redone in Inkscape.}
\end{figure}

In other words, a walk $w=(v_0, e_1, ... , e_{l-1},v_l)$ in $\mU$ (such that $v_0, v_l \in V$, and $\forall_{k \in 1, \ldots, l-1} e_k \in \EU,  e_k \in e_{k+1}^{\tin} \lor e_{k+1} \in e_k^{\out}$) is mapped to a hyperedge $(\{v_0, V \cap \bigcup_{m=1}^{l-1}e_m^{\tin} \},\{v_l,V \cap \bigcup_{m=1}^{l-1}e_m^{\out} \})$.

%such that $\forall_{k \in K} v_k \in \bigcup_{m=1}^{l-1}e_m^{\tin}$, and $\forall_{k' \in K'} v_{k'} \in \bigcup_{m=1}^{l-1}e_m^{\out}$.

This correspondence allows us to compare graph measures calculated for a hypergraph with an ubergraph representation of the same system. Let us trace relationships between Katz centralities of the vertices $v_0$, and $v_l$ in both representations. We illustrate it for unweighted graphs, such as the empirical one considered in our main example~\cite{GOLUBSKI2016344}.
\begin{equation}
    c_{v_0}^{\mU,\out}=\beta + \alpha c_{e_1}^{\mU,\out} + \alpha c_{R_1}^{\mU,\out},
\end{equation}
where $\alpha c_{R_1}^{\mU,\out}$ is the contribution to $v_0$ centrality coming from the rest of its connections (other than with $e_1$ on walk $w$). Then,
\begin{equation}
    c_{v_0}^{\mU,\out}=\beta + \alpha c_{R_1}^{\mU,\out} + \alpha ( \alpha c_{e_2}^{\mU,\out} + \beta + \alpha c_{R_2}^{\mU,\out}).
\end{equation}
Applying the recursive definition of Katz centrality further along the walk $w$, we finally obtain
\begin{equation}
    c_{v_0}^{\mU,\out}=\sum_{m=1}^{l-1} \alpha^{m-1} (\beta + \alpha c_{R_m}^{\mU,\out}) + \alpha^l c_{v_l}^{\mU,\out}.
\end{equation}
In the hypergraph case, the walk has been substituted by one hyperedge, making vertices further along the walk as impactful as the ones at its beginning:
\begin{equation}
    c_{v_0}^{H,\out}=\beta + \alpha (\sum_{v \in V_0^{\out}} c_v^{H,\out}),
\end{equation}
where $V_0=V \cap \bigcup_{m=1}^{l-1}e_m^{\out}$ is the set of all vertices reachable from $v_0$ by following just the uberedges of the walk $w$. In short, the ubergraph representation diminishes the contribution from deeper uberedges (more removed modifiers of interaction-modifiers), multiplying them by higher powers of $\alpha$. An analogous reasoning holds for the reversed Katz centralities $c_{v_l}^{H,\tin}$ and $c_{v_l}^{\mU,\tin}$.

\mat{The formula $V \cap \bigcup_{m=1}^{l-1}e_m^{\out}$ might have the issue that the sum needs to be flattened to be actually intersected. How to properly write "the set of all vertices reachable from $v_0$ by following just the uberedges of the walk $w$" in one formula?}


\subsection{Coffee agroecosystem}

\madd{A coffee agroecosystem network~\cite{GOLUBSKI2016344} described higher-order interactions among insects and used them as a motivation for hypergraph representation. A minimal example of a four-vertex subgraph of this network is presented in Fig.~\ref{rep_of_coffee_comparison}. We used it as our core ubergraph example in Fig.~\ref{fig:PASB_ubergraph_incidence_graph}.
Ecological expert knowledge was used to describe direct pairwise interactions between species, as well as influences strengthening or weakening other interactions. The described system explicitly portrays a depth-2 ubergraph. Representing it as a hypergraph introduces ambiguity about the role of a vertex in an interaction. The authors used vertex removal and edge addition to test soundness of the representation. They concluded that unweighted undirected hypergraphs might incorrectly inflate centrality measures by higher-order interactions intended as weakening. This is resolved in directed case, that clearly distinguishes between being influenced and influencing. Authors also postulated using different weights for each vertex in a hyperedge, remarking that assigning and combining weights would be a nontrivial task. In our approach the same goal can be achieved with standard graph weights assigned to the whole uberedge in which each vertex role is clear.
 }


\madd{
The impact of phorid flies on azteca ant defense of scale insects is tied to them gaining biomass from the ants. An alternative representation of this interaction could be an uberedge in which a depth-1 edge influences a depth-2 edge.((Azteca,Phorid),(Azteca,(Scale,Beetle)))
}

%[a bit long and confused in the Golubski paper vs other sources]We consider a subgraph of  representing interactions between four species. The beetles and Azteca ants obtain energy from scale insects, while phorid flies parasitize Azteca ants. Azteca ants protect scale insects from beetles~\footnote{The original article contained a misprint in the figure description}. The phorid flies elicit a defensive behaviour of ants, thus reducing the impact of the Azteca ants on scale:beetle interaction.[Here again I am uncertain about the direction] 

%These interactions have been originally represented as hyperedges  as one can see in Figure \ref{figcoffee2}. For example, the modification of Azteca on the Scale:Beetle interaction is depicted as hyperedge $E$ in \ref{figcoffee2}. However, the hyperedge $E$ consists of $\{ Azteca, Scale, Beetle \}$ and the correct nature of interactions among these three species is ambiguous in this hyperedge representation. Namely, it is not clear which species modifies the interaction between the other two. Similar explanation can be made for the hyperedge $F$ that represents the interaction in which Phorid modifies the modification of Azteca on the Scale:Beetle interaction. Therefore, these hyperedge representations are lacking to reflect the true nature of the interaction modifications between four species. We propose to represent these interactions by using a special class of ubergraphs (we call them ecographs) in the following way. Let us define the set of fundamental vertices $V=\{ P,A,S,B \}$ and set of directed edges $E=\{e_1 =(A,P), e_2 = ( S,A), e_3 = ( S,B) \} $ where we denote Phorid by P, Azteca by A, Scale by S and Beetle by B. The set of directed uberedges is given by $U= \{ u_1 = ( A, e_3 ), u_2 =  (P, u_1 )  \}$ where $u_1$ is a depth-1 uberedge representing the modification of Azteca on the Scale:Beetle interaction and $u_2$ is a depth-2 uberedge representing the modification of Phorid over the previous modification of Azteca on the Scale:Beetle interaction. It is easily seen that in this setting there is no loss of any information about the whole structure of the system. 

\begin{figure}[h]
    \centering\includegraphics[width=0.9\linewidth]{fig/various_PASB_representations.png}
    \caption{Four representations of a fragment of the coffee agroecosystem network~\cite{GOLUBSKI2016344}, the interaction between Phorid, Azteca, Scale and Beetle vertices. Upper left and right: interactions reported together with their signs in the original paper, which are an ubergraph visualisation. Lower left: hypergraph representation. Lower right: digraph incidence representation of an ubergraph.}
    \label{rep_of_coffee_comparison}
\end{figure}



\subsubsection{Comparison of degree centralities}
\gadd{We shall compare the degree centralities (incidence and adjacency) for hypergraph and ubergraph (or maybe ecograph???) representations of minimal subgraph (see Fig.~\ref{rep_of_coffee_comparison}, upper right) of coffee agroecosystem network~\cite{GOLUBSKI2016344} which contains trait-mediated indirect interactions or interaction modifications. Hypergraph representation of this subgraph consisting of four species: Phorid, Azteca, Scale and Beetle, and higher-order interactions among them was presented in ~\cite{GOLUBSKI2016344}. Namely, the authors represented it as the hypergraph $H=(V,E)$ where $V=\{ P,A,S,B \}$ is the set of vertices and $E=\{ b=\{ S,B\}, c=\{A,S\}, d= \{P,A\}, e=\{ A,S,B\} , f=\{ P,A,S,B\} \} $ is the set of hyperedges. The correct nature of interactions among three species $A,S$ and $B$ is ambiguous in the hyperedge $e$, namely, it is not clear which species modifies the interaction between the other two. Therefore, this hypergraph representation is lacking to portray indirect interactions or interaction modifications within ecological networks. For this reason, we propose an ubergraph representation of this subgraph as follows. Let us define the set of fundamental vertices $V=\{ P,A,S,B \}$ and set of uberedges $U_E =\{ e_1 =\{ S,B\}, e_2 =\{A,S\}, e_3 = \{P,A\}, e_4 =\{ A,e_1 \} , e_5 =\{ P,e_4 \} \}$. Notice that $e_4$ is a depth-1 uberedge representing the modification of Azteca on the Scale:Beetle interaction and $e_5$ is a depth-2 uberedge representing the modification of Phorid over the previous modification of Azteca on the Scale:Beetle interaction.} 
\begin{table}[]
    \centering
    \begin{tabular}{|c|c|c|c|c|}
        \hline
       & P & B & S & A   \\
       \hline 
       Incidence degree  & 2 & 3 & 4 & 4 \\
       \hline 
       Adjacency degree & 4 & 6 & 7 & 7 \\
       \hline
    \end{tabular}
    \caption{Degree centralities for hypergraph representation}
    \label{tab1}
\end{table}

\gadd{It can be easily observed from Table \ref{tab1} that incidence and adjacency degrees are different but they are dual to each other in terms of measuring the centrality of nodes.In Table \ref{tab1}, it can be seen that Scale and Azteca are more central than the others with same incidence and adjacency degrees. As for our ubergraph representation, Table \ref{tab2} suggests that Azteca is the most central node. Notice that the incidence degree of an influenced node in hypergraph representation is reduced in the ubergraph representation for each time the node is influenced by others. For example, incidence degree of Azteca changes from 4 to 3 since it is only influenced by the modifier Phorid whereas the incidence degree of Phorid is constant since it is only a modifier. In other words, in the ubergraph representation, a higher-order interaction (depth-$k$ uberedges with $k\geq 1$) contributes only to a modifier node in terms of incidence degree. Moreover, note that incidence and adjacency degrees coincide in the ubergraph picture since every uberedge has two vertices (some vertices may be other uberedges). However, this not true in general. For instance, consider an interaction that is modified by two distinct nodes. In this case incidence and adjacency degrees differ.}

\begin{table}[]
    \centering
    \begin{tabular}{|c|c|c|c|c|}
        \hline
         & P & B & S & A   \\
         \hline
       Incidence degree  & 2 & 1 & 2 & 3 \\
       \hline
       Adjacency degree & 2 & 1 & 2 & 3 \\
       \hline
       Betweeness centrality & 0 & 0 &  $\frac{2}{21}  $& $ \frac{2}{21} $\\
       \hline
    \end{tabular}
    \caption{Degree centralities for ubergraph representation}
    \label{tab2}
\end{table}
\gadd{Now, let us compare degree centralities in the directed hypergraph and ubergraph representations of higher-order interactions between Phorid, Azteca, Scale and Beetle (see Fig.~\ref{rep_of_coffee_comparison}, upper right). Firstly, we note that these representations haven't appeared in the literature, to the best of our knowledge. Therefore, we shall present them explicitly.}

\gadd{Let us start with dihypergraph representation $\mH = (V,\EH)$ where set of vertices $V=\{ P,A,S,B \}$ is the same as undirected case and set of dihyperedges is given by $\EH =\{ \Tilde{b}=(S,B), \Tilde{c}=(S,A), \Tilde{d}= (A,P), \Tilde{e}=( A,\{S,B \}) , \Tilde{f}=( P,\{A,S,B \}) \} $. Here, higher-order interactions are represented by dihyperedges directed from influencing node to influenced nodes. }

\begin{table}[]
    \centering
    \begin{tabular}{|c|c|c|c|c|}
        \hline
       & P & B & S & A   \\
       \hline 
       Incidence in-degree  & 1 & 3 & 2 & 2 \\
       \hline 
       Incidence out-degree  & 1 & 0 & 2 & 2 \\
       \hline 
       Adjacency in-degree & 1 & 6 & 5 & 4 \\
       \hline
       Adjacency out-degree & 3 & 0 & 2 & 3 \\
       \hline
    \end{tabular}
    \caption{Degree centralities for dihypergraph representation}
    \label{tab3}
\end{table}

\gadd{One can easily realise from Tables \ref{tab2} and \ref{tab3} that sum of incidence/adjacency in and out-degrees equals to incidence/adjacency degrees in undirected representation for all vertices. Moreover, Beetle is influenced more times (i.e. it has the highest incidence in-degree) and also the number of other nodes that influence it is the greatest (i.e. it has the highest adjacency in-degree). Notice that since there are no weights, the role of a direct relation is the same as the role of an indirect relation. }


\subsection{Scavenging}
\madd{The intertwined interactions between prey, its predators and scavengers are another example of species influencing interactions between other species~\cite{Moleon_scavenging}. The interactions between live prey, its carcasses, predators and scavengers are shown in Fig.~\ref{fig:scavenging}.}
\begin{figure}[h!]
	\begin{center}
        \includegraphics[width=0.7\linewidth]{./fig/Moleon_1_model.jpg}
        \caption{A model of four-way live prey-predator-carrion-scavenger interactions in \cite{Moleon_scavenging}, adapted from \cite{Getz_2011}.} 
    	\label{fig:scavenging}
    \end{center}
    \end{figure}
\madd{The dynamics of these interactions has been modelled through non-polynomial four-way interaction terms~\cite{Mellard2021}. Predators and scavengers affect each other by changing the time each spends handling its prey.}

\section{Conclusions}\label{sec:final}

\bibliographystyle{naturemag} 
\bibliography{hyp_dyn}	

\section{Discussion (general)}
\subsection{Ubergraph vs hypergraph rep of higher order interactions}

When and why is a hyperedge or an uberedge (interaction modification) important - and when is it enough to split it into independent pairwise edges?


Hypergraph rep. translates $(v_1, (v_2,v_3))$ to a hyperedge, e.g. $(v_1, {v_2,v_3})$ or $({v_1,v_2}, v_3)$.
In this way such interaction modifications are not distinguishable from 'true' hyperedges and information is lost. If $v_1$ would be removed from the system, the interaction $(v_2,v_3)$ would still exist in an ubergraph, while in a hypergraph there would need to be a separate hyperedge representing it.
\end{document}