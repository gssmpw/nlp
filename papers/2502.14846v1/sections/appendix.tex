\section{Implementation Details}
\subsection{Prompts}
We provide the prompt templates in Figure \ref{fig:prompt-html} for the \textit{HTMLDocumentPipeline} as an example to illustrate the prompts used across our code-guided synthetic data generation pipelines.
\input{prompts/pipeline}

\subsection{Rendering Tools and Pipelines}
We design 20 generation pipelines built on 11 rendering tools to support the creation of nine categories of text-rich images:(1) \textbf{Charts}: Matplotlib VegaLite, Plotly, LaTeX, HTML;
(2) \textbf{Documents}: LaTeX, HTML;
(3) \textbf{Tables}: LaTeX, Matplotlib, Plotly, HTML;
(4) \textbf{Diagrams}: Graphviz, LaTeX, Mermaid;
(5) \textbf{Math Problems}: LaTeX;
(6) \textbf{Vector Graphics}: SVG, Asymptote;
(7) \textbf{Music Sheets}: LilyPond;
(8) \textbf{Electrical Circuits}: LaTeX;
(9) \textbf{Chemical Structures}: Rdkit. 
In addition, we implement a separate pipeline for generating pointing data using HTML as the rendering tool.


\subsection{Queries to Construct CoSyn-400K} \label{appendix: query}
Since CoSyn accepts textual queries to control data generation, we use a diverse set of queries for each type of text-rich image to ensure broad domain coverage. 
Below are some examples of the queries used to generate CoSyn-400K:
\begin{itemize}[noitemsep, topsep=0pt, leftmargin=*]
    \item \textbf{Charts}: Bar, Line, Pie, Diverge bar, Bubble, Scatter, Histogram, Area, Box plot, Heatmap, Error bar, Radar chart, Rose chart, Stem plot, Stairs plot, Violin chart, 2D contour, Distplots, Log plot, Ternary plots/contour, Candlestick charts, Time series, etc. (\textbf{51} queries in total)
    % Waterfall charts, Funnel chart, Volcano plot Treemap, Hexbin plot, Strip plot, Manhattan plot, Mosaic chart, OHLC charts, Bullet chart, Gauge charts, Polar charts, Quiver plots, Icicle charts, Sankey diagram, Ranged dot plot (dumbbell), Gantt charts, Sunburst plot, Population pyramid, Density plot, Venn diagrams, Biplot, Blandâ€“Altman plot, Fan chart, Pareto chart, Ridgeline plot, Geographic plot, Isotype plot, 3D, Subplot.
    
    \item \textbf{Documents}: Letter, Form, Report, Receipt, Invoice, Restaurant menu, Newsletter, Schedule, Manual, Brochure, Transaction document, Agenda, Memo, Financial report, Telephone records, Note, Budget, Meeting minutes, Bill, Catalog, Email, Fax, Policy document, Resume, Infographics, Process infographic, Statistical infographic, etc. (\textbf{107} queries in total)
    
    % Informational infographics, Timeline infographic, Geographic infographic, Comparison infographic, List infographic, Hierarchical infographic, Infographic with charts, Poster, Envelope, Advertisement, Flyers, Greeting card, Business card, Certificate, Diploma, Contract, Whitepaper, Press release, Case study, User guide, Proposal, Presentation slide, Datasheet, Itinerary, Prescription, Medical record, Legal brief, Patent application, Transcript, Lease agreement, Warranty, Survey form, Questionnaire, Checklist, Shipping label, Ticket, Gift voucher, Calendar, Book cover, Magazine layout, Newspaper layout, Exam, Homework, Recipe card, Lesson plan, Syllabus, Bibliography, Table of contents, Index, Glossary, Scorecard, Ballot, Petition, Affidavit, Declaration, Deed, Product specification sheet, Lab report, Fact sheet, Weather report, Traffic report, Warning label, Meal plan, Workout plan, Expense report, Playbill, Eulogy, RSVP card, Wedding invitation, Obituary, SWOT analysis, Periodic report, Appraisal form, Packing list, Assembly instructions, Maintenance log, Incident report, Product wrapper, Product packaging, Webpage.
    \item \textbf{Math Problems}: Algebra, Counting, Probability, Geometry, Number theory, Precalculus, Prealgebra, Intermediate Algebra, Statistics, Functions, Complex numbers, Logarithms, Inequalities, Linear equations, Exponents, Series, College Algebra, Calculus, Advanced calculus, Linear algebra, Solid geometry, Analytic geometry, Polynomial arithmetic, etc. (\textbf{110} queries in total)
    % PSystems of equations, olynomial graphs, 
    % Transformations of functions, Trigonometry, Polynomial factorization, Permutations and combinations, Analysis of variance, Random variables, 
    % Confidence intervals, Expected value, Probability distributions, Rational expressions, Advanced function types, Vectors, Matrices, Limits and continuity, Combinatorics, Rational functions, Conic sections, Differential calculus, Vector-valued functions, Parametric equations, Polar coordinates, Ordinary differential equations, Partial differential equations, First-order differential equations, Second-order linear equations, Laplace transform, Fourier transform, Coordinate system, Topology, Set theory, Graph theory, Computational mathematics, Information theory, Numerical analysis, Mathematical logic, Game theory, Operations research, Discrete mathematics, Real analysis, Abstract algebra, Group theory, Ring theory, Number systems, Complex analysis, Time series analysis, Bayesian statistics, Multivariate statistics, Machine learning, Mathematical biology, Manifolds, Functional analysis, Computational complexity theory, Algorithm analysis, Optimization, Control theory, Decision theory, Quantitative finance, Lie algebras, Non-Euclidean geometry, Boolean algebra, Field theory, Algebraic geometry, Tensor calculus, Integral equations, Stochastic processes, Wave and heat equations, Nonlinear analysis, Inverse problems, Simulation and modeling, Dynamical systems, Cryptography, Chaos theory, Differential geometry, Knot theory, Statistical mechanics, Numerical methods, Mathematical physics, Spectral theory, Representation theory, Applied mathematics, Advanced probability, Number sequence, Derivative, Plane geometry.
    
    \item \textbf{Tables}: Financial table, Simple table, Pivot table, Comparison table, Timeline table, Decision table, Truth table, Lookup table, Periodic table, Statistical table, Timetable, Hierarchical table, Matrix table, Contingency table, Logarithmic table, Correlation table, etc. (\textbf{35} queries in total)
    %  Black-and-white, Bold, Highlight, Italic, Wide, Tall, Multi-head, Underlined, Sparse, Conversion table, Inventory table, Hierarchical table, Matrix table, Contingency table, Logarithmic table, Actuarial life table, Correlation table, Frequency distribution table, Lab results table, Table in research papers, Confusion matrix, Crosstab table, Amortization table.

    \item \textbf{Diagrams}: Flow chart, Directed graph, Undirected graph, Decision tree, Mind map, Gantt charts, Finite state machine, Quadrant chart, Chord diagrams, Network diagrams, Sankey diagram, Entity relationship diagram, Sequence diagrams, Bottom-up flow chart, Timeline, State diagram, Concept map, Family tree, Programming flowchart, etc. (\textbf{34} queries in total)
    % Clinical pathway, Food chain, Horizontal flowchart, Activity diagram, Data flow diagram, Flow chart of a function, Flow chart of an instruction, Block diagram, , Biomedical diagram, Natural science diagram, Social science diagram, Machine learning diagram, Astronomy diagram, Textbook diagram, Engineering diagram.

    \item \textbf{Vector Graphics}: Visual intelligence test, Spatial intelligence test, Geometry, Solid geometry, Analytic geometry, Polynomial graphs, Trigonometry, Polar coordinates, Coordinate system, Topology, Graph theory, Plane geometry, Functions, Calculus, Vectors, Angles, Perimeter and area problems, etc. (\textbf{36} queries in total)
    % Coordinate geometry, Transformational geometry, Congruence, Circle geometry, Non-Euclidean geometry, Physics, Mechanical engineering, Civil engineering, Electrical engineering, Diagrams, Astronomy, Group theory, Network, Biomechanics, Machine learning, College level, Highschool level, Graduate school level, Textbook.

    \item \textbf{Sheet Music}: Classical, Pop, Rock, Jazz, Blues, Hip Hop, Rap, Electronic, Country, Folk, Rhythm and blues, Soul, Reggae, Metal, Punk, Theme, Dance, etc. (\textbf{34} queries in total)
    % K-Pop, Experimental, Religious, Disco, Soundtracks, Opera, Symphony, Baroque, Latin, Funk, World music, House, Country rock, Fusion, Romantic, Electric blues, Famous.
    
    \item \textbf{Electrical Circuits}: Series, Parallel, Hybrid, Household appliances, Industrial appliances, Mobile device, Low-power appliances, High-power appliances, etc. (\textbf{30} queries in total)
    % Big device, Resistor-Capacitor, Resistor-Inductor, Resistor-Inductor-Capacitor, Bridge, Digital, Analog, Oscillator, Filter, Amplifier, Rectifier, Regulator, Voltage divider, Current divider, Charging, Communication, Protection, Synchronous, Asynchronous, Control, Logic gate.

    \item \textbf{Chemical Structures}: Drug, Organic, Inorganic, Protein, Acids, Bases, Gases, Liquids, Solids, Oxidizers, Flammable liquids, Toxic chemicals, Hazardous chemicals, Aromatic compounds, Aliphatic compounds, Polymers, Metals, Alloys, Electrolytes, etc. (\textbf{100} queries in total)
    % Non-electrolytes, Biochemicals, Enzymes, Hormones, Vitamins, Nucleic acids, Carbohydrates, Lipids, Amino acids, Alkaloids, Terpenes, Phenols, Ethers, Esters, Ketones, Aldehydes, Halogens, Noble gases, Acid anhydrides, Sulfur compounds, Phosphorus compounds, Silicon compounds, Organometallics, Complex ions, Coordination compounds, Chelates, Antioxidants, Surfactants, Detergents, Dyes, Pigments, Pesticides, Herbicides, Fungicides, Explosives, Lubricants, Refrigerants, Solvents, Monomers, Fibers, Ceramics, Photoreactive chemicals, Radiochemicals, Superacids, Superbases, Non-Newtonian fluids, Ionic liquids, Photoresists, Medicinal compounds, Cosmetic chemicals, Flavors and fragrances, Preservatives, Food additives, Plastics, Nanomaterials, Quantum dots, Graphene, Zeolites, Fullerenes, Radicals, Isotopes, Chiral compounds, Geometric isomers, Hypervalent compounds, Hydrocarbons, Organosilicon compounds, Organosulfur compounds, Organophosphorus compounds, Cage compounds, Cycloalkanes, Silanes, Fullerides, Peroxides, Ozonides, Carbenes, Nitriles, Imides, Hydrazines, Silanols, Boranes, Azides. 

\end{itemize}

\subsection{Academic Datasets}
During the supervised fine-tuning stage, we include academic datasets in addition to our synthetic datasets. Below, we provide details on the size of these datasets and the evaluation metrics used.

\smallbreak
\noindent \textbf{Dataset Size.}
The number in parentheses indicates the number of training images for each dataset: ChartQA (28.3K), DocVQA (39.5K), InfographicVQA (23.9K), AI2 Diagrams (11.4K), TextVQA (34.6K), VQAv2 (82.8K), GQA (72.1K), OK-VQA (9.0K), OCR-VQA (166.0K), A-OKVQA (17.1K), ScienceQA (6.2K), TabMWP (23.1K), ST-VQA (18.9K), TallyQA (133.0K), DVQA (200.0K), FigureQA (100.0K), PlotQA (160.0K).
We downsample some very large synthetic datasets, such as DVQA, FigureQA, and PlotQA, to balance the dataset size. 
In total, we use approximately 1.1M images from academic datasets.

\smallbreak
\noindent \textbf{Evaluation Metrics.} We adopt their official evaluation metrics for the seven text-rich datasets. 
For ChartQA, we use relaxed correctness, which allows a 5\% difference for float number answers. 
For DocQA and InfoQA, we report Average Normalized Levenshtein Similarity (ANLS).
For TableVQA, we report the average performance across the four subsets (VTabFact, VWTQ, VWTQ-Syn, FinTabNetQA) using the metrics provided in this \href{https://github.com/naver-ai/tablevqabench}{repo}.
We report the multiple choice accuracy for AI2D, VQA score \cite{balanced_vqa_v2} for TextVQA, and SQuAD F1 score \cite{rajpurkar-etal-2018-know} for ScreenQA.

\subsection{Training Details}

\smallbreak
\noindent \textbf{Image Preprocessing.} We adopt the same image preprocessing as Molmo \citep{deitke2024molmo}, where each input image is cropped into multiple overlapping crops before being encoded by CLIP. 
During training, we limit the maximum number of crops to 12, but we increase it to 25 at testing time to accommodate the high resolution of text-rich images. 
This strategy boosts the inference performance without increasing training costs.

\smallbreak
\noindent \textbf{Hyper Parameters.} We set the maximum sequence length for training is 2304 tokens. 
We use the same learning rate of 1e-6 for the MLP connector, LLM, and visual encoder, with batch size 32. 
The best-performing model is trained for 60K steps with 200 warm-up steps and a cosine scheduler with an end factor of 0.1. 
All experiments are run on a single TPU v3-128.

\section{Additional Analysis}
We conduct additional analyses below to investigate further why our synthetic data can effectively enhance vision-language models.

\smallbreak
\noindent \textbf{Our synthetic data is more diverse.} To quantify the diversity of images and text in our synthetic dataset $\mathcal{D} = \left\{\left(I, T\right)\right\}$, we propose the following two metrics to compute the diversity:
\vspace{-.3cm}
\begin{equation}
\scalebox{0.7}{$
    \text{\textbf{Diversity}}(\mathcal{D})_\text{\textbf{Image}} = \frac{1}{|\mathcal{D}|^2-|\mathcal{D}|} \sum_{I_i \in \mathcal{D}} \sum^{i \neq j}_{I_j \in \mathcal{D}} \left(1 - \text{sim}(I_i, I_j)\right)
$}
\end{equation}
\begin{equation}
\scalebox{0.7}{$
    \text{\textbf{Diversity}}(\mathcal{D})_\text{\textbf{Text}} = \frac{1}{|\mathcal{D}|^2-|\mathcal{D}|} \sum_{T_i \in \mathcal{D}} \sum^{i \neq j}_{T_j \in \mathcal{D}} \left(1 - \text{sim}(T_i, T_j)\right)
$}
\end{equation}
where sim$(\cdot)$ is the cosine similarity function. Both metrics compute the average pairwise cosine distance between the features of every instance in the dataset.
For image diversity, we extract features using CLIP, while for text diversity, we use Sentence-BERT \citep{reimers2019sentence} to obtain embeddings of question-answer pairs.
Table \ref{tab:diversity} shows that our synthetic charts are significantly more diverse than those in existing datasets, such as FigureQA and ChartQA, in both image and text diversity.

\input{tables/diversity}

\smallbreak
\noindent \textbf{Diversity correlates with model performance.} We observe that data diversity significantly affects model performance on downstream tasks. 
To investigate this, we compare synthetic chart data generated using only a single tool (Matplotlib) with charts generated by all five tools available in our CoSyn system. 
As shown in Table \ref{tab:diversity_performance}, using multiple tools results in higher image diversity and notably improved performance on ChartQA. This experiment underscores the importance of data diversity for enhancing the generalizability of models.

\input{tables/diversity_performance}

\begin{figure}[!ht]
\vspace{-.2cm}
  \begin{center}
    \includegraphics[width=7.5cm]{images/data_scale.pdf}
  \end{center}
  \vspace{-.2cm}
  \caption{\textbf{Scaling the Size of Synthetic Data.} We evaluate the \textit{zero-shot} performance on ChartQA of models fine-tuned on increasing numbers of synthetic images.}
  \vspace{-.2cm}
\label{fig: scale}
\end{figure}

\smallbreak
\noindent \textbf{Scaling the size of synthetic data.} In addition to diversity, the scale of synthetic data also impacts model performance. 
As shown in Figure \ref{fig: scale}, increasing the number of synthetic chart images leads to improved performance on ChartQA. This demonstrates that scaling up synthetic data can further enhance VLMs on downstream tasks. 
Due to resource constraints, our final dataset consists of 400K images, which cost us about \$8,000.
Future work could explore scaling up the dataset size to push the boundaries of synthetic data's potential.

\input{tables/cot}
\input{tables/ablation}

\smallbreak
\input{tables/llm}
\noindent \textbf{Compare LLMs for synthetic data generation.} In the default setting, CoSyn uses Claude-3.5-sonnet as the underlying LLM for code generation. 
\noindent To highlight the importance of strong coding capabilities, we compare it with data generated by GPT-4o. 
As shown in Table \ref{tab:llm_ablate}, synthetic data generated by Claude-3.5-sonnet yields significantly better results than GPT-4o.
Our qualitative observation reveals that GPT-4o has a higher failure rate in code generation, particularly for less common coding languages or libraries. 
This result emphasizes that a strong LLM is essential for the successful synthetic data generation for VLMs.


\smallbreak
\noindent \textbf{Quantify the contributions of synthetic data.} Table \ref{tab:train_data_ablation} presents the performance across benchmarks using different combinations of supervised fine-tuning data. 
A clear trend shows that synthetic data significantly contributes in both zero-shot and supervised settings. 
Adding our synthetic data consistently boosts performance on each benchmark.

\smallbreak
\noindent \textbf{The impact of Chain-of-thought reasoning.} We compare the performance of CoT and short-answer prompts in Table \ref{tab:cot}.
CoT reasoning improves performance on ChartQA, TableVQA, and NutritionQA, where questions require multi-hop and mathematical reasoning that aligns with the findings in language tasks \cite{sprague2024cot}.
However, short-answer prompts yield better results for the other five datasets due to their annotation biases favoring concise responses. 
CoT responses tend to be more verbose, which may not match the ground-truth answers exactly, resulting in a performance drop.

\smallbreak
\noindent \textbf{Document Pointing Task.} To further validate the effectiveness of our synthetic pointing data, we introduce DocPointQA\footnote{\href{https://huggingface.co/datasets/yyupenn/DocPointQA}{https://huggingface.co/datasets/yyupenn/DocPointQA}}, a new pointing task with 300 question-point pairs annotated from the DocVQA validation set (Figure \ref{fig: docpointqa}).
We compare models trained on human-annotated PixMo-point data (155K examples), our synthetic pointing data (65K examples), and their combination. 
Since DocPointQA requires multiple-point answers, we report precision, recall, F1 score, and L2 distance (lower is better) after mapping predicted points to ground truth, following the same setup as Molmo \cite{deitke2024molmo}.
As shown in Table \ref{tab:doc_point}, the model trained on our synthetic data outperforms the one trained on PixMo-point. 
Performance improves even further when both datasets are combined, demonstrating the effectiveness of synthetic data in enhancing the pointing capabilities of vision-language models.

\input{tables/point_doc}

\section{Qualitative Examples} \label{appendix: example}
Figure \ref{fig: nurition_qa} and \ref{fig: docpointqa} show the examples from our annotated NutritionQA\footnote{\href{https://huggingface.co/datasets/yyupenn/NutritionQA}{https://huggingface.co/datasets/yyupenn/NutritionQA}} and DocPointQA. 
Figures \ref{fig: chart_example} - \ref{fig: special_example} list examples from the 9 categories of synthetic text-rich images. Figure \ref{fig: point_example} illustrates examples from the synthetic pointing dataset.

\bigbreak
\noindent \textbf{Use of AI Assistants.} We use AI to fix some typos and grammar. Authors write all contents.

\clearpage
\begin{figure*}[!ht]
    \centering
    \includegraphics[width=\textwidth]{images/nutrition_qa.pdf}
    \caption{Examples from our newly collected \textbf{NutritionQA} dataset.}
    \label{fig: nurition_qa}
    \vspace{-0.3cm}
\end{figure*}

\begin{figure*}[!ht]
    \centering
    \includegraphics[width=\textwidth]{images/doc_point.pdf}
    \caption{Examples from our newly collected \textbf{DocPointQA} dataset.}
    \label{fig: docpointqa}
    \vspace{-0.3cm}
\end{figure*}

\begin{figure*}[!ht]
    \centering
    \includegraphics[width=\textwidth]{images/chart.pdf}
    \caption{Randomly selected examples from our synthetic \textbf{chart} data.}
    \label{fig: chart_example}
    \vspace{-0.3cm}
\end{figure*}

\clearpage
\begin{figure*}[!t]
    \centering
    \includegraphics[width=\textwidth]{images/document.pdf}
    \caption{Randomly selected examples from our synthetic \textbf{document} data.}
    \label{fig: document_example}
    \vspace{-0.3cm}
\end{figure*}

\begin{figure*}[!t]
    \centering
    \includegraphics[width=\textwidth]{images/table.pdf}
    \caption{Randomly selected examples from our synthetic \textbf{table} data.}
    \label{fig: table_example}
    \vspace{-0.3cm}
\end{figure*}

\begin{figure*}[!t]
    \centering
    \includegraphics[width=\textwidth]{images/math.pdf}
    \caption{Randomly selected examples from our synthetic \textbf{math} data.}
    \label{fig: math_example}
    \vspace{-0.3cm}
\end{figure*}
\clearpage

\begin{figure*}[!t]
    \centering
    \includegraphics[width=\textwidth]{images/diagram.pdf}
    \caption{Randomly selected examples from our synthetic \textbf{diagram} data.}
    \label{fig: diagram_example}
    \vspace{-0.3cm}
\end{figure*}

\begin{figure*}[!t]
    \centering
    \includegraphics[width=\textwidth]{images/graphic.pdf}
    \caption{Randomly selected examples from our synthetic \textbf{vector graphic} data.}
    \label{fig: graphic_example}
    \vspace{-0.3cm}
\end{figure*}

\begin{figure*}[!t]
    \centering
    \includegraphics[width=\textwidth]{images/special.pdf}
    \caption{Randomly selected examples from our synthetic \textbf{sheet music}, \textbf{circuits} and \textbf{chemical structures}.}
    \label{fig: special_example}
    \vspace{-0.3cm}
\end{figure*}

\begin{figure*}[!t]
    \centering
    \includegraphics[width=\textwidth]{images/point.pdf}
    \caption{Randomly selected examples from our synthetic \textbf{pointing} data.}
    \label{fig: point_example}
    \vspace{-0.3cm}
\end{figure*}