\section{Simulation Model}
Our computational framework integrates opinion dynamics principles with LLM-based agents to investigate polarization in social networks. The framework employs OpenAI's GPT-4o-mini model to create agents capable of generating naturalistic content and engaging in sophisticated social media interactions.

\input{tables/message_intensity}

The system comprises three primary components: (1) an agent-based architecture where individuals are characterized by distinct opinion values, personality traits, and interaction patterns; (2) an LLM infrastructure that enables content generation, stance analysis, and interaction evaluation; and (3) a social network structure that governs information dissemination through a recommendation mechanism. The network structure evolves dynamically through user-driven formation and dissolution of connections, reflecting real-world social media environments.

Operating through discrete time steps, each iteration encompasses content generation, agent interactions, and network evolution processes. This architecture enables the examination of emergent phenomena such as informational compartmentalization, cross-ideological discourse, and the influence of key actors in shaping network dynamics.

The model incorporates multiple interacting components with various parameters that require specification. While some of these parameters currently lack direct empirical grounding due to the novel nature of this approach, the framework's sophistication is intentional and serves several purposes. First, the non-linear dynamics in opinion updates and interaction modeling capture well-documented phenomena like confirmation bias and backfire effects, which simpler linear models cannot adequately represent. Second, the detailed parameterization provides the flexibility needed to systematically explore different aspects of social dynamics and polarization mechanisms. Third, while current parameter values are theoretical, the framework's structure allows for future empirical calibration as real-world data becomes available. We acknowledge that some model assumptions may not perfectly reflect real-world dynamics, but our primary goal at this stage is to create a sufficiently sophisticated proxy that captures key phenomena of interest while maintaining experimental control.

\subsection{Agent Model}
\label{subsec:agent-model}

Each agent $A_i$ in our simulation represents an individual user, characterized by a set of attributes that define its identity and behavior:

\begin{align}
A_i = \{o_i, d_i, b_i, u_i, H_i\}
\end{align}

where $o_i$ is a numerical value representing the agent's opinion on the topic under discussion, $d_i$ denotes the personality description, $b_i$ is a short biography, $u_i$ is a unique username, and $H_i$ represents the interaction history.

\input{tables/prompt_components}

The opinion $o_i$ of an agent is represented as a continuous value:

\begin{align}
o_i \in [-1, 1],
\end{align}

where $-1$ indicates strong opposition to the topic, $0$ represents a neutral stance, and $1$ indicates strong support. This continuous representation allows for nuanced changes in opinion over time. 

The initial opinion distribution can be implemented through different distributions depending on the simulated scenario. For communities with moderate views, we use a unimodal normal distribution:

\begin{align}
P(o) = \frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(o-\mu)^2}{2\sigma^2}}
\end{align}

For polarized societies, we employ a bimodal distribution:

\begin{align}
P(o) = \frac{1}{2}\left[\frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(o-\mu_1)^2}{2\sigma^2}} + \frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(o-\mu_2)^2}{2\sigma^2}}\right]
\end{align}

Finally, for scenarios with influential extremists, we use a trimodal distribution:

\begin{align}
P(o) = w_1\frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(o-\mu_1)^2}{2\sigma^2}} + w_2\frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(o-\mu_2)^2}{2\sigma^2}} + w_3\frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(o-\mu_3)^2}{2\sigma^2}}
\end{align}

where $\mu_i$ control the centers of the distributions, $\sigma$ controls the spread, and $w_i$ are weights satisfying $\sum w_i = 1$. For symmetric cases, $w_i = \frac{1}{3}$ and the extreme modes are placed at equal distances from the center ($\mu_1 = -\mu_3$). For asymmetric cases, the weights and modes can be adjusted to model one-sided influence.

Moreover, each agent maintains a finite interaction history $H_i = [h_1, h_2, ..., h_k]$, operating as a first-in-first-out queue to simulate human memory constraints. Both personality description $d_i$ and biography $b_i$ are automatically generated by the LLM. Finally, the model distinguishes between regular users and influencers, who share the same attribute structure but differ in their content generation tendencies and network influence. This hierarchical structure enables the study of influence dynamics while maintaining experimental control over opinion and interaction patterns.

\subsubsection{Message Generation}
\label{subsec:message-generation}

The probability of an agent generating a message at any time step is determined by their influence status:

\begin{align}
P_{\text{post}}(A_i) = \begin{cases}
p_{\text{inf}} & \text{if } A_i \text{ is an influencer} \\
p_{\text{reg}} & \text{otherwise}
\end{cases}
\end{align}


where $p_{\text{inf}} > p_{\text{reg}}$ reflects higher activity levels of influential accounts. Message characteristics are determined by the agent's opinion value $o_i$, with stance derived from its sign and intensity level from its absolute value.  Table \ref{tab:message-intensity} summarizes how different intensity levels influence message characteristics and rhetorical style and Table \ref{tab:prompt-components} depicts all prompt components.

\subsubsection{Interaction Mechanisms}
\label{subsec:interaction-mechanisms} 

Agents in our model interact with messages through likes, comments, and reposts. To capture the nuanced dynamics of these interactions in social media environments, we have developed a comprehensive probabilistic model. The probability of an agent $A_i$ reacting to a message $m$ is determined by the function $P_{\text{react}}(A_i, m)$:

\begin{align}
P_{\text{react}}(A_i, m) = p_b \cdot \big((1-w) + w \cdot \psi(o_i)\big) \cdot \rho(o_i, \pi(A_i, m))
\end{align}

\input{figures/functions}

This probability function combines several key elements: a base probability $p_b$ that varies by interaction type, an opinion-based interaction function $\rho$ that evaluates opinion alignment, an opinion strength factor $\psi(o_i)$, and an opinion assessment function $\pi$. The parameter $w$ controls the influence of opinion strength on the interaction probability.

The opinion assessment function $\pi(A_i, m)$ determines how agent $A_i$ interprets the opinion expressed in message $m$ through a LLM-based evaluation system. This function maps a message to an opinion value in the range [-1,1]:

\begin{align}
\pi: (A_i, m) \mapsto [-1,1]
\end{align}

The assessment considers multiple contextual factors: the message content, the current topic of discourse, the agent's personality traits, the agent's current opinion value $o_i$, and the agent's cumulative history of previous interactions. The LLM evaluates these components using a structured prompt that provides detailed guidelines for opinion assessment, including specific examples and rating scales.

The foundation of our model is the opinion-based interaction function $\rho$, which quantifies how the alignment between an agent's opinion and their message assessment influences interaction probability:

\begin{align}
\rho(o_i, \pi(A_i, m)) = \rho_{\text{con}}(o_i, \pi(A_i, m)) + c \cdot \rho_{\text{dis}}(o_i, \pi(A_i, m))
\end{align}

This function incorporates both concordant and discordant opinion components, mediated by a cross-ideology factor $c \in [0,1]$ which enables the model to capture differential responses to discordant viewpoints across various interaction modalities. This is particularly relevant in social media contexts where users demonstrate distinct behavioral patterns across different interaction types---for instance, exhibiting a greater propensity to comment on content they disagree with while preferentially liking aligned content. The probability components for concordant and discordant opinions are expressed as:

\begin{align}
\rho_{\text{con}}(o_i, \pi(A_i, m)) &= (1-\phi(|o_i - \pi(A_i, m)|))^{\gamma} \\
\rho_{\text{dis}}(o_i, \pi(A_i, m)) &= (\phi(|o_i - \pi(A_i, m)|))^{\gamma}
\end{align}

The response steepness parameter $\gamma = 10$ governs the sensitivity of the probability functions to opinion differences. Higher values of $\gamma$ would result in more pronounced differentiation between similar and dissimilar opinions, while lower values would produce more gradual transitions in the response curves. This parameter effectively controls the model's discrimination between varying degrees of opinion alignment.

To model the continuous transition between similar and opposing opinions, we employ a sigmoid function $\phi(x)$ that maps opinion differences to interaction probabilities:

\begin{align}
\phi(x) = \frac{1}{1 + e^{-\beta(x - \theta)}},
\end{align}

with parameters $\beta = 10$ and $\theta = 0.5$ chosen to create an appropriate transition steepness and midpoint for our opinion space. 

Finally, the model incorporates opinion strength through an additional sigmoid function with the same parameters:

\begin{align}
\psi(o_i) = \phi(|o_i|)
\end{align}

This component, weighted by the opinion strength importance parameter $w$, captures the observation that agents with more extreme opinions (approaching $\pm 1$) demonstrate higher baseline interaction probabilities. The opinion strength effect operates independently of the opinion difference, modulating the overall interaction probability based on the intensity of an agent's held beliefs.

As shown in Figure \ref{fig:opinion-reaction-functions}, the model generates an asymmetric U-shaped probability curve reflecting typical social media interaction patterns \citep{xu_user_2018, shahbaznezhad_role_2021}, with high probabilities for strongly aligned content through $\rho_{\text{sim}}$ and selective engagement with opposing viewpoints through $\rho_{\text{opp}}$ and the cross-ideology factor $c$. The interaction probability reaches its minimum for content that neither strongly agrees nor disagrees with an agent's opinion. Different reaction types are modeled through varying parameters: likes typically have high base probability $p_b$ but $c=0$ (supporting only agreeable interactions), while reposts and comments have progressively higher $c$ values to enable cross-ideological discourse. This parameterization captures key social media behaviors including confirmation bias effects, targeted cross-ideological interactions, and increased engagement from users with extreme opinions.

For both reposts and comments, the message generation process extends beyond simple interaction probabilities. When an agent decides to engage through these higher-order reactions, the system employs an extended version of the message generation framework that incorporates contextual awareness of the original content. This context-aware generation considers: The content and stance of the original message as well as an instruction to directly address, agree, or disagree with specific points or ideas from the original message.

\subsubsection{Opinion Update Process}
\label{subsec:opinion-update-process} 

Figure~\ref{fig:opinion-reaction-functions} illustrates the key mechanisms of our opinion update process, which determines how agents' opinions change in response to messages over time. The model captures several crucial social-psychological phenomena: confirmation bias manifests through stronger influence from attitude-consistent messages, while backfire effects emerge when agents encounter highly discordant views, causing them to move away from the message position. Additionally, agents holding extreme opinions show increased resistance to change, particularly when confronted with opposing views. These dynamics align with empirical findings on ideological polarization, where cross-ideological exposure can sometimes reinforce rather than moderate existing beliefs.

For each message, the opinion shift is calculated through a series of components. The process begins with the basic shift, defined as the difference between the message opinion $\pi(A_i, m)$ and the agent's current opinion $o_i$:

\begin{equation}
    \Delta o_{base} = \pi(A_i, m) - o_i
\end{equation}

To capture the tendency of individuals to be more influenced by messages that align with their existing beliefs, we introduce an alignment function:

\begin{equation}
    \alpha(o_i, \pi(A_i, m)) = \tanh(o_i \cdot \pi(A_i, m))
\end{equation}

The model accounts for the observation that individuals with extreme opinions are often less susceptible to change through a susceptibility function that utilizes the same sigmoid function $\phi$ defined in Section \ref{subsec:interaction-mechanisms}, with parameters $\beta = 10$ and $\theta = 0.5$:

\begin{equation}
    \psi_s(o_i) = 1 - \phi(|o_i|)
\end{equation}

The alignment and susceptibility functions are combined to create two components that model different aspects of opinion dynamics:

\begin{align}
    \xi_{con}(o_i, \pi(A_i, m)) &= \psi_s(o_i) \cdot \frac{1 + \alpha(o_i, \pi(A_i, m))}{2} \\
    \xi_{dis}(o_i, \pi(A_i, m)) &= (1 - \psi_s(o_i)) \cdot \frac{\alpha(o_i, \pi(A_i, m)) - 1}{2}
\end{align}

The function $\xi_{con}(o_i, \pi(A_i, m))$ represents the influence of concordant messages and moderately discordant messages on non-extreme opinions. The function $\xi_{dis}(o_i, \pi(A_i, m))$ captures the potential backfire effect where exposure to strongly discordant views can reinforce extreme opinions.

These components are integrated into the shift calculation:

\begin{equation}
    \omega(o_i, \pi(A_i, m)) = \Delta o_{base} \cdot (\xi_{con}(o_i, \pi(A_i, m)) + \xi_{dis}(o_i, \pi(A_i, m)))
\end{equation}

To ensure the calculated shift remains within the bounds of the opinion scale [-1, 1], we employ a bounding sigmoid function $\zeta$:

\begin{equation}
    \zeta(x) = \frac{2}{1 + e^{-x}} - 1
\end{equation}

This function maps any real input to the interval [-1, 1], yielding the final opinion shift:

\begin{equation}
    \Delta o = \zeta(\omega(o_i, \pi(A_i, m)))
\end{equation}

The model then aggregates the shifts from multiple messages to determine the overall opinion change. This aggregation is weighted by a learning rate $\lambda$, which can be adjusted based on the time progress of the simulation:

\begin{equation}
    \Delta o_{total} = \lambda \cdot \sum_{j=1}^{n} \Delta o_{j}
\end{equation}

where $n$ is the number of messages processed in the current update, and the final agent's opinion remains constrained to the [-1, 1] range.

\subsection{Social Network Model}
\label{subsec:social-network-model}

The social network in our simulation is modeled as a directed graph, representing the complex web of connections between agents. This structure captures the asymmetric nature of relationships in many social media platforms, where users can follow others without reciprocation.

\subsubsection{Network Structure}

We define the social network as a directed graph $G = (V, E)$, where $V$ is the set of vertices representing agents, and $E$ is the set of edges representing follow relationships. Formally:

\begin{align}
    G &= (V, E) \\
    V &= \{A_1, A_2, ..., A_n\} \\
    E &\subseteq \{(A_i, A_j) \mid A_i, A_j \in V, i \neq j\}
\end{align}

where $n$ is the total number of agents in the simulation. An edge $(A_i, A_j) \in E$ indicates that agent $A_i$ follows agent $A_j$.

The network's initial state is generated using a probabilistic model that considers both opinion alignment and agent status (regular user or influencer). For any two agents $A_i$ and $A_j$, the probability of a connection forming is given by:

\begin{align}
P((A_i, A_j) \in E) = \begin{cases}
p_i & \text{if } \text{sgn}(o_i) = \text{sgn}(o_j) \text{ and } A_j \text{ is an influencer} \\
p_s & \text{if } \text{sgn}(o_i) = \text{sgn}(o_j) \text{ and } A_j \text{ is not an influencer} \\
p_d & \text{if } \text{sgn}(o_i) \neq \text{sgn}(o_j)
\end{cases}
\end{align}

where $p_i$, $p_s$, and $p_d$ are the connection probabilities for influencers, regular agents with the same opinion sign, and agents with different opinion signs, respectively. The function $\text{sgn}(o)$ determines the sign of an opinion value, effectively grouping agents into pro ($o > 0$) and contra ($o < 0$) stances. This model implements homophily by favoring connections between agents of similar opinions ($p_s > p_d$), while also capturing the elevated probability of following influential users within one's own opinion group ($p_i > p_s > p_d$).

\subsubsection{Connection Dynamics}

The evolution of social connections between agents serves two distinct purposes in our simulation framework. First, it shapes the information flow within the network by influencing the content recommendation process for each agent. Second, it provides essential social cues to human study participants by displaying realistic follower and following relationships in agent profiles, thereby enhancing the ecological validity of our experimental platform.

The network structure evolves through two primary mechanisms: the formation of new connections (following) and the dissolution of existing ones (unfollowing). The probability of agent $A_i$ establishing a new connection with a recommended agent $A_j$ at time $t$ is modeled as:

\begin{align}
    P_{\text{follow}}(A_i, A_j) =  f_b + f_o(1 - |o_i - o_j|) + f_i I_j
\end{align}

where $f_b$ is a base follow probability, $f_o$ scales the influence of opinion similarity, $f_i$ scales the influence of the target agent's influence score $I_j$. The influence score $I_j$ is calculated as the ratio of the number of followers of agent $A_j$ to the total number of agents in the network.

Conversely, the probability of agent $A_i$ unfollowing an existing connection $A_j$ at time $t$ is:

\begin{align}
    P_{\text{unfollow}}(A_i, A_j) = \frac{u_b}{1 + I_j}
\end{align}

where $u_b$ is a base unfollow probability, and $I_j$ is the influence score of agent $A_j$. This formulation makes it less likely for agents to unfollow influential users.

The dynamic connection processes, coupled with the opinion dynamics model, create a feedback loop that can lead to emergent phenomena such as opinion polarization or consensus formation. This evolving network structure allows for the simulation of complex social dynamics observed in real-world online social networks.

\subsection{Information Propagation}
\label{subsec:information-propagation}

The propagation of information through our simulated social network is governed by a recommendation system that determines message visibility and user exposure patterns. This system implements an agent-centric approach that considers both network structure and opinion alignment while maintaining controlled exposure to diverse viewpoints.

At the core of our recommendation mechanism lies an influence-based scoring system that evaluates message authors based on their position within the social network. For a given agent $A_j$, we define their influence score $\eta$ as:

\begin{align}
\eta(A_j) = \frac{|\text{followers}(A_j)|}{|\mathcal{V}| - 1}
\end{align}

where $|\text{followers}(A_j)|$ represents the number of followers of agent $A_j$, and $|\mathcal{V}|$ is the total number of nodes in the social graph. This normalization ensures that the influence score remains bounded between 0 and 1.

The recommendation process for a target agent $A_i$ operates on the set of available messages $\mathcal{M}$. To ensure fresh content delivery and prevent redundant exposure, we first construct the set of eligible messages $\mathcal{M}_{A_i}$ by excluding all messages that agent $A_i$ has previously interacted with and their own messages:

\begin{align}
\mathcal{M}_{A_i} = \{m \in \mathcal{M} : m \text{ not interacted with by } A_i \land \text{auth}(m) \neq A_i\}
\end{align}

The recommendation system can operate in two modes: pure influence-based and homophily-aware. In the homophily-aware mode, we introduce a homophily parameter $h_r \in [0, 1]$ that determines the probability of recommending same-stance content. For an agent $A_i$ and a message $m$, the recommendation score $\sigma$ is calculated as:

\begin{align}
\sigma(A_i, m) = \begin{cases}
\eta(\text{auth}(m)) & \text{with probability } h_r \text{ if } \text{sgn}(o_i) = \text{sgn}(o_{\text{auth}(m)}) \\
\eta(\text{auth}(m)) & \text{with probability } (1-h_r) \text{ if } \text{sgn}(o_i) \neq \text{sgn}(o_{\text{auth}(m)})
\end{cases}
\end{align}

where $\text{sgn}(o)$ determines the sign of an opinion value, effectively grouping agents into pro ($o > 0$) and contra ($o < 0$) stances. The parameter $h_r$ controls the degree of homophily in recommendations, with $h_r = 1.0$ creating perfect echo chambers and $h_r = 0.5$ providing balanced exposure.

The final set of recommended messages $\mathcal{R}_{A_i}$ for agent $A_i$ is then constructed by selecting messages with the highest recommendation scores:

\begin{align}
\mathcal{R}_{A_i} = \text{top}_N\{m \in \mathcal{M}_{A_i} : \text{ranked by } \sigma(A_i, m)\}
\end{align}

where $N$ is the desired number of recommendations and $\text{top}_N$ selects the $N$ highest-scoring messages according to the combined influence and homophily scores.

\subsection{Simulation Workflow}

In our simulation model, the workflow, as outlined in Algorithm \ref{alg:social-simulation}, consists of initialization and iterative simulation phases, each designed to capture specific aspects of social media dynamics.

The initialization stage establishes the foundational elements of the simulation environment by creating a population of agents with unique attributes as described in Section~\ref{subsec:agent-model}, and constructing the initial social network structure. The network initialization process accounts for opinion distributions and influencer designations to create realistic social relationships between agents.

The core simulation operates through discrete time steps, with each iteration representing a distinct period of social media activity. During the content generation phase, the simulation iterates through all agents to determine if they will create a post, following the probabilities and characteristics outlined in Section~\ref{subsec:message-generation}. Regular users and influencers have different base probabilities of posting, with influencers being more likely to generate content.

\input{figures/pseudo_code}

After new content is generated, the simulation processes each agent's interactions with the social network. The recommendation system   determines which messages are presented to each agent based on the scoring mechanisms detailed in Section~\ref{subsec:information-propagation}. Agents then have opportunities to interact with the recommended content through likes, comments, and reposts, following the interaction model introduced in Section~\ref{subsec:interaction-mechanisms}. Each interaction is recorded in both the message's interaction tracking and the agent's memory, maintaining a finite history of their social activities.

Following the interaction phase, the model updates agent opinions based on their exposure to and engagement with messages, as described in our opinion update process (Section~\ref{subsec:opinion-update-process}). This opinion evolution can in turn influence future interactions and network dynamics. Throughout this process, the social network structure continues to evolve as agents form new connections and dissolve existing ones based on their interaction patterns. This dynamic network structure influences future content recommendations and interaction opportunities, creating a continuous feedback loop that shapes the evolution of the social network.