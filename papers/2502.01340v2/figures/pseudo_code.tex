\begin{algorithm}[H]
\small
\SetAlgoNlRelativeSize{-1}
\SetInd{0.5em}{0.5em}
\KwData{$n_{agents}$, $n_{iterations}$, $n_{recs}$, $p_{reg}$, $p_{inf}$, $topic$}
\SetKwFunction{InitAgents}{InitializeAgentPopulation}
\SetKwFunction{InitNetwork}{InitializeNetwork}
\SetKwFunction{IsInfluencer}{IsInfluencer}
\SetKwFunction{CreateMsg}{CreateMessage}
\SetKwFunction{RecMsgs}{RecommendMessages}
\SetKwFunction{ModelInts}{ModelInteractions}
\SetKwFunction{UpdateMem}{UpdateAgentMemory}
\SetKwFunction{UpdateNet}{UpdateNetwork}
\SetKwFunction{CalcShift}{CalculateOpinionShift}
$\mathcal{A} \leftarrow$ \InitAgents{$n_{agents}$, $topic$};\\
$\mathcal{G} = (\mathcal{V}, \mathcal{E}) \leftarrow$ \InitNetwork{$\mathcal{A}$};\\
$\mathcal{M} \leftarrow \emptyset$;\\
\For{$t \leftarrow 1$ \KwTo $n_{iterations}$}{
    $\mathcal{M}_t \leftarrow \emptyset$;\\
    
    \For{$A_i \in \mathcal{A}$}{
        $p_{post} \leftarrow$ \IsInfluencer{$A_i$} ? $p_{inf}$ : $p_{reg}$;\\
        
        \If{Random() < $p_{post}$}{
            $m \leftarrow$ \CreateMsg{$A_i$, $t$};\\
            $\mathcal{M}_t \leftarrow \mathcal{M}_t \cup \{m\}$;\\
            \UpdateMem{$A_i$, $m$};
        }
    }
    
    $\mathcal{M} \leftarrow \mathcal{M} \cup \mathcal{M}_t$;\\
    
    \For{$A_i \in \mathcal{A}$}{
        $\mathcal{R}_{A_i} \leftarrow$ \RecMsgs{$A_i$, $\mathcal{M}$, $\mathcal{G}$, $n_{recs}$};\\
        $\mathcal{I}_{A_i} \leftarrow$ \ModelInts{$A_i$, $\mathcal{R}_{A_i}$};\\
        \For{$m_j \in \mathcal{R}_{A_i}$}{
            $\Delta o_j \leftarrow \zeta(\omega(o_i, o_m))$;\\
        }
        $\Delta o_{total} \leftarrow \lambda \cdot \sum_{j=1}^{|\mathcal{R}_{A_i}|} \Delta o_j$;\\
        $o_i \leftarrow \max(\min(o_i + \Delta o_{total}, 1), -1)$;\\
        \UpdateMem{$A_i$, $\mathcal{R}_{A_i}$, $\mathcal{I}_{A_i}$};\\
        $\mathcal{G} \leftarrow$ \UpdateNet{$A_i$, $\mathcal{G}$};
    }
}
\caption{Social Network Simulation}
\label{alg:social-simulation}
\end{algorithm}