\appendix 
\crefalias{section}{appendix} 

\input{appendix_prelims}

\section{Summary of Approach}\label{apx:final-algo}
In this section we present an overview of all the steps that
are involved in our algorithm underlying \Cref{thm:main-result}:
\begin{itemize}
    \item We first split the training $\rS$ into three equally-sized parts $\rS_1, \rS_2, \rS_3.$

    \item We use $\rS_2$ to train the algorithm of \citet{hanneke2024revisiting}. We call
    this classifier $\tilde \CA_1.$

    \item We split $\rS_1$ into three equally-sized parts,
    $\rS_{1,1}, \rS_{1,2}, \rS_{1,3}.$ 

    \item We run the splitting scheme of \Cref{alg:splittingwith27} on $(S_{1,1}, \emptyset)$ and $(S_{1,2}, \emptyset)$. 
    Let $\CS_1, \CS_2$ be the two sets of training subsequences outputted by these algorithms.

    \item We sample $t= O \big(\ln{\left(m/(\delta(d+\ln{\left(1/\delta \right)})) \right)} \big) $  sequences from both $\CS_1, \CS_2$
    uniformly at random. Let $\hat \CS_1, \hat \CS_2$
    be these sequences.

    \item We train an $\cerm$ on every sequence
    appearing in $\hat \CS_1, \hat \CS_2,$
    and we denote by $\hat \CA_{\rt_1}, \hat \CA_{\rt_2}$
    a majority vote classifier over the $\cerm$s trained on $\hat \CS_1, \hat \CS_2,$ respectively. 

    \item Using the training set $\rS_{1,3},$
    we create a set $\rS_3^{\not=}$ as follows:
    for any $(x,y) \in S_{1,3}$
    if at least a $11/243$-fraction of
    the votes from $\hat \CA_{\rt_1}$ on $x$
    do not vote $y$ (or a $11/243$-fraction of
    the votes from $\hat \CA_{\rt_2}$ on $x$
    do not vote $y$), then $(x,y) \in \hat \rS_3^{\not=}$.
    Then, we train an $\cerm$ on $\hat \CS_3,$
    which we call $\htie.$

    \item Having done that, we consider 
    an algorithm $\tilde \CA_2$ that works 
    as follows on any given $x:$ if a $232/243$-fraction of the classifiers of both $\hat \CA_{\rt_1}$ and $\hat \CA_{\rt_2}$ agree on a label $y,$
    then we predict $y.$ Otherwise we output
    the prediction of $\htie.$

    \item We use the examples of $\rS_3$
    to test the performance of both $\tilde \CA_1, \tilde \CA_2$ and the final classifier
    we output is the one that had the smallest
    error on $S_3$ among these two.
 \end{itemize}


\section{Analysis of $\widehat{\cA}_{\rt}$}

As described in the proof sketch, we require a bound on $\ls_{\cD}^{10/243}\cA(S;\emptyset)$ in order to upper bound $ \ls_{\cD}^{11/243}(\widehat{\cA}_{\rt})$.  
Thus, we now present our error bound for \cref{alg:splittingwith27} when running $ \erm $ on each dataset generated on $\cS(\rS,\emptyset)$. (We assume that $ |\rS| =3^{k}$ for $ k\in\mathbb{N}$, at the cost of discarding a constant fraction of training points.)       


\begin{lemma}\label{lem:upperbound}
    There exists a universal constant $ c \geq 1$ such that: For any hypothesis class $ \cH $ of VC dimension $ d $, distribution $ \cD $ over $ \cX\times\cY,$ failure parameter $ 0<\delta<1 $, training sequence size $ m=3^{k} $ for $ k\geq 6 $, and training sequence $  \rS\sim \cD^{m},$ with probability at least $ 1-\delta $ over $ \rS $ one has that  
    \begin{align*}
        \ls_{\cD}^{10/243}\big(\erm(\rS;\emptyset)\big)  
        \leq c\tau+\frac{c\left(d+\ln{(e/\delta )}\right)}{m}.
    \end{align*}
\end{lemma}

Let us defer the proof of \Cref{lem:upperbound} 
for the moment, and proceed with presenting the main theorem of this section, assuming the claim of \Cref{lem:upperbound}. 

\begin{theorem}\label{thm:main}
    There exists a universal constant $ c \geq1$ such that: For any hypothesis class $ \cH $ of VC dimension $ d $, distribution $ \cD $ over $ \cX\times\cY,$ failure parameter $ 0<\delta<1 $, training sequence size $ m=3^{k} $ for $ k\geq 6 $, training sequence $  \rS\sim \cD^{m},$ and sampling size $ t\geq4\cdot 243^{2}\ln{\left(2m/(\delta(d+\ln{\left(1/\delta \right)})) \right)},$ we have with probability at least $ 1-\delta $ over $ \rS $ and the randomness $ \rt $  used to draw $ \widehat{\erm}_{\rt}(\rS) $ that:
    \begin{align*}
     \ls_{\cD}^{11/243}(\widehat{\erm}_{\rt}(\rS) )\leq  c\tau+\frac{c\left(d+\ln{(e/\delta )}\right)}{m}.
    \end{align*}
\end{theorem}
\begin{proof}
Let $ \widehat{\erm}_{\rt}(S;\emptyset)=\{\rh_{1},\ldots,\rh_{t}  \}$, considered as a multiset, and recall that the $\rh_{i} $ are drawn uniformly at random from $ \erm(S;\emptyset)=\{ \erm(S') \}_{S'\in\cS(S;\emptyset)} $, which is likewise treated as a multiset.
Let $ E_{\rS} $ denote the event 
\[ E_{\rS}= \left \{(x,y) \; \Big| \sum_{h\in \erm(\rS;\emptyset)}\frac{\ind\{ h(x)\not=y \}}{|\erm(\rS;\emptyset)|} \geq \frac{10}{243}  \right \} \]
and 
\[ \bar{E}_{\rS}= \left \{(x,y) \; \Big| \sum_{h\in \erm(\rS;\emptyset)}\frac{\ind\{ h(x)\not=y \}}{|\erm(\rS;\emptyset)|} < \frac{10}{243}  \right \} \]
its complement. Now fix a realization $S$ of $ \rS $. Using the fact that $ \p\left[A\right]=\p\left[A\cap B\right]+\p\left[A\cap \bar{B}\right]$, we have that 
\begin{align}\label{eq:uppsampledbound1}
\ls_{\cD}^{11/243}(\widehat{\erm}_{\rt}(S;\emptyset) )
    &= \p_{(\rx,\ry)\sim \cD}\left[\sum_{i=1}^{t} \ind\{   \rh_{t}(\rx)\not=\ry\}/t\geq \frac{11}{243}, E_{S}\right] \notag \\ 
    & \qquad +\p_{(\rx,\ry)\sim \cD}\left[\sum_{i=1}^{t} \ind\{   \rh_{t}(\rx)\not=\ry\}/t\geq\frac{11}{243}, \bar{E}_{S}\right] \notag
    \\
    &\leq \p_{(\rx,\ry)\sim\cD}\big [E_{S}\big]+\p_{(\rx,\ry)\sim \cD}\left[\sum_{i=1}^{t} \ind\{   \rh_{t}(\rx)\not=\ry\}/t\geq\frac{11}{243}, \bar{E}_{S}\right]. 
\end{align} 
We now bound each term in the above, i.e., in \Cref{eq:uppsampledbound1}.

In pursuit of bounding the second term, consider a labeled example $ (x,y)\in\bar{E}_{S}$. We may assume that $ \bar{E}_{S} $ is non-empty, as otherwise the term is simply $0$.
Now, for any such labeled example $(x,y) \in \bar{E}_{S}$ we have that  $ \sum_{i=1}^{t} \ind\{ \rh_{i}(x)=y \} $  has expectation 
\[ \mu_{(x,y)}:=\e_{\rt}\left[\sum_{i=1}^{t} \ind\{ \rh_{i}(x)=y \}\right]=t\cdot\left(\sum_{h\in \erm(\rS;\emptyset)} \frac{\ind\{ h(x)=y \}}{|\erm(\rS;\emptyset)|} \right)\geq (1-\nicefrac{10}{243} \cdot t ) \geq t/2, \] 
where the final inequality follows from the fact that $ (x,y)\in \bar{E}_{S}$. (Recall that we use the boldface symbol $\rt$ to denote the randomness underlying the random variables $ \rh_{1},\ldots,\rh_{t}$.)  
Now, since $ \ind\{ \rh_{i}(x)\not=y \} $ is a collection of i.i.d.\ $\{0,1\}-$random variables, we have by the Chernoff inequality that 
\begin{align*}
 \p_{\rt} \left[\sum_{i=1}^{t} \frac{\ind\{ \rh_{i}(x)=y \}}{t} \leq \left (1-\frac{1}{243} \right)\mu_{(x,y)}\right] &\leq \exp{\left(\frac{-\mu_{(x,y)}}{2\cdot 243^{2}}\right)} \\
 & \leq \frac{\delta\big(d+\ln{\left(1/\delta \right)}\big)}{2m}, 
\end{align*}
where the final inequality follows from the fact that $ \mu_{(x,y)}\geq \nicefrac t2 $ and  
\[ t\geq 4\cdot 243^{2}\ln\left(\frac{2m}{\delta\big(d+\ln{\left(1/\delta \right)}\big)} \right). \]  
The above implies that with probability at least $ 1-\frac{\delta(d+\ln{\left(1/\delta \right)})}{2m}$, we have  
\[ \sum_{i=1}^{t} \frac{\ind\{ \rh_{i}(x)=y \}}{t} > \left( 1-\frac{1}{10} \right) \mu_{(x,y)} \geq \left( 1- \frac{1}{243} \right) \left( 1 - \frac{10}{243} \right) = 1 - \frac{11}{243}. \] 
This further implies that $ \sum_{i=1}^{t} \ind\{ \rh_{i}(x)\not=y \}/t< 11/243$  with probability at most $ \frac{\delta(d+\ln{\left(1/\delta \right)})}{2m}$.
As we demonstrated this fact for any pair $(x,y)\in \bar{E}_{S}$, an application of Markov's inequality yields that 
\begin{align}\label{eq:uppsampledbound2}
 &\p_{\rt}\left[\p_{(\rx,\ry)\sim \cD}\left[\sum_{i=1}^{t} \ind\{   \rh_{t}(\rx)\not=\ry\}/t\geq\frac{11}{243}, \bar{E}_{S}\right]\geq \frac{(d+\ln{\left(1/\delta \right)})}{m}\right] \hspace{2cm} \notag 
 \\
& \qquad \quad \leq \frac{(d+\ln{\left(1/\delta \right)})\e_{(\rx,\ry)\sim \cD}\left[ \p_{\rt} \left[\sum_{i=1}^{t} \ind\{   \rh_{t}(\rx)\not=\ry\}/t\geq\frac{11}{243}\right] \ind \{   \bar{E}_{S}\} \right]}{m} \notag \\
& \qquad \quad \leq \frac{\delta}{2}. 
\end{align}
Note that the first inequality follows from an application of Markov's inequality and the observation that $ \bar{E}_{S} $ depends only upon $ (\rx,\ry)$ and $ \rt $, which are independent from one another, meaning we can swap the order of expectation. 
The final inequality follows from the bound on the probability of $ \sum_{i=1}^{t} \ind\{   \rh_{t}(\rx)\not=\ry\}/t\geq\frac{11}{243}  $ happening over $ \rt $,  for $ x,y\in\bar{E}_{S}$.

Thus, we conclude that with probability at least $1 - \delta/2$ over $\rt$, the random draw of the hypothesis in $ \widehat{\erm}_{\rt}(S;\emptyset) $ is such that  
\[ \p_{(\rx,\ry)\sim \cD}\left[\sum_{i=1}^{t} \frac{\ind\{   \rh_{t}(\rx)\not=\ry\}}{t} \geq \frac{11}{243} , \bar{E}_{S}\right]\leq \frac{d+\ln{\left(1/\delta \right)}}{2m}. \]  
Furthermore, as we showed this for any realization $S$  of $\rS$ (and $ \rt $ and $ \rS $ are independent), we conclude that, with probability at least $ 1-\delta/2$ over both $ \rt $ and $ \rS $,
\[ \p_{(\rx,\ry)\sim \cD}\left[\sum_{i=1}^{t} \frac{\ind\{   \rh_{t}(\rx)\not=\ry\}}{t} \geq \frac{11}{243}, \bar{E}_{\rS}\right]\leq \frac{d+\ln{\left(1/\delta \right)}}{m}.\] 
Furthermore, by \cref{lem:upperbound}, we have that with probability at least $ 1-\delta/2 $ over $ \rS $, 
\begin{align}\label{eq:uppsampledbound3}
    \p_{(\rx,\ry)\sim\cD}\left[E_{\rS}\right]\leq   c\tau +\frac{c\left(d+\ln{(2e/\delta )}\right)}{m}.
\end{align}
Furthermore, as this event does not depend on the randomness $ \rt $ employed in drawing hypotheses for $ \widehat{\erm}_{\rt}(\rS),$ we conclude that the above also holds with probability at least $ 1-\delta/2 $ over both $ \rS $ and $ \rt.$ 
Now, applying a union bound over the event in \Cref{eq:uppsampledbound2} and \Cref{eq:uppsampledbound3}, combined with the bound on $ \ls_{\cD}(\widehat{\erm}_{\rt}(\rS)) $ in \Cref{eq:uppsampledbound1}, we get that, with probability at least $ 1-\delta $ over $ \rS $ and $ \rt $, it holds that 
\begin{align*}
    \ls_{\cD}^{11/243}(\widehat{\erm}_{\rt}(\rS))\leq c\tau +\sqrt{\frac{c\tau \left(d+\ln{(2e/\delta )}\right)}{m}}+\frac{(1+c)\left(d+\ln{(2e/\delta )}\right)}{m}.
\end{align*}
As $c$ is permitted by any absolute constant, this concludes the proof. 
\end{proof}

We now proceed to give the proof of \Cref{lem:upperbound}. Doing so will require two additional results, the first of which relates the empirical error of a hypothesis $h$ to its true error. 


\begin{lemma}[\cite{Understandingmachinelearningfromtheory} Lemma B.10]\label{lem:additiveerrorhstar}
Let $\cD$ be a distribution over $\cX \times \{-1, 1\}$, $h \in \{-1, 1\}^\cX$ be a hypothesis, $\delta \in (0, 1)$ a failure parameter, and $m \in \N$ a natural number. Then, 
    \begin{align*}
        \p_{\rS \sim \cD^m}\left[\ls_{\rS}(h)\leq \ls_{\cD}(h) +\sqrt{\frac{2\ls_{\cD}(h)\ln{(1/\delta )}}{3m}}+\frac{2\ln{(1/\delta )}}{m} \right] 
        \geq 1-\delta,
    \end{align*}
and 
\begin{align*}
    \p_{\rS \sim \cD^m} \left[\ls_{\cD}(h)\leq \ls_{\rS}(h) +\sqrt{\frac{2\ls_{\rS}(h)\ln{(1/\delta )}}{m}}+\frac{4\ln{(1/\delta )}}{m} \right] 
    \geq 1-\delta.
\end{align*}  
\end{lemma}

The second result we require is one which bounds the error of $ \erm(S;T)$ for arbitrary training sets $T$ (i.e., not merely $T = \emptyset$, as we have previously considered). 

\begin{theorem}\label{thm:upperbound}
    There exists, universal constant $ c\geq1 $ such that: For any a hypothesis class $\cH$ of VC dimension $ d $, any distribution $ \cD $ over $ \cX\times\{  -1,1\}  $, any failure parameter $\delta \in (0, 1)$, any training sequence size $ m=3^{k} $, any training sequence $ T\in (\cX\times\{-1,1  \})^{\star} $, and a random training sequence $ \rS\sim\cD^{m},$ it holds with probability at least $ 1-\delta $ over $ \rS $ that:        
    \begin{align*}
        \ls_{\cD}^{10/243}(\erm(\rS;T))
        \leq  \max\limits_{S'\in\cS(\rS;T)}\frac{c\Sigma_{\not=}(\hs\negmedspace,S')}{m/s_{\sqcap}}+\frac{c\left(d+\ln{(1/\delta )}\right)}{m},
    \end{align*}
    where
    \[ \Sigma_{\not=}(\hs\negmedspace,S') =\sum\limits_{(x,y)\in S'} \ind\{ \hs(x)\not=y \}. \] 
\end{theorem}

Let us first give the proof of \Cref{lem:upperbound} assuming  \Cref{thm:upperbound}, and subsequently offer the proof of \Cref{thm:upperbound}. \\

\begin{proofof}{\Cref{lem:upperbound}}
First note that for each $i \in\{ 1,\ldots,27\}$, 
\begin{align*}
\max\limits_{S'\in \cS(\rS_{i,\sqcup}; \rS_{i,\sqcap})} \frac{\Sigma_{\not=}(\hs\negmedspace,S')}{m/s_{\sqcap}} & =\max\limits_{S'\in \cS(\rS_{i,\sqcup};\rS_{i,\sqcap})} \sum\limits_{(x,y)\in S'}\frac{\ind\{ \hs(x)\not=y \}}{(m/s_{\sqcap})} \\
&\leq \frac{|\rS_{i,\sqcap}\sqcup\rS_{i,\sqcup}|}{(m/s_{\sqcap})}
\sum_{(x,y)\in \rS_{i,\sqcap}\sqcup\rS_{i,\sqcup}}\frac{\ind\{ \hs(x)\not=y \}}{|\rS_{i,\sqcap}\sqcup  \rS_{i,\sqcup}|} \\ 
&= 2\ls_{\rS_{i}}(\hs). 
\end{align*}
The inequality follows from the fact that any $S'\in \cS(\rS_{i,\sqcup};\rS_{i,\sqcap})$ satisfies $S'\sqsubset \rS_{i,\sqcap}\sqcup \rS_{i,\sqcup}$ and the final equality uses the facts that $ |\rS_{i,\sqcap}\sqcup\rS_{i,\sqcup}|=|\rS_{i}|=m/3^{3}$ and $ s_{\sqcap}=3^{3}/(1-1/27) $.  
Thus, invoking \Cref{lem:additiveerrorhstar} over $\rS_{i}  $ for $ i\in\{  1,\ldots,27\}  $ with failure parameter $  \delta/28$, we have by a union bound that with probability at least $ 1-27\delta/28 $ over $ \rS $, each $ i\in\{  1,\ldots,27\}$ satisfies
\begin{align}\label{eq:upperboundlem1}
\hspace{-1.5 cm}
    \max\limits_{S'\in \cS(\rS_{i,\sqcup};\rS_{i,\sqcap})}\frac{\Sigma_{\not=}(\hs\negmedspace,S')}{m/s_{\sqcap}}
 \leq  
2
 \left(
    \tau+
 \left(\sqrt{\tau\frac{6\ln{(28/\delta )}}{3m}}
 +\frac{6\ln{(28/\delta )}}{m}\right)
 \right)\leq 4 \left(
    \tau+\frac{6\ln{(28/\delta )}}{m}\right)
\end{align}
where we have used that $ \sqrt{ab}\leq a+b.$ 
Furthermore, by \Cref{thm:upperbound} we have that with probability at least $ 1-\delta/28 $ over $ \rS $, 
\begin{align*}
   \ls_{\cD}^{10/243}(\cA(\rS;\emptyset))\leq\max\limits_{S'\in\cS(\rS;T)}\frac{c\Sigma_{\not=}(\hs\negmedspace,S')}{m/s_{\sqcap}}+\frac{c\left(d+\ln{(28/\delta )}\right)}{m}
\end{align*}
Again invoking a union bound, we have with probability at least $ 1-\delta $ over $ \rS $ that  
\begin{align*}
\ls_{\cD}^{10/243}(\erm(\rS;\emptyset)) &\leq \max\limits_{S'\in\cS(\rS;T)}\frac{c\Sigma_{\not=}(\hs\negmedspace,S')}{m/s_{\sqcap}}+\frac{c\left(d+\ln{(28/\delta )}\right)}{m}
\\
&\leq 
4 c\left(
    \tau+\frac{6\ln{(28/\delta )}}{m}\right)+\frac{c\left(d+\ln{(28/\delta )}\right)}{m}
    \\
&\leq 7c\tau+\frac{7c\left(d+\ln{(28/\delta )}\right)}{m},
\end{align*}
where the first inequality follows from \Cref{eq:upperboundlem1}. This concludes the proof. 
\end{proofof}

We now direction our attention to proving \Cref{thm:upperbound}. We will make use of another set of two lemmas, the first of which permits us to make a recursive argument over $ \erm $-calls based on sub-training sequences created in \Cref{alg:splittingwith27}.

\begin{lemma}\label{lem:recursivelemma}
Let $ S, T\in (\cX\times \cY)^{*} $ with $ |S|=3^{k}$ for $ k\geq 6$, and let $\cD$ be a distribution over $\cX \times \cY$. Then, 
\begin{align*}
\hspace{-0.6 cm}
\ls_{\cD}^{10/243}\big(\cS(S;T)\big) \; \leq \; 5687 \max_{\stackrel{i,j\in \{1,\ldots,27  \}}{i\not=j} }\max_{h'\in \erm(S_{j,\sqcup};S_{j,\sqcap}\sqcup T)}\p_{(\rx,\ry)\sim\cD}\left[h'(\rx)\not=\ry,\avg(\erm(S_{i,\sqcup}; S_{i,\sqcap}\sqcup T))(\rx,\ry) \geq \frac{10}{243}\right]. 
\end{align*}
\end{lemma}
\begin{proof}
Let $(x,y)$ be an example such that  
\[ \sum_{h\in \erm(S;T)} \frac{\ind\{ h(x)\not=y \}}{|\erm(S;T)|} \geq \frac{10}{243}. \]
As $k\geq 6$, \Cref{alg:splittingwith27} calls itself when called with $(S;T)$. Furthermore, as each of the 27 calls produce an equal number of subtraining sequences, it must be the case that
\begin{align*}
    \frac{10}{243} \leq \avg \big( \erm(S;T) \big) (x,y) = \sum_{i=1}^{27}\frac{1}{27}\sum_{h\in \erm(S_{i,\sqcup}; S_{i,\sqcap} \sqcup T)} \frac{\ind\left\{ h(x)\not=y \right\} }{|\erm(S_{i,\sqcup}; S_{i,\sqcap} \sqcup T)|}. 
\end{align*} 
This in turn implies that there exists an $\hat{i} \in [27]$ satisfying the above inequality, i.e., such that
\begin{align*}
    \frac{10}{243}\leq\avg(\erm(S_{\hat{i},\sqcup}; S_{\hat{i},\sqcap}\sqcup T))(x,y)= \sum_{h\in \erm(S_{\hat{i},\sqcup}; S_{\hat{i},\sqcap} \sqcup T)} \frac{\ind\left\{ h(x)\not=y \right\} }{|\erm(S_{\hat{i},\sqcup}; S_{\hat{i},\sqcap} \sqcup T)|} \nonumber.
\end{align*}
We further observe that for any $i\in [27]$, 
\begin{align*}
    \frac{10}{243} &\leq \sum_{j=1}^{27}\frac{1}{27}\sum_{h\in \erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T)} \frac{\ind\left\{ h(x)\not=y \right\} }{|\erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T)|}
    \\
    &\leq
    \sum_{j\in \{1,\ldots,27  \}\backslash i }\frac{1}{27}\sum_{h\in \erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T)} \frac{\ind\left\{ h(x)\not=y \right\} }{|\erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T)|} +\frac{1}{27}.
\end{align*} 
This implies, again for any arbitrary choice of $i \in [27]$, that 
\begin{align*}
  \frac{1}{243}\leq
    \sum_{j\in \{1,\ldots,27  \}\backslash i }\frac{1}{27}\sum_{h\in \erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T)} \frac{\ind\left\{ h(x)\not=y \right\} }{|\erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T)|} \nonumber.
\end{align*}
Simply multiplying both sides by $27 / 26$, we have that 
\begin{align}\label{eq:relationerror}
    \frac{1}{234}\leq
      \sum_{j\in \{1,\ldots,27  \}\backslash i }\frac{1}{26}\sum_{h\in \erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T)} \frac{\ind\left\{ h(x)\not=y \right\} }{|\erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T)|}.
\end{align}
Using the above, we can conclude that when $(x,y)$ is such that $\avg(\erm(S;T))(x,y)\geq \frac{10}{243}$, then there exists an $ i\in [27]$ with $\avg(\erm(S_{i,\sqcup}; S_{i,\sqcap}\sqcup T))(x,y) \geq \frac{10}{243}$. Then by \Cref{eq:relationerror}, at least a $\nicefrac{1}{234}-$fraction of hypotheses in $ \bigsqcup_{j\in \{1,\ldots,27  \} \backslash i}\erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T) $ err on $ (x,y).$ Thus, if we let $ \rI $ be drawn uniformly at random from $ \{1,\ldots,27  \} $ and $ \rh $ be drawn uniformly at random from $ \bigsqcup_{j\in \{1,\ldots,27  \} \backslash \rI}\erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T) $, then by the law of total probability we have that  
\begin{align*}
 &\p_{\rI,\rh}\left[\rh(x)\not=y,\avg(\erm(S_{\rI,\sqcup}; S_{\rI,\sqcap}\sqcup T))(x,y) \geq \frac{10}{243}\right] 
 \\
 & \qquad = \p_{\rI,\rh}\left[\rh(x)\not=y| \avg(\erm(S_{\rI,\sqcup}; S_{\rI,\sqcap}\sqcup T))(x,y) \geq \frac{10}{243}\right]\p_{\rh}\left[\avg(\erm(S_{\rI,\sqcup}; S_{\rI,\sqcap}\sqcup T))(x,y)\geq \frac{10}{243}\right]
 \\
 &\qquad \geq \frac{1}{234} \cdot \frac{10}{243} \\ 
 &\qquad \geq \frac{1}{5687}. 
\end{align*}
This implies in turn that 
\begin{align}\label{eq:relationerror1}
\hspace{-1.5 cm} 5687\p_{\rI,\rh}\left[\rh(x)\not=y,\avg(\erm(S_{\rI,\sqcup}; S_{\rI,\sqcap}\sqcup T))(x,y)\geq \frac{10}{243}\right]\geq \ind \left \{\avg(\erm(S;T))(x,y) \geq \frac{10}{243} \right \}.  
\end{align}
Taking expectations with respect to $(\rx,\ry)\sim \cD $, we have
\begin{align*}
5687\e_{\rI,\rh}\left[\p_{(\rx,\ry)\sim\cD}\left[\rh(\rx)\not=\ry,\avg(\erm(S_{\rI,\sqcup}; S_{\rI,\sqcap}\sqcup T))(\rx,\ry) \geq \frac{10}{243} \right]\right]\geq \ls_{\cD}^{\frac{10}{243}} (\erm(S;T)).
\end{align*}
As $\rh\in \bigsqcup_{j\in \{1,\ldots,27  \} \backslash \rI}\erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T)$,  it follows that 
\begin{align}\label{eq:relationerror2}
&\e_{\rI,\rh}\left[\p_{(\rx,\ry)\sim\cD}\left[\rh(\rx)\not=\ry,\avg(\erm(S_{\rI,\sqcup}; S_{\rI,\sqcap}\sqcup T))(\rx,\ry) \geq \frac{10}{243} \right]\right] \\
&\qquad \leq \e_{\rI}\left[\max_{h'\in  \bigsqcup_{j\in \{1,\ldots,27  \} \backslash \rI}\erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T) }\p_{(\rx,\ry)\sim\cD}\left[h'(\rx)\not=\ry,\avg(\erm(S_{\rI,\sqcup}; S_{\rI,\sqcap}\sqcup T))(\rx,\ry) \geq \frac{10}{243}  \right]\right]. \nonumber
\end{align}
And as $\rI\in\{1,\ldots,27  \}$, then clearly
\begin{align}\label{eq:relationerror3}
& \e_{\rI}\left[\max_{h'\in  \sqcup_{j\in \{1,\ldots,27  \} \backslash \rI}\erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T) }\p_{(\rx,\ry)\sim\cD}\left[h'(\rx)\not=\ry,\avg(\erm(S_{\rI,\sqcup}; S_{\rI,\sqcap}\sqcup T))(\rx,\ry) \geq \frac{10}{243}  \right]\right] \nonumber
\\
&\qquad \leq\max_{i\in\{1,\ldots,27  \} } \max_{h'\in  \sqcup_{j\in \{1,\ldots,27  \} \backslash i}\erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T) }\p_{(\rx,\ry)\sim\cD}\left[h'(\rx)\not=\ry,\avg(\erm(S_{i,\sqcup}; S_{i,\sqcap}\sqcup T))(\rx,\ry) \geq \frac{10}{243}\right]. 
\end{align} 
By combining \Cref{eq:relationerror1,eq:relationerror2,eq:relationerror3}, we conclude that
\begin{align*}
    \ls_{\cD}^{\frac{10}{243}} &(\erm(S;T))
    \\
    &\leq 5687\max_{i\in\{1,\ldots,27  \} } \max_{h'\in  \sqcup_{j\in \{1,\ldots,27  \} \backslash i}\erm(S_{j,\sqcup}; S_{j,\sqcap} \sqcup T) }\p_{(\rx,\ry)\sim\cD}\left[h'(\rx)\not=\ry,\avg(\erm(S_{i,\sqcup}; S_{i,\sqcap}\sqcup T))(\rx,\ry) \geq \frac{10}{243} \right] \nonumber
    \\
    &=5687 \max_{\stackrel{i,j\in \{1,\ldots,27  \}}{i\not=j} }\max_{h'\in \erm(S_{j,\sqcup};S_{j,\sqcap}\sqcup T)}\p_{(\rx,\ry)\sim\cD}\left[h'(\rx)\not=\ry,\avg(\erm(S_{i,\sqcup}; S_{i,\sqcap}\sqcup T))(\rx,\ry) \geq \frac{10}{243}\right], 
\end{align*}
which completes the proof.
\end{proof}

The second lemma employed in the proof of \Cref{thm:upperbound} is the standard uniform convergence property for VC classes. 

\begin{lemma}[\cite{Understandingmachinelearningfromtheory}, Theorem 6.8]\label{lem:fundamentalheoremoflearning}
There exists a universal constant $ C>1 $ such that for any distribution $ \cD  $ over $ \cX\times \left\{  -1,1\right\}  $ and any hypothesis class $ \cH \subseteq \{  -1,1\}^{\cX} $ with finite VC-dimension $ d $, it holds with probability at least $ 1-\delta $ over $ \rS\sim \cD^m$ that for all $ h\in \cH $:  
\begin{align*}
 \ls_{\cD}(h)\leq \ls_{\rS}(h)+\sqrt{\frac{C(d+\ln{\left(e/\delta \right)})}{m}}.
\end{align*}    
\end{lemma}

We now present the proof of \Cref{thm:upperbound}, which concludes the section. 

\begin{proofof}{\Cref{thm:upperbound}}    
We induct on $ k\geq 1 $. 
In particular, we will demonstrate that for each $ k\geq 1$ and $\rS \sim \cD^m$ with $m = 3^k$, and for any $\delta \in (0, 1)$, $T \in (\cX\times \cY)^{*}$, one has with probability at least $ 1-\delta $ over $ \rS $  that
\begin{align}\label{eq:upperbound5}
\hspace{-0.25 cm}
    \ls^{10/243}_{\cD}(\erm(\rS;T))\leq  \max\limits_{S'\in\cS(\rS;T)} \frac{12000 \cdot \Sigma_{\not=}(\hs\negmedspace,S')}{m/s_{\sqcap}}+\sqrt{\cb \frac{C\left(d+\ln{(e/\delta )}\right) \frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/s_{\sqcap}}}{m}} +\cc\frac{C\left(d+\ln{(e/\delta )}\right)}{m},
\end{align}
where $s_{\sqcap} = \frac{|S|}{|S_{i, \sqcap}|} = \frac{27}{1 - \nicefrac{1}{27}}$ is the previously defined constant, $C \geq 1$ is the constant from \Cref{lem:fundamentalheoremoflearning}, and $ \cb $ and $ \cc $ are the following constants:  
\begin{align*}
    &\cb=\left(5687^2\cdot4\cdot3^{6} \ln{(\ch e)}s_{\sqcap}\right)^{2}, 
    \\
    &\cc=3^{12}\ln{(\ch e )}^{2}\sqrt{\cb} \, s_{\sqcap}\,. 
\end{align*}
Note that applying $ \sqrt{ab}\leq a+b$ to \Cref{eq:upperbound5} would in fact suffice to complete the proof of \Cref{thm:upperbound}.  

Thus it remains only to justify \Cref{eq:upperbound5}. 
For any choice of $\delta \in (0, 1)$ and $T\in\left(\cX\times \cY\right)^{*} $, first observe observe that if $ k\leq 12,$ the claim follows immediately from the fact that the right hand side of \Cref{eq:upperbound5} is at least 1. (Owing to the fact that $\cc\geq 3^{12}$.)

We now proceed to the inductive step. For the sake of brevity, we will often supress the distribution from which random variables are drawn when writing expectations and probabilities, e.g., $ \p_{\rS}$ rather than $\p_{\rS\sim \cD^{m}}$.
Now fix a choice of $T \in \left (\cX \times \cY \right)^{*} $, $\delta \in (0, 1)$, and $k > 12$. 
Let $ a_{\rS} $ equal the right-hand side of \Cref{eq:upperbound5}, i.e.,
\begin{align}\label{eq:upperbound-2}
    a_{\rS}=\max\limits_{S'\in\cS(\rS;T)} \frac{12000 \cdot \Sigma_{\not=}(\hs\negmedspace,S')}{m/s_{\sqcap}}+\sqrt{\cb \frac{C\left(d+\ln{(e/\delta )}\right) \frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/s_{\sqcap}}}{m}} +\cc\frac{C\left(d+\ln{(e/\delta )}\right)}{m}.  
\end{align}
Then invoking \Cref{lem:recursivelemma} and a union bound, we have that
\begin{align}\label{eq:upperbound-1}
    &\p_{\rS}\left[\ls_{\cD}^{10/243}(\erm(\rS;T))> a_{\rS}\right]
    \\ 
    &\quad \leq\p_{\rS}\left[5687\max_{\stackrel{i,j\in \{ 1,\ldots,27 \}}{i\not=j} } \max_{h\in \erm(\rS_{j,\sqcup};\rS_{j,\sqcap}\sqcup T)}\p_{\rx,\ry}\left[\avg(\erm(\rS_{i,\sqcup};\rS_{i,\sqcap}\sqcup T))(\rx,\ry)\geq\frac{10}{243},h(\rx)\not=\ry\right] >a_{\rS}\right]\nonumber
    \\
    &\quad \leq\sum_{\stackrel{i,j\in \{ 1,\ldots,27 \}}{i\not=j} }\p_{\rS}\left[5687\max_{h\in \erm(\rS_{j,\sqcup};\rS_{j,\sqcap}\sqcup T)}\p_{\rx,\ry}\left[\avg(\erm(\rS_{i,\sqcup};\rS_{i,\sqcap}\sqcup T))(\rx,\ry)\geq\frac{10}{243},h(\rx)\not=\ry\right] >a_{\rS}\right].
\end{align}
Thus it suffices to show that for $i \neq j \in [27]$,
\begin{align}\label{eq:upperbound0}
    \p_{\rS}\left[5687\max_{h\in \erm(\rS_{j,\sqcup};\rS_{j,\sqcap}\sqcup T)}\p_{\rx,\ry}\left[\avg(\erm(\rS_{i,\sqcup};\rS_{i,\sqcap}\sqcup T))(\rx,\ry)\geq\frac{10}{243},h(\rx)\not=\ry\right] >a_{\rS}\right]\leq  \frac{\delta}{26\cdot27},
\end{align}
as one can immediately apply this inequality with \Cref{eq:upperbound-1}. 
Then it remains to establish \Cref{eq:upperbound0}. As the pairs $(\rS_{1,\sqcup},\rS_{1,\sqcap}) , \ldots , (\rS_{27,\sqcup},\rS_{27,\sqcap})$ are all i.i.d., it suffices to demonstrate the inequality for, say, $ j=1 $ and $ i=2 $. To this end, fix arbitrary realizations $(S_k)_{3 \leq k \leq 27}$ of the random variables $(\rS_k)_{3 \leq k \leq 27}$; we will demonstrate the claim for any such realization.  

First note that if we happen to have realizations $ S_{2,\sqcup},S_{2,\sqcap} $ of $  \rS_{2,\sqcup},\rS_{2,\sqcap}$ such that 
\begin{align*}
 \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))=\p_{\rx,\ry}\left[\avg(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243}\right]\leq \cc\frac{C\left(d+\ln{(e/\delta )}\right)}{5687m}\leq \frac{a_{\rS}}{5687},
\end{align*} 
then we are done by monotonicity of measures, as 
\begin{align}\label{eq:upperbound9}
5687\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{\rx,\ry}\left[\avg(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243},h(\rx)\not=\ry\right]\leq  a_{\rS}.
\end{align}
Furthermore, consider any realization $ S_{2,\sqcap} $ of $ \rS_{2,\sqcap} $. 
We note that by $ m=|\rS|=3^{k}$ for $ k>12$, and by \Cref{alg:splitting27if}, it holds that $ |\rS_{2,\sqcup}| =3^{k-6}=m/3^{6}.$ 
Thus, we may invoke the inductive hypothesis with $\erm( \rS_{2,\sqcup}  ;  S_{2,\sqcap} \sqcup T)$ and failure parameter $\delta/\ch$ in order to conclude that with probability at least $ 1-\delta/\ch $ over $ \rS_{2,\sqcup} $,
\begin{align}\label{eq:upperbound6}
\ls_{\cD}^{10/243}(\erm(\rS_{2,\sqcup};S_{2,\sqcap}\sqcup T))
& \leq
\max\limits_{S'\in\cS(\rS_{2,\sqcup};S_{2,\sqcap}\sqcup T)} 
\frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/(3^6 s_{\sqcap})} \notag \\
&\qquad +\sqrt{\cb \frac{C\left(d+\ln{(\ch e/\delta  )}\right)
\frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/(3^6 s_{\sqcap})}}{m/3^6}}
+\cc\frac{C\left(d+\ln{\left(\ch e/\delta  \right)}\right)}{m/3^6}. 
\end{align}
Furthermore, for any $a,b,c,d>0 $, we have that 
\begin{align}\label{eq:upperbound-7}
a+\sqrt{abc}+cd
 \leq a+a\sqrt{b} +c\sqrt{b}+ cd
 =(1+\sqrt{b})\cdot a+(d+\sqrt{b})\cdot c,
\end{align}
where the inequality follows from the fact that $\sqrt{abc}\leq \max(\sqrt{ba^2},\sqrt{bc^2})\leq a\sqrt{b}+c\sqrt{b}$.
Now, combining \cref{eq:upperbound6} and \cref{eq:upperbound-7} (with $ b=\cb,d=\cc $), we obtain
\begin{align}\label{eq:upperbound10}
    \ls_{\cD}^{10/243}(\erm(\rS_{2,\sqcup};S_{2,\sqcap}\sqcup T)) & \leq  (1+\sqrt{\cb})\max\limits_{S'\in\cS(\rS_{2,\sqcup};S_{2,\sqcap}\sqcup T)} 
    \frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/(3^6 s_{\sqcap})} \notag \\ 
    & \qquad +(\cc+\sqrt{\cb}) \frac{C\left(d+\ln{(\ch e/\delta  )}\right)}{m/3^6} \notag
    \\
    & \leq2\sqrt{\cb}\max\limits_{S'\in\cS(\rS_{2,\sqcup};S_{2,\sqcap}\sqcup T)} 
    \frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/(3^6 s_{\sqcap})}+2\cc \frac{C\left(d+\ln{(\ch e/\delta  )}\right)}{m/3^6}.
\end{align}
Note that the second inequality makes use of the fact that $ \cb\geq1 $ and $ \cb\leq \cc.$  
We thus conclude that for any realization $ S_{2,\sqcap} $ of $ \rS_{2,\sqcap} $, the above inequality holds with probability at least $1-\delta/\ch$ over $ \rS_{2,\sqcup} $. Further, as $\rS_{2,\sqcap} $ and $ \rS_{2,\sqcup} $ are independent, the inequality also holds with probability at least $ 1-\delta/\ch $ over $ \rS_{2,\sqcap},\rS_{2,\sqcup}$.


We now let 
\[ a_{\rS_{2}}=2\sqrt{\cb}\max\limits_{S'\in\cS(\rS_{2,\sqcup};\rS_{2,\sqcap}\sqcup T)} 
\frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/(3^6 s_{\sqcap})}+2\cc \frac{C\left(d+\ln{(\ch e/\delta  )}\right)}{(m/3^6)} \]
and consider the following three events over $ \rS_{2}=(\rS_{2,\sqcap},\rS_{2,\sqcup} )$: 
\begin{align*}
 E_{1}=&\Bigg\{\cc\frac{C\left(d+\ln{(e/\delta )}\right)}{5687m}<    \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))\leq a_{\rS_{2}} \Bigg\},
 \\
 E_{2}=&\left\{ \cc\frac{C\left(d+\ln{(e/\delta )}\right)}{5687m}\geq   \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T)) \right\},
 \\
 E_{3}=& \left\{  \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))
 > a_{\rS_{2}} \right\}.
\end{align*}
By \cref{eq:upperbound9}, we have that for $\rS_{2,\sqcap},\rS_{2,\sqcup} \in E_{2} $, the bound in \cref{eq:upperbound5} holds. 
Furthermore, from the comment below \cref{eq:upperbound10}, we have that $ \rS_{2,\sqcap},\rS_{2,\sqcup} \in E_{3} $ happens with probability at most $ \delta/\ch $ over $ \rS_{2,\sqcap},\rS_{2,\sqcup} $. For brevity, let $ a_{\rS} $ denote the right-hand side of \cref{eq:upperbound5}. Then, using the law of total probability along with independence of  $ \rS_{1}$ and  $\rS_{2} $, we can conclude that 
\begin{align}\label{eq:upperbound16}
    &\p_{\rS_{1},\rS_{2}}\left[5687\negmedspace\negmedspace\negmedspace\negmedspace\negmedspace\negmedspace\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{\rx,\ry}\left[\avg(\erm(\rS_{2,\sqcup};\rS_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243},h(\rx)\not=\ry\right] >a_{\rS}\right]
    \\
    &\leq     
    \e_{\rS_{2}}\left[\p_{\rS_{1}}\left[5687\negmedspace\negmedspace\negmedspace\negmedspace\negmedspace\negmedspace\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{\rx,\ry}\left[\avg(\erm(\rS_{2,\sqcup};\rS_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243},h(\rx)\not=\ry\right] >a_{\rS}\right]\Bigg| E_{1}\right]\p\left[E_{1}\right]\nonumber
    \\
    &+
    \e_{\rS_{2}}\left[\p_{\rS_{1}}\left[5687\negmedspace\negmedspace\negmedspace\negmedspace\negmedspace\negmedspace\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{\rx,\ry}\left[\avg(\erm(\rS_{2,\sqcup};\rS_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243},h(\rx)\not=\ry\right] >a_{\rS}\right]\Bigg| E_{2}\right]\p\left[E_{2}\right]\nonumber
    \\
    &+
    \e_{\rS_{2}}\left[\p_{\rS_{1}}\left[5687\negmedspace\negmedspace\negmedspace\negmedspace\negmedspace\negmedspace\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{\rx,\ry}\left[\avg(\erm(\rS_{2,\sqcup};\rS_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243},h(\rx)\not=\ry\right] >a_{\rS}\right]\Bigg| E_{3} \right]\p\left[E_{3}\right]\nonumber
    \\
    &\leq\e_{\rS_{2}}\left[\p_{\rS_{1}}\left[5687\negmedspace\negmedspace\negmedspace\negmedspace\negmedspace\negmedspace\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{\rx,\ry}\left[\avg(\erm(\rS_{2,\sqcup};\rS_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243},h(\rx)\not=\ry\right] >a_{\rS}\right]\Bigg| E_{1}\right]
    +0 
    +\delta/\ch .\nonumber
\end{align} 
Note that the second inequality follows from \cref{eq:upperbound9}, \cref{eq:upperbound10} and $ \p\left[E_{1}\right] \leq 1$.
Thus, if we can bound the first term of the final line by $ 2\delta/\ch $, it will follow that \cref{eq:upperbound0} holds with probability at least $ 1-\delta/(26\cdot27) $, as claimed.

To this end, consider a realization $ S_{2} $ of $ \rS_{2}\in E_{1} $.
For such an $ S_{2} $, we have that 
\[ \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))= \p_{\rx,\ry}\left[\avg(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243}\right]>0. \] 
Then, again invoking the law of total probability, we have that 
\begin{align}\label{eq:upperbound1}
    &5687\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{\rx,\ry}\left[ \avg(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243}, h(\rx)\not=\ry \right] \nonumber
    \\
 & \qquad = \;
 5687\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{\rx,\ry}\left[h(\rx)\not=\ry|\avg(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243}\right] \nonumber \\
 & \qquad \qquad \times 
 \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T)). 
\end{align}
Now let $ A = \{(x,y)\in(\cX\times\cY) \mid \avg(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(x,y)\geq \frac{10}{243}\}$ and  $ \rN_{1}=|\rS_{1,\sqcap}\sqcap A|$.    
As $ S_{2} \in E_{1} $, we have that 
\[ \p_{\rx,\ry}[A]=\ls_{\cD}^{10/243} \big( \erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T) \big) \geq \frac{\cc C(d+\ln{(e/\delta )})}{5687 \cdot m}. \]
Then, owing to the fact that $ \rS_{1,\sqcap}\sim \cD^{(m/s_{\sqcap})}$ --- note that $ m/s_{\sqcap}=|\rS|/(|\rS|/|\rS_{\sqcap}|)=|\rS_{\sqcap}| $ --- this implies that 
\begin{align*}
    \e_{\rS_{1,\sqcap}}[\rN_{1}]
    =\p_{\rx,\ry\sim \cD}[A] \cdot (m/s_{\sqcap})
    = \frac{\cc C\big(d+\ln{(e/\delta )}\big)}{5687 \cdot s_{\sqcap}}.
\end{align*} 
Thus, by a multiplicative Chernoff bound, we have
\begin{align}\label{eq:upperbound13}
\p_{\rS_{1,\sqcap}\sim \cD^{(m/s_{\sqcap})}}\left[\rN_{1}>\e_{\rS_{1,\sqcap}\sim \cD^{(m/s_{\sqcap})}}[\rN_{1}]/2\right] &\geq 1- \exp{\left(-\frac{\cc C(d+\ln{(e/\delta )})}{8\cdot 5687 s_{\sqcap}\cdot}  \right)} \notag \\
&\geq 1-(\delta/e)^{19}. 
\end{align} 
Note that the second inequality uses the fact that $ \cc= 3^{12} \ln{(\ch e )}^{2}\sqrt{\cb} s_{\sqcap}$.
Now let $ N_{1} $ be any realization of $\rN_1$ such that 
\[ N_1 > \frac 12 \cdot  \e_{\rS_{1,\sqcap}\sim \cD^{(m/s_{\sqcap})}}[\rN_{1}] = \frac 12 \cdot  \ls_{\cD}^{10/243} \big( \erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T) \big) (m/s_{\sqcap}). \]  
Notice that $ \rS_{1,\sqcap} \sqcap A \sim \cD^{N_{1}}(\; \cdot \; | \avg(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243})$. 

Now, combining \cref{eq:upperbound1} and \cref{lem:fundamentalheoremoflearning}, we have that with probability at least $ 1-\delta/\cj $ over $ \rS_{1,\sqcap}\sqcap A$,
\begin{align}\label{eq:upperbound3}
  &5687\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{\rx,\ry} \left[ \avg(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243}, h(\rx)\not=\ry \right] 
    \\
  &\leq
    5687\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\left(\ls_{ \rS_{1,\sqcap}\sqcap A}(h)+\sqrt{C\left(d+\ln{(\ch e/\delta )}\right)/N_1}\right) \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))\nonumber
\end{align}
We now bound each of the two terms on the right hand side of \cref{eq:upperbound3}, considered after multiplying out the term associated with $\ls_{\cD}^{10/243}$. Beginning with the first term, and recalling that $ N_{1}=|\rS_{1,\sqcap}\sqcap A|$, we have  
\begin{align}\label{eq:upperbound17}
\ls_{ \rS_{1,\sqcap}\sqcap A}(h) & \cdot \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T)) \nonumber \\
    &=\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\sum_{(x,y)\in \rS_{1,\sqcap}\sqcap A}\frac{\ind\{ h(x)\not=y \}}{N_{1}}  \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))\nonumber
    \\
    &\leq
    \max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\sum_{(x,y)\in \rS_{1,\sqcap}\sqcap A}\frac{2\ind\{ h(x)\not=y \}}{m/s_{\sqcap}} \nonumber \\
    &\leq
    \max\limits_{S'\in \cS(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\sum_{(x,y)\in \rS_{1,\sqcap}\sqcap A}\frac{2\ind\{ \erm(S')(x)\not=y \}}{m/s_{\sqcap}} \nonumber
    \\
    &\leq
     \max\limits_{S'\in \cS(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\sum\limits_{(x,y)\in S'}\frac{2\ind\{ \erm(S')(x)\not=y \}}{m/s_{\sqcap}}  \nonumber \\
    &\leq
    \max\limits_{S'\in \cS(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\frac{2\Sigma_{\not=}(\hs\negmedspace,S')}{ m/s_{\sqcap}}.
\end{align}
Note that the first inequality uses the fact that $ N_1\geq \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(m/s_{\sqcap})/2$ and the second inequality uses that $h\in\erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)$, meaning there exists an $ S'\in\cS(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)$ such that $h=\erm(S')$. The third inequality follows from the fact that $\rS_{1,\sqcap}\sqcap A \sqsubset \tilde{S} $ for any $ \tilde{S}\in \cS(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)$ (and especially for $S'$) and the final inequality from both the $ \cerm $-property of $ \cA $  on $ S' $ and the definition of $ \Sigma_{\not=}(\hs\negmedspace,S').$

We now bound the second term of \cref{eq:upperbound3}.
In what follows, let $ \beta= C\left(d+\ln{(\ch e/\delta )}\right)$. 
We will in the first inequality use that  $N_1 \geq \frac 12 \cdot  \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(m/s_{\sqcap})$: 
\begin{align}\label{eq:upperbound18}
 \ls_{\cD}^{10/243} & (\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T)) \sqrt{C\left(d+ \ln{(\ch e/\delta )}\right)/N_1}  \\
    &\leq\sqrt{\frac{2\beta\ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))}{m/s_{\sqcap}}} \nonumber
    \\
    &\leq
\sqrt{\frac{4\beta   \left(\sqrt{\cb}\max\limits_{S'\in\cS(S_{2,\sqcup};S_{2,\sqcap}\sqcup T)} 
\frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/3^6 s_{\sqcap}}+\cc \frac{C\left(d+\ln{(\ch e/\delta  )}\right)}{m/3^6}  \right)}{m/s_{\sqcap}}}\tag{by definition of $ E_{1} $ and \cref{eq:upperbound10}}
    \\
    &\leq
\sqrt{\frac{4\beta\sqrt{\cb}\max\limits_{S'\in\cS(S_{2,\sqcup};S_{2,\sqcap}\sqcup T)} 
\frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/(3^6 s_{\sqcap})}}{m/s_{\sqcap}}}\tag{by $ \sqrt{a+b}\leq \sqrt{a}+\sqrt{b} $ and definition of $ \beta $ }
    + 
\sqrt{\frac{4\beta^{2}\cc \frac{1}{m/3^6}}{m/s_{\sqcap}}}\nonumber
    \\
    &\leq
   \sqrt{4\cdot 3^{6}\sqrt{\cb}\ln{\left(\ch e \right)} s_{\cap}}
   \sqrt{\frac{C\left(d+\ln{(e/\delta )}\right) \max\limits_{S'\in\cS(S_{2,\sqcup};S_{2,\sqcap}\sqcup T)}\frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/ s_{\sqcap}} }{m}} \nonumber \\
   & \qquad +
   \sqrt{4\cdot3^{6}\cc \left(\ln{\left(\ch e \right)}\right)^{2}s_{\cap}}
    \frac{C\left(d+\ln{(e/\delta )}\right) }{m}, \nonumber 
\end{align}
where the last inequality follows from $ \beta=C(d+\ln{(\ch e/\delta )})\leq \ln{(\ch e)}C(d+\ln{(e/\delta )}) $ and rearrangement.
We now bound each of the constant terms under the square roots. 
Beginning with the first term, we have 
\begin{align}\label{eq:upperbound11}
    \sqrt{4\cdot 3^{6}\sqrt{\cb}\ln{\left(\ch e \right)} s_{\cap}}= \sqrt{5687^2 \cdot4\cdot 3^{6}\sqrt{\cb}\ln{\left(\ch e \right)} s_{\cap}}/5687
    \leq
    \sqrt{\cb}/5687,
\end{align}
where the inequality follows from $\cb=\left(5687^2\cdot4\cdot3^{6} \ln{(\ch e)}s_{\sqcap}\right)^{2}.$ 
For the second term, we have that
\begin{align}\label{eq:upperbound12}
    \sqrt{4\cdot3^{6}\cc \left(\ln{\left(\ch e \right)}\right)^{2}s_{\cap}}= \sqrt{5687^2\cdot4\cdot3^{6}\cc \left(\ln{\left(\ch e \right)}\right)^{2}s_{\cap}}/5687
    \leq
    \cc ,
\end{align}
where the inequality follows by $\cc=  3^{12}  \ln{(\ch e )}^{2}\sqrt{\cb} s_{\sqcap}
    $ and $\cb=\left(5687^2\cdot4\cdot3^{6} \ln{(\ch e)}s_{\sqcap}\right)^{2}.$ 
Then we conclude from \cref{eq:upperbound18} that 
    \begin{align}\label{eq:upperbound19}
        &\sqrt{\frac{C\left(d+\ln{(\ch e/\delta )}\right)}{N_1}} \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))
        \\
        &\; \; \leq
       \frac{1}{5687}\left(\sqrt{\cb\frac{C\left(d+\ln{(e/\delta )}\right) \max\limits_{S'\in\cS(S_{2,\sqcup};S_{2,\sqcap}\sqcup T)}\frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/ s_{\sqcap}} }{m}} \nonumber
 + 
        \cc\frac{C\left(d+\ln{(e/\delta )}\right) }{m}\right),
    \end{align}

Thus, by applying \cref{eq:upperbound17} and \cref{eq:upperbound19} to \cref{eq:upperbound3}, we obtain that for any realization $ N_{1} $ of $ \rN_1\geq \frac 12 \cdot \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(m/s_{\sqcap})$, it holds with probability at least $1-\delta/\cj $ over $ \rS_{1,\sqcap}\sqcap A \sim \cD^{N_{1}}(\; \cdot \;| \erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T)(x)\not=y)$\footnote{I.e., the restriction of $\CD$ to those $(x, y)$ pairs satisfying the given condition.} that
\begin{align}\label{eq:upperbound15}
&5687\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{\rx,\ry} \left[ \avg(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243}, h(\rx)\not=\ry \right] 
\\
& \quad \leq \max\limits_{S'\in \cS(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/s_{\sqcap}} +\sqrt{\cb\frac{C\left(d+\ln{(e/\delta )}\right) \max\limits_{S'\in\cS(S_{2,\sqcup};S_{2,\sqcap}\sqcup T)}\frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/ s_{\sqcap}} }{m}} \nonumber \\
& \qquad + \cc\frac{C\left(d+\ln{(e/\delta )}\right) }{m} \nonumber \\
& \quad \leq \max\limits_{S'\in \cS(\rS; T)}\frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/s_{\sqcap}} +\sqrt{\cb\frac{C\left(d+\ln{(e/\delta )}\right) \frac{12000\Sigma_{\not=}(\hs\negmedspace,S')}{m/ s_{\sqcap}} }{m}} \nonumber
+ \cc\frac{C\left(d+\ln{(e/\delta )}\right) }{m} \nonumber \\
&\quad =a_{\rS}.
\end{align} 
Note that the second inequality follows from the fact that $ S'\in \cS(\rS_{i,\sqcup};\rS_{i,\sqcap}\sqcup T) $ for $ i=1,2 $, meaning $ S'\in \cS(\rS;T)$. The equality follows simply from the definition of $ a_{\rS}$ in \cref{eq:upperbound-2}.  

Now, combining the above observations, we can conclude that for any realization $S_{2} \in E_{1}$ of $\rS_{2}$,
\begingroup
\allowdisplaybreaks
\begin{align*}
&\p_{\rS_{1}}\Bigg[5687\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{(\rx,\ry)}\left[\avg(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243},h(\rx)\not=\ry\right] \leq a_{\rS} \Bigg]
\\
& \quad \geq\p_{\rS_{1}}\Bigg[5687\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{(\rx,\ry)}\left[\avg(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243},h(\rx)\not=\ry\right] \leq
a_{\rS} \\ 
&\qquad \Bigg| \rN_1\geq \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(m/s_{\sqcap})/2 \Bigg]  \times \p_{\rS_{1}}\left[\rN_1\geq \ls_{\cD}^{10/243}(\erm(S_{2,\sqcup};S_{2,\sqcap}\sqcup T))(m/s_{\sqcap})/2\right] 
\\
&\geq  \left( 1- \frac{\delta}{\ch} \right) \left( 1- \left(\frac{\delta}{e} \right)^{19} \right) \\ 
&\geq 1- 2\frac{\delta}{2^{12}}.
\end{align*} 
\endgroup
(Note that the first term on the right side of the first inequality is distributed across two lines of text.) In particular, 
 the first inequality follows from the law of total expectation, and the second from \cref{eq:upperbound13} (see the comment below the equations) and \cref{eq:upperbound15}.
Thus, the above implies that the term in \cref{eq:upperbound16} which conditions upon $\rS_{2}\in E_{1}$ is bounded by $ \delta/2^{11}$. Altogether, we can conclude that 
\begin{align*}
    \p_{\rS_{1},\rS_{2}}\left[5687\max_{h\in \erm(\rS_{1,\sqcup};\rS_{1,\sqcap}\sqcup T)}\p_{(\rx,\ry)}\left[\avg(\erm(\rS_{2,\sqcup};\rS_{2,\sqcap}\sqcup T))(\rx,\ry)\geq \frac{10}{243},h(\rx)\not=\ry\right] >a_{\rS}\right]
    \leq \frac{\delta}{2^{10}}. 
\end{align*} 
As $ \nicefrac{\delta}{2^{10}} \leq \nicefrac{\delta}{26\cdot 27}$, we arrive at \cref{eq:upperbound0}, which as previously argued concludes the proof due to the fact that $(\rS_{1,\sqcup},\rS_{1,\sqcap}), \ldots, (\rS_{27,\sqcup},\rS_{27,\sqcap})$ are i.i.d.\ 
\end{proofof}

\section{Augmentation of $\widehat{\cA}_{\rt}$ Through Tie-breaking}

Let us assume we are given a training sequence $ \rS $ of size $ m=3^{k} $ for $ k\geq1 $.  
We then take $ \rS $ and split it into three disjoint, equal-sized training sequences $ \rS_{1},$ $ \rS_{2},$ and $ \rS_{3}.$ 
We denote the sizes of $ \rS_{1},\rS_{2}$ and $\rS_{3} $ as  $ m'=m/3 $. 
On $ \rS_{1}$ and $ \rS_{2}$, we train  $\widehat{\cA}_{\rt_{1}}(S_{1})$ and $\widehat{\cA}_{\rt_{2}}(\rS_{2}),$ where we recall that $ \rt_{1} $ and $ \rt_{2} $ denote the randomness used to draw the hypothesis in  $\widehat{\cA}_{\rt_{1}}(S_{1})$ and $\widehat{\cA}_{\rt_{2}}(\rS_{2})$ from, respectively, $ \cA(\rS_{1};\emptyset) $  and $ \cA(\rS_{2};\emptyset).$

We now evaluate $\widehat{\cA}_{\rt_{1}}(\rS_{1})$ and $\widehat{\cA}_{\rt_{2}}(\rS_{2})$ on $ \rS_{3} $ and consider all the examples $ (x,y)\in \rS_{3} $,  where $ \avg(\widehat{\cA}_{t_{1}}(S_{1}))(x,y)\geq11/243 $ or $\avg(\widehat{\cA}_{t_{2}}(S_{2}))(x,y)\geq11/243$. Denote the set of all such examples as $\rS_{3}^{\not=}.$ 
We now run the $ \cerm $-algorithm $ \cA $ on  $ \rS_{3}^{\not=} $ to obtain $\htie =\cA(\rS_{3}^{\not=}).$

For a point $ x $,  let $ \tie^{11/243}\left(\widehat{\cA}_{\rt_{1}}(\rS_{1}),\widehat{\cA}_{\rt_{2}}(\rS_{2}); \htie \right)(x) $ be equal to the label $ y $ if both
\[ \sum_{h\in \widehat{\cA}_{\rt_{1}}(\rS_{1})}\ind\{h(x)=y\}/|\widehat{\cA}_{\rt_{1}}(\rS_{1})|\geq 232/243 \] and 
\[ \sum_{h\in \widehat{\cA}_{\rt_{2}}(\rS_{2})}\ind\{h(x)=y\}/|\widehat{\cA}_{\rt_{2}}(\rS_{2})|\geq 232/243. \]
Otherwise, we set it to $ \htie(x).$
In other words, if both $ \widehat{\cA}_{\rt_{1}}(\rS_{1}) $ and $ \widehat{\cA}_{\rt_{2}}(\rS_{2}) $ have at least $ 232/243 $ of their hypotheses agreeing on the same label $ y $, we output that label; otherwise, we output the label of $ \htie (x).$ 

Notice that if there were a true label $ y $ and point $ x $, such that we ended up outputting the answer of $\htie(x),$ then at least one of $ \widehat{\cA}_{\rt_{1}}(\rS_{1}) $ and $ \widehat{\cA}_{\rt_{2}}(\rS_{2}) $ has more than $ 11/243 $ incorrect answers, not equal to $ y $ on $ x $, which we know by \cref{lem:upperbound} is unlikely. 
Furthermore, in the former case and the tie erring on $(x, y)$, then both $ \widehat{\cA}_{\rt_{1}}(\rS_{1}) $ and $ \widehat{\cA}_{\rt_{2}}(\rS_{2}) $ err with at least a $ 232/243 $ fraction of their hypotheses, which again is unlikely by \cref{lem:upperbound}. Thus, both cases of possible error are unlikely, which we exploit in order to demonstrate the following theorem.         

\begin{theorem}\label{thm:tiemajority}
    There exists a universal constant $ c \geq1$ such that for any hypothesis class $ \cH $ of VC dimension $ d $, distribution $ \cD $ over $ \cX \times \cY,$ failure parameter $ 0<\delta<1 $, training sequence size $ m=3^{k} $ for $ k\geq 5 $, training sequence $ \rS\sim \cD^{m},$ and sampling size $ t_{1},t_{2}\geq 4\cdot243^{2}\ln{\big(2m/(\delta(d+\ln{\left(\cur/\delta \right)})) \big)},$ we have, with probability at least $ 1-\delta $ over $ \rS_{1},\rS_{2},\rS_{3}\sim \cD^{m/3} $ and the randomness $ \rt_{1},t_{2} $ used to draw $ \widehat{\erm}_{\rt_{1}}(\rS_{1};\emptyset) $ and $ \widehat{\erm}_{\rt_{2}}(\rS_{2};\emptyset) $,  that:
    \begin{align*}
    \ls_{\cD}\left(\tie^{11/243}\left(\widehat{\cA}_{\rt_{1}}(\rS_{1}),\widehat{\cA}_{\rt_{2}}(\rS_{2}), \htie\right)\right)\leq  2.0888\tau+\sqrt{\frac{c\tau \left(d+\ln{(e/\delta )}\right)}{m}}+\frac{c\left(d+\ln{(e/\delta )}\right)}{m}. 
    \end{align*}
\end{theorem}

In the proof of \cref{thm:tiemajority} we will need the following $ \cerm $-theorem. Recall that we take a top be an $ \cerm $-algorithm, meaning $ \cA $  is proper (i.e., it always emits hypotheses in $\cH$),and for any training sequence $S$ thjat $ \ls_{S}(\cA(S)) = \min_{h\in\cH}\ls_{S}(h).$    

\begin{theorem}\label{thm:ermtheoremunderstanding}[\cite{Understandingmachinelearningfromtheory}~Theorem 6.8]
        There exists a universal constant $ C'>1 $ such that for any distribution $ \cD  $ over $ \cX\times \left\{  -1,1\right\}  $, any hypothesis class $ \cH \subseteq \{  -1,1\}^{\cX} $ with VC dimension $ d $, and any $ \cerm $-algorithm $ \cA $,   it holds with probability at least $ 1-\delta $ over $ \rS\sim \cD^m$ that for all $ h\in \cH $:  
        \begin{align*}
         \ls_{\cD}(\cA(\rS))\leq \inf_{h\in \cH}\ls_{\cD}(h)+\sqrt{\frac{C'(d+\ln{\left(e/\delta \right)})}{m}}.
        \end{align*}    
\end{theorem}

\begin{proofof}{\cref{thm:tiemajority}.}
First note that by the definition of $\tie^{11/243}$, for $ \tie^{11/243}\left(\widehat{\cA}_{\rt_{1}}(\rS_{1}),\widehat{\cA}_{\rt_{2}}(\rS_{2}), \htie\right) $ to err on a fixed example $ (x,y) $, it must be the case that either there exists $y' \neq y \in\left\{  -1,1\right\}$ such that
\begin{align*}
& \sum_{h\in \widehat{\cA}_{\rt_{1}}(\rS_{1})}\ind\{h(x)=y'\}/|\widehat{\cA}_{\rt_{1}}(\rS_{1})|\geq 232/243 \text{  and } \sum_{h\in \widehat{\cA}_{\rt_{2}}(\rS_{2})}\ind\{h(x)=y'\}/|\widehat{\cA}_{\rt_{2}}(\rS_{2})|\geq 232/243
 \\
& \Leftrightarrow \avg(\widehat{\cA}_{\rt_{1}}(\rS_{1}))(x,y)\geq \frac{232}{243},\avg(\widehat{\cA}_{\rt_{2}}(\rS_{2}))(x,y)\geq \frac{232}{243}
\end{align*} 
or the case that for all $y'\in\left\{  -1,1\right\}$,
\begin{align*}
& \Bigg( \sum_{h\in \widehat{\cA}_{\rt_{1}}(\rS_{1})}\ind\{h(x)=y'\}< 232/243 \text{ or} \sum_{h\in \widehat{\cA}_{\rt_{2}}(\rS_{2})}\ind\{h(x)=y'\}< 232/243 \Bigg)  \text{ and } \htie(x)\not=y
    \\
& \Rightarrow  \left( \avg(\widehat{\cA}_{\rt_{1}}(\rS_{1}))(x,y)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{\rt_{2}}(\rS_{2}))(x,y)\geq \frac{11}{243} \right)  \text{ and } \htie(x)\not=y
\end{align*} 
Thus, we have that   
\begin{align}\label{eq:secondmajority1}
 \ls_{\cD} \Big(& \tie^{11/243}  \left(\widehat{\cA}_{\rt_{1}}(\rS_{1}),\widehat{\cA}_{\rt_{2}}(\rS_{2}), \htie\right)(\rx)\not=\ry\Big) \nonumber 
 \\
& \leq
 \p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{\rt_{1}}(\rS_{1}))(\rx,\ry)\geq \frac{232}{243},\avg(\widehat{\cA}_{\rt_{2}}(\rS_{2}))(\rx,\ry)\geq \frac{232}{243}\right] \nonumber
 \\
& \qquad  +\p_{(\rx,\ry)\sim\cD}\left[ \htie\not=\ry, \avg(\widehat{\cA}_{\rt_{1}}(\rS_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{\rt_{2}}(\rS_{2}))(\rx,\ry)\geq \frac{11}{243}\right]. 
\end{align}
We now bound each of these terms separately. 
The first term we will soon bound by 
\begin{align}\label{eq:secondmajority-1}
& \hspace{-1.7cm} \p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{\rt_{1}}(\rS_{1}))(\rx,\ry)\geq \frac{232}{243},\avg(\widehat{\cA}_{\rt_{2}}(\rS_{2}))(\rx,\ry)\geq \frac{232}{243}\right] \nonumber  \\ 
& \hspace{-1.7cm} \qquad \leq 1.0888\tau+\sqrt{\frac{16cC\tau(d+2\ln{\left(3\cu/\delta \right)})}{m'}}+\frac{6cC(d+\ln{\left(e\cu /\delta \right)})}{m'} 
\end{align}
with probability at least $1- 82\delta/\cu,$ over $ \rS_{1},\rS_{2},\rt_{1} $ and $ \rt_{2} $. Likewise, the second term we will soon bound by 
\begin{align}\label{eq:secondmajority-2}
    \p_{(\rx,\ry)\sim\cD}\left[ \htie(\rx)\not=\ry, \widehat{\cA}_{\rt_{1}}(\rS_{1})(\rx)\not=\widehat{\cA}_{\rt_{2}}(\rS_{2})(\rx)\right]\leq  
    \tau+ \sqrt{\frac{4\tau cC'(d+\ln{\left(\cu/\delta \right)})}{m'}}+\frac{5cC'\ln{\left(\cu e/\delta \right)}}{m}
\end{align}
with probability $ 1-4\delta/\cu $ at least over $ \rS_{1},\rS_{2}, \rS_{3},\rt_{1} $ and $ \rt_{2} $, where $ c,C,C'\geq 1 $ are universal constants and $ \cu= 86$. 
Applying a union bound over the above two events establishes the claim of the theorem. 


Let us begin by pursuing \cref{eq:secondmajority-1}. 
To this end, consider any realizations of $ S_{1},S_{2},t_{1}$ and $ t_{2} $ of $ \rS_{1},$ $ \rS_{2}, \rt_{1}$ and $ \rt_{2}.$ 
We note that for an example $ (x,y) $ with $ \avg(\widehat{\cA}_{\rt_{1}}(\rS_{1}))(x,y)\geq 232/243$ and $\avg(\widehat{\cA}_{t_{2}}(S_{2}))(x,y)\geq 232/243$, it must be the case that both $ \widehat{\cA}_{t_{1}}(S_{1}) $ and $ \widehat{\cA}_{t_{2}}(S_{2}) $  have at least a $ 232/243 $-fraction of hypotheses which err at $(x, y)$. 
Now let $ \rh $ be a random hypothesis drawn from $ \widehat{\cA}_{t_{1}}(S_{1}).$ Then with probability at least $ 232/243,$ $ \rh(x)\not=y.$ 
Thus, for any such example $ (x,y) $, we conclude that  
\begin{align*}
\hspace{-0.6 cm}
 \p_{\rh}\left[\rh(x)\not=y,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(x,y)\geq \frac{232}{243}\right]\geq \frac{232}{243}\ind\left\{ \avg(\widehat{\cA}_{t_{1}}(S_{1}))(x,y)\geq \frac{232}{243},\avg(\widehat{\cA}_{t_{2}}(S_{2}))(x,y)\geq \frac{232}{243} \right\}. 
\end{align*}

Multiplying both sides of the above equation by $ 243/232 $ and taking expectation with respect to $ (\rx,\ry)\sim\cD $ on both sides, we obtain
\begin{align}\label{eq:secondmajority2}
& \p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{232}{243},\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{232}{243}\right]   \\ 
& \qquad \leq \frac{243}{232}\e_{\rh}\left[\p_{(\rx,\ry)\sim \cD}\left[\rh(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{232}{243}\right]\right].
\end{align}
Now by $ \rh $ being drawn from $ \widehat{\cA}_{t_1}(S_{1}),$ which in turn is drawn from $ \cA(S_{1};\emptyset),$ we conclude that $ \rh $ is contained in $ \cA(S_{1};\emptyset).$ Thus, 
\[ \e_{\rh}\left[\p_{(\rx,\ry)\sim \cD}\left[\rh(x)\not=y,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq 232/243 \right]\right] \] 
can be upper bounded by $ \max_{h\in \cA(S_{1};\emptyset)}\p_{(\rx,\ry)\sim \cD}\left[h(x)\not=y,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq 232/243\right]$. 
Using this observation and substituting it into \cref{eq:secondmajority2}, we obtain that
\begin{align*}
& \p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{232}{243},\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{232}{243}\right] \\
& \qquad \leq\frac{243}{232}\max_{h\in \cA(S_{1};\emptyset)}\p_{(\rx,\ry)\sim \cD}\left[h(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{232}{243}\right] \\
& \qquad \leq\frac{243}{232}\max_{h\in \cA(S_{1};\emptyset)}\p_{(\rx,\ry)\sim \cD}\left[h(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right].
\end{align*}
As we demonstrated the above inequality for any realizations of $ S_{1},S_{2},t_{1}$ and $ t_{2} $ of $ \rS_{1},$ $ \rS_{2}, \rt_{1}$ and $ \rt_{2},$ the inequality also holds for the random variables. 
We now demonstrate that the right-hand side of the above expression can be bounded by
\begin{align}\label{eq:secondmajority0}
& \frac{243}{232}\max_{h\in \cA(S_{1};\emptyset)}\p_{(\rx,\ry)\sim \cD}\left[h(\rx)\not=\ry,\avg(\widehat{\cA}_{\rt_{2}}(\rS_{2}))(\rx,\ry)\geq \frac{11}{243}\right] \nonumber \\ 
& \qquad  \leq 1.0888\tau+\sqrt{\frac{16cC\tau(d+2\ln{\left(3\cu/\delta \right)})}{m'}}+\frac{6cC(d+\ln{\left(e\cu /\delta \right)})}{m'}
\end{align}
with probability at least $ 1-82\delta/\cu $ over $ \rS_{1} $, $ \rS_{2}$, and $ \rt_{2}.$ We denote  the above event  over $ \rS_{1},\rS_{2} $, and $ \rt_{2}$ as  $ E_{G}.$   
In pursuit of \cref{eq:secondmajority0}, we now consider the following events over $ \rS_{2}  $ and $ \rt_{2} $:  
\begin{align*}
E_{1} &= \left\{ \ls_{\cD}^{11/243}(\widehat{\cA}_{\rt_{2}}(\rS_{2}))\leq  \frac{c\ln{\left(\cu e/\delta \right)}}{m'} \right\}
 \\
E_{2} &= \left\{ \frac{c\ln{\left(\cu e/\delta \right)}}{m'} < \ls_{\cD}^{11/243}(\widehat{\cA}_{\rt_{2}}(\rS_{2}))\leq  c\tau+\frac{c\left(d+\ln{(\cu e/\delta )}\right)}{m'}\right\}
 \\
E_{3} &= \left\{ \ls_{\cD}^{11/243}(\widehat{\cA}_{\rt_{2}}(\rS_{2}))>  c\tau+\frac{c\left(d+\ln{(\cu e/\delta )}\right)}{m'}\right\},  
\end{align*}
where $c$ is at least the constant of \cref{thm:main} and also greater than $ c\geq 2\cdot 10^{6}s_{\sqcap}$.
We first notice that if $ S_{2} $ and $ t_{2} $   are realizations of $ \rS_{2} $ and $ \rt_{2} $ in $ E_{1},$ then by monotonicity of measures, we have that  
\begin{align}\label{eq:secondmajority9} 
    \frac{243}{232}\max_{h\in \cA(S_{1};\emptyset)}\p_{(\rx,\ry)\sim \cD}\left[h(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]\leq \frac{2c \ln{\left(\cu e/\delta \right)}}{m'},
\end{align}
which would imply the event $ E_{G} $ in \cref{eq:secondmajority0}.  

We now consider realizations $ S_{2} $ and $ t_{2} $ of $ \rS_{2} $ and $ \rt_{2} $ in $ E_{2}.$ 
Let $ \rS_{1,i,\sqcap}$ denote  $ (\rS_{1})_{i,\sqcap} $ and  $ \rS_{1,i,\sqcup}=(\rS_{1})_{i,\sqcup}$ for $ i\in \{  1,\ldots,27\}.$
Using this notation, we have that 
\begin{align*}
& \frac{243}{232}\max_{h\in \cA(S_{1};\emptyset)}\p_{(\rx,\ry)\sim \cD}\left[h(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]
    \\
&\quad =\frac{243}{232}\max_{i\in\{  1,\ldots,27\} } \max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})}\p_{(\rx,\ry)\sim \cD}\left[h(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right].
\end{align*}

We now bound the $\max$ term associated to each $i \in [27]$. To this end, fix such an $i$ and let $ A=\{ (x,y)\mid \avg(\widehat{\cA}_{t_{2}}(S_{2}))(x,y)\geq 11/243\}$. Also, let $\rN_{i}$ denote the number of examples in $ \rS_{1,i,\sqcap} $ landing in $ A  $, i.e., $ \rN_{i}=| \rS_{1,i,\sqcap}\sqcap A|.$  
Now by $ S_{2} $ and $ t_{2} $ being realizations of $ \rS_{2} $ and $ \rt_{2} $ in $ E_{2}$, we have that $ \p\left[A\right]=\p_{(\rx,\ry)\sim\cD}[A]=\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))\geq \frac{c\ln{\left(\cu e/\delta \right)}}{m'}.$
Thus, as $\rS_{1,i,\sqcap}\sim \cD^{m'/s_{\sqcap}}$, we have that $ \e\left[N_{i}\right]=\p[A]m'/s_{\sqcap}$. 
Furthermore, this implies by Chernoff that with probability at least $ 1-\delta/\cu $ over $ \rS_{1,i,\sqcap} $,  
\begin{align*}
 \p_{\rN_{i}}\left[\rN_{i}> (1-1/1000)\p[A]m'/s_{\sqcap}\right] \geq 1- \exp{\left(-\p[A]m'/(2\cdot 1000^{2}s_{\sqcap} )\right)} \geq 1-\delta/\cu
\end{align*}
where the last inequality follows by $ \p[A]\geq \frac{c\ln{\left(\cu e/\delta \right)}}{m'}$ and $ c\geq 2\cdot 10^{6}s_{\sqcap}.$  
Let now $ \cD(\cdot \mid A) $ be the conditional distribution of $ A $, i.e., for an event $ E $ over $ \cX\times \cY  $, we have that $ \cD(E\mid A)=\p_{(\rx,\ry)\sim \cD}\left[(\rx,\ry)\in E\cap A\right]/\p_{(\rx,\ry)\sim \cD}\left[(\rx,\ry)\in A\right].$ 
Since $ \rS_{1,i,\sqcap}\sim \cD $, it follows that $ \rS_{1}\sqcap A \sim \cD(\cdot \mid A)^{\rN_{i}}.$  
Consider now a realization $ N_{i} $ of $ \rN_{i}$ with 
\[ N_i \geq (1-1/1000)\p[A]m'/s_{\sqcap}=(1-1/1000)\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))m'/s_{\sqcap}. \]   
Then by the law of total probability and definition of $\cD(\, \cdot \,| A)$, we have that 
\begin{align*}
&\max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})}\p_{(\rx,\ry)\sim \cD}\left[h(x)\not=y,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right] \\
&=\max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})}\p_{(\rx,\ry)\sim \cD}\left[h(x)\not=y\mid\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]\p_{(\rx,\ry)\sim \cD}\left[\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right] \\
&= \max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})}\p_{(\rx,\ry)\sim \cD(\cdot\mid A)}\left[h(x)\not=y\right]\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2})),
\end{align*}
where the last equality follows by the definition of $ \cD(\cdot | A).$ 
Furthermore, by \cref{lem:fundamentalheoremoflearning}, we have with probability at least $ 1-\delta/\cu $ over $ \rS_{1,i,\sqcap}\sqcap A\sim \cD(\cdot\mid A)^{N_{i}} $ that
\begin{align}\label{eq:secondmajority4}
& \max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})}\p_{(\rx,\ry)\sim \cD(\cdot\mid A)}\left[h(x)\not=y\right]\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2})) \nonumber \\
& \quad \leq \ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))\left(\max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})}\ls_{\rS_{1,i,\sqcap}\sqcap A}(h)+\sqrt{\frac{C(d+\ln{\left(e\cu/\delta \right)})}{N_{i}}}\right),
\end{align}
where  $ C\geq1 $ is the universal constant of \cref{lem:fundamentalheoremoflearning}.   
We now bound each term, starting with the first. 
Now, $ \max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})}\ls_{\rS_{1,i,\sqcap}\sqcap A}(h) $ is equal to $ \max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})} \Sigma_{\not=}(h,\rS_{1,i,\sqcap}\sqcap A)/N_{i}.$ 
And as any $ h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap}) $ is equal to $ h=\cA(S') $ for some $ S'\in \cS(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap}),$ we get that $ \max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})} \Sigma_{\not=}(h,\rS_{1,i,\sqcap}\sqcap A)$ is equal to $ \max_{S'\in \cS(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})} \Sigma_{\not=}(\cA(S'),\rS_{1,i,\sqcap}\sqcap A).$ 
Furthermore, since any $ S'\in \cS(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap}) $ contains the training sequence $ \rS_{1,i,\sqcap} \sqcap A$, we get that 
$ \max_{S'\in \cS(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})} \Sigma_{\not=}(\cA(S'),\rS_{1,i,\sqcap}\sqcap A) \leq  \max_{S'\in \cS(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})} \Sigma_{\not=}(\cA(S'),S').$

Now we have that $ \cA(S') $ is a $ \cerm $-algorithm run on $ S',$ thus $ \cA(S') \in \cH $ and any other hypothesis in $ \cH $ has a larger empirical error on $ S' $ than $ \cA(S'), $ including $ \hs$. We thus have that $ \max_{S'\in \cS(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})} \Sigma_{\not=}(\cA(S'),S') \leq \max_{S'\in \cS(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})} \Sigma_{\not=}(\hs,S'),$ which, since $ S' $ is contained in $ \rS_{1,i}=(\rS_{1})_{i} $, can further be upper bounded by $ \Sigma_{\not=}(\hs,\rS_{1,i})$. We can thus conclude that 
\[ \max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})}\ls_{\rS_{1,i,\sqcap}\sqcap A}(h)\leq  \Sigma_{\not=}(\hs,\rS_{1,i})/N_{i}=m'\ls_{\rS_{1,i}}(\hs)/(3^3N_{i}). \] Note we have used that $ |\rS_{1,i}|=m'/3^{3}.$  
Now, using the fact that we have crystallized an event $N_i$ with
$ N_{i}\geq  (1-1/1000)\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))m'/s_{\sqcap},$ we have that the first term of \cref{eq:secondmajority4} (after factoring out the multiplication) can be bounded as follows:
\begin{align}\label{eq:secondmajority5}
\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))\max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})}\ls_{\rS_{1,i,\sqcap}\sqcap A}(h)
& \leq
\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))\frac{m'}{3N_{i}}\ls_{\rS_{1,i}}(\hs) \nonumber \\ 
& \leq \frac{1000s_{\sqcap}}{3^{3}999}\ls_{\rS_{1,i}}(\hs) \nonumber 
\\
& \leq \frac{1000\cdot27}{999\cdot26}\ls_{\rS_{1,i}}(\hs)
\end{align}     
where we, in the last inequality, have used that $ s_{\sqcap}=\frac{3^{3}}{1-\frac{1}{27}}$. This concludes the bound on the first term in \cref{eq:secondmajority4}.

Now, using that $ N_{i}\geq  (1-1/1000)\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))m'/s_{\sqcap},$ we get that the second term in \cref{eq:secondmajority4} can be bound as follows:
\begin{align*}
\sqrt{\frac{C(d+\ln{\left(e\cu/\delta \right)})}{N_{i}}}\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))
& \leq 
\sqrt{\frac{1000C(d+\ln{\left(e\cu/\delta \right)})\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))s_{\sqcap}}{999m'}}
\nonumber  \\
& \leq\sqrt{\frac{3^{3}\cdot27\cdot 1000C(d+\ln{\left(e\cu/\delta \right)})\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))}{26\cdot999m'}} \nonumber \\
& \leq\sqrt{\frac{29C(d+\ln{\left(e\cu/\delta \right)})\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))}{m'}}.
\end{align*}
In the second inequality we have used that $ s_{\sqcap}=\frac{3^{3}}{1-\frac{1}{27}}.$ 
We now use the assumption that we had realizations $ S_{2} $ and $ t_{2} $ of  $ \rS_{2} $ and $ \rt_{2} $ in $ E_{2} $, i.e., such that $\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))\leq  c\tau+\frac{c\left(d+\ln{(\cu e/\delta )}\right)}{m'}$. This allows us to conclude that
\begin{align}\label{eq:secondmajority6}
\sqrt{\frac{4C(d+\ln{\left(e\cu/\delta \right)})\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))}{m'}}
   &\leq \sqrt{\frac{4C(d+\ln{\left(e\cu/\delta \right)})\left(c\tau+\frac{c\left(d+\ln{(\cu e/\delta )}\right)}{m'}\right)}{m'}}
   \\
   &\leq \sqrt{\frac{4cC\tau(d+\ln{\left(e\cu/\delta \right)})}{m'}}+\frac{4cC(d+\ln{\left(e\cu/\delta \right)})}{m'},
\end{align}
where we have used the inequality $ \sqrt{a+b}\leq \sqrt{a}+\sqrt{b} $ for $ a,b\geq0 $ in the last step.

Then, to summarize, we have seen that the event $\rN_{i}\geq (1-1/1000)\p[A]m'/s_{\sqcap}=(1-1/1000)\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))m'/s_{\sqcap}$ occurs with probability at least $ 1-\delta/\cu $, and that conditioned on this event, \cref{eq:secondmajority4} holds with probability at least $ 1-\delta/\cu $. Consequently, we have that with probability at least $ 1-2\delta/\cu $ over $ \rS_{1,i} $ each of \cref{eq:secondmajority4}, \cref{eq:secondmajority5} and \cref{eq:secondmajority6} hold. Then, with probability at least $ 1-2\delta/\cu $ over $ \rS_{1,i} $ we have that
\begin{align*}
& \frac{243}{232}\max_{h\in \cA(\rS_{1,i,\sqcup};\rS_{1,i,\sqcap})}\p_{(\rx,\ry)\sim \cD}\left[h(x)\not=y,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right] \\
& \quad \leq \frac{243}{232} \frac{1000\cdot27}{999\cdot26}\ls_{\rS_{1,i}}(\hs)+\sqrt{\frac{4cC\tau(d+\ln{\left(e\cu/\delta \right)})}{m'}}+\frac{4cC(d+\ln{\left(e\cu/\delta \right)})}{m'}
    \\
& \quad \leq 1.0888\ls_{\rS_{1,i}}(\hs)+\sqrt{\frac{4cC\tau(d+\ln{\left(e\cu/\delta \right)})}{m'}}+\frac{4cC(d+\ln{\left(e\cu/\delta \right)})}{m'}.
\end{align*} 
Now, invoking a union bound over $ i\in \{ 1,\ldots,27 \} $, we have that with probability at least $ 1-54\delta/\cu $ over $ \rS_{1} $, it holds that
\begin{align}\label{eq:secondmajority7}
& \frac{243}{232}\max_{h\in \cA(\rS_{1};\emptyset)}\p_{(\rx,\ry)\sim \cD}\left[h(x)\not=y,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right] \nonumber \\
&\quad \leq 1.0888\max_{i\in\{  1,\ldots,27\} }\ls_{\rS_{1,i}}(\hs)+\sqrt{\frac{4cC\tau(d+\ln{\left(e\cu/\delta \right)})}{m'}}+\frac{4cC(d+\ln{\left(e\cu/\delta \right)})}{m'}. 
\end{align}
Furthermore, by \cref{lem:additiveerrorhstar} and another union bound over $ \rS_{1,1},\ldots,\rS_{1,27} $, we have that with probability at least $ 1-27\delta/\cu $ over $ \rS_{1}\sim \cD^{m'}$ it holds that

\begin{align}\label{eq:secondmajority8}
    \max_{i\in\{  1,\ldots,27\} }\ls_{\rS_{1,i}}(\hs)\leq \tau+\sqrt{\frac{2\tau \ln{(\cu /\delta )}}{3m'}}+\frac{2\ln{(\cu /\delta )}}{m'}.
\end{align}
Thus, by applying the union bound over the events in \cref{eq:secondmajority7} and \cref{eq:secondmajority8}, we get that with probability at least $ 1-81\delta/\cu $ over $ \rS_{1} $, it holds that
\begin{align}\label{eq:secondmajority10}
& \frac{243}{232}\max_{h\in \cA(\rS_{1};\emptyset)}\p_{(\rx,\ry)\sim \cD}\left[h(x)\not=y,\avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right] \nonumber
    \\
& \quad \leq 1.0888\left(\tau+\sqrt{\frac{2\tau \ln{(\cu /\delta )}}{3m'}}+\frac{2\ln{(\cu /\delta )}}{m'}\right)+\sqrt{\frac{4cC\tau(d+\ln{\left(e\cu/\delta \right)})}{m'}}+\frac{4cC(d+\ln{\left(e\cu/\delta \right)})}{m'} \nonumber 
    \\
& \quad \leq  1.0888\tau+\sqrt{\frac{16cC\tau(d+2\ln{\left(3\cu/\delta \right)})}{m'}}+\frac{6cC(d+\ln{\left(e\cu /\delta \right)})}{m'}.
\end{align}
Note that this suffices to give the event $ E_{G} $ in \cref{eq:secondmajority0}.
We remark that we demonstrated the above for any realizations $ S_{2} $ and $ t_{2} $ of $ \rS_{2} $ and $ \rt_{2}$ in $ E_{2}.$

We now notice that by \cref{thm:main}, the fact that $ t_{1}\geq 4\cdot243^{2}\ln{\left(2m/(\delta(d+\ln{\left(\cur/\delta \right)})) \right)}$, and the choice of $ \cu=\cur $), we have that $ \p_{\rS_{2},\rt_{2}}[E_{3}]\leq \delta/\cu.$ 
Combining this with the conclusion below \cref{eq:secondmajority9} and \cref{eq:secondmajority10}, and with the fact that $ \rS_{1},$  $ \rS_{2} $ $ \rt_{2} $ are independent, we have that 
\begin{align*}
 \p_{\rS_{1},\rS_{2},\rt_{2}}\left[E_{G}\right]
& =\e_{\rS_{2},\rt_{2}}\left[\p_{\rS_{1}}\left[E_{G}\right]\ind\{   E_{1}\}\right]+\e_{\rS_{2},\rt_{2}}\left[\p_{\rS_{1}}\left[E_{G}\right]\ind\{   E_{2}\}\right]+\e_{\rS_{2},\rt_{2}}\left[\p_{\rS_{1}}\left[E_{G}\right]\ind\{   E_{3}\}\right]
 \\
 & \geq  \p_{\rS_{2},\rt_{2}}\left[ E_{1}\right]+(1-81\delta/\cu)\p_{\rS_{2},\rt_{2}}\left[ E_{2}\right] \\
 &\geq(1-81\delta/\cu)(1-\p_{\rS_{2},\rt_{2}}[E_{3}]) \\
 & \geq1-82\delta/\cu.
\end{align*}
Note that first equality follows from $ E_{1},E_{2},E_{3} $ partitioning the outcomes of $ \rS_{2} $ and $ \rt_{2}$ and the first inequality follows from the conclusions below \cref{eq:secondmajority9} and \cref{eq:secondmajority10}, which state that $ E_{G} $ holds with probability $ 1 $ on $ E_{1} $ and with probability at least $ 1-81\delta/\cu$ on $ E_{2} $. The second inequality again follows from $ E_{1},E_{2},E_{3} $ partitioning the outcomes of $ \rS_{2} $ and $ \rt_{2}$ and the bound $ \p_{\rS_{2},\rt_{2}}[E_{3}]\leq \delta/\cu,$ which shows \cref{eq:secondmajority-1}.

We now proceed to show \cref{eq:secondmajority-2}, i.e., that with probability at least $ 1-4\delta/\cu $ over $ \rS_{1},\rS_{2},\rS_{3},\rt_{1},\rt_{2},$ it holds that
\begin{align}\label{eq:secondmajority11}
& \p_{(\rx,\ry)\sim\cD}\left[ \htie\not=\ry, \avg(\widehat{\cA}_{\rt_{1}}(\rS_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{\rt_{2}}(\rS_{2}))(\rx,\ry)\geq \frac{11}{243}\right] \nonumber \\
& \quad \leq 
    \tau+ \sqrt{\frac{4\tau cC'(d+\ln{\left(\cu/\delta \right)})}{m'}}+\frac{5cC'\ln{\left(\cu e/\delta \right)}}{m}.
\end{align}
We denote this event $ E_{F}.$ 
Towards proving the claim, we consider the following event over $ \rS_{1},\rS_{2},\rt_{1}$ and $ \rt_{2}$,
\begin{align*}
        E_{4} = \left\{ \p_{(\rx,\ry)\sim \cD}\left[ \avg(\widehat{\cA}_{\rt_{1}}(\rS_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{\rt_{2}}(\rS_{2}))(\rx,\ry)\geq \frac{11}{243}\right]\leq  \frac{c\ln{\left(\cu e/\delta \right)}}{m'} \right\}. 
\end{align*}
As previously mentioned, we take $ c $ to be at least the constant of \cref{thm:main} and to also satisfy $ c\geq 2\cdot10^{6}s_{\sqcap} $.

Now, if we have realizations $ S_{1},S_{2},t_{1} $ and $ t_{2} $ of $ \rS_{1},$ $ \rS_{2},$ $ \rt_{1} $ and $ \rt_{2} $ in $ E_{4},$ then by monotonicity of measures, we obtain that
\begin{align*}
    \p_{(\rx,\ry)\sim\cD}\left[\htie\not=\ry,  \avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]\leq \frac{c\ln{\left(\cu e/\delta \right)}}{m'},
\end{align*}
which would imply the event $ E_{F} $ in \cref{eq:secondmajority11}.
Now consider a realization of $ S_{1},S_{2},t_{1} $ and $ t_{2} $ of $ \rS_{1},$ $ \rS_{2},$ $ \rt_{1} $ and $ \rt_{2} $ on the complement $ \bar{E}_{4} $ of $ E_{4}.$ 
We then have that 
\[ \p_{(\rx,\ry)\sim\cD}\left[ \avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq 11/243 \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq 11/243\right] \geq \frac{c\ln{\left(\cu e/\delta \right)}}{m'}. \] 
We recall that $ \rS_{3}^{\not=},$ are the examples in $(x,y)\in \rS_{3}$ for which  
\[ \avg(\widehat{\cA}_{t_{1}}(S_{1}))(x,y)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(x,y)\geq \frac{11}{243}. \] 
In the following, let $ \cD(\, \cdot \, | \not=) $ be the conditional distribution of $ \cD $ given that $\avg(\widehat{\cA}_{t_{1}}(S_{1}))(x,y)\geq \frac{11}{243}$ or $\avg(\widehat{\cA}_{t_{2}}(S_{2}))(x,y)\geq \frac{11}{243}$. That is, for an event $ B $ over $ (\cX\times \cY),$ we have
\begin{align*}
  \cD(B|\not=)=\frac{\p_{(\rx,\ry)\sim \cD}\left[(\rx,\ry)\in B, \avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]}{\p_{(\rx,\ry)\sim \cD}\left[ \avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]}
\end{align*}     
Thus we have that $ \rS_{3}^{\not=}\sim \cD(B|\not=).$ 
We now notice by $ \rS_{3}\sim \cD $ that
\begin{align*}
\e_{\rS_{3}}\left[|\rS_{3}^{\not=}|\right]=m'\p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right].
\end{align*}  
Using a Chernoff bound, this implies 
\begin{align*}
& \hspace{-1cm} \p_{\rS_{3}}\left[|\rS_{3}^{\not=}|\geq m'\p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]/2\right]
 \\
&  \geq 1- \exp{\left(-m'\p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]/8 \right)} \\
&\geq 1-\delta/\cu.  
\end{align*}   
Note that we are also using the facts that 
\[ \p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right] \geq \frac{c\ln{\left(\cu e/\delta \right)}}{m'} \]
and that $ c\geq 2\cdot1000^{2} s_{\sqcap}$.   
Now consider an outcome of $ N_{\not=}=|\rS_{3}^{\not=}| $ where 
\[ N_{\not=} \geq \frac{m'}{2} \p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]. \] 
Now, by \cref{thm:ermtheoremunderstanding} we have that since $ \htie=\cA(\rS_{3}^{\not=})$ and $ \rS_{3}^{\not=}\sim \cD(\cdot | \not=) $, then with probability at least $ 1-\delta/\cu $ over $ \rS_{3}^{\not=} $,
\begin{align*}
\p_{(\rx,\ry)\sim\cD(\cdot|\not=)}\left[ \htie(\rx)\not=\ry\right] &\leq \inf_{h\in\cH}\ls_{\cD(\cdot|\not=)}(h)+\sqrt{\frac{C'(d+\ln{\left(\cu/\delta \right)})}{N_{\not=}}} \\
& \leq \ls_{\cD(\cdot|\not=)}(\hs)+\sqrt{\frac{C'(d+\ln{\left(\cu/\delta \right)})}{N_{\not=}}}.   
\end{align*}
Note that the first inequality uses \cref{thm:ermtheoremunderstanding} (and $ C'>1 $  is the universal constant of \cref{thm:ermtheoremunderstanding}), and the second inequality uses that $ \hs\in \cH $ so it has error greater than the infimum. 
Now, using the law of total expectation, we have that  
\begin{align*}
& \p_{(\rx,\ry)\sim\cD}\left[ \htie(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]\\
& \quad = \p_{(\rx,\ry)\sim\cD(\cdot|\not=)}\left[ \htie(\rx)\not=\ry\right]\p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]
    \\
& \quad \leq \left(\ls_{\cD(\cdot|\not=)}(\hs)+\sqrt{\frac{C'(d+\ln{\left(\cu/\delta \right)})}{N_{\not=}}}\right)   \\
& \qquad \times \p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]
\end{align*}
We now bound each term in the above. 
First, 
\begin{align*}
& \ls_{\cD(\cdot|\not=)}(\hs)  \p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)> 11/243 \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)> 11/243\right] \\
& \quad =\p_{\rx,\ry\sim\cD}\left[\hs(\rx)\not=\ry,\widehat{\cA}_{t_{1}}(S_{1})(\rx)\not=\widehat{\cA}_{t_{2}}(S_{2})(\rx)\right] 
\end{align*}
which is less than $ \tau.$ 
Furthermore, for the second term, we have by 
\[ N_{\not=}\geq \frac{m'}{2}\p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)> 11/243 \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)> 11/243\right] \] 
that 
\begin{align*}
& \sqrt{\frac{C'(d+\ln{\left(\cu/\delta \right)})}{N_{\not=}}}\p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]
    \\
& \quad \leq \sqrt{\frac{2C'(d+\ln{\left(\cu/\delta \right)})\left(\ls_{\cD}^{11/243}(\widehat{\cA}_{t_{1}}(S_{1})) +\ls_{\cD}^{11/243}(\widehat{\cA}_{t_{2}}(S_{2}))\right)}{m'}}
    \end{align*}    
where the first inequality follows from plugging in that 
\[ N_{\not=}\geq \frac{m'}{2} \p_{(\rx,\ry)\sim\cD}\left[\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)> 11/243 \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)> 11/243\right] \]  in the denominator, and the second inequality follows from a union bound over the event 
\[ \avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)> 11/243 \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)> 11/243 .\]  
Thus, we have shown that with probability at least $ 1-2\delta/\cu $ over $\rS_{3}$, it holds that 
\begin{align*}
    \p_{(\rx,\ry)\sim\cD}\left[ \htie(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]
    \\
    \leq \tau+ \sqrt{\frac{2C'(d+\ln{\left(\cu/\delta \right)})\left(\ls_{\cD}(\widehat{\cA}_{t_{1}}(S_{1})) +\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))\right)}{m'}}
\end{align*}
which, in particular, also implies that with probability at least $ 1-2\delta/\cu $ over $ \rS_{3} $ 
\begin{align*}
    \p_{(\rx,\ry)\sim\cD}\left[ \htie(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]
    \\
    \leq \tau+ \sqrt{\frac{2C'(d+\ln{\left(\cu/\delta \right)})\left(\ls_{\cD}(\widehat{\cA}_{t_{1}}(S_{1})) +\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))\right)}{m'}}+\frac{c\ln{\left(\cu e/\delta \right)}}{m}.
\end{align*}
Thus, since the above also upper bounds 
\[ \p_{(\rx,\ry)\sim\cD}\left[ \htie(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right] \]
for any realization $ S_{1},S_{2},t_{1} $ and $ t_{2} $ of $ \rS_{1},\rS_{2},\rt_{1} $, and $ \rt_{2},$ on $ E_{4},$ (with probability $ 1 $), we conclude that for any realization  $S_{1},S_{2},t_{1} $, and $ t_{2} $ of $ \rS_{1},\rS_{2},\rt_{1} $, and $ \rt_{2},$ it holds with probability at least $ 1-2\delta/\cu $ over $ \rS_{3} $ that 
\begin{align*}
    \p_{(\rx,\ry)\sim\cD}\left[ \htie(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]
    \\
    \leq \tau+ \sqrt{\frac{2C'(d+\ln{\left(\cu/\delta \right)})\left(\ls_{\cD}(\widehat{\cA}_{t_{1}}(S_{1})) +\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))\right)}{m'}}+\frac{c\ln{\left(\cu e/\delta \right)}}{m}.
\end{align*}
Let this event be denoted $ E_{5} $. 
Now, let $ E_{6} $ be the event that
\begin{align*}
 E_{6}= \left \{ \ls_{\cD}(\widehat{\cA}_{t_{1}}(S_{1})) +\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2})) \leq 2 \left(c\tau+\frac{c\left(d+\ln{(\cu e/\delta )}\right)}{m'} \right) \right\} 
\end{align*} 
which, by \cref{thm:main}, the fact that $ t_{1},t_{2}\geq 4\cdot243^{2}\ln{\left(2m/(\delta(d+\ln{\left(\cur/\delta \right)})) \right)} $, and a union bound, holds with probability at least $ 1-2\delta/\cu $. (We let $ c>1 $ be a universal constant at least as large as the universal constant of \cref{thm:main}, and with $ c\geq 2\cdot10^{6}s_{\sqcap} $.) 
Now, notice that for realizations $S_{1},S_{2},t_{1} $ and $ t_{2} $ of $ \rS_{1},\rS_{2},\rt_{1} $ and $ \rt_{2},$ on $ E_{6} $,  it holds with probability at least $ 1-2\delta/\cu $ over $ \rS_{3} $ that 
\begin{align*}
& \p_{(\rx,\ry)\sim\cD}\left[ \htie(\rx)\not=\ry,\avg(\widehat{\cA}_{t_{1}}(S_{1}))(\rx,\ry)\geq \frac{11}{243} \text{ or } \avg(\widehat{\cA}_{t_{2}}(S_{2}))(\rx,\ry)\geq \frac{11}{243}\right]
    \\
& \qquad \leq \tau+ \sqrt{\frac{2C'(d+\ln{\left(\cu/\delta \right)})\left(\ls_{\cD}(\widehat{\cA}_{t_{1}}(S_{1})) +\ls_{\cD}(\widehat{\cA}_{t_{2}}(S_{2}))\right)}{m'}}+\frac{c\ln{\left(\cu e/\delta \right)}}{m}
    \\
& \qquad \leq\tau+ \sqrt{\frac{4C'(d+\ln{\left(\cu/\delta \right)})\left(c\tau+\frac{c\left(d+\ln{(\cu e/\delta )}\right)}{m'}\right)}{m'}}+\frac{c\ln{\left(\cu e/\delta \right)}}{m}
    \\
& \qquad \leq
    \tau+ \sqrt{\frac{4\tau cC'(d+\ln{\left(\cu/\delta \right)})}{m'}}+\frac{5cC'\ln{\left(\cu e/\delta \right)}}{m}.
\end{align*}
where the first inequality follows by $ E_{5},$ the second inequality by $ E_{6},$ and the third inequality by $ \sqrt{a+b}\leq \sqrt{a}+\sqrt{b}.$ 
We notice that the above event is $ E_{F} $ in \cref{eq:secondmajority11}. 
Thus, by the above holding with probability at least $ 1-2\delta/\cu $ for any outcome of $ S_{1},S_{2},t_{1} $ and $ t_{2} $ of $ \rS_{1},\rS_{2},\rt_{1} $ and $ \rt_{2}$ on $ E_{6} $, and by $ \rS_{1},\rS_{2}$ and $\rS_{3} $ being independent  we conclude that 
\begin{align*}
 \p_{\rS_{1},\rS_{2},\rS_{3},\rt_{1},\rt_{2}}\left[ E_{F}\right] 
 & \geq\e_{\rS_{1},\rS_{2},\rS_{3},\rt_{1},\rt_{2}}\left[ \p_{\rS_{3}}\left[E_{F},E_{5}\right]\ind\{  E_{6}\} \right] \\
 &=\e_{\rS_{1},\rS_{2},\rS_{3},\rt_{1},\rt_{2}}\left[ \p_{\rS_{3}}\left[E_{5}\right]\ind\{  E_{6}\} \right]
 \\
 &\geq\e_{\rS_{1},\rS_{2},\rS_{3},\rt_{1},\rt_{2}}\left[ (1-2\delta/\cu)\ind\{  E_{6}\} \right] \\
 & \geq (1-2\delta/\cu)^{2} \\ & \geq 1-4\delta/\cu. 
\end{align*} 
Note that the equality follows from our previous reasoning, i.e., that for outcomes of $ S_{1},S_{2},t_{1} $ and $ t_{2} $ of $ \rS_{1},\rS_{2},\rt_{1} $ and $ \rt_{2}$ on $ E_{6} $, and outcomes $ S_{3} $  of $ \rS_{3} $ on $ E_{5} $, $ E_{F} $ holds. The second inequality follows from the fact that $E_{5}$ holds with probability at least $ 1-2\delta/\cu $ over $ \rS_{3} $  for any realizations $ S_{1},S_{2},t_{1} $ and $ t_{2} $ of $ \rS_{1},\rS_{2},\rt_{1} $ and $ \rt_{2}$. The third inequality follows from the fact that $ E_{6} $ holds with probability at least $ 1-2\delta/\cu $ for $ \rS_{1},\rS_{2}, \rt_{1} $ and $ \rt_{2},$ which concludes the proof of \cref{eq:secondmajority-2}, as desired.      
\end{proofof}


\section{Best-of-both-worlds Learner}


In this section we demonstrate that splitting a  training sample $ \rS \sim \cD^{m} $ into $\{ \rS_i \sim \cD^{m/3}\}_{i \in [3]}$ followed by running the algorithm of \citet{hanneke2024revisiting} on $ \rS_{1} $, running the algorithm of \cref{thm:main} on $ \rS_{2} $, and selecting the one $\hmin$ with smallest empirical error on $ \rS_{3} $  gives the following error bound:
\begin{align*}
\ls_{\cD}(\hmin) = \min\Bigg(&2.1 \cdot \tau+O\left(\sqrt{\frac{\tau(d+\ln{\left(1/\delta \right)})}{m}}+\frac{\left(d+\ln{\left(1/\delta \right)}\right)}{m}\right), \\
&\tau+O\left(\sqrt{\frac{\tau(d+\ln{\left(1/\delta \right)})}{m}}+\frac{\ln^{5}{\left( m/d\right)}\left(d+\ln{\left(1/\delta \right)}      \right)}{m} \right)\Bigg).
\end{align*}

In pursuit of the above, recall the error bound of \cite[Theorem~3]{hanneke2024revisiting}, which establishes the existence of a learner $ \tilde{\cA} $ which with probability at least $ 1-\delta  $ over $ \rS \sim \cD^m$ incurs error at most
\begin{align*}
    \ls_{\cD}(\tilde{\cA}(\rS))\leq \tau+\sqrt{\frac{c'\tau(d+\ln{\left(1/\delta \right)})}{m}}+\frac{c'\ln^{5}{\left( m/d\right)}\left(d+\ln{\left(1/\delta \right)}      \right)}{m},
\end{align*}
for a universal constant $c' \geq 1$. 
We will in the following use $ \widehat{\cA}_{\rt} $ to denote the algorithm of \Cref{thm:tiemajority}. In what follows let $m'=m/3.$

By invoking the previous bounds on  $ \widehat{\cA}_{\rt} $ and $ \tilde{\cA} $ with $\delta = \delta/4$, and further employing a union bound, we have that with probability at least $1 - \delta/2$ over $\rS_1$ and $\rS_2$, both $\tilde{\cA}$ and $\widehat{\cA}_{\rt}$ will emit hypotheses satisfying: 
\begin{align}\label{eq:bestofbothworld0}
 \ls_{\cD}(\tilde{\cA}(\rS_{1})) &\leq \tau+\sqrt{\frac{c'\tau(d+\ln{\left(4/\delta \right)})}{m'}}+\frac{c'\ln^{5}{\left( m'/d\right)}\left(d+\ln{\left(4/\delta \right)}      \right)}{m'} \\
 \ls_{\cD}(\widehat{\cA}_{\rt}(\rS_{2};\emptyset)) &\leq 2.1 \cdot \tau+\sqrt{\frac{c\tau(d+\ln{\left(4/\delta \right)})}{m'}}+\frac{c\left(d+\ln{\left(4/\delta \right)}\right)}{m'}, \label{eq:bestofbothworld0.5}
\end{align}
where $c$ is the universal constant of \Cref{thm:tiemajority}. Let $G$ denote the event that $\rS$ satisfies the previous condition, which, as we have noted, has probability at least $1 - \delta / 2$. 

Now consider realizations $ S_{1} $ and $ S_{2} $  of $\rS_1$ and $\rS_2$ with $(\rS_1,\rS_2) \in G$. Further, let $ \hmin=\argmin_{h'\in\{   \tilde{\cA}(S_{1}),\widehat{\cA}(S_{2};\emptyset)\}}\left(\ls_{\rS_{3}}(h')\right)$. 
We now invoke \Cref{lem:additiveerrorhstar} on $ \rS_{3}$ with the classifiers $ \tilde{\cA}(S_{1})$ and $\widehat{\cA}_{t}(S_{2};\emptyset)$ (and failure probability $\delta/8$) along with a union bound to see that with probability at least  $ 1-\delta/2 $  over $ \rS_{3} $, we have that both choices of  $ h\in\{   \tilde{\cA}(S_{1}),\widehat{\cA}(S_{2};\emptyset)\}$ satisfy 

\begin{align}\label{eq:bestofbothworld2}
    \ls_{\cD}(h)\leq \ls_{\rS_{3}}(h) +\sqrt{\frac{2\ls_{\rS_{3}}(h)\ln{(8/\delta )}}{m'}}+\frac{4\ln{(8/\delta )}}{m'},
    \end{align}
and
\begin{align}\label{eq:bestofbothworld1}
\ls_{\rS_{3}}(h)\leq \ls_{\cD}(h) +\sqrt{\frac{2\ls_{\cD}(h)\ln{(8/\delta )}}{3m'}}+\frac{2\ln{(8/\delta )}}{m'}\leq 2\ls_{\cD}(h')+\frac{4\ln{\left(8/\delta \right)}}{m'}. 
\end{align}
Note that the final inequality follows from the fact that $ \sqrt{ab}\leq a+b $ for $ a,b>0.$ 
Then, using the previous inequalities along with the definition of $\hmin$, we have that: 
\begin{align}\label{eq:bestofbothworld4}
 \ls_{\cD}(\hmin) &\leq  \ls_{\rS_{3}}(\hmin) +\sqrt{\frac{2\ls_{\rS_{3}}(\hmin)\ln{(8/\delta )}}{m'}}+\frac{4\ln{(8/\delta )}}{m'}
 \\
&\leq \min_{h\in\{   \tilde{\cA}(S_{1}),\widehat{\cA}(S_{2};\emptyset)\}}\left(\ls_{\rS_{3}}(h) +\sqrt{\frac{2\ls_{\rS_{3}}(h)\ln{(8/\delta )}}{m'}}+\frac{4\ln{(8/\delta )}}{m'}\right)
 \\
& \leq \min_{h\in\{   \tilde{\cA}(S_{1}),\widehat{\cA}(S_{2};\emptyset)\}}\Bigg(\ls_{\cD}(h) +\sqrt{\frac{2\ls_{\cD}(h)\ln{(8/\delta )}}{m'}}+\frac{6\ln{(8/\delta )}}{m'}  \nonumber \\
& \qquad + \sqrt{\frac{2\left( 2\ls_{\cD}(h)+4\ln{\left(8/\delta \right)}/m' \right)\ln{\left(8/\delta \right)}}{m'}}\Bigg)
 \\
& \leq  \min_{h\in\{   \tilde{\cA}(S_{1}),\widehat{\cA}(S_{2};\emptyset)\}}\left(\ls_{\cD}(h) + 3 \sqrt{\frac{2\ls_{\cD}(h)\ln{(8/\delta )}}{m'}}+\frac{9\ln{(8/\delta )}}{m'}\right).
\end{align}
In particular, the first inequality follows from \cref{eq:bestofbothworld2} applied to $\hmin$, the second from the definition of $\hmin$, the third from \cref{eq:bestofbothworld1}, and the fourth from the fact that $ \sqrt{a+b}\leq \sqrt{a}+\sqrt{b}$ for $ a,b>0.$ 
Now using the equations in \cref{eq:bestofbothworld0} we have that 
\begin{align}\label{eq:bestofbothworld3}
\vspace{-1 cm}
    \ls_{\cD}(\tilde{\cA}(\rS_{1}))\leq \tau+\sqrt{\frac{c'\tau(d+\ln{\left(4/\delta \right)})}{m'}}+\frac{c'\ln^{5}{\left( m'/d\right)}\left(d+\ln{\left(4/\delta \right)}      \right)}{m'} 
    \leq 2\tau+\frac{2c'\ln^{5}{\left( m'/d\right)}\left(d+\ln{\left(4/\delta \right)}      \right)}{m'}
\end{align}
since $ \sqrt{ab}\leq a+b $ for $ a,b>0$. (We are further assuming that $m = \Omega(d)$, a standard condition.) Then, using \cref{eq:bestofbothworld3} and the fact that $ \sqrt{a+b}\leq \sqrt{a}+\sqrt{b} $ for $ a,b>0$, we have 
\begin{align*}
 \sqrt{\frac{2\ls_{\cD}(\tilde{\cA}(\rS_{1}))\ln{\left(8/\delta \right)}}{m'}} 
 \leq  \sqrt{\frac{2\left(2\tau+2\frac{c'\ln^{5}{\left( m'/d\right)}\left(d+\ln{\left(4/\delta \right)}      \right)}{m'}\right)\ln{\left(8/\delta \right)}}{m'}}
\\
\leq \sqrt{\frac{4\tau\ln{\left(8/\delta \right)}}{m'}}+
\frac{2c'\ln^{5}{\left( m'/d\right)}\left(d+\ln{\left(8/\delta \right)}      \right)}{m'}. 
\end{align*}
Using the previous inequality along with \cref{eq:bestofbothworld0}, we have that 
\begin{align*}
&\ls_{\cD}(\tilde{\cA}(\rS_{1})) + 3 \sqrt{\frac{2\ls_{\cD}(\tilde{\cA}(\rS_{1}))\ln{(8/\delta )}}{m'}}+\frac{9\ln{(8/\delta )}}{m'}   \\
& \quad \leq  \tau+\sqrt{\frac{c'\tau(d+\ln{\left(4/\delta \right)})}{m'}}+\frac{c'\ln^{5}{\left( m'/d\right)}\left(d+\ln{\left(4/\delta \right)}    \right)}{m'}+ 3 \sqrt{\frac{4\tau\ln{\left(8/\delta \right)}}{m'}} \\
& \qquad \quad  + \frac{6 c'\ln^{5}{\left( m'/d\right)}\left(d+\ln{\left(8/\delta \right)} \right)}{m'} + \frac{9\ln{\left(8/\delta \right)}}{m'} \\
& \quad \leq \tau + 7 \sqrt{\frac{c'\tau(d+\ln{\left(8/\delta \right)})}{m'}}+\frac{16 c'\ln^{5}{\left( m'/d\right)}\left(d+\ln{\left(8/\delta \right)}      \right)}{m'}. 
\end{align*}
Similarly, using \cref{eq:bestofbothworld0.5} and $ \sqrt{ab}\leq a+b $  we have that 
\begin{align*}
    \ls_{\cD}(\widehat{\cA}_{\rt}(\rS_{2};\emptyset))\leq  3.1 \tau+\frac{2c\left(d+\ln{\left(4/\delta \right)}\right)}{m'}.
\end{align*}
Again using the fact that $\sqrt{a+b}\leq \sqrt{a}+\sqrt{b} $ for $ a,b>0$, we have that 
\begin{align*}
    \sqrt{\frac{2\ls_{\cD}(\widehat{\cA}_{\rt}(\rS_{2};\emptyset))\ln{(8/\delta )}}{m'}}
    \leq\sqrt{\frac{6.2 \tau\ln{\left(8/\delta \right)}}{m'}}+\frac{2c(d+\ln{\left(8/\delta \right)})}{m'}. 
\end{align*}
Applying \cref{eq:bestofbothworld0.5} then yields
\begin{align*}
& \ls_{\cD}(\widehat{\cA}_{\rt}(\rS_{2};\emptyset)) + 3\sqrt{\frac{2\ls_{\cD}(\widehat{\cA}_{\rt}(\rS_{2};\emptyset))\ln{(8/\delta )}}{m'}}+\frac{9\ln{(8/\delta )}}{m'} \\
& \quad \leq 2.1 \tau+\sqrt{\frac{c\tau(d+\ln{\left(4/\delta \right)})}{m'}}+\frac{c\left(d+\ln{\left(4/\delta \right)}\right)}{m'}+ 3 \sqrt{\frac{6.2 \tau\ln{\left(8/\delta \right)}}{m'}}+\frac{6c(d+\ln{\left(8/\delta \right)})}{m'}+\frac{9\ln{\left(8/\delta \right)}}{m'} \\
& \quad \leq 2.1 \tau+ 9\sqrt{\frac{c\tau(d+\ln{\left(8/\delta \right)})}{m'}}+\frac{16 c(d+\ln{\left(8/\delta \right)})}{m'}.
\end{align*}
Now plugging in the above expressions into \cref{eq:bestofbothworld4} which is exactly the minimum of   $ \tilde{\cA}(\rS_{1}) $ and $ \widehat{\cA}_{\rt}(\rS_{2};\emptyset) $ we arrive at 
\begin{align}\label{eq:bestofbothworld5}
\ls_{\cD}(\hmin)= \min\Bigg(&2.1 \tau + 9 \sqrt{\frac{c\tau(d+\ln{\left(1/\delta \right)})}{m'}}+\frac{16 c\left(d+\ln{\left(1/\delta \right)}\right)}{m'}, \nonumber \\
& \tau + 7 \sqrt{\frac{c'\tau(d+\ln{\left(1/\delta \right)})}{m'}}+\frac{16 c'\ln^{5}{\left( m'/d\right)}\left(d+\ln{\left(1/\delta \right)}      \right)}{m'} \Bigg)
\end{align}
with probability at least $ 1-\delta/2 $ over $ \rS_{3} $ for any realizations  $ S_{1} $ and $ S_{2} $ of $ \rS_{1} $ and $ \rS_{2} $   in $ G $, now let $ T $ denote the event of \cref{eq:bestofbothworld5}, then we have by independence of $ \rS_{1},\rS_{2},\rS_{3} $ that 
\begin{align*}
 \p_{\rS\sim \cD^{m}}[T]
 \geq
 \e_{\rS_{1},\rS_{2}\sim \cD^{m/3}}\left[\p_{\rS_{3}\sim \cD^{m/3}}\left[\ind\{ T \} \right]\ind\{  G\} \right]
 \geq 
 \e_{\rS_{1},\rS_{2}\sim \cD^{m/3}}\left[(1-\delta/2)\ind\{  G\} \right]
\end{align*}
where the first inequality follows by independence of $ \rS_{1},\rS_{2},\rS_{3} $ and $ G $ only depending upon $ \rS_{1},\rS_{2}$ and the second inequality by \cref{eq:bestofbothworld5} holding (the event of $ T $ ) with probability at least $ 1-\delta/2$ over $ \rS_{3}$ for any $ \rS_{1},\rS_{2} $ in $ G,$. Lastly, note that 
\[  \e_{\rS_{1},\rS_{2}\sim \cD^{m/3}} \left[(1-\delta/2)\ind\{  G\} \right] \geq (1-\delta/2)(1-\delta/2)\geq1-\delta, \]
due to $G$ having probability at least $ 1-\delta/2$ over $ \rS_{1},\rS_{2} $ by \cref{eq:bestofbothworld0}, which concludes the proof.    
