\section{Experiment Setup}
\label{app:expsetup}
Each experiment is \textbf{repeated four times}, with the mean calculated across runs.
The shadow region's boundary is defined by \textbf{the minimum and maximum values} observed across the four runs.
\subsection{Learning Rate Scheduler}
\label{app:lrscheduler}
We set the train procedure with 768 total epochs, each epoch containing 1024 batches.
The learning rate (lr) is first warmed up linearly from an LR$/64$ at epoch $e=1$ to a peak value LR at epoch $e=64$, following:
$$
\text{lr}(e) = \text{LR}\cdot \frac{e}{64}, \quad 1 \leq e \leq 64.
$$
After epoch 64, the learning rate undergoes a quadratic decay over the remaining 704 epochs, given by
\[
\text{lr}(e) = \text{LR}\cdot \sqrt{\frac{64}{e}}, \quad 64 \le e \le 768.
\]

\subsection{Hyperparameter Search}
\label{app:hyperparameters}
We list the hyperparameter searching spaces used for Transformer, LSTM, GRU, and Mamba.
The best hyperparameter is searched using ID hypothesis class generalization with $\|\mathcal{X}\|=5$, $\|\mathcal{H}\|=8$, and then used for all other settings.
\input{tables/hyperparameters}

\subsection{Setup for Generating Training and Testing Hypothesis Classes}
\label{setup:generalization}
We list the experimental setup for each experiments in the following Table~\ref{table:setup}.
When conducting experiments to evaluate accuracy on $y$, we modified the experimental setup following Table~\ref{table:setupicl}.
\begin{table}[th!]
\centering
\caption{\textbf{Experimental setups of different generalizations.}
The expression \(\min\{512, \#\text{possible}\}\) indicates that when the number of possible hypothesis classes is fewer than 512, we evaluate all possible hypothesis classes for testing; otherwise, we limit the selection to at most 512 hypothesis classes.
For example, if \( |\mathcal{H}^{\text{OOD}}| = 16 \) and \( |\mathcal{H}| = 2 \), the total number of possible hypothesis classes is given by:
$\binom{|\mathcal{H}^{\text{OOD}}|}{|\mathcal{H}|} = \binom{16}{2} = \frac{16 \times 15}{2} = 120.$
Since \( 120 < 512 \), we evaluate all 120 hypothesis classes for testing in this scenario.}
\label{table:setup}
\resizebox{1.00\linewidth}{!}{
\begin{tabular}{lrrrr}
\toprule
\multicolumn{1}{c}{Generalization Setup} & \multicolumn{1}{c}{\begin{tabular}[c]{@{}c@{}}ID Hypothesis\\ Class Generalization\end{tabular}} & \multicolumn{1}{c}{\begin{tabular}[c]{@{}c@{}}OOD Hypothesis\\ Class Generalization\end{tabular}} & \multicolumn{1}{c}{\begin{tabular}[c]{@{}c@{}}ID Hypothesis\\ Class Size Generalization\end{tabular}} & \multicolumn{1}{c}{\begin{tabular}[c]{@{}c@{}}OOD Hypothesis\\ Class Size Generalization\end{tabular}} \\ \midrule
size of input space ($|\mathcal{X}|$)    & 5                                                                                                & 5                                                                                                 & 5                                                                                                     & 5                                                                                                      \\
size of label space ($|\mathcal{Y}|$)    & 2                                                                                                & 2                                                                                                 & 2                                                                                                     & 2                                                                                                      \\
size of context query ($K$)              & 5                                                                                                & 5                                                                                                 & 5                                                                                                     & 5                                                                                                      \\
size of training hypothesis class ($|\mathcal{H}^{\text{train}}|$) & 8                                                                                                & 8                                                                                                 & 7,8,9                                                                                                   & 7,8,9                                                                                                    \\
size of testing hypothesis class ($|\mathcal{H}^{\text{test}}|$)   & 8                                                                                                & 8                                                                                                 & 2$,\ldots,$14                                                                                                  & 2$,\ldots,$14                                                                                                   \\
size of hypothesis prefix ($L$)          & 8                                                                                                & 8                                                                                                 & 16                                                                                                    & 16                                                                                                     \\
\#all hypotheses ($|\mathcal{H}^{\text{uni}}|$)                    & 32                                                                                               & 32                                                                                                & 32                                                                                                    & 32                                                                                                     \\
\#hypotheses in ID pool ($|\mathcal{H}^{\text{ID}}|$)                & 16                                                                                               & 16                                                                                                & 16                                                                                                    & 16                                                                                                     \\
\#hypotheses in OOD pool ($|\mathcal{H}^{\text{OOD}}|$)              & 16                                                                                               & 16                                                                                                & 16                                                                                                    & 16                                                                                                     \\
\#training hypothesis classes            & 12358                                                                                            & 12358                                                                                             & 4096                                                                             & 4096                                                                               \\
\#testing hypothesis classes             & 512                                                                                              & 512                                                                                               & $\min\{512,\#\text{possible}\}$                                                                                & $\min\{512,\#\text{possible}\}$                                                                                 \\ \bottomrule
\end{tabular}
}
\end{table}

\begin{table}[th!]
\centering
\caption{\textbf{Additional setups.} Numbers that differ from those in Table~\ref{table:setup} are highlighted in bold for clarity.}
\label{table:setupicl}
\begin{tabular}{lrr}
\toprule
Section & Sec.~\ref{subsec:icl} & Sec.~\ref{subsec:diversity} \\ \midrule
size of input space ($|\mathcal{X}|$)    & \textbf{4}                                                                                       & \textbf{6}                                                                                        \\
size of label space ($|\mathcal{Y}|$)    & 2                                                                                                & 2                                                                                                 \\
size of context query ($K$)              & \textbf{12}                                                                                      & \textbf{12}                                                                                       \\
size of training hypothesis class ($|\mathcal{H}^{\text{train}}|$) & \textbf{4}                                                                                       & 8                                                                                                   \\
size of testing hypothesis class ($|\mathcal{H}^{\text{test}}|$)   & \textbf{4}                                                                                       & 8                                                                                                   \\
size of hypothesis prefix ($L$)          & \textbf{4}                                                                                       & 8                                                                                                 \\
\#all hypotheses ($|\mathcal{H}^{\text{uni}}|$)                    & \textbf{16}                                                                                & \textbf{64}                                                                                         \\
\#hypotheses in ID pool ($|\mathcal{H}^{\text{ID}}|$)              & \textbf{16}                                                                                & \textbf{8,16,24,32,48}                                                                                                 \\
\#hypotheses in OOD pool ($|\mathcal{H}^{\text{OOD}}|$)            & \textbf{0}                                                                                & 16                                                                                                  \\
\#training hypothesis classes            & \textbf{1308}                                                                                    & $\min\{12358,\#\text{possible}\}$                                                                                            \\
\#testing hypothesis classes             & 512                                                                                              & 512                                                                                               \\ \bottomrule
\end{tabular}
\end{table}