\begin{algorithm}[H]
\caption{Generate K-Hop Similar Graph with Batch Processing and Removal Thresholding}
\label{alg:improved_khop}
\begin{algorithmic}[1]
\REQUIRE{Adjacency matrix $A$, hop count $k$, removal threshold $T$, batch size $b$}
\ENSURE{A $k$-hop similar graph $G_k$}
\STATE $(E \gets \textsc{GetEdges}(A)$ \hfill $\triangleright$ Get edge and complementary lists
\STATE $G_{k} \gets A$ \hfill $\triangleright$ Copy of adjacency matrix
\STATE $D \gets \textsc{FloydWarshall}(G_{k})$
\STATE $path_{k} \gets [D\leq k]$ \hfill $\triangleright$$k$-hop paths
\STATE $removals \gets 0$
\FOR{$start \gets 0$ to $|E|$ step $b$}
    \STATE $batch \gets E[start:start+b]$ \hfill $\triangleright$Get current batch of edges
    \STATE $G_{temp} \gets G_{k}$ \hfill $\triangleright$ Temporary copy of current graph
    \FOR{each edge $(i,j)$ in $batch$}
        \STATE $G_{temp}[i,j] \gets 0$
        \STATE $G_{temp}[j,i] \gets 0$
    \ENDFOR  
    \STATE $D_{temp} \gets \textsc{FloydWarshall}(G_{temp})$
    \STATE $path_{temp} \gets [D_{temp} \leq k]$
    \IF{$path_{temp} = path_{k}$}
        \FOR{each edge $(i,j)$ in $batch$}
            \STATE $G_{k}[i,j] \gets 0$
            \STATE $G_{k}[j,i] \gets 0$
        \ENDFOR
        \STATE $D \gets D_{temp}$
        \STATE $removals \gets removals + |batch|$
    \ENDIF   
    \IF{$removals \geq T$}
        \STATE \textbf{return} $G_{k}$
    \ENDIF
\ENDFOR
\STATE \textbf{return} $G_{k}$
\end{algorithmic}
\end{algorithm}