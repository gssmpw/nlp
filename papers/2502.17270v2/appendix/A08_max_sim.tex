

\section{Details on simulation parameterization\label{anx:max_sim}}


We use the MAX Multi-Agent eXperimenter tool \cite{max_tool}, which is based on the Agent-Group-Role \cite{from_agents_to_organizations_an_organizational_view_of_multi_agent_systems} Multi-Agent System \cite{an_introduction_to_multiagent_systems} formalism.
It allows discrete time simulation of complex distributed systems.
Our implementation of DagRider \cite{all_you_need_is_dag} is available in \cite{max_dagrider} and that of the underlying Bracha BRB algorithm \cite{on_the_versatility_of_bracha_byzantine_reliable_broadcast_algorithm} in \cite{max_bracha}.
We use the adversary model defined in \cite{adversary_augmented_simulation_to_evaluate_client_fairness_on_hyperledger_fabric} and implemented in \cite{max_p2p_adversarial_model}. 

Fig.\ref{fig:network_param} describes the parameterization of the system, with the colors of the delay distributions corresponding to the curves on Fig.\ref{fig:delays_distros} (except from the constant rate \textcolor{orange}{\faDashboard} at which new puzzles are revealed).


\begin{figure}[h]
\vspace*{-.25cm}
    \centering
    \scalebox{1}{\input{figures/network_with_delays}}
    \caption{Network parameterization}
    \label{fig:network_param}
\vspace*{-.25cm}
\end{figure}


We use an arbitrary unit of time denoted as ``tick'' in our discrete time simulations.
We consider that a new puzzle is revealed every 200 ticks \textcolor{orange}{\faDashboard}.
Any client can solve it after a given time that is modeled by a Poisson distribution \textcolor{yellow}{\faLightbulbO} of mean 100 (in ticks).
Once a client solves a puzzle, it creates a transaction and broadcasts it to nodes.
We consider the \textcolor{red}{\faHourglassO} distribution of delays taken by such transactions to reach any given node to be an Exponential distribution of mean 20.

As for the delay \textcolor{black}{\faClockO} of node to node communications, we consider 2 different cases in order to model quicker and slower P2P networks:
\begin{itemize}
    \item a hypoexponential distribution \textcolor{blue}{\faClockO} with rates (1/10, 1/15 and 1/20) modelling an average P2P network with smaller delays
    \item a hypoexponential distribution \textcolor{green}{\faClockO} with rates (1/20, 1/30 and 1/40) modelling a slow P2P network with larger delays
\end{itemize}


\begin{figure}[h]
\vspace*{-.25cm}
    \centering
    \includegraphics[width=.475\textwidth]{images/delays_distros_rw.png}
    \caption{Distributions of delays (log scale)}
    \label{fig:delays_distros}
\vspace*{-.25cm}
\end{figure}





\section{Details on simulation execution\label{anx:max_sim_exec}}


Running a simulation yields client puzzle solutions being included in the local copies of the DAG hosted on each node.
In the following, we consider a simple case with $3$ clients and $4$ nodes which are all honest.
The diagrams on Fig.\ref{fig:dag_simu_further_discussion} and Fig.\ref{fig:dag_from_simu} are produced by our tool. 
Each corresponds to a representation of the local copy of the DAG at a certain node at the end of the simulation. 
Here, strong edges are drawn in red and weak edges in blue.
Vertices framed in red are leaders.
The colors of the vertices correspond to the wave they are finalized in (white vertices are not yet included in any wave).


\begin{figure}[h]
    \centering

    \begin{subfigure}{.475\textwidth}
        \includegraphics[scale=.28]{images/simu_baseline_perfect_network.png}
        \caption{simulation with a perfect network}
        \label{fig:dag_from_simu_perfect}
    \end{subfigure}
    
    \begin{subfigure}{.475\textwidth}
        \includegraphics[scale=.28]{images/SmallDelays_0byznode_cropped2.png}
        \caption{simulation to illustrate leader skipping}
        \label{fig:dag_from_simu_quickest}
    \end{subfigure}
    
    \caption{Simulation examples}
    \label{fig:dag_simu_further_discussion}
\end{figure}


Fig.\ref{fig:dag_from_simu_perfect} results from a simulation in which there are no third party transactions and in which both \textcolor{red}{\faHourglassO} and \textcolor{black}{\faClockO} are s.t.~there is always the same fixed delay of $1$ simulation tick between the moment an emission or reception is scheduled and executed in the reliable broadcast layer and there is always a delay of $1$ between the moment a new puzzle is revealed and the moment a node receives its solution from its corresponding client.
This allows every node to produce a new vertex as soon as it receives the solutions (which all arrive at the same time) from the clients at exactly the rate in which puzzles are revealed.
Here, it is as if the construction of the DAG is executed in lock-step synchrony across all nodes.
As a result, every vertex has exactly $n = 4$ strong edges and no weak edge.
In these conditions, the adversary cannot delay the delivery of vertices i.e., the attack on the reliable broadcast layer from Sec.\ref{ssec:attack_bracha} has no effect.
The DagRider layer attack from Sec.\ref{ssec:byz_dagrider_layer} is also ineffective because, even if a Byzantine node at column $c$ decides not to include strong edges to certain vertices at column $c-1$, it must include $2*f+1$ strong edges and at least $f+1$ of these targeted vertices will, in any case, include all the pending puzzle solutions.
Here, the adversary can only manipulate the content of the DAG via Byzantine nodes not including certain transactions in their own vertices proposal.

In contrast, on Fig.\ref{fig:dag_from_simu_quickest}, we use a hypoexponential distribution of delays for node to node communications. One can see that the regularity of the DAG is broken : weak edges appear and the shape of the waves vary.

%Communication models \cite{consensus_in_the_presence_of_partial_synchrony,impossibility_of_distributed_consensus_with_one_faulty_process} describe assumptions on the communication delays under which the properties of a distributed protocol hold.
This comparison with a perfect network shows that it is the non-determinism in network communication delays that leave Byzantine nodes with ample leeway to change the outcome of an execution via manipulating these delays.
This is true, even when staying within the $\Delta$ bounds in a synchronous or partially synchronous communication model \cite{consensus_in_the_presence_of_partial_synchrony,impossibility_of_distributed_consensus_with_one_faulty_process}.


The reader may notice that the situation described on Fig.\ref{fig:dagrider_bug} in appendix \ref{anx:bug_dagrider} effectively occurs on Fig.\ref{fig:dag_from_simu_quickest} as it is possible for a vertex at column $c$ and row $r$ to be broadcast ($\mathtt{rbcast}$ of Fig.\ref{fig:layers_dagrider}) before the vertex at column $c-1$ and row $r$ is delivered ($\mathtt{rdlver}$ of Fig.\ref{fig:layers_dagrider}) due to the random delays in the reliable broadcast layer. As a result, there is no strong edge between $(c,r)$ and $(c-1,r)$ (see e.g., the absence of edge between the leader vertex of the orange wave and its immediate predecessor on the same row, which is colored in purple).

Fig.\ref{fig:dag_from_simu_quickest} also illustrates the fact that certain leader vertices can be skipped over.
Indeed, given a leader at column $c$, if the condition that there are at least $2*f+1$ strong paths between it and vertices at column $c + 4$ is not met, it is not included in the leader stack.
In that case, the wave is ignored, and its content may eventually be included in the next wave.
On Fig.\ref{fig:dag_from_simu_quickest}, wave 3 is ignored and its content is included in wave 4 (the orange wave).



In Sec.\ref{ssec:network_param}, we use two specific \faClockO~distributions of delays for our experiments.
Fig.\ref{fig:dag_from_simu} illustrate the use of these two specific distributions.
Fig.\ref{fig:dag_from_simu_quick} results from a simulation with the node to node delay being modeled using the \textcolor{blue}{\faClockO} distribution (smaller delays).
One can see that there are roughly 2 to 3 puzzles per wave of the DAG and 5 to 10 transactions per vertex of the DAG.
On Fig.\ref{fig:dag_from_simu_slow} there rather are roughly 5 to 6 puzzles per wave and 10 to 20 transactions per vertex.


\begin{figure*}
    \centering

\begin{minipage}{.65\textwidth}
    
    \begin{subfigure}{\textwidth}
        \includegraphics[scale=.27]{images/MediumDelays_0byznode_pt.png}
        \caption{...the \textcolor{blue}{\faClockO} (quicker network)}
        \label{fig:dag_from_simu_quick}
    \end{subfigure}
    
\end{minipage}
%
\begin{minipage}{.325\textwidth}
    \begin{subfigure}{\textwidth}
        \includegraphics[scale=.27]{images/LargeDelays_0byznode_pt.png}
        \caption{...the \textcolor{green}{\faClockO} (slower network)}
        \label{fig:dag_from_simu_slow}
    \end{subfigure}
\end{minipage}
    
    \caption{DAG content excerpts at the end of a $n=4$ simulation with ...}
    \label{fig:dag_from_simu}
\end{figure*}



