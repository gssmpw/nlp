\begin{algorithm}[t]
    \small
    \textbf{Input:}
    $\eta$ (lr), $e_i^{(0)}$ (initial embeddings),
    $\mathcal{L}(e_i)$ (objective), $\beta_1, \beta_2$ (betas), $T$ (number of time steps)
    \\
    \textbf{Initialize:}
    $m_i^{(0)} \leftarrow 0$ (1st moment),
    $v_i^{(0)} \leftarrow 0$ (2nd moment)
    \\
    \textbf{Output}: $e^{(T)}$ (final embeddings)
    \begin{algorithmic}[1]
        \For{$\tm=1 \dots T$}
            \For{$i=1 \dots V$}
                \State $g_i^{(\tm)}$ $\gets$ $\nabla_{e_i} \mathcal{L}^{(\tm)} (e_i^{(\tm-1)})$
                \State $m_i^{(\tm)}$ $\gets$ $\beta_1 m_i^{(\tm-1)} + (1 - \beta_1) g_i^{(\tm)}$%
                \label{alg:line:adam_first_moment_definition}
                \State $v_i^{(\tm)}$ $\gets$ $\beta_2 v_i^{(\tm-1)} + (1-\beta_2) \left(g_i^{(\tm)}\right)^2$%
                \label{alg:line:adam_second_moment_definition}
                \State $\firstmoment$ $\gets$ $m_i^{(\tm)}/\big(1-\beta_1^\tm \big)$%
                \label{alg:line:adam_first_moment_exp_averages}
                \State $\secondmoment$ $\gets$ $v_i^{(\tm)}/\big(1-\beta_2^\tm \big)$%
              \label{alg:line:adam_second_moment_exp_averages}
            \EndFor
            \BeginBox[fill=\colhighlight!10!White, xshift=0.6em, inner xsep=-0.7em]
            \If{\highlight{coupled}}
                \State $\highlight{\secondmomentavg}$ $\gets$ $\highlight{\frac{1}{V} \sum_{i=1}^V \secondmoment}$ %
                \label{alg:line:coupled_adam_second_moment}%
            \EndIf
            \For{$i=1 \dots V$}
                \If{\highlight{coupled}}
                    \State $\highlight{\secondmoment}$ $\gets$ $\highlight{\secondmomentavg}$%
                    \label{alg:line:coupled_adam_second_moment_2}
                \EndIf
            \EndBox
                \State $e_i^{(\tm)}$ $\gets$ $e_i^{(\tm-1)} - \eta \frac{\firstmoment}{\sqrt{\secondmoment} + \epsilon}$%
                \label{alg:line:adam_update}
            \EndFor
        \EndFor
        \State \Return $e^{(T)}$
    \end{algorithmic}
    \caption{Pseudocode for the Adam algorithm and our extension, the \highlight{Coupled Adam algorithm (highlighted)}, applied to the embedding vectors $e_i$. Note that weight decay is not applied.}
    \label{alg:algorithm_adam}
\end{algorithm}
