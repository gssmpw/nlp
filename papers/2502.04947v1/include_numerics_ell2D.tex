\subsection{2D anisotropic elliptic problem on a square}
\label{sec:Ell2D}

In this section, we will consider the \eqref{eq:ob_pde} problem in a more complex form than in \cref{sec:Lap2D}, by considering the following elliptic problem with homogeneous Dirichlet boundary conditions, in the 2D case ($d=2$),
\begin{equation}
	\left\{
	\begin{aligned}
		-\text{div}(D\nabla u) & = f, \; &  & \text{in } \; \Omega, \\
		u         & =0, \;  &  & \text{on } \; \partial\Omega,
	\end{aligned}
	\right.
	\label{eq:Ell2D}
\end{equation}
with $\Omega=[0,1]^2$, $\partial\Omega$ its boundary and $\mathcal{M} \subset \mathbb{R}^p$ the parameter space (with $p$ the number of parameters).
Considering $\bm{x}=(x,y)\in\Omega$, we define $p=4$ parameters $\bm{\mu}=(\mu_1,\mu_2,\epsilon,\sigma)\in\mathcal{M}=[0.4, 0.6]\times [0.4, 0.6]\times [0.01,1]\times [0.1,0.8]$. We will then define $D$, the diffusion matrix (symmetric and positive definite), by
\begin{equation*}
	D(\bm{x},\bm{\mu})=\begin{pmatrix}
		\epsilon x^2+y^2 & (\epsilon-1)xy \\
		(\epsilon-1)xy & x^2+\epsilon y^2
	\end{pmatrix}
\end{equation*}
and the right-hand side $f$ by
\begin{equation*}
	f(\bm{x},\bm{\mu})=\exp\left(-\frac{(x-\mu_1)^2+(y-\mu_2)^2}{0.025\sigma^2}\right).
\end{equation*}
Note that the matrix $D$ has eigenvalues $x^2 + y^2$
and $\epsilon(x^2 + y^2)$,
leading to a diffusion process whose anisotropy
increases as $\epsilon$ decreases.

\begin{remark}\label{rmk:Ell2D_N_nodes}
	In the following, the characteristic mesh size $h=\frac{\sqrt{2}}{N-1}$ is defined as a function of $N$, considering a Cartesian mesh of $N^2$ nodes.
\end{remark}

\paragraph*{Physics-informed training.} We then consider a parametric PINN where we exactly impose the Dirichlet boundary conditions as presented in \cref{sec:exact_imposition_of_BC}. To do this, we define the prior
\begin{equation*}
	u_{\theta}(\bm{x},\bm{\mu}) = \varphi(\bm{x}) w_{\theta}(\bm{x},\bm{\mu}),
\end{equation*}
where $w_\theta$ is the neural network under consideration and $\varphi$ is a level-set function defined by
\begin{equation*}
	\varphi(\bm{x})=x(x-1)y(y-1),
\end{equation*}
which vanishes exactly on $\partial\Omega$. The hyperparameters are defined in \cref{tab:paramtest3_2D}.

\input{fig_testcase2D_test3_test3}

Since we impose the boundary conditions by using the level-set function, we will only consider the residual loss, with integral approached by a Monte-Carlo method, defined by
\[
	J_r(\theta) \simeq
	\frac{1}{N_\text{col}} \sum_{i=1}^{N_\text{col}} \big| div\big(D\big(\bm{x}_\text{col}^{(i)};\bm{\mu}_\text{col}^{(i)}\big) \nabla u_\theta(\bm{x}_\text{col}^{(i)};\bm{\mu}_\text{col}^{(i)}\big) \big) + f\big(\bm{x}_\text{col}^{(i)};\bm{\mu}_\text{col}^{(i)}\big) \big|^2,
\]
with the $N_\text{col}=8000$ collocation points \smash{$\big(\bm{x}_\text{col}^{(i)}, \bm{\mu}_\text{col}^{(i)}\big)_{i=1,\dots,N_\text{col}}$}. Thus we seek to solve the following minimisation problem
\begin{equation*}
	\theta^\star = \argmin_\theta J_r(\theta).
\end{equation*}

% Since we impose the boundary conditions by using the level-set function, we will only consider the residual loss defined by
% \begin{equation*}
% 	J_r(\theta)=\int_\mathcal{M}\int_\Omega \big(div(D(x,y;\mu)\nabla u_{\theta}(x,y;\mu))+f(x,y;\mu)\big)^2dxdyd\mu,
% \end{equation*}
% and thus we seek to solve the following minimisation problem
% \begin{equation*}
% 	\min_\theta J_r(\theta).
% \end{equation*}

\begin{remark}
	Here, we do not know the analytical solution associated with the problem under consideration. So, in order to analyze the results obtained, we will define $u$ as a reference solution $u_{\text{ref}}$ obtained from a FEM solver on an over-refined mesh of characteristic mesh size $h_\text{ref}$ and with $k_\text{ref}$ polynomial order. In this section, we will choose $N_{\text{ref}}=1000$ (and the associated characteristic mesh size $h_{\text{ref}}$, as defined in \cref{rmk:Ell2D_N_nodes}) and the degree $k_{\text{ref}}=3$.
\end{remark}

\subsubsection{Error estimates}

We will now test the error estimation (\cref{lem:error_estimation_add}) for the following two sets of parameters,
uniformly drawn from~$\mathcal{M}$:
\begin{equation*}
	\bm{\mu}^{(1)}=(0.51,0.54,0.52,0.55) \quad \text{and} \quad \bm{\mu}^{(2)}=(0.48,0.53,0.41,0.89).
\end{equation*}
So, for $j \in \{1,2\}$, the aim is to compare, by varying the mesh size $h$, the $L^2$ relative errors \smash{$e_h^{(j)}$} obtained with the standard FEM method, defined in \eqref{eq:error_rel_FEM}, and \smash{$e_{h,+}^{(j)}$} obtained with the additive approach, defined in \eqref{eq:error_rel_add}. The results are presented in \cref{fig:case3} for a fixed $k \in \{1,2,3\}$ with $N \in \{16,32,64,128,256\}$, as presented in \cref{rmk:Ell2D_N_nodes}.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.48\linewidth}
		\centering
		\cvgFEMCorrAlldeg{fig_testcase2D_test3_cvg_FEM_case3_v1_param1.csv}{fig_testcase2D_test3_cvg_Corr_case3_v1_param1.csv}{1e-9}
		\caption{$\mu^{(1)}$ parameter.}
		\label{fig:case3param1}
	\end{subfigure}
	\begin{subfigure}{0.48\linewidth}
		\centering
		\cvgFEMCorrAlldeg{fig_testcase2D_test3_cvg_FEM_case3_v1_param2.csv}{fig_testcase2D_test3_cvg_Corr_case3_v1_param2.csv}{5e-8}
		\caption{$\mu^{(2)}$ parameter.}
		\label{fig:case3param2}
	\end{subfigure}
	\caption{Considering the \textit{2D elliptic} case and the PINN prior $u_\theta$. Left -- $L^2$ relative error on $h$, obtained with the standard FEM $e_h^{(1)}$ (solid lines) and the additive approach $e_{h,+}^{(1)}$ (dashed lines) for $\bm{\mu}^{(1)}$, with $k \in \{1,2,3\}$. Right -- Same for $\bm{\mu}^{(2)}$.}
	\label{fig:case3}
\end{figure}

As in the other test cases, the two approaches tested appear to respect the correct slopes of \cref{thm:classical_error_estimate} and \cref{lem:error_estimation_add}. The additive approach seems to be more efficient than the standard FEM method for polynomial orders $k \in \{1,2,3\}$ and for the two sets of parameters considered.

\subsubsection{Comparison of different approaches}\label{sec:Ell2D_comparison}

We perform the same comparison as in \cref{par:Lap2D_comparison} for this elliptic case. We focus on the first parameter $\bm{\mu}^{(1)}$ by taking a closer look at the solution obtained with the different approaches in \cref{fig:case3_2D_plots} considering $N=16$ and $k=2$; for each method, we compare the solution obtained ($u_h$ for standard FEM and $u_h^+$ for the additive approach) with the analytical solution $u$. For the enriched method, using the PINN prior $u_\theta$, we will also compare the proposed correction; namely, for the additive approach, we will compare $p_h^+$ with $u-u_\theta$.

\begin{figure}[!ht] \centering

    \includegraphics[scale=1]{fig_testcase2D_test3_plots_standalone_solutions.pdf}

    \includegraphics[scale=1]{fig_testcase2D_test3_plots_standalone_errors.pdf}

	\caption{Considering the \textit{2D elliptic} case with $\bm{\mu}^{(1)}$, $k=2$, $N=16$ and the PINN prior $u_\theta$. Comparison of the solution obtained with the standard FEM and the additive approach with the analytical solution. For the additive method, comparison of the correction term with the analytical one.}
	\label{fig:case3_2D_plots}
\end{figure}

We observe that the enriched FEM provides a more accurate solution compared to the standard FEM one. The results indicate that the additive approach is particularly effective in capturing the solution's finer details. This demonstrates its potential in solving anisotropic problems with higher accuracy than standard methods.

\subsubsection{Gains achieved with the additive approach}

Considering a sample $\mathcal{S}$ of $n_p=50$ parameters, we will evaluate the gains $G_{+,\theta}$ and $G_+$ defined in \eqref{eq:gain_add_num}. The results are presented in \cref{tab:case3} for $k \in \{1,2,3\}$ fixed and $N \in \{20,40\}$ fixed.

\begin{table}[H]
	\centering
	\gainstableallq{fig_testcase2D_test3_gains_gains_table_case3.csv}
	\caption{Considering the \textit{2D elliptic} case, $k\in\{1,2,3\}$ and the PINN prior $u_\theta$. Left -- Gains in $L^2$ relative error of the additive method with respect to PINN. Right -- Gains in $L^2$ relative error of our approach with respect to FEM.}
	\label{tab:case3}
\end{table}

As in the previous test cases, the additive approach seems to be more efficient than the standard FEM method for the two polynomial orders $k \in \{1,2,3\}$ and for the two mesh sizes $N \in \{20,40\}$. However, the gains obtained are less significant than in the previous test cases. This is due to the fact that the problem under consideration is more complex, and thus, the prior $u_\theta$ is less accurate.
