\subsection{1D general elliptic system and convection-dominated regime}\label{sec:Ell1D}

In this experiment, we consider the problem \eqref{eq:ob_pde}
in a more complex form, still in a 1D ($d=1$) configuration:
\begin{equation*}
	\left\{
	\begin{aligned}
		\partial_x u-\frac{1}{\peclet}\partial_{xx} u &= r, \; &  & \text{in } \; \Omega \times \mathcal{M}, \\
		u         & = 0, \;  &  & \text{on } \; \partial\Omega \times \mathcal{M},
	\end{aligned}
	\right.
	\label{eq:Ell1D}
\end{equation*}
with $\Omega=[0,1]$ and $\partial\Omega$ its boundary, $r$ the reaction constant term and $\peclet$ the Péclet number which describe the ratio between convective and diffusion term. We define an analytical solution for all $x\in\Omega$ by
\begin{equation}
    \label{eq:Ell1D_analytical}
	u(x;\bm{\mu})=r\left(x-\frac{e^{\peclet\, x}-1}{e^{\peclet}-1}\right) \,,
\end{equation}
with $p=2$ parameters $\bm{\mu}=(r,\peclet)\in\mathcal{M}=[1,2]\times[10,100]$.

\begin{remark}\label{rem:oscillations}
	In large Péclet regime, i.e., for convection-dominated flows,
    the classical finite element method may generate oscillations
    when no specific treatment is applied,
    see e.g. \cite{JohKnoNov2018}.
\end{remark}

In this % second 1D
test-case, we will construct only one prior, denoted $u_\theta$,
built from a PINN as presented in \cref{sec:prior_construction}.
We will also compare the additive and multiplicative approaches by considering
polynomial order $k=1$, and since the solution is positive in $\Omega$,
we consider $M=0$ {for the multiplicative approach}.
We start by evaluating the error in \cref{sec:Ell1D_error_estimations},
then we compare the derivatives of the PINN prior and compare the different
approaches in \cref{sec:Ell1D_comparison}. Finally, we evaluate the gains obtained
in \cref{sec:Ell1D_gains} on a sample of parameters.
As we are dealing with a specific case, we will compare two methods
for imposing boundary conditions, as presented in \cref{sec:multiplicative_BC}:
the strong and the weak approaches.

\begin{remark}\label{rmk:Ell1D_N_nodes}
	As in \cref{sec:Lap1D}, the characteristic mesh size $h=\frac{1}{N-1}$, where $N$ is the number of nodes considered.
\end{remark}

\paragraph*{Physics-informed training.}
We consider a parametric PINN, depending on the problem parameters $\bm{\mu}$,
where we exactly impose the Dirichlet boundary conditions as presented in \cref{sec:exact_imposition_of_BC}. We define the prior $u_{\theta}$ and the level set $\varphi$ as in \eqref{eq:utheta} and \eqref{eq:phii},
which vanishes exactly on $\partial\Omega$.

\input{fig_testcase1D_test2_test2}

Since we impose the boundary conditions by using the level-set function, we will only consider the residual loss $J_r$ defined in \eqref{eq:residual_loss_parametric} in which the integrals are approached by a Monte-Carlo method, i.e.
\[
	J_r(\theta) \simeq
	\frac{1}{N_\text{col}} \sum_{i=1}^{N_\text{col}} \left| \partial_x u_\theta\big(\bm{x}_\text{col}^{(i)};\bm{\mu}_\text{col}^{(i)}\big)-\frac{1}{\peclet}\partial_{xx} u_\theta\big(\bm{x}_\text{col}^{(i)};\bm{\mu}_\text{col}^{(i)}\big) - r
	\right|^2 \,,
\]
with the $N_\text{col}=5000$ collocation points \smash{$\big(\bm{x}_\text{col}^{(i)}, \bm{\mu}_\text{col}^{(i)}\big)_{i=1,\dots,N_\text{col}}$} uniformly chosen on $\Omega\times\mathcal{M}$. Thus we seek to solve the following minimisation problem
\begin{equation*}
	\theta^\star = \argmin_\theta J_r(\theta).
\end{equation*}
In this case,
we consider a MLP with $5$ layers and a tanh activation function.
The hyperparameters are given in \cref{tab:paramtest2_1D};
we use the Adam optimizer~\cite{KinBa2015}.

\subsubsection{Error estimates}\label{sec:Ell1D_error_estimations}

We start by testing the error estimates (\cref{lem:error_estimation_add}) for the following two sets of parameters:
\begin{equation}\label{equation:ell1d:mu-choices}
	\bm{\mu}^{(1)}=(1.2,40) \quad \text{and} \quad \bm{\mu}^{(2)}=(1.5,90) \,,
\end{equation}
by considering the PINN prior $u_\theta$.
For $j \in \{1, 2\}$, the aim is to compare for different mesh sizes $h$,
the $L^2$ relative errors \smash{$e_h^{(j)}$} obtained with the standard FEM method, defined in \eqref{eq:error_rel_FEM}, \smash{$e_{h,+}^{(j)}$} obtained with the additive approach and \smash{$e_{h,M}^{(j)}$} obtained with the multiplicative approach (taking $M=0$), defined in \eqref{eq:error_rel_add}.  We will consider the two implementations of the boundary conditions for the multiplicative approach: the strong and the weak BC, as presented in \cref{sec:multiplicative_prior}.
The results are presented in \cref{fig:case2_1D} by varying the mesh size $h$.

\begin{figure}[!ht]
	\centering
	\begin{subfigure}{0.48\linewidth}
		\centering
		\cvgFEMCorrMultSWOnedeg{fig_testcase1D_test2_cvg_FEM_case2_v1_param1_degree1.csv}{fig_testcase1D_test2_cvg_FEM_case2_v1_param1_degree2.csv}{fig_testcase1D_test2_cvg_Corr_case2_v1_param1_degree1.csv}{fig_testcase1D_test2_cvg_Mult_case2_v1_param1_degree1_M0.0.csv}{fig_testcase1D_test2_cvg_Mult_case2_v1_param1_degree1_M0.0_weak.csv}{5e-6}
		\caption{Case of $\bm{\mu}^{(1)}$}
		\label{fig:case2param1_1D}
	\end{subfigure}
	\begin{subfigure}{0.48\linewidth}
		\centering
		\cvgFEMCorrMultSWOnedeg{fig_testcase1D_test2_cvg_FEM_case2_v1_param2_degree1.csv}{fig_testcase1D_test2_cvg_FEM_case2_v1_param2_degree2.csv}{fig_testcase1D_test2_cvg_Corr_case2_v1_param2_degree1.csv}{fig_testcase1D_test2_cvg_Mult_case2_v1_param2_degree1_M0.0.csv}{fig_testcase1D_test2_cvg_Mult_case2_v1_param2_degree1_M0.0_weak.csv}{6e-5}
		\caption{Case of $\bm{\mu}^{(2)}$}
		\label{fig:case2param2_1D}
	\end{subfigure}
	\caption{Considering the \textit{1D Elliptic case} and the PINN prior $u_\theta$. Left -- Considering $\bm{\mu}^{(1)}$. $L^2$ error on $h$ obtained with standard FEM \smash{$e_h^{(1)}$} (solid lines) with $k=1$ and $k=2$, the additive approach \smash{$e_{h,+}^{(1)}$} (dashed lines) with $k=1$ and the multiplicative approach \smash{$e_{h,M}^{(1)}$} (dotted lines) with $k=1$, considering strong and weak BC. Right -- Same for $\bm{\mu}^{(2)}$, \eqref{equation:ell1d:mu-choices}.}
	\label{fig:case2_1D}
\end{figure}

In \cref{fig:case2_1D}, we see that the enriched approaches seem to give better results than standard FEM except for the multiplicative approach with strong imposition of boundary conditions. Moreover, this approach, which imposes $p_h^\times=1$ on $\partial\Omega$, does not follow the expected convergence order.
The additive approach seems much less effective here than in the previous
experiment of \cref{sec:Lap1D}, whereas the multiplicative approach with
weak BC seems to significantly improve the results obtained with standard FEM.
A comparative study of the different methods is given in \cref{sec:Ell1D_comparison}. In addition, we see that the standard FEM method with polynomial order $k=2$ is
clearly less accurate than the multiplicative approach using weak BC applied
with polynomial order $k=1$.

\subsubsection{Comparison of different approaches}\label{sec:Ell1D_comparison}

We now focus on the second parameter $\bm{\mu}^{(2)}$. We first look at the PINN prediction for this parameter and its derivatives in \cref{fig:case2_1D_der}.
As in the previous section, we consider the following approaches: standard FEM, the additive approach and the multiplicative approach (with $M=0$) with strong or weak imposition of boundary conditions.
We compare the different methods in \cref{tab:case2_1D_comparison}, where we can see the different errors obtained with the considered methods for $k=1$ and $N\in\{16,32\}$ as well as the gains obtained in comparison with standard FEM. Next, we take a closer look at the solutions obtained with the different approaches in \cref{fig:case2_1D_plots};
for each method, we compare the solution obtained ($u_h$ for standard FEM, $u_h^+$ for the additive approach and $u_h^\times$ for the multiplicative approach, with strong or weak BC imposition) with the analytical solution $u$. For the enriched methods, using the PINN prior, we will also compare the proposed correction; namely, for the additive approach, we will compare $p_h^+$ with $u-u_\theta$ and for the multiplicative one $p_h^\times$ with $u/u_\theta$ (with $u_\theta>0$ in $\Omega$).

\begin{figure}[ht!]
	\centering
	\includegraphics[scale=1]{fig_testcase1D_test2_plots_standalone_solutions_and_errors_PINN.pdf}
	\caption{Considering the \textit{1D Ellipctic case} with $\bm{\mu}^{(2)}$ and the PINN prior $u_\theta$, comparison between analytical solution and network prediction.
    From left to right: solution; first derivative; second derivative; errors.}
	\label{fig:case2_1D_der}
\end{figure}

In \cref{fig:case2_1D_der}, we can see that PINN has difficulties to capture the solution and that the prediction it provides is far from the analytical solution. As for its derivatives, they seem to be relatively inaccurate compared to the analytical.
Indeed, since the PINN is a smooth function, it has trouble approximating functions with very sharp gradients such as the one of \eqref{eq:Ell1D_analytical}.

\begin{table}[H]
	\centering
	\gainsPINNsecond{fig_testcase1D_test2_plots_FEM.csv}{fig_testcase1D_test2_plots_compare_gains.csv}
	\caption{Considering the \textit{1D Elliptic case} with $\bm{\mu}^{(2)}$, $k=1$ and $N=16,32$. Left -- $L^2$ relative error obtained with FEM. Right -- Considering the PINN prior $u_\theta$, $L^2$ relative errors and gains with respect to FEM, obtained with our methods. Our methods : additive approach, multiplicative approach by taking $M=0$ (strong and weak BC).}
	\label{tab:case2_1D_comparison}
\end{table}

\begin{figure}[!ht]
	\centering
    \begin{subfigure}{0.48\linewidth} \centering
		\hspace{-12pt}\includegraphics[scale=0.84]{fig_testcase1D_test2_plots_standalone_solutions_FEM.pdf}
		\caption{FEM solutions with polynomials order approximation $k=1$ and $k=2$, and absolute errors.}
		\label{fig:case2_1D_plots_fem}
    \end{subfigure} \hfill
    \begin{subfigure}{0.48\linewidth} \centering
		\hspace{-12pt}\includegraphics[scale=0.84]{fig_testcase1D_test2_plots_standalone_solutions_allP1.pdf}
		\caption{Enriched solutions with polynomial order approximation $k=1$, and absolute errors.}
		\label{fig:case2_1D_plots_add}
    \end{subfigure}
	\caption{Considering the \textit{1D Elliptic case} with $\bm{\mu}^{(2)}$, $N=16$ and the PINN prior $u_\theta$. Comparison of the solution obtained with the different methods with the analytical solution. For each enriched method, comparison of the correction term with the analytical one. Different methods : standard FEM, additive approach, multiplicative approach by taking $M=0$ (strong and weak BC).}
	\label{fig:case2_1D_plots}
\end{figure}

In \cref{fig:case2_1D_plots,tab:case2_1D_comparison}, we present a comparison of the different approaches proposed. In \cref{fig:case2_1D_plots_fem}, we first notice the oscillations anticipated in \cref{rem:oscillations} for standard FEM at both polynomial
orders $k=1$ and $k=2$.
This behaviour is also seen in the additive enrichment (blue dashed line in \cref{fig:case2_1D_plots_add}), which does not seem to give better results than standard FEM due to the derivatives presented in \cref{fig:case2_1D_der}, and for the multiplicative approach with strong boundary conditions (green dotted line in \cref{fig:case2_1D_plots_add}).
However, weakly imposing the BC gives the appropriate results (red dotted line in \cref{fig:case2_1D_plots_add}).

\subsubsection{Gains achieved with the additive and the multiplicative approaches}\label{sec:Ell1D_gains}

Considering a sample $\mathcal{S}$ of $n_p=50$ parameters, we will evaluate the gains $G_{+,\theta}$ and $G_+$ defined in \eqref{eq:gain_add_num} with the PINN prior $u_\theta$. We will evaluate $G_{M,\theta}$ and $G_M$, defined in \eqref{eq:gain_mul_num}, in the same way with $M=0$ for the multiplicative approach, by considering the two implementations of the boundary conditions; strong and weak BC. The results are presented in \cref{tab:case2_1D_PINNs} for fixed $k=1$ and $N \in \{20,40\}$ fixed.

\begin{table}[H]
	\centering
	\gainstableMult{fig_testcase1D_test2_gains_Tab_stats_case2_v1_degree1.csv}
	\caption{Considering the \textit{1D Ellipctic case}, $k=1$ and the PINN prior $u_\theta$. Left -- Gains in $L^2$ relative error of our methods with respect to PINN. Right -- Gains in $L^2$ relative error of our methods with respect to FEM. Our methods : additive approach, multiplicative approach with $M=0$ (strong and weak BC).}
	\label{tab:case2_1D_PINNs}
\end{table}

\cref{tab:case2_1D_PINNs} confirms the above results. The multiplicative approach with weak BC seems to give the best results on our $\mathcal{S}$ parameter sample. The additive and multiplicative approaches with strong BC imposition do not appear to be very effective on this test case. In particular, even though the additive approach improves the standard FEM error by a factor of 3, we have seen in \cref{sec:Ell1D_comparison} that the solutions obtained do not correspond to the expected solution, whereas the multiplicative approach with low BCs does. In the following, we will only consider the additive approach, as it seems to be the most efficient one, except in special cases such as the one under consideration in this \cref{sec:Ell1D}. Indeed, the following test cases will not contain boundary layers or strong gradients.
