\section{Proofs from Section~\ref{sec:TV}}\label{sec:ProofsTV}

We will elaborate on~\Cref{rem:lower-bound}, showing that the dependence on $B$ in~\Cref{thm:shift-TV} is necessary.
\begin{lemma}
    Let $\ptr$ and $\pte$ be any pair of distributions s.t. $\Pr_{\xx \sim \pte}(\pte(\xx)/\ptr(\xx) \geq B) = 2\varepsilon$. Then, even if the distributions $\pte$ and $\ptr$ are known, we need $\Omega(B/\varepsilon)$ samples to solve the covariate shifted mean estimation problem for $\ptr$ and $\pte$.
\end{lemma}
\begin{proof}
Let $S = \{ \xx : \pte(\xx) / \ptr(\xx) > B \}$. By assumption, we have $\pte(S) = 2\varepsilon$, and moreover $\ptr(S) \leq 2 \varepsilon / B$ by the construction of the set $B$. The expectations with respect to $\pte$ of functions $\mathbf{1}_S$ and the constant $0$ function, differ by at least $2\varepsilon$, so in order to solve the covariate-shifted mean estimation problem, we need to be able to distinguish those two functions. But unless we sample $\Omega(B/\varepsilon)$ elements $\xx$ from $\ptr$ it is unlikely that any of those will be in $S$, and the algorithm will only have observed value $\ff(\xx) = 0$ in either of those two cases.
\end{proof}



\ApproximationBiasTV*



\begin{proof}
From \Cref{cor:approx-Q},
\[
\left|\E_{\xx\sim \ptr} \frac{\widehat{\pte}(\xx)}{\widehat{\ptr}(\xx)} \ff(\xx) - \E_{\xx\sim \pte} \ff(\xx)\right| \leq \Qdiv{1}{\widehat{\ptr}}{\ptr}{\widehat{\pte}} + d_{TV}({\pte},\widehat{\pte}).
\]
Therefore, it is sufficient to bound $\Qdiv{1}{\widehat{\ptr}}{\ptr}{\widehat{\pte}} \leq B d_{TV}(\widehat{\ptr}, \ptr)$. Since $\supp (\widehat{\pte}) \subseteq S$ and $\forall x\in S,\widehat{\pte}(\xx) / \widehat{\ptr}(\xx) \leq B$, we have
\begin{align*}
   \Qdiv{1}{\widehat{\ptr}}{\ptr}{\widehat{\pte}} &= \E_{\xx\sim \widehat{\pte}} \left| \frac{\ptr(\xx)}{\widehat{\ptr}(\xx)} - 1\right|\\
   &\leq B \E_{\xx\sim \widehat{\ptr}} \left| \frac{\ptr(\xx)}{\widehat{\ptr}(\xx)}- 1 \right|\\
   &= B d_{TV}({\ptr}, \widehat{\ptr}).
\end{align*}
\end{proof}




