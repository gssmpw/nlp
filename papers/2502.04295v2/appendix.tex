\newpage

% \section{Appendix}
\section{Appendix: Detailed Optimization Process and Meta-Prompts}

\subsection{Meta-Prompt Header Setup}

At the beginning of the prompt, we introduce the task and provide a detailed explanation of the promptâ€™s components, followed by the current version of the prompt. Below is the structure of the meta-prompt header, where placeholders are denoted in [ALL CAPS]:

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
I'm trying to write a prompt to [TASK INTENTION].

The current prompt consists of several key components, including:
[DESCRIPTION OF COMPONENTS]

The complete prompt is as follows:
"""[CURRENT PROMPT]"""
\end{lstlisting}

\subsection{Format Generation}\label{mt:format_gen}

% The process for format generation involves creating \textit{Prompt Renderers} and \textit{query formats} in two steps. First, format description and its rendered results are generated based on the existing formats. 
% Second, the code is generated using the provided description and rendered result. Below, we present two meta-prompts utilized for generating \textbf{Query Format}, where $[\cdot]$ represents placeholders:
Our format generation process is a two-step procedure designed to create diverse and effective prompt formats. We focus on generating two key components of a prompt's format: the \textit{Prompt Renderer} and the \textit{Query Format}. The appendix presents examples of the format generated using this pipeline.

\noindent \textbf{Step 1: Format Description Generation.} For each component (i.e., \textit{Prompt Renderer} and the \textit{Query Format}), we first generate a natural language description of the format, alongside an example of how this format would render a sample input. This description acts as a blueprint, guiding the subsequent code generation. We utilize a meta-prompt to instruct an LLM to perform this task. The meta-prompt takes existing format examples as context and generates new format descriptions along with rendered results. As an illustrative example, here is a conceptual outline of the meta-prompt employed for generating new \textit{Query Format} descriptions:

% \vspace{1ex}
% \textbf{\textit{Query Format} Description Generation}
% \noindent\rule{\linewidth}{0.4pt}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
[META PROMPT HEADER]

We have some preset QUERY_FORMAT candidates, here are our whole search pool:
[ALL EXISTING QUERY FORMATS DESCRIPTION]

Here are two examples from our QUERY_FORMAT candidates as for your reference:
<Format name: Question-Answer>
[RENDERED EXAMPLE 1]

<Format name: Instruction-Response>
[RENDERED EXAMPLE 2]

Please generate ONE new format for the QUERY_FORMAT segment, its description and render the provided example using this new format. The new format could either be a completely new format or a variation of an existing format. 

If you choose to generate a completely new format, please ensure that the new format is conventional, structured, and aligned with commonly used query formats. Avoid overly creative or unconventional formats that deviate significantly from standard practices. The new format should be distinct from the existing formats. 

The variation can focus on two parts, CASING and SEPARATOR:

CASING refers to both the capitalization of the text (e.g., f(x) = x.title(), f(x) = x.upper(), f(x) = x.lower()) and the specific wording or phrasing used (e.g., changing "question" to "instruction" or "input"). 

SEPARATOR: the punctuation or symbols used to separate the question and answer, there are some candidates as for your reference {{'', ' ', '\\n', '--', ';\\n', ' ||', '<sep>', ' \\n', ':', '.'}}.

Note that focus solely on the format itself without altering the content of the question and answer. The format should remain focused on the existing structure (e.g., Question/Answer or Instruction/Response) without modifying the content or introducing any new sections. Avoid the use of underlines or any unconventional formatting styles among words. The format name should only include alphanumeric characters and underscores. Special characters such as `|`, `!`, `#`, `@`, and spaces should be avoided.

Please encapsulate the new query format using the following format:

<START>
<Format name: [format name]>
<Description: [format description]>
[The example rendered by the newly generated format]
<END>

\end{lstlisting}
% \vspace{-2ex}
% \noindent\rule{\linewidth}{0.4pt}

\vspace{2ex}

\noindent \textbf{Step 2: Format Code Generation.} Based on the natural language description and rendered example produced in Step 1, we subsequently generate the corresponding code implementation of the new format. This code will be used by the system to render prompts according to the defined format. We again leverage a meta-prompt to instruct the LLM, this time to generate the executable code. As an illustrative example, here is a conceptual outline of the meta-prompt employed for generating the code representation of a new \textit{Query Format}:

% \noindent \textbf{Query Format Code generation}

% \noindent\rule{\linewidth}{0.4pt}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
[META PROMPT HEADER]

We have some preset QUERY_FORMAT candidates, here are our whole search pool:
[ALL EXISTING QUERY FORMATS DESCRIPTION]

Here are two code implementations from our QUERY_FORMAT candidates as for your reference:
<Format name: Question-Answer>
<Renderer code>
[Question-Answer RENDERER CODE]
<Extractor code>
[Question-Answer EXTRACTOR CODE]

<Format name: Instruction-Response>
<Renderer code>
[Instruction-Response RENDERER CODE]
<Extractor code>
[Instruction-Response EXTRACTOR CODE]

Here is the example rendered by the new format:
[RENDERED RESULTS]

Please generate the code for this provided example based on the new QUERY_FORMAT. Ensure that both the renderer and extractor functions are included. The generated code should be plain Python code without any Markdown syntax or language identifiers such as ```python or '''python. Please output the code directly without any additional formatting. If you need to use any additional and specific packages, please import them in the code. Note that the generated functions should include properly indented blocks, so they can execute without errors. Note that the renderer function name should be query_renderer_{format_name} and the extractor function name should be query_extractor_{format_name}.

Please encapsulate the code using the following format:

<START>
<Format name: {format_name}>
<Description: {format_description}>
<Renderer code>
[Renderer code]
<Extractor code>
[Extractor code]
<END>
\end{lstlisting}
% \vspace{-2ex}
% \noindent\rule{\linewidth}{0.4pt}

\subsection{Content Optimization}

\subsubsection{Case-diagnosis and Revision}

As described in Section~\ref{sec:dual_optimizer}, content optimization is achieved through an iterative process of case-diagnosis and feedback guided mutation. To facilitate this process, we utilize three distinct meta-prompts, each tailored to a specific task within content optimization.

\noindent \textbf{Case Diagnosis Meta-Prompt.} This meta-prompt analyzes the current prompt's performance against a set of test cases. It identifies areas for improvement and suggests specific modifications for the next iteration.

% \noindent\rule{\linewidth}{0.4pt}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
[META PROMPT HEADER]

Upon evaluating the current prompt, this prompt gets the following examples wrong:
[INCORRECT CASES]

Meanwhile, this prompt gets the following examples correct:
[CORRECT CASES]

Please review the provided examples of correct and incorrect answers, and identify [NUM OF DIAGNOSED COMPONENTS] specific area for improvement in the prompts. Each suggestion should focus on A SPECIFIC segment of the prompt that needs optimization. For each suggestion, provide a comprehensive explanation that encapsulates all the evaluation results. If you believe the EXAMPLES segment needs improvement, you may suggest one example that can be added, removed, or altered to enhance the EXAMPLES segment based on the examples given. If you think there is no need for improvement, do not return any prompt segment.
Please encapsulate each suggestion using the following format:

<START>
<Prompt segment: [Segment name]>
[Suggestion goes here]
<END>
\end{lstlisting}
% \vspace{-2ex}
% \noindent\rule{\linewidth}{0.4pt}

\noindent \textbf{Feedback Application Meta-Prompt.} Based on the diagnosis, this meta-prompt generates targeted textual changes to enhance the prompt's performance. It directly modifies the identified components of the prompt based on the feedback.

% \noindent\rule{\linewidth}{0.4pt}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
[META PROMPT HEADER]

The existing [COMPONENT NAME] segment contains:
[CURRENT CONTENT FOR THE COMPONENT]

Here are some suggestions for improving the [COMPONENT NAME] segments: 
[GENERATED DIAGNOSES]

Based on the above information, I wrote [NUMBER OF GENERATED CONTENT] distinct and improved versions of the [COMPONENT NAME] segment within the prompt.
Each revised segment is encapsulated between <START> and <END>. In case this segment is an empty string, generate a suitable one referring to the suggestion.
The [NUMBER OF GENERATED CONTENT] revised [COMPONENT NAME] segments are:
\end{lstlisting}
% \vspace{-2ex}
% \noindent\rule{\linewidth}{0.4pt}

\noindent \textbf{Feedback Application Meta-Prompt (for Examples).} This meta-prompt specifically handles the optimization of few-shot examples. It revises examples by adding, deleting, or modifying one single instances, ensuring that the in-context learning process is effective.

% \noindent\rule{\linewidth}{0.4pt}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
[META PROMPT HEADER]

The existing EXAMPLES segment contains:
[CURRENT IN-CONTEXT EXAMPELS IN PROMPT]

Here are some suggestions for enhancing the EXAMPLES segment: 
[GENERATED DIAGNOSES]

Based on the above information, I have crafted [NUMBER OF GENERATED EXAMPLES] improved version of the EXAMPLES segment within the prompt. Each revision represents ONLY ONE of the following specific actions:
1. Addition: Incorporating one new example into the existing set.
2. Deletion: Eliminating one single example from the current set.
3. Modification: Changing the content of an example while maintaining its contextual relevance.
Please present the results without indicating which action was taken. Each refined EXAMPLES segment is marked by <START> and <END>.

The [NUMBER OF GENERATED EXAMPLES] revised EXAMPLES are:
\end{lstlisting}
% \vspace{-2ex}
% \noindent\rule{\linewidth}{0.4pt}



\subsubsection{Monte-Carlo Sampling}

\noindent \textbf{Monte-Carlo Sampling Meta-Prompt} explores a wider range of semantically equivalent yet syntactically varied instructions, enhancing the chances of discovering more effective prompts.

% \noindent\rule{\linewidth}{0.4pt}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
[META PROMPT HEADER]

Please create a different version of [COMPONENT NAME] segment without changing its semantic meaning. In case this segment is an empty string, generate a suitable one. The existing [COMPONENT NAME] segment contains:
[CURRENT CONTENT FOR THE COMPONENT]

The varied [COMPONENT NAME] segment is as follows:
\end{lstlisting}
% \vspace{-2ex}
% \noindent\rule{\linewidth}{0.4pt}

\noindent \textbf{Monte-Carlo Sampling Meta-Prompt (for Examples)} refines few-shot examples by strategically adding, deleting, or modifying single instances to ensure their effectiveness.

% \noindent\rule{\linewidth}{0.4pt}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
[META PROMPT HEADER]

The existing EXAMPLE set contains:
[CURRENT IN-CONTEXT EXAMPELS IN PROMPT]

Please generate a variation of the EXAMPLES set within the prompt while keeping the semantic meaning. The revision shoud represent ONLY ONE of the following specific actions:
1. Addition: Incorporating one new example into the existing set.
2. Deletion: Eliminating one single example from the current set.
3. Modification: Changing the content of an example while maintaining its contextual relevance.
Please present the results without indicating which action was taken. The varied EXAMPLES segment is as follows:
\end{lstlisting}
% \vspace{-2ex}
% \noindent\rule{\linewidth}{0.4pt}


\section{Appendix: Examples of Generated Format}

Here we select several format generated by GPT4 in CFPO process.

\subsection{Query Format}
% \noindent \textbf{QA\_TITLECASE\_SEPARATOR}
\noindent \textbf{QA\_Titlecase\_Separator}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
Question || In 3 years, Jayden will be half of Ernesto's age. If Ernesto is 11 years old, how many years old is Jayden now?
Answer || Let's think step by step. Ernesto = 11 + 3 = <<11+3=14>>14 Jayden = 14/2 = <<14/2=7>>7 in 3 years Now = 7 - 3 = <<7-3=4>>4 Jayden is 4 years old.
\end{lstlisting}

% \noindent \textbf{QA\_BRACKETS\_COLON\_NEWLINE}
\noindent \textbf{QA\_Brackets\_Colon\_Newline}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
[Question]:
In 3 years, Jayden will be half of Ernesto's age. If Ernesto is 11 years old, how many years old is Jayden now?

[Answer]:
Let's think step by step.
Ernesto = 11 + 3 = <<11+3=14>>14 Jayden = 14/2 = <<14/2=7>>7 in 3 years Now = 7 - 3 = <<7-3=4>>4 Jayden is 4 years old.
\end{lstlisting}

\noindent \textbf{QA\_CapsBold\_ColonNewline}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
**QUESTION**:
In 3 years, Jayden will be half of Ernesto's age. If Ernesto is 11 years old, how many years old is Jayden now?

**ANSWER**:
Let's think step by step.
Ernesto = 11 + 3 = <<11+3=14>>14 Jayden = 14/2 = <<14/2=7>>7 in 3 years Now = 7 - 3 = <<7-3=4>>4 Jayden is 4 years old.
\end{lstlisting}

\noindent \textbf{Cascading\_Statements}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
Question: Statement 1 | Every element of a group generates a cyclic subgroup of the group. Statement 2 | The symmetric group S_10 has 10 elements.
Options:
  -A True, True
  -B False, False
  -C True, False
  -D False, True
   Answer: C
\end{lstlisting}

\noindent \textbf{Highlight\_Separator\_Case}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
QUESTION > Statement 1 | Every element of a group generates a cyclic subgroup of the group. Statement 2 | The symmetric group S_10 has 10 elements.
OPTIONS > (A) True, True (B) False, False (C) True, False (D) False, True
ANSWER > C
\end{lstlisting}

\subsection{Prompt Renderer}

\noindent \textbf{Concise\_Bullet\_Points\_Renderer}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
- Task Instruction: Write a function that returns the sum of two numbers.

- Task Detail: The function should take two numbers as input and return their sum.

- Examples: Input: 1, 2
Output: 3

- Query: Input: 1, 2
Output:
\end{lstlisting}



\noindent \textbf{Tabular\_Sections\_Renderer}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
| Task Instruction | Write a function that returns the sum of two numbers. |
| Task Detail | The function should take two numbers as input and return their sum. |
| Examples | Input: 1, 2
Output: 3 |
| Query | Input: 1, 2
Output: |
\end{lstlisting}

\noindent \textbf{Checklist\_Format\_Renderer}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
- [ ] **Task Instruction**
Write a function that returns the sum of two numbers.

- [ ] **Task Detail**
The function should take two numbers as input and return their sum.

- [ ] **Examples**
Input: 1, 2
Output: 3

- [ ] **Query**
Input: 1, 2
Output:
\end{lstlisting}


\section{Appendix: Initial Prompt}\label{init}

\subsection{GSM8K}

\textit{Prompt Renderer: Directly Joint}
\noindent \textit{Query Format: QA}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
Q: There are 15 trees in the grove. Grove workers will plant trees in the grove today. After they are done, there will be 21 trees. How many trees did the grove workers plant today?

A: There are 15 trees originally. Then there were 21 trees after some more were planted. So there must have been 21 - 15 = 6. The answer is 6.

{{Query placeholder}}
\end{lstlisting}

\subsection{MATH500}
\textit{Prompt Renderer: Directly Joint}

\noindent \textit{Query Format: Question-Answer}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
A chat between a curious user and an AI assistant. The assistant gives step-by-step solutions to the user's questions. In the end of assistant's response, a final answer is given in the format of "The answer is: <ANSWER>.".

Here are some examples:
Question: Let \[f(x) = \left\{
\begin{array}{cl} ax+3, &\text{ if }x>2, \\
x-5 &\text{ if } -2 \le x \le 2, \\
2x-b &\text{ if } x <-2.
\end{array}
\right.\]Find $a+b$ if the piecewise function is continuous (which means that its graph can be drawn without lifting your pencil from the paper).
Answer: Let's think step by step. For the piecewise function to be continuous, the cases must "meet" at $2$ and $-2$. For example, $ax+3$ and $x-5$ must be equal when $x=2$. This implies $a(2)+3=2-5$, which we solve to get $2a=-6 \Rightarrow a=-3$. Similarly, $x-5$ and $2x-b$ must be equal when $x=-2$. Substituting, we get $-2-5=2(-2)-b$, which implies $b=3$. The answer is: $a+b=-3+3=\boxed{0}$.

{{Query placeholder}}
\end{lstlisting}

\subsection{ARC-Challenge}

\textit{Prompt Renderer: Directly Joint}

\noindent \textit{Query Format: MultiChoice\_QA}

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
You are a commonsense helper. I will provide several examples and a presented question. Your goal is to pick the most reasonable answer among the given options for the current question. Please respond with the corresponding label (A/B/C/D) for the correct answer.

Here are some examples:

Question: Forests have been cut and burned so that the land can be used to raise crops. Which consequence does this activity have on the atmosphere of Earth?
Choices:
A: It reduces the amount of carbon dioxide production
B: It reduces the production of oxygen
C: It decreases the greenhouse effect
D: It decreases pollutants in the air
Answer: B

{{Query placeholder}}
\end{lstlisting}


\subsection{Big-Bench Classification}

\textit{Prompt Renderer: Directly Joint}

\noindent \textit{Query Format: Input-Output}

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
Examples:
Input: Speaker 1: 'You do this often?' Speaker 2: 'It's my first time.'
Output: no

{{Query placeholder}}
\end{lstlisting}

\section{Appendix: CFPO Results Analysis}\label{opt_prompts}

\subsection{In-context Examples and Text Length}\label{apx:shot}

\begin{figure}[t]
  \includegraphics[width=\linewidth]{fig/results.png}
  \caption {Overview of in-context examples and text lengths for various tasks and models.}
  \label{fig:results}
\end{figure}

Figure~\ref{fig:results} presents an overview of the number of in-context examples and the text length of optimized prompts across various tasks and models. An interesting pattern emerges: pre-trained models consistently prefer prompts with longer text and more in-context examples compared to instruction-tuned models. 
This observation suggests that pre-trained models benefit more from explicit context and detailed reasoning steps, which align with their less task-specialized nature.
In contrast, the relative insensitivity of instruction-tuned models to prompt length and in-context examples supports the notion that these models have already trained with task-specific knowledge during fine-tuning, reducing their dependence on highly detailed prompts.

\subsection{Examples of Optimal Prompt}


Here we selected several optimal prompts searched by \sysname{}.

\vspace{1ex}

\noindent \textbf{LLaMA-3.1-8B on GSM8K}

\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
**Understanding the Task: A Foundation for Mathematical Problem-Solving**
Your task is to methodically analyze the information provided and logically deduce the correct answer to the mathematical problem. Delve into each relevant detail, ensuring no critical step or aspect is overlooked. Approach the solution with a detailed-oriented mindset, ensuring every part of the process is considered to arrive at an accurate conclusion. Reflect on all the elements that might influence your reasoning or calculation, striving for thoroughness in your analysis.

**Decoding Mathematical Language in Real-World Scenarios**
For the most effective problem-solving in mathematics, particularly when faced with intricate calculations over periods or under specific scenarios affecting results, an attentive and systematic method is key. Start by accurately determining the base numerical value. Then proceed by methodically listing every significant change whether it be increases, decreases, or modifications that impacts this base figure as the scenario unfolds, making sure to include each change in your overall computations. It's essential to focus on the concept of compounded operations, whether they're applied annually, monthly, or daily, and to thoughtfully evaluate the consequences of extraordinary events or circumstances (like an unexpected inheritance, a yearly loss, or a singular occurrence with a major impact) that might significantly shift the end calculations. Sharpen your attention on the dynamics of numerical relationships, particularly in cases involving ratios, proportions, and the impact of percentage changes over durations, to avoid common mistakes. Misunderstandings or misapplications of these numerical relationships can frequently cause inaccuracies. Thus, it is critical to scrutinize these mathematical relationships, whether they are of direct or inverse proportions, as well as the aggregate effects of consecutive percentage changes, as outlined in the problem description. This intensified attention is pivotal for an accurate and detailed resolution of complex issues, marked by multiplicative elements and interconnected circumstances. Reflect deeply on the significance of every step in the calculation process, absorbing the nuances of these changes, to systematically arrive at the most precise solution.

**Ensuring Your Solution Fits the Scenario Perfectly**
In presenting your solution, ensure it comprises both a numerical answer and a meticulously detailed explanation of the process leading to it. Begin with outlining the initial conditions and sequentially narrate the calculations you make at each step, highlighting any compounded operations or adjustments made to account for unique scenarios or conditions. This progression should clearly show how each step contributes to arriving at the final answer. For instance, if the task involves calculating the total costs saved over time with additional periodic benefits, your response should methodically explain: "Starting with an initial savings of X, plus Y every Z period, and considering an additional benefit of A every B period, leads to a total of...". This comprehensive breakdown not only bolsters the understanding of the mathematical principles applied but also provides a robust framework for identifying and rectifying any potential inaccuracies throughout the problem-solving process.

**Examples to Illuminate the Path**
To better grasp the concepts, consider the following illustrative examples:
Question: There are 15 trees in the grove. Grove workers will plant trees in the grove today. After they are done, there will be 21 trees. How many trees did the grove workers plant today? / ANSWER: Think through the problem step by step, diving into each segment for a thorough exploration to piece together the final answer. There are 15 trees originally. Then there were 21 trees after some more were planted. So there must have been 21 - 15 = 6. The answer is 6.

Question: A book club starts with a membership of 120. If the club increases its membership by 10% in the first year and then loses 5% of its members in the second year, what is the total membership at the end of the second year? / ANSWER: Think through the problem step by step, diving into each segment for a thorough exploration to piece together the final answer. The club starts with 120 members. In the first year, it increases by 10%, which is 0.10 * 120 = 12, so there are 120 + 12 = 132 members after the first year. In the second year, the club loses 5% of its members, which is 0.05 * 132 = 6.6, but since the number of members must be an integer, we consider a loss of 7 members (assuming the figure is rounded up for practical reasons). Therefore, there are 132 - 7 = 125 members at the end of the second year.

Question: Martin saves $10 every week. In addition, every third week, he earns an extra $15 from helping his neighbor. How much has Martin saved after 9 weeks? / ANSWER: Think through the problem step by step, diving into each segment for a thorough exploration to piece together the final answer. Martin saves $10 each week, so over 9 weeks, he saves 9 * $10 = $90. Additionally, every third week, he earns an extra $15, which occurs three times within 9 weeks (in the 3rd, 6th, and 9th weeks). So, he earns an extra 3 * $15 = $45 from helping his neighbor. Therefore, the total amount Martin has saved after 9 weeks is $90 + $45 = $135.

Question: A teacher divides a class into groups for a project. If the ratio of boys to girls in the class is 3 to 2, and there are 30 students in the class, how many boys are in the class? / ANSWER: Think through the problem step by step, diving into each segment for a thorough exploration to piece together the final answer. The total ratio units for boys to girls in the class is 3 + 2 = 5. With 30 students in the class, each ratio unit represents 30 / 5 = 6 students. Therefore, the number of boys, represented by 3 parts of the ratio, is 3 * 6 = 18. The answer is 18.

Question: Grandma wants to order 5 personalized backpacks for each of her grandchildren's first days of school. The backpacks are 20% off of $20.00, and having their names monogrammed on the backpack will cost $12.00 each. How much will the backpacks cost in total? / ANSWER: Think through the problem step by step, diving into each segment for a thorough exploration to piece together the final answer. The backpacks are 20% off of $20.00, so the price after the discount is $20.00 - ($20.00 * 20%) = $20.00 - $4.00 = $16.00 each. The monogramming costs an additional $12.00 per backpack. Therefore, the total cost for each backpack is $16.00 + $12.00 = $28.00. For 5 backpacks, the total cost will be 5 * $28.00 = $140.00. The correct answer is $140.00.

**Query**
{{query}}
\end{lstlisting}

\noindent \textbf{LLaMA-3-8B-Instruct on MATH-500}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
- Task Instruction: A chat between a curious user and an AI assistant focused on solving mathematical and reasoning tasks. The assistant is expected to deliver step-by-step solutions to the user's questions, emphasizing mathematical accuracy and rigor throughout the process. It must ensure that each mathematical operation and logical deduction is carefully examined and validated to derive the correct solution. At the conclusion of the response, the final answer should be presented in the format of "The answer is: <ANSWER>.", thereby confirming the solution's validity and demonstrating a thorough understanding of the problem-solving approach.

- Task Detail: In addressing equation-based inquiries, precision in algebra, geometry, piecewise functions, complex numbers, and financial mathematics is paramount. This involves a detailed analysis of each equation, assessing every element and specific condition. For piecewise functions, it's critical to ensure continuity by solving for variables that maintain consistency across sections. In geometry, integrating measurements such as angles, lengths, and areas is fundamental. Algebraic queries require a consideration of all potential solutions and constraints, ensuring a comprehensive resolution. The addition of complex numbers into this mix necessitates a thorough understanding of their properties and operations to accurately determine both real and imaginary solutions. Similarly, tackling financial mathematics problems demands a deep comprehension of concepts such as compound interest, present value, and future value to make precise financial forecasts and comparisons. This holistic approach confirms that all aspects of the problem are considered and that the solution accounts for every requirement, assuring mathematical integrity in the resolution process.

- Output Format: 1. Solutions that involve fractions, square roots, or crucial mathematical figures (e.g., pi) must be simplified to their most fundamental form. This includes reducing fractions to their lowest terms and expressing square roots in their least complex radical form.
2. Avoid the use of decimals unless the question explicitly requires it or they are necessary for conveying the most precise value possible.
3. Present solutions involving square roots in their reduced radical form, ensuring the simplification process enhances comprehension without diluting mathematical integrity.
4. In scenarios involving complex numbers, represent answers in their standard form (a + bi), ensuring both 'a' and 'b' are presented in their simplest, most refined state. This emphasizes the need for a clear, coherent representation of solutions encompassing complex numbers.
5. Conclude your explanation with the statement: "The answer is: \[<ANSWER>\].", reinforcing consistency and clarity across various mathematical challenges. This concluding statement should encapsulate the solution in its simplest and most direct form, reflecting a thorough simplification and rationalization process.

Your explanation must delineate a detailed, step-by-step progression leading to the final solution. This approach is not merely about arriving at the correct answer but about illuminating the path taken to get there, ensuring a deep understanding and clear demonstration of the reasoning behind each step.

- Examples: Here are some examples:
### Instruction:
A rectangle ABCD has sides AB = 8 units and BC = 6 units. A circle with a radius r units is inscribed within this rectangle. Calculate the radius r of the inscribed circle, ensuring the answer is in its simplest form.

### Response:
We'll approach this problem by breaking it down into manageable steps. We start by understanding that the radius of the inscribed circle is equal to the distance from the center of the rectangle to any of its sides because the circle is perfectly inscribed. In a rectangle, this distance is half the length of the rectangle's shorter side. Therefore, the radius r of the inscribed circle is half the length of BC, which is $6 \div 2 = 3$ units. The answer is: $r=3$.

### Instruction:
Given a triangle where two sides are represented by complex numbers (3 + 4i) units and (1 - 2i) units, and the angle between them is 90 degrees, calculate the length of the hypotenuse. Ensure your answer includes a comprehensive breakdown of complex number operations and geometric principles applied.

### Response:
We'll approach this problem by breaking it down into manageable steps. We start by acknowledging that the length of a side represented by a complex number can be found using the modulus of that number. The modulus of the first side is $\sqrt{3^2 + 4^2} = 5$ units, and the modulus of the second side is $\sqrt{1^2 + (-2)^2} = \sqrt{5}$ units. Since these sides form a right triangle and we are given that the angle between them is 90 degrees, we can apply the Pythagorean theorem to find the length of the hypotenuse. The hypotenuse's length squared will be the sum of the squares of the lengths of the other two sides, which is $5^2 + (\sqrt{5})^2 = 25 + 5 = 30$. Thus, the length of the hypotenuse is $\sqrt{30}$ units. The answer is: $\sqrt{30}$.

- Query: 
{{query}}
\end{lstlisting}

\noindent \textbf{LLaMA-3.1-8B on ARC-C}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
<div class='TaskInstruction'>
  <h2>TaskInstruction</h2>
  <p>Your mission is to meticulously assess each situation presented alongside a specific question, employing your critical thinking and analytical skills. Your task comprises not only identifying the most logical and coherent choice (A/B/C/D) but also thoroughly evaluating how each option connects or diverges from the question's essence. This requires a deep engagement with both the query and the choices, ensuring your reasoning is firmly anchored in the specifics of the options provided. It is essential to weave direct elements from the choices into your analysis, demonstrating a detailed understanding of how each option relates to the core question, and articulating why alternatives may be less fitting given the scenario. This approach ensures a nuanced and well-justified selection process, grounded in the interplay between the question context and the specific details of the available choices.</p>
</div>
<div class='TaskDetail'>
  <h2>TaskDetail</h2>
  <p>In addressing the questions set before you, it is imperative to delve deeper than mere superficial observations or initial judgments. Each scenario or question must be examined not just in its immediate context but within a broader spectrum, looking into the underpinning mechanisms or far-reaching effects of each option presented. This necessitates a thorough exploration of the larger implications and the scientific or logical foundations that dictate the outcomes. For instance, in environmental matters, it is vital to assess not just the immediate effects but the sustained impact on the ecosystem. In the realm of science, such as when discerning chemical processes, it is crucial to understand the molecular or atomic level changes that classify a reaction as a chemical change. This enhanced level of scrutiny and deeper analysis will lead to more accurate and well-founded choices, ensuring your responses are not just correct, but are also backed by a solid understanding of the underlying principles or long-term consequences.</p>
</div>
<div class='OutputFormat'>
  <h2>OutputFormat</h2>
  <p>For every query presented, your task is to identify the right choice from the options (A/B/C/D) accompanied by a concise rationale for your selection. This format is vital as it showcases the thought process leading to your decision, facilitating a comprehensive grasp and interaction with the task.</p>
</div>
<div class='Examples'>
  <h2>Examples</h2>
  <p>Here are some examples:

Question: Forests have been cut and burned so that the land can be used to raise crops. Which consequence does this activity have on the atmosphere of Earth?
A: It reduces the amount of carbon dioxide in the atmosphere
B: It reduces the availability of oxygen
C: It lessens the greenhouse effect
D: It lowers the levels of pollutants in the air
Answer: B

Question: What is the most critical practice to ensure electrical safety while operating devices?
A: Ensure the device does not come into contact with water.
B: Use the device with hands covered in oil.
C: Operate the device with wet hands.
D: Leave the device plugged in when not in use.
Answer: A

Question: Placing a plant cell in a hypertonic solution typically results in which of the following?
A: The cell expanding as it absorbs water.
B: No significant change due to the rigid cell wall.
C: The cell shrinking as water exits the cell.
D: Rapid division of the cell.
Answer: C

Question: What is the primary effect of using fossil fuels on global climate change?
A: It leads to a significant reduction in greenhouse gases.
B: It decreases the Earth's surface temperature.
C: It increases the amount of greenhouse gases in the atmosphere.
D: It contributes to a decrease in carbon dioxide levels.
Answer: C

Question: The process of photosynthesis in plants primarily involves which of the following transformations?
A: Converting oxygen and glucose into carbon dioxide and water
B: Transforming water and carbon dioxide into oxygen and glucose
C: Changing sunlight into chemical energy without producing oxygen
D: Producing carbon dioxide and glucose from oxygen and water
Answer: B

{{ query }}
\end{lstlisting}

% \subsection{GSM8K on Mistral}
% \textit{Prompt Renderer: Directly Joint}

% \textit{Query Format: Question-Answer}
% \begin{lstlisting}[basicstyle=\ttfamily\footnotesize\color{gray},]
% To effectively tackle and resolve the upcoming mathematical challenge, it's vital to first thoroughly understand the question and the broader scenario in which it sits. Encountering phrases like 'twice as many', 'half as many', 'three times as much', or 'five fewer than', is your cue to carefully translate these comparative descriptions into mathematical language. However, before delving into the numerical aspects, take a moment to fully grasp the context and the specifics of the scenario presented. This involves recognizing and incorporating any distinctive elements that could influence your approach to mathematical operations or the interplay between different quantities. Such an understanding is crucial for tasks like allocating a total cost across several items or differentiating various profit strategies, going beyond mere arithmetic to include a comprehension of the problem's unique context.

% After performing the required calculations, it's paramount to circle back to the original question to ensure your solution is in harmony with the described scenario. Carefully examine each step of your reasoning and calculations to check their accuracy and applicability to the specifics of the question. This thorough review process guarantees that your answer is not only mathematically correct but also comprehensively addresses the problem within its actual context. This detailed approach helps avoid common pitfalls, such as accurately conducting calculations but misapplying them due to a misunderstanding of the problem's unique features or overlooking essential details in the problem statement. Remember, a correct solution is the result of both precise arithmetic and a profound contextual understanding of the given scenario. When dealing with problems that involve a sequence of events or actions over time, it is particularly important to first establish a chronological order. This helps in accurately deducing relationships and outcomes, ensuring a logical flow in problem-solving and enabling a clearer pathway to the correct solution.

% In tackling mathematical problems, particularly those embedded within complex scenarios or involving multiple steps, the art of accurately translating comparative descriptions into their mathematical equivalents is foundational. This process begins with a keen analysis of the problem's language, identifying key phrases that signal specific mathematical operations. For example, "twice as many" signifies multiplication by 2, "half as many" denotes a division by 2, and "percent more" suggests a calculation involving a percentage increase.

% However, the journey from understanding to solution requires more than just translation. It necessitates a structured breakdown of the problem into sequential steps that reflect the true nature of the relationships between quantities. This step-by-step decomposition serves not only to simplify the complexity but also to ensure that each operation is correctly applied in context. For instance, when faced with a scenario that describes a sequence of events or changes in quantities over time, it is crucial to establish a logical order for these operations, ensuring that the final equation accurately mirrors the real-world situation.

% To enhance problem-solving accuracy, this segment introduces a subsection dedicated to strategies for developing clear, contextually accurate mathematical equations. Key among these strategies is the identification of phrases indicating mathematical operations and the vigilant construction of equations that faithfully represent the described scenario. This approach involves:

% 1. Carefully reading the problem to understand the scenario and the relationships between different quantities.
% 2. Identifying key words or phrases that hint at specific mathematical operations.
% 3. Formulating step-by-step equations that accurately capture these operations in the order they occur within the scenario.
% 4. Double-checking that the established equations align with the logical flow of the problem, ensuring that each step builds upon the previous one in a manner that is true to the given context.

% By adhering to these strategies, solvers can avoid common pitfalls such as misinterpretation of terms or misapplication of mathematical operations, leading to solutions that are not only mathematically sound but also deeply rooted in the scenario's context. This refined approach empowers solvers to navigate through complex problems more efficiently, ensuring a thorough and accurate resolution that accounts for every detail of the presented challenge.

% To demonstrate the application of these principles, let's explore several examples and their corresponding solutions:
% Question: There are 15 trees in the grove. Grove workers will plant trees in the grove today. After they are done, there will be 21 trees. How many trees did the grove workers plant today?
% Answer: Let's think step by step. There are 15 trees originally. Then there were 21 trees after some more were planted. So there must have been 21 - 15 = 6. The answer is: 6.

% Question: If a garden initially has 8 roses and the number of roses doubles, how many roses are there now?
% Answer: Let's think step by step. Let's analyze the information. Initially, there are 8 roses. The number of roses doubles, which means we multiply the initial number by 2. So, that gives us 8 * 2 = 16 roses. The answer is: 16.

% Question: A library initially has 120 books. If 20 more books are added each month, how many books will the library have after 4 months?
% Answer: Let's think step by step. Let's analyze the information step by step. Starting with 120 books, 20 books are added each month. Over 4 months, that's 20 books/month * 4 months = 80 books added. Therefore, the final number of books is 120 (initial) + 80 (added) = 200 books. The answer is: 200.

% Question: Amy bought 3 liters of orange juice and 2 liters of apple juice. If 1 liter of orange juice costs $4 and the apple juice costs half as much per liter as the orange juice, how much did Amy spend in total?
% Answer: Let's think step by step. First, let's analyze the costs. The orange juice costs $4 per liter, so for 3 liters, it's 3 * $4 = $12. The apple juice costs half as much as the orange juice, which makes it $4 / 2 = $2 per liter. So, for 2 liters of apple juice, it's 2 * $2 = $4. Adding the costs together, Amy spent $12 (for orange juice) + $4 (for apple juice) = $16 in total. The answer is: $16.

% Question: A bookstore is having a sale: "Buy two, get one free" on all books, with each book priced at $15. If Emily buys 9 books during the sale, how much does she spend in total?
% Answer: Let's think step by step. For every three books Emily buys, she only pays for two because the third book is free. Since Emily buys 9 books, she gets 3 books for free (every third book). This means she pays for 6 books (9 - 3 = 6). At $15 per book, the cost for 6 books is 6 * $15 = $90. Therefore, Emily spends $90 in total. The answer is: $90.

% Question: Maria was 24 years old 4 years ago. 6 years ago, Alex was twice as old as what Maria was 8 years ago. How old will Alex be in 3 years?
% Answer: Let's think step by step. Maria was 24 years old 4 years ago, which means she is 24 + 4 = 28 years old now. So, 8 years ago, Maria was 28 - 8 = 20 years old. According to the problem, 6 years ago, Alex was twice as old as Maria was 8 years ago, meaning Alex was 2 * 20 = 40 years old 6 years ago. Therefore, Alex is 40 + 6 = 46 years old now. In 3 years, Alex will be 46 + 3 = 49 years old. The answer is: 49.

% Question: A carton of milk costs $3. If a carton of almond milk costs 20% more than the regular milk, and Sara buys 2 cartons of each, how much does she spend in total?
% Answer: Let's think step by step. First, let's determine the cost of a carton of almond milk. It costs 20% more than the regular milk, which means it costs $3 + ($3 * 0.20) = $3 + $0.60 = $3.60. Sara buys 2 cartons of regular milk at $3 each, totaling $3 * 2 = $6. She also buys 2 cartons of almond milk at $3.60 each, totaling $3.60 * 2 = $7.20. Adding the costs together, Sara spends $6 (for regular milk) + $7.20 (for almond milk) = $13.20 in total. The answer is: $13.20.

% {{query}}
% \end{lstlisting}


% \begin{table}[t]
%   \centering
%   {
%     \resizebox{0.5\textwidth}{!}{
%     \begin{tabular}{llcccc}
%       \toprule
%       \textbf{Task} & \textbf{Metric} & \textbf{Mistral-7B-v0.1} & \textbf{LLaMA-3.1-8B} & \textbf{LLaMA-3-8B-Instruct} & \textbf{Phi-3-Mini-Instruct} \\
%       \midrule
%       \multirow{2}{*}{\textit{GSM8K}} 
%         & \#In-context Examples   & 7         & 5         & 4             & 3 \\
%         & Text Length             & 1381      & 1112      & 571           & 539 \\
%       \midrule
%       \multirow{2}{*}{\textit{MATH500}} 
%         & \#In-context Examples   & 4         & 3         & 2             & 4 \\
%         & Text Length             & 574       & 762       & 794           & 723 \\
%       \midrule
%       \multirow{2}{*}{\textit{ARC-Challenge}} 
%         & \#In-context Examples   & 3         & 5         & 1             & 2 \\
%         & Text Length             & 401       & 639       & 368           & 335 \\
%       \midrule
%       \multirow{2}{*}{\textit{BigBench-Classification}} 
%         & \#In-context Examples   & 2         & 5         & 7             & 2 \\
%         & Text Length             & 319       & 934       & 734           & 241 \\
%       \bottomrule
%     \end{tabular}
%     }
%   }
%   \caption{\label{tab:appendix_shot} Overview of in-context examples and text lengths for various tasks and models.}
% \end{table}
% \begin{table}[t]
%   \centering
%   {
%     \resizebox{0.5\textwidth}{!}{
%   \begin{tabular}{lcccc}
%     \hline
%     \toprule
%     \textbf{Method} & \textbf{Mistral-7B-v0.1} & \textbf{LLaMA-3.1-8B} & \textbf{LLaMA-3-8B-Instruct} & \textbf{Phi-3-Mini-Instruct} \\
%     \hline
%     \multicolumn{5}{c}{\rule{0pt}{2.5ex}\textbf{\textit{GSM8K}}\rule{0pt}{2.5ex}}\\
%     \#In-context Example   & 7         & 5         & 4             & 3 \\
%     Text Length            & 1381         & 1112         & 571             & 539  \\
%     \hline
%     \multicolumn{5}{c}{\rule{0pt}{2.5ex}\textbf{\textit{MATH500}}\rule{0pt}{2.5ex}}\\
%     \#In-context Example   & 4           & 3         & 2             & 4  \\
%     Text Length            & 574         & 762         & 794             & 723  \\
%     \hline
%     \multicolumn{5}{c}{\rule{0pt}{2.5ex}\textbf{\textit{ARC-Challenge}}\rule{0pt}{2.5ex}}\\
%     \#In-context Example   & 3       & 5         & 1         & 2  \\
%     Text Length            & 401       & 639       & 368        & 335  \\
%     \hline
%     \multicolumn{5}{c}{\rule{0pt}{2.5ex}\textbf{\textit{BigBench-Classification}}\rule{0pt}{2.5ex}}\\
%     \#In-context Example   & 2         & 5         & 7             & 2  \\
%     Text Length            & 319         & 934         & 734             & 241  \\
%     \hline
%   \end{tabular}
%   }
%   }
%   \caption{\label{tab:appendix_shot}}
% \end{table}
