\subsection{\textbf{RQ1: \BFP Frequency}}

For RQ1, we analyzed the frequency and types of common \bfps in autonomous driving systems, specifically focusing on Apollo and Autoware. The results, presented in \autoref{tab:syntactic_distribution_bfp} and \autoref{tab:semantic_distribution_bfp}, categorize the \bfps into syntactic and semantic types. 


\begin{wraptable}[13]{r}{0.45\textwidth}
\centering
\vspace{-2ex}
\caption{Syntactic \BFPs in ADSes}
\vspace{-0.5ex}
\label{tab:syntactic_distribution_bfp}
\begin{adjustbox}{width=\linewidth}
\begin{tabular}{l|c|c|c}
\toprule
\textbf{Syntactic \BFP} & \textbf{Apollo} & \textbf{Autoware} & \textbf{Both} \\
\midrule
If-related (IF) & 13.6\% & 19.5\% & 18.3\% \\
Assignment (AS) & 15.6\% & 14.7\% & 14.8\% \\
Method Call (MC) & 26.9\% & 23.1\% & 23.9\% \\
Method Declaration (MD) & 1.8\% & 1.9\% & 1.9\% \\
Sequence (SQ) & 2.8\% & 2.4\% & 2.5\% \\
Loop (LOOP) & 3.8\% & 6.0\% & 5.5\% \\
Return (RT) & 4.0\% & 8.4\% & 7.6\% \\
Local Variable (LV) & 9.5\% & 12.6\% & 12.0\% \\
Non-source-code Variable (NV) & 7.3\% & 5.9\% & 6.1\% \\
Library (LIB) & 2.8\% & 1.8\% & 2.0\% \\
Syntax (SYN) & 1.8\% & 0.1\% & 0.4\% \\
Try-Catch (TRY) & 0.6\% & 0.2\% & 0.3\% \\
Switch (SW) & 0.2\% & 0.1\% & 0.1\% \\
Class Field (CF) & 0.0\% & 0.1\% & 0.1\% \\
Documentation (DOC) & 9.1\% & 3.2\% & 4.4\% \\
\bottomrule
\end{tabular}
\end{adjustbox}
\end{wraptable}

In both ADSes, syntactic BFPs, particularly 23.9\% for Method Call (MC) and 18.3\% for If-related (IF), are most frequently observed. 
These patterns typically involve adjustments in the code's basic structure and flow, suggesting a recurring need for attention to fundamental coding practices in ADS development.
\yuntianyihl{The MC pattern represents nearly one-quarter of all bug-fix patterns in both Apollo (26.9\%) and Autoware (23.1\%). This suggests that method invocation errors are particularly challenging in ADSes. Given that method calls often involve integrating multiple components, it hints at the complexity and interdependencies within these systems. This could imply a need for better modularization or more robust testing around component interactions.}


\vspace{-1ex}
\begin{finding}
\label{finding:rq1_if_mc}
    Syntactic \bfps like 18.3\% of If-related (IF) and 23.9\% of Method Call (MC) are the most common types in ADSes, \yuntianyihl{which indicates that issues related to control flow decisions and incorrect method invocations are prevalent.}
\end{finding}
\vspace{-1ex}

Moreover, domain-specific semantic \bfps, including 22.9\% Path Planning Optimization (PPO) and 6.5\% Module Integration and Interaction (MII), also feature prominently in our findings. These patterns often involve complex modifications and a deep understanding of the systemâ€™s operational logic. 
The complexity and critical nature of these fixes, particularly in MII, reveal the intricacies involved in ADS software maintenance, highlighting the necessity for robust architectures. This complexity underscores the importance of both software researchers and practitioners in directing attention to the integration, modular architecture, and encapsulation of ADS~\cite{TasKZS16,0003LPZ0SG18}. Moreover, the significant presence of MII-related issues suggests an impending need to prioritize integration testing in ADS, an area that currently lacks comprehensive study but is crucial for vehicle safety and performance~\cite{LouDZZ022}.

\vspace{-1ex}
\begin{finding}
\label{finding:rq1_ppo_mii}
    Semantic \bfps like 22.9\% fixes of Path Planning Optimization (PPO) and 6.5\% of Module Integration and Interaction (MII) are the most common domain-specific ones. The prominence of MII-related fixes indicates the need for improved module integration testing techniques \yuntianyihl{and advanced modular ADS software architecture design and encapsulation}.
\end{finding}
\vspace{-1ex}

The domain-independent semantic patterns, such as 13.6\% of Data Flow Correction (DFC) 
are indicative of foundational challenges in ensuring cohesive system operation.
The prevalence of DFC in \bfps highlights a critical area of system functionality that often is understudied, pointing to a gap in data flow-oriented testing within the software testing domain~\cite{SuWMPHCS17,Weyuker90}. This gap suggests the need for more comprehensive data-flow testing strategies that move beyond traditional code coverage to enhance data-flow coverage and system reliability.

\vspace{-1ex}
\begin{finding}
\label{finding:rq1_dfc}
    The prominence of domain-independent semantic \bfps like 13.6\% of Data Flow Correction (DFC) indicates the need for more research on data flow-based testing  (e.g., data-flow coverage) for ADSes, which may be more computationally expensive but possibly worthwhile for these safety-critical ADSes.
\end{finding}
\vspace{-1ex}



\begin{wraptable}[22]{r}{0.58\textwidth}
\centering
\vspace{-2ex}
\caption{Semantic \BFPs in ADSes}
\vspace{-0.5ex}
\label{tab:semantic_distribution_bfp}
\begin{adjustbox}{width=\linewidth}
\begin{tabular}{l|c|c|c}
\toprule
\textbf{Semantic \BFP} & \textbf{Apollo} & \textbf{Autoware} & \textbf{Both} \\
\midrule
\textbf{Domain-specific Semantic Patterns} & & & \\
Path Planning Optimization (PPO) & 9.2\% & 27.3\% & 22.9\% \\
Sensor Data Interpretation (SDI) & 2.0\% & 2.4\% & 2.3\% \\
Control System Adjustment (CSA) & 1.2\% & 1.5\% & 1.4\% \\
Predictive Algorithm Enhancement (PAE) & 2.0\% & 0.6\% & 0.9\% \\
SLAM Algorithm Refinement (SAR) & 3.8\% & 2.9\% & 3.1\% \\
Environmental Adaptability (EA) & 4.7\% & 4.0\% & 4.2\% \\
Firmware-Software Harmonization (FSH) & 2.2\% & 0.4\% & 0.8\% \\
Module Integration and Interaction (MII) & 12.4\% & 4.6\% & 6.5\% \\
Safety Protocol Enhancement (SPE) & 0.0\% & 0.7\% & 0.5\% \\
Communication Protocol Refinement (CPR) & 0.5\% & 0.6\% & 0.6\% \\
Real-time Data Processing Improvement (RDPI) & 2.8\% & 0.7\% & 1.2\% \\
Autonomous Decision-Making Improvement (ADMI) & 1.3\% & 0.3\% & 0.5\% \\
Simulation Performance Optimization (SPO) & 0.2\% & 1.5\% & 1.1\% \\
\addlinespace
\textbf{Domain-independent Semantic Patterns} & & & \\
Data Flow Correction (DFC) & 11.2\% & 14.4\% & 13.6\% \\
Logic Amendment (LA) & 2.0\% & 2.1\% & 2.1\% \\
State Management Enhancement (SME) & 3.2\% & 6.1\% & 5.4\% \\
Interface Consistency (IC) & 0.3\% & 0.7\% & 0.6\% \\
Resource Management Improvement (RMI) & 1.2\% & 0.4\% & 0.6\% \\
Concurrency Control (CC) & 0.3\% & 0.3\% & 0.3\% \\
Error Handling Refinement (EHR) & 4.0\% & 3.3\% & 3.5\% \\
Configuration and Environment Management (CEM) & 7.2\% & 7.4\% & 7.3\% \\
Security Strengthening (SS) & 0.5\% & 0.1\% & 0.2\% \\
User Interface Adjustment (UIA) & 2.5\% & 2.4\% & 2.5\% \\
Dependency Update (DU) & 5.2\% & 3.0\% & 3.6\% \\
Build and Compilation Enhancement (BCE) & 8.5\% & 5.4\% & 6.2\% \\
Debugging Tools Improvement (DTI) & 4.0\% & 3.3\% & 3.5\% \\
Documentation Update and Clarification (DUC) & 7.5\% & 3.5\% & 4.5\% \\
\bottomrule
\end{tabular}
\end{adjustbox}
% \vspace{-2ex}
% \end{table}
\end{wraptable}


\autoref{tab:semantic_distribution_bfp} \yuntianyihl{also indicates that Autoware has a higher ratio of Path Planning Optimization (PPO) \bfps, possibly due to its specific development focus and project needs since Autoware has more code lines and sub-modules in the Planning module than Apollo does. Autoware also claims to be a customizable and easily extendable Planning development platform~\cite{autoware_planning_design}. Its maintainers accepted more pull requests from community contributors around the world while Apollo's maintainers tended to merge more pull requests from Baidu employees.
Apollo's higher number of build, debug, and documentation-related instances reflect different project workflows and priorities, such as a stronger emphasis on ensuring robust documentation and debugging processes to facilitate collaboration and maintenance. This could be due to Apollo's larger user base and its need for clear documentation and thorough debugging to support a wide range of developers and applications. Additionally, Apollo's extensive integration with various hardware and software components, reflected by the Module Integration and Interaction (MII) patterns of 12.4\% in Apollo compared to 4.6\% in Autoware, may require more frequent build and debug fixes to maintain compatibility and performance. Autoware just finished its major version update to Autoware.universe~\cite{autoware_universe_transition}, the tutorial and documentation are still under construction and waiting to be completed in the future. 
}

\vspace{-1ex}
\begin{finding}
\label{finding:rq1_autoware_apollo_comparison}
\yuntianyihl{
    Autoware shows a higher ratio of Path Planning Optimization (PPO), due to its customizable Planning platform and larger Planning module, which accepts more contributions from the open-source community. Apollo emphasizes build, debug, and documentation-related fixes, reflecting its broader user base and the need for thorough debugging and integration with diverse hardware and software. Apollo's focus on Module Integration and Interaction (MII) patterns also highlights the complexity of maintaining compatibility across its components.
}
\end{finding}
\vspace{-1ex}

