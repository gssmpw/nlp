% This must be in the first 5 lines to tell arXiv to use pdfLaTeX, which is strongly recommended.
\pdfoutput=1
% In particular, the hyperref package requires pdfLaTeX in order to break URLs across lines.

\documentclass[11pt]{article}

% Change "review" to "final" to generate the final (sometimes called camera-ready) version.
% Change to "preprint" to generate a non-anonymous version with page numbers.
\usepackage[final]{acl}

% Standard package includes
\usepackage{times}
\usepackage{latexsym}

% For proper rendering and hyphenation of words containing Latin characters (including in bib files)
\usepackage[T1]{fontenc}
% For Vietnamese characters
% \usepackage[T5]{fontenc}
% See https://www.latex-project.org/help/documentation/encguide.pdf for other character sets

% This assumes your files are encoded as UTF8
\usepackage[utf8]{inputenc}

% This is not strictly necessary, and may be commented out,
% but it will improve the layout of the manuscript,
% and will typically save some space.
\usepackage{microtype}

% This is also not strictly necessary, and may be commented out.
% However, it will improve the aesthetics of text in
% the typewriter font.
\usepackage{inconsolata}

%Including images in your LaTeX document requires adding
%additional package(s)
\usepackage{graphicx}

% If the title and author information does not fit in the area allocated, uncomment the following
%
%\setlength\titlebox{<dim>}
%
% and set <dim> to something 5cm or larger.

\usepackage{multirow}
\usepackage{caption}
\usepackage{tikz}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{amsthm}
\newcommand{\system}{{\sf CoT}\xspace}
\newcommand{\nostart}{NoStart}
\newcommand{\coldstart}{ColdStart}
\newcommand{\warmstart}{WarmStart}
\newcommand{\hierarchical}{Hierarchical}
\definecolor{cvprblue}{rgb}{0.21,0.49,0.74}
\usepackage{subfiles}
\usepackage{subcaption}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\usetikzlibrary{calc}
\usetikzlibrary{fit}
\usetikzlibrary{patterns}
\usetikzlibrary{decorations.pathreplacing}
% \usepackage{fourier}
\usetikzlibrary{arrows,calc,arrows.meta}
\usepackage{diagbox}
\usepackage{multirow}
\usepackage{makecell}
\usepackage{xurl}
\usepackage[most]{tcolorbox}
\usepackage{xcolor}
\usepackage{lipsum}
\usepackage{hhline}

\definecolor{GPT4ocolor}{HTML}{636efa}
\definecolor{qwencolor}{HTML}{EF553B}
\definecolor{llamacolor}{HTML}{00CC96}
\definecolor{llavacolor}{HTML}{6D6D6D}
\definecolor{midlavacolor}{HTML}{6439FF}
\definecolor{vilacolor}{HTML}{FCCD2A}
\definecolor{openflamingocolor}{HTML}{117554}
\definecolor{minigpt4color}{HTML}{0D92F4}
\definecolor{mistralcolor}{HTML}{77CDFF}
\definecolor{bunnycolor}{HTML}{C62E2E}

\definecolor{NoOptColor}{HTML}{264653}
\definecolor{RandomColor}{HTML}{f4a261}
\definecolor{GreedyColor}{HTML}{7081ff}
\definecolor{BlueColor}{HTML}{0081a7}

\usepackage[capitalize,noabbrev]{cleveref}

%\usepackage[pagebackref,breaklinks,colorlinks,allcolors=cvprblue]{hyperref}
\title{\textsc{Cache-of-Thought}: Master-Apprentice Framework for Cost-Effective Vision Language Model Inference}

% Author information can be set in various styles:
% For several authors from the same institution:
% \author{Author 1 \and ... \and Author n \\
%         Address line \\ ... \\ Address line}
% if the names do not fit well on one line use
%         Author 1 \\ {\bf Author 2} \\ ... \\ {\bf Author n} \\
% For authors from different institutions:
% \author{Author 1 \\ Address line \\  ... \\ Address line
%         \And  ... \And
%         Author n \\ Address line \\ ... \\ Address line}
% To start a separate ``row'' of authors use \AND, as in
% \author{Author 1 \\ Address line \\  ... \\ Address line
%         \AND
%         Author 2 \\ Address line \\ ... \\ Address line \And
%         Author 3 \\ Address line \\ ... \\ Address line}

\author{%
 Mingyuan Wu$^{1}$\thanks{~Mingyuan, Jize, and Haozhen contributed equally, while Minjia, Chengxiang, and Klara advised equally.}, Jize Jiang$^{1*}$,  Haozhen Zheng$^{1*}$, \\  
 \bf Meitang Li$^{2}$, Zhaoheng Li$^{1}$, Beitong Tian$^{1}$, Bo Chen$^{1}$, \\
 \bf  Yongjoo Park$^{1}$, Minjia Zhang$^{1}$, Chengxiang Zhai$^{1}$, Klara Nahrstedt$^{1}$\\
$^{1}$University of Illinois Urbana Champaign\\
$^{2}$University of Michigan Ann Arbor \\
\texttt{\{mw34, jizej2, haozhen3, klara\}@cs.illinois.edu}  \\
}

%\author{
%  \textbf{First Author\textsuperscript{1}},
%  \textbf{Second Author\textsuperscript{1,2}},
%  \textbf{Third T. Author\textsuperscript{1}},
%  \textbf{Fourth Author\textsuperscript{1}},
%\\
%  \textbf{Fifth Author\textsuperscript{1,2}},
%  \textbf{Sixth Author\textsuperscript{1}},
%  \textbf{Seventh Author\textsuperscript{1}},
%  \textbf{Eighth Author \textsuperscript{1,2,3,4}},
%\\
%  \textbf{Ninth Author\textsuperscript{1}},
%  \textbf{Tenth Author\textsuperscript{1}},
%  \textbf{Eleventh E. Author\textsuperscript{1,2,3,4,5}},
%  \textbf{Twelfth Author\textsuperscript{1}},
%\\
%  \textbf{Thirteenth Author\textsuperscript{3}},
%  \textbf{Fourteenth F. Author\textsuperscript{2,4}},
%  \textbf{Fifteenth Author\textsuperscript{1}},
%  \textbf{Sixteenth Author\textsuperscript{1}},
%\\
%  \textbf{Seventeenth S. Author\textsuperscript{4,5}},
%  \textbf{Eighteenth Author\textsuperscript{3,4}},
%  \textbf{Nineteenth N. Author\textsuperscript{2,5}},
%  \textbf{Twentieth Author\textsuperscript{1}}
%\\
%\\
%  \textsuperscript{1}Affiliation 1,
%  \textsuperscript{2}Affiliation 2,
%  \textsuperscript{3}Affiliation 3,
%  \textsuperscript{4}Affiliation 4,
%  \textsuperscript{5}Affiliation 5
%\\
%  \small{
%    \textbf{Correspondence:} \href{mailto:email@domain}{email@domain}
%  }
%}
\NewDocumentCommand{\cheng}{ mO{} }{\textcolor{purple}{\textsuperscript{\textit{Cheng}}\textsf{\textbf{\small[#1]}}}}

\begin{document}
\maketitle
\begin{abstract}
Vision Language Models (VLMs) have achieved remarkable success in a wide range of vision applications of increasing complexity and scales, yet choosing the right VLM model size involves a trade-off between response quality and cost. While smaller VLMs are cheaper to run, they typically produce responses only marginally better than random guessing on benchmarks such as MMMU. 

In this paper, we propose \textit{Cache of Thought (CoT)}, a masterâ€“apprentice framework for collaborative inference between large and small VLMs. CoT manages high-quality query results from large VLMs (\textit{master}) in a cache, which are then selected via a novel multi-modal retrieval and in-context learning to aid the performance of small VLMs (\textit{apprentice}). We extensively evaluate CoT on various widely-recognized and challenging general VQA benchmarks, and show that CoT increases overall VQA performance by up to 7.7\% under the same budget, and specifically boosts the performance of apprentice VLMs by up to 36.6\%.


\end{abstract}
\input{sec/1_intro}
\input{sec/2_related}
\input{sec/25_framework}
\input{sec/3_method}
\input{sec/4_experiment}


% Bibliography entries for the entire Anthology, followed by custom entries
%\bibliography{anthology,custom}
% Custom bibliography entries only
\bibliography{custom}
\newpage
\appendix
\onecolumn
\section{Example Appendix}
\label{sec:appendix}
\begin{tcolorbox}[
    colback=red!5!white,
    colframe=red!75!black,
    title={\textbf{Open-Flamingo Prompts}},
    fonttitle=\bfseries
]

\textbf{MMMU In-context Learning Prompt:}\\
{\color{blue}\textnormal{\texttt{\color{teal}<image>} \texttt{\color{blue} <shot-1>} \texttt{\color{teal}<|endofchunk|>} ... 
\texttt{\color{teal}<image>} \texttt{\color{blue} <shot-n>} \texttt{\color{teal}<|endofchunk|> \texttt{\color{blue}<question>}} 
\texttt{\color{teal}<image>}}}
The options are the following: {\color{blue} \textnormal{\texttt{<option>}}}
There is only one option possible. The answer is

\bigskip

\textbf{MMMU N-shot Cache Sample:}\\
{\color{red} Human:} \textnormal{\texttt{\color{blue}<question>} The options are the following: \texttt{\color{blue}<option>}}.
Please include your reasoning steps, then answer your choice in this format:
ANSWER: LETTER CHOICE.
The letter choice is strictly in alphabetical order, and there is only one option possible.

{\color{blue} Assistant:} \textnormal{\texttt{\color{blue}<gpt4-o response>}}

\bigskip

\textbf{MMMU Auxiliary VLM Prompt for Response:} \\
{\color{blue} \textnormal{\texttt{\color{teal}<image>} \texttt{<question>}}}
The options are the following: {\color{blue} \textnormal{\texttt{<option>}}}
There is only one option possible. The answer is

\bigskip

\textbf{CLEVR In-context Learning Prompt:}\\
{\color{blue} \textnormal{\texttt{\color{teal}<image>} \texttt{<shot-1>} \texttt{\color{teal}<|endofchunk|>} ... 
\texttt{\color{teal}<image>} \texttt{<shot-n>} \texttt{\color{teal}<|endofchunk|>} 
\texttt{\color{teal}<image>}}}
How many {\color{blue} \textnormal{\texttt{<question>}}} objects? The answer is



\bigskip

\textbf{CLEVR N-shot Cache Sample:}\\
{\color{red} Human:} How many objects in the image have the
{\color{blue} \textnormal{\texttt{<question>}}}?
Please include your reasoning steps, then answer your choice in this format:
ANSWER: NUMBER.

{\color{blue} Assistant:} \textnormal{\color{blue}\texttt{<gpt4-o response>}}

\bigskip

\textbf{CLEVR Auxiliary VLM Prompt for Response:}\\
{\color{teal} \textnormal{\texttt{<image>}}} How many {\color{blue} \textnormal{\texttt{<question>}}} objects?
The answer is

\bigskip

\textbf{TextOCR In-context Learning Prompt:}\\
{\color{blue} \textnormal{\texttt{\color{teal}<image>} \texttt{<shot-1>} \texttt{\color{teal}<|endofchunk|>} ...
\texttt{\color{teal}<image>} \texttt{<shot-n>} \texttt{\color{teal}<|endofchunk|>} 
\texttt{\color{teal}<image>}}}
What text is shown in the red box? Only answer with the largest text. The answer is

\bigskip

\textbf{TextOCR N-shot Cache Sample:}\\
{\color{red} Human:} What text is shown in the red box?
Only answer with the largest text. Please include your reasoning steps, then answer your choice in this format:
ANSWER: TEXT.

{\color{blue} Assistant:} \textnormal{\color{blue}\texttt{<gpt4-o response>}}

\bigskip

\textbf{TextOCR Auxiliary VLM Prompt for Response:}\\
{\color{blue} \textnormal{\texttt{\color{teal}<image>}}} What text is shown in the red box?
Only answer with the largest text. The answer is

\bigskip



\end{tcolorbox}

\begin{tcolorbox}[
    breakable,
    colback=red!5!white,
    colframe=red!75!black,
    title={\textbf{Qwen Prompts}},
    fonttitle=\bfseries
]

\textbf{MMMU In-context Learning Prompt:}\\
This is a chat between a curious human and an artificial intelligence assistant. The assistant gives helpful, detailed, and polite answers to the human's questions. If a question does not make any sense, or is not factually coherent, explain why instead of answering something not correct. If you don't know the answer to a question, please don't share false information. The assistant will have one similar in-context example provided by another powerful assistant:

\texttt{\color{blue}<shot-1>...<shot-n>}

Now you should answer the following question given the image below and you can use GPT4 Assistant's case for reference:\\
{\color{red} Human:} \\
 \texttt{\color{blue}<question> <option>} Please include your reasoning steps, then answer your choice in this format: ANSWER: \texttt{<LETTER CHOICE>}. The letter choice is strictly in the alphabetical order, and there is only one option possible.\\
{\color{blue} Assistant(you):}

\bigskip
\textbf{MMMU N-shot Cache Sample:}\\
{\color{red}Human:} \texttt{\color{blue}<question> <option>} Please include your reasoning steps, then answer your choice in this format: ANSWER: \texttt{<LETTER CHOICE>}. The letter choice is strictly in the alphabetical order, and there is only one option possible.\\
{\color{blue}Assistant:} \texttt{\color{blue}<gpt4-o response>}

\bigskip
\textbf{MMMU Auxiliary VLM Prompt for Response:} \\
Now you should answer the following question:\\
{\color{red} Human:} \\
\texttt{\color{blue}<question> <option>} Please include your reasoning steps, then answer your choice in this format: ANSWER: \texttt{<LETTER CHOICE>}. The letter choice is strictly in the alphabetical order, and there is only one option possible.\\
{\color{blue} Assistant(you):}
\end{tcolorbox}

\begin{tcolorbox}[
    breakable,
    colback=red!5!white,
    colframe=red!75!black,
    title={\textbf{Llama Auxiliary Keyword Extractor Prompts}},
    fonttitle=\bfseries
]
\textbf{\textcolor{black}{MMMU Prompt}}\\
You are a helpful chatbot that assists users in generating keywords from conversations. You have been given a piece of text and need to generate keywords from it. Please give me 10 keywords that are present in this question-option context and separate them with commas. Make sure you to only return the keywords and say nothing else. Make sure to exclude the words "question" and "options" as keywords I have the following multiple choice question and its options: \texttt{\color{blue}<query>}

\bigskip
\textbf{\textcolor{black}{CLEVR and TextOCR Prompt}}\\
You are a helpful chatbot that assists users in generating keywords from conversations. You have been given a piece of text and need to generate keywords from it. 
Please give me 10 keywords that are present in this context and separate them with commas.
Make sure you to only return the keywords and say nothing else.
Make sure to exclude the word "ANSWER" as keywords
I have the following contexts: \texttt{\color{blue}<query>}

\end{tcolorbox}

\begin{tcolorbox}[
    breakable,
    colback=red!5!white,
    colframe=red!75!black,
    title={\textbf{GPT4-o Prompts}},
    fonttitle=\bfseries
]
\textbf{\textcolor{black}{MMMU Prompt}}\\
\textnormal{\texttt{\color{blue}<question>} The options are the following: \texttt{\color{blue}<option>}}.
Please include your reasoning steps, then answer your choice in this format:
ANSWER: \texttt{<LETTER CHOICE>}.
The letter choice is strictly in alphabetical order, and there is only one option possible.

\bigskip
\textbf{\textcolor{black}{CLEVR Prompt}}\\
How many objects in the image have the {\color{blue} \textnormal{\texttt{<question>}}} Please include your reasoning steps, then answer your choice in this format: ANSWER: \texttt{<NUMBER>}.

\bigskip
\textbf{\textcolor{black}{TextOCR Prompt}}\\
What text is shown in the red box? Only answer with the largest text. Please include your reasoning steps, then answer your choice in this format: ANSWER: \texttt{<TEXT>}.
\end{tcolorbox}

\end{document}
