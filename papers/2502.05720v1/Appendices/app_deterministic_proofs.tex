
\section{Proofs of Section {\ref{sec: deterministic predictions}}}\label{app:sec2}



We present in this appendix the proofs of the results stated in Section \ref{sec: deterministic predictions}. Let us introduce some notations and observations that we will use throughout the proofs.
For all $n \geq 1$, we denote by $(\prices^n_i)_{i=1}^n$ the sequence of prices defined by
\[
\forall i \in [n]: \quad \prices^n_i = 1 + \frac{\ub-1}{n-1}(i-1)\;,
\]
and for all $q \in [1,\ub]$, we denote by $\instance(q)$ the sequence of prices that are equal to $\prices^n_i$ while the latter is smaller than $q$ then drops to $1$. Formally, the $i^{\text{th}}$ price in this sequence is
\begin{equation}\label{eq:worst-case-instance}
\instance(q)_i = 1 + (\prices^n_i -1) \indic_{\prices^n_i \leq q}\;.    
\end{equation}

On the class of instances $\{\instance(\qmax)\}_{\qmax \in [1,\ub]}$,  any deterministic learning-augmented algorithm for \OMS{} is equivalent to a single-threshold algorithm $\A_\thresh$. 
Moreover, observe that the payoff of $\A_{\thresh}$ satisfies
\begin{equation}\label{eq:worst-case-payoff}
\A_{\thresh}(\instance(\qmax),y) =
\left\{
\begin{array}{ll}
    1 & \mbox{ if } \thresh(y) > \qmax\\
    \thresh(\pred) + O(\tfrac{1}{n}) & \mbox{ otherwise}
\end{array}
\right.\,.
\end{equation}
Indeed, if the threshold exceeds the maximum price $\qmax$ in the sequence, then no price is selected and the algorithm is left with a payoff of $1$. On the hand, if the threshold is at most $\qmax$, then the selected price is $\min \{\prices^n_i  \mid \prices^n_i \geq \thresh(\pred)\}$. By definition of the prices $\prices^n_i$, this value is in $[\thresh(\pred), \thresh(\pred) + \tfrac{\ub-1}{n-1}]$.
In particular, for $n$ arbitrarily large, the payoff of an algorithm with threshold $\thresh(\pred) \leq q$ is arbitrarily close $\thresh(\pred)$. This observation will be useful in our proofs.

\subsection{The class of all Pareto-optimal thresholds}
\AllParetoOptimalThresholds*

\begin{proof}
Let $\thresh : [1,\ub] \to [1,\ub]$, and consider that $\A_\thresh$ is $\rob$-robust and $1/\rob \ub$-consistent. We will prove that $\thresh$ is necessarily in the set $\SPO$.
\paragraph{First inclusion.} Let us first prove that $\thresh(z) \in [\rob\ub, 1/\rob]$ for all $z \in [1,\ub]$.
Let $z \in [1,\ub]$, and consider the sequence of prices $\instance(\qmax)$. Since $\A_\thresh$ is $\rob$-robust, then by Eq.~\eqref{eq:worst-case-payoff}, it holds for $\qmax = \thresh(z)-\tfrac{1}{n}$ and $\pred = z$ that
\[
\rob \leq \frac{\A_\thresh(\instance(\qmax),z)}{\qmax} = \frac{1}{\qmax} = \frac{1}{\thresh(z)-\tfrac{1}{n}}\;.
\]
On the other hand, for $\qmax = \ub$, we obtain again using Eq.~\eqref{eq:worst-case-payoff} that
\[
\rob \leq \frac{\A_\thresh(\instance(\qmax),z)}{\qmax} = \frac{\thresh(z) + O(\tfrac{1}{n})}{\ub}\;.
\]
We deduce that $\thresh(z)$ satisfies $\thresh(z) \in [\rob \ub - O(\tfrac{1}{n}), 1/\rob + \tfrac{1}{n}]$, and taking the limit for $n\to \infty$ gives that $\thresh(z) \in [\rob \ub, 1/\rob]$.

Consider now $z \in (\rob \ub, \ub]$, and let us prove that $\thresh(z) \in [\frac{z}{\rob \ub}, z]$. We first prove by contradiction that $\thresh(z) \leq z$. Suppose this is not the case, i.e. $\thresh(z) > z$ then using Equation \eqref{eq:worst-case-payoff} and that the algorithm is $1/\rob \ub$-consistent, considering that the maximum price is $z$ and the prediction is perfect, we deduce that
\[
\frac{1}{\rob \ub} \leq \frac{\A_\thresh(\instance(z),z)}{z} = \frac{1}{z}\;,
\]
hence $z \leq \rob \ub$, which contradicts the initial assumption that $z \in (\rob \ub, \ub]$. Therefore, $\thresh(z) \leq z$  for all $z \in (\rob \ub, \ub]$. Using this inequality, it follows again by Eq.~\eqref{eq:worst-case-payoff} and $1/\rob$-consistency of the algorithm that
\[
\frac{1}{\rob \ub} \leq \frac{\A_\thresh(\instance(z),z)}{z} = \frac{\thresh(z)}{z}\;,.
\]
Consequently, $\thresh(z) \in [\frac{z}{\rob \ub}, z]$ for all $z \in (\rob \ub, \ub]$. This proves that the set of all thresholds yielding Pareto-optimal levels of robustness and consistency $(\rob, 1/\rob\ub)$ is included in the set $\SPO$.

\paragraph{Second inclusion.} 
The other inclusion is easier to prove. Let $\thresh \in \SPO$, and let us prove that $\A_\thresh$ is $\rob$-robust and $1/\rob \ub$-consistent. Consider an arbitrary sequence of prices $\prices = (\prices_i)_{i=1}^n \in [1,\ub]$ and a prediction $\pred \in [1,\ub]$, and let us denote by $\price$ the maximum price in the sequence $\prices$.

The robustness of $\A_\thresh$ follows from the bounding $\thresh(\pred) \in [\rob\ub, 1/\rob]$. Indeed, we obtain using Eq.~\eqref{eq:worst-case-payoff} that
\begin{itemize}
    \item if $\price < \thresh(\pred)$ then 
    $\frac{\A_\thresh(\prices, \pred)}{\price} = \frac{1}{\price} \geq \frac{1}{\thresh(\pred)} \geq \rob$,
    \item if $\price \geq \thresh(\pred)$ then 
    $\frac{\A_\thresh(\prices, \pred)}{\price} = \frac{\thresh(\pred)}{\price} \geq \frac{\thresh(\pred)}{\ub} \geq \rob$\;,
\end{itemize}
which proves that $\A_\thresh$ is $\rob$-robust. Now the consistency of the algorithm follows from the bounding $\thresh(z) \in [\frac{z}{\rob \ub}, z]$ for all $z \in (\rob \ub, \ub]$. Indeed, assume that the prediction is perfect, i.e. $\pred = \price$, then we have the following:
\begin{itemize}
    \item if $\price \leq \rob \ub$ then $\frac{\A_\thresh(\prices, \price)}{\price} = \frac{1}{\price} \geq \frac{1}{\rob \ub}$,
    \item if $\price > \rob \ub$ then we have that $\thresh(\price) \leq \price$, hence $\frac{\A_\thresh(\prices, \price)}{\price} = \frac{\thresh(\price)}{\price} \geq \frac{1}{\rob \ub}$.
\end{itemize}
This proves $\A_\thresh$ is $1/\rob \ub$-consistent, which concludes the proof.
\end{proof}


\subsection{Smoothness analysis of \texorpdfstring{$\A^\rho_\rob$}{A}}


\begin{lemma}\label{lem:max(az+b)/z}
Let $a >0$, $b \in \mathbb{R}$, and $u<v \in (0,\infty)$ satisfying that $z \mapsto az+b \geq 0$ on the interval [u,v], then it holds for all $\ell \in \mathbb{R}$ that
\[
\max_{z \in [u,v]} \frac{(az+b)^{\ell+1}}{z^\ell} 
= \max \left\{ \frac{(au+b)^{\ell+1}}{u^\ell}, \frac{(av+b)^{\ell+1}}{v^\ell} \right\}\;.
\]
\end{lemma}

\begin{proof}
For all $z \in [u,v]$, we can write that
\[
\frac{(az+b)^{\ell+1}}{z^\ell} 
= \left( \frac{az+b}{z^{\ell/(\ell+1)}}  \right)^{\ell + 1}
= \left( a z^{1/(\ell+1)} + b z^{-\ell/(\ell+1)} \right)^{\ell+1}
\]
hence, computing the derivative gives
\begin{align*}
\frac{d}{dz} \left[ \frac{(az+b)^{\ell+1}}{z^\ell} \right]
&= \frac{d}{dz} \left[ \left( a z^{1/(\ell+1)} + b z^{-\ell/(\ell+1)} \right)^{\ell+1}\right]\\
&= (\ell+1) \left( \frac{a}{\ell+1} z^{-\ell/(\ell+1)} - \frac{b\ell}{\ell+1} z^{-\ell/(\ell+1) - 1} \right) \left( a z^{1/(\ell+1)} + b z^{-\ell/(\ell+1)} \right)^{\ell}\\
&= a z^{-\ell/(\ell+1)-1} \left( z - \frac{b\ell}{a}  \right) \left( a z^{1/(\ell+1)} + b z^{-\ell/(\ell+1)} \right)^{\ell}\;.
\end{align*}
The monotonicity of $z \mapsto \frac{(az+b)^{\ell+1}}{z^\ell}$ on the interval $[u,v]$ is therefore determined by the sign of $z-\frac{b\ell}{a}$. Indeed, $az^{-\ell/(\ell+1)-1} \geq 0$ because $a \geq 0$ and $z \geq u > 0$, and the term $\left( a z^{1/(\ell+1)} + b z^{-\ell/(\ell+1)} \right)^{\ell}$ is also non-negative because we can write that
\[
\left( a z^{1/(\ell+1)} + b z^{-\ell/(\ell+1)} \right)^{\ell}
= \left[ \left( a z^{1/(\ell+1)} + b z^{-\ell/(\ell+1)} \right)^{\ell+1} \right]^{\frac{\ell}{\ell+1}}
= \left[ \frac{(az+b)^{\ell+1}}{z^\ell}\right]^{\frac{\ell}{\ell+1}}\;,
\]
and both $z$ and $az+b$ are positive on the interval $[u,v]$.

Consequently, depending on how $\frac{b\ell}{a}$ compares to the bounds $u,v$ of the interval, the mapping $z \mapsto \frac{(az+b)^{\ell+1}}{z^\ell}$ can be either decreasing, increasing, or decreasing then increasing. In the three cases, its maximum is reached in one of the interval limits $u$ or $v$, thus
\[
\max_{z \in [u,v]} \frac{(az+b)^{\ell+1}}{z^\ell} 
= \max \left\{ \frac{(au+b)^{\ell+1}}{u^\ell}, \frac{(av+b)^{\ell+1}}{v^\ell} \right\}\;.
\]
\end{proof}




\begin{corollary}\label{cor:max-thresh/z<rub}
For all $\rho \in (0,1]$, for $\smth = \frac{1}{\rho}\left( \frac{\ln \ub}{\ln (\rob \ub)} - 2 \right)$ it holds that
\[
\max_{z \in [\frac{1}{\rob}, \frac{1}{\rob}+\rho(\ub-\frac{1}{\rob})]} \frac{\thresh^\rho_\rob(z)^{\smth+1}}{z^{\smth}} \leq \rob \ub\;.
\]
\end{corollary}


\begin{proof}
By definition of the threshold $\thresh^\rho_\rob$, we have for $z \in [\frac{1}{\rob}, \frac{1}{\rob}+\rho(\ub-\frac{1}{\rob})]$ \[ \thresh^\rho_\rob(z) = \varphi_\rob(z) + \frac{\frac{1}{\rob} - \varphi_\rob(z)}{\rho(\ub-\frac{1}{\rob})}\left(z-\frac{1}{\rob}\right)\;, \]
which can be written as $az+b$ with $a = \frac{1/\rob - \varphi_\rob(z)}{\rho(\ub-1/\rob)} \geq 0$ because $\varphi_\rob(z) < 1/\rob$ for all $z \leq \ub$. Consequently, Lemma \ref{lem:max(az+b)/z} gives that
\begin{align}
\max_{z \in [\frac{1}{\rob}, \frac{1}{\rob}+\rho(\ub-\frac{1}{\rob})]} \frac{\thresh^\rho_\rob(z)^{\smth+1}}{z^{\smth}} 
&= \max\left\{ \frac{\thresh^\rho_\rob(1/\rob)^{\smth+1}}{1/\rob^{\smth}}, \frac{\thresh^\rho_\rob(\frac{1}{\rob}+\rho(\ub-\frac{1}{\rob}))^{\smth+1}}{(\frac{1}{\rob}+\rho(\ub-\frac{1}{\rob}))^{\smth}} \right\} \nonumber \\
&= \max\left\{ \frac{\varphi_\rob(1/\rob)^{\smth+1}}{1/\rob^{\smth}}, \frac{1/\rob^{\smth+1}}{(\frac{1}{\rob}+\rho(\ub-\frac{1}{\rob}))^{\smth}} \right\}\;. \label{aligneq:max2terms}
\end{align}
We will now prove that both terms in the maximum are at most equal to $\rob \ub$.

For all $h \in \mathbb{R}$, we have the equivalences
\begin{align*}
\frac{1/\rob^{h+1}}{(\frac{1}{\rob}+\rho(\ub-\frac{1}{\rob}))^{h}} \leq \rob \ub
&\iff \frac{1}{(1+\rho(\rob \ub - 1))^h} \leq \rob^2\ub\\
&\iff -h \ln\big(1+\rho(\rob \ub - 1)\big) \leq \ln (\rob^2 \ub) = - \big(\ln\ub - 2 \ln(\rob\ub) \big)\\
&\iff h \geq \frac{\ln\ub - 2\ln(\rob\ub)}{\ln\big(1+\rho(\rob \ub - 1)\big)}\;.
\end{align*}
Moreover, we have by concavity of $x \mapsto \ln x$ that
\[
\ln\big(1+\rho(\rob \ub - 1)\big)
= \ln\big(\rho\rob\ub + (1-\rho)\big) \geq \rho \ln(\rob \ub) + (1-\rho) \ln 1 = \rho \ln (\rob \ub)\;,
\]
therefore, $\smth = \frac{1}{\rho}\left( \frac{\ln \ub}{\ln(\rob \ub)}-2\right)$ satisfies 
\[
\smth 
= \frac{1}{\rho}\left( \frac{\ln \ub}{\ln(\rob \ub)}-2\right)
=  \frac{\ln \ub - 2 \ln(\rob\ub)}{\rho\ln(\rob \ub)}
\geq \frac{\ln\ub - 2\ln(\rob\ub)}{\ln\big(1+\rho(\rob \ub - 1)\big)}\;,
\]
and we deduce with the previous equivalences that 
\begin{equation}\label{eq:max2terms_term1}
\frac{1/\rob^{\smth+1}}{\left(\frac{1}{\rob}+\rho(\ub-\frac{1}{\rob})\right)^{\smth}} \leq \rob \ub\;. 
\end{equation}


Let us now prove that $\frac{\varphi_\rob(1/\rob)^{\smth+1}}{1/\rob^{\smth}} \leq \rob \ub$.
Since $\varphi_\rob$ is a linear mapping with a positive slope, using that $1/\rob \in [\rob \ub, \ub]$ and Lemma \ref{lem:max(az+b)/z}, we obtain that
\begin{align*}
\frac{\varphi_\rob(1/\rob)^{\smth+1}}{1/\rob^{\smth}}
&\leq \max_{z \in [\rob \ub, \ub]} \frac{\varphi_\rob(z)^{\smth+1}}{z^{\smth}}\\
&= \max \left\{ \frac{\varphi_\rob(\rob\ub)^{\smth+1}}{(\rob\ub)^{\smth}}, \frac{\varphi_\rob(\ub)^{\smth+1}}{\ub^{\smth}} \right\}\\
&= \max \left\{ \frac{(\rob\ub)^{\smth+1}}{(\rob\ub)^{\smth}}, \frac{(1/\rob)^{\smth+1}}{\ub^{\smth}} \right\}\\
&= \max \left\{ \rob \ub, \frac{\ub}{(\rob\ub)^{\smth+1}} \right\}\;.
\end{align*}
Observing that $k = \rho \smth = \frac{\ln \ub}{\ln \rob \ub}-2$ is the solution of $\frac{\ub}{(\rob\ub)^{k+1}} = \rob \ub$, and given that $k \leq s$ and $\rho \leq 1$, we have that
\[
\frac{\ub}{(\rob\ub)^{\smth+1}}
\leq \frac{\ub}{(\rob\ub)^{k+1}}
= \rob \ub\;,
\]
hence 
\begin{equation}\label{eq:max2terms_term2}
\frac{\varphi_\rob(1/\rob)^{\smth+1}}{1/\rob^{\smth}} 
\leq \frac{\varphi_\rob(1/\rob)^{k+1}}{1/\rob^{k}}
= \max \left\{ \rob \ub, \frac{\ub}{(\rob\ub)^{k+1}} \right\}
= \rob \ub\;.
\end{equation}

Finally, using Equations \eqref{aligneq:max2terms}, \eqref{eq:max2terms_term1}, and \eqref{eq:max2terms_term2}, we deduce that
\[
\max_{z \in [\frac{1}{\rob}, \frac{1}{\rob}+\rho(\ub-\frac{1}{\rob})]} \frac{\thresh^\rho_\rob(z)^{\smth+1}}{z^{\smth}} \leq \rob \ub \;,
\]
which concludes the proof.
\end{proof}





%\ConsistencyRobustnessSmoothnessComplex*


%\subsubsection*{Proof of Theorem \ref{thm: [deterministic Pareto-Optimal smooth Algorithm] consistency-robustness-smoothness complex}}

\ConsistencyRobustnessSmoothnessComplex*

\begin{proof}
Consider $\rob \in [\ub^{-1}, \ub^{-1/2}]$, an instance $\prices = (\prices_i)_{i=1}^n$, a prediction $\pred$ of $\price$, and let $\error = \min(\frac{\pred}{\price}, \frac{\price}{\pred})$. We will prove the smoothness guarantee separately on the intervals $[1,\rob \ub)$, $[\rob \ub,1/\rob]$, $[1/\rob, 1/\rob + \rho(\ub - 1/\rob)]$, and $[1/\rob + \rho(\ub - 1/\rob), \ub]$. To lighten the notation, we simply write $\smth$ for $\max\big(1,\frac{1}{\rho}(\frac{\ln \ub}{\ln (\rob \ub)}-2)\big)$ instead of $\smth_\rho$.

\paragraph{Case 1.} If $\pred \in [1,\rob \ub)$, then $\thresh^\rho_\rob(\pred) = \rob \ub$. If $\price < \rob \ub$ then
\[
\frac{\A^\rho_\rob(p,y)}{\price}
\geq \frac{1}{\price}
\geq \frac{1}{\rob \ub}
\geq \frac{1}{\rob \ub} \error^\smth\;,
\]
and if $\price \geq \rob \ub$ then the payoff of the algorithm is at least equal to the threshold $\rob \ub$, hence
\[
\frac{\A^\rho_\rob(p,y)}{\price}
\geq \frac{\thresh^\rho_\rob(\pred)}{\price} = \frac{\rob \ub}{\price}
\geq \frac{\pred}{\price}
\geq \frac{1}{\rob \ub} \error
\geq \frac{1}{\rob \ub} \error^\smth
\;.
\]
We used in the last two inequalities that $\frac{\pred}{\price} \geq \error$, $\rob \ub \geq 1$ and $\smth \geq 1$.


\paragraph{Case 2.} Consider now the case of $\pred \in [\rob \ub, 1/\rob]$, then 
$\thresh^\rho_\rob(\pred) = \varphi_\rob(\pred) = \frac{\rob \ub - 1}{1-\rob} + \frac{1-\rob^2 \ub}{1-\rob}\cdot \frac{\pred}{\rob \ub}$.
If $\price \geq \thresh^\rho_\rob(\pred)$ then the payoff of the algorithm is at least equal to the threshold. Using that $\frac{\pred}{\price} \geq \error$, $1 \geq \error$ and $\price \leq \ub$, we obtain
\begin{align}
\frac{\A^\rho_\rob(p,y)}{\price}
&\geq \frac{\thresh^\rho_\rob(\pred)}{\price}
= \frac{\varphi_\rob(\pred)}{\price} \nonumber\\
&= \frac{\rob \ub - 1}{1-\rob}\cdot \frac{1}{\price} + \frac{1-\rob^2 \ub}{1-\rob}\cdot \frac{1}{\rob \ub}\cdot \frac{\pred}{\price}\nonumber\\
&\geq \left( \frac{\rob \ub - 1}{1-\rob}\cdot \frac{1}{\price} + \frac{1-\rob^2 \ub}{1-\rob}\cdot \frac{1}{\rob \ub} \right) \error \nonumber \\
&\geq \left( \frac{\rob \ub - 1}{1-\rob}\cdot \frac{1}{\ub} + \frac{1-\rob^2 \ub}{1-\rob}\cdot \frac{1}{\rob \ub} \right) \error \nonumber\\
&= \frac{1}{\rob \ub (1-\rob)}\left(\rob^2\ub - \rob + 1 - \rob^2\ub \right) \error \nonumber\\
&= \frac{1}{\rob \ub} \error
\geq \frac{1}{\rob \ub} \error^\smth\;. \label{aligneq:case-thresh=varphi-p>thresh}
\end{align}
On the other hand, if $\price < \thresh^1_\rob(\pred)$, recalling that $\thresh^\rho_\rob(z) = \varphi_\rob(z)$ for $z \in [\rob \ub, 1/\rob]$, we can use Inequality \eqref{eq:max2terms_term2} from the proof of Corollary \ref{cor:max-thresh/z<rub}, which gives for $k = \frac{\ln \ub}{\ln (\rob \ub)}-2$ that 
\[
\max_{z \in [\rob \ub, \ub]} \frac{\thresh^\rho_\rob(z)^{k+1}}{z^k} 
= \frac{\varphi_\rob(z)^{k+1}}{z^k} 
= \max \left\{ \rob \ub, \frac{\ub}{(\rob\ub)^{k+1}} \right\}
= \rob \ub\;,
\]
and it follows that
\begin{align*}
\frac{\A^\rho_\rob(\prices,\pred)}{\price}
&\geq \frac{1}{\price}
\geq \frac{1}{\thresh^\rho_\rob(\pred)}\\
&\geq \frac{1}{\thresh^\rho_\rob(\pred)} \cdot \frac{1}{\rob \ub} \cdot \frac{\thresh^\rho_\rob(\pred)^{k+1}}{\pred^k}
= \frac{1}{\rob \ub} \left( \frac{\thresh^\rho_\rob(\pred)}{\pred} \right)^k\\
&\geq \frac{1}{\rob \ub} \left( \frac{\price}{\pred}\right)^k
\geq \frac{1}{\rob \ub} \error^k
\geq \frac{1}{\rob \ub} \error^\smth\;,
\end{align*}
where we used in the last inequality that $\error \leq 1$ and $k \leq \frac{k}{\rho} \leq \max(1,\frac{k}{\rho}) = \smth$.

\paragraph{Case 3.} For $\pred \in [1/\rob, 1/\rob + \rho(\ub-1/\rob)]$, if $\price \geq \thresh^\rho_\rob(\pred)$, then observing that $\thresh^\rho_\rob(\pred) \geq \varphi_\rob(\pred)$, we obtain with the same computation as Eq.~\eqref{aligneq:case-thresh=varphi-p>thresh} that
\[
\frac{\A^\rho_\rob}{\price} 
\geq \frac{\thresh^\rho_\rob(\pred)}{\price}
\geq \frac{\varphi_\rob(\pred)}{\price}
\geq \frac{1}{\rob \ub} \error^\smth\;.
\]
On the other hand, if $\price < \thresh^\rho_\rob(\pred)$, then by Corollary \ref{cor:max-thresh/z<rub}, we have for $k = \frac{\ln\ub}{\ln(\rob \ub)}-2$ that 
\[
\max_{z \in [\frac{1}{\rob}, \frac{1}{\rob}+\rho(\ub-\frac{1}{\rob})]} \frac{\thresh^\rho_\rob(z)^{\frac{k}{\rho}+1}}{z^{\frac{k}{\rho}}} \leq \rob \ub\;,
\]
therefore, the ratio between the algorithm's payoff and the maximum payoff can be lower bounded as follows
\begin{align*}
\frac{\A^\rho_\rob(\prices,\pred)}{\price}
&\geq \frac{1}{\price}
\geq \frac{1}{\thresh^\rho_\rob(\pred)}\\
&\geq \frac{1}{\thresh^\rho_\rob(\pred)} \cdot \frac{1}{\rob \ub} \cdot \frac{\thresh^\rho_\rob(\pred)^{\frac{k}{\rho}+1}}{\pred^{\frac{k}{\rho}}}
= \frac{1}{\rob \ub} \left( \frac{\thresh^\rho_\rob(\pred)}{\pred} \right)^k\\
&\geq \frac{1}{\rob \ub} \left( \frac{\price}{\pred}\right)^{\frac{k}{\rho}}
\geq \frac{1}{\rob \ub} \error^{\frac{k}{\rho}}
\geq \frac{1}{\rob \ub} \error^\smth\;.
\end{align*}
The last inequality holds because $\frac{k}{\rho} \leq \max(1,{\frac{k}{\rho}}) = \smth$.


\paragraph{Case 4.} Finally, if $y \in (1/\rob + \rho(\ub - 1/\rob), \ub]$, then $\thresh^\rho_\rob(\pred) = 1/\rob$. If $\price \geq 1/\rob$, then we have immediately that
\[
\frac{\A^\rho_\rob(\prices,\pred)}{\prices}
\geq \frac{\thresh^\rho_\rob(\pred)}{\price}
= \frac{1}{\rob \price}
\geq \frac{1}{\rob \ub}
\geq \frac{1}{\rob \ub} \error^\smth\;.
\]

Now if $\price < 1/\pred$, let $k = \frac{\ln\ub}{\ln(\rob \ub)}-2$ and $z_\rho = 1/\rob + \rho(\ub - 1/\rob)$. Observing that $\smth \geq \frac{k}{\rho} \geq k$, and $\pred \geq z_\rho$, and $\rob \pred \geq 1$, we deduce from Corollary \ref{cor:max-thresh/z<rub}
\[
\frac{1}{\rob}\left( \frac{1}{\rob \pred} \right)^\smth
\leq \frac{1}{\rob}\left( \frac{1}{\rob \pred} \right)^{k/\rho}
= \frac{(1/\rob)^{\frac{k}{\rho}+1}}{y^{k/\rho}}
\leq \frac{(1/\rob)^{\frac{k}{\rho}+1}}{z_\rho^{k/\rho}}
= \frac{\thresh(z_\rho)^{\frac{k}{\rho}+1}}{z_\rho^{k/\rho}}
\leq \max_{z \in [\frac{1}{\rob}, z_\rho]} \frac{\thresh^\rho_\rob(z)^{\frac{k}{\rho}+1}}{z^{k/\rho}} 
\leq \rob \ub\;,
\]
which yields for $\price < \thresh^\rho_\rob(\pred) = 1/\rob$ that
\[
\frac{\A^\rho_\rob(\prices,\pred)}{\price} 
\geq \frac{1}{\price}
> \frac{1}{1/\rob}
\geq \frac{1}{\rob \ub} \left( \frac{1}{\rob \pred} \right)^\smth
> \frac{1}{\rob \ub} \left( \frac{\price}{\pred} \right)^\smth
= \frac{1}{\rob \ub} \error^\smth\;.
\]

\paragraph{Conclusion.} 
All in all, for any $\pred \in [1,\theta]$, it holds that
\[
\frac{\A^\rho_\rob(p,y)}{\price}
\geq \frac{1}{\rob \ub} \error^\smth \;,
\]
with $\smth = \max\left(1,\frac{1}{\rho}( \frac{\ln \ub}{\ln(\rob \ub)}-2)\right)$.

Finally, the threshold function $\thresh^\rho_\rob$ is in the class $\SPO$, then we have by Theorem \ref{thm:thresh-pareto-optimal} that $\A^\rho_\rob$ is $\rob$-robust, and it deduce that
\[
\frac{\A^\rho_\rob(p,y)}{\price}
\geq \max\left(\rob, \frac{1}{\rob \ub} \error^{\smth} \right)\;,
\]
which concludes the proof.
  
\end{proof}








\subsection{Lower Bound on Smoothness}
\LowerBoundSmoothness*

\begin{proof}
Let $\A$ be a deterministic algorithm for \OMS{} with, and assume that it satisfies for all $\prices$ and $\pred$ that
\[
\frac{\A(\prices,\pred)}{\price} \geq \max\left( \rob, \frac{1}{\rob \ub}\error(\pred, \price)^{\smthu} \right)\;.
\]
In particular, $\A$ has robustness $\rob$ and consistency $1/\rob\ub$.

To prove the lower bound, we will use the instances $\{\instance(\qmax)\}_{\qmax \in [1,\ub]}$ defined in Eq.~\eqref{eq:worst-case-instance}. On these instances, for a fixed prediction $\pred$, any deterministic algorithm behaves as a single threshold algorithm. Therefore, there exists $\thresh : [1,\ub] \to [1,\ub]$ satisfying that $\A(\instance(\qmax),y) = \A_\thresh(\instance(\qmax),y)$ for all $\qmax, \pred \in [1,\ub]$. 

The lower bound satisfied by $\A$ ensures that it achieves Pareto-optimal consistency $1 / (\rob \ub)$ and robustness $\rob$. Consequently, $\A_\thresh$ also attaints them on the sequences of prices $\{\instance(\qmax)\}_{\qmax \in [1,\ub]}$. These instances are precisely those used to establish the constraints on Pareto-optimal thresholds in Theorem \ref{thm:thresh-pareto-optimal}, which implies that the theoremâ€™s constraints hold for $\thresh$.  In particular, we have that $\thresh(\rob \ub) = \rob \ub$ and $\thresh(\ub) = 1/\rob$. 


Let $\pred = \ub$ and $\qmax = \frac{\thresh(\ub)}{1+\varepsilon} = \frac{1/\rob}{1+\varepsilon}$ for some $\varepsilon > 0$. Since $\qmax < \thresh(\ub)$, when $\A$ is given as input the instance $\instance(\qmax)$, it does not select the maximum price and ends up selecting a price of $1$, hence
\[
\frac{\A(\instance(\qmax),\ub)}{\qmax} 
= \frac{1}{\qmax}
= (1+\varepsilon) \rob\;.
\]
Furthermore, by assumption, this ratio above is at least 
\[
\frac{1}{\rob \ub} \error(\qmax, \ub)^{\smthu}
= \frac{1}{\rob \ub} \error\left( \frac{1}{(1+\varepsilon)\rob}, \ub\right)^{\smthu}
= \frac{1}{\rob \ub} \left( \frac{1}{(1+\varepsilon)\rob \ub}\right)^{\smthu}
= \frac{1}{(\rob \ub)^{{\smthu}+1}}(1+\varepsilon)^{\smthu} \;,
\]
therefore, we have that
\begin{align*}
(1+\varepsilon)\rob \geq \frac{1}{(\rob \ub)^{{\smthu}+1}}(1+\varepsilon)^{\smthu}\;.
\end{align*}
This inequality holds for all $\varepsilon>0$, which gives in the limit $\varepsilon \to 0$ that
\[
\rob  \geq \frac{1}{(\rob \ub)^{{\smthu}+1}}\;,
\]
and we obtain by equivalences that
\begin{align*}
\rob  \geq \frac{1}{(\rob \ub)^{{\smthu}+1}}\;,
&\iff (\rob \ub)^{\smthu} \geq \frac{\ub}{(\rob\ub)^2}\\
&\iff {\smthu} \ln (\rob \ub) \geq \ln \ub - 2 \ln(\rob \ub)\\
&\iff {\smthu} \geq \frac{\ln \ub}{\ln(\rob \ub)} - 2\;,
\end{align*}
which gives the claimed lower bound on ${\smthu}$.

\end{proof}