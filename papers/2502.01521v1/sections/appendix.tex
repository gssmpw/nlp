%Figures and Tables will have S in the name
\renewcommand{\thetable}{S\arabic{table}}
\renewcommand{\thefigure}{S\arabic{figure}}
\renewcommand{\theequation}{S\arabic{equation}}

\subsection{Implementation details}
\label{sec:implementation}

Our experiments focus on two primary task settings:

\begin{itemize}
    \item \textit{Position tracking}: The robot's objective is to track a target position, sampled uniformly in polar coordinates with a radius between 1 m and 5 m around its initial position (i.e., \(r \sim U([1.0, 5.0])\), \(\theta \sim U([-\pi, \pi])\)).
    The target position is dynamically converted to Cartesian coordinates \(
    \mathbf{x}^{\text{cmd}}_{\text{b}} = [x^{\text{cmd}}_{\text{b, x}}, x^{\text{cmd}}_{\text{b, y}}] \in \mathbb{R}^2
    \), relative to the robot's base frame based on its current position. 
    This relative target position is provided as input to the policy, which outputs the target joint position \(\mathbf{q}^*\).
    The episode length is set to \(8 \, \text{s}\).
    
    \item \textit{Velocity tracking}: The robot's objective is to track a velocity command, 
    \(\mathbf{v}^{\text{cmd}} = [v_{\text{x}}^{\text{cmd}}, v_{\text{y}}^{\text{cmd}}, \omega_{\text{z}}^{\text{cmd}}] \in \mathbb{R}^3\), where \(v_{\text{cx}}^{\text{cmd}}\) and \(v_{\text{cy}}^{\text{cmd}}\) represent the target forward and lateral linear velocities,
    and \(\omega_{\text{z}}^{\text{cmd}}\) denotes the target yaw angular velocity. 
    At the start of each episode, the velocity commands are sampled as follows:

\begin{itemize}
    \item \textbf{ANYmal quadruped robot}: The forward and lateral linear velocities are sampled uniformly between $-1.0$ and $1.0$ m/s:
    \[
    v_x^{\text{cmd}} \sim U([-1.0, 1.0]), \quad v_y^{\text{cmd}} \sim U([-1.0, 1.0]).
    \]

    \item \textbf{G1 humanoid robot}: The forward linear velocity is sampled uniformly between $0.0$ and $1.0$ m/s:
    \[
    v_x^{\text{cmd}} \sim U([0.0, 1.0]),
    \]
    while the lateral velocity is fixed at zero:
    \[
    v_y^{\text{cmd}} = 0.0.
    \]
\end{itemize}
    A target heading direction is sampled uniformly from \([- \pi, \pi]\). 
    The yaw command, \(\omega_{\text{z}}^{\text{cmd}}\), is dynamically computed based on the target and current heading.
    The policy is trained to output the target joint position \(\mathbf{q}^*\).
\end{itemize}

Tables~\ref{tab:pos_tracking_inputs}--\ref{tab:vel_tracking_training_details} summarize the observations, reward terms and training details for the two task settings.

\begin{table}[h!]
    \centering
    \caption{Position tracking observations}
    \label{tab:pos_tracking_inputs}
    \begin{tabular}{@{}llccc@{}}
        \toprule
        \textbf{Term} & \textbf{Notation} & \textbf{Dimension} & \textbf{Units} & \textbf{Noise} \\ 
        & & \textbf{ANYmal $\vert$ G1} &  & \\
        \midrule
        \textbf{Observations} & & & & \\ 
        Base linear velocity & $\mathbf{v}_t$ & 3 & m/s & [-0.10, 0.10] \\
        Base angular velocity & $\boldsymbol{\omega}_t$ & 3 & rad/s & [-0.20, 0.20] \\
        Projected gravity & $\mathbf{g}^{\text{proj}}_t$ & 3 & - & [-0.05, 0.05] \\
        Joint position & $\mathbf{q}_t$ & 12 $\vert$ 37 & rad & [-0.01, 0.01] \\
        Joint velocity & $\mathbf{\dot{q}}_t$ & 12 $\vert$ 37 & rad/s & [-1.50, 1.50] \\
        Previous action & $\mathbf{a}_{t-1}$ & 12 $\vert$ 37 & rad & - \\ 
        Remaining time & $t_{\text{left}}$ & 1 & - & - \\ \midrule
        \textbf{Commands} & & & & \\ 
        Target xy position & $\mathbf{x}_{b, xy}^{\text{cmd}}$ & 2 & m & - \\
        \bottomrule
    \end{tabular}
\end{table}

\begin{table}[h!]
    \centering
    \caption{Velocity tracking observations}
    \label{tab:vel_tracking_inputs}
    \begin{tabular}{@{}llccc@{}}
        \toprule
        \textbf{Term} & \textbf{Notation} & \textbf{Dimension} & \textbf{Units} & \textbf{Noise} \\ 
        & & \textbf{ANYmal $\vert$ G1} &  & \\
        \midrule
        \textbf{Observations} & & & & \\ 
        Base linear velocity & $\mathbf{v}_t$ & 3 & m/s & [-0.10, 0.10] \\
        Base angular velocity & $\boldsymbol{\omega}_t$ & 3 & rad/s & [-0.20, 0.20] \\
        Projected gravity & $\mathbf{g}^{\text{proj}}_t$ & 3 & - & [-0.05, 0.05] \\
        Joint position & $\mathbf{q}_t$ & 12 $\vert$ 37 & rad & [-0.01, 0.01] \\
        Joint velocity & $\mathbf{\dot{q}}_t$ & 12 $\vert$ 37 & rad/s & [-1.50, 1.50] \\
        Previous action & $\mathbf{a}_{t-1}$ & 12 $\vert$ 37 & rad & - \\ \midrule
        \textbf{Commands} & & & & \\ 
        Linear x velocity & $v_{x}^{\text{cmd}}$ & 1 & m/s &  - \\
        Linear y velocity & $v_{y}^{\text{cmd}}$ & 1 & m/s &  - \\
        Angular yaw velocity & $\omega_z^{\text{cmd}}$ & 1 & rad/s & - \\
        \bottomrule
    \end{tabular}
\end{table}

\begin{table}[h!]
    \centering
    \caption{Position tracking reward terms (adapted from~\citet{rudin2022posTracking})}
    \label{tab:position_tracking_rewards}
    \begin{tabular}{@{}p{2.7cm}p{3.3cm}p{0.8cm}p{0.8cm}}
        \toprule
        \textbf{Term} & \textbf{Equation} & \multicolumn{2}{c}{\textbf{Weight}} \\ 
        & & \textbf{ANYmal} & \textbf{G1} \\ \midrule
        \textbf{Task} & & & \\
        Target position tracking & $(1 - 0.5 \cdot \| \mathbf{x}_{b, xy}^{\text{cmd}}\|^2) \cdot \mathbf{1}_{\{t > T - 3\}}$ & 10.0 & 10.0 \\
        \midrule
        \textbf{Stability} & & & \\
        Linear z velocity & $v_z^2$ & -2.0 & -0.2 \\
        Angular roll-pitch \newline velocity & $\|\boldsymbol{\omega}_{xy}\|^2$ & None & -0.005 \\
        Flat orientation & $\|\mathbf{g}_{xy}^{\text{proj}}\|^2$ & -1.0 & -1.0 \\
        Joint limits & $\|\mathbf{q} - \text{clip}(\mathbf{q}, \mathbf{q}_{\min}, \mathbf{q}_{\max})\|_1$ & None & -1.0 \\
        Joint deviation (hip) & $\|\mathbf{q}_{\text{hip}} - \mathbf{q}_{\text{default,hip}}\|_1$ & None & -0.1 \\
        Joint deviation (arms) & $\|\mathbf{q}_{\text{arms}} - \mathbf{q}_{\text{default,arms}}\|_1$ & None & -0.1 \\
        Joint deviation (fingers) & $\|\mathbf{q}_{\text{fingers}} - \mathbf{q}_{\text{default,fingers}}\|_1$ & None & -0.05 \\
        Joint deviation (torso) & $\|\mathbf{q}_{\text{torso}} - \mathbf{q}_{\text{default,torso}}\|_1$ & None & -0.1 \\
        Applied torque limits & $\|\boldsymbol{\tau} - \boldsymbol{\tau}_{\text{computed}}\|_1$ & -0.2 & -0.2 \\
        Joint velocity & $\|\dot{\mathbf{q}}\|^2$ & -0.001 & -0.001 \\
        Joint velocity limits & $\||\dot{\mathbf{q}}| - \text{clip}(|\dot{\mathbf{q}}|, 0.9 \cdot \dot{\mathbf{q}}_{\max})\|_1$ & -1.0 & -1.0 \\
        Contact forces & $\|\max\left(\|\mathbf{f}_{\text{contact}}\| - 700, 0 \right)\|_1$ & -1.0e-5 & -1.0e-5 \\
        Collision & $\|\max\left(\frac{\|\mathbf{f}_{\text{contact}}\|}{200}, 1\right)\|_1$ & -0.5 & None \\
        Feet slide & $\sum_{j=1}^{n_{\text{feet}}} \|\mathbf{v}_{\text{foot}, j}\| \cdot \mathbf{1}_{\text{contact}, j}$ & None & -0.1 \\
        \midrule
        \textbf{Smoothness} & & & \\
        Joint torques & $\|\boldsymbol{\tau}\|^2$ & -1.0e-5 & -2.0e-6 \\
        Joint accelerations & $\|\ddot{\mathbf{q}}\|^2$ & None & -1.0e-7 \\
        Action rate & $\|\mathbf{a}_t - \mathbf{a}_{t-1}\|^2$ & -0.01 & -0.005 \\
        Feet air time & $\sum_{j=1}^{n_{\text{feet}}} (t_{\text{air},j} - t_{\text{thres}}) \cdot \mathbf{1}_{\text{new-contact},j}$ & 0.125 & 0.75 \\
        Base acceleration & $\|\dot{\mathbf{v}}_{\text{base}}\|^2 + 0.02 \cdot \|\dot{\boldsymbol{\omega}}_{\text{base}}\|^2$ & -0.001 & None \\
        Feet acceleration & $\sum_{j=1}^{n_{\text{feet}}} \|\dot{\mathbf{v}}_{\text{foot},j}\|$ & -0.002 & None \\
        \midrule
        \textbf{Auxiliary} & & & \\
        Termination penalty & $\mathbf{1}_{\text{terminated}}$ & -200.0 & -200.0 \\
        Stalling penalty & $\mathbf{1}_{\{\|\mathbf{x}_{b, xy}^{\text{cmd}}\| > 0.25\}} \cdot \mathbf{1}_{\{\|\mathbf{v}_{xy}\| < 0.2\}}$ & -1.0 & -1.0 \\
        Exploration & $\frac{\mathbf{v}_{xy}}{\|\mathbf{v}_{xy}\|} \cdot \frac{\mathbf{x}_{b, xy}^{\text{cmd}}}{\|\mathbf{x}_{b, xy}^{\text{cmd}}\|}$ & 1.0 & 1.0 \\
        Stand still & $\|\mathbf{q} - \mathbf{q}_{\text{default}}\|^2 \cdot 1_{\{\|\mathbf{x}_{b, xy}^{\text{cmd}}\| \leq 0.1\}} \cdot \mathbf{1}_{\{t > T - 1\}}$ & -0.05 & -0.05 \\
        \bottomrule
    \end{tabular}
    \vspace{30mm}
    \parbox{\linewidth}{\footnotesize Note: $t_{\text{thres}}=0.5$ for ANYmal and $t_{\text{thres}}=0.4$ for G1.}
\end{table}


\begin{table}[h!]
    \centering
    \caption{Velocity tracking reward terms}
    \label{tab:velocity_tracking_rewards}
    \begin{tabular}{@{}p{2.7cm}p{3.3cm}p{0.8cm}p{0.8cm}}
        \toprule
        \textbf{Term} & \textbf{Equation} & \multicolumn{2}{c}{\textbf{Weight}} \\ 
        & & \textbf{ANYmal} & \textbf{G1} \\ \midrule
        \textbf{Task} & & & \\
        Linear xy velocity & $\exp\left(-\|\mathbf{v}_{xy} - \mathbf{v}_{xy}^{\text{cmd}}\|^2 / 0.25\right)$ & 1.0 & 1.0 \\
        Angular yaw velocity & $\exp\left(-(\omega_z - \omega_z^{\text{cmd}})^2 / 0.25\right)$ & 0.5 & 1.0 \\ 
        \midrule
        \textbf{Stability}\\
        Linear z velocity & $v_z^2$ & -2.0 & -0.2 \\
        Angular roll-pitch \newline velocity & $\|\boldsymbol{\omega}_{xy}\|^2$ & -0.05 & -0.05 \\
        Flat orientation & $\|\mathbf{g}_{xy}^{\text{proj}}\|^2$ & -5.0 & -1.0 \\
        Undesired contacts & $\mathbf{1}_{\text{self-collision}}$ & -1.0 & None \\
        Joint limits & $\|\mathbf{q} - \text{clip}(\mathbf{q}, \mathbf{q}_{\min}, \mathbf{q}_{\max})\|_1$ & None & -1.0 \\
        Joint deviation (hip) & $\|\mathbf{q}_{\text{hip}} - \mathbf{q}_{\text{default,hip}}\|_1$ & None & -0.1 \\
        Joint deviation (arms) & $\|\mathbf{q}_{\text{arms}} - \mathbf{q}_{\text{default,arms}}\|_1$ & None & -0.1 \\
        Joint deviation (fingers) & $\|\mathbf{q}_{\text{fingers}} - \mathbf{q}_{\text{default,fingers}}\|_1$ & None & -0.05 \\
        Joint deviation (torso) & $\|\mathbf{q}_{\text{torso}} - \mathbf{q}_{\text{default,torso}}\|_1$ & None & -0.1 \\
        Feet slide & $\sum_{j=1}^{n_{\text{feet}}} \|\mathbf{v}_{\text{foot}, j}\| \cdot \mathbf{1}_{\text{contact}, j}$ & None & -0.1 \\
        \midrule
        \textbf{Smoothness}\\
        Joint torques & $\|\boldsymbol{\tau}\|^2$ & -2.5e-5 & -2.0e-6 \\
        Joint accelerations & $\|\ddot{\mathbf{q}}\|^2$ & -2.5e-7 & -1.0e-7 \\
        Action rate & $\|\mathbf{a}_t - \mathbf{a}_{t-1}\|^2$ & -0.01 & -0.005 \\
        Feet air time & $\sum_{j=1}^{n_{\text{feet}}} (t_{\text{air},j} - t_{\text{thres}}) \cdot \mathbf{1}_{\text{new-contact},j}$ & 0.5 & 0.75 \\
        \midrule
        \textbf{Auxiliary}\\
        Termination penalty & $\mathbf{1}_{\text{terminated}}$ & None & -200.0 \\
        \bottomrule
    \end{tabular}
    \vspace{30mm}
    \parbox{\linewidth}{\footnotesize Note: $t_{\text{thres}}=0.5$ for ANYmal and $t_{\text{thres}}=0.4$ for G1.}
\end{table}

\begin{table}[h]
\centering
\caption{Position tracking training details}
\label{tab:pos_tracking_training_details}
\begin{tabular}{lcc}
\toprule
\textbf{Hyperparameter} & \textbf{ANYmal} & \textbf{G1} \\ \midrule
\multicolumn{2}{l}{\textbf{PPO hyperparameters}} \\ 
Parallel environments & 4,096 & 4,096 \\
Steps per environment & 48 & 48 \\
Epochs per update & 5 & 5\\
Minibatches per epoch & 4 & 4\\
Discount rate ($\gamma$) & 0.99 & 0.99\\
GAE parameter & 0.95 & 0.95\\
Value loss coefficient & 1.0 & 1.0 \\
Clipping parameter & 0.20 & 0.20\\
Entropy coefficient & 0.005 & 0.003\\
Maximum gradient norm & 1.00 & 1.00\\
Initial learning rate & 0.001 & 0.001\\
Target KL & 0.01 & 0.01\\
Optimizer & Adam & Adam \\ \midrule
\multicolumn{2}{l}{\textbf{Policy Network architectures}} \\ 
Policy ($\pi$) MLP hidden layers & 128, 128, 128 & 256, 128, 128\\
Critic ($V^{\pi}$) MLP hidden layers & 128, 128, 128 & 256, 128, 128\\
MLP activations & ELU & ELU\\ \midrule
\multicolumn{2}{l}{\textbf{Memory Module}} \\ 
RNN type & LSTM & LSTM\\
RNN hidden size & 256 & 256\\
RNN hidden layer & 1 & 1\\
\bottomrule
\end{tabular}
\end{table}

\begin{table}[h]
\centering
\caption{Velocity tracking training details}
\label{tab:vel_tracking_training_details}
\begin{tabular}{lcc}
\toprule
\textbf{Hyperparameter} & \textbf{ANYmal} & \textbf{G1} \\ \midrule
\multicolumn{2}{l}{\textbf{PPO hyperparameters}} \\ 
Parallel environments & 4,096 & 4,096 \\
Steps per environment & 24 & 24 \\
Epochs per update & 5 & 5\\
Minibatches per epoch & 4 & 4\\
Discount rate ($\gamma$) & 0.99 & 0.99\\
GAE parameter & 0.95 & 0.95\\
Value loss coefficient & 1.0 & 1.0 \\
Clipping parameter & 0.20 & 0.20\\
Entropy coefficient & 0.005 & 0.008\\
Maximum gradient norm & 1.00 & 1.00\\
Initial learning rate & 0.001 & 0.001\\
Target KL & 0.01 & 0.01\\
Optimizer & Adam & Adam \\ \midrule
\multicolumn{2}{l}{\textbf{Policy Network architectures}} \\
Policy ($\pi$) MLP hidden layers & 128, 128, 128 & 256, 128, 128\\
Critic ($V^{\pi}$) MLP hidden layers & 128, 128, 128 & 256, 128, 128\\
MLP activations & ELU & ELU\\ \midrule
\multicolumn{2}{l}{\textbf{Memory Module}} \\
RNN type & LSTM & LSTM\\
RNN hidden size & 256 & 512\\
RNN hidden layer & 1 & 1\\
\bottomrule
\end{tabular}
\end{table}

\subsection{Evaluation details}
\label{sec:eval_supp}
The feet air time metric, shown in~\figref{fig:behavior_analysis}, is calculated as the total duration the feet remain off the ground, expressed as:
\[
\sum_{j=1}^{n_{\text{feet}}} (t_{\text{air},j} - 0.5) \cdot \mathbf{1}_{\text{new-contact},j}
\]
The contact frequency measures the total number of times the feet make contact with the ground and is given by:
\[
\sum_{j=1}^{n_{\text{feet}}} \mathbf{1}_{\text{new-contact},j}
\]