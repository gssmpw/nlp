\section{Architecture for Digital Twin}
\label{sec:architecture}
The design and implementation of the architecture of \digit (DT for ITS) platform require a structured approach to address the inherent complexities of urban mobility. Using the Sociotechnical DT Specification Meta Language Concepts \cite{balbir} as the foundation, this approach establishes the scope, purpose, and operational mechanisms of the DT. At the core of this system is the Domain Concept Model (DCM), which provides a structured representation of the architecture of \digit components and their interactions. Together, these elements ensure that the architecture for \digit platform is both theoretically sound and practically viable. 
% This section first elaborates on the specification meta-language concepts that guide the DT's design and then introduces the Domain Concept Model, which operationalizes these concepts within ITS.

\subsection{Sociotechnical DT Specification Meta Language Concepts for DigIT}

The specification meta-language serves as a framework to articulate and guide the development of the DT for ITS. Each concept within this framework is defined and applied explicitly to address the challenges and requirements of ITS.
% \begin{figure*}[!htbp]
%     \centering
%     \includegraphics[width=\linewidth]{IEEE-conference-template-062824-2/images/Socio technical.pdf}
%     \caption{Sociotechnical DT Specification Meta Language Concepts for ITS.}
%     \label{fig:dcm_uml}
% \end{figure*}

\begin{figure*}[!htbp]
    \centering
    \includegraphics[width=\linewidth]{images/Socio_technical.png}
    \caption{Sociotechnical DT Specification Meta Language Concepts for ITS.}
    \label{fig:dcm_uml}
\end{figure*}


\textbf{Goal.} The primary goal of the DT is to enhance traffic management by enabling proactive and data-driven decision-making. Key objectives include improving traffic flow efficiency, reducing congestion and delays, and enhancing road safety. Additionally, the DT seeks to expand and optimize communication capabilities through adaptive technologies, ensuring seamless information exchange between vehicles and infrastructure. These goals collectively aim to create a more responsive and sustainable ITS. 

\textbf{Measure.} The effectiveness of the DT is evaluated using quantifiable metrics that assess traffic performance, environmental impact, and communication reliability. These measures include average travel time per vehicle, intersection throughput (vehicles per minute), reduction in greenhouse gas emissions, and the number of accidents or incidents reported per month. Additional metrics, such as average vehicle speed during peak hours and communication latency between traffic management systems and vehicles, provide insights into system responsiveness and efficiency. These indicators ensure the DT delivers measurable improvements aligned with ITS objectives.


\textbf{Assumption.} The assumptions explain the scope of the DT and define the prerequisites for its successful deployment. For the ITS-focused DT, the architecture assumes the presence of IoT-enabled sensors deployed across the transportation network. These sensors capture real-time data, such as traffic flow rates, vehicular speeds, and congestion levels. Environmental sensors are also assumed to provide supplementary data on external factors like weather conditions. Additionally, the architecture assumes the existence of a robust communication infrastructure that facilitates the seamless transmission of data between the physical and digital layers. These assumptions ensure that the DT operates in a data-rich environment, accurately reflecting real-world conditions \cite{9745481}.


\textbf{Lever/Policy.} Levers or policies are quantifiable or actionable elements that influence the operation of the DT. Examples of policies include dynamic traffic signal adjustments, traffic rerouting strategies, emission control policies, integration with public transit policies, pedestrian prioritization, and enabling direct vehicle-to-vehicle (V2V) communication for dynamic traffic information sharing. These levers serve as input for simulations and predictive models, allowing the DT to anticipate traffic conditions and recommend appropriate interventions. For example, a high vehicle density at a particular intersection could be detected and processed by an ML model, which predicts the potential impact of congestion. This prediction could then initiate simulations to assess the effectiveness of rerouting strategies or signal adjustments to alleviate the congestion.



\textbf{Regulation.} Regulations define enforceable policies and standards that guide the operations of the DT within the ITS. These include city-specific traffic and parking rules, privacy laws governing data collection and use, emission control limits for urban zones, and interoperability standards for IoT and ITS components. Such regulations ensure that the DT complies with societal, environmental, and legal requirements. For example, emission control policies can trigger restrictions on vehicle performance during periods of high pollution, while interoperability standards ensure seamless integration between heterogeneous systems within the ITS ecosystem.


\textbf{Constraint.} Constraints define domain-specific rules that govern the behavior of the DT to ensure compliance with legal, ethical, and operational standards. In the context of ITS, these constraints include traffic signal timings that must remain within operational limits, maximum vehicle density thresholds for road segments, and safety margins for pedestrian crossings. Additionally, environmental factors, such as weather conditions, impose constraints on the reliability of predictive models. By embedding these constraints into its architecture, the DT operates within predefined boundaries, ensuring safe, reliable, and regulation-compliant functionality.


\textbf{Validation.} The DT is validated using a multifaceted approach to ensure accuracy and reliability. Real-time sensor data collected from IoT-enabled devices at intersections are compared against DT predictions to assess model performance. Simulations are conducted to test intervention strategies, such as rerouting, under varying traffic conditions. In addition, stakeholder feedback on system recommendations provides qualitative insights, ensuring that the DT meets practical requirements and operational expectations.






% \textcolor{red}{refer back when discussing results}







\textbf{Actions.} Actions represent the operational behaviors assigned to domain concepts within the DT. These include dynamic signal timing adjustments, traffic rerouting based on real-time conditions, and generating predictive alerts for traffic operators. By translating the DT's insights into actionable interventions, these behaviors create a feedback loop that continuously refines the system's performance.

\textbf{State Model.} The State Model defines the dynamic conditions of key entities within the ITS to capture their operational status and transitions. Vehicles can be in states such as idle, moving, queuing, or rerouted. Intersections are classified as free flow, congested, or under intervention. Road segments are categorized based on traffic levels, ranging from clear to heavy congestion. The overall system state reflects conditions like normal operations, incident response, or weather-affected scenarios. These states enable real-time monitoring and adaptive decision-making within the DT framework.

\textbf{Domain Concept Model (DCM).} DCM defines the ITS as a set of interconnected components that capture attributes, behaviors, and relationships at a higher level of abstraction. It provides a foundational framework for modeling key entities such as vehicles, users, communication networks, infrastructure, routes, and environmental conditions, along with their interactions. Each component in the DCM can be further elaborated through specialized domain models to address specific aspects of ITS operations in greater detail. We used the principles of \textit{Domain-Driven Design (DDD)} to identify key domains in the ITS. This was achieved by identifying \textit{bounded contexts} within the ITS domain, as proposed by Mac√≠as et al.~\cite{macias2023architecting} and Evans ~\cite{evans2004domain}. These bounded contexts provide logical partitions that encapsulate specific functionalities, ensuring modularity and consistency across the system.  


Building on this foundation, the model organizes the ITS into several interconnected components, each corresponding to a bounded context as shown in Figure~\ref{fig:dcm_uml}. For instance, the \textit{Users Context} categorizes users as drivers, passengers, and pedestrians, each with distinct attributes and behaviors. Similarly, the \textit{Vehicles Context} models properties such as speed, direction, and unique identifiers, as well as behaviors like adherence to speed limits, to capture real-world dynamics. The \textit{Communication Context} defines networks and protocols to enable seamless data exchange between vehicles, infrastructure, and centralized systems, supporting real-time information sharing and decision-making. Environmental factors, such as weather and time of day, influence traffic conditions and vehicle performance, while infrastructure components define fixed resources like traffic signals and IoT-enabled sensors. Messages exchanged through communication protocols support coordination, while routes and traffic conditions guide vehicle navigation and behavior. The DCM also models interactions and constraints, including traffic signal timing limits, vehicle density thresholds, and pedestrian safety margins. These constraints are embedded within the architecture to ensure compliance with regulatory and operational requirements. Behavioral elements, such as adaptive signal timing, dynamic rerouting, and message exchanges, enable predictive analytics and scenario testing within the DT. By abstracting ITS components at a high level, DCM allows modular expansion, enabling detailed exploration of specific domains through separate models. Figure~\ref{fig:dcm_uml} illustrates the structure, showing how core entities and relationships form the basis for an extensible and scalable ITS framework. It is important to note that this DCM is not exhaustive but rather serves as an illustrative example of how the ITS domain can be modeled. The framework is flexible and can be extended or customized to incorporate additional components and interactions as needed to address the specific requirements of diverse ITS applications. 





% By structuring the ITS into bounded contexts, the DCM enables the independent evolution of individual components. In the next section, we will discuss how these concepts can be bounded and operationalized within the architecture to achieve modularity and interoperability.
% \textcolor{red}{add uml diagram}
% \textcolor{blue}{bridge the layered architecture and the DCM language models highlighting what is considered for current architectural setup (refer back to say what we discussed was a comprehensive architecture for DT, but considering complexity, we have come to apoint that the current architecture is considering only some aspects}



\subsection{Proposed Architecture of the DT}  
Building on the DCM, we propose an architecture for \digit platform that transforms the high-level abstractions defined in the DCM into operational components for data collection, predictive analysis, simulation and visualization. Although DCM provides a broad framework for modeling ITS, this architecture focuses on select components essential for real-time traffic monitoring, prediction, and scenario-based simulations. Using elements from the DCM, such as vehicles, communication networks, sensors, and user behaviors, the proposed architecture ensures a seamless integration between conceptual modeling and practical implementation. The following sections detail each functional component, demonstrating how the principles outlined in the DCM are operationalized within the architecture of \digit platform.


\textbf{Users and Vehicles.}  
As shown in Figure~\ref{fig:digit_architecture}, the architecture models users, including drivers, passengers, and pedestrians, along with vehicles characterized by attributes such as speed, direction, and ID. Users access dashboards that provide real-time traffic updates and predictions, extending the behavioral modeling of users and vehicles defined in the DCM to ensure synchronization between physical and digital systems.



\textbf{Sensors.}  
As shown in Figure~\ref{fig:digit_architecture}, IoT-enabled sensors deployed at intersections and road segments capture real-time data, including vehicle speeds, traffic density, and congestion levels. Environmental sensors complement this by monitoring external factors such as weather conditions, aligning with the \textit{Environment} component in the DCM (Figure~\ref{fig:dcm_uml}). These sensors operate continuously, reflecting the dynamic nature of the transportation network and providing input for predictive modeling and simulations. By integrating data from physical infrastructure, the sensors ensure that the DT maintains synchronization with real-world conditions, enabling timely analysis and decision-making.


% \begin{figure}[!htbp]
%     \centering
%     % Adjust the width parameter to control the size of the image
%     \includegraphics[width=0.90\linewidth]{IEEE-conference-template-062824-2/images/Final approach.pdf}
%     \caption{Architecture of \digit}
%     \label{fig:digit_architecture}
% \end{figure}
\begin{figure}[!htbp]
    \centering
    % Adjust the width parameter to control the size of the image
    \includegraphics[width=0.90\linewidth]{images/Final_approach.png}
    \caption{Architecture of \digit}
    \label{fig:digit_architecture}
\end{figure}

\textbf{Communication Layer.}  
The communication layer, as shown in Figure~\ref{fig:digit_architecture}, facilitates seamless and reliable data exchange between the physical and digital systems. It leverages a heterogeneous network comprising 4G/5G, LoRA, and WiFi communication mechanisms to support high-frequency real-time data streams and periodic batch transfers. Modeled in the DCM (Figure~\ref{fig:dcm_uml}) through the \textit{CommunicationNetwork} and \textit{CommunicationBehaviour} components, this layer ensures bidirectional communication, enabling the DT to relay recommendations‚Äîsuch as optimized signal timings or rerouting strategies‚Äîback to the physical infrastructure. Attributes such as protocol type and latency, as captured in the DCM, align with the low-latency protocols implemented here to handle time-critical updates, including responses to accidents or congestion. For example, vehicle counts and speed data collected at multiple intersections are transmitted to the data lake while maintaining synchronization across all input sources.



\textbf{Data Lake.}  
After data is transmitted through the communication layer, the data lake stores the communicated information, supporting both real-time analysis and long-term storage. It processes structured and unstructured data, performing preprocessing tasks like cleaning and aggregation to optimize it for simulations and machine learning models. As shown in Figure~\ref{fig:digit_architecture}, this layer integrates inputs modeled in the DCM, including vehicle behavior, environmental conditions, and communication protocols. 


\textbf{Visualization.}  
As shown in Figure~\ref{fig:digit_architecture}, the visualization layer provides three types of dashboards‚Äî\textit{real-time, simulation,} and \textit{prediction}. The real-time dashboard monitors live metrics like vehicle counts and congestion levels. The simulation dashboard models scenarios such as accidents and peak-hour traffic, while the prediction dashboard forecasts future traffic patterns using historical and real-time data. These dashboards leverage the behavioral and environmental models defined in the DCM to ensure synchronization between real-world data and simulated outputs.



\textbf{Digital Twin Manager.}  
As shown in Figure~\ref{fig:digit_architecture}, the DT Manager creates a virtual representation of the physical transportation network. It enables the simulation, prediction, and optimization of traffic conditions in real-time, while ensuring continuous feedback between the virtual and physical systems. The DT Manager incorporates three key components: the \textit{Simulator}, the \textit{Actuator}, and the \textit{Code Generator}. These components collaboratively ensure the platform's adaptability, scalability, and responsiveness to evolving traffic conditions.

The \textit{Simulator} replicates real-world traffic conditions by using real-time and historical data from IoT-enabled sensors, as described in the Figure~\ref{fig:digit_architecture}. It models traffic dynamics such as vehicle movements, congestion patterns, and disruptions (e.g., accidents or roadblocks). Scenarios are evaluated using predictive models, such as LSTM and BiLSTM, to assess the impact of potential interventions like signal timing adjustments, lane closures, or rerouting strategies. For instance, when a sensor detects congestion at an intersection, the Simulator evaluates alternative traffic flow patterns and identifies the most effective mitigation strategy. The simulations are run iteratively, incorporating temporal and spatial dependencies, ensuring the virtual environment remains in sync with the physical system.

The \textit{Actuator} implements decisions derived from the Simulator into the physical transportation network. By translating simulation outcomes into real-world actions, it controls physical infrastructure such as traffic lights, dynamic message signs, and variable speed limits. For example, if the Simulator predicts bottlenecks at a specific intersection, the Actuator adjusts traffic signal timings or reroutes vehicles to alleviate congestion. The Actuator is designed to handle low-latency operations, ensuring rapid deployment of interventions during critical scenarios, such as accidents or emergency evacuations. The bidirectional communication with physical systems ensures that the Actuator can validate its actions using updated feedback from sensors, maintaining a robust closed-loop system.

The \textit{Code Generator} serves as the intermediary between the high-level abstract models defined in the DCM and the operational components of the Digital Twin. While ML models can directly process data for predictions without translation, abstract models in the DCM‚Äîsuch as communication protocols, behavioral models, and state transitions‚Äîmust be translated into executable instructions for the Digital Twin to understand and act upon them. The Code Generator performs this crucial task, converting these specifications into machine-readable configurations that the Simulator and Actuator can execute. For example, the DCM may define the relationships between vehicles, sensors, and infrastructure; the Code Generator ensures these relationships are accurately mapped to system operations, enabling real-time simulation and execution. This modular approach ensures flexibility and scalability, allowing for the seamless integration of new traffic management policies or sensor types without disrupting the existing system.
% As shown in Figure~\ref{fig:digit_architecture}, the DT Manager creates a virtual representation of the physical transportation network, enabling the DT to model and predict traffic behavior under various scenarios. It incorporates three key components‚Äî\textit{simulator}, \textit{actuator}, and \textit{code generator}‚Äîto process and execute traffic management strategies. The \textit{simulator} replicates real-world traffic conditions, modeling vehicle movements, congestion patterns, and disruptions such as accidents or roadblocks. It integrates real-time data to keep the virtual model synchronized with the physical environment. For example, if an accident is detected at an intersection, the \textit{simulator} evaluates rerouting strategies and assesses their impact on traffic flow. The \textit{actuator} translates these simulation outputs into physical actions, implementing strategies such as adjusting traffic signal timings or rerouting vehicles. This ensures that decisions derived from simulations are reflected in the real-world system, enabling a continuous feedback loop for monitoring and adaptation. The \textit{code generator} acts as an intermediary, converting abstract models‚Äîsuch as the communication and state models defined in the DCM‚Äîinto formats that can be interpreted by the \textit{simulator} and \textit{actuator}. This ensures compatibility between the high-level abstractions modeled in the DCM and the executable instructions required for simulations and actions. Together, these components maintain synchronization between real-time data, predictions, and physical interventions, ensuring that traffic management strategies are continuously evaluated and updated as conditions evolve.

% \textbf{MLOps Pipeline.}  
% As shown in Figure~\ref{fig:digit_architecture}, the MLOps pipeline automates the lifecycle of machine learning models, such as LSTM, to forecast traffic conditions based on historical and real-time data. These forecasts help identify potential congestion points and suggest proactive measures to mitigate disruptions. The pipeline handles data preprocessing, model training, deployment, and monitoring. It continuously tracks performance metrics, such as prediction accuracy and drift, triggering retraining only when predefined thresholds are exceeded. By automating the model lifecycle, the MLOps pipeline ensures adaptability to evolving traffic conditions while maintaining computational efficiency. This approach aligns with the work of Bhatt et al. \cite{bhatt2024towards}, who emphasize the role of MLOps in sustaining scalable and adaptive predictive models for dynamic environments.
\textbf{MLOps Pipeline.}  
The MLOps pipeline automates the lifecycle of machine learning (ML) models, such as Long Short-Term Memory (LSTM) for traffic flow prediction or Convolutional Neural Networks (CNN) for anomaly detection. It handles data preprocessing, model training, deployment, and monitoring, ensuring adaptability to evolving traffic conditions. Let $X_t = \{x_1, x_2, \dots, x_t\}$ represent input data collected over $t$ time intervals. The objective is to forecast traffic states for a future horizon $h$ as:
\vspace{0.5mm}
\[
\hat{Y}_{t+h} = f(X_t; M_v)
\]

\noindent where $M_v$ denotes the current model version. Model performance is continuously evaluated using metrics such as Root Mean Squared Error (RMSE):
\vspace{0.5mm}
\[
RMSE = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (Y_i - \hat{Y}_i)^2}.
\]

\noindent To maintain model accuracy, retraining is triggered based on drift detection. Drift $\delta$ is defined as:
\vspace{0.5mm}
\[
\delta = D(Y, \hat{Y}) > \epsilon,
\]

\noindent where $D(\cdot)$ measures data or model drift, such as distributional changes in input features or output predictions, and $\epsilon$ represents a predefined threshold. When drift is detected, a new model version $M_{v+1}$ is trained and deployed:
\vspace{0.5mm}
\[
M_{v+1} = \text{Train}(X_t, Y_t).
\]

The pipeline supports scalability by maintaining versioned repositories of models and automating retraining cycles. It reduces manual intervention while enabling responsiveness to traffic variations and anomalies. Inspired by Bhatt et al. \cite{bhatt2024towards}, this approach emphasizes sustainable and self-adaptive workflows, ensuring robustness in dynamic environments.

 



\textbf{Model Manager.}  
As shown in Figure~\ref{fig:digit_architecture}, the Model Manager organizes and stores models essential for the DT, including \textit{communication}, \textit{predictive}, and \textit{environment} models, but is not limited to them. \textit{Communication models} define protocols and behaviors for data exchange, ensuring seamless interaction between components. \textit{Predictive models}, forecast traffic patterns and congestion based on historical and real-time data. \textit{Environment models} account for external factors like weather and time of day, influencing traffic dynamics. These models are accessible to the Digital Twin Manager, with the \textit{code generator} facilitating the translation of abstract models into executable formats, ensuring compatibility with the \textit{simulator} and \textit{actuator}.


% \textbf{Integration and Workflow.} The layers of the DT architecture operate as an integrated framework, ensuring a smooth flow of data and insights across the system. The workflow begins with the Sensors and Data Collection layer, which gathers raw data from the physical environment. This data is transmitted via the Communication Layer to the Data Lake, where it undergoes preprocessing for analysis. The Simulation and Digital Twin Manager uses this data to model real-time traffic scenarios and test potential interventions, while the Analytics and Intelligence layer generates predictions and actionable insights. Finally, the Visualization layer communicates these insights to stakeholders, completing the feedback loop.

% This layered architecture operationalizes the foundational principles and the DCM, providing a comprehensive and adaptive solution for ITS. By segmenting the system into independent yet interconnected layers, the architecture ensures that each component can evolve independently while maintaining seamless integration with the overall system. 
