\documentclass{article}


% if you need to pass options to natbib, use, e.g.:
    \PassOptionsToPackage{numbers, compress}{natbib}
% before loading neurips_2024


% ready for submission
% \usepackage{neurips_2024}


% to compile a preprint version, e.g., for submission to arXiv, add the
% [preprint] option:
%     \usepackage[preprint]{neurips_2024}


% to compile a camera-ready version, add the [final] option, e.g.:
    \usepackage[final]{neurips_2024}


% to avoid loading the natbib package, add option nonatbib:
%    \usepackage[nonatbib]{neurips_2024}


\usepackage[utf8]{inputenc} % allow utf-8 input
\usepackage[T1]{fontenc}    % use 8-bit T1 fonts
\usepackage{hyperref}       % hyperlinks
\usepackage{url}            % simple URL typesetting
\usepackage{booktabs}       % professional-quality tables
\usepackage{amsfonts}       % blackboard math symbols
\usepackage{nicefrac}       % compact symbols for 1/2, etc.
\usepackage{microtype}      % microtypography
\usepackage{xcolor}         % colors

% added packages
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{multirow}
\usepackage{color}
\usepackage{svg}
\usepackage{wrapfig}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}



\title{Improving Environment Novelty Quantification for Effective Unsupervised Environment Design}



% The \author macro works with any number of authors. There are two commands
% used to separate the names and addresses of multiple authors: \And and \AND.
%
% Using \And between authors leaves it to LaTeX to determine where to break the
% lines. Using \AND forces a line break at that point. So, if LaTeX puts 3 of 4
% authors names on the first line, and the last on the second line, try using
% \AND instead of \And before the third author name.


% compact foramt
\author{
Jayden Teoh$^*$, 
Wenjun Li$^*$$^\dag$, 
Pradeep Varakantham\\
Singapore Management University \\
\texttt{\{jxteoh.2023, wjli.2020, pradeepv\}@smu.edu.sg} 
}

\begin{document}


\maketitle
\def\thefootnote{*}\footnotetext{Equal contribution.}
% \def\thefootnote{\dag}\footnotetext{Corresponding author: \texttt{wjli.2020@phdcs.smu.edu.sg}}
\def\thefootnote{\dag}\footnotetext{Corresponding author.}


\begin{abstract}
Unsupervised Environment Design (UED) formalizes the problem of autocurricula through interactive training between a teacher agent and a student agent. The teacher generates new training environments with high learning potential, curating an adaptive curriculum that strengthens the student's ability to handle unseen scenarios. Existing UED methods mainly rely on {\em regret}, a metric that measures the difference between the agent's optimal and actual performance, to guide curriculum design. Regret-driven methods generate curricula that progressively increase environment complexity for the student but overlook environment {\em novelty}--a critical element for enhancing an agent's generalizability. Measuring environment novelty is especially challenging due to the underspecified nature of environment parameters in UED, and existing approaches face significant limitations. To address this, this paper introduces the {\em Coverage-based Evaluation of Novelty In Environment} (CENIE) framework. CENIE proposes a scalable, domain-agnostic, and curriculum-aware approach to quantifying environment novelty by leveraging the student's state-action space coverage from previous curriculum experiences. We then propose an implementation of CENIE that models this coverage and measures environment novelty using Gaussian Mixture Models. By integrating both regret and novelty as complementary objectives for curriculum design, CENIE facilitates effective exploration across the state-action space while progressively increasing curriculum complexity. Empirical evaluations demonstrate that augmenting existing regret-based UED algorithms with CENIE achieves state-of-the-art performance across multiple benchmarks, underscoring the effectiveness of novelty-driven autocurricula for robust generalization.
\end{abstract}



\section{Introduction}
Although recent advancements in Deep Reinforcement Learning (DRL) have led to many successes, e.g., super-human performance in games~\cite{hu2019simplified,berner2019dota} and reliable control in robotics~\cite{akkaya2019solving,andrychowicz2020learning}, training generally-capable agents remains a significant challenge. DRL agents often fail to generalize well to environments only slightly different from those encountered during training~\cite{cobbe2019quantifying,zhou2022domain}. To address this problem, there has been a surge of interest in {\em Unsupervised Environment Design} (UED;~\cite{wang2019poet,dennis2020emergent,wang2020enhanced,jiang2021prioritized,jiang2021replay,parker2022evolving,li2023effective,azad2023clutr}), which formulates the autocurricula~\cite{leibo2019autocurricula} generation problem as a two-player zero-sum game between a {\em teacher} and a {\em student} agent. In UED, the teacher constantly adapts training environments (e.g., mazes with varying obstacles and car-racing games with different track designs) in the curriculum to improve the student's ability to generalize across all possible levels. 

To design effective autocurricula, researchers have proposed various metrics to capture learning potential, enabling teacher agents to create training levels that adapt to the student's capabilities. The most popular metric, {\em regret}, measures the student's maximum improvement possible in a level. While regret-based UED algorithms~\cite{dennis2020emergent,jiang2021replay,jiang2021prioritized} are effective in producing levels at the frontier of the student's capability, they do not guarantee diversity in the student's experiences, limiting the training of generally-capable agents especially in large environment design spaces. Another line of work in UED recognizes this limitation, leading to methods exploring the prioritization of novel levels during curriculum generation~\cite{wang2019poet,wang2020enhanced,li2023effective}. This strategic shift empowers the teacher to introduce novel levels into the curriculum such that the student agent can actively explore the environment space and enhance its generalization capabilities. 

To more effectively evaluate environment novelty, we introduce the {\em Coverage-based Evaluation of Novelty In Environment} (CENIE) framework. CENIE operates on the intuition that a novel environment should induce unfamiliar experiences, pushing the student agent into unexplored regions of the state space and introducing variability in its actions. Therefore, signals about an environment's novelty can be derived by modeling and comparing its state-action space coverage with those of environments already encountered in the curriculum. We refer to this method of estimating novelty based on the agent’s past experiences as {\em curriculum-aware}. By evaluating novelty in relation to the experiences induced by other environments within the curriculum, CENIE prevents redundant environments—those that elicit similar experiences as existing ones—from being classified as novel. Curriculum-aware approaches ensure that levels in the student's curriculum collectively drive the agent toward novel experiences in a sample-efficient manner. 
% CENIE leverages {\em Gaussian Mixture Models} (GMMs) to represent the distribution of past aggregated experiences and assess the likelihood of experiences in new environments. This likelihood indicates the dissimilarity in state-action space coverage, enabling direct comparison of novelty between levels. 

Our contributions are threefold. First, we introduce CENIE, a scalable, domain-agnostic, and curriculum-aware framework for quantifying environment novelty via the agent’s state-action space coverage. CENIE addresses shortcomings in existing methods for environment novelty quantification, as discussed further in Sections \ref{section:related_works} and \ref{section:cenie_approach}. Second, we present implementations for CENIE using {\em Gaussian Mixture Models} (GMM) and integrated its novelty objective with PLR$^\perp$\cite{jiang2021prioritized} and ACCEL\cite{parker2022evolving}, the leading UED algorithms in zero-shot transfer performance. Finally, we conduct a comprehensive evaluation of the CENIE-augmented algorithms across three distinct benchmark domains. By incorporating CENIE into these leading UED algorithms, we empirically validate that CENIE's novelty-based objective not only exposes the student agent to a broader range of scenarios in the state-action space, but also contributes to achieving state-of-the-art zero-shot generalization performance. This paper underscores the importance of novelty and the effectiveness of the CENIE framework in enhancing UED.


\section{Background}
We briefly review the background of Unsupervised Environment Design (UED) in this section. UED problems are modeled as an Underspecified Partially Observable Markov Decision Process (UPOMDP) defined by the tuple:
\begin{align}
\langle S, A, O, \mathcal{I}, \mathcal{T}, \mathcal{R}, \gamma, \Theta \rangle \nonumber
\end{align}
where $S$, $A$ and $O$ are the sets of states, actions, and observations, respectively. $\Theta$ represents a set of free parameters where each $\theta \in \Theta$ defines a specific instantiation of an environment (also known as a {\em level}). We use the terms ``environments'' and ``levels'' interchangeably throughout this paper. The level-conditional observation and transition functions are defined as $\mathcal{I}: S \times \Theta \rightarrow O$ and $\mathcal{T}:S \times A \times \Theta \rightarrow \Delta(S)$, respectively. The student agent, with policy $\pi$, receives a reward based on the reward function $\mathcal{R}:S \times A \rightarrow \mathbb{R}$ with a discount factor $\gamma \in [0, 1]$. The student seeks to maximize its expected value for each $\theta$ denoted by $V^{\theta}(\pi) = \mathbb{E}_\pi [\sum_{t=0}^T R(s_t, a_t) \gamma^t$]. The teacher's goal is to select levels forming the curriculum by maximizing a utility function $U(\pi, \theta)$, which depends on $\pi$. 

Different UED approaches vary primarily in the teacher's utility function. {\em Domain Randomization} (DR;~\cite{tobin2017domain}) uniformly randomizes environment parameters, with a constant utility $U^\mathcal{U}(\pi, \theta) = C$, making it agnostic to the student's policy. {\em Minimax training}~\cite{pinto2017robust} adversarially generates challenging levels, with utility $U^\mathcal{M}(\pi, \theta) = -V^\theta (\pi)$, to minimize the student's return. However, this approach incentivizes the teacher to make the levels completely unsolvable, limiting room for learning. Recent UED methods address this by using a teacher that maximizes {\em regret}, defined as the difference between the return of the optimal policy and the current policy. Regret-based utility is defined as $U^\mathcal{R}(\pi, \theta) = \normalfont\textsc{Regret}^\theta(\pi, \pi^*) =  V^\theta(\pi^*) - V^\theta(\pi)$ where $\pi^*$ is the optimal policy on $\theta$. Regret-based objectives have been shown to promote the simplest levels that the student cannot solve optimally, and benefit from the theoretical guarantee of a minimax regret robust policy upon convergence in the two-player zero-sum game. However, since $\pi^*$ is generally unknown, regret must be approximated. ~\citet{dennis2020emergent}, the pioneer UED work, introduced a principled level generation based on the regret objective and proposed the {\em PAIRED} algorithm, where regret is estimated by the difference between the returns attained by an antagonist agent and the protagonist (student) agent. Later on, ~\citet{jiang2021replay} introduced {\em PLR$^\perp$} which combines DR with regret using {\em Positive Value Loss} (PVL), an approximation of regret based on Generalized Advantage Estimation (GAE;~\cite{schulman2015high}):
\begin{align}
\normalfont\textsc{PVL}^\theta(\pi) &= \frac{1}{T} \sum_{t=0}^{T} \max \left( \sum_{k=t}^{T} (\gamma \lambda)^{k-t} \delta^{\theta}_k, 0 \right), \label{eq:gae}     
\end{align}
where $\lambda$ and $T$ are the GAE discount factor and MDP horizon, respectively. $\delta^{\theta}_k$ is the TD-error at time step $k$ for $\theta$. The state-of-the-art UED algorithm, {\em ACCEL}~\cite{parker2022evolving}, improves PLR$^\perp$~\cite{jiang2021replay} by replacing its random level generation with an editor that mutates previously curated levels to gradually introduce complexity into the curriculum.

% The goal of the teacher's policy $\Lambda$ is to generate a distribution over the set of environment parameters, $\Delta(\Theta)$, to train the student to be robust to any $\theta \in \Theta$:
% \begin{align}
% & \Lambda: \Pi \rightarrow \Delta(\Theta) \quad \text{s.t.} \quad \mathop{\max}\limits_{\pi} V^\theta(\pi)= \mathop{\max}\limits_{\pi} \mathbb{E}_{\tau \sim \pi} V^\theta(\tau) = \mathop{\max}\limits_{\pi} \mathbb{E}_{\pi} \Big[\sum_{t=0}^T r_t^\theta \cdot \gamma^t \Big] \nonumber 
% \end{align}
% where $\Pi$ is the set of possible policies of the teacher, $r^{\theta}_t$ is the reward received by student policy $\pi$ in an environment conditioned by $\theta$ at time step $t$, and $T$ is the MDP horizon. 


\section{Related Work} \label{section:related_works}
It is important to note that regret-based UED approaches provide a minimax regret guarantee at Nash Equilibrium; however, they provide no explicit guarantee of convergence to such equilibrium. \citet{beukman2024Refining} demonstrated that the minimax regret objective does not necessarily align with learnability: an agent may encounter UPOMDPs with high regret on certain levels where it already performs optimally (given the partial observability constraints), while there exist other levels with lower regret where it could still improve. Consequently, selecting levels solely based on regret can lead to {\em regret stagnation}, where learning halts prematurely. This suggests that focusing exclusively on minimax regret may inhibit the exploration of levels where overall regret is non-maximal, but opportunities for acquiring transferable skills for generalization are significant. Thus, there is a compelling need for a complementary objective, such as novelty, to explicitly guide level selection towards enhancing zero-shot generalization performance and mitigating regret stagnation.

The {\em Paired Open-Ended Trailblazer} (POET;~\cite{wang2019poet}) algorithm computes novelty based on environment encodings---a vector of parameters that define level configurations. POET maintains a record of the encodings from previously generated levels and computes the novelty of a new level by measuring the average distance between the k-nearest neighbors of its encoding. However, this method for computing novelty is domain-specific and relies on human expertise in designing environment encodings, posing challenges for scalability to complex domains. Moreover, due to UED's underspecified nature, where free parameters may yield a one-to-many mapping between parameters and environments instances, each inducing distinct agent behaviors, quantifying novelty based on parameters alone is futile. 

{\em Enhanced POET} (EPOET;~\cite{wang2020enhanced}) improves upon its predecessor by introducing a domain-agnostic approach to quantify a level's novelty. EPOET is grounded in the insight that novel levels offer new insights into how the behaviors of agents within them differ. EPOET evaluates both active and archived agents' performance in each environment, converting their performance rankings into rank-normalized vectors. The level's novelty is then computed by measuring the Euclidean distance between these vectors. Despite addressing POET's domain-specific limitations, EPOET encounters its own challenges. The computation of rank-normalized vectors only works for population-based approaches as it requires evaluating multiple trained student agents and incurs substantial computational costs. Furthermore, EPOET remains curriculum-agnostic, as its novelty metric relies on the ordering of raw returns within the agent population, failing to directly assess whether the environment elicits rarely observed states and actions in the existing curriculum.

{\em Diversity Induced Prioritized Level Replay} (DIPLR;~\cite{li2023effective}), calculates novelty using the Wasserstein distance between occupancy distributions of agent trajectories from different levels. DIPLR maintains a level buffer and determines a level's novelty as the minimum distance between the agent's trajectory on the candidate level and those in the buffer. While DIPLR incorporates the agent’s experiences into its novelty calculation, it faces significant scalability and robustness issues. First, relying on the Wasserstein distance is notoriously costly. Additionally, DIPLR requires pairwise distance computations between all levels in the buffer, causing computational costs to grow exponentially with more levels. Finally, although DIPLR promotes diversity within the active buffer, it fails to evaluate whether state-action pairs in the current trajectory have already been adequately explored through past curriculum experiences, making it arguably still curriculum-agnostic. Further discussions on relevant literature can be found in Appendix~\ref{section:extended_related_work}. 

\section{Approach: CENIE}
\label{section:cenie_approach}
The limitations of prior approaches to quantifying environment novelty underscore the need for a more robust framework, motivating the development of CENIE. CENIE quantifies environment novelty through state-action space coverage derived from the agent’s accumulated experiences across previous environments in its curriculum. In single-environment online reinforcement learning, coverage within the training distribution is often linked to sample efficiency~\cite{xie2022role}, providing inspiration for the CENIE framework. Given UED’s objective to enhance a student’s generalizability across a vast and often unseen (during training) environment space, quantifying novelty in terms of state-action space coverage has several benefits. By framing novelty in this way, CENIE enables a sample-efficient exploration of the environment search space by prioritizing levels that drive the agent towards unfamiliar state-action combinations. This provides a principled basis for directing the environment design towards enhancing the generalizability of the student agent. Additionally, a distinctive benefit of this approach is that it is not confined to any particular UED or DRL algorithms since it solely involves modeling the agent's state-action space coverage. This flexibility allows us to implement CENIE atop any UED algorithm.

CENIE’s approach to novelty quantification through state-action coverage introduces three key attributes, effectively addressing the limitations of previous methods: (1) \textbf{domain-agnostic}, (2) \textbf{curriculum-aware}, and (3) \textbf{scalable}. CENIE is domain-agnostic, as it quantifies novelty solely based on the state-action pairs of the student, thus eliminating any dependency on the encoding of the environment. CENIE achieves curriculum-awareness by quantifying novelty using a model of the student's past aggregated experiences, i.e., state-action space coverage, ensuring that the selection of environments throughout the curriculum is sample-efficient with regards to expanding the student's state-action coverage. Lastly, CENIE demonstrates scalability by avoiding the computational burden associated with exhaustive pairwise comparisons or costly distance metrics.

% To model the state-action space coverage, we propose the use of {\em Gaussian Mixture Models} (GMMs) to represent the distribution of aggregated experiences from the agent's previous interactions within environments in the curriculum. Note that CENIE describes a general framework for quantifying novelty through state-action space coverage, and GMMs are simply one method among many that could be applied to model the state-action coverage. Future research may explore alternatives to model state-action space coverage within the CENIE framework (see Section ~\ref{section:future_work_limitations} in the appendix for more discussions). Not only do GMMs allow the construction of a parametric approximation of the state-action space coverage GMMs also allow us to assess the likelihood of experiences in new environments. This likelihood indicates the dissimilarity in state-action space coverage, enabling direct comparison of novelty between levels. 
% CENIE's complexity, governed by the Expectation-Maximization (EM) algorithm, is $O(tnkd^3)$, where $t$ is the number of iterations for performing the EM algorithm, $n$ is the number of data points, $k$ is the number of Gaussian kernels and $d$ is the dimensionality of the data. The algorithm's linear dependency on the number of data points enables CENIE to seamlessly model probability density distributions across an extensive horizon of past experiences. While the algorithm does exhibit cubic complexity concerning the number of dimensions due to the matrix inversion step, this constraint can be effortlessly mitigated through dimensionality reduction techniques like Principal Component Analysis (PCA). 
% By addressing the limitations of prior work on quantifying environment novelty, CENIE emerges as a landmark framework within the UED paradigm, allowing for a robust and efficient method for incorporating environment novelty into curricula generation.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.5\linewidth]{figures/cenie/cenie_overview.png}
  \caption{An overview of the CENIE framework. The teacher will utilise environment regret and novelty for curating student's curriculum. $\Gamma$ contains past experiences and $\tau$ is the recent trajectory.}
  \label{fig:algo_overview}
\end{figure}

\subsection{Measuring the Novelty of a Level}
To evaluate the novelty of new environments using the agent's state-action pairs, the teacher needs to first model the student's past state-action space coverage distribution. We propose to use GMMs as they are particularly effective due to their robustness in representing high-dimensional continuous distributions~\cite{bouveyron2007high,assent2012clustering}. A GMM is a probabilistic clustering model that represents the underlying distribution of data points using a weighted combination of multivariate Gaussian components. Once the state-action distribution is modeled using a GMM, we can leverage it for density estimation. Specifically, the GMM allows us to evaluate the likelihood of state-action pairs induced by new environments, where lower likelihoods indicate experiences that are less represented in the student's current state-action space. This likelihood provides a quantitative measure of dissimilarity in state-action space coverage, enabling a direct comparison of novelty between levels. It is important to note that CENIE defines a general framework for quantifying novelty through state-action space coverage; GMMs represent just one possible method for modeling this coverage. Future research may explore alternatives to model state-action space coverage within the CENIE framework (see Section ~\ref{section:future_work_limitations} in the appendix for more discussions). 

Before detailing our approach, we first define the notations used in this section. Let $l_{\theta}$ be a particular level conditioned by an environment parameter $\theta$. We refer to $l_{\theta}$ as the candidate level, for which we aim to determine its novelty. The agent's trajectory on $l_{\theta}$ is denoted as $\tau_{\theta}$, and can be decomposed into a set of sample points, represented as $X_{\theta}=\left\{x=(s, a) \sim \tau_{\theta}\right\}$. The set of past training levels is represented by $L$ and $\Gamma=\left\{x=(s, a) \sim \tau_{L} \right\}$ is a buffer containing the state-action pairs collected from levels across $L$. We treat $\Gamma$ as the ground truth of the agent's state-action space coverage, against which we evaluate the novelty of state-action pairs from the candidate level $X_{\theta}$.

To fit a GMM on $\Gamma$, we must find a set of Gaussian mixture parameters, denoted as $\lambda_\Gamma=\left\{(\alpha_1, \mu_1, \Sigma_1), ..., (\alpha_K, \mu_K, \Sigma_K)\right\}$, that best represents the underlying distribution. Here, $K$ denotes the predefined number of Gaussians in the mixture, where each Gaussian component is characterized by its weight ($\alpha_k$), mean vector ($\mu_k$), and covariance matrix ($\Sigma_k$), with $k \in \left\{1, ..., K\right\}$. We employ the {\em kmeans++} algorithm~\cite{blomer2013simple, arthur2007k} for a fast and efficient initialization of $\lambda_\Gamma$. The likelihood of observing $\Gamma$ given the initial GMM parameters $\lambda_{\Gamma}$ is expressed as:
\begin{align}
P(\Gamma \mid \lambda_{\Gamma}) = \prod_{j=1}^J\sum_{k=1}^{K} \alpha_k \mathcal{N}(x_j \mid \mu_k, \Sigma_k) \label{eq:gmm_ground_truth}
\end{align}
where $x_j$ is a state-action pair sample from $\Gamma$. $\mathcal{N}(x_j \mid \mu_k, \Sigma_k)$ represents the multi-dimensional Gaussian density function for the $k$-th component with mean vector $\mu_k$ and covariance matrix $\Sigma_k$. To optimise $\lambda_{\Gamma}$, we use the Expectation Maximization (EM) algorithm~\cite{dempster1977maximum,redner1984mixture} because Eq. \ref{eq:gmm_ground_truth} is a non-linear function of $\lambda_{\Gamma}$, making direct maximization infeasible. The EM algorithm iteratively refines the initial $\lambda_{\Gamma}$ to estimate a new $\lambda_{\Gamma}'$ such that $P(X \mid \lambda_{\Gamma}') > P(X \mid \lambda_{\Gamma})$. This process is repeated iteratively until some convergence, i.e., $\|\ \lambda_{\Gamma}'-\lambda_{\Gamma} \| < \epsilon$, where $\epsilon$ is a small threshold.

Once the GMM is fitted, we can use $\lambda_{\Gamma}$ to perform density estimation and calculate the novelty of the candidate level $l_\theta$. Specifically, we consider the set of state-action pairs from the agent's trajectory, $X_{\theta}$, and compute their posterior likelihood under the GMM. This likelihood indicates how similar the new state-action pairs are to the learned distribution of past state-action coverage. Consequently, the novelty score of $l_\theta$ is represented as follows:
\begin{align}
\normalfont\textsc{Novelty}_{l_\theta} = -\frac{1}{\lvert X_{\theta}\rvert} \log \mathcal{L}(X_{\theta} \mid \lambda_{\Gamma}) = -\frac{1}{\lvert X_{\theta} \rvert} \sum_{t=1}^T \log p(x_t \mid \lambda_{\Gamma}) \label{eq:log_novelty}
\end{align}
where $x_t$ is a sample state-action pair from $X_{\theta}$. As shown in Eq. \ref{eq:log_novelty}, we take the negative mean log-likelihood across all samples in $X_{\theta}$ to attribute higher novelty scores to levels with state-action pairs that are less likely to originate from the aggregated past experiences, $\Gamma$. This novelty metric promotes candidate levels that induce more novel experiences for the agent during training. More details on fitting GMMs are explained in Appendix \ref{section:fit_gaussian_mixtures}.

\paragraph{Design considerations for the GMM} First, we specifically designate the state-action coverage buffer, i.e., $\Gamma$, as a First-In-First-Out (FIFO) buffer with a fixed window length. By focusing on a fixed window rather than the entire history of state-action pairs, our novelty metric avoids bias toward experiences that are outdated and have not appeared in recent trajectories. This design choice helps reduce the effects of catastrophic forgetting prevalent in DRL. Next, it is known that by allowing the adaptation of the number of Gaussians in the mixture, i.e., $K$ in Eq. \ref{eq:gmm_ground_truth}, any smooth density distribution can be approximated arbitrarily close~\cite{figueiredo2000gaussian}. Therefore, to optimize the GMM's representation of the agent's state-action coverage distribution, we fit multiple GMMs with varying numbers of Gaussians within a predefined range at each time step and select the best one based on the silhouette score~\cite{rousseeuw1987silhouettes}, an approach inspired by~\citet{portelas2019alpgmm}. The silhouette score evaluates clustering quality by measuring both intra-cluster cohesion and inter-cluster separation. This approach enables CENIE to construct a pseudo-online GMM model that dynamically adjusts its complexity to accommodate the agent's changing state-action coverage distribution.

\subsection{State-Action Space Coverage Directed Training Agent}
\label{section:state-action-coverage-training}

%%%%%%%%%%%%%%%%%%%%%%%%% pseudocodes %%%%%%%%%%%%%%%%%%%%%%%%%
\begin{algorithm}[h]
    \caption{ACCEL-CENIE}
    \label{alg:accel_cenie}
    \textbf{Input}: Level buffer size $N$, \textcolor{blue}{Component range $[K_{\text{min}}$}, \textcolor{blue}{$K_{\text{max}}]$, FIFO window size $\mathcal{W}$}, level generator $\mathcal{G}$ \\
    \textbf{Initialize}: Student policy $\pi_\eta$, level buffer $\mathcal{B}$, \textcolor{blue}{state-action buffer $\Gamma$, GMM parameters $\lambda_{\Gamma}$}
    
    \begin{algorithmic}[1]
    \STATE Generate $N$ initial levels by $\mathcal{G}$ to populate $\mathcal{B}$ 
    \STATE Collect $\pi_\eta$'s trajectories on each level in $\mathcal{B}$ and fill up $\Gamma$ 
    
    \WHILE{not converged}
    \STATE Sample replay decision, $\epsilon \sim U[0, 1]$
    \IF {$\epsilon \geq 0.5$}
    \STATE Generate a new level $l_{\theta}$ by $\mathcal{G}$
    \STATE Collect trajectories $\tau$ on $l_{\theta}$, with stop-gradient $\eta_{\perp}$ 
    \begingroup
    \color{blue}
    \STATE {Compute novelty score for $l_{\theta}$ using $\lambda_{\Gamma}$} (Eq.\ref{eq:log_novelty} and Eq.\ref{eq:replay_prob})
    \endgroup
    \STATE Compute regret score for $l_{\theta}'$ (Eq.\ref{eq:gae} and Eq.\ref{eq:replay_prob})
    \STATE Update $\mathcal{B}$ with $l_{\theta}$ if $P_{replay}(l_{\theta})$ is greater than that of any levels in $\mathcal{B}$ (Eq.\ref{eq:level_replay_weightage})
    \ELSE
    \STATE Sample a replay level $l_{\theta} \sim \mathcal{B}$ according to $P_{replay}$
    \STATE Collect trajectories $\tau$ on $l_{\theta}$
    \STATE Update $\pi_\eta$ with rewards $R(\tau)$
    \begingroup
    \color{blue}
    \STATE {Update $\Gamma$ with $\tau$ and resize to $\mathcal{W}$}
    \FOR {$k$ in range $K_{\text{min}}$ to $K_{\text{max}}$}
    \STATE Fit a GMM$_k$ with $k$ components on $\Gamma$ and compute its silhouette score
    \ENDFOR
    \STATE Select GMM parameters with the highest silhouette score to replace $\lambda_{\Gamma}$
    \endgroup
    \STATE Perform edits on $l_{\theta}$ to produce $l_{\theta}'$
    \STATE Collect trajectories $\tau$ on $l_{\theta}'$, with stop-gradient $\eta_{\perp}$ 
    \begingroup
    \color{blue}
    \STATE {Compute novelty score for $l_{\theta}'$ using $\lambda_{\Gamma}$} (Eq.\ref{eq:log_novelty} and Eq.\ref{eq:replay_prob})
    \endgroup
    \STATE Compute regret score for $l_{\theta}'$ (Eq.\ref{eq:gae} and Eq.\ref{eq:replay_prob})
    \STATE Update $\mathcal{B}$ with $l_{\theta}'$ if $P_{replay}(l_{\theta}')$ is greater than that of any levels in $\mathcal{B}$ (Eq.\ref{eq:level_replay_weightage})
    \ENDIF
    \ENDWHILE
    \end{algorithmic}
\end{algorithm}
%%%%%%%%%%%%%%%%%%%%%%%%% pseudocodes %%%%%%%%%%%%%%%%%%%%%%%%%

With a scalable method to quantify the novelty of levels, we demonstrate its versatility and effectiveness by deploying it on top of the leading UED algorithms, PLR$^\perp$ and ACCEL. For convenience, in subsequent sections, we will refer to this CENIE-augmented methodology of PLR$^\perp$ and ACCEL using GMMs as PLR-CENIE and ACCEL-CENIE, respectively. Both PLR$^\perp$ and ACCEL utilize a replay mechanism to train their students on the highest-regret levels curated within the level buffer. To integrate CENIE within these algorithms, we use normalized outputs of a prioritization function to convert the level scores (novelty and regret) into level replay probabilities ($P_{S}$):
\begin{align}
P_{S} = \frac{h(S_i)^{\beta}}{\sum_j h(S_j)^{\beta}} \label{eq:replay_prob}
\end{align}
where $h$ is a prioritization function (e.g. rank) with a tunable temperature $\beta$ that defines the prioritization of levels with regards to any arbitrary score $S$. Following the implementations in PLR$^\perp$ and ACCEL, we employ $h$ as the rank prioritization function, i.e., $h(S_i) = 1/{\text{rank}(S_i)}$, where $\text{rank}(S_i)$ is the rank of level score $S_i$ among all scores sorted in descending order. In ACCEL-CENIE and PLR-CENIE, we use both the novelty and regret scores to determine the level replay probability:
\begin{align}
P_{replay} = \alpha \cdot P_N + (1-\alpha) \cdot P_R
\label{eq:level_replay_weightage}
\end{align}
where $P_N$ and $P_R$ are the novelty-prioritized probability and regret-prioritized probability respectively, and $\alpha$ allows us to adjust the weightage of each probability. The complete procedures for ACCEL-CENIE are provided in Algorithm \ref{alg:accel_cenie}, and for PLR-CENIE in the appendix (see Algorithm \ref{alg:plr_cenie}). Key steps specific to CENIE using GMMs are highlighted in \textcolor{blue}{blue}.


\section{Experiments} \label{section:experiment_section}
In this section, we benchmark PLR-CENIE and ACCEL-CENIE against their predecessors and a set of baseline algorithms: Domain Randomization (DR), Minimax, PAIRED, and DIPLR. The technical details of each algorithm are presented in Appendix \ref{app:baseline_algos}. We empirically demonstrated the effectiveness of CENIE on three distinct domains: Minigrid, BipedalWalker, and CarRacing. Minigrid is a partially observable navigation task under discrete control with sparse rewards, while BipedalWalker and CarRacing are partially observable continuous control tasks with dense rewards. Due to the complexity of mutating racing tracks, CarRacing is the only domain where ACCEL and ACCEL-CENIE are excluded. The experiment details are provided in Appendix \ref{section:implementation_details}. Following standard UED practices, all agents were trained using Proximal Policy Optimization (PPO; \cite{schulman2017proximal}) across the domains, and we present their zero-shot performance on held-out tasks. We also conducted ablation studies to assess the isolated effectiveness of CENIE's novelty metric (see Appendix \ref{section:ablation_studies}).

For reliable comparison, we employ the standardized DRL evaluation metrics \cite{agarwal2021deep}, presenting the aggregate inter-quartile mean (IQM) and optimality gap plots after normalizing the performance with a min-max range of solved-rate/returns. Specifically, IQM focuses on the middle 50\% of combined runs, discarding the bottom and top 25\%, thereby providing a robust measure of overall performance. Optimality gap captures the amount by which the algorithm fails to meet a desirable target (e.g., 95\% solved rate), beyond which further improvements are considered unimportant. Higher IQM and lower optimality gap scores are better. The hyperparameters for the algorithms in each experiment are specified in the appendix.

% Note that the state-action spaces in these domains are highly dimensional, particularly in Minigrid and CarRacing, where the student processes visual observations (i.e., RGB images) resulting in state-action space dimensions of 257 and 259, respectively. In BipedalWalker, the state-action space has 28 dimensions. Evaluating the performance of CENIE-augmented algorithms in these domains enables us to empirically validate the robustness of GMMs in handling high-dimensional spaces.


\subsection{Minigrid Domain}
\label{subsection:minigrid}
First, we validated the CENIE-augmented methods in Minigrid~ \cite{dennis2020emergent,MinigridMiniworld23}, a popular benchmark due to its ease of interpretability and customizability. Given its sparse reward signals and partial observability, navigating Minigrid requires the agent to explore multiple possible paths before successfully solving the maze and receiving rewards for policy updates. Therefore, Minigrid is an ideal domain to validate the exploration capabilities of the CENIE-augmented algorithms.

\begin{figure}[h]
  \centering
  \includegraphics[width=1.0\linewidth]{figures/cenie/mg_results.png}
  \caption{Zero-shot transfer performance in eight human-designed test environments. The plots are based on the median and interquartile range of solved rates across 5 independent runs.}
  \label{fig:mg_results}
  % \vspace{-1em}
\end{figure}


Following prior UED works, we train all student agents for 30k PPO updates (approximately 250 million steps) and evaluate their generalization on eight held-out environments (see Figure \ref{fig:mg_results}). Figure \ref{fig:mg_results} demonstrates that ACCEL-CENIE outperforms ACCEL in all testing environments. Moreover, PLR-CENIE shows significantly better performance in seven test environments compared to PLR$^\perp$. This underscores the ability of CENIE's novelty metric to complement the UED framework, particularly in improving generalization performance beyond the conventional learning potential metric, regret. Further empirical validation in Figure \ref{figure:mg_iqm} confirms ACCEL-CENIE's superiority over ACCEL in both IQM and optimality gap. PLR-CENIE also outperforms its predecessor, PLR$^\perp$, by a significant margin. Notably, PLR-CENIE's performance is able to match ACCEL's, which is significant considering PLR-CENIE uses a random generator while ACCEL uses an editing mechanism to introduce gradual complexity to environments. 

\begin{figure}[htbp]
\centering
\subfigure[]{
    \begin{minipage}[t]{0.5\linewidth}
    \centering
    \includegraphics[width=2.6in]{figures/cenie/mg_iqm.png}
    \end{minipage}%
    \label{figure:mg_iqm}
}%
\subfigure[]{
    \begin{minipage}[t]{0.5\linewidth}
    \centering
    \includegraphics[width=2.6in]{figures/cenie/mg_largemaze.png}
    \end{minipage}%
    \label{figure:mg_largemaze}
}%
\centering
\caption{(a) Aggregate zero-shot transfer performance in Minigrid domain across 5 independent runs. (b) Zero-shot test performance of PLR$^\perp$, PLR-CENIE, ACCEL, and ACCEL-CENIE on PerfectMazeLarge across 5 independent runs.}
\label{fig:mg_iqm_largemaze_results}
% \vspace{-1em}
\end{figure}

Beyond the normal-size testing mazes, we consider a more challenging evaluation setting. We evaluate the fully-trained student policy of PLR$^\perp$, PLR-CENIE, ACCEL, and ACCEL-CENIE on \texttt{PerfectMazeLarge} (shown in Figure \ref{figure:mg_largemaze}), an out-of-distribution environment which has $51 \times 51$ tiles and a episode length of 5000 timesteps -- a much larger scale than training levels. We evaluate the agents for 100 episodes (per seed), using the same checkpoints in Figure \ref{fig:mg_results}. ACCEL-CENIE and ACCEL achieved comparable zero-shot transfer performance. Notably, PLR-CENIE achieved close to 50\% solved rate, matching ACCEL's performance. This is a significant improvement from PLR$^\perp$, which had less than a 10\% solved rate. 


\subsection{BipedalWalker Domain}
\begin{figure}[ht]
  \centering
  \includegraphics[width=1.0\linewidth]{figures/cenie/bw_results.png}
  \caption{Student's generalization performance on 6 BipedalWalker testing environments during training. Each curve is measured across 5 independent runs (mean and standard error).}
  \label{fig:bw_results}
  % \vspace{-1em}
\end{figure}

We also evaluated the CENIE-augmented algorithms in the BipedalWalker domain~\cite{wang2019poet,parker2022evolving}, which is a partially observable continuous domain with dense rewards. We train all the algorithms for 30k PPO updates ($\sim$1B timesteps) and then evaluate their generalization performance on six distinct test environments: BipedalWalker (default), Hardcore, Stair, PitGap, Stump, and Roughness (visualized in Figure~\ref{figure:bw_domain}). To monitor the student's generalization performance evolution, we assess the student policy every 100 PPO updates across six testing environments during the training period.


In Figure \ref{fig:bw_results}, ACCEL-CENIE outperforms ACCEL in five testing environments, with both achieving parity in the Roughness challenge, establishing ACCEL-CENIE as the leading UED algorithm in BipedalWalker. Similarly, PLR-CENIE consistently outperforms PLR$^\perp$ across all testing instances, except for the Stump challenge, where both algorithms exhibit similar performance. We present the aggregate results after min-max normalization (with range=[0, 300] on all test environments) in Figure \ref{figure:bw_iqm}. Both ACCEL-CENIE and PLR-CENIE exhibit better performance compared to their predecessors in the IQM and optimality gap metrics. Notably, ACCEL-CENIE outperforms all benchmarks by a substantial margin, achieving close to 55\% of optimal performance. 

\begin{table}[h]
\caption{Coverage of state-action space across 30k PPO updates in the BipedalWalker domain.}
\label{tab:state_action_coverage_percentage}
\centering
\begin{tabular}{lcccc}
\toprule
\textbf{} & PLR$^\perp$ & PLR-CENIE & ACCEL & ACCEL-CENIE \\ 
\midrule
\begin{tabular}[c]{@{}c@{}}State-action \\ Space Coverage\end{tabular} &43.4\% &55.3\% &42.5\% &47.6\% \\ 
\bottomrule
\end{tabular}
% \vspace{-1em}
\end{table}

Next, we tracked the evolution of state-action space coverage throughout training to evaluate the impact of CENIE’s novelty objective on the curriculum’s exploration of the state-action space. During training, state-action pairs encountered by the agent were collected for both PLR$^\perp$ and ACCEL, along with their CENIE-augmented versions. To visualize the distribution of these high-dimensional state-action pairs, we applied t-distributed Stochastic Neighbor Embedding (t-SNE;~\cite{van2008visualizing}) to project them into a 2-D space. The resulting evolution plot and detailed implementation steps are provided in Appendix \ref{section:bipedal-walker-extended}. Afterwards, we quantified state-action space coverage by discretizing the 2-D scatterplot into cells and calculating the percentage of total cells occupied by each algorithm. As shown in Table \ref{tab:state_action_coverage_percentage}, CENIE drives ACCEL-CENIE and PLR-CENIE to achieve significantly broader state-action coverage by the end of 30k PPO updates compared to their predecessors. This evidence supports that the inclusion of CENIE's novelty objective for level replay prioritization contributes to broader state-action space coverage. 

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.65\linewidth]{figures/cenie/level_composition.png}
    \caption{Difficulty composition of levels replayed by ACCEL and ACCEL-CENIE during training.}
    \label{fig:level_composition}
    % \vspace{-1em}
\end{figure}

To understand ACCEL-CENIE's improvement over ACCEL, we analyzed the difficulty composition of replayed levels at various training intervals across five seeds, as shown in Figure \ref{fig:level_composition}. Level difficulty is assessed based on environment parameters such as stump height and pit gap width, using metrics adapted from \citet{wang2019poet} (details in Appendix~\ref{section:bipedal-walker-extended}). It is evident that ACCEL predominantly favors ``Easy'' to ``Moderate'' difficulty levels, whereas ACCEL-CENIE progressively incorporates ``Challenging'' levels into its replay selection throughout training. 

The disparity in level difficulty distribution between ACCEL and ACCEL-CENIE is a critical factor in understanding their observed performance differences. ACCEL's training curriculum tends to remain within a comfort zone, consistently selecting a limited subset of simpler levels where the agent experiences high regret. However, this can be problematic when considering the regret stagnation problem. Specifically, in the event where the easier levels exhibit {\em irreducible regret}, it can restrict the agent's exposure to more complex scenarios, thereby constraining its generalization potential. In contrast, ACCEL-CENIE’s integration of a novelty objective actively selects challenging levels, pushing the agent beyond its comfort zone into unfamiliar, complex environments. This novelty-based regularization fosters the exploration of under-explored regions in the state-action space, even if regret levels are low, thereby enhancing the agent’s generalization capabilities. Furthermore, with a mutation-based approach like ACCEL, this environment selection strategy may generate or mutate new levels with high learning potential, further enriching the training curriculum.


% Note that our figure differs from Figure 12 in \citet{parker2022evolving} which shows the difficulty distribution of the levels \textbf{generated and added into the buffer}, but not the actual levels selected by the teacher for the student to \textbf{replay/train on}. On that note, this also demonstrates that CENIE remedies an inefficiency in the original ACCEL algorithm, where mutation-based generation constantly produces high complexity levels but are not selected for student training due to solely depending on regret for level prioritization. 


\begin{figure}[htbp]
\centering
\subfigure[]{
    \begin{minipage}[t]{0.5\linewidth}
    \centering
    \includegraphics[width=2.6in]{figures/bw_domain.png}
    \end{minipage}%
    \label{figure:bw_domain}
}%
\subfigure[]{
    \begin{minipage}[t]{0.5\linewidth}
    \centering
    \includegraphics[width=2.6in]{figures/cenie/bw_iqm_results.png}
    \end{minipage}%
    \label{figure:bw_iqm}
}%
\centering
\caption{(a) BipedalWalker domain and (b) Aggregate zero-shot transfer performance in BipedalWalker.}
\label{fig:bw_cr_domain}
% \vspace{-1em}
\end{figure}

\subsection{CarRacing Domain}
Finally, we evaluated the effectiveness of CENIE by implementing it on PLR$^\perp$ within the \texttt{CarRacing} domain~\cite{brockman2016openai,jiang2021replay}. In this domain, the teacher manipulates the curvature of racing tracks using Bézier curves defined by a sequence of 12 control points, while the student drives on the track under continuous control with dense rewards. We train the students in each algorithm for 2.75k PPO updates ($\sim$5.5M steps), after which we test the zero-shot transfer performance of the different algorithms on 20 levels replicating real-world Formula One (F1) tracks introduced by \citet{jiang2021replay}. These tracks are guaranteed to be OOD as their configuration cannot be defined by Bézier curves with only 12 control points. The middle image in Figure \ref{fig:bw_cr_domain}b shows a track generated by domain randomization and the rightmost image shows a bird's-eye view of the F1-USA benchmark track.

\begin{figure}[htbp]
\centering
\subfigure[]{
    \begin{minipage}[t]{0.5\linewidth}
    \centering
    \includegraphics[width=2.6in]{figures/cr_domain.png}
    \end{minipage}%
    \label{figure:cr_domain}
}%
\subfigure[]{
    \begin{minipage}[t]{0.5\linewidth}
    \centering
    \includegraphics[width=2.6in]{figures/cenie/cr_iqm_results.png}
    \end{minipage}%
    \label{figure:cr_iqm}
}%
\centering
\caption{(a) CarRacing domain and (b) Aggregate zero-shot transfer performance in CarRacing.}
\label{fig:bw_cr_iqm_results}
% \vspace{-1em}
\end{figure}


The aggregate performance after min-max normalization of all algorithms is summarized in Figure \ref{fig:bw_cr_iqm_results}b. Note that the min-max range varies across F1 tracks due to different specifications on the maximum episode steps (see Table \ref{tab:car_racing_min_max} in the appendix for more details). Once again, the CENIE-augmented algorithm, PLR-CENIE, achieves the best generalization performance in both IQM and optimality gap scores. Table \ref{tab:carracing_all_results} in the appendix shows the zero-shot transfer returns on all 20 F1 tracks. PLR-CENIE consistently outperforms or matches the best-performing baseline on all tracks.


\begin{wrapfigure}{r}{0.35\textwidth}
    \centering
    \vspace{-1.5em}
    \includegraphics[width=1.0\linewidth]{figures/cenie/regret_comparison_cr.png}
    \vspace{-1.5em}
    \caption{Total regret in level replay buffer for PLR$^\perp$ and PLR-CENIE over training in CarRacing.}
    \label{fig:regret_compairson}
\end{wrapfigure}

Figure \ref{fig:regret_compairson} presents the total regret in the level replay buffer for both PLR$^\perp$ and PLR-CENIE throughout the training process. Interestingly, PLR-CENIE maintains comparable, or even slightly higher, levels of regret across the training distribution, despite not directly optimizing for it. This outcome suggests that CENIE's novelty objective synergizes with the discovery of high-regret levels, providing counterintuitive evidence that optimizing solely for regret is not the only, nor necessarily the most effective, strategy for identifying levels with high learning potential (as approximated by regret). Intuitively, value predictions are inherently less reliable in regions of lower coverage density--areas characterized by higher entropy or high uncertainty regarding optimal actions--since these regions are less frequently sampled for agent's learning. These high-entropy regions are prime candidates for high-regret outcomes, especially when using a bootstrapped regret estimate, as in Eq.~\ref{eq:gae}, due to the value estimation error in such states. By pursuing novel environments based on coverage, CENIE indirectly enhances the discovery of high-regret states, highlighting that novelty-driven autocurricula can effectively complement regret-based methods in uncovering diverse and challenging training scenarios.



\section{Conclusion}
In this paper, we introduced Coverage-based Evaluation of Novelty In Environment (CENIE), a scalable, domain-agnostic, and curriculum-aware framework for quantifying environment novelty in UED. We then proposed an implementation of CENIE that models this coverage and measures environment novelty using Gaussian Mixture Models. By incorporating CENIE with existing UED algorithms, we validated the framework's effectiveness in enhancing agent exploration capabilities and zero-shot transfer performance across three distinct benchmark domains. This promising approach marks a significant step towards unifying novelty-driven exploration and regret-driven exploitation for training generally capable RL agents. We encourage motivated readers to refer to the appendix for further studies and discussions on CENIE.



\section*{Acknowledgments}
This research/project is supported by the National Research Foundation Singapore and DSO National Laboratories under the AI Singapore Programme (AISG Award No: AISG2-RP-2020-017) and Lee Kuan Yew Fellowship awarded to Pradeep Varakantham.



\input{neurips_2024.bbl}
\bibliographystyle{abbrvnat}

\clearpage
\appendix
\input{appendix}

% \clearpage
% \input{checklist}


\end{document}