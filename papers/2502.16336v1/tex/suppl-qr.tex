% !TEX root = ../main.tex

\subsection{Conditional Quantiles in the Reproducing Kernel Hilbert Space}
  In the RKHS setting, the unknown true conditional $(1-\alpha)$-quantile is assumed to be inside an RKHS $\mathcal{H}$.
  The RKHS space is associated to a kernel $K_{h_{X}}(\cdot,\cdot)$, and we denote by $\|\cdot\|_{\mathcal{H}}$ the RKHS norm. $\tau$ can be estimated by minimizing the empirical risk plus a regularizer:
  \begin{equation}\label{eq:def:tau-rkhs}
    \tau
    = \underset{\tilde{\tau} \in \mathcal{H}}{\arg \min } \sum_{i=1}^N \rho_{1-\alpha}\pr{\tilde{V}_{\varphi}(X_{k},Y_{k})-\tau(X_{k})} + \lambda \|\tilde{\tau}\|_{\mathcal{H}}^2
  \end{equation}
  where $\lambda > 0$ is a regularizing hyperparameter.
  Following~\cite{takeuchi2006nonparametric}, we compute the dual optimization problem to~\eqref{eq:def:tau-rkhs}. This results in a quadratic optimization problem. 
  Using the connection between RKHS and it's feature space, we write $\tau(x) = \langle \phi(x), w \rangle$ and we obtain the following equivalent to minimizing~\eqref{eq:def:tau-rkhs}:
  \begin{align*}
    &\underset{w, \xi_{k}, \xi_{k}^{*}}{\operatorname{minimize}}
    \ac{
      \frac{1}{\lambda \ccount}\sum_{i=1}^{\ccount} \br{\alpha \xi_{k}+(1-\alpha) \xi_{k}^*}
      + \frac{1}{2} \|w\|^2
    }
    \\
    &
    \text { subject to } 
    \tilde{V}_{\varphi}(X_{k},Y_{k}) - \textstyle \sum_{i=1}^{\ccount} a_{i} K_{h_{X}}(X_{i}, X_k)
    \le \xi_{k} \text { and }
    \\
    &
    \textstyle \sum_{i=1}^{\ccount} a_{i} K_{h_{X}}(X_{i}, X_k) -\tilde{V}_{\varphi}(X_{k},Y_{k}) 
    \le \xi_{k}^* \text { where } \xi_{k}, \xi_{k}^* 
    \ge 0.
  \end{align*}
  %
  The dual of this problem can be computed straightforwardly using Lagrange multipliers. The dual constraints for $\xi_{1:\ccount}$ and $\xi_{1:\ccount}^*$ can be combined into one variable. This yields the following dual optimization problem
  \begin{equation*}
    \underset{a\in\R^d}{\min} \ac{ \frac{1}{2} a^{T} \mathbf{K}_{h_{\ccount}} a-a^{T} Y_{1:\ccount} } 
    \text { subject to } \frac{\alpha-1}{\lambda \ccount} \le a_{k} \le \frac{\alpha}{\lambda \ccount}
    ,
  \end{equation*}
  where $\mathbf{K}_{h_{\ccount}}=(K_{h_{X}}(X_i,X_j))_{i,j=1}^{\ccount}$.
  We recover the conditional quantile estimator as
  \begin{equation*}
    \tau(x)=\sum\nolimits_{k=1}^{\ccount} a_{k} K_{h_{X}}\pr{X_{k}, x}.  
  \end{equation*}
