\documentclass[submission,copyright,creativecommons]{eptcs}
\providecommand{\event}{ICLP 2024} % Name of the event you are submitting to

\usepackage{iftex}

\ifpdf
  \usepackage{underscore}         % Only needed if you use pdflatex.
  \usepackage[T1]{fontenc}        % Recommended with pdflatex
\else
  \usepackage{breakurl}           % Not needed if you use pdflatex only.
\fi

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{url}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{amsthm}

\input{macro}
\input{HI-Maude_Listings}
%\usepackage[toc,page]{appendix}

\renewcommand\UrlFont{\color{blue}\rmfamily}

%\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]

\newtheorem{lemma}{Lemma}[section]

\newtheorem{property}{Property}[section]


\begin{document}


%% The "title" command
\title{Modular Stochastic Rewritable Petri Nets}

\author{Lorenzo Capra
\institute{
	{Dipartimento di Informatica}\\ {Universit{\`a} degli Studi di Milano}, Italy
}
}

\def\titlerunning{Modular Stochastic Rewritable Petri Nets}
\def\authorrunning{Lorenzo Capra}

\maketitle

\input{abstract.tex}

\section{Introduction}
\label{sec:intro}
\input{intro}

\section{(Stochastic) PT nets, \texttt{Maude}, and demonstrative example}
\label{sec:backgr}
\input{background}

\paragraph{Running example: fault-tolerant production line}
\label{sec:exe}
\input{example}


\section{Modular Rewritable Stochastic PN: Symmetries and Lumpability}
\label{sec:rewPT}
\input{modrewPT}

\section{Getting the Lumped CTMC generator from RwSPT}
\label{sec:CTMC}
\input{ctmc}


\section{Conclusion and Future Work}
We have developed a lumped Markov process for modular and rewritable Petri nets (RwPT), a flexible model of adaptive distributed systems.
%encoded in \texttt{Maude}.
RwPTs, which we construct and manipulate using a small set of algebraic operators, exhibit structural symmetries that result in an efficient quotient state-transition graph.
%Using an example of a gracefully degrading system,
We have outlined a semi-automatic procedure for deriving the CTMC infinitesimal generator from the RwPT quotient graph. Future efforts will focus, on the one hand, on exploring orthogonal structured solutions and, on the other, on fully implementing the process and integrating it into graphical editors.
%such as \texttt{DrawNET} (\url{https://www.draw-net.com/}). 
%Simultaneously,
We aim to broaden the approach
%on one side,
to derive a lumped Markov process 
%from rewritable GSPN, and on the other, to extract the infinitesimal CTMC generator
from any \texttt{Maude} specification.


%% Define the bibliography file to be used
\bibliographystyle{eptcs}
\bibliography{lc}

\end{document}
\newpage
\appendix
\section{Appendix: Figures and \texttt{Maude} excerpts}
\label{apx:ap1}

\begin{figure}[htbp]
   \begin{center}    
    \begin{tabular}{c}
        \fbox{\includegraphics[scale=0.5]{figures/PL}}\\
        $\Downarrow$\\

  \fbox{\includegraphics[scale=0.5]{figures/degrPL}}
    \end{tabular}
    \end{center}
    \caption{Production Line (PL) and adaptation following a fault.}
    \label{fig:FMS}
%\end{figure}

%\begin{figure}[htbp]
   \begin{center}    
    \begin{tabular}{rl}
        \fbox{\includegraphics[scale=0.33]{figures/2PL}}&
        $\Rightarrow$
        \fbox{\includegraphics[scale=0.33]{figures/2PL1F}}
        $\Rightarrow$\\
        $~$&$~$\\
        $\Rightarrow$
        \fbox{\includegraphics[scale=0.33]{figures/2PL2F}}&
        $\Rightarrow$
        \fbox{\includegraphics[scale=0.33]{figures/2PLfinal}}
    \end{tabular}
    \end{center}
    \caption{One of the possible paths of the Gracefully Degrading Production System.}
    \label{fig:symPL-degarde2}
\end{figure}

\noindent The following are the listings relevant to the procedures described in this paper.

{\small
\begin{lstlisting}[frame=single,caption=Topological enabling condition \label{lst:l2-bis},language=maude]
vars X Y Z X' : Pbag .
op hasConcession : Tmatrix  Pbag -> Bool .
eq hasConcession([X,Y,Z], X') = X <= X' and-then Z > X' .
\end{lstlisting}}

{\small
\begin{lstlisting}[frame=single,,caption=Modular Specification of a Fault Tolerant Production System \label{lst:l3},language=maude]
fmod FTPL is
 pr NET-OP{SPTlab} .
 ops PL PLA nomPL faultyPL NfaultyPL : NzNat -> Net . 
 op faultySys : NzNat -> System . 
 op NPL  : NzNat NzNat -> Net [memo]. 
 op NPLsys : NzNat NzNat NzNat -> System . 
 ops loadLab asLab failLab workLab : -> Tlab [memo] .
 eq loadLab = << "ld",0, 0.5 >> .
 eq asLab = << "as",0, 2.0 >> .
 eq workLab = << "ln",0, 0.1 >> .
 eq failLab = << "ft",0, 0.001 >> .
 var I  : Nat . 
 vars N K M : NzNat .
 eq line =  [1 . p(< "w" ; 0 >),1 . p(< "a" ; 0 >),1 . p(< "f" ; 0 >) ] |-> workLab .
 eq fault = [1 . p(< "o" ; 0 >) , 1 . p(< "f" ; 0 >), nilP ] |-> failLab .
 eq load  = [1 . p(< "s" ; 0 >) , 1 . p(< "w" ; 0 >) , nilP ] |-> loadLab .
 eq ass   = [1 . p(< "a" ; 0 >) , 1 . p(< "s" ; 0 >)  , nilP ]  |-> asLab .
 eq cycle = load ; line ; ass ; fault .
 eq PL(K) = repl&share(cycle, K, "L", p (< "o" ; 0 >) U p(< "s" ; 0 >), asLab U loadLab) .
 eq NPL(N, K) = repl&share(PL(K), N, "PL", p(< "s" ; 0 >), emptyStlab) . 
 eq NPLsys(N, K, M) = setMark(setMark(NPL(N, K), "o" "PL", 1), "s", K * M) .
 ...
endfm
\end{lstlisting}
}

{\small
\begin{lstlisting}[frame=single,caption=Rewrite rule of a PL (the label contains the rule's exponential rate) \label{lst:l4},language=maude,label=list:rewrules]
vars S S' S'' : Pbag .
vars I  J : Nat .
var Sys Sys' : System .
var L : Lab .
crl [r1-0.005] : N  S => normalize(join(Sys, setMark(setMark(Sys', "w" "fPL", | match(S', "w") |), "a" "fPL", | match(S', "a") |)))  
if  S'' + 1 . p(< "f" ; J > L < "PL" ; I >) := S /\ N' := nomPL(I) /\ dead (N' S) /\ S' := subag(S'', < "PL" ; I >) /\ Sys := detache(N, N') S'' - S' /\ Sys' := faultySys(notIn(N, "fPL"))  .
\end{lstlisting}
}

{\small
\begin{lstlisting}[frame=single,caption=TS encoding for the lumped CTMC \label{lst:l5} ,language=maude,label=list:rewrules]
var N : Net .
vars M M' : Pbag .  
var  TS    : TagSet .
var  FS   : Fset .
var  RS   : Rset .
op NET:_ M:_ FIRING:_REW:_ : Net Pbag Fset Rset -> StateTranSys [ctor] .
op toStateTran : System -> StateTranSys . 
eq toStateTran(N M) = NET: N  M: M FIRING: fire(enabled(N M), M) REW: allRew(N M) . 
***
rl [sfiring] : NET: N M: M FIRING: (TS --> M', FS) REW: RS => toStateTran(N M') .

\end{lstlisting}
}


%%
%% If your work has an appendix, this is the place to put it.
%\appendix

%\section{Appendix - Maude specification of rewritable PT nets}
%\input{latex/appendixA}

%\section{Appendix - auxiliary Maude modules}
%\input{latex/AppendixB}
