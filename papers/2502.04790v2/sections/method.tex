\section{Methodology}

\label{sec:methodology}


In this section, we first introduce the overall process of \({\text{S}^2\text{-MAD}}\) along with the details of Decision-Making Mechanism. And then we provide mathematical analysis of the token cost for our method subsequently.


\subsection{Selective Sparse MAD Process} \label{}

As illustrated in Figure \ref{fig:framework}, the debate process of \({\text{S}^2\text{-MAD}}\) consists of three main stages: the generation of initial responses, group discussions under the Decision-Making Mechanism and finally reaching consensus. 

\paragraph{Initial Response Generation.} In the initial round of debate, each agent is initialized as a LLM. To simulate diverse thought processes and ensure the generation of varied solutions, we employ a random decoding strategy by adjusting the temperature of model. During the first round, all agents independently produce their respective solutions for the given problem. 

%\paragraph{Initial Response Generation} In the initial round of debate, each agent is initialized as a LLM. We employ a random decoding strategy by varying model temperatures to simulate divergent thought processes, thereby ensuring the generation of diverse solutions. During the first round, all agents independently produce their respective solutions to the given problem. 

\paragraph{Grouping Discussion with Decision-Making Mechanism.} From the second round onward, the Decision-Making Mechanism empowers agents to evaluate whether to engage in debate by assessing the similarity of intra- or inter-group viewpoints relative to their own perspectives. Agents will actively participate in debates when they encounter responses that present differing viewpoints, either from within their group or from other groups. Following these discussions, agents update their answers accordingly based on insights gained during the debate process. 

\paragraph{Reaching Consensus.} Our approach incorporates an early termination mechanism that allows us to conclude the debate when information has been exchanged between groups and all summarized viewpoints align. Conversely, if discrepancies remain among agents' solutions after the debate concludes, a majority vote will determine which solution is accepted as consensus.

%If all viewpoints within a group are identical, participation in that round's debate is paused. Importantly, recognizing the potential for consensus among all agents, we incorporate an early stopping mechanism into our approach. When information is exchanged between groups and it becomes evident that all summarized viewpoints align consistently, we conclude the debate prematurely and adopt this common viewpoint as the final solution. However, if discrepancies persist among agents' solutions after debate has concluded, a majority vote among all participating agents determines which solution will be accepted as consensus.

\subsection{Decision-Making Mechanism} Upon receiving information, the Decision-Making Mechanism first employs the Similarity Calculation Module to calculate similarities among different pieces of information. Subsequently, it eliminates redundant perspectives of agents through the Redundancy Filtering Module. Finally, Conditional Participation Module is utilized to determine whether the agent should engage in the debate.

%After receiving the Agent's information, the decision mechanism initially employs the similarity computation module to calculate dissimilarities among different pieces of information. Subsequently, it eliminates redundant perspectives of the Agent through the redundancy filtering module. Finally, the conditional participation module is utilized to determine whether the agent should engage in the debate.

\paragraph{Similarity Calculation Module.} Following the generation of outputs, each agent undertakes a comprehensive assessment of the similarity between its own output and those produced by other agents or groups. This evaluation can be conducted through various methodologies; in this context, we employ a straightforward approach that involves analyzing key points within the outputs to determine their degree of similarity. Specifically, we employ regular expression matching to extract answers from the agents' responses and identical answers are considered to reflect similar viewpoints. Additionally, we also propose an alternative vectorization-based approach, where the responses are vectorized using an embedding model, and the cosine similarity is computed to evaluate the similarity of their viewpoints. In our further experiments, we conduct a comprehensive comparison of the performance of these two methods (See Section \ref{sec:in-depth-analysis}). By focusing on essential elements, agents can effectively gauge how closely aligned their perspectives are with those presented by others.

\paragraph{Redundancy Filtering Module.} Prior to engaging in the debate, agents systematically filter all incoming information to ensure relevance and uniqueness. Outputs that are identified as similar to either their own or previously received viewpoints are promptly discarded from consideration. This rigorous filtering process guarantees that each agent exclusively considers unique perspectives during discussions, thereby minimizing redundancy and fostering a more dynamic exchange of ideas.

\paragraph{Conditional Participation Module.} Agents actively engage in debate when divergent viewpoints exist within or among groups, recognizing that such differences enrich the discourse and lead to more robust conclusions. Conversely, if all outputs align consistently without variation, agents will opt to remain silent rather than contribute redundant information. At the conclusion of each round of debate, agents update their knowledge base with accepted viewpoints gleaned from interactions with others; this iterative learning process enhances their ability to respond thoughtfully and effectively in subsequent rounds.


\subsection{Token Cost Analysis} \label{token-consumption-analysis}

% In this section, we conduct detailed analysis of the token consumption in our method.

% \paragraph{Token Cost in Multi-agent Debate and Groupdebate.} 

% The total token cost of MAD and GroupDebate are $Token^{MAD} = \mathcal{O}\left( MTQ+(M^2T+MT^2)C \right)$ and $Token^{GD} = \mathcal{O}\left(MTQ+(\frac{M^2T} {N}+MSN)C\right)$ respectively, where $C$ represents the upper bound on the token number for each agent's response and the generated summary.\cite{liu2024GroupDebate}

% \paragraph{Token Cost in \({\text{S}^2\text{-MAD}}\).} 
In \({\text{S}^2\text{-MAD}}\), we summarize the outputs from whtnin each group at the end of each stage. 
Given a group of agents $G_j$ which has completed a stage $s$ of debate, we denote its summary as $Sum_j^s$.
% Here, we define the summary of group $G_j$ at the end of stage $s$ as $Summary_j^s$. 
Since in \({\text{S}^2\text{-MAD}}\)  each agent determines participation based on whether viewpoints are consistent, we define the number of agents with differing viewpoints from the $i^{th}$ agent $D_i$ is:


\begin{equation}
\begin{split}
% D_i = 
\left\{
\begin{aligned}
&\sum_{i'\in G_j} Sim(O_i^{t-1} ,O_{i'}^{t-1})<\epsilon,\\
&\qquad (s-1)R+1<t<min(sR,T)\\
&\sum_{1}^{N} Sim(O_i^{t-1},Sum_{j}^{s-1})<\epsilon,\\
&\qquad\qquad\qquad\qquad t=(s-1)R+1
\end{aligned}
\right.
\end{split}
\end{equation}
Therefore, apart from generating the initial answer, the probability of agent $A_i$ participating in the debate in round $t$ is
\begin{equation}
\begin{split}
P_i^t=
\left\{
\begin{aligned}
&1, && D^t_i>0\\  
&0, && D^t_i=0
\end{aligned}
\right.
\end{split}
\end{equation}
Then token cost $Token^t_s$ in round $t$ at stage $s$ is:
\begin{equation}
% \begin{split}
% \begin{aligned}
% &\left\{
% \begin{aligned}
\sum_{j=1}^N\sum_{i\in G_j} P_i^t(Q+O_i^t+\frac{MD_i^t}{N}\sum_{i'\in G_j}O_{i'}^{t-1})
\end{equation}
where $(s-1)R + 1 < t <= min(sR, T)$,  and 
\begin{equation}
% \begin{multline}
    \sum_{i=1}^MP_i^t(Q+O_i^{t-1}+O_i^t+\frac{D_i^t}{N}\sum_{j=1}^NSum_j^{s-1})
% \end{multline}
\end{equation}
where $t = (s-1)R + 1$. Finally, the total token cost of \({\text{S}^2\text{-MAD}}\) is $Token = \mathcal{O}\left(MTQ+(\frac{M^2T}{N}+MSN)CP\right)$, where $C$ represents the upper bound on the token number for each agent's response and the generated summary, $P$ represents the upper bound of the average probability of each agent participating in the debate globally. More calculation details are shown in Appendix \ref{appendix:token-cost-S^2-MAD}.

\paragraph{Discussion.} From the perspective of total token cost complexity comparison, \({\text{S}^2\text{-MAD}}\) exhibits the same token cost complexity as standard MAD since the initial viewpoints of agents are generated by retaining the question input. However, for the same $M$ and $T$, since agentsâ€™ answers tend to become consistent as the debate progresses, we define the probability of obtaining a answer different with other agents is $p$. Thus, the token cost will only increase to be comparable to that of Group Debate when different answers are obtained in each round, which occurs with a probability of only $p^{MN}$.
