\section{Experiments}
% \section{Results}
\label{sec:results}
We conduct our experiments based on the open-source differentiable ray tracer DeepLens~\cite{yang2024curriculum,wang2022differentiable}.We firstly compare the ray tracing results of our framework with Zemax \cite{ZEMAX} to demonstrate the accuracy of imaging simulation with tolerances in \cref{sec:4.1}. And in \cref{sec:4.2} and \cref{sec:4.3}, we implement computational imaging task to validate the effectiveness of the tolerance-aware optimization in simulation and real-world levels. Finally, in \cref{sec:4.4}, we analyze how tolerance-aware optimization improve deep optics robustness to tolerances from both quantitative and qualitative perspectives.

%--------------------------------------------------------
\subsection{Tolerance-aware Differentiable Ray-tracing}
\label{sec:4.1}
Using the method described in \cref{sec:3.2}, we capture the deviations caused by random tolerance perturbations during the ray tracing process. This approach preserves the differentiability of the conventional deep optics pipeline, enabling accurate imaging simulations in the presence of tolerances. We demonstrate that the ray tracing with tolerances is quite accurate, compared the ray tracing results with Zemax \cite{ZEMAX}. We choose a classical optical design, Cooke Triplet, and randomly sample tolerances pattern to perturb the lens system. 

We visualize the ray tracing results come from Zemax \cite{ZEMAX} and ours, as shown in \cref{fig:ZEMAX}, and also calculate the root-mean-square spot sizes. The spot sizes and the overall rays distribution are nearly identical across each field-of-views, with errors $ < 1\mu m$, which shown that our ray tracing with tolerances is extremely accurate, thus it means that we are able to simulate the imaging process when lens encounter tolerances and remain differentiable manner of deep optics pipeline.
\begin{figure}[t]
  \centering
  % \fbox{\rule{0pt}{2in} \rule{0.9\linewidth}{0pt}}
   \includegraphics[width=1.0\linewidth]{figures/zemax_results.pdf}
   \caption{Spot diagrams and RMS spot sizes produced by our framework with and without perturbations are highly resemble those by Zemax, the tested lens is Cooke Triplet and for visualization, the scale bars are different.}
   \label{fig:ZEMAX}
\end{figure}

\begin{table*}[tbp]
    \centering
    \setlength{\tabcolsep}{.25em}
    \footnotesize
    \setlength{\aboverulesep}{1pt}
    \setlength{\belowrulesep}{1pt}
    \renewcommand*{\arraystretch}{0.75}
    \caption{Up: the numerical results of multiple (100 times) random sampled tolerances pattern test on DIV2K test datasets for without, with our tolerance-aware optimization and conduct tolerance optimization by Zemax \cite{ZEMAX}. Bottom: the manufacturing yield result based on 100 times results, \eg , $>90\%$ means that have $90\%$ confidence to get PSNR $>26.26dB$ for Lens1 after fabrications. }
    \input{sec/deblurring_results_table.tex}
    \label{tab:result}
\end{table*}
%--------------------------------------------------------
% \subsection{Tolerance-aware Deep Optics for Computational Imaging}
\subsection{Tolerance-aware Evaluation by Simulation}
\label{sec:4.2}
To demonstrate that our tolerance-aware optimization provides better robustness and less degradation when subjected to tolerances, we compare the average deblurring results of the tolerance-aware deep optics design and the non-tolerance-aware counterpart under random tolerances, tested on the DIV2K dataset \cite{agustsson2017ntire}, shown in \cref{tab:result}. The design with tolerance-aware optimization, has better average deblurring performances when encounter tolerances, the average PSNR improved by more than $2\text{dB}$.

We also compare our tolerance-aware design with tolerance optimized by Zemax \cite{ZEMAX} which use Zemax to implement tolerances optimization merely by optical metrics alone, it shown that optimized by Zemax may incur the mismatch problem between optical and decoder part, thus lead the deblurring performance drop down severely (see Lens2 in \cref{tab:result}).

At last, we analyze the manufacturing yields of the three design approaches based on our test results, which showed that deep optics demonstrated higher manufacturing yields after tolerance-aware optimization, shown in \cref{tab:result}.

\begin{figure*}[tb] \centering
  \includegraphics[width=\textwidth,height=0.55\textwidth]{figures/deblur_results.pdf}
  \caption{Deblurring results comparison of deep optics with and without tolerance-aware optimization under tolerances perturbations. The deep optics with tolerances optimization maintain better deblurring performances than its counterpart.} 
  \label{fig:Deblur}
\end{figure*}

%--------------------------------------------------------
\subsection{Real-world Experiment}
\label{sec:4.3}
To demonstrate the applicability of our method to real-world systems, we employ actual optical systems to acquire images and perform computational imaging. This shows that the tolerance-aware deep optics produces superior deblurring results in real-world which exist random tolerances. Specifically, we use an off-the-shelf industrial camera lens design to train and optimize the decoder both with and without tolerances optimization. We simulate tolerances by introducing slight perturbations during image acquisition and compare the quality of reconstructed images before and after optimizing the decoder for tolerances. This comparison highlights the enhanced resistance to potential tolerances provided by the optimized decoder, see \cref{fig:physical_exp_results}.
%~\tianfan{refer to the actual figure or tables.}
\begin{figure*}[tb] \centering
  \includegraphics[width=\textwidth,height=0.42\textwidth]{figures/real-world-experiment.pdf}
  \caption{Physical experiment results demonstrating the robustness of our tolerance-aware deep optics. Despite random tolerance perturbations, our method maintains high deblurring performance in two distinct scenes. In contrast, the deep optics baseline without tolerance-aware optimization suffers from significant performance degradation.} 
  \label{fig:physical_exp_results}
\end{figure*}


%--------------------------------------------------------
\subsection{Robustness Improvement of Deep Optics}
\label{sec:4.4}
The tolerance-aware optimization significantly enhances the robustness of the deep optics against potential tolerances. However, what specific factors contribute to this increased tolerances resistance following the optimization?

To understand the underlying reasons, we qualitatively analyze changes in both the optics and decoder components after tolerance optimization. For the lens, we validate its tolerance robustness by comparing the degree of PSF variation in designs with and without tolerances optimization when affected by tolerances. By assessing how the PSFs change when subjected to random tolerances, using cosine similarity to quantify the similarity between the perturbed PSF and the ideal PSF, as shown in \cref{fig:qualitatively-analysis}. It is evident that the lens optimized with tolerance-aware can maintain the PSF within a relatively similar range, even when subject to tolerance disturbances. This greatly reduces the difficulty for the computational decoder to handle the changes of encoded patterns with tolerances.

Regarding the decoder, given the increased robustness of the lens post-optimization, we expand the range of tolerances to compare the decoder's ability to handle tolerance before and after tolerance optimization under equivalent conditions, as shown in \cref{fig:qualitatively-analysis-decoder}. The results demonstrate that with tolerance-aware optimization, the decoder become robust to potential tolerances. After tolerance-aware optimization, the lens can maintain PSF stability, and the decoder shows greater adaptability to tolerances. This significantly enhances the resistance of deep optics to manufacturing and assembly tolerances.
\begin{figure}[t]
  \centering
    \hspace{-5mm}
  \includegraphics[width=8.3cm, height=4.3cm]{figures/qualitative_analysis_optics.pdf}
   \caption{Qualitative analysis results for the optics (random test 50 times) and the validation PSNR values during training (test without tolerances).}
   \label{fig:qualitatively-analysis}
\end{figure}
\begin{figure}[t]
  \centering
  \includegraphics[width=8cm, height=3cm]{figures/qualitative_analysis_decoder.pdf}

   \caption{Qualitative analysis results for the decoder's robustness improvements. The fitted probability density distributions of 50 times of random tolerance tests of PSNR, SSIM and LPIPS. With and without tolerance optimization and for deep optics with tolerance-aware optimization is tested under larger range of tolerances.}
   \label{fig:qualitatively-analysis-decoder}
\end{figure}