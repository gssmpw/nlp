\subsection{Optimal scale selection} \label{sec:optimal}

Selecting the optimal scale for image segmentation is a critical aspect of Object-Based Image Analysis (OBIA) and interpretation. The optimal segmentation scale is defined as the scale at which image objects most accurately correspond to real-world ground features across the entire image. We based on \citet{20-photo-j}â€™s method for optimal scale selection and applied it for multiple optimal scale selections by selecting ``peaks'' from the relative changes and sort them by value - representing descending impact from number of scales. The optimal scale selection for HrHS image segmentation proceeds as follows:
\begin{enumerate}
    \item Segmenting the HrHS image at different scales and calculating CV;
    \item Detecting and removing outliers using IF algorithm;
    \item Calculating and constructing NN-nCV and NN-nRoC graphs;
    \item Inspecting NN-nRoC graphs and selecting an optimal scale.
\end{enumerate}
The coefficient of variation (CV) for a segment in a single-band image is computed as:  

\[
CV_{p} = \sqrt{\frac{\sum_{i=1}^{N} (x_i - \mu_p)^2}{N}},
\]

where \(CV_{p}\) represents the CV of segment \(p\), \(N\) is the total number of pixels in the segment, \(x_i\) is the intensity value of the \(i\)-th pixel, and \(\mu_p\) is the mean intensity of all pixels within the segment.  

For hyperspectral images, the mean CV across all spectral bands is given by:  

\[
CV_{p} = \frac{\sum_{j=1}^{B} CV_{p,j}}{B},
\]

where \(B\) is the total number of spectral bands, and \(CV_{p,j}\) is the CV of segment \(p\) in band \(j\). The overall average CV across all segments \(P\) in the image is computed as:  

\[
CV_{avg} = \frac{\sum_{p=1}^{P} CV_{p}}{P}.
\]

After computing \(CV_{avg}\), segments with extreme values are filtered out using the Isolation Forest (IF) algorithm \citep{liu2012}, reducing computational cost and memory usage. Once outliers are removed, the NN-nRoC (nearest neighbor-normalized rate of change) is computed using:  

\[
\text{NN-nRoC} = \frac{\left| \left(\frac{\text{NN-nCV}_{n} - \text{NN-nCV}_{n-1}}{\text{NN-nCV}_{n-1}} \right)\right|}{P},
\]

where \(\text{NN-nCV}_{n}\) and \(\text{NN-nCV}_{n-1}\) denote the averaged NN-normalized CV across all segments at scales \(n\) and \(n-1\), respectively.  

Finally, NN-nCV and NN-nRoC graphs are generated for each segmentation method, and the NN-nRoC graph is analyzed to determine the optimal segmentation scale. Peaks in the NN-nRoC graph, where NN-nCV changes significantly, indicate abrupt shifts in intra-segment homogeneity, which correspond to key segmentation scales.

\begin{table}
\centering
\caption{Optimal Scale Selection.}
\label{tab:optimal_scale_selection}
\begin{tabular}{|l|c|}
\hline
\textbf{Dataset} & \textbf{Optimal Scales} \\
\hline
\textbf{INDIAN}   & [42, 24, 17, 8, 4] \\
\hline 
\textbf{SALINAS}  & [55, 31, 23, 14, 10, 4] \\
\hline 
\textbf{PAVIA}    & [71, 17, 14, 8, 5] \\
\hline 
\textbf{BOTSWANA} & [9, 7, 5] \\
\hline 
\textbf{KENNEDY}  & [55, 17, 12, 6] \\
\hline 
\textbf{TORONTO}  & [55, 24, 22, 18] \\
\hline
\end{tabular}
\end{table}