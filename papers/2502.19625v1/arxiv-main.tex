\documentclass{article}

\usepackage{graphicx}%
\usepackage{multirow}%
\usepackage{makecell}
\usepackage{amsmath,amssymb,amsfonts}%
\usepackage{amsthm}%
\usepackage{mathrsfs}%
\usepackage{xcolor}%
\usepackage{textcomp}%
\usepackage{manyfoot}%
\usepackage{booktabs}%
\usepackage{algorithm}%
\usepackage{algorithmicx}%
\usepackage{algpseudocode}%
\usepackage{listings}%
\usepackage{array}
\usepackage{caption}
\usepackage{pdflscape}
\usepackage{natbib}
\usepackage{subcaption}
\usepackage{threeparttable}
\usepackage{hyperref}
\usepackage[draft]{fixme}

\usepackage{mathtools}
\usepackage{lineno}

\usepackage{graphicx} %
\usepackage{booktabs}
\usepackage[margin=1in]{geometry}

\usepackage{bbm}
\usepackage[T1]{fontenc}

\newcommand{\theHalgorithm}{\arabic{algorithm}}


\fxsetup{inline,nomargin,theme=color}


\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{assumption}[theorem]{Assumption}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}


\definecolor{todo-color}{HTML}{ff3232}
\newcommand{\todo}[1]{{\color{todo-color}[#1]}}
\newcommand\todocite{{\color{red}{CITE}}\xspace}


\newcommand{\fix}{\marginpar{FIX}}
\newcommand{\new}{\marginpar{NEW}}


\newcommand{\blue}[1]{\textcolor{blue}{#1}}
\newcommand{\red}[1]{\textcolor{red}{#1}}
\newcommand{\tba}{\textcolor{red}{To Be Added }}

\title{Treatment Non-Adherence Bias in Clinical Machine Learning: A Real-World Study on Hypertension Medication}
\author{Zhongyuan Liang$^{1,2}$, Arvind Suresh$^{2}$, and Irene Y. Chen$^{1,2}$}
\date{$^1$University of California, Berkeley, $^2$University of California, San Francisco}

\begin{document}

\maketitle

\begin{abstract}
Machine learning systems trained on electronic health records (EHRs) increasingly guide treatment decisions, but their reliability depends on the critical assumption that patients follow the prescribed treatments recorded in EHRs. Using EHR data from 3,623 hypertension patients, we investigate how treatment non-adherence introduces implicit bias that can fundamentally distort both causal inference and predictive modeling. By extracting patient adherence information from clinical notes using a large language model, we identify 786 patients (21.7\%) with medication non-adherence. We further uncover key demographic and clinical factors associated with non-adherence, as well as patient-reported reasons including side effects and difficulties obtaining refills. Our findings demonstrate that this implicit bias can not only reverse estimated treatment effects, but also degrade model performance by up to 5\% while disproportionately affecting vulnerable populations by exacerbating disparities in decision outcomes and model error rates. This highlights the importance of accounting for treatment non-adherence in developing responsible and equitable clinical machine learning systems.
\end{abstract}

\input{arxiv-sections/0-intro}

\input{arxiv-sections/1-related_work}

\input{arxiv-sections/2-setup}

\input{arxiv-sections/3-analysis}

\input{arxiv-sections/4-performance}

\input{arxiv-sections/5-discussion}



\clearpage
\bibliographystyle{apalike} %
\bibliography{references}

\appendix
\onecolumn

\section{Cohort Creation} \label{apd:cohort}
We detail the cohort selection in Figure~\ref{fig:cohort}.
\begin{figure}[h]
    \centering
    \includegraphics[width=0.45\linewidth]{figures/cohort_selection.jpg}
    \caption{Cohort Selection}
    \label{fig:cohort}
\end{figure}

\section{Feature Definitions}\label{apd:feature}
We use the following features throughout the study. The time between visits is excluded from causal inference and predictive modeling in Section~\ref{sec:performance}, as we instead restrict the analysis to a smaller time window. ECI and CCI are derived using medcodes package \citep{githubGitHubTopspinjmedcodes}.

\begin{table*}[h!]
    \centering
    \small
    \renewcommand{\arraystretch}{1.2} %
    \begin{tabular}{p{4cm} p{12cm}}
        \hline
        \textbf{Feature Name} & \textbf{Description} \\
        \hline
        Sex & The sex of the patients. \\
        Age & The age of the patients at the time of the visit. \\
        Race & The race of the patients. \\
        Marital Status & The marital status of the patients at the time of the visit. \\
        Time Between Visits & The time in days between the two visits in each pair. \\
        Charlson Comorbidity Index (CCI) & A measure of comorbidity based on the following conditions: myocardial infarction, congestive heart failure, peripheral vascular disease, cerebrovascular disease, dementia, chronic pulmonary disease, rheumatic disease, peptic ulcer disease, mild liver disease, diabetes without chronic complications, diabetes with chronic complications, hemiplegia/paraplegia, renal disease, any malignancy, moderate/severe liver disease, metastatic solid tumor, and AIDS/HIV. \\
        Elixhauser Comorbidity Index (ECI) & A measure of comorbidity based on the following conditions: cardiac arrhythmias, congestive heart failure, valvular disease, pulmonary circulation disorders, peripheral vascular disorders, hypertension (uncomplicated or complicated), paralysis, other neurological disorders, chronic pulmonary disease, diabetes (uncomplicated or complicated), hypothyroidism, renal failure, liver disease, peptic ulcer disease, AIDS/HIV, lymphoma, metastatic cancer, solid tumor without metastasis, rheumatoid arthritis, coagulopathy, obesity, weight loss, fluid and electrolyte disorders, blood loss anemia, deficiency anemia, alcohol abuse, drug abuse, psychoses, and depression. \\
        Duration of Hypertension & The duration (in years) between the onset of hypertension and the time of the visit. \\
        Number of Primary Care Visits & The number of primary care visits one year prior to the visit. \\
        \hline
    \end{tabular}
    \caption{Descriptions of features included in the study}
    \label{tab:features}
\end{table*}

\section{Prompt Description}\label{apd:prompt}
The prompt used in the study is given in Figure~\ref{fig:prompt}.
\begin{figure*}[h!]
    \centering
    \includegraphics[width=0.95\textwidth]{figures/prompt1.jpg} \\
    \includegraphics[width=0.95\textwidth]{figures/prompt2.jpg} \\
    \includegraphics[width=0.95\textwidth]{figures/prompt3.jpg}
    \caption{Prompt used in the study}
    \label{fig:prompt}
\end{figure*}

\section{Topic Modeling}\label{apd:topic}
Here we show the full BERT topic modeling results with key terms found in clusters and we summarize the topics in Figure~\ref{fig:reason}.

\begin{figure*}[h!]
    \centering
    \includegraphics[width=\textwidth]{figures/appendix_topic_keywords.png}
    \caption{BERT topic modeling identified five clusters of treatment non-adherence reasons. The most common words in each cluster are highlighted in the plot. Key topics identified include side effects, forgetfulness, failure to pick up medications, need for refills, and lost medications. When applying BERT topic modeling, we set a minimum cluster size of 15 notes and used UMAP with 5 components and 15 neighbors for dimensionality reduction.}
    \label{fig:appendix_topic}
\end{figure*}

\newpage
\section{Additional Results of Non-adherence Bias on Predictive Modeling}\label{apd:fairness}
Here, we present the complete results on racial disparities for the experiments in Section~\ref{supervised_learning}.
\begin{figure*}[h!]
    \centering
    \includegraphics[width=\textwidth]{figures/race_disparity_vary_na_ratio.png}
    \caption{Increasing the proportion of treatment non-adherent data in the training set increases the fairness disparity between different races as measured by demographic parity and the equal odds criterion. Results are averaged over 100 seeds, varying the sampling of the train and test sets. Error bars represent the standard error of the mean.}
    \label{fig:appendix_race_vary_na_ratio}
\end{figure*}
\newpage
\begin{figure*}[h!]
    \centering
    \includegraphics[width=\textwidth]{figures/race_disparity_vary_train_size.png}
    \caption{The black curve represents training on 75\% of the full dataset consisting of adherent encounters only. Removing treatment non-adherent data from the training set decreases fairness disparities as measured by demographic parity and the equal odds criterion particularly for Black and Asian. Results are averaged over 100 seeds, varying the sampling of the train and test sets. Error bars represent the standard error of the mean.}
    \label{fig:appendix_race_vary_sample_size}
\end{figure*}

\end{document}
