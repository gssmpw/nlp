\begin{algorithm}[tb]
   \caption{Regression Implementation}\label{alg:reg}
\begin{algorithmic}[1]\label{alg:reg}
   \STATE {\bfseries Input:} questions $Q$, answers $A$, states $S$, policy $\pi$, verifier $f_\theta$, Monte Carlo sampling size $k$
   \FOR{$\{q,a,s\}$ {\bfseries in} $\{Q,A,S\}$}
   \STATE Sample $k$ rollouts given $\pi(\cdot|q,s)$ and get $\hat{A}=\{\hat{a}_i\}_k$
   \STATE Estimate $\hat{V}^\pi(q,s)=\frac{\#\rm correct}{|\hat{A}|}$ by comparing ($\hat{a}_i$, $a$)
   \STATE Predict state value $\tilde{V}_\theta^\pi(q,s)$ using verifier $f_\theta$
   \IF{Scalar regression, Eqn.\ref{reg:scalar}:}
    \STATE $\tilde{V}_\theta^\pi(q,s)\leftarrow f_\theta(\cdot|q,s)$
   \ELSIF{Expectation regression, Eqn.\ref{reg:categorical}:}
    \STATE $\tilde{V}_\theta^\pi(q,s)\leftarrow f_\theta(\cdot|q,s)\cdot\Delta_z^T$ 
    as $\Delta_z^T$ defined in Eqn.\ref{reg:categorical}.
    \ENDIF
   \ENDFOR
   \STATE Optimize $f_\theta$ through MSE loss:
   \begin{equation}
       \min_\theta \sum_{(q,s)\in (Q,S)}(\tilde{V}_\theta^\pi(q,s)-\hat{V}^\pi(q,s))^2 \nonumber
   \end{equation}
\end{algorithmic}
\end{algorithm}
