\subsection{Proof of Lemma~\ref{appendix_lemma:fenchel_conjugate_of_g_closed_form_expression}}
\label{appendix_subsec:proof_fenchel_conjugate_of_g_closed_form_expression}

% \begin{lemma}[Lemma~\ref{appendix_lemma:fenchel_conjugate_of_g_closed_form_expression}]
\begin{namedlemma}[~\ref{appendix_lemma:fenchel_conjugate_of_g_closed_form_expression}]
    \label{appendix_lemma:fenchel_conjugate_of_g_closed_form_expression}
    The Fenchel conjugate of $g(\bbeta)$, denoted as $g^*(\balpha)$, is given by:
    \begin{equation}
        g^*(\balpha) = \text{TopSum}_k(H_M(\balpha)),
    \end{equation}
    where $\text{TopSum}_k(\cdot)$ denotes the sum of the top $k$ largest elements, and $H_M(\cdot)$ is the Huber loss function defined as:
    \begin{equation}
        H_M(\alpha_j) := \begin{cases}
            \frac{1}{2} \alpha_j^2 & \text{if } \vert{\alpha_j} \leq M \\
            M \vert{\alpha_j} - \frac{1}{2} M^2 & \text{if } \vert{\alpha_j} > M
        \end{cases},
    \end{equation}
    and we use the shorthand notation $H_M(\balpha)$ to denote applying $H_M(\cdot)$ to $\balpha$ in an elementwise fashion.
\end{namedlemma}

\begin{proof}

    By definition, the Fenchel conjugate is defined as
    \begin{equation}
        \label{appendix_def:fenchel_conjugate_of_g}
        g^*(\balpha) = \max_{\bbeta} \balpha^T \bbeta - g(\bbeta)
    \end{equation}

    By plugging $g(\bbeta)$ from Equation~\eqref{eq:function_g_definition} and $\calZ(\bbeta)$ from Equation~\eqref{eq:z_domain_definition} into this Fenchel conjugate definition, we have
    \begin{align}
        \label{appendix_eq:fenchel_conjugate_of_g_max_beta_max_z_formulation}
            g^*(\balpha) &= \max_{\bbeta} \balpha^T \bbeta - \min_{\bz \in \calZ(\bbeta)} \frac{1}{2} \sum_{j=1}^n \frac{\beta_j^2}{z_j} \nonumber \\
            &= \max_{\bbeta} \max_{\bz \in \calZ(\bbeta)} \balpha^T \bbeta -  \frac{1}{2} \sum_{j=1}^n \frac{\beta_j^2}{z_j}
    \end{align}

    Since Equation~\eqref{appendix_eq:fenchel_conjugate_of_g_max_beta_max_z_formulation} is jointly maximizing over $\bbeta$ and $\bz$, we can switch the order by doing the inner optimization over $\bbeta$ and outer optimization over $\bz$:
    \begin{align}
        \label{appendix_eq:fenchel_conjugate_of_g_max_z_max_beta_formulation}
        g^*(\balpha) = \max_{\bz \in \calZ} \, \max_{\bbeta \in \calB(\bz)} \balpha^T \bbeta - \frac{1}{2} \sum_{j=1}^n \frac{\beta_j^2}{z_j},
    \end{align}
    where we have set $\calZ := \{\bz \mid \bz \in [0,1]^n, \, \mathbf{1}^T \bz \leq k\}$, and set $\calB(\bz) := \{\bbeta \mid - M z_j \leq \beta_j \leq M z_j\}$.

    For the inner optimization problem in Equation~\eqref{appendix_eq:fenchel_conjugate_of_g_max_z_max_beta_formulation}, if we take the derivative with respect to $\bbeta$ and set it to zero, we have $\alpha_j - \beta_j / z_j = 0$, or $\beta_j = \alpha_j z_j$.
    Since $\bbeta$ also needs to satisfy the constraint $ - M z_j \leq \beta_j \leq M z_j$ for all $j$'s, the optimal solution $\beta_j^*$ for the inner optimization problem is 
    \begin{equation}
        \label{appendix_eq:solution_for_beta_in_terms_of_fenchel_dual_alpha}
        \beta_j^* = \text{sgn}(\alpha_j) \min(\vert{\alpha_j}, M) z_j.
    \end{equation}

    If we plug Equation~\eqref{appendix_eq:solution_for_beta_in_terms_of_fenchel_dual_alpha} into each individual term $\alpha_j \beta_j^* - \frac{{\beta_j^*}^2}{2z_j}$, we have

    \begin{align}
        \label{appendix_eq:fenchel_conjugate_of_g_each_term_reduced_to_Huber_loss}
        \alpha_j \beta_j^* - \frac{{\beta_j^*}^2}{2z_j} &= \alpha_j \text{sgn}(\alpha_j) \min(\vert{\alpha_j}, M) z_j - \frac{\left( \text{sgn}\left( \alpha_j \right) \min\left(\vert{\alpha_j}, M \right) z_j \right)^2}{2z_j} \nonumber \\
        &= \vert{\alpha_j} \min(\vert{\alpha_j}, M) z_j - \frac{1}{2} \min(\vert{\alpha_j}, M)^2 z_j \nonumber \\
        &= \left[ \vert{\alpha_j} \min(\vert{\alpha_j}, M) - \frac{1}{2} \min(\vert{\alpha_j}, M)^2 \right] z_j \nonumber \\
        &= \begin{cases}
            \frac{1}{2} \alpha_j^2 z_j & \text{if } \vert{\alpha_j} \leq M \nonumber \\
            \left( M \vert{\alpha_j} - \frac{1}{2} M^2 \right) z_j & \text{if } \vert{\alpha_j} > M
        \end{cases} \nonumber \\
        &= H_M(\alpha_j) z_j.
    \end{align}

    By plugging Equation~\eqref{appendix_eq:solution_for_beta_in_terms_of_fenchel_dual_alpha} and Equation~\eqref{appendix_eq:fenchel_conjugate_of_g_each_term_reduced_to_Huber_loss} back into Equation~\eqref{appendix_eq:fenchel_conjugate_of_g_max_z_max_beta_formulation}, we obtain
    \begin{align*}
        % \label{appendix_eq:fenchel_conjugate_of_g_top_k_sum_reformulation}
        g^*(\balpha) &= \min_{\bz \in \calZ} \left( \sum_{j=1}^n \alpha_j \beta_j^* - \frac{ {\beta_j^*}^2}{2z_j} \right)\\
        &= \max_{\bz \in \calZ} \left( \sum_{j=1}^n H_M(\alpha_j) z_j \right) \nonumber\\
        &= \text{TopSum}_k (\{H_M(\alpha_j)\}_{j=1}^n), \nonumber \\
        &= \text{TopSum}_k (H_M(\balpha)).
    \end{align*}

\end{proof}
