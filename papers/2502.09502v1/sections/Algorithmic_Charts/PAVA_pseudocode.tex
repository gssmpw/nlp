\begin{algorithm}[tb]
\caption{Customized PAVA to solve $\text{prox}_{\rho g^*}(\bmu)$}
\label{alg:PAVA_algorithm}
\begin{flushleft}
\textbf{Input:} vector $\bmu$, scalar multiplier $\rho$, and threshold $M$ of the Huber loss function $H_M(\cdot)$\\
% \textbf{Output:} vector $\balpha^*=\text{prox}_{\rho g^*}(\bmu)$.
\end{flushleft}
\begin{algorithmic}[1]
    \STATE Initialize $\brho \in \mathbb{R}^n$ with $\rho_j = \rho$ if $j \in \{1, 2, ..., k\}$ and $\rho_j = 0$ otherwise.
    \STATE \COMMENT{Sort $\bmu$ such that $\vert{\mu_1} \geq \vert{\mu_2} \geq ... \geq \vert{\mu_p}$; $\bpi$ is the sorting order.}
    \STATE $\bmu, \bpi = \text{SpecialSort} (\bmu)$
    
    \STATE \COMMENT{STEP 1: Initialize a pool of $p$ blocks with start and end indices; each block initially has length equal to $1$}
    \STATE $\calJ = \{[1, 1], [2, 2], ..., [p, p]\}$

    \STATE \COMMENT{STEP 2: Initialize $\hat{\nu}_j$ in each block by ignoring the isotonic constraints}
    \FOR{$j=1, 2, \dots, p$} 
        \STATE $\hat{\nu}_j = \argmin_{\nu} \frac{1}{2} (\nu - \vert{\mu_j})^2 + \rho_j H_M(\nu)$ \label{alg_line:PAVA_algorithm_initialization_step}
    \ENDFOR
    
    \STATE \COMMENT{STEP 3: Whenever there is an isotonic constraint violation between two adjacent blocks, merge the two blocks by setting all values to be the minimizer of the objective function restricted to this merged block; use \textcolor{red}{Algorithm~\ref{alg:up_and_down_block_algorithm_for_merging_in_PAVA}} in~\ref{appendix_sec:proofs}}
    \WHILE{$\exists [a_1, a_2], [a_2+1, a_3] \in \calJ \text{ s.t. } \hat{\nu}_{a_1} < \hat{\nu}_{a_3}$}
        \STATE $\calJ = \calJ \setminus \{[a_1, a_2]\} \setminus \{[a_2+1, a_3]\} \cup \{[a_1, a_3]\}$
        \STATE $\hat{\nu}_{[a_1:a_3]} = \argmin\limits_{\nu} \sum\limits_{j=a_1}^{a_3} \left[ \frac{1}{2} (\nu - \vert{\mu_j})^2 + \rho_j H_M(\nu) \right]$ \label{alg_line:PAVA_algorithm_pooling_step}
    \ENDWHILE

    \STATE \COMMENT{Return $\hat{\bnu}$ with the inverse sorting order}
    \STATE \textbf{Return} $\text{sgn}(\bmu) \odot \bpi^{-1}(\hat{\bnu})$
    
\end{algorithmic}
\end{algorithm}