\begin{algorithm}[t]
  \caption{PaPP Backbone Training}
  \label{Alg1}
  
  \KwIn{Different sites channel models $\bs{\mathcal{D}}$ (source domain)}
  \SetKwInOut{Init}{Initialize}
  \SetKw{IN}{in}
  \SetKw{each}{each}
  \newcommand{\forcond}{$e=1$ \KwTo $Epochs$}
  \newcommand{\forcondd}{$e=1$ \KwTo $Epochs$}
  \newcommand{\forcondom}{$i=1$ \KwTo $m$}
  \newcommand{\forcondou}{$j=1$ \KwTo $N_U$}
  \newcommand{\fordomains}{\each $\hat{D}$ \IN $\bs{\mathcal{D}}^{\textnormal{train}}$ }
  \newcommand{\fordomainsgen}{\each $\hat{D}$ \IN $\bs{\mathcal{D}}^{\textnormal{gen}}$ }
  \Init{Parameters $\Theta$ (Teacher), $\Phi$ (Student), $\Pi$ (Features)\\ 
  Learning rates $\alpha_{T}, \alpha_{S}, \alpha_{F}, \beta_{T}, \beta_{S}, \beta_{F}, \epsilon_{T}, \epsilon_{S}, \epsilon_{F}$}  
  
 \For{\forcond}{
  \textbf{Divide} $\bs{\mathcal{D}} \rightarrow \bs{\mathcal{D}}^{\textnormal{train}}$ and $\bs{\mathcal{D}}^{\textnormal{gen}}$~~~~~~~~~~~~~~~\tikzmark{right}\\
  $\delta_{T}, \delta_{S} \gets 0$\tikzmark{top}\\
  % \textbf{Freeze}  $\Phi_{\text{CNN.weights}} \gets \Theta_{\text{CNN.weights}}$\\
  
  \For{\fordomains}{
  $\delta_{T} \leftarrow \delta_{T} + \frac{\nabla_{\Theta,\Pi}\mathcal{L}_{T}(\hat{D};\Theta,\Pi)}{|\bs{\mathcal{D}}^{\text{train}}|}$\\
  % $\mb{W}_{\Theta} \gets \Theta(\hat{D})$\\
  $\delta_{S} \leftarrow \delta_{S} + \frac{\nabla_{\Phi}\mathcal{L}_{S}(\hat{D}, \mb{W}_{T};\Phi)}{|\bs{\mathcal{D}}^{\text{train}}|}$\\
    }
  \textbf{Update} \\ 
    \qquad $\Theta^{\prime} = \Theta - \alpha_{T} \delta_{T}$\label{line:8}\\
    \qquad $\Pi^{\prime} = \Pi - \alpha_{F} \delta_{T}$\label{line:9}\\
    \qquad $\Phi^{\prime} = \Phi - \alpha_{S} \delta_{S}$ \label{line:10}\tikzmark{bottom}\AddNote{top}{bottom}{right}{Meta-Training}\\
  $\delta^{\prime}_{T}, \delta^{\prime}_{S} \gets 0$\tikzmark{top}\\
  \For{\fordomainsgen}{
  $\delta_{T}^{\prime} \leftarrow \delta_{T}^{\prime} + \frac{\nabla_{\Theta^{\prime},\Pi^{\prime}}\mathcal{L}_{T}(\hat{D};\Theta^{\prime},\Pi^{\prime})}{|\bs{\mathcal{D}}^{\text{gen}}|}$\\
  % $\mb{W}_{\Theta^{\prime}} \gets \Theta^{\prime}(\hat{D})$\\
  $\delta_{S}^{\prime} \leftarrow \delta_{S}^{\prime} + \frac{\nabla_{\Phi^{\prime}}\mathcal{L}_{S}(\hat{D}, \mb{W}^{\prime}_{T};\Phi^{\prime})}{|\bs{\mathcal{D}}^{\text{gen}}|}$\tikzmark{bottom}\\
    }
    \textbf{Meta-update:}\\ 
    \qquad $\Theta \leftarrow \Theta -  \epsilon_{T}(\delta_{T} + \beta_{T} \delta_{T}^{\prime})$\label{line:16}\\
    \qquad $\Pi \leftarrow \Pi -  \epsilon_{F}(\delta_{T} + \beta_{F} \delta_{T}^{\prime})$\label{line:17}\\
    \qquad $\Phi \leftarrow \Phi -  \epsilon_{S}(\delta_{S} + \beta_{S} \delta_{S}^{\prime})$\label{line:18}\AddNote{top}{bottom}{right}{Meta-Testing}
    \\
}
  \end{algorithm}