\section{\boldmath Analysis of $\PREM$ under Pure DP}
\label{sec:PREM_pure_DP}

\subsection{Find Margin Example with Pure DP}

We present and analyze the pure-DP version of \textsc{Find Margin Example} \Cref{alg:find-example-pure-DP}.

\begin{algorithm}[t]
    \caption{\textsc{FindMarginExample}$_{\cF,\eps,0,\beta,\zeta}$ (\textsc{Pure DP Version})}
    \label{alg:find-example-pure-DP}
    \begin{algorithmic}
        \item[\textbf{Parameters:}] 
        {\footnotesize $\bullet$ } privacy parameter $\eps > 0$; 
            \qquad\qquad\qquad\quad
            {\footnotesize $\bullet$ } confidence parameter $0 < \beta < 1$;\\
            \qquad\qquad\,\,\, {\footnotesize $\bullet$ } approximation factor $0 < \zeta < 1 / 2$;
            \quad \quad \quad
            {\footnotesize $\bullet$ } set of counting queries $\cF\subseteq \{0, 1\}^{\cX}$;\\
            \qquad\qquad\,\,\,
            {\footnotesize $\bullet$ } active set $\cY\subseteq \cX$; and
            \qquad \qquad\qquad\qquad
            {\footnotesize $\bullet$ }public estimate histogram $\hbh\in \R_{\geq 0}^{\cX}$
        \item[\textbf{Input:}] input histogram $\bh^{\ast} \in \N_{\geq 0}^{\cX}$ with $\|\bh^{\ast}\|_1=n$.\\
        $\cS^{\plus}, \cS^{\minus} \gets \emptyset$, $\cS_{\acti} \gets \cY$ \;\\
        $\alpha_0\gets \sqrt{\frac{48 n\log n}{\zeta^2\eps}\log|\cX|\log\big(\frac{|\cF|}{\beta}\big)}$\; \\
        $\Gamma\gets 8n/\alpha_0$\;\\
        $a\gets\eps/\Gamma$\; \\
        $\cF_{\acti}\gets \cF$\; \\ %\; \hfill$\ast$/ maintains active queries
        $\OIM\gets\OutsideIntervalMonitor^{\mathrm{pure}}_{\bh^{\ast},a,\Gamma,\cY}$ \hfill \algcomment{Initialization}\\
        %$\SVT\gets \SVT_{\bh^{\ast},\Gamma,a,\cY}^{\mathrm{pure}}$\;\\
        \Repeat{\textsc{Accurate}}{
            \textsc{Accurate} $\gets$ \textsc{True}
            
            \For{$f\in\cF_{\acti}$}{
                $\tau_u \gets \frac{1}{(1-\zeta)}\big[ \langle \hbh|_{\cS_{\acti}},f\rangle+\frac{\alpha_0}{2}\big]$ and $\tau_{\ell} \gets \frac{1}{(1+\zeta)}\big[\langle \hbh|_{\cS_{\acti}},f\rangle-\frac{\alpha_0}{2}\big]$

                $s \gets \OIM(f, \tau_{\ell}, \tau_u)$

                \If{$s \in \{\textsc{Above}, \textsc{Below}\}$}{
                    \If{$s = \textsc{Above}$}{
                        $\cS^{+}\gets\cS^{+}\cup(\cS_{\acti}\cap f^{-1}(1))$\;
                    }
                    \Else {
                        $\cS^{-}\gets\cS^{-}\cup(\cS_{\acti}\cap f^{-1}(1))$\;
                    }
                    
                    $\cS_{\acti}\gets \cS_{\acti} \smallsetminus f^{-1}(1)$\; \algcomment{Identical to $\cS_{\acti}$ maintained in state of $\OIM$.}\\
                    $\cF_{\acti}\gets \cF_{\acti}\smallsetminus \{f\}$\;\\
                    \textsc{Accurate} $\gets$  \textsc{False}\;
                }
            }
        }
        % \Return{$(\theta,\cS)\gets \begin{cases}
        %     (\plus,\cS^{\plus}) & \text{\em if } \langle\hbh, \ind_{\cS^{\plus}}\rangle \ge \max\{ \langle\hbh, \ind_{\cS^{\minus}}\rangle, \langle\hbh, \ind_{\cS_{\acti}}\rangle \} \\
        %     (\minus,\cS^{\minus}) & \text{\em if } \langle\hbh, \ind_{\cS^{\minus}}\rangle \ge \max\{ \langle\hbh, \ind_{\cS^{\plus}}\rangle, \langle\hbh, \ind_{\cS_{\acti}}\rangle \}  \\
        %     (\equal, \cS_{\acti}) & \text{\em if } \langle\hbh, \ind_{\cS^{\acti}}\rangle \ge \max\{ \langle\hbh, \ind_{\cS^{\minus}}\rangle, \langle\hbh, \ind_{\cS_{\plus}}\rangle \} 
        %     \end{cases}$
        % }
        \Return{$(\theta,\cS)\gets \begin{cases}
            (\plus,\Splus) & \text{\em if } \ind_{\Splus}(\hbh) \ge \max\{ \ind_{\Sminus}(\hbh), \ind_{\Sactive}(\hbh) \} \\
            (\minus,\Sminus) & \text{\em if } \ind_{\Sminus}(\hbh \ge \max\{ \ind_{\Splus}(\hbh), \ind_{\Sactive}(\hbh) \}  \\
            (\equal, \Sactive) & \text{\em if } \ind_{\Sactive}(\hbh) \ge \max\{ \ind_{\Sminus}(\hbh), \ind_{\Splus}(\hbh) \} 
            \end{cases}$
        }
    \end{algorithmic}
\end{algorithm}

\begin{proofof}{\Cref{lem:privacy_accuracy_find_example_pure_DP}}
The privacy of the algorithm reduces to that of the $\OutsideIntervalMonitor$, as it is the only part of the algorithm that uses the private data. Hence, by \Cref{prop:oim-pure-dp}, \Cref{alg:find-example-pure-DP} satisfies $\eps$-DP.

For the accuracy, by \Cref{prop:oim-pure-dp}, we have that with probability $1-\beta$ all queries are accurate up to $C=\frac1a\log(\frac{|\cF|^2}{\beta})\big)$. In particular, under \textsc{Above} answers, we have that the $\ell_1$-norm of $\bh^{\ast}|_{\cS_{\acti}}$ decreases at least by
\[ f(\bh^{\ast}|_{\cS_{\acti}}) \geq \frac{1}{2(1-\zeta)}\alpha_0-C\geq \frac{\alpha_0}{4}.  \]
Similarly, under \textsc{Below} answers, we have that the $\ell_1$-norm of $\hbh|_{\cS_{\acti}}$ decreases at least by
\[ f(\hbh|_{\cS_{\acti}}) \geq \frac{\alpha_0}{2}-(1+\zeta)C\geq \frac{\alpha_0}{4}. \]
Therefore, under the event above, there cannot be more than $(4n/\alpha_0)$ \textsc{Above} or \textsc{Below} answers  before termination. Since $\Gamma=8n/\alpha_0$, the algorithm does not fail under this event.

Upon non-failure, this algorithm operates analogously to \Cref{alg:find-example}, hence by \Cref{lem:bad-margin} the conclusions follow.
\end{proofof}
%REST OF THE PROOF OMITTED
%Now, since $\max\{a_1,a_2,a_3\}\geq \|\hbh\|_1/3$, the first conclusion follows. We cover next each case separately:
%\begin{itemize}
%\item \underline{$\theta=\equal$.} Note that for queries in $\cF\setminus\cF_{\acti}$ the accuracy condition holds automatically. On the other hand, using Laplace concentration among the last $2|\cF_{\acti}|\leq 2|\cF|$ queries, for all $f\in \cF$
% \begin{eqnarray*}
                %\frac{1}{1+\zeta}\big( \langle \hbh|_{\cS_{\acti}},f\rangle-2\alpha_0 \big) \leq & 
                %\langle \bh^{\ast}|_{\cS_{\acti}}, f\rangle + \Lap\big(\frac{2}{\eps'}\big)
                %& \leq \frac{1}{1-\zeta}\big( \langle \hbh|_{\cS_{\acti}},f\rangle+2\alpha_0 \big) \\
                %\Longrightarrow
                %(1-\zeta)\langle \bh^{\ast}|_{\cS_{\acti}}, f\rangle -\alpha_0 \leq 
                %& \langle \hbh|_{\cS_{\acti}}, f\rangle &
                %\leq (1+\zeta)\big[\langle \bh^{\ast}|_{\cS_{\acti}}, f\rangle +\alpha_0.
%\end{eqnarray*}
%\item \underline{$\theta=\plus$.} At every query $(f,+,T^+)$ where \textsc{SVT}'s output is $\top$, we have%
            %\[ 
                %\langle \bh^{\ast}|_{\cS_{\acti}},f\rangle +\Lap\big( \frac{2}{\eps'} \big) \geq \frac{1}{(1-\zeta)}\big[\langle \hbh|_{\cS_{\acti}},f\rangle+2\alpha_0\big]. 
            %\]
            %Note that there can be at most $|\cF|$ such steps, and thus by a union bound with probability $1-\beta/2$, for all queries $f$ such that SVT's output is $\top$ (below $\cS_{\acti}$ corresponds to the state of $\cS_{\acti}$ before the query is performed)
            %\[ 
                %\langle \bh^{\ast}, \ind_{\cS_{\acti}\cap f^{-1}(1)}\rangle \geq (1-\zeta)^{-1} \langle \hbh, \ind_{\cS_{\acti}\cap f^{-1}(1)}\rangle
                %\geq (1+\zeta) \langle \hbh, \ind_{\cS_{\acti}\cap f^{-1}(1)}\rangle.
            %\]
            %Finally, since the indicators obtained on the right hand side of the brackets are disjoint accross iterations, and their union is $\cS^{\plus}$, adding up these inequalities we get
            %\[ \langle \bh^{\ast}, \ind_{\cS^{\plus}}\rangle 
            %\geq (1+\zeta) \langle \hbh, \ind_{\cS^{\plus}}\rangle.   \]
%\item \underline{$\theta=\minus$.} Analogous to the $\theta=\plus$ case.
%\end{itemize}
