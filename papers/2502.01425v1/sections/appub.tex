% !TeX root = ../all.tex


\section{Proofs related to the algorithm}\label{app:ub} 

\subsection{Additional Lemmas}

\begin{lemma}\label{lem:subG_concentration}
Let $(X_i)_{i \in \mathbb{N}}$ be i.i.d. $\sigma^2$-sub-Gaussian random variables with mean $\mu$. For $n \in \mathbb{N}$, let $\hat{\mu}_n$ be the average of the first $n$ random variables. Then
\begin{align*}
\mathbb{P}(\exists n \ge N, \ \hat{\mu}_n \ge \mu + \varepsilon) \le e^{- \frac{N \varepsilon^2}{2\sigma^2}}
\: , \\
\mathbb{P}(\exists n \ge N, \ \hat{\mu}_n \le \mu - \varepsilon) \le e^{- \frac{N \varepsilon^2}{2\sigma^2}} \: .
\end{align*}
\end{lemma}

\begin{proof}
Given $(X_1, \ldots, X_N)$, the process $M_n(\lambda) : n \mapsto e^{\lambda\sum_{i=1}^{N+n} (X_i - \mu) - \frac{1}{2}(N+n) \sigma^2 \lambda^2}$ is a nonnegative supermartingale for any $\lambda \in \mathbb{R}$ by the sub-Gaussian hypothesis, with expectation $e^{\lambda\sum_{i=1}^{N} (X_i - \mu) - \frac{1}{2}N \sigma^2 \lambda^2}$ at $n=0$.

By Ville's inequality,
\begin{align*}
\mathbb{P}(\exists n, \  M_n(\lambda) \ge 1/\delta \mid X_1, \ldots, X_N)
\le \delta e^{\lambda\sum_{i=1}^{N} (X_i - \mu) - \frac{1}{2}N \sigma^2 \lambda^2}
\end{align*}

For all $\lambda \in \mathbb{R}$ and all $\delta \in (0,1)$,
\begin{align*}
\mathbb{P}\left(\exists n \ge N, \  \lambda\sum_{i=1}^{n} (X_i - \mu) - \frac{1}{2}n\sigma^2 \lambda^2 \ge \ln(1/\delta)\right)
&= \mathbb{E}\left[\mathbb{P}(\exists n \ge 0, \  M_n(\lambda) \ge 1/\delta \mid X_1, \ldots, X_N)\right]
\\
&\le \delta \mathbb{E}\left[e^{\lambda\sum_{i=1}^{N} (X_i - \mu) - \frac{1}{2}N \sigma^2 \lambda^2}\right]
\\
&\le \delta
\: .
\end{align*}
Reordering, we get, for $\lambda \ge 0$,
\begin{align*}
\mathbb{P}\left(\exists n \ge N, \  \hat{\mu}_n \ge \mu + \frac{1}{2}\sigma^2 \lambda + \frac{1}{N \lambda}\ln\frac{1}{\delta}\right)
&\le \mathbb{P}\left(\exists n \ge N, \  \hat{\mu}_n \ge \mu + \frac{1}{2}\sigma^2 \lambda + \frac{1}{n \lambda}\ln\frac{1}{\delta}\right)
\\
&\le \delta
\: .
\end{align*}

Choose $\delta = e^{-\frac{N \varepsilon^2}{2 \sigma^2}}$ and $\lambda = \frac{\varepsilon}{\sigma^2}$ to obtain
\begin{align*}
\mathbb{P}\left(\exists n \ge N, \  \hat{\mu}_n \ge \mu + \varepsilon \right)
\le e^{-\frac{N \varepsilon^2}{2 \sigma^2}}
\: .
\end{align*}

The second inequality is obtained similarly, with $\lambda \le 0$.
\end{proof}

\begin{lemma}\label{lem:probaE_bis}
	The probability of $\mathcal E_r$ satisfies
	\begin{align*}
	\mathbb{P}(\mathcal E_r) \ge 1-2K\exp(- 2^r l_{1,r} \varepsilon_r^2/2\sigma^2)
	\: .
	\end{align*}
\end{lemma}

\begin{proof}
$\mathcal E_r$ is the event that $\Vert \bm\mu - \tilde{\bm\mu}^r \Vert_\infty \le \varepsilon_r$ and $\Vert \bm\mu - \hat{\bm\mu}^r \Vert_\infty \le \varepsilon_r$.
We use an union bound over the arms to bound the probability of the complement $\mathcal{E}_r^c$.
For each $i \in [K]$, $\tilde{\mu}^r_i$ and $\hat{\mu}^r_i$ are empirical means of at least $2^r l_{1,r}$ samples. We can thus apply Lemma~\ref{lem:subG_concentration} (twice, once for deviations from above and once for deviations from below).
\end{proof}

\begin{lemma}\label{lem:proba_Er}
	Let $p_r \in (0,1]$.
	For the choice $\varepsilon_r = \sqrt{\frac{2\sigma^2}{2^r l_1}\ln\frac{2K}{p_r}}$, the probability of the event $\mathcal E_r$ is $\mathbb{P}(\mathcal E_r) \ge 1 - p_r$.
\end{lemma}


\subsection{Proof of Theorem~\ref{th:alggen}}\label{app:ub_proof}

If $\overline{T}^\star(\hat{B}_r) > T_r$ then the algorithm does not enter the second batch of the phase by definition of the algorithm.

If $\overline{T}^\star(\hat{B}_r) \le T_r$ then by the choice of $\gamma_r$ and Lemma~\ref{lem:sufficientsampling}, under $\mathcal E_r$ the stopping condition is triggered.

We now prove the complexity upper bounds. Let $\mathcal C_r$ be the event that the algorithm attains phase $r$ and does not stop at that phase.
We proved that $\{\overline{T}^\star(\hat{B}_r) \le T_r\} \cap \mathcal E_r \subseteq \mathcal C_r^c$ for all $r$. That is, $\mathcal C_r \subseteq \mathcal E_r^c \cup \{\overline{T}^\star(\hat{B}_r) > T_r\}$.

Recall that $R^* = \min \{r \mid \forall r' \ge r, \ \mathcal E_{r'} \implies \overline{T}^\star(\hat{B}_{r'}) \le T_{r'}\}$.
\begin{align*}
R_\delta
&= \sum_{r=1}^{+\infty} \mathbb{I}(\mathcal C_{r-1}) + \mathbb{I}(\mathcal C_{r-1} \wedge \{\overline{T}^\star(\hat{B}_r) \le T_r\}) \: .
\\
&\le R^* + 2 \sum_{r=R^*+1}^{+\infty} \mathbb{I}(\mathcal C_{r-1}) + \sum_{r=1}^{R^*} \mathbb{I}(\mathcal C_{r-1} \wedge \{\overline{T}^\star(\hat{B}_r) \le T_r\})
\: .
\end{align*}
By definition of $R^*$, for $r \ge R^*$ we have $ \{\overline{T}^\star(\hat{B}_r) > T_r\} \subseteq \mathcal E_r^c$.
Using that property and the inclusion we proved on $\mathcal C_r$ we have, for $r > R^*$,
\begin{align*}
\mathcal C_{r-1}
\subseteq \mathcal E_{r-1}^c \cup \{\overline{T}^\star(\hat{B}_{r-1}) > T_{r-1}\}
\subseteq \mathcal E_{r-1}^c
\: .
\end{align*}
Therefore,
\begin{align*}
R_\delta
&\le R^* + 2 \sum_{r=R^*+1}^{+\infty} \mathbb{I}(\mathcal E_{r-1}^c) + \sum_{r=1}^{R^*} \mathbb{I}(\mathcal C_{r-1} \wedge \{\overline{T}^\star(\hat{B}_r) \le T_r\})
\: .
\end{align*}
When $\mathcal E_r$ happens $T^\star(\bm\mu) \le \overline{T}^\star(\hat{B}_r)$, hence $\{\overline{T}^\star(\hat{B}_r) \le T_r\} \subseteq \mathcal E_r^c \cup \{T^\star(\bm\mu) \le T_r\}$.
\begin{align*}
R_\delta
&\le R^* + 2 \sum_{r=R^*+1}^{+\infty} \mathbb{I}(\mathcal E_{r-1}^c) + \sum_{r=1}^{R^*} \mathbb{I}(\mathcal E_{r}^c)
	+ \sum_{r=1}^{R^*} \mathbb{I}(\{T^\star(\bm\mu) \le T_r\})
\\
&\le R^* + 1 + 2 \sum_{r=1}^{+\infty} \mathbb{I}(\mathcal E_{r}^c) + \sum_{r=1}^{R^*} \mathbb{I}(\{T^\star(\bm\mu) \le T_r\})
\: .
\end{align*}
Finally, $ \sum_{r=1}^{R^*} \mathbb{I}(\{T^\star(\bm\mu) \le T_r\}) = \max\{0, R^* - \lceil \log_2 \frac{T^\star(\bm\mu)}{T_0} \rceil \}$, and the definition of $R^*$ implies $R^* \ge \lceil \log_2 \frac{T^\star(\bm\mu)}{T_0} \rceil$.

We now bound the sample complexity $\tau_\delta$. Since $\bar{t}_r$ is an upper bound on the sample complexity up to phase $r$,
\begin{align*}
\tau_\delta
&\le \sum_{r=1}^{+\infty} \bar{t}_r \mathbb{I}\{C_{r-1}\}
\\
&\le \bar{t}_{R^*} + \sum_{r=R^* + 1}^{+\infty} \bar{t}_r \mathbb{I}\{C_{r-1}\}
\\
&\le \bar{t}_{R^*} + \sum_{r=R^* + 1}^{+\infty} \bar{t}_r \mathbb{I}\{E_{r-1}^c\}
\: .
\end{align*}



\subsection{Proof of the batch and complexity upper bounds}

We finish the proof of Theorem~\ref{thm:compexity_upper_bounds} from where we stopped in the main text. We have
\begin{align*}
\mathbb{E}\left[R_\delta\right]
&\le 2r^* - \lceil \log_2 \frac{T^\star(\bm\mu)}{T_0} \rceil + 1 + 2\sum_{r = 1}^{+\infty} p_r
\: , \\
\mathbb{E}\left[\tau_\delta\right]
&\le \bar{t}_{r^*} + \sum_{r = 1}^{+\infty} p_{r} \bar{t}_{r+1}
\: .
\end{align*}
In those expressions, $r^* = \max\{r_0, r_1\}$ with $r_0 = \min\{r \mid 2 \varepsilon_r \le b(\bm\mu)\}$, $r_1 =  \min \{r \mid T_r \ge e T^\star(\bm\mu)\}$, and
$\bar{t}_r = (K l_{1,r}/T_0 + 2 \gamma_r) T_r$ with $l_{1,r}/T_0 = 32 \ln(2 \sqrt{2K} T_r)$.

The choice of $p_r$ is a trade-off between the sums and $r_0$. We choose $p_r = T_{r+1}^2$.

\paragraph{Bounding the sums}
The sum in the batch complexity is bounded by $T_0^{-2}/3$.
The sum that appears in the sample complexity is
\begin{align*}
\sum_{r = \max\{r_0, r_1\}+1}^{+\infty} p_{r-1} \bar{t}_r
= \sum_{r = \max\{r_0, r_1\}+1}^{+\infty} \frac{\bar{t}_r}{T_r^2}
\: .
\end{align*}
We will need the values of a few sums.
\begin{align*}
\sum_{r=1}^{+\infty} \frac{1}{T_r}
&= \sum_{r=1}^{+\infty} \frac{1}{2^r T_0}
= \frac{1}{T_0}
\: , \\
\sum_{r=1}^{+\infty} \frac{\ln T_r}{T_r}
&= \frac{1}{T_0} \sum_{r=1}^{+\infty} \frac{r \ln2 + \ln T_0}{2^r}
= \frac{\ln (4T_0)}{T_0}
\: .
\end{align*}

Let $c_{K,\delta} = 4 \ln \frac{1}{\delta} + 4K (11 + \ln K)$.
By Lemma~\ref{lem:gamma_ub_bis}, $\gamma_r \le 8K \ln(T_r) + c_{K,\delta}$ .
An upper bound on the sample complexity until the end of phase $r$ is then
\begin{align*}
\bar{t}_r
&= (K l_{1,r}/T_0 + 2\gamma_r) T_r
\\
&= (32 K \ln(2\sqrt{2K}T_r) + 2 \gamma_r) T_r
\\
&\le (48 K \ln(T_r) + 32 K \ln(2\sqrt{2K}) + c_{K,\delta})T_r
\: .
\end{align*}
The sum that appears in the sample complexity is at most
\begin{align*}
\sum_{r = 1}^{+\infty} \frac{\bar{t}_r}{T_r^2}	
&\le \frac{48 K \ln(4T_0) + 32 K \ln(2\sqrt{2K}) + c_{K,\delta}}{T_0}
\: .
\end{align*}

\paragraph{Bound on $r^*$ and $\bar{t}_{r^*}$}

\begin{align*}
\bar{t}_{r^*}
\le (48 K \ln (\max\{T_{r_0}, T_{r_1}\}) + 32 K \ln(2\sqrt{2K}) + c_{K,\delta}) \max\{T_{r_0}, T_{r_1}\}
\: .
\end{align*}


Recall that $r_0 = \min\{r \mid 2 \varepsilon_r \le b(\bm\mu)\}$, $r_1 =  \min \{r \mid T_r \ge e T^\star(\bm\mu)\}$.
If we get an upper bound $n$ on $T_i$, we then have $r_i \le \log_2 \frac{n}{T_0}$.
We get a bound on $T_{r_1}$ from its definition: $T_{r_1-1} \le e T^*(\bm\mu)$ hence $T_{r_1} \le 2 e T^\star(\bm\mu)$.

Since $\varepsilon_{r_0 - 1} \ge b(\bm\mu)/2$, we get an inequality on $T_{r_0 - 1}$.
\begin{align*}
\sqrt{\frac{2\sigma^2}{2^{r_0 - 1}l_{1, r_0-1}} \ln \left( 2K T_{r_0}^2 \right)} \ge \frac{b(\bm\mu)}{2}
\: .
\end{align*}
With the value of $l_{1,r}$ and using $2 T_{r_0 - 1} = T_{r_0}$, this becomes
\begin{align*}
T_{r_0} \le \frac{\sigma^2}{b(\bm\mu)^2}
\: .
\end{align*}

Let $T^\star_b(\bm\mu) = \max\{\frac{\sigma^2}{b(\bm\mu)^2}, 2 e T^\star(\bm\mu)\}$.
We have proved $\max\{T_{r_0}, T_{r_1}\} \le T^\star_b(\bm\mu)$, hence
\begin{align*}
\bar{t}_{r^*}
\le (48 K \ln T^\star_b(\bm\mu) + 32 K \ln(2\sqrt{2K}) + c_{K,\delta}) T^\star_b(\bm\mu)
\end{align*}
and $r^* \le \log_2 \frac{T^\star_b(\bm\mu)}{T_0}$.

\paragraph{Putting things together}

\begin{align*}
\mathbb{E}\left[R_\delta\right]
&\le \log_2 \frac{T^\star_b(\bm\mu)}{T_0} + \log_2 \frac{T^\star_b(\bm\mu)}{T^\star(\bm\mu)} + 1 + T_0^{-2}
\: , \\
\mathbb{E}\left[\tau_\delta\right]
&\le (48 K \ln T^\star_b(\bm\mu) + 32 K \ln(2\sqrt{2K}) + c_{K,\delta}) T^\star_b(\bm\mu)
\\ & \quad + \frac{48 K \ln(4T_0) + 32 K \ln(2\sqrt{2K}) + c_{K,\delta}}{T_0}
\: .
\end{align*}

Let's simplify the sample complexity.
\begin{align*}
32 K \ln(2\sqrt{2K}) + c_{K,\delta}
&= 32 K \ln(2\sqrt{2K}) + 4 \ln \frac{1}{\delta} + 4K (11 + \ln K)
\\
&= 4 \ln \frac{1}{\delta} + 4K (5\ln K + 11 + 4 \ln(8))
\\
&\le 4 \ln \frac{1}{\delta} + 20K (\ln K + 4)
\: .
\end{align*}

\begin{align*}
\mathbb{E}\left[\tau_\delta\right]
&\le (48 K \ln T^\star_b(\bm\mu) + 4 \ln \frac{1}{\delta} + 20K (\ln K + 4)) T^\star_b(\bm\mu)
\\ & \quad + (48 K \ln(4T_0) + 4 \ln \frac{1}{\delta} + 20K (\ln K + 4)) T_0^{-1}
\\
&= 4 \ln \left(\frac{1}{\delta}\right) (T^\star_b(\bm\mu) + T_0^{-1}) + 20K (\ln K + 4) (T^\star_b(\bm\mu) + T_0^{-1})
	+ 48 K (T^\star_b(\bm\mu) \ln T^\star_b(\bm\mu) + T_0^{-1} \ln(4T_0))
\: .
\end{align*}



\subsection{Implication between the two assumptions}

We prove Lemma~\ref{lem:asm2_implies_asm1}.

\begin{lemma}\label{lem:sub_sqrt_inv_TStar} 
Let $\bm\nu$ and $\bm\nu'$ be two instances and let $\omega_{\bm \mu} = \arg\max_\omega \inf_{\lambda \in Alt_{\bm\mu}}\sum_{i=1}^K \omega_i (\mu_i - \lambda_i)^2$. Then
\begin{align*}
\sqrt{T^\star(\bm\mu)^{-1}} - \sqrt{T^\star(\bm\mu')^{-1}}
\le \frac{1}{\sqrt{2\sigma^2}} \Vert \mu - \mu' \Vert_\infty
\: .
\end{align*}
\end{lemma}

\begin{proof}
For $\omega \in \Sigma_K$ and $\bm x \in \mathbb{R}^K$, let $\Vert \bm x \Vert_\omega = \sqrt{\sum_{i=1}^K \omega_i x_i^2}$.
It satisfies the triangle inequality and $\Vert \bm x \Vert_\omega \le \Vert \bm x \Vert_\infty$.
For any $\bm\lambda$ and $\omega$,
\begin{align*}
\Vert \bm\mu - \bm\lambda\Vert_\omega \le \Vert \bm\mu' - \bm\lambda\Vert_\omega + \Vert \bm\mu - \bm\mu'\Vert_\omega
\: .
\end{align*}
We can take an infimum on both sides over lambda in $Alt_{\bm\mu}$ and then apply the result to $\omega_{\bm\mu}$ to get
\begin{align*}
\sqrt{2\sigma^2 T^\star(\bm\mu)^{-1}} \le \inf_{\lambda \in Alt_{\bm\mu}}\Vert \bm\mu' - \bm\lambda\Vert_{\omega_{\bm\mu}} + \Vert \bm\mu - \bm\mu'\Vert_{\omega_{\bm\mu}}
\: .
\end{align*}
Either $Alt_{\bm\mu} = Alt_{\bm\mu'}$ and we can replace by that on the right hand side, or $\bm\mu' \in Alt_{\bm\mu}$. In that second case $\inf_{\lambda \in Alt_{\bm\mu}}\Vert \bm\mu' - \bm\lambda\Vert_{\omega_{\bm\mu}} = 0 \le \inf_{\lambda \in Alt_{\bm\mu'}}\Vert \bm\mu' - \bm\lambda\Vert_{\omega_{\bm\mu}}$. We thus have
\begin{align*}
\sqrt{2\sigma^2 T^\star(\bm\mu)^{-1}} \le \inf_{\lambda \in Alt_{\bm\mu'}}\Vert \bm\mu' - \bm\lambda\Vert_{\omega_{\bm\mu}} + \Vert \bm\mu - \bm\mu'\Vert_{\omega_{\bm\mu}}
\: .
\end{align*}
We maximize over $\omega$ to get $\inf_{\lambda \in Alt_{\bm\mu'}}\Vert \bm\mu' - \bm\lambda\Vert_{\omega_{\bm\mu}} \le \sqrt{2\sigma^2 T^\star(\bm\mu')^{-1}}$, hence
\begin{align*}
\sqrt{2\sigma^2 T^\star(\bm\mu)^{-1}}
&\le \sqrt{2\sigma^2 T^\star(\bm\mu')^{-1}} + \Vert \bm\mu - \bm\mu'\Vert_{\omega_{\bm\mu}}
\\
&\le \sqrt{2\sigma^2 T^\star(\bm\mu')^{-1}} + \Vert \bm\mu - \bm\mu'\Vert_{\infty}
\: .
\end{align*}
After dividing by $\sqrt{2\sigma^2}$, this is the inequality of the lemma.
\end{proof}


\begin{corollary}\label{cor:sub_ln_TStar_le}
For all $\bm\mu$ and $\bm\mu'$,
\begin{align*}
\ln T^\star(\bm\mu') - \ln T^\star(\bm\mu)
\le \sqrt{\frac{2}{\sigma^2}T^\star(\bm\mu')} \ \Vert \bm\mu - \bm\mu' \Vert_\infty
\: .
\end{align*}
\end{corollary}

\begin{proof}
\begin{align*}
\ln T^\star(\bm\mu') - \ln T^\star(\bm\mu)
&= 2 \ln \left( 1 + \frac{\sqrt{T^\star(\bm\mu)^{-1}} - \sqrt{T^\star(\bm\mu')^{-1}}}{\sqrt{T^\star(\bm\mu')^{-1}}} \right)
\\
&\le 2 \frac{\sqrt{T^\star(\bm\mu)^{-1}} - \sqrt{T^\star(\bm\mu')^{-1}}}{\sqrt{T^\star(\bm\mu')^{-1}}}
\\
&\le \sqrt{\frac{2}{\sigma^2}T^\star(\bm\mu')} \ \Vert \bm\mu - \bm\mu' \Vert_\infty
\: .
\end{align*}

\end{proof}


\begin{corollary}\label{cor:abs_sub_ln_TStar_le}
For all $\bm\mu$ and $\bm\mu'$ with $\Vert \bm\mu - \bm\mu' \Vert_\infty \le \sqrt{\sigma^2 / (2 T^\star(\bm\mu))}$,
\begin{align*}
\left\vert \ln T^\star(\bm\mu') - \ln T^\star(\bm\mu) \right\vert
\le \sqrt{\frac{8}{\sigma^2}T^\star(\bm\mu)} \ \Vert \bm\mu - \bm\mu' \Vert_\infty
\: .
\end{align*}
\end{corollary}

\begin{proof}
One of the two inequalities we need to prove is due to Corollary~\ref{cor:sub_ln_TStar_le}. For the other, by the same corollary,
\begin{align*}
\ln T^\star(\bm\mu') - \ln T^\star(\bm\mu)
\le \sqrt{\frac{2}{\sigma^2}T^\star(\bm\mu')} \ \Vert \bm\mu - \bm\mu' \Vert_\infty
\: .
\end{align*}
It remains to show $T^\star(\bm\mu') \le 4 T^\star(\bm\mu)$. By Lemma~\ref{lem:sub_sqrt_inv_TStar} and the the hypothesis on $\Vert \bm\mu - \bm\mu' \Vert_\infty$,
\begin{align*}
\sqrt{T^\star(\bm\mu)^{-1}} - \sqrt{T^\star(\bm\mu')^{-1}}
\le \frac{1}{\sqrt{2\sigma^2}} \Vert \bm\mu - \bm\mu' \Vert_\infty
\le \frac{1}{2}\sqrt{T^\star(\bm\mu)^{-1}} \: .
\end{align*}
Reordering proves the inequality.
\end{proof}



\subsection{Proofs for Top-K and thresholding bandits}
\label{app:topk_threshold}

This section is devoted to the proof of Lemma~\ref{lem:constrBbai}. We start with a preliminary result allowing us to compute $\overline{w}^\star(B)$ once we have found a suitable instance in $B$.


\begin{lemma}\label{lem:wbwst}
	If all instances in $B$ share the same correct answer $i^\star$ and if there exists some mean vector $\bm b\in B$ such that\begin{equation}\label{eq:bworst} \inf_{\bm\nu\in B}\inf_{\bm{\lambda}\in Alt_{\bm b}} \sum_i w_i(\bm{b}) \frac{(\mu_i-\lambda_i)^2}{2\sigma^2}\geq \inf_{\bm{\lambda}\in Alt_{\bm b}} \sum_i w_i(\bm{b}) \frac{(b_i-\lambda_i)^2}{2\sigma^2}\end{equation} where $w(\bm\mu)=\argmax_{w\in \Sigma_K} \inf_{\bm\lambda \in Alt_{\bm\mu}} \sum_i w_i \frac{(\mu_i-\lambda_i)^2}{2\sigma^2}$, then $\overline{T}^\star(B) = \max_{\bm \mu\in B}T^\star(\bm \mu)$.
\end{lemma}

\begin{proof}
	For some $w\in \Sigma_K$, writing $f(w,\bm\mu')=\inf_{\bm\lambda\in Alt_{\bm b}} \sum_i w_i \frac{(\mu'_i-\lambda_i)^2}{2\sigma^2}$ for clarity,
	\begin{align*}
		\inf_{\bm \nu\in \hat{B}_r} f( w,\bm\mu) &\leq f( w,\bm b) &\text{because }\bm b\in \hat{B}_r\\
		&\leq f(w_{\bm b},\bm b)& \text{from the definition of }w_{\bm b}\\
		&\leq \inf_{\bm\mu'\in\hat{B}_r} f(w_{\bm b},\bm\mu')&\text{from the hypothesis}
	\end{align*} so that $w^\star(\bm b) = \argmax_{w\in \Sigma_K} \inf_{\bm\nu\in\hat{B}_r} f(\bm w,\nu)=\overline w^\star(B)$.

\begin{align*}
	\overline{T}^\star(B) &= \left( \inf_{\bm\nu'\in B} \inf_{\bm\lambda \in Alt_{\bm\nu'}} \sum_i \overline{w}^\star_i(B) \frac{(\mu'_i-\lambda_i)^2}{2\sigma^2}\right)^{-1} &\\
	&=\left( \inf_{\bm\nu'\in B} \inf_{\bm\lambda \in Alt_{\bm\nu'}} \sum_i w^\star_i(\bm b) \frac{(\mu'_i-\lambda_i)^2}{2\sigma^2}\right)^{-1}&\\
	&=\left(  \inf_{\bm\lambda \in Alt_{\bm b}} \sum_i w^\star_i(\bm b) \frac{(b_i-\lambda_i)^2}{2\sigma^2}\right)^{-1}&\hspace{-5em}\text{by Equation~\eqref{eq:bworst}}\\
	&= T^\star(\bm b)&
\end{align*}
hence $\overline{T}(B) \leq \max_{\bm\nu\in B} T^\star(\bm\nu)$. By definition, we have the other inequality, and we conclude.
\end{proof}



\lemconstrBbai*

We prove the result separately for top-$k$ and TBP. In both cases, we give a certain mean vector $\bm b$, and then we show it satisfies the premise of Lemma~\ref{lem:wbwst}, then we use that result to show that $\overline{T}^\star(\mathcal{B}_\infty(\bm\mu,\varepsilon))=T^\star(\bm b)$.

\begin{proof}[Proof of Lemma~\ref{lem:constrBbai} for top-$k$]
	Assume without loss of generality that the arms are well ordered, $\mu_1\geq \mu_2\geq \cdots \geq \mu_K$.
	
	If $\mu_{k}-\mu_{k+1}\leq 2\varepsilon$, then there exists $\bm b\in \mathcal B_{\infty}(\bm\mu, \varepsilon)$ such that $b_k=b_{k+1}$. $\overline{T}^\star(\mathcal B_{\infty}(\bm\mu, \varepsilon))\geq \max_{\bm\nu'\in \mathcal B_{\infty}(\bm\mu, \varepsilon)} T^\star(\bm\nu')\geq T^\star(\bm b)=+\infty$, therefore \[\overline{T}^\star(\mathcal B_{\infty}(\bm\mu, \varepsilon))= \max_{\bm\nu'\in \mathcal B_{\infty}(\bm\mu, \varepsilon)} T^\star(\bm\nu')\: .\]
	
	When $\mu_k-\mu_{k+1}>2\varepsilon$, define \[\left\{ \begin{aligned} &b_i= \mu_i-\varepsilon \qquad\text{if }i\leq k \\ &b_i =\mu_i +\varepsilon \qquad\text{if }i\geq k+1\end{aligned}\right. \]
	and, for any $\bm\nu'$, \[w_{\bm\nu'} =\argmax_{w\in \Sigma_K} \inf_{\bm\lambda\in Alt_{\bm\nu'}} \sum_i w_i \frac{(\mu_i'-\lambda_i)^2}{2\sigma^2}.\] 
	
	
	Let there be some $\bm{\nu}'\in \mathcal B_{\infty}(\bm\mu, \varepsilon)$. Then for $i\leq k$, $\mu'_{i} \geq \mu_i-\varepsilon=b_{i}$ and for $i\geq l+1$, $\mu'_i \leq \mu_i +\varepsilon = b_i$, and $Alt_{\bm\nu'}=Alt_{\bm b}$.
	
	We know from Lemma~\ref{lem:baiw} \begin{equation}\label{eq:argmin} \min_{\bm{\lambda}\in Alt_{\bm b}}\sum_i  w_i(\bm{b})\frac{(\mu'_i-\lambda_i)^2}{2\sigma^2} = w_a(\bm b)\frac{(\mu'_a-\mu'_{aj})^2}{2\sigma^2}+w_j(\bm b)\frac{(\mu'_j-\mu'_{aj})^2}{2\sigma^2}\end{equation} for some $a\leq k<k+1\leq j$, and $\mu'_{aj}= \frac{w_a(\bm{b})}{w_a(\bm{b})+w_j(\bm{b})}\mu'_a + \frac{w_j(\bm{b})}{w_a(\bm{b})+w_j(\bm{b})}\mu'_j$. 
	

	\begin{itemize}
		\item If $\mu'_{aj}\in (b_a,\mu'_a)$, then \begin{align*}
			w_a(\bm{b}) (\mu'_a-\mu'_{aj})^2+w_j(\bm{b}) (\mu'_j-\mu'_{aj})^2 &\geq 0+w_j(\bm{b}) (\mu'_j-b_a)^2 \\
			&\geq w_a(\bm{b})(b_a-b_a)^2+w_j(\bm{b})(b_j-b_a)^2\\
		\end{align*}
		\item If $\mu'_{aj}\in (b_j,b_a)$, \begin{align*}
			w_a(\bm{b}) (\mu'_a-\mu'_{aj})^2+w_j(\bm{b}) (\mu'_j-\mu'_{aj})^2 &\geq w_a(\bm{b})(b_a-\mu'_{aj})^2 +w_j(\bm{b})(b_j-\mu'_{aj})^2
		\end{align*}
		\item If $\mu'_{aj} \in (\mu'_j,b_j)$, \begin{align*} w_a(\bm{b}) (\mu'_a-\mu'_{aj})^2+w_j(\bm{b}) (\mu'_j-\mu'_{aj})^2 &\geq w_a(\bm{b})(\mu'_a-b_j)^2+0 \\
			&\geq w_a(\bm{b}) (b_a-b_j)^2 +w_j(\bm{b})(b_j-b_j)^2\end{align*}
	\end{itemize}
	In all three cases, \begin{align*} w_a(\bm{b}) (\mu'_a-\mu'_{aj})^2+w_j(\bm{b}) (\mu'_j-\mu'_{aj})^2 &\geq \inf_{\lambda\in [b_j,b_a]} w_a(\bm{b}) (b_a-\lambda)^2+w_j(\bm{b})(b_j-\lambda)^2\\
		&\geq \inf_{\bm{\lambda}\in Alt_{\bm b}} \sum_i w_i(\bm{b}) (b_i-\lambda_i)^2
	\end{align*}
	and therefore, by Equation~\eqref{eq:argmin}, \[\forall \bm\nu' \in B_{\infty}(\bm\mu, \varepsilon),\; \inf_{\bm{\lambda}\in Alt_{\bm b}} \sum_i w_i(\bm{b}) \frac{(\nu_i-\lambda_i)^2}{2\sigma^2}\geq \inf_{\bm{\lambda}\in Alt_{\bm b}} \sum_i w_i(\bm{b}) \frac{(b_i-\lambda_i)^2}{2\sigma^2} \] and therefore \begin{equation} \inf_{\bm\nu\in\mathcal B_{\infty}(\bm\mu, \varepsilon)}\inf_{\bm{\lambda}\in Alt_{\bm b}} \sum_i w_i(\bm{b}) \frac{(\nu_i-\lambda_i)^2}{2\sigma^2}\geq \inf_{\bm{\lambda}\in Alt_{\bm b}} \sum_i w_i(\bm{b}) \frac{(b_i-\lambda_i)^2}{2\sigma^2}\end{equation}
	
We can thus apply Lemma~\ref{lem:wbwst}, and conclude

\[\overline{T}(\mathcal B_{\infty}(\bm\mu, \varepsilon)) = \max_{\bm\nu\in \mathcal B_{\infty}(\bm\mu, \varepsilon)} T^\star(\bm\nu) \: .\]
\end{proof}









\begin{proof}[Proof of Lemma~\ref{lem:constrBbai} for thresholding bandits]
	If for some $i$, $|\mu_i -\tau|\leq \varepsilon$, then there exists $\bm b\in \mathcal{B}_\infty(\bm\mu,\varepsilon)$ such that $b_i = \tau$. Therefore, $\overline{T}^\star(\mathcal{B}_\infty(\bm\mu,\varepsilon)) \geq \max_{\bm\nu'\in \mathcal{B}_\infty(\bm\mu,\varepsilon)} T^\star(\bm\nu')\geq T^\star(\bm b) =+\infty$, therefore \[\overline{T}^\star(\mathcal{B}_\infty(\bm\mu,\varepsilon)) = \max_{\bm\nu'\in \mathcal{B}_\infty(\bm\mu,\varepsilon)}T^\star(\bm\nu') \: .\]
	
	When $\min_k |\mu_k-\tau|>\varepsilon$, define $U=\{i\in[K]:\mu_i >\tau\}$ and $L=[K]\setminus U$. Define \[\left\{ \begin{aligned} &b_i= \mu_i-\varepsilon &\text{if }i\in U \\ &b_i =\mu_i +\varepsilon &\text{if }i\in L.\end{aligned}\right. \] and for any $\bm\nu'$, $w_{\bm\nu'} =\argmax_{w\in \Sigma_K} \inf_{\bm\lambda \in Alt_{\bm\nu'}} \sum_i w_i\frac{(\mu_i'-\lambda_i)^2}{2\sigma^2}$.
	
	
	
	
	Let there be some $\bm\nu\in \mathcal{B}_\infty(\bm\mu,\varepsilon)$.	We know $\min_{\bm\lambda \in Alt_{\bm b}} \sum_i w_i(\bm b)\frac{(\mu'_i-\lambda_i)^2}{2\sigma^2}=w_j(\bm b) \frac{(\mu'_j-\tau)^2}{2\sigma^2}$ for some $j$. 
	
	For all $i\in U$, $\mu'_i \geq \mu_i-\varepsilon = b_i>\tau$; for all $i\in L$, $\mu'_i \leq \mu_i+\varepsilon = b_i<\tau$. Therefore, \[w_j(\bm b) \frac{(\mu'_j-\tau)^2}{2\sigma^2}\geq w_j(\bm b) \frac{(b_j-\tau)^2}{2\sigma^2}\geq \inf_{\bm\lambda \in Alt_{\bm b}} \sum_i w_i(\bm b) \frac{(b_i-\lambda_i)^2}{2\sigma^2}\]
	We thus have $\forall \bm\nu' \in \mathcal{B}_\infty(\bm\mu,\varepsilon)$, $\inf_{\bm\lambda\in Alt_{\bm b}} \sum_i w_i(\bm b)\frac{(\mu'_i-\lambda_i)^2}{2\sigma^2} \geq \inf_{\bm\lambda \in Alt_{\bm b}} \sum_i w_i(\bm b) \frac{(b_i-\lambda_i)^2}{2\sigma^2}$, and \[\inf_{\nu\in\hat{B}_r}\inf_{\bm\lambda\in Alt_{\bm b}} \sum_i w_i(\bm b)\frac{(\nu_i-\lambda_i)^2}{2\sigma^2} \geq \inf_{\bm\lambda \in Alt_{\bm b}} \sum_i w_i(\bm b) \frac{(b_i-\lambda_i)^2}{2\sigma^2}\] and by Lemma~\ref{lem:wbwst},
\[\overline{T}(\mathcal B_{\infty}(\bm\mu, \varepsilon)) = \max_{\bm\nu\in \mathcal B_{\infty}(\bm\mu, \varepsilon)} T^\star(\bm\nu) \: .\]
\end{proof}
