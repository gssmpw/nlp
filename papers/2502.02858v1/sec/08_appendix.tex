\newpage
\onecolumn
\section{Appendix}

\subsection{Self-collision Configuration}\label{append:self_collision}

For self-collision, we consider 29 pairs of humanoid bodies located at the joints listed below.

\input{tab/table_self_collision}

\subsection{Derivation of Safe Control Constraints}\label{append:safe_control_constraint}

We provide an example derivation of $L_f\bphi(x)$ and $L_g\bphi(x)$ for completing the control constraints in \eqref{eq:safe_contr_rssa} for r-SSA and \eqref{eq:safe_contr_pssa_phase_1} and \eqref{eq:safe_contr_pssa_phase_2} for p-SSA.
Assume that we have $M_\mathrm{env}$ different energy functions $[\phi^\mathrm{env}_1,\dots,\phi^\mathrm{env}_{M_\mathrm{env}}]$ for humanoid-obstacle collision and another $M_\mathrm{self}$ for self-collision: $[\phi^\mathrm{self}_1,\dots,\phi^\mathrm{self}_{M_\mathrm{self}}]$.
$\phi^\mathrm{env}_i=d_\mathrm{min,env}-d_i$ requires the distance between a collision body $j$ on the humanoid and an obstacle $k$ to be no less than $d_\mathrm{min,env}$.
Likewise, $\phi^\mathrm{self}_{i} = d_\mathrm{min,self}-d_i$ requires collision body $j$ and collision body $k$ to be at least $d_\mathrm{min,self}$ apart.
$d_i$ represents the current distance of interest with humanoid state $x$.
The final safety index is
\begin{equation}    
\bphi\defeq[\phi^\mathrm{env}_1,\dots,\phi^\mathrm{env}_{M_\mathrm{env}},\phi^\mathrm{self}_1,\dots,\phi^\mathrm{self}_{M_\mathrm{self}}]\in\RR^M
\end{equation}

We first derive $L_f\bphi(x)[i]$ and $L_g\bphi(x)[i]$ ($i^\mathrm{th}$ row) for $i\in[1,M_\mathrm{env}]$.
Assume that both collision bodies and obstacles are modeled as spheres with radius $R$, the distance $d_i$ is given by
\begin{equation}
    d_i = \|\bF_j(x) - t^O_k\| - 2R
\end{equation}
where $\bF_j(\cdot)$ is the forward kinematics function that computes the 3D center position of the collision sphere $j$ on the humanoid from joint position $x$.
$t^O_k$ is the 3D center position of the obstacle $k$.
We have
\begin{align}
    \frac{\partial d_i}{\partial x} &= \|\bF_j(x) - t^O_k\|^{-1}\left(\bF_j(x) - t^O_k\right)^\top \bJ_j(x)
\end{align}
where $\bJ_j(\cdot)$ is the Jacobian of the 3D center position of collision body $j$ with respect to the humanoid joint positions.
Then, we have
\begin{align}
    L_f\bphi(x)[i] &= \frac{\partial\bphi}{\partial x}f(x)[i] = \frac{\partial\phi^\mathrm{env}_i}{\partial x}f(x) = - \frac{\partial d_i}{\partial x}f(x) \\
    &= -\|\bF_j(x) - t^O_k\|^{-1}\left(\bF_j(x) - t^O_k\right)^\top \bJ_j(x) f(x) \label{eq:lf_env}
\end{align}
Similarly,
\begin{align}
    L_g\bphi(x)[i] &= -\|\bF_j(x) - t^O_k\|^{-1}\left(\bF_j(x) - t^O_k\right)^\top \bJ_j(x) g(x) \label{eq:lg_env}
\end{align}

To derive for $i\in[M_\mathrm{env}+1,M_\mathrm{env}+M_\mathrm{self}]$, we have
\begin{equation}
    d_i = \|\bF_j(x) - \bF_k(x)\| - 2R
\end{equation}
with gradient
\begin{align}
    \frac{\partial d_i}{\partial x} &= \|\bF_j(x) - \bF_k(x)\|^{-1}\left(\bF_j(x) - \bF_k(x)\right)^\top \left(\bJ_j(x) - \bJ_k(x)\right)
\end{align}
Similar to \eqref{eq:lf_env} and \eqref{eq:lg_env}, we have
\begin{align}
    L_f\bphi(x)[i] &= -\|\bF_j(x) - \bF_k(x)\|^{-1}\left(\bF_j(x) - \bF_k(x)\right)^\top \left(\bJ_j(x) - \bJ_k(x)\right) f(x) \\
    L_g\bphi(x)[i] &= -\|\bF_j(x) - \bF_k(x)\|^{-1}\left(\bF_j(x) - \bF_k(x)\right)^\top \left(\bJ_j(x) - \bJ_k(x)\right) g(x)
\end{align}

% \frac{\partial\bphi}{\partial x}f(x)

\subsection{Comparison of $\phi$ in Simulated Safe Goal Reaching}\label{append:phi_compare}

\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\linewidth]{figure/Frame_L_ee_Phi.png}
    \caption{Change of $\phi$ that describes safety between the left hand and the nearest obstacle in \cref{fig: sim_example}. We can see that p-SSA consistently bounds $\phi$ below zero with some tolerance due to discretization. r-SSA allows more violations when handling infeasible QP. Naive SSA (No Slack) leads to the most significant violations.}
    \label{fig:l_ee_phi}
\end{figure}

\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\linewidth]{figure/Left_Elbow_Pos.png}
    \caption{Change of left elbow joint position in \cref{fig: sim_example}.}
    \label{fig:l_elbow_pos}
\end{figure}

\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\linewidth]{figure/Left_Shoulder_Roll_Pos.png}
    \caption{Change of left shoulder roll joint position in \cref{fig: sim_example}.}
    \label{fig:l_shoulder_roll}
\end{figure}