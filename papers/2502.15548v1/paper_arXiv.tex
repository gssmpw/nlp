% SIAM Article Template
\documentclass[review,onefignum,onetabnum]{siamart250106}

\nolinenumbers
% Information that is shared between the article and the supplement
% (title and author information, macros, packages, etc.) goes into
% ex_shared.tex. If there is no supplement, this file can be included
% directly.

\input{ex_shared}

% Optional PDF information
\ifpdf
\hypersetup{
  pdftitle={Modal analysis of a domain decomposition method for Maxwell's equations in a waveguide},
  pdfauthor={V. Dolean, A. Tonnoir, P.-H. Tournier}
}
\fi

% The next statement enables references to information in the
% supplement. See the xr-hyperref package for details.

%\externaldocument[][nocite]{ex_supplement}

% FundRef data to be entered by SIAM
%<funding-group specific-use="FundRef">
%<award-group>
%<funding-source>
%<named-content content-type="funder-name"> 
%</named-content> 
%<named-content content-type="funder-identifier"> 
%</named-content>
%</funding-source>
%<award-id> </award-id>
%</award-group>
%</funding-group>

\begin{document}

\maketitle

% REQUIRED
\begin{abstract}
Time-harmonic wave propagation problems, especially those governed by Maxwell’s equations, pose significant computational challenges due to the non-self-adjoint nature of the operators and the large, non-Hermitian linear systems resulting from discretization. Domain decomposition methods, particularly one-level Schwarz methods, offer a promising framework to tackle these challenges, with recent advancements showing the potential for weak scalability under certain conditions. In this paper, we analyze the weak scalability of one-level Schwarz methods for Maxwell’s equations in strip-wise domain decompositions, focusing on waveguides with general cross sections and different types of transmission conditions such as impedance or perfectly matched layers (PMLs). By combining techniques from the limiting spectrum analysis of Toeplitz matrices and the modal decomposition of Maxwell’s solutions, we provide a novel theoretical framework that extends previous work to more complex geometries and transmission conditions. Numerical experiments confirm that the limiting spectrum effectively predicts practical behavior even with a modest number of subdomains. Furthermore, we demonstrate that the one-level Schwarz method can achieve robustness with respect to the wave number under specific domain decomposition parameters, offering new insights into its applicability for large-scale electromagnetic wave problems.
\end{abstract}

% REQUIRED
\begin{keywords}
Maxwell’s equations, Schwarz methods, Domain decomposition, Weak scalability, Waveguide problems, Limiting spectrum, Block Toeplitz matrices, modal decomposition.
\end{keywords}

% REQUIRED
\begin{MSCcodes}
to be added
\end{MSCcodes}

\section{Introduction}
Time-harmonic wave propagation problems, particularly those arising in electromagnetic applications governed by Maxwell’s equations, present significant computational challenges. At the continuous level, these problems involve non-self-adjoint operators when impedance boundary conditions are imposed. When discretized, the number of degrees of freedom must grow with the wave number to mitigate the pollution effect, meaning that the numerical wave speed deviates from the exact solution \cite{Babuska:1997:IPE}. This increase in discretization leads to large-scale, non-Hermitian linear systems that are difficult to solve using traditional iterative methods.

Over the past two decades, significant advances have been made in developing efficient solvers and preconditioners for these problems. Among these approaches, domain decomposition methods \cite{Dolean:15:DDM} offer an effective balance between direct and iterative strategies. Enhanced domain decomposition techniques, such as those using optimized transmission conditions, have proven successful for Helmholtz equations \cite{Gander:2007:OSM} and their extensions to Maxwell’s equations \cite{Dolean:2015:ETC, Dolean:09:OSM, ElBouajaji:12:OSM} and elastic wave problems \cite{Brunet:2019:NDD, Mattesi:2019:ABC}. For large-scale problems, robustness in terms of subdomain count and wave number has been achieved by introducing two-level methods that leverage absorptive counterparts of the equations as preconditioners, solved iteratively using domain decomposition techniques \cite{Bonazzoli:2019:ADD, Dolean:2020:IFD, Graham:2017:RRD}.

More recently, an intriguing concept has emerged: achieving weak scalability with one-level Schwarz methods under certain conditions on the problem’s physical and numerical parameters, such as absorption and subdomain size. This ensures that the convergence rate remains stable as the number of subdomains increases, enabling the solution of increasingly complex problems without requiring a coarse space \cite{Gong:2020:DDP, Graham:2020:DDI}. Unlike traditional scalability that pertains to a fixed problem, weak scalability applies to a family of problems, where increasing the number of subdomains facilitates the solution of more challenging instances while maintaining consistent convergence rates. This concept has been explored in computational chemistry \cite{Cances:2013:DDI} and analyzed rigorously using Fourier techniques \cite{Ciaramella:2017:APS}. Extensions of this work to broader geometries and one-level methods have been achieved through variational and propagation-tracking analyses \cite{Ciaramella:2020:OSS}. Such analyses have been generalized only later to complex valued problems, decompositions into multiple subdomains and optimisation of transmission conditions in \cite{Dolean:2023:CFO, Dolean:2020:IFD}.

Notably in \cite{Bootland:2022:APS} authors investigates the convergence properties of one-level parallel Schwarz methods with Robin transmission conditions for time-harmonic wave problems, focusing on 1D and 2D Helmholtz and 2D Maxwell equations. By utilizing the block Toeplitz structure of the Schwarz iteration matrix, the authors provide a novel analysis of the limiting spectrum, showing that weak scalability can be achieved without a coarse space under specific conditions, particularly in strip-wise decompositions commonly found in waveguide problems. Building on these ideas, in this work, we examine the weak scalability of one-level methods for Maxwell’s equations in the context of strip-wise domain decompositions, as these naturally arise in waveguide problems of general cross section and with more general transmission conditions. While previous studies focused on wave number robustness \cite{Gong:2020:DDP, Graham:2020:DDI}, our emphasis is on scalability over a growing chain of subdomains with fixed size, independent of discretisation. This approach provides new insights into the efficiency and applicability of domain decomposition methods for large-scale electromagnetic wave problems. The main difficulty for Maxwell's equations resides in the vector nature of the problem and the analysis will be facilitated by the modal decomposition into Transverse Electric (TE) and Transverse Magnetic (TM) modes like in \cite{Dolean:2015:ETC}.

The main contributions of this paper are:
\begin{itemize}
\item We analyze the limiting spectrum of a one-level Schwarz method applied to strip-wise domain decompositions for Maxwell's equations in a waveguide of a general cross section. 
\item Our analysis, conducted at the continuous level, is valid for a more general class of transmission conditions like impedance or perfectly matched layers (PMLs) and this analysis relies on a combination of limiting spectrum of Toeplitz matrices, introduced in \cite{Bootland:2022:APS} and the modal decompositions of the Maxwell's solutions like in \cite{Dolean:2015:ETC}.
\item Numerical experiments demonstrate that again limiting spectrum is highly predictive of practical behavior, even for relatively few subdomains.
\item We will also show that, under specific domain decomposition parameters, in addition to scalability, the one-level Schwarz method can also achieve robustness with respect of the wavenumber. 
\end{itemize}
The structure of the paper is as follows: in \Cref{sec:Modal} we recall elements of modal analysis for Maxwell's equations in a waveguide of general cross sections. In \Cref{sec:DD} we present and analyse the domain decomposition method with different types of transmission conditions relying on the modal decomposition and limiting spectrum. Finally in \Cref{sec:numeric} we present two types of numerical results: first, showing that the limiting spectrum is descriptive for the convergence of the algorithm even in the case of a moderate number of domains and then on the discretised problem using the edge element method.
\section{Modal decomposition in a waveguide}
\label{sec:Modal}
Let us consider the classical Maxwell's equation in time-harmonic regime in the first and second order form (with convention $e^{-\imath \omega t}$ where $\omega$ is the pulsation):
\begin{equation}\label{Maxwell-eq}
\left\{ \begin{array}{lll}	
	\nabla \times \bfE = \imath \omega \mu \bfH & \text{in} & \Omega,\\
	\nabla \times \bfH = -\imath \omega \varepsilon \bfE & \text{in} & \Omega,\\
	\bfE \times \mathbf{n} = \mathbf{0}. & \text{on} & \partial \Omega.
\end{array} \right. \quad \Leftrightarrow \quad \left\{ \begin{array}{lll}	
	\nabla \times \nabla \times \bfE - k^2 \bfE = 0 & \text{in} & \Omega,\\
	\bfE \times \mathbf{n} = \mathbf{0}. & \text{on} & \partial \Omega,
\end{array} \right.
\end{equation}
where we denote by $k^2 = \varepsilon \mu \omega^2$ the wavenumber, by $\varepsilon = \varepsilon' - \imath \varepsilon''$ the (complex) electric permittivity and $\mu$ the magnetic permeability. The unknown vector functions are respectively the electric $\bfE$ and magnetic fields $\bfH$. All physical  parameters are assumed to be constant in what follows. Although we will work mainly on the second-order formulation, the first-order formulation will be useful later, this is why it is also introduced here.

The domain $\Omega$ is a straight infinite waveguide of geometry $\mathbb{R} \times S$ where $S$ denotes the section of the waveguide, see the example \Cref{fig1:schema}. On the boundaries, we consider Perfect Electric Conductor (PEC) conditions ($\mathbf{E}\times \mathbf{n}=0$) and $\mathbf{n}$ denotes the outward normal.  The purpose of this section is illustrate the computation of solutions of Maxwell's equations in this type of geometry which relies on the modal decomposition of the electric field. We will follow the presentation given in \cite{Bonnet:2021:PGO}. 

We call {\it modes} particular solutions of the Maxwell equations of the form $$\bfE = e^{\imath \beta x} \widehat{\bf{E}}(y,z) \quad \text{and} \quad \bfH = e^{\imath \beta x} \widehat{\bf{H}}(y,z),$$
where $\beta$ is a complex number whose meaning will be explained later and $\widehat{\bf{E}}$, $\widehat{\bf{H}}$ are vector valued fields defined in the cross section.
\begin{figure}[h]
	\centering
	\includegraphics[height=4cm]{Img/WaveguideNew.png}
	\caption{Scheme of the geometry $\Omega$. In blue, cross-sections of the waveguide.}\label{fig1:schema}
\end{figure}
In what follows we will give an overview of different case scenarios that could appear when the modes are solutions to the Maxwell's equations. 

From the second equation of the Maxwell system \eqref{Maxwell-eq} written in the first order form, we can easily see that the electric field $\bfE$ is divergence free so that $\nabla \cdot \bfE = 0$. As a consequence, using the fact that $\nabla \times \nabla \times = \nabla \left( \nabla \cdot \right) - \mathbf{\Delta}$, we get that each component of $\bfE$ satisfies a scalar Helmholtz equation:
	\begin{equation}
		- \Delta E_i - k^2 E_i = 0 \quad \text{in} \quad \Omega, \quad \forall i \in \{x, y, z\}.
	\end{equation}
Now, for the boundary conditions we have:
    \begin{align}
		\bfE \times \mathbf{n} = \mathbf{0} \;\; & \Leftrightarrow \;\; \left[ \begin{matrix}
			E_x \\ E_y \\ E_z
		\end{matrix} \right] \times \left[ \begin{matrix} 0 \\ n_y \\ n_z \end{matrix} \right] \;\; \Leftrightarrow \;\; \left[ \begin{matrix}
			E_y n_z - E_z n_y \\ -E_x n_z \\ E_x n_y
		\end{matrix} \right] = \left[ \begin{matrix} 0 \\ 0 \\ 0 \end{matrix} \right] \\
        &\Leftrightarrow \;\; \begin{array}{|lll}
			E_y n_z - E_z n_y = 0 & \text{on} & \R \times \partial S,\\
			E_x = 0 & \text{on} & \R \times \partial S.  
		\end{array}
        \end{align}
In particular, we deduce that $\widehat{E}_x$ in $E_x = e^{\imath \beta x} \widehat{E}_x(y,z)$ satisfies 
\begin{equation}\label{pb:ex-modes}
	\begin{array}{|lll}
		- \Delta_{(y,z)} \widehat{E}_x - \left(k^2 - \beta^2 \right) \widehat{E}_x = 0 & \text{in} & S,\\
		\widehat{E}_x = 0 & \text{on} & \partial S.
	\end{array} 
\end{equation}
where $\Delta_{(y,z)}$ denotes the Laplace operator in the two-dimensional cross section. Following the same reasoning and using the second order formulation for $\bfH$, we can show that $\widehat{H}_x$ satisfies
\begin{equation}\label{pb:hx-modes}
	\begin{array}{|lll}
		- \Delta_{(y,z)} \widehat{H}_x - \left(k^2 - \beta^2 \right) \widehat{H}_x = 0 & \text{in} & S,\\
		\partial_{\mathbf{n}} \widehat{H}_x = 0 & \text{on} & \partial S.
	\end{array} 
\end{equation}
Note that knowing $\widehat{E}_x$ and $\widehat{H}_x$ one can reconstruct the full vector fields $\widehat{\bfE}$ and $\widehat{\bfH}$. Indeed, from the first order formulation of the Maxwell equations, we have:
\begin{equation}\label{eq:syst-recov}
	\begin{array}{|lll}
		\partial_y \widehat{E}_z - \partial_z \widehat{E}_y = \imath \omega \mu \widehat{H}_x,\\
		-\imath \beta \widehat{E}_z + \partial_z \widehat{E}_x = \imath \omega \mu \widehat{H}_y,\\
		\imath \beta \widehat{E}_y - \partial_y \widehat{E}_x = \imath \omega \mu \widehat{H}_z, 
	\end{array} \quad \text{and} \quad \begin{array}{|lll}
		\partial_y \widehat{H}_z - \partial_z \widehat{H}_y = -(\imath \omega \varepsilon - \sigma) \widehat{E}_x,\\
		-\imath \beta \widehat{H}_z + \partial_z \widehat{H}_x = -(\imath \omega \varepsilon - \sigma) \widehat{E}_y,\\
		\imath \beta \widehat{H}_y - \partial_y \widehat{H}_x = -(\imath \omega \varepsilon - \sigma) \widehat{E}_z, 
	\end{array}
\end{equation}
Taking now the last two equations of both systems, we get that
\begin{equation}\label{eq:syst-recov-2}
	\left[ \begin{matrix}
		-(\imath \omega \varepsilon - \sigma) & 0 & 0 & \imath \beta \\
		0 & -(\imath \omega \varepsilon - \sigma) & -\imath \beta & 0 \\ 
		0 & \imath \beta & \imath \omega \mu & 0 \\
		-\imath \beta & 0 & 0 & \imath \omega \mu \\
	\end{matrix} \right] \left[ \begin{matrix}
		\widehat{E}_y \\ \widehat{E}_z \\ \widehat{H}_y \\ \widehat{H}_z
	\end{matrix} \right] = \left[ \begin{matrix} \partial_z \widehat{H}_x \\ - \partial_y \widehat{H}_x \\  \partial_z \widehat{E}_x \\ - \partial_y \widehat{E}_x \end{matrix} \right].
\end{equation}
We can easily see that that the determinant of the matrix is not zero iff $k^2 - \beta^2 \neq 0$ and in this case the components $(\widehat{E}_{y},\widehat{E}_{z})$ and $(\widehat{H}_{y},\widehat{H}_{z})$ are uniquely defined. 

Depending on the values of $\widehat{E}_x$ and $\widehat{H}_x$ will distinguish now between three case scenarios allowing us to identify different types of modes corresponding to different types of particular solutions of Maxwell's equations in the waveguide.

\noindent \paragraph{Transverse Electric (TE) modes: $\widehat{E}_x = 0$ and $\widehat{H}_x \neq 0$}
In this case since $\widehat{H}_x$ is solution to \Cref{pb:hx-modes}, we deduce $\widehat{H}_x$ is a linear combination of the functions: 
		\[
			e^{\imath m \beta_i^{\rm TE} x} \varphi^\mathcal{N}_i(y,z) \quad \text{where}  \quad \beta^{\rm TE}_i = \sqrt{k^2 - (\lambda^\mathcal{N})^2_i}, \;\; i\in \mathbb{N}^+, \;\; m \in \{-,+\},
		\]
		and 
		\begin{equation}
        \label{eq:ev}
			\begin{array}{|lll}
				- \Delta_{(y,z)} \varphi^\mathcal{N} = \lambda^\mathcal{N} \varphi^\mathcal{N} & \text{in} & S,\\[5pt]
				\partial_{\mathbf{n}} \varphi^\mathcal{N} = 0 & \text{on} & \partial S. 
			\end{array}
		\end{equation}
        The coefficients of the decomposition that we will denote by $A_i^{{\rm TE},m}$ are called {\it modal amplitudes} and the sign $m$ indicates the direction of propagation of the mode, $m=+$ corresponding to right-going modes (propagating toward $+\infty$) and $m=-$ corresponding to left-going modes (propagating toward $-\infty$). 

        Classically, when $\beta^{\rm TE}_i$ is real we say that the mode is \emph{propagative} and when Im$\left(\beta^{\rm TE}_i\right) \neq 0$ we say that the mode is \emph{evanescent}.
        \begin{remark}
            We remind that the eigenvalue problem \eqref{eq:ev} has an infinite countable set of solutions with $(\lambda^\mathcal{N}_i)_{i \in \mathbb{N}}$ an increasing positive sequence that tends to $+\infty$ and the set of eigenfunctions $(\varphi^\mathcal{N}_i)_{i \in \mathbb{N}}$ is an orthonormal basis of $L^2(S)$. Let us emphasize that for the first mode corresponding to $i=0$ and $\varphi_0 = 1$, the associated modal amplitude $A^{{\rm TE},m}_i = 0$. Indeed, using the first equation of \eqref{eq:syst-recov} of the left system, we get that:
		\[
			\imath \omega \int_{S} \widehat{H}_x dS = \int_{S}   \partial_y \widehat{E}_z - \partial_z \widehat{E}_y dS = \int_{\partial S} \widehat{E}_z n_y - \widehat{E}_y n_z  = 0, 
		\] 
		according to the BC satisfied by $\bfE$. Then, we can deduce using the orthogonality of the eigenfunctions $\varphi^\mathcal{N}_j$ that necessarily $A^{TE,m}_0 = 0$ because 
        \[
            A^{{\rm TE},m}_0 = \int_{S} \widehat{H}_x \; \varphi^\mathcal{N}_0 dS = 0.  
        \]
        \end{remark}
        
\noindent \paragraph{Tranverse Magnetic modes (TM): $\widehat{E}_x \neq 0$ and $\widehat{H}_x  = 0$} 
Using a similar reasoning to the case of the TE modes, we find that $\widehat{E}_x$ is a linear combination of
		\[
			e^{\imath m \beta_i^{\rm TM} x} \varphi^\mathcal{D}_i(y,z) \quad \text{where}  \quad \beta^{\rm TM}_i = \sqrt{k^2 - (\lambda^\mathcal{D})^2_i}, \;\; i\in \mathbb{N}^+, \;\; m \in \{-,+\},
		\]
		and 
		\[
			\begin{array}{|lll}
				- \Delta_{y,z} \varphi^\mathcal{D} = \lambda^\mathcal{D} \varphi^\mathcal{D} & \text{in} & S,\\
				\varphi^\mathcal{D} = 0 & \text{on} & \partial S. 
			\end{array}
		\]
		Here again, the above eigenvalue problem has an infinite countable set of solutions with $(\lambda^D_i)_{i \in \N^+}$ an increasing positive sequence that tends to $+\infty$ and the eigenfunctions $(\varphi^\mathcal{D}_i)_{i \in \N^+}$ form an orthonormal basis of $L^2(S)$.

        Like in the case of TE-modes, we say that the mode is propagative if Im$\left(\beta^{\rm TM}_i\right)= 0$ and evanescent if not, and the direction of propagation is given by $m$. 
		
\noindent \paragraph {Transverse Electric Magnetic (TEM): $\widehat{E}_x = \widehat{H}_x = 0$} Since the right hand side of \Cref{eq:syst-recov-2} is zero, to get non-zero solutions, we necessarily need to have  $(\beta^{\rm TEM})^2 = k^2$. We can show that there exist $N_C-1$ TEM modes where $N_C$ is the number of connected components of $\partial S$, see \cite{Bonnet:2021:PGO} for details. In particular, in the case of a waveguide with "no holes", there is no TEM mode propagating in the guide.\\ 

	
To summarise, the solutions of the Maxwell equations in a waveguide can be written as linear combination of these three types of modes:
\begin{equation}\label{modal-dec}
	\begin{split}
	\bfE = & \sum_{i \geq 0} \sum_{m \in \{-,+\}} A^{{\rm TE},m}_i e^{\imath m \beta_i^{\rm TE} x}\; \widehat{\bfE}^{{\rm TE},m}_i + A^{{\rm TM},m}_i e^{\imath m \beta_i^{\rm TM} x} \;\widehat{\bfE}^{{\rm TM},m}_i\\
		 & + \sum_{i = 1}^{N_C-1} \sum_{m \in \{-,+\}} A^{{\rm TEM},m}_i e^{\imath m k x} \widehat{\bfE}^{{\rm TEM},m}_i,  
	\end{split}	 
\end{equation}	
where the vector fields $\widehat{\bfE}^{{\rm TE},m}_i$,  $\widehat{\bfE}^{{\rm TM},m}_i$ and $\widehat{\bfE}^{{\rm TEM},m}_i$ (depending on $y,z$ and defined in the section $S$) are called {\it mode profiles}, and $A^{{\rm TE},\pm}_i$, $A^{{\rm TM},\pm}_i$ and $A^{{\rm TEM},\pm}_i$ are the {\it modal amplitudes} associated to each type of mode. We remind that the mode profiles for TE and TM modes are determined using \Cref{eq:syst-recov-2} once we know $\widehat{E}_x$ and $\widehat{H}_x$ for each type of modes.
\begin{remark}
Let us note that the TEM-modes are necessarily propagative (unlike the TE and TM modes which can be either propagative or evanescent).
Also, in what follows, we will assume that we are not on a cut-off frequency $k$, that is to say a frequency s.t. there exists $i$ s.t. $\beta^{\rm TE}_i = 0$ or $\beta^{\rm TM}_i = 0$.
\end{remark}
The following property regarding the continuity of the tangential traces of mode profiles will be useful later and help to manipulate \Cref{modal-dec} in the underlying computations.
\begin{proposition}[Tangential traces of mode profiles]\label{prop:non-depend-pm}
	For $\mathbf{n} = (1,0,0)^t$, we can choose the mode profiles such that
	\[
		\widehat{\bfE}^{\rm TE, +}_i \times \mathbf{n} = \widehat{\bfE}^{\rm TE, -}_i \times \mathbf{n}, \quad \widehat{\bfE}^{\rm TM, +}_i \times \mathbf{n} = \widehat{\bfE}^{\rm TM, -}_i \times \mathbf{n} \quad \forall i \in \mathbb{N}^+, 
	\]
	and 
	\[
		\widehat{\bfE}^{\rm TEM, +}_i \times \mathbf{n} = \widehat{\bfE}^{\rm TEM, -}_i \times \mathbf{n}, \quad \forall i \in \{1, \cdots, N_C-1\}.
	\]
\end{proposition}
\begin{proof}
	To prove this result, let us first remark that for any field $\bfU$ we have:
	\begin{equation}\label{eq:cross-prod}
		\bfU \times \mathbf{n} = \left[ \begin{matrix}
			0 \\ U_z \\ - U_y
		\end{matrix} \right].
	\end{equation}
	For TE-modes, using \Cref{eq:syst-recov} and the fact that $E_x = \widehat{E}_x = 0$, we deduce that
	\[
		\widehat{E}_y = \dfrac{\imath \omega \mu \partial_z \varphi^\mathcal{N}_i}{\lambda^\mathcal{N}_i} \quad \text{and} \quad \widehat{E}_z = -\dfrac{\imath \omega \mu \partial_y \varphi^\mathcal{N}_i}{\lambda^\mathcal{N}_i}.
	\]
	Since the expression above is independent of the sign of $\beta$ we get the first result by choosing the TE-modes profile:
	\[
		\widehat{\bfE}^{\rm TE,\pm}_i = \left[ \begin{matrix}
			0 \\ \widehat{E}_y \\ \widehat{E}_z
		\end{matrix} \right].
	\]
	A similar result holds for the TEM-modes. %\left(\widehat{\bfE}^{\rm TE,\pm}_i\right)_y \left( \widehat{\bfE}^{\rm TE,\pm}_i\right)_z
	
	Regarding the TM-modes, we use again \Cref{eq:syst-recov} and the fact that $H_x = \widehat{H}_x = 0$, which leads to:
	\[
		\widehat{E}_y = \dfrac{\imath \beta^{\rm TM}_i \partial_y \varphi^\mathcal{D}_i}{\lambda^\mathcal{D}_i} \quad \text{and} \quad \widehat{E}_z = \dfrac{\imath \beta^{\rm TM}_i \partial_z \varphi^\mathcal{D}_i}{\lambda^\mathcal{D}_i}.
	\]
	This time, the expression does depend on the sign of $\beta$. Yet, since modes are solutions to the eigenvalues problem, the profiles $\widehat{\bfE}^{\rm TM,\pm}_i$ are defined up to a (non-zero) multiplicative constant. As a consequence, we can choose 
	\[
		\widehat{\bfE}^{\rm TM, +}_i = \left[ \begin{matrix}
			\widehat{E}^{\rm TM,+}_x \\ \widehat{E}_y \\ \widehat{E}_z
		\end{matrix} \right] \quad \text{and} \quad \widehat{\bfE}^{\rm TM, -}_i = \left[ \begin{matrix}
			\widehat{E}^{\rm TM,-}_x \\ \widehat{E}_y \\ \widehat{E}_z
		\end{matrix} \right],
	\]
	which proves our result using \Cref{eq:cross-prod}.
	%\left(\widehat{\bfE}^{\rm TM,\pm}_i\right)_y 
\end{proof}

\begin{remark}
	Since for TE-modes and TEM-modes $E_x = 0$, we could drop the exponent $\pm$ in the profile because $\widehat{\bfE}^{\rm TE, +}_i = \widehat{\bfE}^{\rm TE, -}_i$.
\end{remark}

\section{Domain decomposition algorithm}
\label{sec:DD}
The modal analysis in \Cref{sec:Modal} holds in the case of infinite waveguide. In what follows, for computational reasons we will truncate this waveguide to $\tilde \Omega = [a, b] \times S$ and add appropriate boundary conditions at the ending cross-sections $\{a\}\times S$ and $\{b\} \times S$. %that we will give hereafter.%compatible boundary conditions with this modal decomposition. 

To define the Schwarz algorithm, we will split this computational domain into several overlapping subdomains. Let us consider $(a_l)_l$ and $(b_l)_l$ s.t. $a_1 = a$, $b_N = b$:
 
	\begin{equation}
		b_{l-1} - a_{l} = \delta > 0, \quad \text{and} \quad b_l - a_l = L + 2\delta \quad \;\; \forall l \in \{1, \cdots, N\},
	\end{equation}
	with $N \in \N$ given and $L > 0$. We define by $\Omega_l$ the subdomain $\Omega_l := [a_l, b_l] \times S$ of the whole domain $\widetilde{\Omega} = \cup_{l =1}^N \Omega_l = [a_1, b_N] \times S$ see \Cref{fig1:schemaDD} (where we note that all subdomains are prisms with the same type of cross-section). We denote by $\delta > 0$ the size of the overlapping area between two consecutive subdomains $\Omega_l$ and $\Omega_{l \pm 1}$. 
	\begin{figure}[h]
		\centering
		\includegraphics[height=4cm]{Img/WaveGuide_DDnew.png}
		\caption{A bounded waveguide $\widetilde{\Omega}$ and its decomposition into subdomains.}\label{fig1:schemaDD}
	\end{figure}
 \begin{definition}[The Schwarz algorithm]   
	Let $\mathcal{L}$ be the linear second order Maxwell's operator 
\begin{equation}
	\mathcal{L} (\mathbf{E}):= \nabla \times \nabla \times \mathbf{E} -  k^2 \mathbf{E},
\end{equation}
and $\mathcal{B}$ the boundary operator:
\begin{equation}
\label{eq:IC}
	\mathcal{B}(\mathbf{E}):= \left( \left( \nabla \times \mathbf{E} \right) \times \mathbf{n} \right) \times \mathbf{n} + \mathcal{T}(\mathbf{E} \times \mathbf{n}).
\end{equation}
where $\mathcal{T}$ is a linear transmission operator which will be defined later. Starting from an initial guess, the classical Schwarz algorithm computes at iteration $n \in \N$ the solution in the subdomain $\Omega_l$ as follows  
\begin{equation}\label{pb:Schwarz-ite}
	\begin{array}{|lcl}
		\mathcal{L} (\mathbf{E}^{n,l}) = \mathbf{f}_l& \text{in} & \Omega_j,\\
		\mathcal{B}(\mathbf{E}^{n,l}) =  \mathcal{B}(\bfE^{n-1,l - 1}) & \text{on} & \Gamma_{l,l-1} := \{ x= a_l \} \times S,\\
		\mathcal{B}(\mathbf{E}^{n,l}) =  \mathcal{B}(\bfE^{n-1,l + 1}) & \text{on} & \Gamma_{l,l+1} := \{ x= b_l \} \times S,\\
		\mathbf{E}^{n,l} \times \mathbf{n} = 0 & \text{on} & \partial \Omega_l \setminus \left( \Gamma_{l,l-1} \cup \Gamma_{l,l+1} \right).
	\end{array}	
\end{equation}
For simplicity, we will consider that boundary conditions at the extremities of the waveguide are: $\mathcal{B}(\mathbf{E}^{n-1,1}) = \mathbf{g}_1$ and $\mathcal{B}(\mathbf{E}^{n-1,N}) = \mathbf{g}_N$.
\end{definition}
\begin{remark}
Typically, if the transmission operator in \Cref{eq:IC} is $\mathcal{T} = -\imath k$, then ${\cal B}$ corresponds to zero order absorbing boundary conditions that we can classically use when truncating an unbounded waveguide. This condition (roughly) takes into account what happens in the exterior domain and ensures the solution in the truncated domain is a good approximation to the restriction of the solution in the unbounded one, by "absorbing" outgoing waves and avoiding reflections, see for instance \cite{haddar:2008:GIBC,hall:2004:SABCMaxwell} for more details. Note also that for diffraction problems, these boundary conditions on $\Gamma_{1,0}$ and $\Gamma_{N,N+1}$ are usually inhomogeneous i.e. $\mathbf{g}_{1,N} \ne 0$  (if we work with the total field, i.e. the sum of the incident field and the diffracted field).
\end{remark}
In the analysis of the algorithm below we will consider the homogeneous case (where $\mathbf{f}_l = \mathbf{g}_{1,N} = 0$) because we will be interested the evolution of the error throughout the iterations. The convergence factor of algorithm \eqref{pb:Schwarz-ite} will be computed using a Fourier analysis and different types of transmissions conditions will be considered. This analysis relies on several ingredients including the modal decomposition of the waveguide solution which will {allow analytical} computations of the action of the transmission operators from \Cref{eq:IC}. In particular we will see that these operators are diagonalized by the different modes (see also the analysis in \cite{Dolean:2015:ETC}). %based on the decomposition \eqref{eq:decomp-TE-TM}:
\begin{proposition}[Diagonalization of $\bfE \rightarrow ((\nabla \times \bfE) \times \mathbf{n}) \times \mathbf{n}$]\label{prop:BC-TE-TM}
	Let $\mathbf{n} = (1,0,0)^t$ the outward normal to the waveguide cross-section. Then the operator $\bfE \rightarrow ((\nabla \times \bfE) \times \mathbf{n}) \times \mathbf{n}$ is diagonalized by the TE, TM and TEM modes i.e. the following identities hold:\\  
For TE-modes, we have $\forall i \in \N^+$:
	\begin{equation}
		((\nabla \times \mathbf{E}^{\rm TE,\pm}_{i})  \times \mathbf{n})\times \mathbf{n}= \pm \imath \beta^{\rm TE}_{i} \mathbf{E}^{\rm TE,\pm}_{i} \times \mathbf{n} \text{ where } \mathbf{E}^{\rm TE,\pm}_{i} := \widehat{\mathbf{E}}^{\rm TE, \pm}_{i} e^{\pm \imath \beta^{\rm TE}_{i}x }.
	\end{equation}
For the TM-modes, we have $\forall i \in \N^+$:
	\begin{equation}
			((\nabla \times \mathbf{E}^{\rm TM,\pm}_{i}) \times \mathbf{n})\times \mathbf{n} = \pm \imath \dfrac{k^2}{\beta^{\rm TM}_{i}} \mathbf{E}^{\rm TM,\pm}_{i}\times \mathbf{n} \text{ where } \mathbf{E}^{\rm TM,\pm}_{i} := \widehat{\mathbf{E}}^{\rm TM,\pm}_{i} e^{\pm \imath \beta^{\rm TM}_{i}x }.
	\end{equation}
For the TEM-modes, we have $\forall i \in \{1, \cdots N_C - 1\}$:
	\begin{equation}
		((\nabla \times \mathbf{E}^{\rm TEM,\pm}_{i})  \times \mathbf{n})\times \mathbf{n}= \pm \imath k \mathbf{E}^{\rm TEM,\pm}_{i} \times \mathbf{n}  \text{ where } \mathbf{E}^{\rm TEM,\pm}_{i} := \widehat{\mathbf{E}}^{\rm TEM, \pm}_{i} e^{\pm \imath k x }.
	\end{equation}

\end{proposition}

\begin{proof}
	For simplicity we will drop the index $i$ in the proof. First, we see by simple computations that:
	\[
		(\nabla \times \mathbf{E}) \times \mathbf{n} = \left[ \begin{matrix} 0 \\ \partial_x E_y - \partial_y E_x \\ \partial_x E_z - \partial_z E_x \end{matrix} \right], %\quad \text{and} \quad \mathbf{T} \times \mathbf{n} = \left[ \begin{matrix} 0 \\ T_z \\ -T_y \end{matrix} \right],
	\]
	for any field $\mathbf{E}$. Now, for $\mathbf{E} = \mathbf{E}^{\rm TE, \pm}$ since $E^{\rm TE,\pm}_x = 0$ and $\mathbf{E}^{\rm TE,\pm} := \widehat{\mathbf{E}}^{\rm TE, \pm} e^{\pm \imath \beta^{\rm TE} x }$ we deduce that:
	\begin{equation*}
	\begin{split}
		& (\nabla \times \mathbf{E}^{\rm TE,\pm}) \times \mathbf{n} = \pm \imath \beta^{\rm TE} e^{\pm \imath \beta^{\rm TE} x } \widehat{\mathbf{E}}^{\rm TE, \pm} = \pm \imath \beta^{\rm TE} \mathbf{E}^{\rm TE,\pm},\\
	\Rightarrow \quad & ((\nabla \times \mathbf{E}^{\rm TE,\pm}) \times \mathbf{n}) \times \mathbf{n} = \pm \imath \beta^{\rm TE} \mathbf{E}^{\rm TE,\pm} \times \mathbf{n},	
	\end{split}
	\end{equation*}
	which proves our first result. This proof also holds for TEM-modes.
	
	For TM-modes, we have $H_x = 0$ and $\bfH^{\rm TM, \pm} = \widehat{\mathbf{H}}^{\rm TM, \pm} e^{\pm \imath \beta^{\rm TM} x }$ so that as for TE-modes we get
	\[
		(\nabla \times \mathbf{H}^{\rm TM, \pm}) \times \mathbf{n} = \pm \imath \beta^{\rm TM} \mathbf{H}^{\rm TM, \pm}.
	\]
	Using now the first order form of Maxwell equations \eqref{Maxwell-eq}, we deduce that 
	\begin{equation}
	\begin{split}
		& -(\imath \omega \varepsilon - \sigma) \bfE^{\rm TM, \pm} \times \mathbf{n} = \pm \imath \beta^{\rm TM} \dfrac{1}{\imath \omega \mu}\nabla \times \mathbf{E}^{\rm TM, \pm}, \\
	\Leftrightarrow \quad & \mp \imath \dfrac{k^2}{\beta^{\rm TM}} \bfE^{\rm TM, \pm} \times \mathbf{n} = \nabla \times \mathbf{E}^{\rm TM, \pm},\\
	\Rightarrow \quad & \mp \imath \dfrac{k^2}{\beta^{\rm TM}} ((\bfE^{\rm TM, \pm} \times \mathbf{n} ) \times \mathbf{n})\times \mathbf{n} = ((\nabla \times \mathbf{E}^{\rm TM, \pm}) \times \mathbf{n})\times \mathbf{n}.	
	\end{split}
	\end{equation}
	To conclude, we simply need to recall that $((\bfE^{\rm TM, \pm} \times \mathbf{n} ) \times \mathbf{n})\times \mathbf{n} = -\bfE^{\rm TM, \pm} \times \mathbf{n}$.
\end{proof}
%\begin{remark} % Je ne mettrai pas cette partie en remarque, elle me semble trop importante. À discuter au besoin !
We will see that this diagonalisation property is crucial in simplifying the computations further.

Regarding $\mathcal{T}$, the other operator appearing in the transmission conditions from \Cref{pb:Schwarz-ite}, we will assume that it is also diagonalized by the modes, that is:
\begin{equation}\label{eq:op-T-diag}
	\mathcal{T}( \bfE^{\rm T,\pm}_i \times \mathbf{n}) = \lambda^{\rm T,\pm}_i \bfE^{\rm T,\pm}_i \times \mathbf{n}, \quad \forall i \in \N^+, \;\; \forall \text{T} \in \{\text{TE}, \text{TM}, \text{TEM}\}.
\end{equation}
As we will see in \Cref{subsec:TC} this assumption is satisfied for the main classes of transmission conditions we will consider. This will allow us not only to analyze the convergence properties of the iterative algorithm mode by mode but also to show that the convergence analysis will be similar to the one for the Helmholtz equation. {In fact, proceeding mode by mode simplifies the analysis by reducing it to one-dimensional problems.}

\subsection{Transmission conditions}
\label{subsec:TC}
In this section we will see that in the case of the most commonly used transmission conditions, the operators $\mathcal{T}$ satisfy indeed the diagonalization property \Cref{eq:op-T-diag}. 
\noindent \paragraph{Impedance conditions or first order ABC (Absorbing Boundary Conditions)}
Let us consider first
\begin{equation}\label{def:op-T-ik}
	\mathcal{T} : \bfE \times \mathbf{n} \longrightarrow -\imath k \; (\bfE \times \mathbf{n}),
\end{equation}
which is in fact the identity operator multiplied by $-\imath k$. This operator leads to a first order absorbing boundary condition or an impedance condition defined by ${\cal B}$ and obviously satisfies \Cref{eq:op-T-diag} with $\lambda^{\rm T,\pm}_i = -\imath k$ for all $i \in \N^+$ and ${\rm T} \in \{{\rm TE, TM}\}$, and for all $i \in \{1, \cdots, N_C-1\}$ and ${\rm T} = {\rm TEM}$.
\paragraph{PML (Perfectly Matched Layers)}
The second case we wish to consider is the PML transmission conditions. PML are layers that aim at absorbing outgoing waves and are widely used to model unbounded domain \cite{bramble2007analysis}. They ``transform'' propagative waves into exponentially decaying waves in the PML, without generating any reflexion (at the continuous level), so that we can truncate the PML at finite distance inducing a small error. In the context of domain decomposition, PML can be used for the transmission conditions \cite{Bootland:2022:NAP,royer2022non}. Their action is generally more efficient than simple absorbing boundary conditions as we will see later.  

To construct the corresponding operator $\mathcal{T}$, we consider that each subdomain $\Omega_j$ is extended by a PML of length $\ell$ ended by a homogeneous Dirichlet condition, i.e. $\bfE \times \mathbf{n} = 0$ at $x = b_j + \ell$ and $x= a_j - \ell$. We consider a complex stretching in the direction $x$ which amounts to replace $x$ by $\widetilde{x}$ defined by
\begin{equation}
	\widetilde{x}(x) = \begin{array}{|lcl}
		x & \text{if} & x \in [a_j, b_j],\\
		x + \imath \sigma (x-b_j) & \text{if} & x \in [b_j, b_j + \ell],\\
		x - \imath \sigma (x-a_j) & \text{if} & x \in [a_j-\ell, a_j],
	\end{array}
\end{equation} 
where for simplicity we consider $\sigma$ a strictly positive constant \footnote{In what follows, we could also have taken $\sigma$ a positive increasing function, the analysis still hold.}. Thus, the solution in the PML $x \geq b_j$ for instance is given by %(where the first sum is taken over all $\rm T \in \{TE, TM, TEM \}$)
\begin{equation}\label{eq:dec-E-PML}
\begin{split}
	\bfE = & \;\;\;\; \sum_{i \in \N^+} A^{{\rm TE}, +}_i \left( e^{\imath \beta_i^{\rm TE} (1 + \imath \sigma )(x-b_j) } - e^{2 \imath \beta^{\rm TE}_i (1 + \imath \sigma)\ell} e^{-\imath \beta_i^{\rm TE} (1 + \imath \sigma )(x-b_j) } \right) \widehat{\bfE}^{{\rm TE},+}_i\\
        & + \sum_{i \in \N^+} A^{{\rm TM}, +}_i \left( e^{\imath \beta_i^{\rm TM} (1 + \imath \sigma )(x-b_j) } - e^{2 \imath \beta^{\rm TM}_i (1 + \imath \sigma)\ell} e^{-\imath \beta_i^{\rm TM} (1 + \imath \sigma )(x-b_j) } \right) \widehat{\bfE}^{{\rm TM},+}_i\\
        & + \sum_{i =1}^{N_C-1} A^{{\rm TEM}, +}_i \left( e^{\imath \beta_i^{\rm TEM} (1 + \imath \sigma )(x-b_j) } - e^{2 \imath \beta^{\rm TEM}_i (1 + \imath \sigma)\ell} e^{-\imath \beta_i^{\rm TEM} (1 + \imath \sigma )(x-b_j) } \right) \widehat{\bfE}^{{\rm TEM},+}_i.
\end{split}    
\end{equation}
Now, using \Cref{prop:BC-TE-TM} and \Cref{prop:non-depend-pm}, we can deduce at $x = b_j$ that:
\begin{equation}\label{def:op-PML}
\begin{split}
	((\nabla \times \bfE) \times \mathbf{n}) \times \mathbf{n} = & \sum_{i \in \N^+} A^{\rm TE,+}_i \imath \beta^{\rm TE}_i \left( 1 + e^{2 \imath \beta^{\rm TE}_i (1+ \imath \sigma)\ell} \right) \widehat{\bfE}^{\rm TE,+}_i \times \mathbf{n} \\
				& + \sum_{i \in \N^+} A^{\rm TM,+}_i \imath \dfrac{k^2}{\beta^{\rm TM}_i} \left( 1 + e^{2 \imath \beta^{\rm TM}_i (1+ \imath \sigma)\ell} \right) \widehat{\bfE}^{\rm TM,+}_i \times \mathbf{n} \\
				& + \sum_{i = 1}^{N_C-1} A^{\rm TEM,+}_i \imath k \left( 1 + e^{2 \imath k (1+ \imath \sigma)\ell} \right) \widehat{\bfE}^{\rm TEM,+}_i \times \mathbf{n}. 
\end{split}
\end{equation}
The operator $\mathcal{T}$ corresponding to the PML can therefore be defined by its action on each mode. More precisely, this operator maps the trace $\bfE \times \mathbf{n}$ to $((\nabla \times \bfE) \times \mathbf{n}) \times \mathbf{n}$ on $x= b_j$ for each modes. To compute its action, we need to replace the modal amplitudes in \Cref{def:op-PML} by their expression as a function of $\bfE \times \mathbf{n}$. This is done evaluating \Cref{eq:dec-E-PML} at $x=b_j$ for each mode:
\begin{equation}
\label{eq:lambdaPML}
	 \begin{array}{lll}
		\widehat{\bfE}^{\rm TE,\pm}_i \times \mathbf{n} & \xrightarrow{\mathcal{T}} & - \imath \beta^{\rm TE}_i  \dfrac{1 + e^{2 \imath \beta^{\rm TE}_i (1 + \imath \sigma)\ell}}{1 - e^{2 \imath \beta^{\rm TE}_i (1 + \imath \sigma)\ell}} \widehat{\bfE}^{\rm TE,\pm}_i \times \mathbf{n} =: \lambda^{\rm TE, \pm}_i (\widehat{\bfE}^{\rm TE,\pm}_i \times \mathbf{n}),\\[10pt]
		\widehat{\bfE}^{\rm TM,\pm }_i \times \mathbf{n} & \xrightarrow{\mathcal{T}} & -\imath \dfrac{k^2}{\beta^{\rm TM}_i}  \dfrac{1 + e^{2 \imath \beta^{\rm TM}_i (1 + \imath \sigma)\ell}}{1 - e^{2 \imath \beta^{\rm TM}_i (1 + \imath \sigma)\ell}} \widehat{\bfE}^{\rm TM,\pm }_i \times \mathbf{n}=: \lambda^{\rm TM, \pm}_i (\widehat{\bfE}^{\rm TM,\pm}_i \times \mathbf{n}), \\[10pt]
		\widehat{\bfE}^{\rm TEM,\pm }_i \times \mathbf{n} & \xrightarrow{\mathcal{T}} & -\imath k  \dfrac{1 + e^{2 \imath \beta^{\rm TEM}_i (1 + \imath \sigma)\ell}}{1 - e^{2 \imath \beta^{\rm TEM}_i (1 + \imath \sigma)\ell}} \widehat{\bfE}^{\rm TEM,\pm }_i \times \mathbf{n}=: \lambda^{\rm TEM, \pm}_i (\widehat{\bfE}^{\rm TEM,\pm}_i \times \mathbf{n}). \\
	\end{array}
\end{equation}
% In \Cref{eq:op-T-diag}, this translates into:
% \begin{align}\label{eq:lambdaPML}
% 	\lambda^{\rm TE, \pm}_i &= - \imath \beta^{\rm TE}_i  \dfrac{1 + e^{2 \imath \beta^{\rm TE}_i (1 + \imath \sigma)\ell}}{1 - e^{2 \imath \beta^{\rm TE}_i (1 + \imath \sigma)\ell}}, \\
%     \lambda^{\rm TM, \pm}_i &= -\imath \dfrac{k^2}{\beta^{\rm TM}_i}  \dfrac{1 + e^{2 \imath \beta^{\rm TM}_i (1 + \imath \sigma)\ell}}{1 - e^{2 \imath \beta^{\rm TM}_i (1 + \imath \sigma)\ell}} \\
%     \lambda^{\rm TEM, \pm}_i &= -\imath k  \dfrac{1 + e^{2 \imath \beta^{\rm TEM}_i (1 + \imath \sigma)\ell}}{1 - e^{2 \imath \beta^{\rm TEM}_i (1 + \imath \sigma)\ell}}.
% \end{align}
Let us note that $\lambda$ is independent of the direction of the mode $\pm$, which is logical since we choose the mode profile such that $\bfE^{\rm T, +} \times \mathbf{n} = \bfE^{\rm T, -} \times \mathbf{n}$. In what follows, we will drop the upper index $\pm$ for $\lambda$. 

\begin{remark}
	We should note that for $\sigma > 0$ and $\ell \rightarrow +\infty$ then $e^{2 \imath \beta^{\rm T}_i (1 + \imath \sigma)\ell} \rightarrow 0$ (for T $\in \{$TE,TM,TEM$\}$ and for all $i$) and therefore the operator $\mathcal{T}$ tends to the ``Dirichlet To Neumann'' operator which gives the transparent boundary condition for the semi-infinite waveguide. \footnote {Transparent boundary conditions mimic the effect of the unbounded domain, that is to say the solution in the bounded domain $\Omega_j$ is equal to the solution one would get considering on infinite waveguide $\mathbb{R} \times S$.}
\end{remark}
To conclude this section, we have seen that the operator ${\mathcal T}$ involved the most used boundary and interface transmission conditions i.e. absorbing boundary conditions (or impedance) and PML has the property stated in \Cref{eq:op-T-diag}.
\subsection{Analysis of the Schwarz algorithm}
We have now all the elements required to analyze the convergence properties of the Schwarz algorithm from \Cref{pb:Schwarz-ite}. Since we have seen that it is a reasonable assumption that $\mathcal{T}$ is diagonalized by the modes, we can perform this analysis mode by mode and estimate how each mode evolves throughout the Schwarz iterations. 
%First, for TE-modes we have the following result: 
\begin{proposition}[Evolution of TE modes]\label{prop:TE-ite}
	Suppose that for all subdomains $l \in \{1, \cdots, N\}$ the solution is a combination of TE modes of the form
	\begin{equation*}
	\begin{split}
		\bfE^{n-1,l} \;\; & =  \;\; \bfE^{{\rm TE}, n-1,l}_{i} \;\; := \;\; e^{\imath \beta^{\rm TE}_{i} x} A^{{\rm TE},+,n-1,l}_{i} \widehat{\bfE}_{i}^{{\rm TE},+} +  e^{-\imath \beta^{\rm TE}_{i} x} A^{{\rm TE},-,n-1,l}_{i} \widehat{\textbf{E}}_{i}^{\rm TE,-} 
	\end{split}
	\end{equation*}	
	for fixed $i \in \N^+$, then at the next iteration the solution will also be a TE mode $\mathbf{E}^{n,l} = \mathbf{E}^{{\rm TE},n,l}_{i}$ with the following relation between the different mode amplitudes $A^{{\rm TE},\pm ,n}_{i}$ and $A^{{\rm TE},\pm ,n-1}_{i}$ of neighboring domains:
	\begin{equation}
	    \label{eq:iterTE}
		M^{l,l}_{\rm TE} \textbf{A}^{{\rm TE},n,l} = M^{l,l-1}_{\rm TE} \textbf{A}^{{\rm TE},n-1,l-1} + M^{l,l+1}_{\rm TE} \textbf{A}^{{\rm TE},n-1,l+1}
		\end{equation}
	with $\textbf{A}^{{\rm TE},n,l} = [ A^{{\rm TE},-,n,l}_i, A^{{\rm TE},+,n,l}_i  ]^t$,  $\textbf{A}^{{\rm TE},n-1,l \pm 1} = [ A^{{\rm TE},-,n-1,l \pm 1}_i, A^{{\rm TE},+,n-1,l \pm 1}_i ]^t$,
	\[
		M^{l,l-1}_{\rm TE}(i) := \left[ \begin{matrix}
			( \imath \beta_{i}^{\rm TE} +  \lambda^{\rm TE}_i) e^{-\imath \beta^{\rm TE}_{i} a_l} & (-\imath \beta_{i}^{\rm TE} +  \lambda^{\rm TE}_i) e^{\imath \beta^{\rm TE}_{i} a_l} \\ 0 & 0
		\end{matrix} \right],
	\]
	\[
		M^{l,l+1}_{\rm TE}(i) := \left[ \begin{matrix} 
						0 & 0 \\ (-\imath \beta_{i}^{\rm TE} +  \lambda^{\rm TE}) e^{-\imath \beta_{i}^{\rm TE} b_l} & ( \imath \beta_{i}^{\rm TE} +  \lambda^{\rm TE}_i) e^{\imath \beta^{\rm TE}_{i} b_l}
					\end{matrix} \right],
	\]
	and $M^{l,l}_{\rm TE}(i) = M^{l,l-1}_{\rm TE}(i) + M^{l,l+1}_{\rm TE}(i)$:
	\[
		M^{l,l}_{\rm TE}(i) := \left[ \begin{matrix}
				(\imath \beta_{i}^{\rm TE} +  \lambda^{\rm TE}_i) e^{-\imath \beta^{\rm TE}_{i} a_l} & (-\imath \beta_{i}^{\rm TE} +  \lambda^{\rm TE}_i) e^{\imath \beta^{\rm TE}_{i} a_l} \\ (-\imath \beta_{i}^{\rm TE} +  \lambda^{\rm TE}_i) e^{-\imath \beta_{i}^{\rm TE} b_l} & ( \imath \beta_{i}^{\rm TE} +  \lambda^{\rm TE}_i) e^{\imath \beta^{\rm TE}_{i} b_l}
			\end{matrix} \right].
	\]
\end{proposition}
\begin{proof}
	For the sake of simplicity we will drop again the index $i$. We have supposed that in $\Omega_l$ the solution is composed only of TE modes of the form:
	\[
		\mathbf{E}^{n,l} = e^{\imath \beta^{\rm TE} x} A^{{\rm TE},+,n,l} \widehat{\textbf{E}}^{\rm TE, +} +  e^{-\imath \beta^{\rm TE} x} A^{{\rm TE},-,n,l} \widehat{\textbf{E}}^{\rm TE,-} 
	\]
	Clearly, it satisfies $\mathcal{L}(\mathbf{E}^{n,l}) = \mathbf{0}$. Since each subproblem in $\Omega_l$ is well-posed, if we can find $A^{{\rm TE},+,n,l}$ and $A^{{\rm TE},-,n,l}$ such that the BC are verified, then we would prove our result. 
    
    On $\Gamma_{l,l-1} = \{ x = a_l\} \times S$, $\mathbf{n} = (-1,0,0)^t$ and using \Cref{prop:BC-TE-TM} we get:
	\begin{equation*}
	\begin{split}
		& \left( -\imath \beta^{\rm TE} + \lambda^{\rm TE} \right) e^{\imath \beta a_l} A^{{\rm TE},+,n,l} (\widehat{\textbf{E}}^{\rm TE,+} \times \mathbf{n})\\
        & +   \left( \imath \beta^{\rm TE} + \lambda^{\rm TE} \right) e^{-\imath \beta a_l} A^{{\rm TE},-,n,l} (\widehat{\textbf{E}}^{\rm TE,-} \times \mathbf{n})\\[5pt]
		 = & \left( -\imath \beta^{\rm TE} + \lambda^{\rm TE} \right) e^{\imath \beta a_l} A^{{\rm TE},+,n-1,l-1} (\widehat{\textbf{E}}^{\rm TE,+} \times \mathbf{n})\\
         &  +   \left( \imath \beta^{\rm TE} + \lambda^{\rm TE} \right) e^{-\imath \beta a_l} A^{{\rm TE},-,n-1,l-1} (\widehat{\textbf{E}}^{\rm TE,-} \times \mathbf{n})
	\end{split}
	\end{equation*}
	Since $\widehat{\textbf{E}}^{\rm TE,-} \times \mathbf{n} = \widehat{\textbf{E}}^{\rm TE,+} \times \mathbf{n}$ (see \Cref{prop:non-depend-pm}), we deduce that:
	\begin{equation}
	\begin{split}
		& \left( -\imath \beta^{\rm TE} + \lambda^{\rm TE} \right) e^{\imath \beta a_l} A^{{\rm TE},+,n,l} +   \left( \imath \beta^{\rm TE} + \lambda^{\rm TE} \right) e^{-\imath \beta a_l} A^{{\rm TE},-,n,l}\\
		= & \left( -\imath \beta^{\rm TE} + \lambda^{\rm TE} \right) e^{\imath \beta a_l} A^{{\rm TE},+,n-1,l-1} +   \left( \imath \beta^{\rm TE} + \lambda^{\rm TE} \right) e^{-\imath \beta a_l} A^{{\rm TE},-,n-1,l-1}
	\end{split}
	\end{equation}
	Similarly, we have on $\Gamma_{l,l+1}$ the normal $\mathbf{n} = (1,0,0)^t$ and using again \Cref{prop:BC-TE-TM} and \Cref{prop:non-depend-pm}, we can conclude that:
	\begin{equation*}
	\begin{split}
		& \left( \imath \beta^{\rm TE} + \lambda^{\rm TE}  \right) e^{\imath \beta^{\rm TE} b_l} A^{{\rm TE},+,n,l} +  \left(-\imath \beta^{\rm TE} + \lambda^{\rm TE} \right) e^{-\imath \beta b_l}  A^{{\rm TE},-,n,l}\\[5pt]
		 = & \left( \imath \beta^{\rm TE} + \lambda^{\rm TE}  \right) e^{\imath \beta b_l}  A^{{\rm TE},+,n-1,l+1} +  \left(-\imath \beta^{\rm TE} + \lambda^{\rm TE} \right) e^{-\imath \beta b_l}  A^{{\rm TE},-,n-1,l+1}
	\end{split}	
	\end{equation*}
	Combining these two relations, we get the expected result:
	\[
		M^{l,l}_{\rm TE} \textbf{A}^{{\rm TE},n,l} = M^{l,l-1}_{\rm TE} \textbf{A}^{{\rm TE},n-1,l-1} + M^{l,l+1}_{\rm TE} \textbf{A}^{{\rm TE},n-1,l+1}.
	\]
\end{proof}


\begin{remark}
	Let us note that the boundary condition $\mathcal{B}(\textbf{E}^{n,1}) = 0$ on $\Gamma_{1,0}$ and the boundary condition $\mathcal{B}(\textbf{E}^{n,N}) = 0$ on $\Gamma_{N,N+1}$ are well-taken into account if we consider that $M^{1,0}_{\rm TE}(i) = M^{N,N+1}_{\rm TE}(i) = 0$.
    %\todo[inline]{What is the meaning of the indices $i,j$? Are the matrices simply zero everywhere?}\textcolor{blue}{It was a misprint not corrected from the previous version of the document. The index $i$ is the index of the mode we study.}
\end{remark}
Exactly the same result holds for TEM-modes, replacing $\beta^{TE}_i$ by $k$. Now, for TM-modes we have:

% \begin{remark}
% 	One can show that if $\widehat{\mathbf{E}}^{n-1,l}=  \widehat{\mathbf{E}}^{\rm TE, n-1,l}_{0,0}$ for all $l$, then the algorithm converges to the exact solution in $N$ steps. \textcolor{red}{À voir comment détailler, approche matricielle ou dire qu'on a le DtN}.
% \end{remark}

\begin{proposition}[Evolution of TM modes]\label{prop:TM-ite}
	Suppose that for all subdomains $l \in \{1, \cdots, N\}$ the solution is a combination of TM modes of the form
	\begin{equation*}
	\begin{split}
		\mathbf{E}^{n-1,l} \;\; & =  \;\; \widehat{\mathbf{E}}^{{\rm TM}, n-1,l}_{i} \;\; := \;\; e^{\imath \beta^{\rm TM}_{i} x} A^{{\rm TM},+,n-1,l}_{i} \widehat{\bfE}_{i}^{{\rm TM},+} +  e^{-\imath \beta^{\rm TM}_{i} x} A^{{\rm TM},-,n-1,l}_{i} \widehat{\bfE}_{i}^{{\rm TM},-} 
	\end{split}
	\end{equation*}	
for fixed $i$, then at the next iteration the solution will also be a TE mode $\mathbf{E}^{n,l} = \mathbf{E}^{{\rm TM}, n,l}_{i}$ with the following relation between the different mode amplitudes $A^{{\rm TM},\pm ,n}_{i}$ and $A^{{\rm TM},\pm ,n-1}_{i}$ of neighbouring domains:
	\begin{equation}
	    \label{eq:iterTM}
		M^{l,l}_{\rm TM}(i) \textbf{A}^{{\rm TM},n,l} = M^{l,l-1}_{\rm TM}(i) \textbf{A}^{{\rm TM},n-1,l-1} + M^{l,l+1}_{\rm TM}(i) \textbf{A}^{{\rm TM},n-1,l+1}
	\end{equation}
	where 
    $$\textbf{A}^{{\rm TM},n,l} = \left[A^{{\rm TM},-,n,l}_i, A^{{\rm TM},+,n,l}_i\right]^t,\, \textbf{A}^{{\rm TM},n-1,l \pm 1} = \left[A^{{\rm TM},-,n-1,l \pm 1}_i, A^{{\rm TM},+,n-1,l \pm 1}_i\right]^t
    $$ and 
	\[
		M^{l,l-1}_{\rm TM}(i) := \left[ \begin{matrix}
			(\imath \dfrac{k^2}{\beta^{\rm TM}_{i}} + \lambda_i^{\rm TM}) e^{-\imath \beta^{\rm TM}_{i} a_l} & (- \imath \dfrac{k^2}{\beta^{\rm TM}_{i}} + \lambda_i^{\rm TM}) e^{\imath \beta^{\rm TM}_{i} a_l} \\ 0 & 0
		\end{matrix} \right],
	\]
	\[
		M^{l,l+1}_{\rm TM}(i) := \left[ \begin{matrix} 
						0 & 0 \\ (-\imath \dfrac{k^2}{\beta^{\rm TM}_{i}} + \lambda_i^{\rm TM}) e^{-\imath \beta^{\rm TM}_{i} b_l} & (\imath \dfrac{k^2}{\beta^{\rm TM}_{i}} + \lambda_i^{\rm TM}) e^{\imath \beta^{\rm TM}_{i} b_l}
					\end{matrix} \right],
	\]
	and $M^{l,l}_{\rm TM}(i) = M^{l,l-1}_{\rm TM}(i) + M^{l,l+1}_{\rm TM}(i)$:
	\[
		M^{l,l}_{\rm TM}(i) := \left[ \begin{matrix} 
				(\imath \dfrac{k^2}{\beta^{\rm TM}_{i}} + \lambda_i^{\rm TM}) e^{-\imath \beta^{\rm TM}_{i} a_l} & (- \imath \dfrac{k^2}{\beta^{\rm TM}_{i}} + \lambda_i^{\rm TM}) e^{\imath \beta^{\rm TM}_{i} a_l} \\[8pt] (-\imath \dfrac{k^2}{\beta^{\rm TM}_{i}} + \lambda_i^{\rm TM}) e^{-\imath \beta^{\rm TM}_{i} b_l} & (\imath \dfrac{k^2}{\beta^{\rm TM}_{i}} + \lambda_i^{\rm TM}) e^{\imath \beta^{\rm TM}_{i} b_l}
			\end{matrix} \right].
	\]
\end{proposition}
\begin{proof}
	The proof is (almost) identical to that of \Cref{prop:TE-ite}, we only need to replace $\imath \beta^{\rm TE}$ by $\imath \dfrac{k^2}{\beta^{\rm TM}}$.
	% Still for the proof we will drop the index $i$. The methodology is the same as for the previous proof. In $\Omega_l$, we seek for a solution of the form
	% \[
	% 	\widehat{\mathbf{E}}^{n,l} = e^{\imath \beta x} A^{{\rm TM},+,n,l} \widehat{\textbf{E}}^{{\rm TM},+} +  e^{-\imath \beta x} A^{{\rm TM},-,n,l} \widehat{\textbf{E}}^{{\rm TM},-}
	% \]
	% On $\Gamma_{l,l-1}$, we have $\mathbf{n} = (-1,0,0)^t$ and using Proposition \ref{prop:BC-TE-TM} we get:
	% \[
	% \begin{split}
	% 	& \imath \dfrac{k^2}{\beta} \left( -e^{\imath \beta a_l} A^{{\rm TM},+,n,l} \widehat{\textbf{E}}^{{\rm TM},+} +  e^{-\imath \beta a_l} A^{{\rm TM},+,n,l} \widehat{\textbf{E}}^{{\rm TM}}  \right) \times \mathbf{n}\\
	% 	& + \imath k \left( e^{\imath \beta a_l} A^{{\rm TM},+,n,l} \widehat{\textbf{E}}^{{\rm TM},+} +  e^{-\imath \beta a_l} A^{{\rm TM},-,n,l} \widehat{\textbf{E}}^{{\rm TM},-}  \right) \times \mathbf{n} \\[5pt]
	% 	 = & -\imath \dfrac{k^2}{\beta} \left( -e^{\imath \beta a_l} A^{{\rm TM},+,n-1,l-1} \widehat{\textbf{E}}^{{\rm TM},+} +  e^{-\imath \beta a_l} A^{{\rm TM},-,n-1,l-1} \widehat{\textbf{E}}^{{\rm TM},-}  \right) \times \mathbf{n} \\
	% 	& + \imath k \left( e^{\imath \beta a_l} A^{{\rm TM},+,n-1,l-1} \widehat{\textbf{E}}^{{\rm TM},+} +  e^{-\imath \beta a_l} A^{{\rm TM},-,n-1,l-1} \widehat{\textbf{E}}^{{\rm TM},-}  \right) \times \mathbf{n} \\[10pt]
	% \Leftrightarrow \;\; & \left( -\imath \dfrac{k^2}{\beta}  + \imath k \right) e^{\imath \beta a_l} A^{{\rm TM},+,n,l} +  \left(\imath \dfrac{k^2}{\beta} + \imath k \right) e^{-\imath \beta a_l} A^{{\rm TM},-,n,l}\\[5pt]
	% 	 = & \left( -\imath \dfrac{k^2}{\beta}  + \imath k \right) e^{\imath \beta a_l}  A^{{\rm TM},+,n-1,l-1} +  \left(\imath \dfrac{k^2}{\beta} + \imath k \right) e^{-\imath \beta a_l} A^{{\rm TM},-,n-1,l-1}
	% \end{split}
	% \]
	% To get the equivalence with the last equality, one need to remark that $\widehat{\textbf{E}}^{{\rm TM},+}  \times \mathbf{n} = \widehat{\textbf{E}}^{{\rm TM},-} \times \mathbf{n}$ since
	% \[
	% 	\textbf{E} \times \left[ \begin{matrix}
	% 		-1 \\ 0 \\ 0
	% 	\end{matrix} \right] = \left[ \begin{matrix}
	% 		0 \\ -E_z \\ E_y
	% 	\end{matrix} \right],
	% \]
	% and the $y-$ and $z-$components of $\widehat{\textbf{E}}^{{\rm TM},+} $ and $\widehat{\textbf{E}}^{{\rm TM},-} $ are the same.
	% Now, we have on $\Gamma_{l,l+1}$ the normal $\mathbf{n} = (1,0,0)^t$ and using again Proposition \ref{prop:BC-TE-TM} we get:
	% \[
	% \begin{split}
	% 	& \imath \dfrac{k^2}{\beta} \left( e^{\imath \beta b_l} A^{{\rm TM},+,n,l} \widehat{\textbf{E}}^{{\rm TM},+} -  e^{-\imath \beta b_l} A^{{\rm TM},-,n,l} \widehat{\textbf{E}}^{{\rm TM},-}  \right) \times \mathbf{n}\\
	% 	& + \imath k \left( e^{\imath \beta b_l} A^{{\rm TM},+,n,l} \widehat{\textbf{E}}^{{\rm TM},+} +  e^{-\imath \beta b_l} A^{{\rm TM},-,n,l} \widehat{\textbf{E}}^{{\rm TM},-}  \right) \times \mathbf{n} \\[5pt]
	% 	 = \;\; & \imath \dfrac{k^2}{\beta} \left( e^{\imath \beta b_l} A^{{\rm TM},+,n-1,l+1} \widehat{\textbf{E}}^{{\rm TM},+} -  e^{-\imath \beta b_l} A^{{\rm TM},-,n-1,l+1} \widehat{\textbf{E}}^{{\rm TM},-}  \right) \times \mathbf{n} \\
	% 	& + \imath k \left( e^{\imath \beta b_l} A^{{\rm TM},+,n-1,l+1} \widehat{\textbf{E}}^{\rm TM,+} +  e^{-\imath \beta b_l} A^{{\rm TM},-,n-1,l+1} \widehat{\textbf{E}}^{\rm TM,-}  \right) \times \mathbf{n} \\[10pt]
	% \Leftrightarrow \;\; & \left( \imath \dfrac{k^2}{\beta}  + \imath k  \right) e^{\imath \beta b_l} A^{{\rm TM},+,n,l} +  \left(-\imath \dfrac{k^2}{\beta} + \imath k \right) e^{-\imath \beta b_l}  A^{{\rm TM},-,n,l}\\[5pt]
	% 	 = & \left( \imath \dfrac{k^2}{\beta}  + \imath k \right) e^{\imath \beta b_l}  A^{{\rm TM},+,n-1,l+1} +  \left(-\imath \dfrac{k^2}{\beta} + \imath k \right) e^{-\imath \beta b_l}  A^{{\rm TM},-,n-1,l+1}
	% \end{split}
	% \]
	% Combining these two relations, we get the expected result:
	% \[
	% 	M^{l,l}_{\rm TM} \textbf{A}^{{\rm TM},n,l} = M^{l,l-1}_{\rm TM} \textbf{A}^{{\rm TM},n-1,l-1} + M^{l,l+1}_{\rm TM} \textbf{A}^{{\rm TM},n-1,l+1}.
	% \]
\end{proof}

The iteration relations obtained in \Cref{prop:TE-ite} and \Cref{prop:TM-ite} can be reformulated in a simpler and more compact way:
\begin{proposition}[Compact writing of the Schwarz iteration] \label{prop:R-ite}
	Let us denote by 
	\[
		\mathbf{R}^{{\rm{T}},n,l}(i) = \left[ \begin{matrix}
			R^{{\rm{T}},-,n,l}(i) \\ R^{{\rm{T}},+,n,l}(i)
		\end{matrix} \right] := M^{l,l}_{\rm{T}}(i) \textbf{A}^{{\rm{T}},n,l}(i) \quad \text{T} \in \{ {\rm TE, TM, TEM}\}.
	\]
	Then, the iteration relations given in \Cref{eq:iterTE} and \Cref{eq:iterTM} from \Cref{prop:TE-ite} and \Cref{prop:TM-ite} can be re-written as:
	\[
		\textbf{R}^{{\rm T},n,l} = K^{-}_{\rm T}(i) \textbf{R}^{{\rm T},n-1,l-1} + K^{+}_{\rm T}(i) \textbf{R}^{{\rm T},n-1,l+1},  \quad \text{T} \in \{ {\rm TE, TM, TEM}\}
	\]
	where matrices $K^{\pm}_{\rm T}$ are independent of the index $l$ of the subdomain and are given by:
	\[
		K^{+}_{\rm T}(i) = \left[ \begin{matrix}
			0 & 0 \\ a^{{\rm T}}_i(\kappa) & b^{{\rm T}}_i(\kappa)
		\end{matrix} \right] \quad \text{and} \quad K^{-}_{\rm T}(i) = \left[ \begin{matrix}
			b^{{\rm T}}_i(\kappa) & a^{{\rm T}}_i(\kappa) \\ 0 & 0
		\end{matrix} \right], 
	\]
	with
	\begin{align}
		a^{{\rm T}}_i(\kappa) &= \dfrac{((\lambda^{\rm T}_i)^2 -\kappa^2) \left(e^{\imath \beta^{\rm T}_i (L+\delta)} - e^{-\imath \beta^{\rm T}_i (L+\delta)}\right)}{\left( \kappa + \lambda^{\rm T}_i \right)^2  e^{\imath \beta^{\rm T}_i (L + 2\delta) } - (-\kappa + \lambda)^2  e^{-\imath \beta^{\rm T}_i (L + 2\delta)}} \\
        b^{{\rm T}}_i(\kappa) &= \dfrac{(\kappa +\lambda^{\rm T}_i)^2 e^{\imath \beta^{\rm T}_i \delta} -(\lambda^{\rm T}_{i} -\kappa)^2 e^{-\imath \beta^{\rm T}_i \delta}}{\left( \kappa + \lambda^{\rm T}_i \right)^2  e^{\imath \beta^{\rm T}_i (L + 2\delta) } - (-\kappa + \lambda^{\rm T}_i)^2  e^{-\imath \beta^{\rm T}_i (L + 2\delta)}},
	\end{align}
	and with $\kappa = \imath \beta^{\rm TE}$ for TE-modes, $\imath k$ for TEM-modes and $\kappa = \imath \dfrac{k^2}{\beta_{i}^{\rm TM}}$ for TM-modes.
\end{proposition}
\begin{proof}
	For the proof, we will drop the index $i$ as well as the superscript T (the arguments are similar for each case). Clearly, we have:
	\begin{equation*}
	\begin{split}	
		& M^{l,l} \textbf{A}^{n,l} = M^{l,l-1} \textbf{A}^{n-1,l-1} + M^{l,l+1} \textbf{A}^{n-1,l+1}, \\
	\Leftrightarrow \;\; &  \textbf{R}^{n,l} = \underbrace{M^{l,l-1} \left[ M^{l - 1,l - 1} \right]^{-1}}_{=: K^{-}} \textbf{R}^{n-1,l-1} + \underbrace{M^{l,l+1} \left[ M^{l + 1,l + 1} \right]^{-1}}_{=: K^{+}} \textbf{R}^{n-1,l+1}.
	\end{split}
	\end{equation*}
	It remains to show that $M^{l,l \pm 1} \left[ M^{l \pm 1,l \pm 1} \right]^{-1}$ is independent of $l$. Because $b_{l \pm 1} - a_{l \pm 1} = L + 2\delta$, we get that:
	\begin{equation*}
	\begin{split}
		\det (M^{l \pm 1,l \pm 1} ) \;\; & = \;\; \left( \kappa + \lambda \right)^2  e^{\imath \beta (L + 2\delta) } - (-\kappa + \lambda)^2  e^{-\imath \beta (L + 2\delta)} =: D,
	\end{split}
	\end{equation*}
	where $\kappa = \imath \beta$ for TE-modes, $\kappa = \imath k$ for TEM-modes and $\lambda = \imath \frac{k}{\beta}$ for TM modes. Moreover, we have:
	\begin{equation*}
	\begin{split}
		M^{l,l + 1} \left[ M^{l + 1,l + 1} \right]^{-1} & = \dfrac{1}{D} \left[ \begin{matrix} 
				0 & 0 \\ (-\kappa + \lambda) e^{-\imath \beta b_l} & (\kappa + \lambda) e^{\imath \beta b_l}
			\end{matrix} \right] \left[ \begin{matrix} 
				(\kappa + \lambda) e^{\imath \beta b_{l+1}} & (\kappa - \lambda) e^{\imath \beta a_{l+1}} \\ (\kappa - \lambda) e^{-\imath \beta b_{l+1}} & (\kappa + \lambda) e^{-\imath \beta a_{l+1}}
			\end{matrix} \right] \\
			& = \dfrac{1}{D} \left[ \begin{matrix} 
				0 & 0 \\ (\lambda^2 -\kappa^2) \left(e^{\imath \beta (L+\delta)} - e^{-\imath \beta (L+\delta)}\right) & (\kappa +\lambda)^2 e^{\imath \beta \delta} -(\lambda -\kappa)^2 e^{-\imath \beta \delta}
			\end{matrix} \right]
	\end{split}		
	\end{equation*}
	recalling that $b_{l+1} - b_l = L + \delta$ and $b_{l} - a_{l+1} = \delta$. Similarly, we have:
	\begin{equation*}
	\begin{split}
		M^{l,l - 1} \left[ M^{l - 1,l - 1} \right]^{-1} & = \dfrac{1}{D} \left[ \begin{matrix} 
				(\kappa + \lambda) e^{-\imath \beta a_{l}} & (-\kappa + \lambda) e^{\imath \beta a_{l}} \\ 0 & 0
			\end{matrix} \right] \left[ \begin{matrix} 
				(\kappa + \lambda) e^{\imath \beta b_{l-1}} & (\kappa - \lambda) e^{\imath \beta a_{l-1}} \\ (\kappa - \lambda) e^{-\imath \beta b_{l-1}} & (\kappa + \lambda) e^{-\imath \beta a_{l-1}}
			\end{matrix} \right] \\
			& = \dfrac{1}{D} \left[ \begin{matrix} 
				(\kappa +\lambda)^2 e^{\imath \beta \delta} -(\lambda -\kappa)^2 e^{-\imath \beta \delta}  & (\lambda^2 -\kappa^2) \left(e^{\imath \beta (L+\delta)} - e^{-\imath \beta (L+\delta)}\right) \\ 0 & 0
			\end{matrix} \right]
	\end{split}		
	\end{equation*}
	recalling this time that $b_{l-1} - a_l = \delta$ and $a_{l} - a_{l-1} = L + \delta$.
\end{proof}


\begin{remark}\label{rem:coef-TE-TM-eq}
	By using the identities
	\[	
		k^2 - \dfrac{k^4}{\beta^2} = -\dfrac{k^2}{\beta^2}(\beta^2 - k^2)  \quad \text{and} \quad \dfrac{\beta^2}{k^2} \left( k \pm \dfrac{k^2}{\beta} \right)^2 = \left( \beta \pm k \right)^2,
	\]
	we can deduce that for $\lambda^{\rm T}_i = -\imath k$: 
    \begin{equation*}
		a^{\rm T}_i(\kappa) = -a^{\rm T}_i\left(\frac{k^2}{\kappa}\right) \quad \text{and} \quad b^{\rm T}_i(\kappa) = b^{\rm T}_i\left(\frac{k^2}{\kappa}\right). 
	\end{equation*}
	Therefore, for the transmission condition \cref{def:op-T-ik} the iteration matrices are almost the same (up to the sign of $a$) for TE (TEM) and TM modes if $\beta^{\rm TE} = \beta^{\rm TM}$. A similar result holds for the PML transmission condition \cref{def:op-PML} since in that case we have for $\kappa = \imath \dfrac{k^2}{\beta^{\rm T}_i}$ and $\lambda^{\rm T}_i = -\imath \dfrac{k^2}{\beta^{\rm T}_i}c(\beta^{\rm T}_i)$ (where $c(\beta^{\rm T}_i)$ is a coefficient appearing in the expressions of $\lambda_i$'s from \Cref{eq:lambdaPML}):
    \[
        \kappa^2 - (\lambda^{\rm T}_i)^2 = -\dfrac{k^4}{(\beta^{\rm T}_i)^4} \left( (\beta^{\rm T}_i)^2 - (\beta^{\rm T}_i c(\beta^{\rm T}_i))^2 \right) \, \text{and} \, (\kappa \pm \lambda^{\rm T}_i)^2 = \dfrac{k^4}{(\beta^{\rm T}_i)^4}(\imath \beta^{\rm T}_i c(\beta^{\rm T}_i) - \imath \beta^{\rm T}_i)^2.
    \]
    Therefore we have this time $a^{\rm TE}_i(\kappa) = a^{\rm TM}_i(\frac{k^2}{\kappa})$ and $b^{\rm TE}_i(\kappa) = b^{\rm TM}_i(\frac{k^2}{\kappa})$ if $\beta^{\rm TE} = \beta^{\rm TM}$.
\end{remark}


To conclude, according to \Cref{prop:R-ite}, the analysis of the convergence of the Schwarz algorithm reduces to the study, for each mode $i$, of the spectral properties of the iteration matrices $I^{\rm TE}(i)$, $I^{\rm TEM}(i)$ and $I^{\rm TM}(i)$ defined by the relations:
\[
	\textbf{R}^{{\rm T},n+1}(i) = I^{\rm T}(i) \textbf{R}^{{\rm T},n}(i) \quad \text{where} \quad \text{T} \in \{\text{TE}, \text{TEM}, \text{TM}\}, \;\; i \in \mathbb{N}_T,
\] 
where
\begin{equation*}
\begin{split}
	& \textbf{R}^{{\rm T},n}(i) = \left(R^{{ \rm T },-,n,1}_{i}, R^{{\rm T},+,n,1}_{i}, \cdots, R^{{\rm T},-,n,N}_{i}, R^{{\rm T},+,n,N}_{i} \right)^t.%\\
%\text{and} \;\; & \textbf{R}^{{\rm TM},n}(i,j) = \left(R^{{\rm TM},-,n,1}_{i,j}, R^{{\rm TM},+,n,1}_{i,j}, \cdots, R^{{\rm TM},-,n,N}_{i,j}, R^{{\rm TM},+,n,N}_{i,j} \right)^t.
\end{split}
\end{equation*}
More explicitly, this iteration matrix can be written as:
\[
	I^{\rm{T}}(i) =  \left[ \begin{matrix}
		0_{2\times 2} & K^+_{{\rm T}}(i)  & \cdots & 0_{2\times 2} \\[6pt]
		K^-_{{\rm T}}(i)  & 0_{2\times 2} & \ddots & \vdots \\[6pt]
		\vdots & \ddots & \ddots & K^+_{{\rm T}}(i) \\[6pt]
		0_{2 \times 2} & & K^-_{{\rm T}}(i) & 0_{2\times 2}
	\end{matrix} \right].
\]

\begin{remark}
One very interesting feature of this type of iteration matrices is that $I^{\rm{T}}(i)$ does not depend on the subdomain parameters $a_l$ and $b_l$ in other words the coefficients of each block of the matrix are constant. Hence we say that this matrix has a block Toeplitz structure. The size of the matrix increases with the number of subdomains hence the spectral radius of this matrix while being an indicator of the convergence properties of the algorithm also allows to analyse its scalability (i.e. its behaviour for an increasing number of domains).  
\end{remark}
For this kind of matrices, one can reuse under certain conditions the result from \cite{Bootland:2022:APS} on their limiting spectrum:
\begin{theorem}\label{thm:spectre-limit}
	If $a \neq 0$ and $b \neq 0$, the spectral radius of $I^{\rm{T}}(i)$ satisfies:
	\[
		\lim_{N \rightarrow +\infty} \rho(I^{\rm{T}}(i)) = \max(|a^{\rm T}_i(\kappa)+b^{\rm T}_i(\kappa)|,|a^{\rm T}_i(\kappa)-b^{\rm T}_i(\kappa)|), \quad \text{T} \in \{\text{TE}, \text{TEM}, \text{TM}\}.
	\]
    hence as the number of subdomains increases, the convergence factor tends to a constant. If this convergence factor is stricly less than $1$ for all modes, we say that the method will scale. 
\end{theorem}

We should note that in certain situations we cannot analyse the convergence anymore using the limiting spectrum arguments. In particular in the case $a=0$, the result from \cref{thm:spectre-limit} doesn't apply but we can still characterise the convergence using nilpotency of the iteration matrix. In particular, this is the case when the PML layer is infinite:
\begin{proposition}
    In the case of an infinite PML, $\ell = +\infty$, which corresponds to the perfect ``Dirichlet To Neumann'' operator $\mathcal{T}$, we have $\lambda^{\rm T}_i = \kappa$ and therefore $a^{\rm T}_i = 0$ and $b^{\rm T}_i = e^{-\imath \beta^{\rm T}_i (L+\delta)}$. Moreover, the iteration matrix $I^{\rm T}(i)$ satisfies $\left[I^{\rm T}(i)\right]^{N} = 0$ for all $\text{T}\in \{\text{TE, TEM, TM}\}$ and $i \in \mathbb{N}_T$, where we recall that $N$ is the number of subdomains.
\end{proposition}
Before proving it, let us emphasize that this result is consistent with the fact that $\mathcal{T}$ leads to the transparent boundary conditions. Indeed, it is well known in that case that the Schwarz algorithm \cref{pb:Schwarz-ite} converges in $N$ iterations, $N$ being the number of subdomains. %\todo{Add reference on dd convergence when using transparent BC}

\begin{proof}
   {As explained before, for $\sigma > 0$ and $\ell = +\infty$, the PML will tend to a transparent boundary condition and $\lambda_i^{\rm TE} = -\beta^{\rm TE}_i$, $\lambda^{\rm TM}_i = -\frac{k^2}{\beta^{\rm TM}_i}$ and $\lambda^{\rm TEM}_i = -\imath k$. Therefore, this clearly leads to $a^{\rm T}_i = 0$ in the definition of $a^{\rm T}_i$ given in \cref{prop:R-ite} because $\kappa = \lambda^{\rm T}_i$. 
   
    To prove that $\left[I^{\rm T}(i)\right]^{N} = 0$, we will show that for any vector ${\bf{R}} \in \C^{2N}$ we have $\left[I^{\rm T}(i)\right]^{N} {\bf{R}} = \bf{0}$. Since $a^{\rm T}_i=0$, there is only one non-zero term on each line of the matrix $I^{\rm T}(i)$ except for the lines $1$ and $2N$ which are null. More precisely, we have for all $l \in \{1, \cdots, N-1\}$:
    \[
        \left(I^{\rm T}(i) {\bf{R}} \right)_{2l+1} = b \; {\bf{R}}_{2l-1} \quad \text{and} \quad \left(I^{\rm T}(i) {\bf{R}} \right)_{2l} = b \; {\bf{R}}_{2l+2},
    \]
    and $\left(I^{\rm T}(i) {\bf{R}} \right)_{1} = \left(I^{\rm T}(i) {\bf{R}} \right)_{2N} = 0$. Then, since ${\bf{R}}^{(2)} = \left[I^{\rm T}(i)\right]^2 {\bf{R}} = \left[I^{\rm T}(i)\right] {\bf{R}}^{(1)}$ with ${\bf{R}}^{(1)} = \left[I^{\rm T}(i)\right] {\bf{R}}$, we easily deduce that ${\bf{R}}^{(2)}_{1} = {\bf{R}}^{(2)}_{3} = 0$ and ${\bf{R}}^{(2)}_{2N} = {\bf{R}}^{(2)}_{2N-2} = 0$. Repeating this  $N$ times, we get that ${\bf{R}}^{(N)} := \left[I^{\rm T}(i)\right]^N {\bf{R}} = {\bf{0}}$ which proves our statement.}
\end{proof}



%\textcolor{red}{Ce résultat montre que la matrice est nilpotente lorsqu'on a $a=0$ (i.e. la condition transparente). Dans ce cas, je ne sais pas si un point de théorie est bloquante pour le spectre limite... J'imagine que oui car les valeurs propres de la matrice doivent toutes être nulles a priori (sinon $A^{N} {\bf{u}} = \lambda^N {\bf{u}} \neq 0$ ce qui contredit le caractère nilpotent) et le spectre limite doit être nécessairement $0$.}

\section{Numerical experiments}
\label{sec:numeric}
In this section we will show two types of numerical results. First, we will illustrate the limiting spectrum property, that is, how the convergence factor tends to the predicted theoretical value as the number of subdomains increases. Secondly, we aim at showing scalability for discretised Maxwell's equation in a waveguide and decomposition into many subdomains when using different types of transmission conditions.

\subsection{Limiting spectrum property for absorbing boundary conditions and PMLs}
In order to illustrate the limiting spectrum property from \Cref{thm:spectre-limit} we will evaluate the spectral radius of the iteration matrices $I^{\rm{TE}}(r)$, $I^{\rm{TEM}}(r)$ and $I^{\rm{TM}}(r)$ since $\beta^{\rm TE}(r) = \beta^{\rm TM}(r)$ for a rectangular waveguide and a decomposition in different number of subdomains. 
 For simplicity, we will replace the eigenvalues $\lambda^\mathcal{D}_i$ and $\lambda^\mathcal{N}_i$ by a continuous variable $r \in \mathbb{R}^+$. For instance, $\beta^{\rm TE}_i$ will be replaced by $\beta^{\rm TE}(r) = \sqrt{k^2 - r^2}$. Thanks to \cref{rem:coef-TE-TM-eq}, we thus deduce that the limiting spectrum is the same for iteration matrices $I^{\rm{TE}}(r)$, $I^{\rm{TEM}}(r)$ and $I^{\rm{TM}}(r)$ since $\beta^{\rm TE}(r) = \beta^{\rm TM}(r)$.

\begin{figure}[h]
		\centering
		\includegraphics[height=4cm]{Img/ImgTE_w=10.png}
		\includegraphics[height=4cm]{Img/ImgTM_w=10.png}
		\caption{Spectral radius of the iteration matrix for TE-modes (and TEM-modes) on the left and TM-modes on the right with respect to $r \geq 0$ using the transmission condition \eqref{def:op-T-ik}.}\label{fig3:convFactTE-TM}
\end{figure}

Now, for a fixed frequency $k=10$, $L= 1$ and overlap $\delta = 0.1$, we have represented in \cref{fig3:convFactTE-TM} the spectral radius of $I^{\rm{TE}}(r)$ and $I^{\rm{TM}}(r)$ for various number of subdomains $N \in \{5, 10, \cdots, 35\}$ using the transmission conditions given by \cref{def:op-T-ik}. 

\begin{figure}[h]
		\centering
		\includegraphics[height=4cm]{Img/ImgTE_w=10_PML.png}
		\includegraphics[height=4cm]{Img/ImgTE_w=10_PML_forte.png}
		\caption{Spectral radius of the iteration matrix (TE or TM, it is the same) taking $\ell = 0.1$ and $\sigma = 5$ (on the left) and taking $\ell= 1$ and $\sigma = 10$ (on the right) with respect to $r \geq 0$ using the transmission condition \eqref{def:op-PML}.}\label{fig4:convFactTE-TM-PML}
\end{figure}

For the same parameter, we have also represented the same quantity but using a PML transmission condition \cref{def:op-PML} with $\ell = 0.1$ and $\sigma = 5$, and with $\ell = 1$ and $\sigma = 5$ in \cref{fig4:convFactTE-TM-PML}. 

For both transmission conditions, we can see that the convergence to the limit spectrum is fast for evanescent modes ($r \geq k$). For absorbing boundary conditions from \Cref{def:op-T-ik}, the convergence to the limit spectrum is also quite fast for propagative modes. On the other hand, for PML transmission conditions from \Cref{def:op-PML}, this convergence is bit slower for these modes and for a very strong PML (in the sense that it acts almost as the exact transmission operator). This last remark is consistent with the theory since we (almost) have $a=0$ and as we have seen, in that case all the eigenvalues of the iteration matrix tend to $0$. In this "near nilpotency" case, the limiting spectrum result doesn't hold any longer. 

Also as expected, we can also see that PML transmission conditions lead in general to a better convergence factor than absorbing boundary conditions, and this behavirou is quite prominent for propagative modes and a lower number of subdomains.  

Let us now show the impact of complex frequencies $k$, which corresponds to the case of the complex electric permittivity $\varepsilon = \varepsilon' - \imath \varepsilon''$ with $\varepsilon'' > 0$. From physical point of view this means the waves are damped in an absorptive media and for this reason, the numerical computation of the solution would be easier and the underlying algorithms will converge faster. 
We have represented on \cref{fig5:convFactTE-kcomplex} the spectral radius of the iteration matrix for TE-modes (it is the same for TM-modes as previously explained) and the limiting spectrum taking $k = 10 + \imath$. The results have been obtained using the same parameters as before and we tested the two transmission conditions defined in \Cref{def:op-T-ik} and \Cref{def:op-PML}. We can see that even a (quite) small imaginary part drastically reduces the convergence factor in both cases. Also, we see that, as expected, the PML transmission conditions still lead to better results. Finally, let us mention that this time, the limit spectrum is less than one (in modulus) which shows that the iterative Schwarz algorithm will converge with a rate independent of the number of domains and hence we have weak scalability. 

\begin{figure}[h]
		\centering
		
        \includegraphics[height=4cm]{Img/ImgTE_w=10+i.png}
		\includegraphics[height=4cm]{Img/ImgTE_w=10+i_PML.png}
		\caption{Spectral radius of the iteration matrix for TE-modes with respect to $r \geq 0$ using the transmission condition \eqref{def:op-T-ik} (on the left) and \eqref{def:op-PML} (on the right).}\label{fig5:convFactTE-kcomplex}
\end{figure}





\bibliographystyle{siamplain}
\bibliography{paper_arXiv}
\end{document}
