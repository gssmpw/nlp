% Version history
% 0521 (this version): first submission version. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[letterpaper, 11 pt, onecolumn]{ieeeconf}  % Comment this line out
%\IEEEoverridecommandlockouts                              % This command is only

\IEEEoverridecommandlockouts                              % This command is only

    
\overrideIEEEmargins

\input{inc/packages}
\input{inc/definition_this_paper}

\usepackage{textcomp}
\makeatletter
\newcommand\fs@spaceruled{\def\@fs@cfont{\bfseries}\let\@fs@capt\floatc@ruled
  \def\@fs@pre{\vspace{3mm}\hrule height.8pt depth0pt \kern2pt}%
  \def\@fs@post{\kern2pt\hrule\relax\vspace{-4mm}}%
  \def\@fs@mid{\kern2pt\hrule\kern2pt}%
  \let\@fs@iftopcapt\iftrue}
\makeatother

%{Synthesis of Control Barrier Functions in the Presence of Input Constraints via Sum of Squares Optimization}

% \author{ \parbox{3 in}{\centering Huibert Kwakernaak
%         \thanks{Use the $\backslash$thanks command to put information here}\\
%         Faculty of Electrical Engineering, Mathematics and Computer Science\\
%         University of Twente\\
%         7500 AE Enschede, The Netherlands\\
%         {\tt\small h.kwakernaak@autsubmit.com}}
%         \hspace{ 0.5 in}
%         \parbox{3 in}{ \centering Pradeep Misra
%         \thanks{The footnote marks may be inserted manually}\\
%         Department of Electrical Engineering \\
%         Wright State University\\
%         Dayton, OH 45435, USA\\
%         {\tt\small pmisra@cs.wright.edu}}
% }

\author{Pan Zhao% ,~\IEEEmembership{Member,~IEEE} 
%\thanks{This work is supported }
\thanks{P. Zhao is with the Department of 
Aerospace Engineering and Mechanics, University of Alabama, Tuscaloosa, AL 35487, USA. {\tt\small pan.zhao@ua.edu}. }%
% \vspace{-5mm}
}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\markboth{\journalname, VOL. XX, NO. XX, XXXX 2023}
{Zhao \MakeLowercase{\textit{et al.}}: Convex Synthesis of Parameter-Dependent CLFs Under Input Constraints (2024)}
\begin{document}

\title{\LARGE \bf Parameter-Dependent Control Lyapunov Functions for Stabilizing Nonlinear Parameter-Varying Systems}

\maketitle
\thispagestyle{empty}
\pagestyle{empty}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
% This paper introduces the concept of parameter-dependent (PD) control Lyapunov functions (CLFs) for gain-scheduled nonlinear stabilization of nonlinear parameter-varying (NPV) systems under input constraints. For polynomial NPV systems, it presents convex conditions to verify whether a given function is a  PD-CLF under input constraints based on sum of squares (SOS) programming.  Additionally, leveraging a linear-like representation of the nonlinear dynamics, the paper introduces SOS-based convex conditions to jointly synthesize a PD-CLF and a PD controller while maximizing the parameter-dependent region of stabilization. The proposed approach fully accounts for the nonlinearity of the dynamics, without resorting to linearzation or over approximation that are typically required in linear parameter-varying control of nonlinear systems. 

This paper introduces the concept of parameter-dependent (PD) control Lyapunov functions (CLFs) for gain-scheduled stabilization of nonlinear parameter-varying (NPV) systems. It shows that given a PD-CLF, a min-norm control law can be constructed by solving a robust quadratic program. For polynomial control-affine NPV  systems, it provides convex conditions, based on the sum of squares (SOS) programming, %to verify whether a given function qualifies as a PD-CLF under input constraints. Furthermore, the paper presents an SOS-based approach for 
to jointly synthesize a PD-CLF and a PD controller while maximizing the PD region of stabilization. Input constraints can be straightforwardly incorporated into the synthesis procedure.  Unlike traditional linear parameter-varying (LPV) methods that rely on linearization or over-approximation to get an LPV model, the proposed framework fully captures the nonlinearities of the system dynamics. 
The theoretical results are validated through numerical simulations, including a 2D rocket landing case study under varying mass and inertia.


% Simulation results are included to validate the effectiveness of the proposed method. 
\end{abstract}

\begin{keywords}
Nonlinear control, gain-scheduled control, robust control, convex optimization
\end{keywords}
% \noindent\nh{This is a test.}
% \rg{This is a test.}
% \ha{This is a test.}
% \yc{This is a test.}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% {To do lists}
% \begin{itemize}
%     \item Make it clear that the set is around zero origin.
%     \item Adjust the structure of the paper; use general constraints at first and then use restrictive constraints for the initial design. 
% \end{itemize}


% \vspace{-2mm}
\section{Introduction}\label{sec:introduction}
%Ensuring safety in terms of state constraints is crucial for controlling many real-world systems. 
Control Lyapunov functions (CLFs) offer a method for designing stabilizing control inputs for nonlinear systems without the need for an explicit feedback control law \cite{sontag1983clf, Artstein1983clf}. Additionally, a CLF can be used to generate a pointwise min-norm control law, which is optimal for some meaningful cost functions \cite{freeman1996control-clf}. Given a nonlinear system, verification and synthesis of a CLF has been studied using sum of squares (SOS) optimization techniques \cite{tan2004searching-clf-sos,dai2022convex-clf-cbf}. However, existing work on CLF typically considers only autonomous systems or time-varying systems \cite{jiang2009stabilization-ntv-clf}. However, the concept of CLF for nonlinear parameter-varying systems has not been studied. 

A nonlinear parameter-varying (NPV) system is a nonlinear system that explicitly depends on some time-varying parameters. It can be considered as a generalization of a linear parameter-varying (LPV) system \cite{Shamma92gain-CSM,Rugh00gs_survey, Moh12LPVBook} in the sense that the dynamics of an NPV system can have a nonlinear structure. In fact, many nonlinear time-varying systems in the real world can be modeled as an NPV system, such as a rocket with varying mass due to propellant consumption, a ground vehicle experiencing varying friction coefficients, and an aircraft subject to varying disturbances.  Similar to the LPV paradigm \cite{Shamma92gain-CSM,Rugh00gs_survey, Moh12LPVBook},  modeling a nonlinear time-varying system as an NPV system allows us to design gain-scheduled nonlinear controllers that automatically adjust the control law based on real-time measurement and estimation of the parameters. 
%In fact, synthesizing nonlinear parameter-dependent (PD) controllers for NPV systems based on SOS programming has been studied in \cite{fu2018hinf-npv,fu2019exponential-npv,lu2020domain-npv,yu2024hinf-npv}. However, all these existing works are based on the Lyapunov function approach instead of a CLF. Moreover, none of them provides an approach to maximize the PD region of attraction or PD region of stabilization in controller synthesis.

% support optimization-based control approaches, such as quadratic programs (QPs),  

% which \cite{galloway2015torque}. 

% \subsection{Related Work}
{\bf Related Work}: {\it LPV control}: In LPV control framework \cite{Shamma92gain-CSM,Rugh00gs_survey, Moh12LPVBook}, a nonlinear system is first approximated by an LPV model, $\dot x = A(\theta(t))x+ B(\theta(t))u$, whether $\theta(t)$ is the vector of scheduling parameters that can be measured or estimated online 
 and characterize the variation of system dynamics. 
 Given the LPV model, an LPV controller can be designed to ensure stability and performance of the closed-loop system, e.g., using linear matrix inequalities \cite{Wu96Induced,Apk98}. A major issue with the LPV framework is that the LPV model used for control design is either {\it only locally valid} when Jacobian linearization is used to obtain the LPV model, or is an {\it over-approximation} of the real dynamics when the quasi-LPV approach is used, leading to conservative performance \cite{Rugh00gs_survey}. 
 %In contrast, the proposed research {\it fully accounts for the nonlinear dynamics} without using linearization or over-approximation. 
 Additionally,  in the LPV framework, the control law is limited to be linear (although it can be parameter-dependent). 


% {\it Nonlinear control synthesis using SOS optimization}:  Leveraging a linear-like representation, \cite{prajna2004nonlinear-sos} proposed to search for a state-dependent Lyapunov function (LF) and a controller jointly using SOS programming. %A well-recognized problem in Lyapunov-based nonlinear synthesis is that nonlinear terms involving the product of LF coefficients and controller gain may appear in the synthesis conditions, leading to non-convex problems. 
% In \cite{prajna2004nonlinear-sos},  nonlinear terms involving the product of LF coefficients and controller gain are avoided by constraining the LF to depend on states whose derivatives are not directly affected by any control input. Recently, \cite{fu2018hinf-npv,fu2019exponential-npv,lu2020domain-npv,yu2024hinf-npv} extended the approach in \cite{prajna2004nonlinear-sos} to design nonlinear PD controllers for NPV systems. However, all these existing works are based on the Lyapunov function approach instead of a CLF. Moreover, none of them provides an approach to maximize the PD region of attraction or PD region of stabilization in controller synthesis, although PD region of attraction was studied in \cite{lu2020domain-npv}.

{\it Verification and synthesis of CLF and control barrier functions (CBFs)}: Inspired by CLFs, CBFs are proposed to design control inputs to ensure set-invariance of nonlinear systems without resorting to a specific control law \cite{ames2016cbf-tac}. Due to the similarity between a CLF and a CBF, approaches developed for verifying and synthesizing one of them can be readily applied to the other.  \cite{tan2004searching-clf-sos} proposed to iteratively search for CLFs via SOS optimization without searching for a controller. %\cite{dai2022convex-clf-cbf} developed an SOS optimization-based approach to verify and synthesis a CLF or CBF in the presence of input constraints. Additionally, 
SOS optimization based CBF synthesis has been studied in   \cite{wang2018permissive-sos, clark2021verification} without considering input constraints, and in \cite{dai2022convex-clf-cbf,zhao2023convex-cbf} with consideration of input constraints. 
%linearization \cite{wabersich2022predictive}, machine learning \cite{robey2020learning-cbf-expert,srinivasan2020synthesis-learning-cbf} and Hamilton-Jacobi reachability analysis \cite{choi2021robust-cbvf,tonkens2022refining-CBF}.  
However, all these existing works are for nonlinear autonomous systems, and cannot handle the NPV systems considered in this manuscript. 
%an initial valid LF is needed for the synthesis procedure.}
%Finally, there are machine learning-based methods \cite{robey2020learning-cbf-expert,srinivasan2020synthesis-learning-cbf} that seek to learn CBFs using data generated by experts and require a large amount of data to provide reasonable safety guarantees. Finally, a method was proposed in \cite{tonkens2022refining-CBF}  to refine given CBF candidates using Hamilton-Jacobi reachability analysis. % and was guaranteed to produce a valid CBF upon convergence. 
%However, due to the computational complexity of the dynamic programming-based recursion, the approach is applicable to low-dimensional systems only. 

% \subsection{Contributions}
{\bf Statement of Contributions}:
This paper introduces the concepts of parameter-dependent CLF (PD-CLF) for stabilizing NPV systems. It shows that given a PD-CLF, a min-norm control law can be constructed by solving a robust quadratic program and is locally Lipschitz. Additionally, it presents a method for
%for verifying whether a given function is a PD-CLF based on SOS programming. Moreover, the paper introduces a method for 
jointly synthesizing a PD-CLF and a PD controller while maximizing the PD region of stabilization based on SOS programming. % It is also shown that input constraints can be straightforwardly incorporated into the synthesis procedure. 
The theoretical results are validated through numerical simulations, including a 2D rocket landing case study under varying mass and inertia.



{{\it Notations}: Let $\mathbb{R}$, $\mathbb{R}^n$,  $\mathbb{R}^{m\times n}$ and $\mcS^n $ denote the sets of real numbers, $n$-dimensional real vectors, $m$ by $n$ real  matrices, and $n\times n$ real symmetric matrices, respectively. $\mbZ_i^n$ denotes the integer set $\{i, i+1,\cdots,n\}$.
%$I_n$  denotes an  identity matrix of size $n$, and $0$ is a zero matrix of a compatible dimension.
%$\norm{\cdot}$ denotes the $2$-norm of a vector or a matrix.
$\mbR[x]$ denotes the set of polynomials with real coefficients, while $\mcS^n[x] $ and $\mbR^{m\times n}[x]$ denote the sets of $n\times n$ real symmetric polynomial matrices and of ${m\times n}$ real matrices, respectively, whose entries are polynomials of $x$ with real coefficients. Given a matrix $A$,  $\langle A \rangle$ denotes $A+A^T$. Finally, we let 
 $\sos{x}$ denote the set of SOS polynomials of $x$. 
% $\mathcal{L}_\infty$ %($\mathcal{L}_\infty^{[a,b]}$) 
% denotes the set of signals %(whose dimensions can be deduced from the context)  
% with finite amplitude on $[0,\infty)$.%(on $[a,b]$).  
%The space $\mathcal{L}_{\infty e}$ is the set of signals on $[0,\infty)$ which, truncated to any finite interval $[a,b]$, are in $\mathcal{L}_\infty^{[a,b]}$. 
}

 






\section{Preliminaries}\label{sec:preliminaries}
Consider a nonlinear parameter-varying (NPV) system 
\begin{equation}\label{eq:dynamics}
    \dot{x} = f(x,\theta)+g(x,\theta)u, %\quad x(0)=x_0,
\end{equation}
where $x(t)\in \mbR^{n}$, $u(t) \in \mbR^m$, $\theta(t)\in\mbR^{n_\theta}$ is the vector of parameters that can be time-varying and measurable online, and $f:\mbR^n\times \mbR^\ntheta\ \rightarrow \mbR^n$ and  $g:\mbR^n\times
\mbR^\ntheta \rightarrow \mbR^{n\times m}$ are locally Lipschitz in $\theta$ and $x$.   As an example, $\theta(t)$ could represent the payload and propeller control effectiveness of a delivery drone, the friction coefficient of a ground vehicle, the propellant mass of a spacecraft or a rocket, or the disturbance forces applied to an aircraft. 
\begin{remark} Unlike existing NPV work \cite{
fu2018hinf-npv,fu2019exponential-npv,lu2020domain-npv,yu2024hinf-npv},  
    we do not require $\dot \theta$ to be online measurable. This makes our solution more practical as in the real world it is often challenging to obtain $\dot \theta$.  
\end{remark}
\begin{assumption} \label{assump:theta-thetadot-range}
The parameters and their derivatives satisfy
\begin{equation}\label{eq:theta-thetadot-constrs}
   \theta(t) \in \Theta \textup{ and } \thetadot(t)\in \mcV,~\forall t\geq 0, 
\end{equation}
 where $\Theta$ is a semi-algebraic set defined by a finite number of polynomials $h_i(\theta)$ as $\Theta\trieq \{\theta\in\mbR^\ntheta: h_i(\theta)\geq 0, i\in \mbz{\Ntheta}\}$,~and $\mcV$ is a hyper-rectangular set defined by $\mcV \trieq \{ v\in\mbR^\ntheta: \ubar v_i\leq  v_i\leq \bar v_i, i\in\mbz{\ntheta}\}$. %Further, the value of $\theta$ is available for feedback  use in real time  through measurement or estimation 
    %a finite number of points $\thetadot^i$ as $\mcV = \textup{ConvexHull}(\thetadot^1,\dots, \thetadot^{n})$. 
\end{assumption}For ease of exposition, we denote the set of admissible trajectories of $\theta$ satisfying \cref{eq:theta-thetadot-constrs} as
\begin{equation}\label{eq:F-Theta-mcV-defn}
 \mcF_\Theta^\mcV\trieq \left\{\theta:\mbR^+\rightarrow \mbR^\ntheta| \theta(t) \in \Theta, \dot\theta(t)\in \mcV,\ \forall t\geq 0\right\}
\end{equation}
For brevity, we often omit the dependence of variables and functions on $t$ hereafter. 

Without loss of generality, we assume the equilibrium point of \cref{eq:dynamics} is $x=u=\bzero$, which indicates that $f(0,\theta)=0$ for all admissible trajectoreis of $\theta$.

% \red{We consider local verification and synthesis as input limits typically make global stabilization unlikely. Additionally, local synthesis can give better performance than global synthesis.}
% \begin{definition}
%    A continuously differentiable function $V(x,\theta)$ is an exponential PD-CLF if it satisfies the following conditions for some positive constants $k_1$, $k_2$, $k_3$, and $\rho$,
% \begin{subequations}\label{eq:clf-cond}
%     \begin{align}
%    \hspace{-8mm}     k_1  &\norm{x}^2 \!\leq\! V(x,\theta) \!  \leq \! k_2\norm{x}^2\!,~ \forall \theta\in\Theta,\ x\in\mcX%, (x,\theta) \textup{ s.t. } V(x,\theta)\leq \rho
%      \label{eq:clf-cond-V-bnd}   \\
%  \hspace{-8mm}      \textup{If}~ &  \theta\in\Theta,~\thetadot\in \mcV, \textup{ and } V(x,\theta)\leq \rho, %\textup{, and } x \neq 0, 
%  \textup{ then } x\in\mcX,  \label{eq:clf-cond-V<=rho-indicates-x-in-X}  \\
%     &  \textup{ and } \exists u\in \mcU \textup{ s.t.}  \nonumber \\     
%   &   \underbrace{ L_f V + L_g Vu + \frac{\partial V}{\partial \theta }\thetadot}_{\trieq \dot V(x,\theta,\thetadot,u)} \leq -k_3 \norm{x}^2 \label{eq:clf-cond-derivative}
%     \end{align}
% \end{subequations} 
% \end{definition}

% \begin{definition}
%     Given a control law $u(x,\theta)$, the closed loop system $\dot{x} = f(x,\theta)+g(x,\theta)u(x,\theta) $ is  uniformly asymptotically stable (UAS) if there exist a class $\mcK\mcL$ function $\beta$ and a positive constant $c$, independent of $t_0$, such that 
%     \begin{equation}
%        \norm{x(t)} \leq \beta \left(\norm{x(t_0)}, t-t_0\right), \   \forall t\geq t_0 \geq 0, \ \forall \norm{x(t_0)}< c. 
%     \end{equation}   
% \end{definition}


\section{Parameter-Dependent CLFs for Stabilizing NPV Systems}\label{sec:pd-clf}
\begin{definition}
The equilibrium point $x=0$  of system \cref{eq:dynamics} is uniformly asymptotically stabilizable if there exists an admissible controller $u(x,\theta)$ that is locally Lipschitz %in $\mbR^n\setminus\{0\} \times \Theta$ and continuous everywhere 
such that the closed loop system $ \dot{x} = f(x,\theta)+g(x,\theta)u(x,\theta)$ is uniformly asymptotically stable (UAS), i.e., there exist a class $\mcK\mcL$ function $\beta$ and a positive constant $c$, independent of $t_0$, such that 
    \begin{equation}
   \hspace{-3mm}    \norm{x(t)} \! \leq \! \beta \left(\norm{x(t_0)}, t\!-\!t_0\right), \   \forall t\geq t_0 \geq 0, \ \forall \norm{x(t_0)}\!<\! c. 
    \end{equation}
\end{definition}



\begin{definition}\label{def:pd-clf}
   A continuously differentiable function $V(x,\theta)$ is a PD-CLF for \cref{eq:dynamics} if there exist continuous positive definite functions $\alpha_1$, $\alpha_2$, and  $\alpha$ such that the following conditions hold:   
\begin{subequations}\label{eq:clf-cond}
% \setlength{\mathindent}{0pt}
    \begin{align}
   &   \alpha_1(\norm{x}) \leq V(x,\theta)  \leq \alpha_2(\norm{x}),\  \forall \theta \in \Theta, % (x,\theta) \textup{ s.t. } V(x,\theta)\leq \rho
     \label{eq:clf-cond-V-bnd}   \\
  % \hspace{-8mm} & \forall (x,\theta)\in \Omega(V,\rho) ,~\thetadot\in \mcV, \quad  \exists u\in \mcU \textup{ s.t.}  \nonumber \\     
 &  \inf_{u} { L_f V + L_g V u +  \frac{\partial V}{\partial \theta }\thetadot} \leq -\alpha( \norm{x}) ,\ (\theta,\dot \theta)\in \Theta \!\times\! \mcV, \label{eq:clf-cond-derivative} %\\
  % \hspace{-8mm}    &  
   % \label{eq:clf-cond-V<=rho-indicates-x-in-X}  \\ 
       \vspace{-10mm}
    \end{align}
\end{subequations} 
where $L_fV= \frac{\partial V}{\partial x}f$ and $L_gV= L_g V$.
\end{definition}
A geometric illustration of a PD-CLF is given in \cref{fig:pd-clf-illustration}.
\begin{figure}
    \centering
    \includegraphics[width=0.4\columnwidth]{fig/pd-clf-illustration.pdf}
    \caption{Geometric illustration of a PD-CLF $V(x,\theta)$ for a one-dimensional system with a single parameter ($n=n_\theta=1$ ) in the $x$-$\theta$ plane and an exemplary trajectory of $(x(t),\theta(t),V(t))$ (denoted by the red line) under stabilizing inputs generated by $V$. Notice that the trajectory will eventually approach the $\theta$-axis (corresponding to $x=0$) and stay there regardless of the trajectory of $\theta$. }
    \label{fig:pd-clf-illustration}
    \vspace{-5mm}
\end{figure}

\subsection{Constructing min-norm control law via robust quadratic programs}
Given a valid PD-CLF, at each time $t$, given  $\theta(t)$, $\theta(t)$, $\thetadot(t)$, we can consider all control inputs that satisfy \cref{eq:clf-cond-derivative}:
% \begin{multline}\label{eq:K-pdclf-0}
%    K^0_\textup{pd-clf}(x,\theta,\thetadot) \\  \hspace{-3mm} = \left\{u\in \mbR^m:  L_f V + L_g V u +  \frac{\partial V}{\partial \theta }\thetadot \leq -\alpha(\norm{x})\right\} 
% \end{multline}
However, due to the dependence on $\dot\theta$, direct use of \cref{eq:clf-cond-derivative} will lead to a control law dependent on $\dot \theta$ that is not accessible online.  To address this issue, noticing that \cref{eq:clf-cond-derivative} is affine w.r.t. $\dot \theta$, we derive an equivalent condition for \cref{eq:clf-cond-derivative}:
\begin{equation}\label{eq:clf-cond-derivative-sufficient}
\inf_{u}{ L_f V \!+ \!L_g Vu \! +\! \frac{\partial V}{\partial \theta }v } %\underbrace _{\dot V(x,\theta,v,u)} 
\leq -\alpha(\norm{x}),\ \forall (\theta,v) \in \Theta\times\ver{\mcV}, 
\end{equation}
where $\mcV$ is the hyper-rectangular set of admissible $\dot\theta$ values and $\ver{\mcV}$ denote the set of vertices of $\mcV$. As a result, we can construct the control law as
\begin{equation}\label{eq:K-pdclf}
   K_\textup{pd-clf}(x,\theta)  = \! \left\{u \!\in \!\mbR^m\! :  L_f V \!+\! L_g V u\! + \! \frac{\partial V}{\partial \theta }v \!\leq\! -\alpha(\norm{x}), \ \forall v  \!\in  \!\ver{\mcV}\right\}  \!\!
\end{equation}
% For time-invariant systems, given a valid CLF, Sontag's formula \cite{sontag1989universal}  and  the min-norm control \cite{freeman1996inverse-clf} provide two possible ways to construct one stabilizing control law. For the PD-CLF considered here, Sontag's formula cannot be utilized anymore as condition \cref{eq:clf-cond-derivative} depends on  $\dot \theta$ that is not online accessible. To address this issue, considering that \cref{eq:clf-cond-derivative} is affine w.r.t. $\dot \theta$, for online control signal construction, we could 
% \begin{equation}\label{eq:clf-cond-derivative-sufficient}
% \inf_{u}{ L_f V \!+ \!L_g Vu \! +\! \frac{\partial V}{\partial \theta }v } %\underbrace _{\dot V(x,\theta,v,u)} 
% \leq -\alpha(\norm{x}),\ \forall (\theta,v) \in \Theta\times\ver{\mcV}, 
% \end{equation}
% where $\mcV$ is the hyper-rectangular set of admissible $\dot\theta$ values and $\ver{\mcV}$ denote the set of vertices of $\mcV$.

%However, Sontag's formula cannot be applied here as the resulting control law will depend on $\dot \theta$ (due to its existence in the derivative condition \cref{eq:clf-cond-derivative}), which is not accessible.  %Given a valid PD-CLF, any control law $u$ that satisfies the Lyapunov derivative condition \cref{eq:clf-cond-derivative} will uniformly asymptotically stabilize the system to the origin. This is similar to the standard CLF case \cite{ames2019cbf-tutorial}, where the control input can be determined by solving a quadratic programming (QP) problem subject to a Lyapunov derivative condition. 
%However, the challenge here is that the condition \cref{eq:clf-cond-derivative} depends on $\dot\theta$, which is {\it not accessible} in real time. 
In particular, we can determine the min-norm control law \cite{freeman1996inverse-clf} by solving a robust QP problem with the constraint \cref{eq:clf-cond-derivative-sufficient} at each time instant $t$: 
\begin{subequations}\label{eq:min-norm-formulation}
  \begin{align}
 &u^\ast(x,\theta) = \min_{u}\  \norm{u}^2 \\
    \textup{s.t. } & L_f V\!+ \!L_g Vu \!+\! \frac{\partial V}{\partial \theta }v 
\leq -\alpha(\norm{x}), \ \forall v \in \textup{ver}(\mcV).   \label{eq:min-norm-formulation-b}
     \end{align}
\end{subequations}
The following lemma establishes the local Lipschitz continuity of the control law obtained by solving \cref{eq:min-norm-formulation}.

\begin{lemma}\label{lemma:qp-control-local-lipschitz}
If $V(x,\theta)$ is a PD-CLF according to \cref{def:pd-clf} and both $\frac{\partial V}{\partial x}$ and $\alpha$ are locally Lipschitz, then the control law $u^*(x,\theta)$ from solving \cref{eq:min-norm-formulation} is locally Lipschitz.     
\end{lemma}
\begin{proof}
    Condition \cref{eq:min-norm-formulation-b} can be rewritten as 
    \begin{equation}\label{eq:clf-deriv-cond-linear-form}
        A(\zeta)^T u \leq c(\zeta) = \min_{i\in |\ver{\mcV}|} b_i(\zeta),
    \end{equation}
  where $\zeta = [x^T, \theta^T]^T$, $A(\zeta) = \left(L_g V \right)^T$, $b_i(\zeta) = - L_f V  -\frac{\partial V}{\partial \theta }v^i-\alpha(\norm{x})$ with $v^i \in \ver{\mcV}$, and  $|\ver{\mcV}|= 2^{n_\theta}$ is the number of vertices of $\mcV$.  
As a result, \cref{eq:min-norm-formulation} can be written as 
\begin{equation}\label{eq:min-norm-formulation-linear-form}
 u^*(\zeta)  = \min_{u}  \norm{u}^2 \quad 
   \textup{s.t. }   A(\zeta)^T u \leq c(\zeta)   
 \end{equation}
The solution for \cref{eq:min-norm-formulation-linear-form} is  given by \cite{freeman1996inverse-clf,ames2016cbf-tac}
\begin{equation}\label{eq:u-zeta-solution}
u^*(\zeta)
\;=\;
\begin{cases}
0, 
   & \text{if } c(\zeta)\ge 0,\\[6pt]
\dfrac{c(\zeta)}{\|A(\zeta)\|^2}\,A(\zeta),
   & \text{if } c(\zeta)< 0.
\end{cases}    
\end{equation}
Note that \cref{eq:clf-cond-derivative-sufficient} indicates that 
\begin{equation}\label{eq:A=0-indicates-c>=0}
    A(\zeta) = 0 \Rightarrow c(\zeta)\geq 0
\end{equation}
As a result, the expression for the case of $c(\zeta)< 0$ in  \cref{eq:u-zeta-solution} is always well defined. 

We next verify that $u^*(\zeta)$ is locally Lipschitz in $\zeta$:

\begin{itemize}
\item \emph{Case $c(\zeta)\ge0$.}
Here $u^*(\zeta)=0$ is a constant function, which is trivially (globally) Lipschitz.

\item \emph{Case $c(\zeta)<0$.} 
Since $A(\zeta)\neq 0$ in this region, $\|A(\zeta)\|\ge \beta>0$ for some local bound $\beta>0$ (by continuity). 
Since the product of locally Lipschiz functions is locally Lipschitz, the maps $\zeta \mapsto A(\zeta)$ and $\zeta \mapsto b_i(\zeta)$ for ${i\in |\ver{\mcV}|}$ are locally Lipschitz. Consequently, $\zeta \mapsto 1/\|A(\zeta)\|^2$ is also locally Lipschitz.  Further considering the fact that the minimum (or maximum) of finitely many Lipschitz functions is still Lipschitz, the map $\zeta \mapsto c(\zeta)$ is also locally Lipschitz. Hence $u^*(\zeta)$ is locally Lipschitz in any neighborhood where $c(\zeta)<0$.

\item \emph{Boundary $c(\zeta)=0$.}
As $c(\zeta)\to 0^-$, $u^*(\zeta) = \frac{c(\zeta)}{\|A(\zeta)\|^2}A(\zeta)\to 0$, matching the solution on the $c(\zeta)\ge0$ side.  Thus there is no jump discontinuity.  Being piecewise linear in $\zeta$ (through the Lipschitz data) and continuous across the boundary, $u^*(\zeta)$ remains locally Lipschitz.
\end{itemize}
\end{proof}
\begin{remark}
In \cite{ames2016cbf-tac}, the authors prove the local Lipschitz continuity of their QP-based controller, which unifies control Lyapunov functions (CLFs) and control barrier functions (CBFs) for  nonlinear time-invariant systems, under the stronger assumption that 
$\frac{\partial V}{\partial x}\neq 0$  everywhere in the region of interest. By contrast, \cref{lemma:qp-control-local-lipschitz} establishes the local Lipschitz continuity without that condition and even for NPV systems.
% In \cite{ames2016cbf-tac}, the authors establish the local Lipschitz continuity of their QP-based controller that unifies CLF and CBF  for time-invariant nonlinear systems by imposing stronger conditions that $\frac{\partial V}{\partial x}\neq 0$ for all $x$ in regions of interest. Here, \cref{lemma:qp-control-local-lipschitz} establishes the local Lipszhitz continuity without this condition, even for parameter-varying nonlinear systems.  
\end{remark}


\begin{lemma}
   Given an NPV system \cref{eq:dynamics} satisfying \cref{assump:theta-thetadot-range}, if there exists a PD-CLF $V(x,\theta)$ with locally Lipschitz $\frac{\partial V(x,\theta)}{\partial x}$ and $\alpha(\norm{x})$,  then system \cref{eq:dynamics} can be uniformly asymptotically stabilized.    
\end{lemma}
\begin{proof}
  Consider the control law from solving problem \cref{eq:min-norm-formulation}.  Due to the condition \cref{eq:clf-cond-derivative} satisfied by $V(x,\theta)$, and the equivalency between \cref{eq:clf-cond-derivative} and \cref{eq:clf-cond-derivative-sufficient}, problem \cref{eq:min-norm-formulation} is always feasible.  According to \cref{lemma:qp-control-local-lipschitz}, the min-norm control law in \cref{eq:min-norm-formulation} is locally Lipschitz. Considering the closed-loop dynamics under this control law, and \cref{assump:theta-thetadot-range}, we have 
\begin{equation}\label{eq:lyapunov-nonauto-1}
    \dot V =  L_f V + L_g V u +  \frac{\partial V}{\partial \theta }\thetadot\leq -\alpha( \norm{x}),\quad  \forall t\geq0, \forall x.
\end{equation}
Additionally, \cref{eq:clf-cond-V-bnd} indicates that  
\begin{equation}\label{eq:lyapunov-nonauto-2}
    \alpha_1(\norm{x}) \leq V(x(t),\theta(t))  \leq \alpha_2(\norm{x}),\quad  \forall t\geq0, \forall x.
\end{equation}
By applying Lyapunov stability theory for non-autonomous theorem (\cite[Theorem~4.8]{khalil2002nonlinear-book}) to \cref{eq:lyapunov-nonauto-1,eq:lyapunov-nonauto-2}, we conclude that the closed-loop system under the control law in \cref{eq:min-norm-formulation} is uniformly asymptotically stable.   
\end{proof}

\subsection{Robustness of min-norm control law against input gain uncertainty}\label{sec:robustness}
An advantage of the min-norm control law in \cref{eq:min-norm-formulation} is that it is inherently robust against uncertainty in the input gain.  Suppose the original system \cref{eq:dynamics} is perturbed in a way such that the control $u$ is multiplied by a positive gain $\lambda$, i.e., the perturbed system takes the form $\dot x = f(x) + g(x) \lambda u$. Then, the min-norm control law constructed using the nominal dynamics will uniformly asymptotically stabilize the perturbed system for all $\lambda>1$; that is, the closed-loop system with the min-norm control law has an infinite gain margin. This observation is formalized in the following lemma. 
\begin{lemma}\label{lemma:min-norm-robustness}
Suppose $V(x,\theta)$ is a PD-CLF for the system \cref{eq:dynamics}. Then, under the min-norm control law \cref{eq:min-norm-formulation} computed using the nominal dynamics of \cref{eq:dynamics}, the origin of the perturbed system $\dot x = f(x,\theta) + g(x,\theta) \lambda u$ for all $\lambda>0$ is uniformly asymptotically stable for all admissible trajectories of $\theta$. 
\end{lemma}
\begin{proof}
     Note that the CLF derivative condition \cref{eq:min-norm-formulation-b} can be rewritten as \cref{eq:min-norm-formulation-linear-form}, repeated below:
     \begin{equation}\label{eq:clf-deriv-cond-linear-form-2}
        A(\zeta)^T u \leq c(\zeta) ,
    \end{equation}
  Now consider the condition
    \begin{equation}\label{eq:clf-deriv-cond-linear-form-perturb}
        A(\zeta)^T \lambda u \leq c(\zeta) ,
    \end{equation}
  If $c(\zeta)\geq 0$, from \cref{eq:u-zeta-solution}, we know that the solution for \cref{eq:min-norm-formulation} is $u^* = 0$, which obviously also satisfy \cref{eq:clf-deriv-cond-linear-form-perturb}. \\  
  If $c(\zeta)< 0$, then $A(\zeta)^T u \leq c(\zeta)<0$, which indicates that $A(\zeta)^T \lambda u \leq A(\zeta)^T u \leq c(\zeta)<0$ for all $\lambda\geq 1$.  
  Notice that \cref{eq:clf-deriv-cond-linear-form-perturb} is an equivalent reformulation of 
  \begin{equation}\label{eq:clf-deriv-cond-perturb}
      L_f V \!+\! L_g V (\lambda u)\! + \! \frac{\partial V}{\partial \theta }v \!\leq\! -\alpha(\norm{x})
  \end{equation}
 % As a result, $V(x,\theta)$ is a PD-CLF for the perturbed system \cref{eq:clf-deriv-cond-linear-form-perturb} for all $\lambda\geq 1$. 
Additionally, \cref{eq:clf-cond-V-bnd} indicates that \cref{eq:lyapunov-nonauto-2}. By applying Lyapunov stability theory for non-autonomous theorem (\cite[Theorem~4.8]{khalil2002nonlinear-book}) to \cref{eq:lyapunov-nonauto-1,eq:lyapunov-nonauto-2}, we conclude that the perturbed system under the control law in \cref{eq:min-norm-formulation} is uniformly asymptotically stable.   
\end{proof}



\subsection{Local analysis and PD region of stabilization} \label{sec:pd-clf-local-analysis}
We now consider local stabilizability ensured by a PD-CLF. % To make the problem more practically meaningful, we also consider input constraints: 
%\begin{equation}
   % $u(t)\in \mcU\subseteq \mbR^m$,
% \end{equation}
%where $\mcU$ denotes the set of admissible inputs and is assumed to be a polytopic set.
%defined by a finite number of points $u^i$: \begin{equation}\label{eq:input-cst-set-U}
%     \mcU = \textup{ConvexHull}(u^1,\dots, u^M). 
% \end{equation}  


\begin{definition}\label{def:pd-clf-local}
  A continuously differentiable function $V(x,\theta)$ is a local PD-CLF for \cref{eq:dynamics}  if there exist continuous positive definite functions $\alpha_1$, $\alpha_2$, and  $\alpha$  such that the following conditions hold:  
% \begin{subequations}\label{eq:clf-cond}
% % \setlength{\mathindent}{0pt}
%     \begin{align}
%      &   \hspace{-5mm}  \alpha_1(\norm{x}) \leq V(x,\theta)  \leq \alpha_2(\norm{x}),~ \forall (x,\theta)\in \Omega(V,\rho), % (x,\theta) \textup{ s.t. } V(x,\theta)\leq \rho
%      \label{eq:clf-cond-V-bnd-local}   \\
%    &  \hspace{-5mm} \forall (x,\theta)\in \Omega(V,\rho) ,~\thetadot\in \mcV, \quad  \exists u\in \mcU \textup{ s.t.}  \nonumber \\     
%   &  \hspace{3mm} \underbrace{ \frac{\partial V}{\partial x}f + \frac{\partial V}{\partial x}gu + \frac{\partial V}{\partial \theta }\thetadot}_{\trieq \dot V(x,\theta,\thetadot,u)} \leq -\alpha(\norm{x}),\label{eq:clf-cond-derivative} %\\
%   % \hspace{-8mm}    &  
%    % \label{eq:clf-cond-V<=rho-indicates-x-in-X}  \\ 
%        \vspace{-8mm}
%     \end{align}
% \end{subequations} 

\begin{subequations}\label{eq:clf-cond-local}
% \setlength{\mathindent}{0pt}
    \vspace{-4mm}
    \begin{align}
     &   \hspace{-5mm}  \alpha_1(\norm{x}) \leq V(x,\theta)  \leq \alpha_2(\norm{x}),~ \forall (x,\theta)\in \mcX \times \Theta, % (x,\theta) \textup{ s.t. } V(x,\theta)\leq \rho
     \label{eq:clf-cond-V-bnd-local}   \\
   &  \hspace{-5mm} 
   %\forall (x,\theta)\in \Omega(V,\rho),
   \forall (x,\theta,\thetadot)\in \mcX \times \Theta\times \mcV, \quad  \nonumber \\     
  &  \hspace{3mm} \inf_u \underbrace{ \frac{\partial V}{\partial x}f + \frac{\partial V}{\partial x}gu + \frac{\partial V}{\partial \theta }\thetadot}_{\trieq \dot V(x,\theta,\thetadot,u)} \leq -\alpha(\norm{x}),\label{eq:clf-cond-derivative-local} %\\
  % \hspace{-8mm}    &  
   % \label{eq:clf-cond-V<=rho-indicates-x-in-X}  \\ 
       \vspace{-8mm}
    \end{align}
\end{subequations} 
where $\mcX\subset\mbR^n$ is a compact set containing the origin in its interior. 
\end{definition}

\begin{definition}\label{def:pd-ros}
A PD region of stabilization (PD-ROS) for system \cref{eq:dynamics} is the set of initial states $x(0)$ and parameters $\theta(0)$ from which there exists a control law $K(x,\theta)$ such that $u(t)=K(x(t),\ \forall t\geq 0$, and 
%the closed-loop system is UAS. 
$\lim_{t\rightarrow 0} x(t) = 0$ 
for all admissible trajectories of $\theta$. Formally, a PD-ROS is a set defined by \\
% \begin{multline*}
$
% \hspace{-7mm}
\left\{(x(0),\theta(0)) \in \mbR^{n}\times \Theta\!:  \ \forall \theta \in \fThetaV,  \exists u(t)= K(x(t),\theta(t))\  \forall t\geq 0,   
%\textup{s.t. the CL system is UAS.}  
\textup{ s.t.}  \lim_{t\rightarrow 0} x(t) = 0.
\right\}
$
% \end{multline*}


%A set  a if it contains all points $(x^\star,\theta^\star)$  with $\theta^\star\in\Theta)$ $\forall~x(0)$, $\theta(0)$ s.t.  $(x(0),\theta(0))\in \Phi$, there exists $u(t)\in \mcU$ such that $\lim_{t\rightarrow 0} x(t) = 0$ for all admissible trajectories of $\theta$ satisfying \cref{eq:theta-thetadot-constrs}. 
\end{definition}

\begin{definition}\label{def:r-ros}
A robust region of stabilization (R-ROS) for system \cref{eq:dynamics} is the set of initial states $x(0)$  from which there exists a control law $K(x,\theta)$ such that $u(t) = K(x(t),\theta(t))$ $\forall t\geq 0$, and $\lim_{t\rightarrow 0} x(t) = 0$ for all admissible trajectories of $\theta$. Formally, an R-ROS is a set defined by \\
% \begin{multline*}
% \hspace{-8mm} 
$\left\{x(0) \in \!\mbR^{n}\!\!:  \ \forall \theta \in \fThetaV,\  \exists u(t)= K(x(t),\theta(t))\  \forall t\geq 0, 
%\textup{s.t. the CL system is UAS.}  
\textup{ s.t.}  \lim_{t\rightarrow 0} x(t) = 0.
\right\}$
% \end{multline*}


%A set  a if it contains all points $(x^\star,\theta^\star)$  with $\theta^\star\in\Theta)$ $\forall~x(0)$, $\theta(0)$ s.t.  $(x(0),\theta(0))\in \Phi$, there exists $u(t)\in \mcU$ such that $\lim_{t\rightarrow 0} x(t) = 0$ for all admissible trajectories of $\theta$ satisfying \cref{eq:theta-thetadot-constrs}. 
\end{definition}
\begin{remark}
    Compared to R-ROS, PD-ROS allows us to enlarge the set of states from which the system can be stabilized by explicitly considering $\theta(0)$, the initial value of $\theta$. This is demonstrated by \cref{fig:roa-pendulum} to be presented in \cref{sec:sim}. 
\end{remark}

For future use, we  define
   \begin{equation}\label{eq:Omega-rho-defn}
  % \hspace{-7mm}  
  \Omega(V,\rho)\! = \!\left \{(x,\theta)\in\mbRn \!\times\! \mbR^\ntheta: V(x,\theta)\leq \rho, \theta\in \Theta \right\},
\end{equation} 
%     \begin{equation}\label{eq:Omega-rho-defn}
%   \hspace{-7mm}  \Omega(V,\rho)\! = \!\left \{(x_0,\theta_0)\in\mbR^n \!\times\! \mbR^\ntheta: V(x_0,\theta_0)\leq \rho, \theta_0\in \Theta\right \}
% \end{equation} 
where $\rho$ is a positive constant.

\begin{lemma}\label{lem:omega-is-pd-ros}
   Supposing $V(x,\theta)$ is a local PD-CLF for \cref{eq:dynamics} as defined in \cref{def:pd-clf-local},  if $\rho$ is selected such that $\Omega(V,\rho)\subseteq \mcX\times\Theta$, then $\Omega(V,\rho)$ is a PD-ROS. 
\end{lemma}
% \begin{proof}
%     Condition \cref{eq:clf-cond-derivative} ensures that  if $(x(0),\theta(0))\in \Omega(V,\rho)$, then there exist $u(t)\in \mcU$ $\forall t\geq 0$ such that 
%     \begin{equation}
%          \dot V(t)\leq -k_3 \norm{x(t)}^2, \ \forall t\geq 0
%     \end{equation}
%    $\forall \theta \in\! \fThetaV$. As a result, $V(x(t),\theta(t))\leq V(x(0),\theta(0)\leq \rho$ $\forall t\geq 0$, which implies $x(t)\in \mcX$ $\forall t\geq 0$ due to \cref{eq:clf-cond-derivative}. By applying \cite[Theorem~4.10]{khalil2002nonlinear-book}, one can immediately conclude that the origin can be exponentially stabilized, and thus $\lim_{t\rightarrow 0} x(t) \!=\! 0$. Therefore, $\Omega(V,\rho)$ is a PD-ROS.
% \end{proof}
\begin{proof}
    Condition \cref{eq:clf-cond-derivative-local} ensures that  if $(x(0),\theta(0))\in \Omega(V,\rho)$, then there exist $u(t)$ such that 
    \begin{equation}
         \dot V(t)\leq -\alpha( \norm{x(t)}), \ \forall t\geq 0,
    \end{equation}
   $\forall \theta \in\! \fThetaV$. As a result, $V(x(t),\theta(t))\leq V(x(0),\theta(0)\leq \rho$, $\forall t\geq 0$, which implies $x(t)\in \mcX$, $\forall t\geq 0$. By applying \cite[Theorem~4.8]{khalil2002nonlinear-book}, one can immediately conclude that the origin can be uniformly asympotically stabilized, and thus $\lim_{t\rightarrow 0} x(t) \!=\! 0$. Therefore, $\Omega(V,\rho)$ is a PD-ROS.
\end{proof}

\section{Convex synthesis of PD-CLFs Using SOS Programming}
In this section, we consider the system in \cref{eq:dynamics} to have a polynomial form, i.e., $f(x,\theta)$ and $g(x,\theta)$ are polynomial functions. Furthermore, we assume that the nonlinear polynomial system can be rewritten in  
    a linear-like form \cite{prajna2004nonlinear-sos}:
\begin{equation}\label{eq:dynamics-linear-form}
    \dot x = A(x,\theta) x + B(x,\theta) u,
\end{equation}
where $A(x,\theta)\in \mbR^{n\times n}$ is a polynomial matrix, $B(x,\theta) = g(x,\theta)$. %and $z(x)\in \mbR^{N}$ is a vector of monomials such that $ z(x) = 0 \textup{ iff } x=0$. 
\begin{remark}
Note that a polynomial system \cref{eq:dynamics} can always be written in the form of \cref{eq:dynamics} if $f(x,\theta)$ does not contain terms independent of $x$, i.e., monomials of zero degrees in $x$. When $f(x,\theta)$ contains $x$-independent terms, state transformation may be leveraged to obtain a linear-like form, {as we will demonstrate in \cref{sec:rocket}}. 
\end{remark}  

We consider local synthesis, i.e., assuming $x\in\mcX$, where $\mcX$ is a set defined by 
\begin{align}
{\mcX} &\trieq  \{x\in\mbRn: |{C}_i(x)x)|\leq 1,\ i\in\mbZ_1^{n}\},  \label{eq:X-ubar-defn}\\
%,\forall j\in\mbZ_1^{n}
& = \{x\in\mbRn\!: c_i(x)\geq 0,\ i\in\mbZ_1^{n}\}, \label{eq:X-set-defn-npv}
\vspace{2mm}
\end{align}
where $C_i:\mbR^n\rightarrow\mbR^{1\times n}$ is a vector-valued polynomial function, and $c_i(x) = 1-x^TC_i^TC_i x$ is a polynomial function.
\subsection{Preliminaries about SOS optimization}
A polynomial $l(x)$ is an SOS if there exist polynomials $l_1(x),\dots,l_m(x)$
 such that $l(x) = \sum_{i=1}^{m}l_i^2(x)$. A polynomial $l(x)$ of degree $2d$ is an SOS iff there exists a {positive semidefinite (PSD)} matrix $Q$ such that $l(x)= y^T(x)Q  y(x)$, where $y(x)$ is a column vector whose entries are all monomials in $x$ with degree up to $d$ \cite{parrilo2000structured-sos}. 
 An SOS decomposition for a given $l(x)$ can be computed using semidefinite programming (SDP) (by searching for a PSD matrix $Q$) \cite{prajna2004nonlinear-sos}. %When a polynomial $l(x)$ is not exactly determined, but its coefficients are affinely parameterized in terms of some unknowns, the search for these unknowns which render $l(x)$ an SOS {can still be} performed via SDP. 
 Hereafter, we use $\sos{x}$ to denote the set of SOS polynomials in $x$ and $\sos{x,y}$ to denote the set of SOS polynomials in $x$ and $y$.  

% Consider a semi-algebraic set $\mcX$ that contains the origin, defined by  
% \begin{equation}\label{eq:X-set-defn-npv}
% % \hspace{-4mm}
% {\mcX}\trieq \{x\in\mbRn\!: c_i(x)\geq 0,\ i\in\mbZ_1^{n}\}. %,\forall j\in\mbZ_1^{n}
% \end{equation}

 \begin{proposition} \label{proposition:s-procedure} (S-procedure)  \cite{parrilo2000structured-sos}
 Let $p(x)$ be a a polynomial and  let $\mcX$ be a set defined in \cref{eq:X-set-defn-npv}. Suppose there exist SOS polynomials $\lambda_i(x)$, $i=0,1,\dots,n$ such that 
 $\left(1+\lambda_0(x)\right)p(x)- \sum_{i=1}^{n} \lambda_i(x) c_i(x) \in \sos{x}$. Then, $p(x)\geq 0 \textup{ for all } x\in\mcX$. 
 \end{proposition}
\begin{remark}
    In practice, $\lambda_0(x)$ is often selected to be 0.
\end{remark}
 

 \begin{proposition}\cite[Proposition~2]{prajna2004nonlinear-sos}\label{proposition:sos-psd}
 Let $F(x)$ be an $N\!\times\! N$ symmetric polynomial matrix of degree $2d$ in $x\!\in\!\mbR^n$. Then, $F(x)\!\geq \!0 
    \textup{ } \forall x\in\mbR^n$, if $v^T\!F(x)v\!\in\! \sos{x,v} , \textup{ where } v\!\in\! \mbR^N$. 
 \end{proposition}

 \begin{proposition}\cite[Proposition~10]{prajna2004nonlinear-sos}\label{proposition:sos-psd-local}
 Let $F(x)$ be an $N\times n$ symmetric polynomial matrix of degree $2d$ in $x\in\mbR^n$, $\mcX$ is a semialgebraic set defined in \cref{eq:X-set-defn-npv}, and  %let $\mcX$ be a set defined as $\mcX = \{x\in\mbR^n: h_i(x)\geq 0, \ i=1,\dots,s\}$, 
 $v\in \mbR^N$. Suppose there exist SOS polynomials $\lambda_i(x,v)$, $i=1,\dots,n$ %whose degree in $v$ is equal to two, 
 such that 
 $v^TF(x)v - \sum_{i=1}^n \lambda_i(x,v) c_i(x) \in \sos{x,v}$. Then, $F(x)\geq 0 \textup{ for all } x\in\mcX$. 
 \end{proposition}



\begin{comment}
\subsection{Verification of a PD-CLF Under Input Constraints via SOS Programming}
To verify that a function $V(x,\theta)$ is a PD-CLF, we need to verify that the condition \cref{eq:clf-cond} is satisfied.  Among the two sub-conditions in \cref{eq:clf-cond}, \cref{eq:clf-cond-derivative} is most challenging to verify using the SOS programming due to the ``$\exists$'' quantifier \cite{tedrake2024underactuated-robotics}. Inspired by \cite{dai2022convex-clf-cbf}, we will derive an equivalent condition for \cref{eq:clf-cond-derivative}  by using contraposition.  An equivalent contrapositive statement of condition \cref{eq:clf-cond-derivative} is 
\begin{align}
  \hspace{-3mm}   \textup{If } \theta\in\Theta,~\thetadot\in \mcV,~  \forall u\in\mcU,~
       \dot V(x,\theta,\thetadot,u) & > -k_3 \norm{x}^2,\textup{ then }  
     \nonumber  \\
    V(x,\rho) & > \rho. %\textup{ or } x=0. 
\label{eq:clf-cond-derivative-contrapos}
\end{align}
Since $\dot V$ is linear in $u$, $
       \dot V(x,\theta,\thetadot,u)  > -k_3 \norm{x}^2$ is equivalent to $
       \dot V(x,\theta,\thetadot,u^i)  > -k_3 \norm{x}^2,~ \forall i\in\mbz{N_u}$. 
       %~Also, $V(x,\rho) \red{\geq} \rho \textup{ or } x=0 $ is equivalent to $(V(x,\rho)- \rho) x^Tx\geq 0$.       
      Thus, \cref{eq:clf-cond-derivative} is equivalent to  
% \begin{align}
%    \hspace{-3mm}  \textup{If } \theta\in\Theta,~\thetadot\in \mcV,~
%        \dot V(x,\theta,\thetadot,u^i) & > -k_3 \norm{x}^2, \forall i=\onetoN{s},  
%      \nonumber  \\
%       \hspace{-3mm}    \textup{ then }    (V(x,\rho) -\rho) x^Tx\geq 0. 
% \label{eq:clf-cond-derivative-contrapos-2}
% \end{align}    
\begin{align}
   \hspace{-3mm}  \textup{If } \theta\in\Theta,~\thetadot\in \mcV,~
       \dot V(x,\theta,\thetadot,u^i) & > -k_3 \norm{x}^2, \forall i=\onetoN{s},  
     \nonumber  \\
      \hspace{-3mm}    \textup{ then }    (V(x,\rho) -\rho)>0. 
\label{eq:clf-cond-derivative-contrapos-2}
\end{align}       

Now we are ready to formulate an SOS problem to verify whether a given function is a PD-CLF. 
\begin{theorem}\label{them:pd-clf-sos-verification}
   Consider an NPV system \cref{eq:dynamics} with the parameters $\theta$ satisfying \cref{eq:theta-thetadot-constrs}, the input constraint set $\mcU$ defined in \cref{eq:input-cst-set-U}. Given a continuously differentiable polynomial function $V(x,\theta)$, suppose there exist positive constants $k_1$, $k_2$, $k_3$, $\alpha$, and $\rho$,  arbitrarily small positive constants $\epsilon_j$ ($j\in\mbz{N_u}$), 
    and SOS %$\lambda_0^1(x,\theta)$, $\lambda_0^2(x,\theta)$, 
    $\lambda_i^\kappa (x,\theta)$ ($i\in\mbz{\Ntheta}, \kappa=1,2$), $\lambda_i^3(x,\theta,\thetadot)$ ($i\in\mbz{\Ntheta}$), $\mu_j(x,\theta)$ ($j=1,2$),  $\sigma_j(x,\theta,\thetadot)$ ($j\in\mbz{N_u}$) and $\xi_k(x,\theta,\thetadot)$ ($k\in\mbz{\ntheta}$)
    such that
    {%\setlength{\mathindent}{0pt}
    \begin{subequations}\label{eq:clf-cond-sos}
        \begin{align}
&  V \!-\! k_1 \norm{x}^2 \!-  \!\sum_{i=1}^\Ntheta \lambda_i^1 h_i(\theta) -
\mu_1(\rho-V)
%\sum_{j=1}^{n} \mu_j^1 c_j(x)
\in\sos{x,\theta}, \label{eq:clf-cond-sos-1}  \\ % \!\lambda_0^1 (\rho\!-\!V)\!
& k_2 \norm{x}^2 \! - \! V \!-  \!\sum_{i=1}^\Ntheta \lambda_i^2 h_i(\theta) - \mu_2(\rho-V)
%\sum_{j=2}^{n} \mu_j^1 c_j(x) 
\in\sos{x,\theta}, \label{eq:clf-cond-sos-2}   \\ % \lambda_0^2 (\rho\!-\!V)\!  -
& V\!-\!\rho \!-\! \sum_{j=1}^m (\sigma
_j+\epsilon_j) \left (\dot V(x,\theta,\thetadot,u^j)+  k_3 \norm{x}^2 \right)  
\!-\! \sum_{i=1}^\Ntheta \lambda_i^3 h_i(\theta) \nonumber \\
& \hspace{1cm}\!- \!\sum_{k=1}^\ntheta \xi_k (\dot \theta_k\! -\! \ubar v_k)  (\bar v_k\!-\!\theta_k)\in\sos{x,
\theta,
\thetadot}. \label{eq:clf-cond-sos-3} 
% & V(x,\theta) - \rho - \sum_{i=1}^\Ntheta \gamma_j^i h_i(\theta) - \beta_j c_j(x), \forall j\in\mbz{n}
\end{align}
    \end{subequations}}
Then, $V(x,\theta)$ is an exponential PD-CLF and the set   $\Omega(V,\rho)$ defined in \cref{eq:Omega-rho-defn} is a PD stabilizing region.
\end{theorem}
\begin{proof}
Based on \cref{proposition:s-procedure} , conditions \cref{eq:clf-cond-sos-1,eq:clf-cond-sos-2} indicates that \cref{eq:clf-cond-V-bnd} holds. \cref{eq:clf-cond-sos-3} implies \cref{eq:clf-cond-derivative-contrapos-2} holds, and thus \cref{eq:clf-cond-derivative} holds as well. As a result, $V(x,\theta)$ is a PD-CLF according to \cref{def:pd-clf}. Applying \cref{lem:omega-is-pd-ros}, we conclude that the set $\Omega(V,\rho)$ is a PD-ROS. 
\end{proof}
Based on \cref{them:pd-clf-sos-verification},  to check whether a given $V(x,\theta)$ is a valid PD-CLF, one can first select $\rho$ and $k_3$, and then solve an SOS feasibility problem with constraints \cref{eq:clf-cond-sos}. Additionally, a bisection search for $\rho$ can be performed to maximize $\rho$, and therefore maximizing the PD-ROS $\Omega(V,\rho)$. 
\end{comment}


\subsection{Convex Synthesis of a PD-CLF and a PD Controller}
We present an SOS optimization-based method for the joint synthesis of a PD-CLF and a PD controller. The method is inspired by \cite{prajna2004nonlinear-sos,maier2010predictive-sos,zhao2023convex-cbf}.

 %Note that $\mcX$ can be equivalently expressed using polynomials as 
% \begin{equation}\label{eq:X-set-defn-npv}
% \hspace{-4mm}{\mcX}\trieq \{x\in\mbRn\!: c_i(x)\geq 0,\ i\in\mbZ_1^{n}\}, ~ c_i(x) = 1-x^TC_i^TC_i x. %,\forall j\in\mbZ_1^{n}
% \vspace{2mm}
% \end{equation}
% An illustration of different sets is given in \cref{fig:sets}. Similarly, we introduce an inner approximation of $\mcU$ as \\
%$ %\begin{equation}\label{eq:X-ubar-defn}$
% \ubar{\mcU}\trieq \{x\in\mbRn: |\tilde{D}_jz(x)|\leq 1,\ j\in\mbZ_1^m\}, %,\forall j\in\mbZ_1^{n}
% $ where $D_j\in\mbR^{1\times m}$.
\begin{comment}
\begin{remark}
    % \cref{eq:X-ubar-defn} is quite expressive and can represent or inner-approximate commonly seen geometric sets.
{Definition~ \cref{eq:X-ubar-defn} captures a wide range of commonly
seen geometric sets.} For instance, the constraint $|x_i|\leq a_i$ ($a_i>0$) for defining a hypercube  can be represented as $ |{C_i(x)} {x}|\leq 1$ with $C_i(x) = {1}/{a_i}{\bf{1}}_i$ and ${\bf{1}}_i$ being a vector of appropriate dimension with all zero elements except the $i$th one equal to 1. An ellipsoid constraint $ x^TP x \leq 1 $  can be represented as  $ \abs{C_i(x)x}$ with  $C_i(x) = x^TP$. Note that $\mcX$ can be equivalently expressed using polynomials as 
\begin{equation}\label{eq:X-set-defn-npv}
\hspace{-4mm}{\mcX}\trieq \{x\in\mbRn\!: c_i(x)\geq 0,\ i\in\mbZ_1^{n}\}, ~ c_i(x) = 1-x^TC_i^TC_i x. %,\forall j\in\mbZ_1^{n}
\vspace{2mm}
\end{equation}



%$ |\underbrace{x^TP}_{C_i(x)} \underbrace{x}_{z(x)}|\leq 1$.
\end{remark}


% \begin{equation}\la bel{assump:Zx}
%     z(x) = 0 \textup{ iff } x=0.
% \end{equation}

\end{comment}


 

%We define $M(x)$ to be an $N\times n$ polynomial matrix  whose $(i,j)$-th entry is given by $M_{ij} = \frac{\partial z_i}{\partial x_j}(x)$.
Let $A_j(x,\theta)$ denote the $j$-th row of $A(x,\theta)$, $J=\left\{j_1,j_2,\dots, j_m\right\}$ denote the row indices of $g(x,\theta)$ whose corresponding row is equal to zero, and define $$\tilde x =(x_{j_1}, x_{j_2},\dots, x_{j_m}),$$ {which includes all the states whose derivatives are not directly affected by control inputs.}
%Hereafter, we use $D_j$, $C_i$ and $C_i(x)$ to denote the $i$th row of $D$, the $j$th row of $C$ and the $j$th row of $c(x)$, respectively.
% \begin{remark}
%     The linear-like representation \cref{eq:dynamics-linear-form} will be used in \cref{sec:init-linear-like} for synthesizing an initial CBF for \cref{eq:dynamics} to ensure the state constraints \cref{eq:state-cst}.
% \end{remark}



The result is summarized in the following theorem.
\begin{theorem}\label{them:npv-synthesis-sos}
Consider an NPV system \cref{eq:dynamics-linear-form} with the parameters $\theta$ satisfying \cref{eq:theta-thetadot-constrs}, %the input constraint set $\ubar\mcU$ defined in \cref{eq:input-cst-set-Ubar}, 
and the set $\mcX$ defined in \cref{eq:X-set-defn-npv}. Suppose there exists polynomial matrices $X(\tilde x, \theta)\in \mcS^n$ and $Y(x,\theta)\in \mbR^{m\times n}$, constants $\varepsilon_i>0$ ($i=1,2,3$), and SOS polynomials 
    $\lambda_i^l$ ($i\in\mbz{\Ntheta}, l\in\mbz{4}$), $\alpha_i^j ~(i\in\mbz{\Ntheta},j\in\mbz{n})$,  
    $\mu_j^p$ ($j\in\mbz{n}, p\in\mbz{3}$)
    and $\xi_k$ ($k\in\mbz{\ntheta}$)     
    such that 
    \begin{subequations}\label{eq:joint-syn-sos}
    \begin{align}
& v_1^T\left(X(\tilde x,\theta)-\varepsilon_1 I\right) v_1 - \sum_{i=1}^\Ntheta \lambda_i^1 h_i(\theta) -\! \sum_{j=1}^{n} \mu_j^1 c_j(x)  \in \sos{x,\theta,v_1}
\label{eq:joint-syn-sos-1} \\
& v_1^T\left(\varepsilon_2 I - X(\tilde x,\theta)\right) v_1 - \sum_{i=1}^\Ntheta \lambda_i^2 h_i(\theta)  -\! \sum_{j=1}^{n} \mu_j^2 c_j(x)  \in \sos{ x,\theta,v_1} \label{eq:joint-syn-sos-2}\\
  &  - v_1^T\!\left( F_1(x,\theta,\thetadot)
   +\varepsilon_3I \right) v_1 - %\sum_{j=1}^{n} \mu_j \phi_j(x) -  
   \sum_{i=1}^\Ntheta \lambda_i^3 h_i(\theta)  -\! \sum_{j=1}^{n} \mu_j^3 c_j(x) - \!\sum_{k=1}^\ntheta \xi_k (\dot \theta_k\! -\! \ubar v_k)  (\bar v_k\!-\!\dot \theta_k) \in \sos{x,\theta,\thetadot,v_1}, \label{eq:joint-syn-sos-3} \\
& 
{\setlength{\arraycolsep}{2pt}
v_2^T \!\begin{bmatrix}
1 & {C_j} X(\tilx,\theta)\\
* & X(\tilx,\theta)    \end{bmatrix}}v_2\!- \!\sum_{i=1}^\Ntheta \alpha_i^j h_i(\theta) %- \! \sum_{j=1}^{n} \beta_j^i c_j(x) \nonumber \\ & \hspace{3.5cm}
\!\in\! \sos{x,\theta,v_2},\ \forall j\in \mbZ_1^{n}\!, \label{eq:joint-syn-sos-state-cst}
\end{align}  
\end{subequations}
where 
\begin{equation}\label{eq:F1-defn}
    F_1(x,\theta,\thetadot) = \sym{AX\!+\!BY}-\! \sum\limits_{j \in J} \frac{\partial X}{\partial x_j} \left( {{A_j}x}\right) \!- \!\sum_{k=1}^\ntheta \frac{\partial X}{\partial \theta_k} \dot \theta_k, 
\end{equation} and $v_1,~v_2,$ and $v_3$ are vectors of proper dimensions. 
Then,
\begin{enumerate}[label=(\alph*) ]
    \item the controller 
\begin{equation}\label{eq:control-law-Y-X}
     u(x,\theta) = Y(x,\theta)X^{-1}(\tilde x,\theta)x
\end{equation}
renders the closed-loop system exponentially stable (GES) %in the absence of input constraints 
for all admissible trajectories of $\theta$ satisfying \cref{eq:theta-thetadot-constrs}. Moreover, 
\begin{equation}\label{eq:V-defn-w-X}
    V(x,\theta) = x^T X^{-1}(\tilde x,\theta)x
\end{equation}
is a PD Lyapunov function to certify such stability. 
\item The set $\Omega(V,1) = \{(x,\theta)\in\mbR^{n} \times \mbR^{\ntheta}: V(x,\theta)\leq 1, \theta\in \Theta\}$ is a subset of a PD region of attraction, i.e., $\forall(x(0),\theta(0))\in \Omega(V,1)$,  $\lim_{t\rightarrow 0} x(t) = 0$ for all admissible trajectories of $\theta$ satisfying \cref{eq:theta-thetadot-constrs}.  
\begin{comment}
\item Suppose, additionally, there exist SOS polynomials $\beta_i^q$ $(i\in\mbz{N_\theta},q\in\mbz{m})$ and $\gamma_j^q$ $(j\in\mbz{n}, q\in\mbz{m})$ such that the following condition holds: 
\begin{multline}
v_2^T  {\setlength{\arraycolsep}{2pt}
\footnotesize \begin{bmatrix}
1 & D_j Y \\
* & X(\tilx,\theta)
    \end{bmatrix}} v_2 - \sum_{j=1}^{n} \gamma_j^q c_j(x) - \!\sum_{i=1}^\Ntheta \beta_i^q h_i(\theta) \\
     \in \sos{x,\theta,v_2} \ \forall q\in \mbZ_1^m. \!\label{eq:joint-syn-sos-input-cst}  
\end{multline}Then, $\forall (x(0),\theta(0))\in \Omega(V,1),\ \theta\in\fThetaV,$
    \begin{equation}\label{eq:ut-in-U-always}
        ~u(t)\in \ubar \mcU,~\forall t\geq 0. 
    \end{equation}
\end{comment}
\end{enumerate}
\end{theorem}

\begin{proof} 
{\it Part (a)}: 
 According to \cref{proposition:sos-psd-local}, \cref{eq:joint-syn-sos-1,eq:joint-syn-sos-2} ensures  
 \begin{equation}\label{eq:X-bnd-epsilon12}
     \varepsilon_1 I \leq  X(\tilde x,\theta)\leq \varepsilon_2I,\ \forall \theta\in\Theta,\  x\in \mcX,
 \end{equation}
 which implies 
 \begin{equation}\label{eq:joint-syn-V-bnd}
     \frac{1}{\varepsilon_2} \norm{x}^2  \leq V(x,\theta) \leq \frac{1}{\varepsilon_1} \norm{x}^2,\ \forall \theta\in\Theta, x\in \mcX.
 \end{equation}
  % Furthermore, \cref{eq:joint-syn-sos-3} indicates  $F(x,\theta,\thetadot)   +\varepsilon_3I \leq 0, \forall \theta$ satisfying \cref{eq:theta-thetadot-constrs}. 

Under the dynamics \cref{eq:dynamics-linear-form} and the control law \cref{eq:control-law-Y-X}, and the definition of $V$ in \cref{eq:V-defn-w-X}, we have %$\dot h(x)  =  - {z^T}(x) {\small \left[ \sum\limits_{j \in J}\frac{{\partial {X^{ - 1}}(\tilde x)}}{{\partial {x_j}}}  \left( {{A_j}z} \right)  + \!\left\langle \! {X^{ - 1}}(\tilde x) {M}{\left( {A \!+\!{B}{Y} {X^{ - 1}}(\tilde x)} \right)} \!\right \rangle  \right]}\!z(x)$
{%\setlength{\mathindent}{0pt}
{
\begin{align}
  & \dot V(x,\theta)  = \sym{\!x^T X^{-1} \dot x\!}  + x^T\!\left [ \sum\limits_{j \in J} \!\frac{\partial{ X^{ - 1}}}{\partial x_j} \dot x_j \!+\! \sum_{k=1}^\ntheta \! \frac{\partial X^{-1}}{\partial \theta_k} \dot \theta_k\! \right ]\!x\nonumber    
  \\
  & = \!{x^T}\!X^{-1} \!\!\left[\sym{ {A X \!+\!{B}{Y}}} -  \!\! 
  \sum\limits_{j \in J}\frac{\partial{ X}}{\partial {x_j}} ( {A_jx} ) -   \!\!\sum_{k=1}^\ntheta \! \frac{\partial X}{\partial \theta_k} \dot \theta_k \! \right]\! X^{-1}x \label{eq:Vdot-expression-1} \\ 
    &= \! {x^T}{X^{ - 1}}F_1(x,\theta,\thetadot){X^{ - 1}}x \label{eq:Vdot-expression-2}
\end{align}}}%
where we have leveraged the fact that $\dot x =\left( {A + BY{X^{ - 1}}} \right)x$ and $\frac{{\partial {X^{ - 1}}}}{{\partial {x_j}}} =  - {X^{ - 1}}\frac{{\partial X}}{{\partial {x_j}}}{X^{ - 1}}$ \cite[Lemma 5]{prajna2004nonlinear-sos} in deriving \cref{eq:Vdot-expression-1}, and $F_1(x,\theta,\thetadot)$ is defined in \cref{eq:F1-defn}. According to \cref{proposition:sos-psd-local}, \cref{eq:joint-syn-sos-3} implies  $F_1(x,\theta,\thetadot)+\varepsilon_3I\leq 0$, $\forall x\in\mcX$, $\theta\in \mcF_\Theta^\mcV$ with $\mcF_\Theta^\mcV$ defined in \cref{eq:F-Theta-mcV-defn}. Further considering \cref{eq:Vdot-expression-2}, we have 
\begin{align}
    \dot V(x,\theta)   &\leq -\varepsilon_3 x^T X^{-1} X^{-1} x \leq -\frac{\varepsilon_3}{\varepsilon_2^2} \norm{x}^2,\  \forall x\in\mcX,\  \theta\in \fThetaV, \label{eq:Vdot-expression-final}
\end{align}
where the last inequality is due to $X^{-1}\ge \frac{1}{\varepsilon_2}I$, $\forall x\in\mcX$, $\theta\in\Theta$ (\cref{eq:X-bnd-epsilon12}).   

By applying Lyapunov stability theory \cite[Theorem~4.10]{khalil2002nonlinear-book} and considering \cref{eq:joint-syn-V-bnd,eq:Vdot-expression-final}, we can conclude that under the controller \cref{eq:control-law-Y-X}, the closed-loop system is locally exponentially stable at the origin, as certified by the Lyapunov function defined in \cref{eq:V-defn-w-X}. 

{\it Part (b)}: According to \cref{proposition:sos-psd-local}, \cref{eq:joint-syn-sos-state-cst} implies ${\footnotesize\setlength{\arraycolsep}{1.9pt} \begin{bmatrix}
1 & {C_i} X\\
* & X
    \end{bmatrix}} \geq 0$,  $\forall \theta \in \Theta$,  which, via Schur complement, further indicates $XC_i^T{C_i}X\leq X$, $\forall \theta \in \Theta$. Multiplying the preceding inequality by $x^TX^{-1}$ and its transpose from the left and right, respectively, leads to 
    % \begin{equation}\label{eq:sos-state-cst-rewritten}
    $
        |{C_i}x|^2\leq x^TX^{-1}x = V(x,\theta),~\forall i\in \mbZ_1^{n},\ \forall \theta\in \Theta$. 
    % \end{equation}  
    Thus, $\forall (x,\theta)\in \Omega(V,1)$, we have  
    $|{C_i}x|^2\leq x^TX^{-1}x\leq 1$, $~\forall i\in \mbZ_1^{n}$, which indicates $x\in\mcX$. Further considering \cref{eq:Vdot-expression-final}, we can conclude that if $ (x(0),\theta(0))\in \Omega(V,1)$, $\theta\in\fThetaV$, then
    \begin{equation}\label{eq:OmegaV-indicates-X} 
     (x(t),\theta(t))\in\Omega(V,1),\  x(t)\in\mcX,\  \forall t\geq 0.
    \end{equation}
     In other words, under the condition that $\theta\in\fThetaV$, $\Omega(V,1)$ is an invariant set, and the projection of $\Omega(V,1)$ onto the $x$-plane is a subset of $\mcX$. 
     As a result, the conditions \cref{eq:Vdot-expression-final,eq:joint-syn-V-bnd} indicate $ \dot V \leq  -\frac{\varepsilon_1\varepsilon_3}{\varepsilon_2^2} V$, which implies $V(t)\leq V(0)\exp^{-\frac{\varepsilon_1\varepsilon_3}{\varepsilon_2^2} t}$, $\forall t\geq 0$. Considering \cref{eq:joint-syn-V-bnd}, we have $\norm{x(t)}^2\leq \varepsilon_2V(t)\leq \varepsilon_2 V(0)\exp^{-\frac{\varepsilon_1\varepsilon_3}{\varepsilon_2^2} t}$, $\forall t\geq 0$, which indicates $\lim_{t\rightarrow 0} x(t) = 0$. 
\begin{comment}
{\it Proof of (c)}: According to \cref{proposition:sos-psd-local}, \cref{eq:joint-syn-sos-input-cst} implies ${\setlength{\arraycolsep}{2pt}
\footnotesize \begin{bmatrix}[0.8]
1 & D_j Y \\
* & X
    \end{bmatrix}}\geq 0$, $\forall j\in \mbZ_1^m$, $\forall x\in\mcX$, which, via Schur complement, further indicates $X^{-1}Y^TD_j^TD_jYX^{-1}\leq X^{-1}$, $\forall j\in \mbZ_1^m$, $\forall x\in\mcX,\ \theta\in\Theta$. Multiplying the preceding inequality by $x$ and $x^T$ from the right and left, respectively, and considering the control law \cref{eq:control-law-Y-X}, we have $|D_ju|^2\leq xX^{-1}x$, $\forall j\in \mbZ_1^m$, which implies $u(x,\theta)\in\mcU$, 
    $\forall x\in\mcX,\ \theta\in\Theta$.   
    Further considering \cref{eq:OmegaV-indicates-X} leads to \cref{eq:ut-in-U-always}.
\end{comment}
\end{proof}
\begin{remark}
    \cref{them:npv-synthesis-sos} presents the conditions to synthesize a controller to ensure the exponential stability of the closed-loop system, which is stronger than the uniformly asymptotic stability adopted in \cref{sec:pd-clf,sec:pd-clf-local-analysis}. Additionally, condition \cref{eq:clf-cond} are convex SOS conditions since they are affine in all decision variables. 
\end{remark}
\begin{remark}
    Similar to \cite{prajna2004nonlinear-sos}, the matrix $X$ in \cref{them:npv-synthesis-sos} depends only on $\tilx$, whose time derivatives are not affected by control inputs. This is for ensuring $\dot V$ does not depend on control input $u$ in order to obtain convex SOS conditions. 
\end{remark}

The following lemma states that the Lyapunov function from \cref{them:npv-synthesis-sos} is a  PD-CLF and the associated PD region of attraction is a PD-ROS. The proof is straightforward and omitted. 
\begin{lemma}\label{lemma:LF-is-CLF}
    Suppose the system \cref{eq:dynamics-linear-form} is an equivalent representation of the NPV system \cref{eq:dynamics},
    % $\ubar \mcU\subseteq \mcU$
    and all the conditions of \cref{them:npv-synthesis-sos} hold. Then the PD Lyapunov function defined in \cref{eq:V-defn-w-X} is a PD-CLF for \cref{eq:dynamics}, and $\Omega(V,1)$ is a PD-ROS.
\end{lemma}

To maximize the volume of $\Omega(V,1)$, we maximize the volume of an elliptic cylinder $\Omega(x^TX_0^{-1}x,1)=\left \{(x,\theta)\in\mbR^{n}\times \mbR^{\ntheta}|x^TX_0^{-1}x\leq 1,\theta\in\Theta \right\}$ contained inside $\Omega(V,1)$, where $X_0$ is a positive definite matrix. Formally, we solve the following SOS problem:
{%\setlength{\mathindent}{0pt}
\begin{subequations}\label{eq:opt-max-ellipsoid-joint-syn}
    \begin{align}
    &\max_{
    \footnotesize
    \begin{array}{c}
       X_0>0, \lambda_i^4 (i\in\mbz{N_\theta}), 
       \mu_j^4 (j\in\mbz{n})
    \end{array}
    } \log \det(X_0) \\
     \textup{s.t. } &  v_1^T(X \!- \!X_0)v_1 \!-\! \!\sum_{j=1}^{n} \mu_j^4 c_j(x) \!-  \!\!\sum_{i=1}^\Ntheta \lambda_i^4 h_i(\theta) \in\sos{x,\theta,v_1} \label{eq:opt-max-ellipsoid-constraint-joint} \\
   &   \lambda_i^4,  \mu_j^4 \in\sos{x,\theta,v_1},\ \forall i\in\mbz{N_\theta},  j\in\mbz{n}
     \end{align}
\end{subequations}}
Condition \cref{eq:opt-max-ellipsoid-constraint-joint} ensures $X\geq X_0$ and therefore $x^TX^{-1}x \leq x^TX_0^{-1}x$ for any $x\in\mcX,\ \theta\in\Theta$. As a result, $\Omega(x^TX_0^{-1}x,1) \cap (\mcX\times \Theta) \subseteq \Omega(V,1) \cap (\mcX\times \Theta) $.


To summarize, to obtain a PD  controller (a PD-CLF) to exponentially stabilize the system %in the presence of input constraints 
while maximizing the PD-ROA (PD-ROS), we solve the following SOS program: \vspace{1 mm}\\ 
{%\setlength{\mathindent}{0pt}
\fbox{%
\parbox{0.99\columnwidth}{%
\begin{subequations}\label{eq:opt-joint-syn-sos}
  \begin{align}
  % \vspace{-2mm}
    & \hspace{-8mm}\max_{
    \footnotesize
    \begin{array}{c}
      \varepsilon_i\!>\!0~(i\in\mbz{3}), X_0\!>\!0,   \alpha_i^j ~(i\in\mbz{\Ntheta},j\in\mbz{n})
      \\
      X(\tilde x,\theta)
      %\in\mcS^n
      , Y(x,\theta),
      %\in \mbR^{m\times n},   
      \lambda_i^l\ (i\in\mbz{\Ntheta}\!, l\in\mbz{6}),  
      \\      
      \mu_j^p\  (i\in\mbz{\Ntheta}, p\in\mbz{4}), \xi_k\ (k\in\mbz{\ntheta}) %,  \gamma_j^q\ (j\in\mbz{n}, q\in\mbz{N_u})
    \end{array}
    } \!\!\log \det(X_0) \label{eq:opt-joint-syn-sos-1} \\
     \textup{s.t. } & \textup{Constraints \cref{eq:joint-syn-sos-1,eq:joint-syn-sos-2,eq:joint-syn-sos-3,eq:joint-syn-sos-state-cst,eq:opt-max-ellipsoid-constraint-joint}}   % eq:joint-syn-sos-input-cst,
     \\
     & \textup{all multipliers are SOS}.
    %  \begin{comment}
    %  & \lambda_i^1,\lambda_i^2,\lambda_i^4,\mu_j^1,\mu_j^2,\mu_j^4\in\sos{x,\theta,v_1},\ \forall i\in\mbz{\Ntheta}, j\in\mbz{n}, \nonumber\\
    %  & \lambda_i^3,\mu_j^3,\xi_k\in\sos{x,\theta,\thetadot,v_1},\ \forall i\in\mbz{\Ntheta}, j\in\mbz{n},k\in\mbz{\ntheta}, \nonumber \\
    % & \alpha_i^j\in\sos{x,\theta,v_2},\ \forall i\in\mbz{\Ntheta},j\in\mbz{n}, % ,q\in \mbZ_1^m. \nonumber
    %  %  \alpha_i^j, \beta_i^q,\gamma_j^q\in\sos{x,\theta,v_2},\ \forall i\in\mbz{\Ntheta},j\in\mbz{n},q\in \mbZ_1^m. \nonumber
    %  % \end{split}
    %  \end{comment}
\end{align}
\end{subequations}} 
}

% \subsection{Handing input constraints}
% We can further consider input constraints and ensure that the control law in \cref{eq:control-law-Y-X} respects such constraints by extending the method in \cite{zhao2023convex-cbf,maier2010predictive-sos} to the parameter-dependent case. Specifically, we 
% %define an inner approximation of the input constraint set $\mcU$ in \cref{eq:input-cst-set-U}
% consider an input constraint set defined by  
% \begin{equation}\label{eq:input-cst-set-Ubar}
%  \mcU \trieq \{u\in \mbR^m: \abs{D_i u} \leq 1, \ i = 1, \dots, N_u\},
% \end{equation}
% where {$D_i \in \mbR^{1\times m}$}. 

% % Next, we will present conditions for synthesizing a stabilizing controller while ensuring $u(t)\in\ubar \mcU\subseteq \mcU$ for all $t\geq 0$.  
% \begin{lemma}
%     Consider an NPV system \cref{eq:dynamics-linear-form} with the parameters $\theta$ satisfying \cref{eq:theta-thetadot-constrs}, %the input constraint set $\ubar\mcU$ defined in \cref{eq:input-cst-set-Ubar}, 
%     the set $\mcX$ defined in \cref{eq:X-set-defn-npv}, and the input constraint set defined in \cref{eq:input-cst-set-Ubar}.  
%     Suppose all the conditions in \cref{them:npv-synthesis-sos}, i.e., \cref{eq:joint-syn-sos-1,eq:joint-syn-sos-2,eq:joint-syn-sos-3,eq:joint-syn-sos-state-cst} hold, and additionally  there exist SOS polynomials $\beta_i^q$ $(i\in\mbz{N_\theta},q\in\mbz{m})$ and $\gamma_j^q$ $(j\in\mbz{n}, q\in\mbz{m})$ such that  
% \begin{equation}
% v_2^T  {\setlength{\arraycolsep}{2pt}
% \footnotesize \begin{bmatrix}
% 1 & D_j Y \\
% * & X(\tilx,\theta)
%     \end{bmatrix}} v_2 - \sum_{j=1}^{n} \gamma_j^q c_j(x) - \!\sum_{i=1}^\Ntheta \beta_i^q h_i(\theta)      \in \sos{x,\theta,v_2} \ \forall q\in \mbZ_1^m. \!\label{eq:joint-syn-sos-input-cst}  
% \end{equation} holds. Then, under the control law \cref{eq:control-law-Y-X}, %$\forall (x(0),\theta(0))\in \Omega(V,1),\ \theta\in\fThetaV,$
%     \begin{equation}\label{eq:ut-in-U-always}
%   \hspace{-4mm} \forall (x(0),\theta(0))\in \Omega(V,1),\ \theta\in\fThetaV \Rightarrow     u(t)\in \mcU,~\forall t\geq 0. 
%     \end{equation}
% \end{lemma}
% \begin{proof}
%     According to \cref{proposition:sos-psd-local}, \cref{eq:joint-syn-sos-input-cst} implies ${\setlength{\arraycolsep}{2pt}
% \footnotesize \begin{bmatrix}[0.8]
% 1 & D_j Y \\
% * & X
%     \end{bmatrix}}\geq 0$, $\forall j\in \mbZ_1^m$, $\forall x\in\mcX$, which, via Schur complement, further indicates $X^{-1}Y^TD_j^TD_jYX^{-1}\leq X^{-1}$, $\forall j\in \mbZ_1^m$, $\forall x\in\mcX,\ \theta\in\Theta$. Multiplying the preceding inequality by $x$ and $x^T$ from the right and left, respectively, and considering the control law \cref{eq:control-law-Y-X}, we have $|D_ju|^2\leq xX^{-1}x$, $\forall j\in \mbZ_1^m$, which implies $u(x,\theta)\in\mcU$, 
%     $\forall x\in\mcX,\ \theta\in\Theta$.   
%     Further considering \cref{eq:OmegaV-indicates-X} leads to \cref{eq:ut-in-U-always}.
% \end{proof}
% To incorporate input constraints in the synthesis procedure, we just need to add constraints \cref{eq:joint-syn-sos-input-cst} to the SOS optimization problem \cref{eq:opt-joint-syn-sos}.
\subsection{QP-based control law vs pre-defined control law}
Since the resulting Lyapunov function  from solving \cref{eq:opt-joint-syn-sos} is a PD-CLF according to \cref{lemma:LF-is-CLF}, we can again construct the control signal by solving a QP similar to \cref{eq:min-norm-formulation}. From \cref{eq:Vdot-expression-final}, the QP becomes
\begin{subequations}\label{eq:min-norm-formulation-w-u-limit}
  \begin{align}
 &u^\ast(x,\theta) = \min_{u}\  u^T H(\theta) u \\
    \textup{s.t. } & L_f V\!+ \!L_g Vu \!+\! \frac{\partial V}{\partial \theta }v 
\leq -\varepsilon_3 x^T X^{-1} X^{-1} x. \label{eq:min-norm-formulation-w-u-limit:b}
%& u\in \mcU,  \label{eq:min-norm-formulation-w-u-limit:c}
     \end{align}
\end{subequations}
where we also introduce a $\theta$-dependent positive definite matrix $H(\theta)$ to make the cost function more general.  Notice that \label{eq:min-norm-formulation-w-u-limit:b} can be replaced by $L_f V\!+ \!L_g Vu \!+\! \frac{\partial V}{\partial \theta }v  \leq -\frac{\varepsilon_3}{\varepsilon_2^2} \norm{x}^2, \ \forall v \in \textup{ver}(\mcV)$, which is a more relaxed condition and will lead to more conservative behavior.  
\begin{remark}
 The QP problem  \cref{eq:min-norm-formulation-w-u-limit} is guaranteed to be feasible for any $(x,\theta)\in\Omega(V,1)$ due to \cref{them:npv-synthesis-sos}. 
\end{remark}
Since an input control law defined in \cref{eq:control-law-Y-X} is simultaneously obtained when solving \cref{eq:opt-joint-syn-sos} to obtain the PD-CLF, one may wonder why we still need to resort to the QP \cref{eq:min-norm-formulation-w-u-limit} to construct the min-norm control law. The min-norm may be preferred when avoiding input saturation is a concern, as min-norm control law typically generates small control signal as demonstrated in case studies in \cref{sec:sim}). Additionally, min-norm control law may improve the robustness of the closed-loop system against input uncertainty, as demonstrated in \cite{jankovic1999clf-robustness}. 

 \section{Simulation Results}\label{sec:sim}
%We now test the proposed approach on a simple inverted pendulum system and a rocket landing problem.  
We used Matlab 2023a with YALMIP \cite{YALMIP} and Mosek \cite{andersen2000mosek} 
to solve all the optimization problems. 


\subsection{Numerical example}
We first consider a two-dimensional toy example 
\begin{equation}
   \dot x = \begin{bmatrix}
      \dot x_1 \\
      \dot x_2 
   \end{bmatrix} = \begin{bmatrix}
      \theta(t) x_2 \\
       19.62\left(x_1-{x_1^3}/{6}\right)-8x_2
   \end{bmatrix} 
   + \theta(t)  \begin{bmatrix}
       0 \\
      40
   \end{bmatrix} u.
\end{equation}
where $\theta(t)\in\Theta = [0.05,1]$ and $|\dot\theta(t)|\leq 0.1$. Note that $\theta=0.05$
 indicates a loss of 95\% control effectiveness compared to the scenario with $\theta=1$ from the input matrix. To find a PD-CLF, we represented the dynamics in the linear-like form \cref{eq:dynamics-linear-form} and then solved the SOS problem \cref{eq:opt-joint-syn-sos} to maximize the region of stabilization. We selected the decision variables as $X(x_1,\theta)$ and $Y(x,\theta)$, both of which have the order of 2, and the set $\mcX$ to be $[-5,5]\times[-5,5]$.
 % \begin{comment}
 The resulting PD-CLF is given by $V(x,\theta) = x^T X^{-1}(x_1,\theta)x$, where 
% \begin{equation*}
% \small
% \setlength{\arraycolsep}{2pt}
% \begin{split}
%    X(\phi,\theta) = & \begin{bmatrix}
%  0.81 & 
% -1.79 \\
% -1.79 & 24.82       
%    \end{bmatrix}  +
%    \begin{bmatrix}
% -1.16 & 
% -3.32 \\
% -3.32 & -0.34      
%    \end{bmatrix} \theta  \\
%  &  + 
% 10 
% ^{-4}       \begin{bmatrix}
% 7 & -114\\
%  -114 & 172 
% \end{bmatrix} x_1^2 
% + \begin{bmatrix}
% 12.12 & -0.50 \\
% -0.50 & 0.18   
% \end{bmatrix} \theta^2.   
% \end{split} 
% \end{equation*}
$$  X(x_1,\theta) =  \begin{bmatrix}
 0.81 & 
-1.79 \\
-1.79 & 24.82       
   \end{bmatrix}  +
   \begin{bmatrix}
-1.16 & 
-3.32 \\
-3.32 & -0.34      
   \end{bmatrix} \theta   + 
10 
^{-4}       \begin{bmatrix}
7 & -114\\
 -114 & 172 
\end{bmatrix} x_1^2 
+ \begin{bmatrix}
12.12 & -0.50 \\
-0.50 & 0.18   
\end{bmatrix} \theta^2.  $$
Note that solving the optimization problem \cref{eq:opt-joint-syn-sos} also gives a control law 
\begin{equation}\label{eq:control-law-pendulum}
   u(x,\theta) = Y(x,\theta)X^{-1}(x_1,\theta)x.
\end{equation}
% \end{comment}
  The PD region of stabilization (ROS) determined by $V(x,\theta)$ as $\Omega(V,1)=\{(x,\theta): V(x,\theta)\leq 1, \theta\in\Theta\}$ is illustrated in \cref{fig:roa-pendulum}. \cref{fig:roa-pendulum} also includes the projection of  $\Omega(V,1)$ onto the $x$-plane with different $\theta$ values as well as the robust ROS, which is obtained by removing the dependence of the decision variables $X$ and $Y$ on $\theta$ in solving the SOS problem \cref{eq:opt-joint-syn-sos}. We can see that the robust ROS almost overlaps with the projection of the PD-ROS onto $\theta =0.05$, which is the smallest among all projected regions.  Using the PD-ROS leads to an enlarged set of states from which the system can be stabilized by considering the initial values of $\theta$, i.e., $\theta(0)$.
\begin{figure}[h]
    \centering
    \vspace{-5mm}
\includegraphics[width=0.45\columnwidth]{fig/toy-pd-roa.pdf} 
\includegraphics[width=0.47\columnwidth]{fig/toy-pd-roa-proj.pdf} 
    \caption{PD region of stabilization (PD-ROS) (left) and its projection onto $x$-planes with different $\theta$-values together with the robust ROS (right). Robust ROS overlaps with the smallest projection of the PD-ROS, corresponding to $\theta=0.0.05$}
    \label{fig:roa-pendulum}
    \vspace{-5mm}
\end{figure}

To demonstrate this, we set the parameter trajectory to be $\theta(t) = 0.6+0.4\cos(0.2t)$, which leads to $\theta(0) = 1$. We pick four initial states $x(0)$ such that $(x(0)$ and $\theta(0))$ are in the PD-ROS, i.e., $(x(0),\theta(0))\in \Omega(V,1)$, but are not in the robust ROS. \cref{fig:toy-traj} illustrates the trajectories of states, Lyapunov function, and control input under the control law \cref{eq:control-law-Y-X} and the min-norm control law, respectively. Under both control laws, the system is successfully stabilized to the origin for all four initial states. However, the pre-defined control law and min-norm control law . In particular, the min-norm control inputs are small at the very beginning. In fact, the min-norm inputs are zero at the first 0.03 seconds for all four initial states. This is possible because the CLF condition is satisfied by the dynamics even in the absence of active control input at the very beginning. 
\begin{figure}[H]
% \vspace{-5mm}
    \centering
    \begin{subfigure}[b]{0.42\columnwidth}
        \centering
\includegraphics[width= 1\columnwidth]{fig/toy_min_norm_0_2d_trajs_2.pdf} \\ 
\includegraphics[width= 1\columnwidth]{fig/toy_min_norm_0_trajs.pdf}
        \caption{Pre-defined control law \cref{eq:control-law-Y-X}}
        \label{fig:toy-predefine-u}
    \end{subfigure}
      \begin{subfigure}[b]{0.42\columnwidth}
    \includegraphics[width=1\columnwidth]{fig/toy_min_norm_1_2d_trajs_2.pdf} \\ 
\includegraphics[width= 1\columnwidth]{fig/toy_min_norm_1_trajs.pdf}
        \caption{Min-norm control law \cref{eq:min-norm-formulation}}
        \label{fig:toy-predefine-u}
    \end{subfigure}
    \caption{Trajectories of states (top), Lyapunov function (middle) and control input (bottom) starting from four initial points under the pre-defined control law \cref{eq:control-law-Y-X} (left) and the min-norm control law \cref{eq:min-norm-formulation} (right).}
    \label{fig:toy-traj}
    % \vspace{-7mm}
\end{figure}

% \begin{figure}[h]
%     \centering   
%     \vspace{-3mm}\includegraphics[width=0.42\linewidth]{fig/toy_min_norm_0_2d_trajs.pdf}    \includegraphics[width=0.56\linewidth]{fig/toy_min_norm_0_trajs.pdf}
%     \caption{ }
%     \label{fig:traj-pendulum}
% \end{figure}
% \begin{figure}[h]
%     \centering
%    \includegraphics[width=0.42\linewidth]{fig/toy_min_norm_1_2d_trajs.pdf}    \includegraphics[width=0.56\linewidth]{fig/toy_min_norm_1_trajs.pdf}
%     \caption{Trajectories of states (left), Lyapunov function (top right) and control input (bottom right) starting from four different initial points under $\theta(t) = 0.6+0.4\cos(0.2t)$ and the {\it min-norm control law} from solving the QP problem. }
%     \label{fig:traj-pendulum-min-norm}
% \end{figure}
% \vspace{-5mm}
\subsection{Rocket landing under varying mass and inertia   }\label{sec:rocket}
We now consider a 2-D rocket landing problem. The dynamics of the rocket are described by 


\begin{equation}\label{eq:rocket-dyanmics}
  \begin{bmatrix}
\dot{y} \\
\dot{z} \\
\dot{\phi} \\
\dot{v}_y\\
\dot{v}_z \\
{\ddot{\phi}}
\end{bmatrix}
=
{\begin{bmatrix}
v_y \\
v_z \\
\dot{\phi} \\
0 \\
-g \\
0
\end{bmatrix}}
+
\begin{bmatrix}
0 & 0 \\
0 & 0 \\
0 & 0 \\
\frac{1}{m/\theta} & 0 \\
0 & \frac{1}{m/\theta } \\
-\frac{l\cos{\phi}}{J/\theta} & \frac{l\sin{\phi}}{J/\theta}
\end{bmatrix}
\begin{bmatrix}
F_y \\
F_z
\end{bmatrix},  
\end{equation}
where $y$, $z$ and $\phi$ are the position in $y$ axis,  position in $z$ axis and the angle between the rocket body and upwards direction,  $m=1$, $l=1$, and $J=\frac{m}{12}(2l)^2$ denotes the mass, the length from center of mass (COM) to the thruster, and inertia of the rocket. Here we assume that the COM is in the middle of the rocket and is time-invariant to simplify the modeling. $g=9.81$ is the gravitational constant, and  $F_y$ and $F_z$ denotes the thrust forces in the $y$ and $z$ axes, respectively. The parameter $\theta$ reflects the mass and inertia change due to fuel consumption, and is set to be $\theta(t)\in\Theta=[1,5]$, $\dot\theta(t)\in[0,0.1]$ for all $t\geq 0$. Note that $\theta=5$ corresponds to the mass and inertia reduced to 20\% of those associated with $\theta=1$.  

\begin{figure}[ht]
% \vspace{-3mm}
    \centering
    \begin{subfigure}[b]{0.4\columnwidth}
        \centering
\includegraphics[width= 1\columnwidth]{fig/rocket_min_norm_0_inputLimit_2_2d_trajs.pdf}\\ 
\includegraphics[width= 1\columnwidth]{fig/rocket_min_norm_0_inputLimit_2_trajs.pdf}
        \caption{Pre-defined control law \cref{eq:control-law-Y-X}}
        \label{fig:rocket-predefine-u}
    \end{subfigure}
      \begin{subfigure}[b]{0.4\columnwidth}
    \includegraphics[width=1\columnwidth]{fig/rocket_min_norm_1_inputLimit_2_2d_trajs.pdf} \\ 
\includegraphics[width= 1\columnwidth]{fig/rocket_min_norm_1_inputLimit_2_trajs.pdf}
        \caption{Min-norm control law \cref{eq:min-norm-formulation}}
        \label{fig:rocket-minnorm-u}
    \end{subfigure}
    \caption{Trajectories of states (top) and control inputs (bottom) starting from four initial points under the pre-defined control law \cref{eq:control-law-Y-X} (left) and the min-norm control law \cref{eq:min-norm-formulation} (right).}
    \label{fig:rocket-traj}
    \vspace{-6mm}
\end{figure}


To remove the constant $g$ so that we could rewrite the dynamics in the linear-like form \cref{eq:dynamics-linear-form}, we define $F_z = \hat F_z + \frac{mg}{\theta}$, and rewrite the dynamics in the form of new control input $\hat u = [F_y, \hat F_z]^T$. With Taylor series expansion to approximate the trigonometric functions, the new dynamics can further be rewritten in the linear-like polynomial form \cref{eq:dynamics-linear-form}. In solving the SOS problem \cref{eq:opt-joint-syn-sos}, we selected the Lyapunov and controller matrix variables as $X(\phi,\theta)$ and $Y(\phi,\theta)$, both of which have the order of 2. We decided not to include more dependent states in $X$ and $Y$ to reduce the computational load. The local synthesis set $\mcX$ is selected to be $\mcX = \left\{x\in\mbR^6: y^2+z^2\leq 36,~\phi^2+(\dot\phi)^2\leq (\frac{\pi}{3})^2,~v_y^2+v_z^2\leq 4\right\}$. % The control input constraint were set to be $\abs{F_y}\leq 50$ and $\abs{\hat{F_z}}\leq 50$. 



After getting the PD-CLF and the PD controller from solving \cref{eq:opt-joint-syn-sos}, we simulated the system starting from initial states $x(0)=[y_0,z_0, \phi_0, 0, -0.5, 0]^T$ under the trajectory $\theta(t) =1+0.08t$. The state and input trajectories for three cases of $(y_0,z_0, \phi_0)$ under the predefined control law and min-norm control law, are shown in \cref{fig:rocket-traj}. Notice that $x(0)$ for all three cases is actually out of the set $\mcX$ used in the synthesis procedure. However, both control laws were able to land the rocket successfully in all these cases. Additionally, the magnitude of the min-norm control signal is significantly smaller compared to that of the predefined control law. This reduction offers notable advantages in certain scenarios, particularly in avoiding input saturation.
% \begin{figure}[h]
% % \vspace{-10mm}
%     \centering
%    \includegraphics[height=0.4\linewidth]{fig/rocket_min_norm_0_inputLimit_2_2d_trajs.pdf} \vspace{-5mm}\\    
%    \includegraphics[width=0.8\linewidth]{fig/rocket_min_norm_0_trajs.pdf}
%     \caption{Trajectories of states (left), Lyapunov function (middle two) and control inputs (bottom) starting from three different initial points under $\theta(t) = 1+0.08t$ and the PD controller. The rocket body is illustrated by the blue rod, and the goal point (i.e., the origin) is denoted by \green{\Large $\star$}. }
%     \label{fig:traj-rocket}
% \end{figure}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusions}\label{sec:conclusion}
This paper presented an approach to gain-scheduled stabilization of nonlinear parameter-varying (NPV) systems through parameter-dependent (PD) control Lyapunov functions (CLFs). For control-affine polynomial NPV systems, it introduces convex conditions based on sum of squares (SOS) programming to 
%verify given PD-CLFs for . Furthermore, a framework for the joint synthesis of 
jointly synthesize a 
PD-CLF  and a stabilizing controller. Simulation results validated the effectiveness of the proposed approach, demonstrating its potential for enhancing the stabilization of NPV systems. The proposed PD-CLF provides a way to control nonlinear systems with large operating envelopes. Compared to the existing LPV approach, it does not need linearization or over-approximation that is typically required to obtain an LPV system. 

Future work includes %the relaxation of the assumption imposed in the synthesis procedure that input constraint should be symmetric, and 
consideration of potential errors in measuring and estimating the scheduling parameters that have been studied in the LPV setting \cite{Sato13Inexact,Zhao17Inexact}.
\bibliographystyle{ieeetr}
\bibliography{bib/refs-pan,bib/refs-new}

\end{document}
