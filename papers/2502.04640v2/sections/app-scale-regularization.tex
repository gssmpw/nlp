%!TEX root = ../main.tex

\section{Scale Regularization}
\label{app:scale-regularization}

Due to inaccuracies in real-world data, the scale of frames $2,\dots,N$ is often significantly smaller than that of the first frame\footnote{which is anchored to 1}. As a result, the global minimum tends to collapse all cameras $2,\dots,N$ into a single point to avoid large errors in their estimates. To mitigate this, we introduce a scale regularization term in the objective function of \prettyref{eq:problem-sdp}.  

\begin{align}\label{eq:problem-sdp-scale}
    \min_{X \in \sym{3N}} & \trace{QX} + \lambda \sum_{i=2}^{N} (X_{3i,3i}-1)^2 \nonumber\\
    \subject & \langle A_i,X \rangle = b_i, \forall i \in 1,\dots,5N+1\nonumber\\
    & X \succeq 0
\end{align}
This does not violate our existing theorem; Slaterâ€™s Condition and strong duality remain valid, and the optimality condition remains unchanged. However, the $Z(y)$ matrix is modified to  

\bea
    Z(y) = Q - \sum_{i=1}^{5N+1} y_i A_i + \lambda \nabla(\sum_{i=2}^{N} (X_{3i,3i}-1)^2)
\eea
To prove this, we first write \prettyref{eq:problem-sdp-scale} in the standard form:
\begin{align}
\min ~~&\langle Q, X \rangle + F(X)\\
s.t. ~~&X \succ 0\\
& \langle A_i, X \rangle = b_i, ~~\forall i
\end{align}
$F(X)$ is a quadratic term defined by $\displaystyle F(X) = \lambda \sum_{i=2}^{N} (X_{3i,3i}-1)^2$. This is still a convex problem and the lagrangian is:
\begin{align}
L(X, y, Z) =& \langle Q, X \rangle + F(X) - \\&\sum_i y_i (\langle A_i, X \rangle - b_i) - \langle Z, X \rangle \\
=& \langle Q - \sum_i y_i A_i - Z, X \rangle + F(X) + \sum_i y_i b_i
\end{align}
The KKT condition is:
\begin{align}
Z =& Q + \nabla F(X) - \sum_i y_i A_i \succ 0 \\
\langle A_i, X \rangle =& b_i, ~~\forall i \\
X \succ & 0 \\
\langle Z, X \rangle = & 0
\end{align}
Note that $L$ is linear in the off-diagonal elements of $X$ and quadratic in the diagonal elements. To ensure a finite minimum, we require $(\nabla L)_{ij} = 0$ for $i \neq j$. For the diagonal elements, achieving the minimum requires $(\nabla L)_{ii} = 0$. Thus, together, we obtain $\nabla L = 0$, i.e.
\begin{align}
Q - \sum_i y_i A_i - Z = -\nabla F(X)
\end{align}
From the definition of $F(x)$ we know $X_{3j,3j} = -\frac{(Q - \sum_i y_i A_i - Z)_{3j,3j}}{2\lambda} + 1$. So we plug in $X$ then we get the dual problem:
\begin{align}
\max ~~&\sum_i b_i y_i - \frac{\sum_{j=2}^N (C - \sum_i y_i A_i - Z)_{3j,3j}^2}{4\lambda} 
\\ & + \sum_{j=2}^N (Q - \sum_i y_i A_i - Z)_{3j,3j} \\
s.t. ~~&Z \succ 0\\
        ~~&(Q - \sum_i y_i A_i - Z)_{ij} = 0, ~~i\neq j    
\end{align}
