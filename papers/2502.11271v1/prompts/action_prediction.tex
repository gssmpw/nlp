\begin{textcolorbox}[Prompt for Action Predictor]
\textbf{Task:} Determine the optimal next step to address the given query based on the provided analysis, available tools, and previous steps taken.
\\\\
\textbf{Query:} \texttt{\{question\}}
\\
\textbf{Image:} \texttt{\{image\}}
\\
\textbf{Query Analysis:} \texttt{\{query\_analysis\}}
\\
\textbf{Available Tools:}
\texttt{\{self.available\_tools\}}
\\
\textbf{Tool Metadata:}
\texttt{\{self.toolbox\_metadata\}}

\textbf{Previous Steps and Their Results:}
\texttt{\{memory.get\_actions()\}}

\textbf{Current Step:} \texttt{\{step\_count\}} in \texttt{\{max\_step\_count\}} steps

\textbf{Remaining Steps:} \texttt{\{max\_step\_count - step\_count\}}
\\\\
\textbf{Instructions:}

1. Analyze the context thoroughly, including the query, its analysis, any image, available tools and their metadata, and previous steps taken.

2. Determine the most appropriate next step by considering:

\quad - Key objectives from the query analysis
   
\quad - Capabilities of available tools
   
\quad - Logical progression of problem-solving
   
\quad - Outcomes from previous steps
   
\quad - Current step count and remaining steps

3. Select ONE tool best suited for the next step, keeping in mind the limited number of remaining steps.

4. Formulate a specific, achievable sub-goal for the selected tool that maximizes progress towards answering the query.
\\\\
\textbf{Output Format:}

\textless{}\texttt{justification}\textgreater{}: detailed explanation of why the selected tool is the best choice for the next step, considering the context and previous outcomes.

\textless{}\texttt{context}\textgreater{}: MUST include ALL necessary information for the tool to function, structured as follows:

\quad * Relevant data from previous steps
    
\quad * File names or paths created or used in previous steps (list EACH ONE individually)
    
\quad * Variable names and their values from previous steps' results
    
\quad * Any other context-specific information required by the tool
    
\textless{}\texttt{sub\_goal}\textgreater{}: a specific, achievable objective for the tool, based on its metadata and previous outcomes. It MUST contain any involved data, file names, and variables from Previous Steps and Their Results that the tool can act upon.

\textless{}\texttt{tool\_name}\textgreater{}: MUST be the exact name of a tool from the available tools list.
\\\\
\textbf{Rules:}

\quad - Select only ONE tool for this step.

\quad - The sub-goal MUST directly address the query and be achievable by the selected tool.

\quad - The Context section MUST include ALL necessary information for the tool to function, including ALL relevant file paths, data, and variables from previous steps.

\quad - The tool name MUST exactly match one from the available tools list: \texttt{\{self.available\_tools\}}.

\quad - Avoid redundancy by considering previous steps and building on prior results.
\\\\
\textbf{Example (do not copy, use only as reference):}

\textless{}\texttt{justification}\textgreater{}: [Your detailed explanation here]

\textless{}\texttt{context}\textgreater{}: Image path: \texttt{"example/image.jpg"}, Previous detection results: [list of objects]

\textless{}\texttt{sub\_goal}\textgreater{}: Detect and count the number of specific objects in the image \texttt{"example/image.jpg"}

\textless{}\texttt{tool\_name}\textgreater{}: \texttt{Object\_Detector\_Tool}
\end{textcolorbox}
