\section{Typing Rules}\label{app:type-system}

The following rules are in addition to those presented in Section \ref{sec:type_system}.

\begin{figure}[ht]
    \centering
    \noindent
    \begin{minipage}{0.3\textwidth}
        \begin{equation}
            \frac{
                \Gamma \vdash^{\textbf{WF}} (\text{Ty}(op), \; \epsilon)
            }{
                \Gamma \vdash op : (\text{Ty}(op), \; \epsilon)
            }
            \tag{\textsc{TOp}}
        \end{equation}
    \end{minipage}
    \hfill
    \begin{minipage}{0.6\textwidth}
        \begin{equation}
            \frac{
                \begin{gathered}
                    \Gamma \vdash e_x : (\tau_x, \; H_{e_x}) \quad \Gamma, x{:}\tau_x \vdash e : (\tau, \; H_e) \\
                    \Gamma \vdash^{\textbf{WF}} (\tau, \; H_{e_x} \cdot H_e)
                \end{gathered}  
            }{
                \Gamma \vdash \texttt{\small{let}}\;x = e_x\;\texttt{\small{in}}\;e : (\tau, \; H_{e_x} \cdot H_e)
            }
            \tag{\textsc{TLetE}}
        \end{equation}
    \end{minipage}

    \vspace{20pt}

    \begin{equation}
        \frac{
            \begin{gathered}
                \Gamma \vdash op : (\overline{a_i{:}\overa{v: b_i \;|\; \phi_i}} \rightarrow \tau_x, \; H_{op} ) \quad \forall i, \Gamma \vdash u_i : (\under{v: b_i \;|\; \phi_i}, \; H_{u_i}) \\
                \Gamma, x{:}\tau_x\overline{[a_i \mapsto u_i]} \vdash e : (\tau, \; H_e) \quad \Gamma \vdash^{\textbf{WF}} (\tau, \; H_{op} \cdot ( \underset{i}{\bullet} \; H_{u_i} ) \cdot H_e)
            \end{gathered}
        }{
            \Gamma \vdash \texttt{\small{let}}\;x = op\;\overline{u_i}\;\texttt{\small{in}}\;e : (\tau, \; H_{op} \cdot ( \underset{i}{\bullet} \; H_{u_i} ) \cdot H_e)
        }
        \tag{\textsc{TAppOp}}
    \end{equation}

    \vspace{20pt}

    \begin{equation}
        \frac{
            \begin{gathered}
                \neg(\kappa_x = \pi) \quad \Gamma \vdash v_1 : ((\tau_1 \rightarrow \kappa_1) \rightarrow \kappa_x, \; H_{v_1}) \quad \Gamma \vdash v_2: (\tau_1 \rightarrow \kappa_1, \; H_{v_2}) \\
                \Gamma, x : \kappa_x \vdash e: (\tau, \; H_e) \quad \Gamma \vdash^{\textbf{WF}} (\tau, \; H_{v_1} \cdot H_{v_2} \cdot H_e)
            \end{gathered}
        }{
            \Gamma \vdash \texttt{\small{let}}\;x = v_1\;v_2\;\texttt{\small{in}}\;e : (\tau, \; H_{v_1} \cdot H_{v_2} \cdot H_e)
        }
        \tag{\textsc{TAppFunMulti}}
    \end{equation}

    \vspace{20pt}

    \begin{equation}
        \frac{
            \begin{gathered}
                \Gamma \vdash v_1 : ((\tau_1 \rightarrow \kappa_1) \rightarrow (\tau_{v_1}, \; H_{\tau_{v_1}}), \; H_{v_1}) \quad \Gamma \vdash v_2: (\tau_1 \rightarrow \kappa_1, \; H_{v_2}) \\
                \Gamma, x : \kappa_x \vdash e: (\tau, \; H_e) \quad \Gamma \vdash^{\textbf{WF}} (\tau, \; H_{v_1} \cdot H_{v_2} \cdot H_{\tau_{v_1}} \cdot H_e)
            \end{gathered}
        }{
            \Gamma \vdash \texttt{\small{let}}\;x = v_1\;v_2\;\texttt{\small{in}}\;e : (\tau, \; H_{v_1} \cdot H_{v_2} \cdot H_{\tau_{v_1}} \cdot H_e)
        }
        \tag{\textsc{TAppFunLast}}
    \end{equation}
\end{figure}