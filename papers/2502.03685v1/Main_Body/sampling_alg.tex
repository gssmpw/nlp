\begin{algorithm}
    \caption{Discrete Autoregressive Biasing}
    \begin{algorithmic}[1]
    \REQUIRE Constraint function $f$, $P^{LM}$, prompt $X$, number steps $s$, sequence length $n$, embedding table $M$
    \STATE $\tilde{B} \gets \vec{0}, f_\text{min} \gets -\infty$, $Y_\text{best} \gets \{\}$ \LineComment{Initialize constraint violation as being maximal and current best generation as empty}
    \FOR{step $s$}
        \FOR{position $i$ in range($n$)} 
            \STATE $\tilde{y_i} \gets \log P^{LM} (\cdot | y_{<i}, X)$ \LineComment{Initial auto-regressive distribution over $V$}
            \STATE Calculate normalizing factor $r_i$ if $s > 1$, else $r_i \gets 1$
            \STATE $y_i \gets \text{argmax}_{j \in |V|} \left(\tilde{y}_{i, j} - w_i \cdot r_i \cdot \tilde{b}_{i, j} \right)$ \LineComment{Sample from $P(Y | X, B)$}
        \ENDFOR
        \STATE $B \gets Y$ \LineComment{Initialize $B$ as $Y$}
        \STATE Evaluate $f(B | X)$, update $f_\text{min}$, $Y_\text{best}$
        \STATE $B' \sim q_\tau(\cdot | B)$ as in \eqref{eq:dlp_prop} \LineComment{Approximately sample from $P(B | X, Y)$}
        \STATE Compute $\tilde{B}$ as in \eqref{eq:bias-vec-def}
    \ENDFOR
    \STATE return $Y_\text{best}$
    \end{algorithmic}
\label{alg:text-gen}
\end{algorithm}