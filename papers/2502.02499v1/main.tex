\documentclass{article}
\usepackage{tikz}
\usetikzlibrary{positioning, arrows.meta, calc}
\usepackage{graphicx} %
\usepackage{appendix}
\usepackage{gensymb}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{bbm}
\usepackage{natbib}
\usepackage{authblk}

\title{Learning to generate physical ocean states: Towards hybrid climate modeling}

\author[1,2]{Etienne Meunier} %
\author[2]{David Kamm}
\author[2,3]{Guillaume Gachon}
\author[3]{Redouane Lguensat}
\author[1,2,3]{Julie Deshayes}
\affil[1]{Inria Paris}
\affil[2]{Sorbonne Universit\'es (UPMC, Univ Paris 06)-CNRS-IRD-MNHN, LOCEAN Laboratory, Paris, France}
\affil[3]{Institut Pierre-Simon Laplace, IRD, Sorbonne Universit\'e, Paris, France}
\date{February 2025}

\begin{document}

\maketitle

\begin{abstract}
Ocean General Circulation Models require extensive computational resources to reach equilibrium states, while deep learning emulators, despite offering fast predictions, lack the physical interpretability and long-term stability necessary for climate scientists to understand climate sensitivity (to greenhouse gas emissions) and mechanisms of abrupt %
variability such as tipping points.
We propose to take the best from both worlds by leveraging deep generative models to produce physically consistent oceanic states that can serve as initial conditions for climate projections.
We assess the viability of this hybrid approach through both physical metrics and numerical experiments, and highlight the benefits of enforcing physical constraints during generation.
Although we train here on ocean variables from idealized numerical simulations, we claim that this hybrid approach, combining the computational efficiency of deep learning with the physical accuracy of numerical models, can effectively reduce the computational burden of running climate models to equilibrium, and reduce uncertainties in climate projections by minimizing drifts in baseline simulations.
\end{abstract}

\section{Introduction}

Ocean General Circulation Models (OGCMs) are fundamental tools in climate science, essential for understanding past climate variations and projecting future conditions.
These models require substantial computational resources, particularly during their spin-up phase to reach equilibrium, which requires
millions of CPU hours even at coarse spatial resolution.
This computational cost severely limits our ability to explore different parameter calibrations or perform large ensemble simulations necessary for uncertainty quantification.
Recent advances in deep learning have led to promising climate model emulators \citep{xihe2024, aouni2024glonetmercatorsendtoendneural, Kochkov_2024, ace2023} that can reproduce short-term dynamics with impressive accuracy while requiring significantly less computational resources. However, these emulators face two major limitations: their autoregressive nature leads to instability in long-term predictions, and their black-box nature makes them unsuitable for studying mechanisms of climate variability or performing sensitivity analyses.
In this work, we investigate whether deep generative models can help bridge this gap by directly producing physically consistent oceanic states, inspired by recent success in turbulent flow simulation \citep{yang2023zero}. Rather than attempting to emulate the temporal evolution of the system, we propose to generate states that can serve as initial conditions for numerical integration. This approach presents several challenges, particularly in ensuring that generated states respect both local physical constraints and global conservation laws.

We make the following contributions :
\begin{itemize}
    \item A generative framework for producing oceanic states that captures complex spatial patterns and vertical structure
    \item A method for enforcing physical constraints during the generation process
    \item Metrics and evaluation protocols for assessing the physical consistency of generated states and their viability as initial conditions for numerical integration
\end{itemize}




\section{Methods}


\begin{figure}[h]
    \includegraphics[width=\linewidth]{Figures/pipeline.png}
    \caption{Pipeline of the training and evaluation protocol. From left to right: training of the diffusion model using a database of stable states produced by our oceanic model, generation of initialization states from our diffusion model and temporal integration using numerical simulation, then evaluation of physical consistency on simulated trajectories.}
    \label{fig:pipeline}
\end{figure}

Our approach consists of three main components: (1) training a diffusion model to learn the distribution of oceanic states, (2) generating new states while enforcing physical constraints, and (3) validating these states through numerical integration. As illustrated in Figure \ref{fig:pipeline}, we first train our model on a dataset of states from the DINO configuration, each representing a snapshot of the ocean's temperature and salinity fields.

\textbf{Data :} This study utilizes data from the DINO \footnote{https://github.com/vopikamm/DINO} configuration,
an idealized configuration of the global ocean implemented in NEMO\footnote{https://www.nemo-ocean.eu/}.
DINO represents a simplified Atlantic basin with a zonally periodic Southern Ocean channel,
designed to capture key features of the global ocean circulation
such as the meridional overturning circulation (MOC) and the Antarctic Circumpolar Current (ACC), while maintaining computational efficiency.
The states are discretized on a 3D grid of size $Z \times W \times H$, where $Z=36$ represents vertical levels and $(W,H)=(199,62)$ the horizontal spatial dimensions. We use the index $k$ representing the depth level and the indices $(i,j)$ for the horizontal coordinates. While the original states contain multiple variables, we focus on two prognostic variables central to ocean dynamics: conservative temperature $T$ and absolute salinity $S$. These fields are concatenated to form our input state $X = (T \| S)$, $X_t$ being the state at timestep $t$.  Further details are provided in Appendix \ref{appendix:dataset}. %


\subsection{Generative model and physical constraints}

We base our approach on denoising diffusion probabilistic models (DDPM) \citep{ho2020denoising} %
which has shown promising results for generating complex physical fields \citep{yang2023zero}. Formally, we train a denoising model $\epsilon_\theta(x_s, s)$ to predict the noise added to the data, where
$s \in [1,S]$ represents the diffusion step. See details in Appendix \ref{appendix:diffusion model}.

\textbf{Physical constraints :}
generated states from diffusion models do not inherently respect the physical %
characteristics of variables as produced by the ocean model.
Rather than imposing these constraints through architecture design or additional training losses, we propose to enforce them during the sampling process through a guided generation approach.

Given a constraint function $C(x) : \mathbb{R}^{Z \times W \times H} \to \mathbb{R}$ defined over our 3D fields, we modify the sampling step by adding the gradient of this constraint scaled by a function $\kappa(s)$:

\begin{equation}
    x_{s-1} = \alpha_s^{-\frac12}(x_s - \gamma_s\epsilon_\theta(x_s, s) )- \kappa(s) \nabla C(x_s) + \sigma_s \mathbf{z}
\end{equation}

where $\kappa(s)$ controls the strength of the constraint throughout the generation process, $\mathbf{z} \sim \mathcal{N}(0, \mathbf{I})$ and $(\gamma, \alpha, \sigma)$ are fixed by the noise scheduler (Appendix \ref{appendix:training}). This approach allows us to balance between respecting the learned distribution and enforcing physical constraints.


\textbf{Hydrostatic balance constraint :} a %
key
physical %
characteristic in variables produced by ocean models
is to ensure a hydrostatically stable stratification, where density should increase with depth. To enforce this, we propose a constraint that penalizes deviations from the vertical structure in our training data:

\vspace{-0.3cm}
\begin{align}
    C(x) &= %
    \sum_{k} ( \mu_k - \frac{1}{N}\sum_{i,j} x_{ijk})^2 %
\end{align}

where $\mu_k$ is the mean value for vertical layer $k$ computed over the training dataset (zero in our case due to normalization) and $N$ is the number of horizontal cells. This regularization acts as a soft constraint on the mean vertical profile, with $\kappa(s)$ allowing us to tune the trade-off between variability in generated states and strict enforcement of the vertical structure.

\section{Results}

Our evaluation follows two complementary approaches: first, an \textit{a priori} analysis of the generated states' physical properties and spatial patterns, and second, an \textit{a posteriori} analysis of their viability as initialization points for numerical integration in NEMO.




\begin{figure}[htb]
    \centering
    \includegraphics[height=0.22\textheight,keepaspectratio]{Figures/Diffusion_model_state.pdf}%
    \hfill
    \includegraphics[height=0.22\textheight,keepaspectratio]{Figures/Diffusion_model_rho.pdf}%
     \caption{Comparison between training data and generated states. Left panel: temperature and salinity fields at two different depth levels from the training data (left) and our diffusion model (right), showing the model's ability to capture complex spatial patterns. Right panel: zonally averaged sections of potential density computed from the temperature and salinity fields, comparing the statistical distribution from the training data (top) with generated samples (bottom).}
    \label{fig:res-1}
\end{figure}

 \textbf{Quality of generated states :} we demonstrate that our model successfully learns the complex spatial patterns present in oceanic states in Figure \ref{fig:res-1}. The generated fields exhibit realistic features such as the formation of cold and fresh water masses at high latitudes, the ventilation of warm and salty water masses near the tropics, while maintaining coherent vertical relationships between different depth levels. The density profiles further validate that the model captures the overall stratification structure of the global ocean.






\begin{table}[h]
\centering


\resizebox{\columnwidth}{!}{
\begin{tabular}{l|cc|cc|c}
\hline
& \multicolumn{2}{c|}{Bottom-Water} & \multicolumn{2}{c|}{Deep-Water} & Density \\
Source & $\mathcal{S}$ & $\mathcal{T}$ & $\mathcal{S}$ & $\mathcal{T}$ & Errors \\
\hline
Data & 35.2 $\pm$ 2.4e-5 & 4.7 $\pm$ 6.5e-3 & 35.3 $\pm$ 4.4e-4 & 2.6 $\pm$ 1.1e-2 & 0.4 $\pm$ 4.3e-2 \\
No Constraint & 35.2 $\pm$ 6.4e-2 & 4.7 $\pm$ 0.5 & 35.3 $\pm$ 8.0e-2 & 2.9 $\pm$ 1.0 & 26.8 $\pm$ 9.6 \\
\textbf{Constraint} & 35.2 $\pm$ 1.4e-3 & 4.7 $\pm$ 1.0e-2 & 35.3 $\pm$ 1.9e-3 & 2.6 $\pm$ 2.2e-2 & 1.8 $\pm$ 0.3 \\
\hline
\end{tabular}}
\caption{Statistical analysis of water mass properties and density stability.
Values are presented as mean $\pm\  \sigma$.
The first four columns show salinity and temperature averages in bottom and deep water masses (defined in \ref{appendix:metrics}).
The rightmost column show the percentage of ocean volume where static instability occurs (where denser water is above lighter water).}
\label{tab:water_masses}
\end{table}

\textbf{Impact of physical constraints} : we analyze the water mass properties generated by our model in comparison with the training data in Table \ref{tab:water_masses}. Following the methodology detailed in Appendix \ref{appendix:metrics}, we identified characteristic regions where we compute mean temperature and salinity, and departures from those. These regions are crucial drivers of the ocean dynamics, making their property distributions essential for the system's evolution. Additionally, we compute an error score that quantifies the occurrence of hydrostatic instabilities in the water column. Two key findings emerge from this analysis: the unconstrained model successfully generates fields with realistic spatial structure, and adding a hydrostatic constraint on the generated fields reduces density instabilities by an order of magnitude while maintaining the spatial structure.


\begin{figure}[htb]
    \centering
    \vspace{-0.1cm}
    \includegraphics[height=0.19\textheight,keepaspectratio]{Figures/Diffusion_model_rho_gen.pdf}%
    \hfill
    \includegraphics[height=0.19\textheight,keepaspectratio]{Figures/Diffusion_model_variance.pdf}%
    \caption{Effect of physical constraints on generation and temporal evolution. Top : unconstrained generation; bottom : generation with hydrostatic constraint. Left to right: initial density profiles from generated states, density profiles after 10 years of NEMO integration, spatial variance of sea surface temperature and salinity in generated samples. The constraint successfully realistic stratification at the cost of reduced variability in the generated states.}
    \label{fig:res-2}
\end{figure}
\vspace{-0.22cm}

We illustrate the crucial role of our physical constraints in Fig.\ref{fig:res-2}, without constraints, while the generated states may appear realistic, their density profiles can violate physical principles, leading to numerical instabilities during integration and/or excessive vertical diffusion. The constrained generation produces states that not only respect physical principles but also lead to stable long-term integration in NEMO. The temporal evolution revealed by 10-year integrations shows that unconstrained states tend to drift significantly from their initial conditions, while constrained states maintain physically consistent trajectories closer to the training distribution. However, this improved stability comes at the cost of reduced variability in the generated states, as shown by the decreased variance in surface fields. This trade-off between physical consistency and diversity is a key challenge in the application of generative models to physical systems. %
\vspace{-0.3cm}

\section{Conclusion}

In this work, we have demonstrated that deep generative models can produce physically consistent oceanic states suitable for numerical integration. By developing methods to enforce physical constraints during generation, we show how to balance between respecting learned patterns and maintaining necessary physical properties. Our evaluation reveals the impact of generated initial state properties on the long-term system evolution, justifying our approach of using numerical integration as a validation tool. Furthermore, our results highlight important trade-offs between state diversity and physical consistency.

This exploratory work opens several promising directions. Future developments could focus on making the model conditional on physical parameters, enabling its use for ensemble generation and uncertainty quantification. More sophisticated physical constraints could be developed to better preserve conservation laws while maintaining state diversity. Additionally, comprehensive comparison with traditional spin-up methods would help position this approach in the broader context of climate modeling.


\bibliographystyle{plainnat}
\bibliography{references}

\appendix

\input{appendix}

\end{document}
