\section{Data Collection}\label{sec:data}
To study the Ethereum blob market, we gather three different types of data: Ethereum blockchain, PBS, and Ethereum mempool data. Our data collection spans the range from block 19,426,589 -- the block marking the Dencun hardfork that introduced blobs on March 13, 2024 -- to block 20,866,918, capturing the final block as of September 30, 2024. Consequently, this dataset encompasses the entire timeline of the blob market's activity up until the end of September 2024. %

\paragraph{Ethereum Blockchain}
We run a Reth execution layer node~\parencite{reth2024} and a Lighthouse consensus layer node~\parencite{sigmaprime2024lighthouse} to gather Ethereum blockchain data. We parse the blockchain for blob transactions, recording relevant details such as the number of blobs submitted and the fees paid. Type-3 transactions pay fees for both regular Ethereum gas in the EIP-1559 market (base and priority fees) and blob gas in the EIP-4844 market (blob base fee). Additionally, transactions may tip block fee recipients via direct transfers.

\paragraph{PBS}
We collect data from eight relays that were active during the study period: Aestus, Agnostic, bloXroute (Max Profit), bloXroute (Regulated), Eden, Flashbots, Manifold, and UltraSound. These relays provide public APIs that allow access to the blocks they deliver to proposers. We use the PBS data to obtain information about the block builder. The reason we use this builder-specific information is to investigate whether specific block builders have different strategies on (optimal) transaction choice with blob transactions.

\paragraph{Ethereum Mempool}
Finally, we gather Ethereum mempool data from the Mempool Dumpster project~\parencite{flashbots2024mempool}. The mempool data allows us to observe the blob mempool, i.e., the blobs waiting for block inclusion in the public P2P network, so that we can then analyze the efficiency of blob inclusion for each builder and the waiting time for blob transactions to be posted on-chain.
It is important to note that there is minimal private submission of blob transactions throughout the entire period, and negligible during the congested periods that we focus on (for methodological details, we refer the interested reader to Appendix~\ref{app:private}).



\section{Blob Adoption}
We commence our analysis by analyzing the adoption of blobs. \Cref{fig:adoption2} visualizes the daily number of blobs included on Ethereum along with the daily target (left y-axis). While we notice a general increase in the daily number of blobs, the number of blobs has not sustainably reached the target. Instead, they have only approached the target on two occasions: (1) the Blobscription heavy interest period (``craze'') starting at the end of March 2024~\parencite{nijkerk2024ethereum} and (2) the LayerZero airdrop on Arbitrum on June 20, 2024~\parencite{stevens2024arbitrum}. During these demand increases, we also observe very significant spikes in the blob base fee (see right y-axis in Figure~\ref{fig:adoption2}). Astonishingly during the second incident blob fees increase by nearly 15 orders of magnitude from $1$~wei (the minimum blob base fee) to $10^{15}$~wei. However, while there was little variance (except for the individual incidents) in the first two months of the blob market, the blob base fee variance has risen from June 2024 along with the general increase in blob usage. At the same time, this variance has come down slightly in the past months as demand for blobs has also decreased again. Given that there is no sustained demand for blobs at their target number, the blob base fees have generally been meager, as market economics of demand and supply would dictate.

\begin{figure}[t!]\vspace{-6pt}
    \centering
    \begin{subfigure}[t]{0.48\columnwidth}
    \centering
        \includegraphics[scale=1.15]{fc/figures/adoption2.pdf}
    \caption{Daily number of blobs (green line) and \textbf{daily} blob target (red line) on the left y-axis. We further plot the blob base fee (blue line) on the right y-axis.}
    \label{fig:adoption2}
    \end{subfigure}
    \hfill
    \begin{subfigure}[t]{0.49\columnwidth}
    \centering
        \includegraphics[scale=1.15]{fc/figures/shareOfBlobs.pdf}
    \caption{Daily share of blobs submitted by L2s. The biggest nine blob submitters are shown separately and the rest are grouped together. }
    \label{fig:shareOfBlobs}
    \end{subfigure}    \vspace{-6pt}
    \caption{Blob usage by L2s. Figure~\ref{fig:adoption2} shows the overall demand, while Figure~\ref{fig:shareOfBlobs} visualizes the individual blob usage of the biggest L2s.}\label{fig:adoption}
\end{figure}

In \Cref{fig:shareOfBlobs} we visualize the proportion of blobs posted by individual senders on a daily basis. The nine largest L2s, in terms of the total number of blobs submitted, are shown separately and ordered by size while the rest are grouped together. We start by noting that, generally, these nine L2s are responsible for more than 80\% of blob usage. This figure decreases slowly during our measurement period, indicating that blob demand has extended to a wider group of projects. Additionally, blob demand extended beyond the biggest L2s surrounding the Blobscription craze starting at the end of March 2024. In regards to the biggest L2s, we notice that Base consistently uses more than one-fifth of blobs daily, with Arbitrum being the second biggest blob user. After that, the picture becomes more fragmented with some L2s only starting to post blob a couple of months into our data collection window (e.g., Taiko) or losing market share with time (e.g., zkSync). Overall, the market appears to grow less concentrated over time. 



\subsection{Fees}
Recall, that since the introduction of blobs on Ethereum, the blob base fee has been very low outside of our two outlined major events that spiked demand. In the following, we analyze how the blob base fees paid by type-3 transactions compare to the fees they pay in the EIP-1559 fee market. \Cref{fig:fees} visualizes the cumulative fees paid by type-3 transactions. The cumulative EIP-4844 base fee paid increased abruptly on two occasions: Blobscriptions and the LayerZero airdrop. Outside of these events, the cumulative EIP-4844 base fee appears almost constant. The two EIP-1559 market fee components (base and priority fee) increase much more steadily. For both, we notice an increase in growth at the beginning of June 2024, which corresponds to a general increase in blob demand (see \Cref{fig:adoption2}). Overall, blob transactions have paid 1,020~ETH in the EIP-4844 base fee, 1,602~ETH in the EIP-1559 base fee, and 372~ETH in the EIP-1559 priority fee. While the 2,993~ETH (approximately US\$~8~M) paid in total fees by type-3 transaction initially appears large, this only amounts to 1\% of the fees paid on Ethereum in the same period. Furthermore, only the 372~ETH in priority fees are not burned given that no type-3 transaction has included a coinbase transfer. Thus, these 372~ETH are the sole financial incentive for block builders to include type-3 transactions (i.e., approx US\$~0.7 per block at the current ETH price). In contrast, the average fee revenue from a block is around US\$~200. These small financial incentives builders have to include type-3 transactions that hint at some of the present issues in the blob market (see \Cref{sec:issues}). 



\begin{figure}[t]\vspace{-6pt}
\centering

\begin{minipage}[t]{.48\linewidth}
    \centering
    \includegraphics[scale=1.2]{fc/figures/fees.pdf}\vspace{-6pt}
    \caption{Cumulative fees paid by blob transactions over time. We separate the EIP-4844 fee market (base fee) from the EIP-1559 fee market (base and priority fee).}
    \label{fig:fees}
\end{minipage}
\hfill
\begin{minipage}[t]{.48\linewidth}
    \centering
     \includegraphics[scale=1.2]{fc/figures/feesLayer0.pdf}\vspace{-6pt}
    \caption{Development of various fee components during the spike in blob demand caused by LayerZero airdrop on 20 June 2024.}
    \label{fig:feesLayer0}
\end{minipage}
\end{figure}

We further analyze how the various fee components react to a sudden spike in demand and plot the various fee components from 11:00 to 23:00 on 24 June 2024 in Figure~\ref{fig:feesLayer0}. For each blob transaction, we draw a dot for each of the three components. First note that while the EIP-4844 base fee increases by around 15 orders of magnitude within six hours, there is comparatively little movement in the EIP-1559 fee market. Blob transactions seem to increase their priority fees slightly (by around one order of magnitude), and the EIP-1559 base fee is largely unaffected given that blob transactions are only a small proportion of the overall transaction demand (i.e., blob transactions make up around 0.5\%). We further highlight that the EIP-1559 fees recovered a lot quicker, while it took some time for the EIP-4844 to come down again. In addition to taking a long time to recover, the base fee also took several hours to increase. This slow price discovery is a consequence of the blob base fee rule update rule (see \Cref{subsec:blob_fees}) taking more than ten blocks to increase or decrease by an order of magnitude. 

As a consequence of the slow price discovery, one would expect the rollups to compete in a first price auction~\parencite{buterin2024multidimensional,dataalways2024minimumblobfees}. However, we only mildly observe this behavior as the priority fee only changes by around one order of magnitude, which does not reflect the 15 orders of magnitude jump of the base fee. Additionally, to the best of our knowledge, our data indicates that none of the rollups moved to the original market and used calldata even though it would have been cheaper to do so---a sign that they were not prepared for such an extreme congestion event.

\subsection{Behavior of L2s}
\begin{figure}[t]\vspace{-6pt}
    \centering
    \includegraphics[scale=1.2]{fc/figures/numBlobs.png}\vspace{-6pt}
    \caption{Number of blobs submitted by the biggest nine L2s per type-3 transaction over time, each dot represents one type-3 transaction submitted by the respective L2. The grey vertical line indicates the spike in demand on 20 June 2024 related to the LayerZero airdrop. }
    \label{fig:numBlobs}
\end{figure}

In the following, we analyze the behavior of L2s when submitting type-3 transactions, focusing on the number of blobs per transaction and how this changes over time. Figure~\ref{fig:numBlobs} shows different strategies by L2s: Taiko and Scroll consistently submit one blob, while others, like Blast, Starknet, Linea, and zkSync, vary their blob counts. These four potentially adjust to demand on their own networks or demand for blobs. Finally, large L2s (e.g., Base, Arbitrum, Optimism) tend to use a fixed number of blobs but adjust their strategy over time. Potentially reacting to long-term changes in demand, and on specific occasions (i.e., the LayerZero airdrop indicated by the vertical gray line). One change we observed among most type-3 transaction senders is that starting around June 2024, many of them either diversified how they submit type-3 transactions or adjusted their strategy. This is likely a result of the long-term increase in demand picking up in June 2024. For example, Base and Optimism moved from submitting six blobs per transaction, i.e., taking up the entire blob space in a block, to only submitting five per transaction, i.e., leaving space for one additional blob. Arbitrum similarly adjusted from submitting six blobs per transaction to three. These adjustments could also be related to delays experienced as a result of inefficiencies in the blob market which we will discuss in detail in Section~\ref{sec:issues}.




Next, we consider the priority fees and gas usage of type-3 transactions in the EIP-1559 market (see \Cref{fig:gas}). Recall, that type-3 transactions, in addition to paying for the blobs they include, also pay fees in the EIP-1559 market for any gas they use. In \Cref{fig:gas_used}, we make a violin plot of the gas usage of the biggest L2s for their type-3 transactions. Note that a violin plot combines a boxplot, which displays the lower quartile, median, and upper quartile, with a kernel density plot to represent the distribution of values. Base, Optimism, and Blast consistently use the minimum amount of gas possible on Ethereum: 21,000~\parencite{wood2014yellowpaper}. Note that these are all optimistic rollups, i.e., they only post data. The two further optimistic rollups (i.e., Arbitrum and Taiko) have significantly higher gas usage but that of Arbitrum is still extremely consistent. For the four zk rollups (i.e., Scroll, Starknet, Linea, zkSync), we generally observe a higher gas usage with higher variance. Note that this is expected as zk rollups execute validity proofs that verify the execution of their transactions. 

\begin{figure}[t]\vspace{-6pt}
    \centering
    \begin{subfigure}[t]{1\columnwidth}
        \includegraphics[scale=1.2,right]{fc/figures/gas_used.pdf}
    \caption{gas usage}
    \label{fig:gas_used}
    \end{subfigure}    
    \begin{subfigure}[t]{1\columnwidth}
        \includegraphics[scale=1.2,right]{fc/figures/prio.pdf}
    \caption{priority fee}
    \label{fig:prio}
    \end{subfigure}
    \begin{subfigure}[t]{1\columnwidth}
        \includegraphics[scale=1.2,right]{fc/figures/inclusionDelayMs.pdf}
    \caption{inclusion delay}
    \label{fig:inclusionDelayMs}
    \end{subfigure}\vspace{-6pt}
    \caption{Distribution of priority fee (see Figure~\ref{fig:prio}), gas usage (see Figure~\ref{fig:gas_used}) and inclusion delay  (see Figure~\ref{fig:inclusionDelayMs}) of type-3 transactions submitted by the nine biggest L2s.}\label{fig:gas}    
\end{figure}

Regarding priority fees, we also observe different patterns between the biggest type-3 transaction senders (see Figure~\ref{fig:prio}). Scroll and Starknet consistently have extremely low priority fees with averages of 0.07 and 0.1~gwei respectively. Note that all type-3 transactions from these two senders are below 1~gwei which is the minimum priority fee accepted by the geth builder~\parencite{szilagyi2024tweet5} -- the biggest execution layer client~\parencite{etheralpha2024}. The remaining senders all have similar priority fees between 1.5~gwei and 3.5~gwei but different distributions. Interestingly, type-3 transactions only have 1.9~gwei average priority fee, and around 20\% have a priority fee below 1~gwei. Further, this figure is also lower than the average priority fee of all transactions (i.e., 3.2~gwei during the same period). 


We further note that the L2s that posted type-3 transactions with different numbers of blobs consistently for an extended period often do not increase the priority fee depending on the number of blobs they include. As we show in Appendix~\ref{app:prio}, there is no clear positive correlation between the number of blobs and the priority fees for all of them. 

Finally, we visualize the inclusion delay in seconds for each of the biggest nine blob posters in Figure~\ref{fig:inclusionDelayMs}. Taiko type-3 transactions wait for the shortest time on average with ten seconds, two seconds less than the time between two blocks. On, the other hand, Linea type-3 transactions wait for 100 seconds on average, i.e., more than eight blocks. Interestingly, Scroll and Starknet which have the lowest priority fees, do not wait for block inclusion significantly longer than many of the other senders that pay much higher priority fees.


\section{Inefficiencies in the Blob Market}\label{sec:issues}
In the previous sections, we hinted at L2s potentially adjusting the number of blobs they include per transaction to respond to the delay they possibly experience as a result of inefficiencies in the blob market. We look into these issues in this section.

\subsection{Block Packing}
Recall that there is space for at most six blobs in a block and that each transaction can include between one and six blobs. Solving the packing problem optimally is equivalent to solving knapsack which is NP-hard to optimally solve. On the other hand, a naive, greedy implementation would sort type-3 transactions by priority fee and select transactions as long as there is still space. To see why this is not optimal consider the following example where each transaction is a tuple $(\textsc{gas\_usage},$$\textsc{num\_blobs},$$ \textsc{priority\_fee})$: there are three type-3 transactions represented by $(1,5,2)$, $(1,3,1.99)$ and $(1,3,1.99)$. The naive algorithm would choose the first transaction but would have no space to include the other two while the optimal algorithm (assuming there is enough gas) would pick the last two transactions and receive nearly double the fees (i.e., 3.98 instead of 2).

Despite the worst-case infeasibility of solving knapsack (an NP-hard problem), since there is only space for six blobs, one can actually \emph{easily} solve the blob packing problem optimally and reasonably quickly. We do these calculations to investigate whether blobs in blocks were optimally packed with respect to the builder's fee income. In case they were not, we quantify the suboptimality, which at times reaches high double-digit percentages (up to 70\% suboptimal).
For this, we use the mempool data to determine which type-3 transactions were waiting in the mempool. Importantly, we consider only type-3 transactions that were included in a later block and were first observed in the mempool at least four seconds before the block's expected time, but no more than 120 seconds prior. This ensures the block builder had sufficient time to see the type-3 transaction and that it was unlikely to be cleared from the builderâ€™s local mempool. We further note that most transactions are submitted to the public mempool except for type-3 transactions from Taiko being submitted privately starting from September 2024 (see Section~\ref{app:private}). Finally, we exclude blocks without blobs from this analysis as not including blobs by the block builder might be a choice. In summary, whenever we observe suboptimal blob packing we can be fairly certain that it was suboptimal but the actual suboptimality may have been slightly \emph{higher}.

\begin{figure}[t!]\vspace{-6pt}
    \centering
    \begin{subfigure}[t]{0.49\columnwidth}
    \centering
        \includegraphics[scale=1.2]{fc/figures/optimal.pdf}
    \caption{PBS}
    \label{fig:optimal}
    \end{subfigure}\hfill
    \begin{subfigure}[t]{0.49\columnwidth}
    \centering
        \includegraphics[scale=1.2]{fc/figures/vanilla.pdf}
    \caption{non-PBS}
    \label{fig:vanilla}
    \end{subfigure}\vspace{-6pt}    
    \caption{Daily breakdown of blocks by blob packing: suboptimal, optimal, matching naive and optimal algorithms (``unknown''), or out of gas with optimal packing. Figure~\ref{fig:optimal} shows the breakdown for PBS blocks and Figure~\ref{fig:vanilla} for non-PBS blocks.}\label{fig:optimalpacking}
\end{figure}

We start by analyzing what proportion of blocks are packed optimally, suboptimally, whether the naive algorithm achieves the same result as the optimal one (i.e., what we call ``unknown''), or whether the block would exceed the maximum allowable gas in an Ethereum block with the optimal blob packing\footnote{Therefore, in this ``out of gas'' case, the builder has a clear reason not to include this particular transaction combination yielding the optimal blob packing, as it would lead other potentially profitable bundles to not be able to be included in the built block.} (i.e., what we call ``out of gas''). We do the analysis both for block build through PBS (see Figure~\ref{fig:optimal}) as well as non-PBS blocks (see Figure~\ref{fig:vanilla}). We start by noting that on average there are 1.9 blobs per block for PBS blocks and 2.2 blobs per block for non-PBS blocks. Further, PBS blocks are built by specialized builders, while non-PBS blocks are less likely to be. 

Thus, one would expect blobs in PBS blocks to be packed optimally with respect to the block builder's fee income. In \Cref{fig:optimal}, we notice that this is stunningly not the case. Instead, we can only be sure that 19\% of blocks PBS had an optimal blob packing, while 44.6\% had a suboptimal packing. Furthermore, only a very minor proportion of blocks would exceed the gas limit with optimal blob packing, running into an execution layer restriction that would prevent them from including the income-optimal number of blobs. In general, we notice that over time the proportion of suboptimal blocks has decreased, while the proportion of blocks where it is unknown whether the blob packing algorithm is optimal is increasing. In part, this could be due to type-3 transactions including fewer blobs on average over time (see Figure~\ref{fig:numBlobs}). Additionally, there may be several reasons why specialized builders pack blobs suboptimally.
For one, the investment into an optimal blob building might not be worth it given the low fee revenue (see Figure~\ref{fig:fees}).
Another possibility is related to a race condition (time taking for blocks with more data, i.e., blobs, to propagate across clients) and timing games being played by builders submitting late blocks into the slot to the PBS system. Builders might submit blocks with a varying number of blobs to relays, hence for latency reasons, sometimes blocks with no blobs win the PBS auction and get published instead of their blob-including counterparts.

Figure~\ref{fig:vanilla} visualizes the same data for non-PBS blobs. We notice that while there are more suboptimal blocks (i.e., 47\% on average) and less optimal blocks (i.e., 9\% on average), the difference between PBS and non-PBS blocks is not significant in terms of blob packing. This contrasts with the comparison of the two in terms of overall fee revenue, MEV, etc.~\parencite{heimbach2023ethereum}. 

Finally, notice that the number of suboptimal blocks peaked at the end of March 2024 during the Blobscriptions craze -- the first peak in blob demand. In the following, we investigate the effects of these suboptimal blob packings in detail (see Figure~\ref{fig:issues}). We start by analyzing the delay in Figure~\ref{fig:delay} and notice that in general, the blobs do not have to wait more than two blocks as a result of suboptimal blob packing. The one big exception is the Blobscriptions craze starting at the end of March 2024, during this period type-3 transactions were delayed by an average of more than eight blocks as a result of suboptimal packings. Regarding loss in fee revenue for the builders of blocks with suboptimal blob packings, we observe a slightly different packing. In general, with time the relative loss decreases. Further, the relative loss is highest during the Blobscriptions craze reaching a relative loss of 70\%. There is a further increase in the relative loss during the increase in blob demand starting at the beginning of June which peaked during the LayerZero airdrop at the end of June. 







\begin{figure}[t!]\vspace{-6pt}
    \centering
    \begin{subfigure}[t]{0.49\columnwidth}
    \centering
        \includegraphics[scale=1.2]{fc/figures/delay.pdf}
    \caption{type-3 transaction delay}
    \label{fig:delay}
    \end{subfigure}\hfill
    \begin{subfigure}[t]{0.49\columnwidth}
    \centering
        \includegraphics[scale=1.2]{fc/figures/loss.pdf}
    \caption{relative blob priority fee loss}
    \label{fig:loss}
    \end{subfigure}\vspace{-6pt}
    \caption{Delay (see Figure~\ref{fig:delay}) and relative blob priority fee loss (see Figure~\ref{fig:loss} as a result of suboptimal blob packing. }\label{fig:issues}
\end{figure}



\subsection{Market Design Issue: Subset Bidding}
\label{subsec:market}

Beyond the above blob packing issues, a different but related---this time fundamental to market design---problem has to do with the transaction format of blob inclusion.
In short, recall that a blob (also known as type-3) transaction on Ethereum contains a number of blobs, between 1 and 6 blobs. Only 6 blobs may be included per block, regardless of the number of transactions.
The key part is that, if a blob transaction is included, then \emph{all blobs it contains must be included} in the block (self-evidently).
Consider, then, what would happen in the case that a transaction with a large number of blobs (e.g., 6) is submitted (showcasing a large demand for blobs from the submitter) and at the same time, a smaller but \emph{sufficiently higher-paying} transaction is already in the mempool (e.g., this transaction has high priority for only including 1 blob). Since the Ethereum block has a six-blob limit, none of the blobs from the larger transaction would be included, and only one blob would make it into the block; this is clearly and grossly inefficient.



A straightforward solution would be for the submitter to instead submit six transactions with only one blob requested in each (or any other subdivision they might deem appropriate).
However, this is an incomplete solution in that there is at least two issues with it: first, it would cause mispricing in the execution market: now, additional EIP-1559 gas would \emph{have} to be consumed; this would therefore be suboptimal.
Second, suppose for some reason\footnote{There is a natural motivation for providers wanting such adjusted utility functions for blob inclusions in more intricate settings that include, e.g., coordination of multiple rollups.} the submitter had super-additive value for simultaneous inclusion of multiple of their blobs at the same block; this naive solution would \emph{not allow} the submitter to provide such a super-additive premium for including more than one blob of theirs.
The reason for this is that, among a number of blob transactions, a block builder or validator may include their favorite subset of these.\footnote{Such a more "global" optimization on part of the block builder might make it optimal for them, in such a secnario of the naive solution, not to include blob transactions in the intended sequence by the submitting rollup or otherwise blob submitter.}



