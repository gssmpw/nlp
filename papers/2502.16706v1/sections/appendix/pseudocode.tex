\section{Pseudocode for \decomp}
\begin{algorithm}[h!]
\caption{Dynamic Decomposition}
\label{alg:dynamic_decomposition}
\begin{algorithmic}[1]
    \STATE {\bfseries Input:} Problem instance $\textcolor{algcolor3}{x}$, reward model $\textcolor{algcolor4}{r}$, 
    partition function $\textcolor{algcolor6}{f}$, LLM policy model $\textcolor{algcolor6}{\pi}$,  
    partition fraction $\textcolor{algcolor6}{\alpha}$, solution budget $\textcolor{algcolor6}{B}$, priority metric $\textcolor{algcolor5}{h}$, 
    metric stopping precision $\textcolor{algcolor5}{\theta}$, sampling stopping threshold $\textcolor{algcolor4}{\sigma}$, 
    is inference mode \textbf{b}\textsubscript{\text{inference}}
    \STATE {\bfseries Output:} Final decomposition $\textcolor{algcolor6}{D}$

    \STATE Initialize $\textcolor{algcolor6}{D} \gets \{\text{generated\_solutions}: \varnothing, \text{decomposition}: \varnothing\}$
    \STATE \textcolor{algcolor1}{\# Decompose the solution recursively until we reach the desired precision $\textcolor{algcolor5}{\theta}$ or run out of budget $\textcolor{algcolor6}{B}$}
    \WHILE{$| \textcolor{algcolor6}{D}.\text{generated\_solutions} | < \textcolor{algcolor6}{B}$}
        \STATE $\textcolor{algcolor3}{y_{\text{intermediate}}} \gets \text{Concatenate}([ \text{step.step\_str} \ \forall \ \text{step} \in \textcolor{algcolor6}{D}.\text{decomposition} ])$ 
        \STATE \hspace*{\fill} \textcolor{algcolor2}{$\vartriangleright$ Concatenate previous steps to form intermediate solution}
        \STATE $\textcolor{algcolor4}{R_{\text{new}}} \gets \varnothing$ \hspace*{\fill} \textcolor{algcolor2}{$\vartriangleright$ Record rewards of completions}
        \STATE $\textcolor{algcolor3}{\text{best}.y_{\text{final}}} \gets \text{None}$, $\textcolor{algcolor3}{\text{best}.y_{\text{completion}}} \gets \text{None}$,  $\textcolor{algcolor4}{\text{best}.r} \gets -\infty$ 
        \hspace*{\fill} \textcolor{algcolor2}{\hspace*{\fill} $\vartriangleright$ Track the best completion}

        \STATE \textcolor{algcolor1}{\# Step 1: Generate completions until we have enough samples to estimate the splitting metric. Here we use a geometric sampling distribution}
        \WHILE{$\operatorname{sum}( \textcolor{algcolor4}{R_{\text{new}}} ) < \textcolor{algcolor4}{\sigma}$}
            \STATE $\textcolor{algcolor3}{y_{\text{completion}}} \gets \textcolor{algcolor6}{\pi}(\cdot | \textcolor{algcolor3}{x}, \textcolor{algcolor3}{y_{\text{intermediate}}})$
            \STATE $\textcolor{algcolor3}{y_{\text{proposed}}} \gets \textcolor{algcolor3}{y_{\text{intermediate}}} \oplus \textcolor{algcolor3}{y_{\text{completion}}}$
            \STATE Append $\textcolor{algcolor3}{y_{\text{proposed}}}$ to $\textcolor{algcolor6}{D}.\text{generated\_solutions}$
            \STATE $\textcolor{algcolor4}{r_{\text{proposed}}} \gets \textcolor{algcolor4}{r}(\textcolor{algcolor3}{y_{\text{proposed}}})$
            \STATE Append $\textcolor{algcolor4}{r_{\text{proposed}}}$ to $\textcolor{algcolor4}{R_{\text{new}}}$
            \IF{$\textcolor{algcolor4}{r_{\text{proposed}}} > \textcolor{algcolor4}{\text{best}.r}$}
                \STATE $\textcolor{algcolor3}{\text{best}.y_{\text{final}}} \gets \textcolor{algcolor3}{y_{\text{proposed}}}$, $\textcolor{algcolor3}{\text{best}.y_{\text{completion}}} \gets \textcolor{algcolor3}{y_{\text{completion}}}$
                \STATE $\textcolor{algcolor4}{\text{best}.r} \gets \textcolor{algcolor4}{r_{\text{proposed}}}$
            \ENDIF
            \IF{$\textbf{b}_{\text{inference}} \ \textbf{and} \ \textcolor{algcolor4}{r_{\text{proposed}}} = 1.0$} 
                \STATE Append $\{\text{step\_str}: \textcolor{algcolor3}{y_{\text{completion}}} \}$ to $\textcolor{algcolor6}{D}.\text{decomposition}$
                \STATE \textbf{Return} $\textcolor{algcolor6}{D}$ \hspace*{\fill} \textcolor{algcolor2}{$\vartriangleright$ Exit if problem is solved}
            \ENDIF
        \ENDWHILE

        \STATE \textcolor{algcolor1}{\# Step 2: Compute splitting metric}
        \STATE $\textcolor{algcolor5}{z_{\text{new}}} \gets \textcolor{algcolor5}{h}(\textcolor{algcolor4}{R_{\text{new}}})$
        \STATE $\textcolor{algcolor5}{z_{\text{last}}} \gets \textcolor{algcolor6}{D}.\text{decomposition}[-1].\textcolor{algcolor5}{z} \ \textbf{if} \ \textcolor{algcolor6}{D}.\text{decomposition} \neq \varnothing \ \textbf{else} \ -\infty$

        \STATE \textcolor{algcolor1}{\# Step 3: Split the step with the higher metric}
        \STATE \textbf{b}\textsubscript{\text{split new step}} $\gets$ $\textcolor{algcolor5}{z_{\text{new}}} \geq \textcolor{algcolor5}{z_{\text{last}}}$
        \STATE $\textcolor{algcolor3}{y_{\text{target step}}} \gets \textcolor{algcolor3}{\text{best}.y_{\text{completion}}} \ \textbf{if} \ \textbf{b}\textsubscript{\text{split new step}} \ \textbf{else} \ \textcolor{algcolor6}{D}.\text{decomposition}[-1].\text{step\_str}$
        
        \STATE $\textcolor{algcolor3}{y_1}, \textcolor{algcolor3}{y_2} \gets \textcolor{algcolor6}{f}(\textcolor{algcolor3}{y_{\text{target step}}}, \textcolor{algcolor6}{\alpha})$
        \IF{$\textcolor{algcolor3}{y_1} = \text{None} \ \textbf{or} \ \textcolor{algcolor3}{y_2} = \text{None}$}
            \STATE Append $\{\text{step\_str}: \textcolor{algcolor3}{y_{\text{completion}}}, \text{metric}: \textcolor{algcolor5}{z_{\text{new}}} \}$ to $\textcolor{algcolor6}{D}.\text{decomposition}$
            \STATE \textbf{Return} $\textcolor{algcolor6}{D}$ \hspace*{\fill} \textcolor{algcolor2}{$\vartriangleright$ Exit if we cannot do a finer split}
        \ENDIF
        \IF{$\textbf{b}_{\text{split new step}}$} 
            \STATE Append $\{\text{step\_str}: \textcolor{algcolor3}{y_1}, \text{metric}: \textcolor{algcolor5}{z_{\text{new}}} \}$ to $\textcolor{algcolor6}{D}.\text{decomposition}$
            \hspace*{\fill} \textcolor{algcolor2}{$\vartriangleright$ Add new step}
            \IF{$\textcolor{algcolor5}{z_{\text{new}}} < \textcolor{algcolor5}{\theta}$} 
                \STATE Append $\{\text{step\_str}: \textcolor{algcolor3}{y_2} \}$ to $\textcolor{algcolor6}{D}.\text{decomposition}$
                \STATE \textbf{Return} $\textcolor{algcolor6}{D}$ \hspace*{\fill} \textcolor{algcolor2}{$\vartriangleright$ Exit if all metrics are smaller than precision}
            \ENDIF
        \ELSE 
            \STATE $\textcolor{algcolor6}{D}.\text{decomposition}[-1] \gets \{\text{step\_str}: \textcolor{algcolor3}{y_1}, \text{metric}: \textcolor{algcolor5}{z_{\text{last}}} \}$
            \hspace*{\fill} \textcolor{algcolor2}{$\vartriangleright$ Split last step}
        \ENDIF
    \ENDWHILE

    \STATE \textbf{Return} $\textcolor{algcolor6}{D}$
\end{algorithmic}
\end{algorithm}


\newpage