
\section{Rademacher Bounds}
\label{sec:rademacher}
In this section, we use Rademacher complexity and the contraction inequality to prove Lemma~\ref{lem:supPhi}. We focus on bounding~\eqref{eq:phi} and note that~\eqref{eq:rho} is handled symmetrically.

%\begin{customlem}{\ref{lem:supPhi}}
%There are constants $c,c'>0$ such that with probability at %least $1-\delta$ over $\rS \sim \cD^n$ we have
%\begin{align*}
%\sup_{w \in \subH(\Gamma_i,L_j)} \left| \E_{(\rx,\ry) \sim \cD}%[\phi(\ry \langle w, \rx \rangle)] -\E_{(\rx,\ry) \sim \rS}%[\phi(\ry \langle w, \rx \rangle)]\right| &\leq\\
%c\exp(-\gamma_{i+1}^2k/c) \cdot \sqrt{\frac{k + %\gamma_{i+1}^{-2} + \ln(e/\delta)}{n}},
%\end{align*}
%provided that $k \geq c' \gamma_{i+1}^2$. The same bound holds %with $\rho$ in place of $\phi$.
%\end{customlem}
For a training set $S \in (\finalX \times \{-1,1\})^n$, consider the empirical Rademacher complexity (for $\rsigma=(\rsigma_1,\dots,\rsigma_{n})$ a vector of independent and uniform variables in $\{-1,1\}$):
\begin{align*}
\hat{\Rad}_{\phi, \subH(\Gamma_i,L_j)}(S) &= \frac{1}{n} \cdot \E_{\rsigma}\left[ \sup_{w \in \subH(\Gamma_i,L_j)} \sum_{(x_i,y_i) \in S} \rsigma_i \phi(y_i \langle w, x_i \rangle )\right] \\
&\leq \frac{1}{n} \cdot \E_{\rsigma}\left[ \sup_{w \in \finalH} \sum_{(x_i,y_i) \in S} \rsigma_i \phi(y_i \langle w, x_i \rangle )\right]
\end{align*}
If $\phi$ is $L_\phi$-Lipschitz, then the contraction inequality from~\cite{ledoux1991probability} gives that
\[
\hat{\Rad}_{\phi, \finalH}(S) \leq \frac{L_\phi}{n} \cdot \E_{\rsigma}\left[ \sup_{w \in \finalH} \sum_{(x_i,y_i) \in S} \rsigma_i y_i \langle w, x_i \rangle  \right].
\]
Using Cauchy-Schwartz, this is bounded by
\begin{align*}
\hat{\Rad}_{\phi, \finalH}(S) \leq& \frac{L_\phi}{n} \cdot  \E_{\rsigma}\left[ \sup_{w \in \finalH}  \left\langle w, \sum_{(x_i,y_i) \in S}\rsigma_i y_i x_i \right\rangle  \right] \\
\leq& \frac{L_\phi}{n} \cdot \left(\sup_{w \in \finalH} \|w\|_2\right) \cdot \E_{\rsigma}\left[\left\| \sum_{(x_i,y_i) \in S}\rsigma_i y_i x_i\right\|_2 \right] \\
\leq& \frac{L_\phi}{n} \cdot \sqrt{\E_{\rsigma}\left[\left\| \sum_{(x_i,y_i) \in S}\rsigma_i y_i x_i\right\|_2^2 \right]}\\
=& \frac{L_\phi}{\sqrt{n}} \cdot \sqrt{\sum_{(x_i,y_i) \in S} \sum_{(x_j,y_j) \in S} \E_\sigma[\sigma_i \sigma_j] y_i y_j \ipr{x_i, x_j}} \\
=& \frac{L_\phi}{\sqrt{n}}.
\end{align*}
Since this inequality holds for all $S$ with each $(x,y) \in S$ satisfying $\|x\|_2 = 1$, we have for the distribution $\cD$ that the Rademacher complexity
\[
\Rad_{\cD,\phi,\finalH}(n) = \E_{\rS \sim \cD^n}[\hat{\Rad}_{\phi,\finalH}(\rS)]
\]
satisfies $\Rad_{\cD,\phi,\finalH}(n) \leq L_\phi/\sqrt{n}$. By Lemma~\ref{lem:concdiscretize} and $\gamma_i = \gamma_{i+1}/2$, we have that $\phi$ is bounded by 
\[
0 \leq \phi(\alpha) \leq \max_{-c_\gamma \leq \alpha \leq 0}\Pr_{\rA, \rt}[y \langle h_{\rA,\rt}(w), \rA x\rangle > \gamma_i/2 \mid y \langle w, x \rangle = \alpha] \leq c\exp(-k\gamma_{i+1}^2/c),
\]
for a constant $c>0$. We conclude from standard results on Rademacher complexity (see e.g.~\cite{rademacherbound}), that with probability $1-\delta$ over a sample $\rS \sim \cD^n$ it holds that
\begin{align*}
\sup_{w \in \subH(\Gamma_i,L_j)} \left| \E_{(\rx,\ry) \sim \cD}[\phi(\ry \langle w, \rx \rangle)] -\E_{(\rx,\ry) \sim \rS}[\phi(\ry \langle w, \rx \rangle)]\right| \leq& \\
2 \Rad_{\cD,\phi,\finalH}(n) + c_R\left(c\exp(-k\gamma_{i+1}^2/c)\sqrt{\frac{\ln(1/\delta)}{n}} \right) \leq&\\
\frac{2 L_\phi}{\sqrt{n}} + c_R\left(c\exp(-k\gamma_{i+1}^2/c)\sqrt{\frac{\ln(1/\delta)}{n}} \right).
\end{align*}
where $c_R>0$ is a constant. Symmetric arguments bounds $\rho$ by the same, with the Lipschitz constant $L_\rho$ of $\rho$ in place of $L_\phi$.

We now use the following bound on the Lipschitz constants of $\phi$ and $\rho$
\begin{lemma}
\label{lem:finalLip}
There are constants $c_L, c>0$ such that the Lipschitz constants $L_\phi$ and $L_\rho$ of $\phi$ and $\rho$ are bounded by
\[
c_L \exp(-\gamma_{i+1}^2 k/c_L)\cdot \left(\sqrt{k} + \gamma^{-1}_{i+1}\right),
\]
when $k \geq c \gamma_{i+1}^{-2}$.
\end{lemma}
We prove this lemma in the next section. We thus conclude that with probability at least $1-\delta$ over $\rS \sim \cD^n$, we have
\begin{align*}
\sup_{w \in \subH(\Gamma_i,L_j)} \left| \E_{(\rx,\ry) \sim \cD}[\phi(\ry \langle w, \rx \rangle)] -\E_{(\rx,\ry) \sim \rS}[\phi(\ry \langle w, \rx \rangle)]\right| \leq& \\
2 \cdot \frac{c_L \exp(-\gamma_{i+1}^2k/c_L)\left(\sqrt{k} +\gamma^{-1}_{i+1}\right)}{\sqrt{n}} + c_R \left(c \exp(-k \gamma_{i+1}^2/c) \sqrt{\frac{\ln(1/\delta)}{n}} \right).
\end{align*}
The same bound holds for $\rho$ via Lemma~\ref{lem:finalLip}, which completes the proof of Lemma~\ref{lem:supPhi}.