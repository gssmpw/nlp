\section{Within Constant Factors}
\label{sec:withinconstant}
In this section we prove
\begin{customlem}{\ref{lem:subgoal2}}
There is a constant $c>1$, such that for any $0 < \delta < 1$ and any $\Gamma_i = (\gamma_i, \gamma_{i+1}]$, it holds with probability at least $1-\delta$ over a random sample $\rS \sim \cD^n$ that
\begin{align*}
\forall w \in \finalH : \Loss_{\rS}^{\gamma_i}(w) \geq \frac{\Loss_{ \cD}^{(3/4)\gamma_i}(w)}{4} - c \left(\frac{\ln(e\gamma_{i+1}^2 n)}{\gamma_{i+1}^2 n} - \frac{\ln(e/\delta)}{n}\right).
\end{align*}
\end{customlem}
The proof follows mostly the ideas in~\cite{SVMbest} that were outlined in the proof overview in Section~\ref{sec:overview}. 

\begin{proof}
Let $k \geq 1$ be a parameter to be determined and consider the random construction of $\rA$ and $\rt$ as defined in Section~\ref{sec:mainargs}. Let $\Disc_a$ be defined as in Section~\ref{sec:meetinmid}, i.e.\ $\Disc_a$ contains all vectors in $2^a \cdot 4 \Ball_2^k$. We say that a matrix $A$ in the support of $\rA$ and a training set $S$ is $\alpha$-\emph{unusual}, if there is a vector $w \in \Disc_0$ such that
\[
\Loss_{A S}^{(7/8)\gamma_i}(w) < \frac{\Loss_{A \cD}^{(7/8)\gamma_i}(w)}{2} - \frac{2^{11} k + \ln(1/\alpha)}{n}.
\]
For a fixed matrix $A$ and vector $w \in \Net_0$, we have by Bernstein's inequality and $\E_{\rS}[\Loss_{A S}^{(7/8)\gamma_i}(w)]= \Loss_{A \cD}^{(7/8)\gamma_i}(w)$ that
\begin{align*}
    \Pr_{\rS}\left[\left|\Loss_{A \rS}^{(7/8)\gamma_i}(w) -\Loss_{A \cD}^{(7/8)\gamma_i}(w)\right|>t/n \right] < \exp\left(- \frac{\frac{1}{2} t^2}{n\Loss_{A \cD}^{(7/8)\gamma_i}(w) + \frac{1}{3}t}\right).
\end{align*}
Setting
\[
t = n \cdot \left( \frac{\Loss_{A \cD}^{(7/8)\gamma_i}(w)}{2} + Z\right)
\]
with $Z=16 \ln(1/\alpha)/n$ gives
\begin{align*}
    \Pr_{\rS}\Bigg[\bigg|\Loss_{A \rS}^{(7/8)\gamma_i}(w) -\Loss&_{A \cD}^{(7/8)\gamma_i}(w)\bigg|>\left( \frac{\Loss_{A \cD}^{(7/8)\gamma_i}(w)}{2} + Z\right) \Bigg]\\ 
    &< \exp\left(- \frac{\frac{n^2}{2} \left( \frac{\Loss_{A \cD}^{(7/8)\gamma_i}(w)}{2} + Z\right)^2}{n\Loss_{A \cD}^{(7/8)\gamma_i}(w) + \frac{n}{3}\left( \frac{\Loss_{A \cD}^{(7/8)\gamma_i}(w)}{2} + Z\right)}\right) \\
    &\leq \exp\left(- \frac{\frac{n^2}{8} \max\{\Loss_{A \cD}^{(7/8)\gamma_i}(w), Z\}^2}{2n \max\{\Loss_{A \cD}^{(7/8)\gamma_i}(w), Z\}}\right) \\
    &\leq \exp\left(-\frac{n Z}{16} \right) \\
    &= \alpha.
\end{align*}
A union bound over all $w \in \Disc_0$ with $\alpha' = \alpha/e^{2^7 k}$ gives that a fixed matrix $A$ is $\alpha$-unusual for $\rS \sim \cD^n$ with probability at most
\[
|\Disc_0| \frac{\alpha}{e^{2^7 k}} < \alpha.
\]
Now call a training set $S$ $\alpha$-representative if $\rA$ is $\alpha$-unusual for $S$ with probability less than $1/4$. By Markov's inequality, we have
\begin{align*}
\Pr_{\rS}[\Pr_{\rA}[(\rS,\rA) \textrm{ is $\alpha$-unusual}] \geq 1/4] &\leq \frac{\E_{\rS}[\Pr_{\rA}[(\rS,\rA) \textrm{ is $\alpha$-unusual}]]}{1/4} \\
&= 4 \cdot \E_{\rA}[\Pr_{\rS}[(\rS,\rA) \textrm{ is $\alpha$-unusual}]]\\
&\leq 4 \alpha.
\end{align*}
Thus
\begin{align}
\Pr_\rS[\rS \textrm{ is $\alpha$-representative}] \geq 1-4 \alpha.\label{eq:oftenrep}
\end{align}
We claim that if the training set $S$ is $\delta$-representative, then it holds for all $w \in \finalH$ that
\[
\Loss^\gamma_{S}(w) \geq \frac{\Loss_{ \cD}^{(3/4)\gamma_i}(w)}{4} - \frac{2^{11} k + \ln(4/\delta)}{n} -30 \exp(-k \gamma_{i+1}^2/2^{14}).
\]
To see this, consider an arbitrary such $S$ and a $w \in \finalH$. Sample $\rA$ and $\rt$ as in the previous section. Call $\rA, \rt$ \emph{good} for $w$ if it satisfies both $\|h_{\rA,\rt}(w)\|_2 \leq 4$ and $\Loss^{(7/8)\gamma_i}_{\rA \cD}(h_{\rA,\rt}(w)) \geq \Loss^{(3/4)\gamma_i}_{\cD}(w) - 25 \exp(-k \gamma_{i+1}^2/2^{14})$. For ease of notation, let $G_w$ denote the set of $(A,t)$ that are good for $w$. Similarly, let $U_S$ denote the set of $A$ where $A$ is $\delta$-unusual for $S$.

For all $w \in \finalH$, $\gamma \in \Gamma_i$, $A$ and $t$, we have that
\begin{align*}
    \Loss_{S}^\gamma(w) &\geq \Loss^{(7/8)\gamma_i}_{A S}(h_{A,\rt}(w)) - \Pr_{(\rx,\ry)\sim S}[\ry \langle w, \rx \rangle > \gamma \wedge \ry \langle h_{A,\rt}(w), A \rx \rangle \leq (7/8)\gamma_i].
\end{align*}
Thus
\begin{align}
    \Loss_{S}^\gamma(w) &\geq \E_{\rA,\rt}[\Loss^{(7/8)\gamma_i}_{\rA S}(h_{\rA,\rt}(w)) - \Pr_{(\rx,\ry)\sim S}[\ry \langle w, \rx \rangle > \gamma \wedge \ry \langle h_{\rA,\rt}(w), \rA \rx \rangle \leq (7/8)\gamma_i]] \nonumber\\
    &\geq \E_{\rA,\rt}[\Loss^{(7/8)\gamma_i}_{\rA S}(h_{\rA,\rt}(w)) \mid (\rA,\rt) \in G_w \wedge \rA \notin U_S] \Pr_{\rA,\rt}[(\rA,\rt) \in G_w \wedge \rA \notin U_S] \label{eq:condGood}\\
    &-\E_{\rA,\rt}[\Pr_{(\rx,\ry)\sim S}[\ry \langle w, \rx \rangle > \gamma \wedge \ry \langle h_{\rA,\rt}(w), \rA \rx \rangle \leq (7/8)\gamma_i]]\label{eq:randroundoff}.
\end{align}
For the term~\eqref{eq:condGood}, we observe that conditioned on $(\rA,\rt) \in G_w$, we have that $h_{\rA,\rt}(w) \in \Disc_0$ since $\|h_{\rA,\rt}(w)\|_2 \leq 4$. Secondly, when $\rA \notin U_S$, this implies by the definition of $\delta$-unusual that
\[
\Loss_{A S}^{(7/8)\gamma_i}(h_{\rA,\rt}(w)) \geq \frac{\Loss_{A \cD}^{(7/8)\gamma_i}(h_{\rA,\rt}(w))}{2} - \frac{2^{11} k + \ln(1/\delta)}{n}.
\]
Hence
\begin{align}
    &\E_{\rA,\rt}[\Loss^{(7/8)\gamma_i}_{\rA S}(h_{\rA,\rt}(w)) \mid (\rA,\rt) \in G_w \wedge \rA \notin U_S] \Pr_{\rA,\rt}[(\rA,\rt) \in G_w \wedge \rA \notin U_S] \geq \nonumber\\
    &\E_{\rA,\rt}\Bigg[\frac{\Loss_{A \cD}^{(7/8)\gamma_i}(h_{\rA,\rt}(w))}{2} \Bigg|(\rA,\rt) \in G_w \wedge \rA \notin U_S\Bigg]\Pr_{\rA,\rt}[(\rA,\rt)\in G_w \wedge \rA \notin U_S] - \frac{2^{11} k + \ln(1/\delta)}{n}.\label{eq:adbound}
\end{align}
Using again that $(\rA, \rt) \in G_w$, we have that~\eqref{eq:adbound} is at least
\begin{align}
    \frac{\Loss_{ \cD}^{(3/4)\gamma_i}(w)}{2} \Pr_{\rA,\rt}[(\rA,\rt)\in G_w \wedge \rA \notin U_S] - \frac{2^{11} k + \ln(1/\delta)}{n} -25 \exp(-k \gamma_{i+1}^2/2^{14}). \label{eq:lastprop}
\end{align}
We now bound $\Pr[(\rA,\rt) \in G_w]$  and $\Pr[\rA \notin U_S]$. For this, we recall that $\|\rA w\|_2^2 \sim (1/k)\chi_2^k$. Thus $\E[\|\rA w\|_2^2] =1$ and by Markov's, we get $\Pr[\|\rA w\|_2^2 \geq 9] \leq 1/9$. Conditioned on $\|\rA w\|_2^2 < 9$, we have $\|h_{\rA,\rt}(w)\|_2 \leq \|\rA w\|_2 + \|h_{\rA,\rt}(w)-\rA w\|_2 \leq \sqrt{9} + \sqrt{k (10 \sqrt{k})^{-2}} < 4$. Next observe that
\begin{align*}
    \Loss_{\rA \cD}^{(7/8)\gamma_i}(h_{\rA,\rt}(w)) &\geq \Loss_{\cD}^{(3/4)\gamma_i}(w) - \Pr_{(\rx, \ry)\sim \cD}[\ry \langle w, \rx \rangle \leq (3/4)\gamma_i \wedge \ry \langle h_{\rA,\rt}(w), \rA \rx \rangle > (7/8)\gamma_i].
\end{align*}
We have by Lemma~\ref{lem:concdiscretize} that there is a constant $c>0$ so that
\begin{align*}
    \E_{\rA,\rt}[\Pr_{(\rx, \ry)\sim \cD}[\ry \langle w, \rx \rangle \leq (3/4)\gamma_i \wedge \ry \langle h_{\rA,\rt}(w), \rA \rx \rangle > (7/8)\gamma_i]] &= \\
    \E_{(\rx, \ry)\sim \cD}[\Pr_{\rA,\rt}[\ry \langle w, \rx \rangle \leq (3/4)\gamma_i \wedge \ry \langle h_{\rA,\rt}(w), \rA \rx \rangle > (7/8)\gamma_i]] &\leq \\
    \sup_{x \in \finalX : \langle w, x\rangle \leq (3/4)\gamma_i}\Pr_{\rA,\rt}[ \langle h_{\rA,\rt}(w), \rA x \rangle > (7/8)\gamma_i] &\leq \\
    c\exp(-k(\gamma_i/8)^2/c) &\leq \\
    c\exp(-k \gamma_{i+1}^2/(2^{8}c)).
\end{align*}
Thus by Markov's inequality, we conclude
\begin{align*}
\Pr_{\rA,\rt}[\Loss_{\rA \cD}^{(7/8)\gamma_i}(h_{\rA,\rt}(w)) <\Loss_{\cD}^{(3/4)\gamma_i}(w)- 5c \exp(-k \gamma_{i+1}^2/(2^{8}c))] &\leq \\
    \Pr_{\rA,\rt}[\Pr_{(\rx, \ry)\sim \cD}[\ry \langle w, \rx \rangle \leq (3/4)\gamma_i \wedge \ry \langle h_{\rA,\rt}(w), \rA \rx \rangle > (7/8)\gamma_i] > 5 c \exp(-k \gamma_{i+1}^2/(2^{8}c))] &< 1/5.
\end{align*}
Finally, since we assumed $S$ is $\delta$-representative, we have $\Pr_{\rA}[\rA \in U_S] \leq 1/4$ by definition of $\delta$-representative. We conclude by a union bound that
\begin{align*}
\Pr_{\rA,\rt}[(\rA,\rt)\in G_w \wedge \rA \notin U_S] &\geq 1-1/9-1/5-1/4\geq 1/2.
\end{align*}
In summary, we have shown that~\eqref{eq:lastprop} is at least
\[
\frac{\Loss_{ \cD}^{(3/4)\gamma_i}(w)}{2} \cdot \frac{1}{2} - \frac{2^{11} k + \ln(1/\delta)}{n} -5 c \exp(-k \gamma_{i+1}^2/(2^{8}c)).
\]
Recalling that~\eqref{eq:condGood}~$\geq$~\eqref{eq:lastprop} gives
\begin{align*}
\E_{\rA,\rt}[\Loss^{(7/8)\gamma_i}_{\rA S}(h_{\rA,\rt}(w)) \mid (\rA,\rt) \in G_w \wedge \rA \notin U_S] \Pr_{\rA,\rt}[(\rA,\rt) \in G_w \wedge \rA \notin U_S] &\geq \\
\frac{\Loss_{ \cD}^{(3/4)\gamma_i}(w)}{4} - \frac{2^{11} k + \ln(1/\delta)}{n} -5c \exp(-k \gamma_{i+1}^2/(2^{8}c)).
\end{align*}
The term~\eqref{eq:randroundoff} can be bounded using Lemma~\ref{lem:concdiscretize} by
\begin{align*}
\E_{\rA,\rt}[\Pr_{(\rx,\ry)\sim S}[\ry \langle w, \rx \rangle > \gamma \wedge \ry \langle h_{\rA,\rt}(w), \rA \rx \rangle \leq (7/8)\gamma_i]] &= \\
\E_{(\rx,\ry)\sim S}[\Pr_{\rA,\rt}[\ry \langle w, \rx \rangle > \gamma \wedge \ry \langle h_{\rA,\rt}(w), \rA \rx \rangle \leq (7/8)\gamma_i]] &\leq \\
\sup_{x \in \finalX : \langle w, x\rangle > \gamma }\Pr_{\rA,\rt}[\langle h_{\rA,\rt}(w), \rA x \rangle \leq (7/8)\gamma_i] &\leq\\
c\exp(-k(\gamma - (7/8)\gamma_i)^2/c) &\leq \\
c\exp(-k\gamma_i^2/(64 c))&\leq \\
c\exp(-k\gamma_{i+1}^2/(2^{8}c)).
\end{align*}
In summary, we have shown that for $(\delta/4)$-representative $S$, it holds for all $w \in \finalH$ that
\begin{align*}
    \Loss_S^\gamma(w) \geq \frac{\Loss_{ \cD}^{(3/4)\gamma_i}(w)}{4} - \frac{2^{11} k + \ln(4/\delta)}{n} -6c \exp(-k \gamma_{i+1}^2/(2^{8}c)).
\end{align*}
We finally conclude from~\eqref{eq:oftenrep} that with probability at least $1-\delta$ over $\rS$, it holds for all $w \in \finalH$ that
\begin{align*}
    \Loss_{\rS}^\gamma(w) \geq \frac{\Loss_{ \cD}^{(3/4)\gamma_i}(w)}{4} - \frac{2^{11} k + \ln(4/\delta)}{n} -6c \exp(-k \gamma_{i+1}^2/(2^{8}c)).
\end{align*}
Picking $k=2^{8}c \gamma_{i+1}^{-2} \ln(\gamma^2_{i+1} n)$ finally results in
\begin{align*}
    \Loss_{\rS}^\gamma(w) \geq \frac{\Loss_{ \cD}^{(3/4)\gamma_i}(w)}{4} - \frac{2^{20}c \ln(\gamma_{i+1}^2 n)}{\gamma_{i+1}^2 n} - \frac{2\ln(e/\delta)}{n}.
\end{align*}
This completes the proof.
\end{proof}