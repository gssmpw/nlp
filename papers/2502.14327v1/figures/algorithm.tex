\begin{algorithm}[H]
\caption{Self-stacking Tool Selection Algorithm}
\label{alg:tool_stacking}
\begin{algorithmic}[1]
\REQUIRE Chemical task $\mathcal{T}$, tool library $\mathcal{L}$, threshold for performance degradation $\epsilon$, parameter $m$ for Top-$m$ relevant tools selection, parameter $k$ for Top-$k$ tool combinations selection.
\ENSURE Optimal tool combinations for stacking.

\STATE \textbf{Step 1: Initial Tool Selection}
\STATE Select the m most relevant tools 
$\{Tool A_1, Tool A_2,...,Tool A_m\}$ from the tool library $\mathcal{L}$ based on their relevance to $\mathcal{T}$.

\STATE \textbf{Step 2: Preliminary Evaluation}
\STATE Evaluate the performance of a single tool ($Tool A_i$).
\STATE Evaluate the performance of the self-stacking configuration ($Tool A_i$ $\to$ $Tool A_i$).

\STATE \textbf{Step 3: Check for Performance Degradation}
\IF{Repeated invocations lead to performance degradation (difference $\geq \epsilon$)}
    \STATE Discontinue further stacking of the same tool type ($Tool A_i$).
\ENDIF

\STATE \textbf{Step 4: Top-$k$ Selection}
\STATE Identify the Top-$k$ most performant tool combinations from the evaluations for the next round of stacking. 

\end{algorithmic}
\end{algorithm}

\begin{algorithm}[htbp]
\caption{Stacking with Additional Tools Algorithm}
\label{alg:tool_stacking_step2}
\begin{algorithmic}[1]
\REQUIRE Top-$k$ optimal tool combinations, all available tools, maximum stacking depth $n$
\ENSURE Optimal execution trajectory
\STATE Initialize best\_trajectory $\gets$ None
\STATE Initialize best\_performance $\gets$ $-\infty$
\FOR{each combination in Top-$k$ optimal tool combinations}
    \STATE Initialize current\_stack $\gets$ combination
    \STATE Initialize depth $\gets$ 1
    \WHILE{depth $\leq$ $n$}
        \STATE Evaluate performance of current\_stack
        \IF{performance degrades}
            \STATE \textbf{break}
        \ENDIF
        \IF{current\_stack's performance $>$ best\_performance}
            \STATE best\_performance $\gets$ current\_stack's performance
            \STATE best\_trajectory $\gets$ current\_stack
        \ENDIF
        \FOR{each tool in all available tools}
            \STATE new\_stack $\gets$ current\_stack + tool
            \STATE Evaluate performance of new\_stack
            \IF{performance improves}
                \STATE current\_stack $\gets$ new\_stack
                \STATE \textbf{break}
            \ENDIF
        \ENDFOR
        \STATE depth $\gets$ depth + 1
    \ENDWHILE
\ENDFOR
\RETURN best\_trajectory
\end{algorithmic}
\end{algorithm}

