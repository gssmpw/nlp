% \shikun{Paper writing timeline
% DDL: 1/30 AOE
% \begin{itemize}
%     \item 1/10 main experimental results+first draft on everything else except theory and experimental discussion
%     \item 1/17 theory part finalize, second round of paper revision, finish ablation exps and exp result writing
%     \item 1/22 paper polish and finish most images (1/20 Abstract submission)
%     \item 1/26 appendix + continue polish
%     \item 1/28 code base cleanup, everything almost check
% \end{itemize}
% }

\section{Omitted Proofs}


\input{icml2025/sections/theory_proof}


% \scaledbootstrap*

% \begin{proof} Since $\alpha^{(k)}$ is a constant with respect to the aggregation function, by distributivity, we have  $h_u^{(k+1)} = \text{UPT}(h_u^{(k)}, \text{AGG}(\alpha \{\{h_{v}^{(k)} \mid v \in \mathcal{N}_u\}\}))$, which denotes sampling the elements $h_v^{(k)}$ by a ratio of $\alpha$. In practice, this sampling strategy can be interpreted as aggreagating over weighted edges, where self-loop edges have a weight of 1 and the rest have a weight of $\alpha$.
    
% \end{proof}




% \section{Edge Weights $\bar{\gamma}_{u,v}$}
% If the mean pooling follows symmetric normalization, $\text{AGG}(\{h_{v}^{(k)}, v \in \neighbor_u\}) \coloneqq
% \frac{1}{\sqrt{|\neighbor_u|}\sqrt{|\neighbor_v|}}\sum_{v \in \neighbor_u}h_v$, the edge weights are assigned to $\bar{\gamma}_{u,v}$ following:

% \begin{equation}
%     \bar{\gamma}_{u,v} = \frac{[\gamma]_{i,j}\sqrt{|\neighbor_u|}\sqrt{|\neighbor_v|}}{\sum_{v \in \neighbor_u} \sqrt{[\gamma]}_{i,j}  {\sum_{u \in \neighbor_v} \sqrt{[\gamma]}_{i,j}}}, \, \text{where $Y_u = i$ and $Y_v=j$}
% \end{equation}

\section{Additional Results}



\subsection{Results of GPRGNN}
Table \ref{tab:gprgnn} presents the results of the GPRGNN backbone on the MAG dataset. 
Compared to GraphSAGE, we observe that GPRGNN is less robust under structure shifts due to its linear combination of k-hop representations.
We also notice a similar tendency as with GraphSAGE, where T3A outperforms all other baselines. 
TSA slightly improves upon T3A by refining the decision boundary. 
However, we frequently observe a performance decrease when combining AdaRC with T3A. 
This drop is attributed to the fact that their proposed PIC loss relies on minimizing intra-variance, which depends on the quality of node hidden representations on the target domain. 
Under imbalanced training and label shift, node hidden representations can easily degrade, causing AdaRC performance to become unstable.

\begin{table}[h]
\scriptsize
\caption{MAG GPRGNN results (accuracy). \textbf{Bold} indicates improvements in comparison to the corresponding non-graph TTA baselines. \underline{Underline} indicates the best model.}
\label{tab:gprgnn}
\begin{center}
\resizebox{\textwidth}{!}{%
\begin{tabular}{lcccccccccc}
\toprule
\textbf{Method} & US$\rightarrow$CN & US$\rightarrow$DE & US$\rightarrow$JP & US$\rightarrow$RU & US$\rightarrow$FR & CN$\rightarrow$US &CN$\rightarrow$DE & CN$\rightarrow$JP & CN$\rightarrow$RU & CN$\rightarrow$FR\\
\midrule
ERM &26.26$\pm$1.53 &27.09$\pm$0.74 &38.90$\pm$1.06 &22.88$\pm$1.14 &20.69$\pm$0.64 &27.58$\pm$0.55 &10.77$\pm$0.55 &17.41$\pm$0.86 &12.49$\pm$0.74 &9.05$\pm$0.42 
\\
GTrans &26.04$\pm$1.41 &26.96$\pm$0.72 &38.71$\pm$0.96 &23.07$\pm$1.08 &20.80$\pm$0.70 &27.49$\pm$0.46 &10.97$\pm$0.56 &17.41$\pm$0.78 &12.58$\pm$0.75 &9.08$\pm$0.41 \\
SOGA &34.70$\pm$0.71 &35.18$\pm$0.33 &48.47$\pm$0.30 &33.63$\pm$0.73 &27.98$\pm$0.42 &35.16$\pm$0.57 &18.50$\pm$0.45 &28.35$\pm$1.04 &20.11$\pm$0.71 &14.73$\pm$0.58 
\\
TENT &13.79$\pm$0.72 &25.67$\pm$0.50 &29.13$\pm$0.80 &18.00$\pm$0.14 &20.85$\pm$0.26 &16.29$\pm$0.82 &7.59$\pm$0.73 &13.81$\pm$0.74 &7.82$\pm$0.74 &5.94$\pm$0.34 

\\
LAME &24.54$\pm$2.55 &22.50$\pm$0.85 &35.97$\pm$1.42 &17.61$\pm$1.46 &15.71$\pm$0.92 &28.02$\pm$0.55 &9.08$\pm$0.61 &15.58$\pm$1.02 &10.87$\pm$0.70 &8.01$\pm$0.38 
\\
T3A &40.58$\pm$0.23 &39.00$\pm$0.85 &48.96$\pm$1.00 &46.13$\pm$1.56 &32.35$\pm$1.29 &38.92$\pm$2.23 &38.07$\pm$1.45 &46.23$\pm$1.73 &42.82$\pm$1.52 &28.65$\pm$0.65 
\\
\midrule
AdaRC-TENT &\textbf{13.90$\pm$0.71} &\textbf{25.87$\pm$0.47} &\textbf{29.30$\pm$0.82} &\textbf{18.14$\pm$0.19} &\textbf{21.03$\pm$0.26} &\textbf{16.38$\pm$0.80} &\textbf{7.62$\pm$0.73} &\textbf{13.84$\pm$0.74} &\textbf{7.85$\pm$0.81} &\textbf{5.97$\pm$0.36}
\\
AdaRC-LAME &8.93$\pm$4.76 &8.18$\pm$0.78 &15.46$\pm$1.34 &6.25$\pm$1.43 &6.69$\pm$0.81 &1.35$\pm$2.69 &\textbf{17.60$\pm$8.89} &\textbf{33.42$\pm$2.41} &\textbf{18.81$\pm$1.42} &4.23$\pm$8.02 
\\
AdaRC-T3A &22.34$\pm$18.21 &32.18$\pm$1.70 &42.85$\pm$1.15 &34.77$\pm$2.62 &25.75$\pm$0.62 &\underline{\textbf{45.27$\pm$2.57}} &33.01$\pm$1.17 &42.08$\pm$0.82 &38.57$\pm$1.50 &\textbf{29.30$\pm$0.47} 
\\
\midrule
TSA-TENT &\textbf{14.25$\pm$0.68} &\textbf{25.76$\pm$0.51} &\textbf{29.30$\pm$0.79} &\textbf{18.30$\pm$0.26} &\textbf{21.20$\pm$0.20} &\textbf{16.57$\pm$0.78} &\textbf{7.69$\pm$0.72} &\textbf{14.03$\pm$0.70} &\textbf{8.07$\pm$0.79} &\textbf{6.03$\pm$0.39}
\\
TSA-LAME &\textbf{26.33$\pm$2.25} &\textbf{22.76$\pm$1.44} &35.57$\pm$1.43 &\textbf{18.15$\pm$2.08} &\textbf{16.94$\pm$1.06} &\textbf{29.70$\pm$0.45} &\textbf{11.04$\pm$0.61} &\textbf{17.90$\pm$0.89} &\textbf{12.46$\pm$0.43} &\textbf{9.32$\pm$0.51}
\\
TSA-T3A &\underline{\textbf{40.81$\pm$0.23}} &\underline{\textbf{39.13$\pm$0.77}} &\underline{\textbf{49.16$\pm$0.85}} &\underline{\textbf{47.05$\pm$1.74}} &\underline{\textbf{33.27$\pm$1.21}} &\textbf{41.06$\pm$3.34} &\underline{\textbf{38.34$\pm$1.25}} &\underline{\textbf{46.38$\pm$1.83}} &\underline{\textbf{43.64$\pm$0.85}} &\underline{\textbf{28.71$\pm$0.57}}
\\
\bottomrule
\end{tabular}
}
\end{center}
\end{table}

\subsection{Results of Ablation Study}

\begin{table}[h]
\scriptsize
\caption{Ablation Study on TSA.}
\label{table:ablation}
% \resizebox{\textwidth}{!}{%
\begin{center}
\resizebox{\textwidth}{!}{%
\begin{tabular}{c|l|cccccccccc}
\toprule
Method &Ablation & US$\rightarrow$CN & US$\rightarrow$DE & US$\rightarrow$JP & US$\rightarrow$RU & US$\rightarrow$FR & CN$\rightarrow$US &CN$\rightarrow$DE & CN$\rightarrow$JP & CN$\rightarrow$RU & CN$\rightarrow$FR \\
 \midrule
\multirow{3}{*}{TENT+TSA} &\cellcolor{red!10}Base   &\cellcolor{red!10}27.30$\pm$1.61 &\cellcolor{red!10}32.84$\pm$0.78 &\cellcolor{red!10}40.82$\pm$0.99 &\cellcolor{red!10}32.53$\pm$0.91 &\cellcolor{red!10}28.62$\pm$0.63 &\cellcolor{red!10}27.89$\pm$0.98 &\cellcolor{red!10}16.22$\pm$1.17 &\cellcolor{red!10}24.87$\pm$0.56 &\cellcolor{red!10}22.05$\pm$0.84 &\cellcolor{red!10}14.20$\pm$0.71\\

&w/o Nbr. Align &27.18$\pm$1.70 &32.75$\pm$0.69 &40.82$\pm$0.99 &32.26$\pm$0.95 &28.41$\pm$0.59 &27.53$\pm$0.92 &16.22$\pm$1.17 &24.87$\pm$0.56 &22.05$\pm$0.84 &13.95$\pm$0.76
 \\
&w/o SNR &27.00$\pm$1.21 &32.76$\pm$0.75 &40.80$\pm$0.91 &32.52$\pm$0.90 &28.57$\pm$0.59 &27.70$\pm$0.88 &15.84$\pm$0.85 &24.62$\pm$0.48 &21.37$\pm$0.73 &14.11$\pm$0.60
\\
 \midrule
\multirow{3}{*}{LAME+TSA} &\cellcolor{red!10}Base  &\cellcolor{red!10}37.95$\pm$0.97 
&\cellcolor{red!10}36.29$\pm$1.65 &\cellcolor{red!10}46.86$\pm$1.13 &\cellcolor{red!10}32.86$\pm$2.23 &\cellcolor{red!10}27.22$\pm$1.48 &\cellcolor{red!10}44.83$\pm$0.88 &\cellcolor{red!10}28.51$\pm$0.44 &\cellcolor{red!10}39.80$\pm$0.99 &\cellcolor{red!10}24.54$\pm$0.87 &\cellcolor{red!10}22.39$\pm$0.30
\\
&w/o Nbr. Align &37.90$\pm$0.97 &36.08$\pm$1.73 &46.75$\pm$0.88 &32.70$\pm$2.29 &26.49$\pm$1.76 &44.83$\pm$0.88 &28.41$\pm$0.36 &39.72$\pm$0.99 &24.24$\pm$0.75 &22.23$\pm$0.32 
 \\
 &w/o SNR &35.35$\pm$0.84 &33.45$\pm$1.60 &44.51$\pm$1.22 &29.89$\pm$1.94 &24.41$\pm$1.43 &40.17$\pm$1.11 &22.44$\pm$0.99 &32.57$\pm$1.46 &17.33$\pm$0.47 &17.07$\pm$0.61
\\
 \midrule
\multirow{3}{*}{T3A+TSA} &\cellcolor{red!10}Base
&\cellcolor{red!10}41.65$\pm$0.99 &\cellcolor{red!10}47.01$\pm$2.08 &\cellcolor{red!10}51.65$\pm$0.90 &\cellcolor{red!10}46.61$\pm$0.88 &\cellcolor{red!10}43.45$\pm$0.81 &\cellcolor{red!10}48.09$\pm$0.60 &\cellcolor{red!10}39.18$\pm$1.87 &\cellcolor{red!10}46.50$\pm$0.25 &\cellcolor{red!10}43.70$\pm$1.38 &\cellcolor{red!10}30.89$\pm$2.13 
 \\
 &w/o Nbr. Align &41.64$\pm$1.10 &46.37$\pm$2.11 &50.32$\pm$1.11 &46.44$\pm$0.80 &42.09$\pm$1.26 &46.47$\pm$1.27 &39.12$\pm$1.85 &46.23$\pm$0.61 &43.60$\pm$1.21 &30.92$\pm$2.03
 \\
 &w/o SNR &41.59$\pm$0.94 &45.54$\pm$1.81 &51.55$\pm$0.95 &46.51$\pm$0.94 &41.35$\pm$1.09 &48.11$\pm$0.62 &38.71$\pm$1.00 &46.29$\pm$0.26 &43.12$\pm$0.76 &29.90$\pm$1.35
 \\
\bottomrule
\end{tabular}
}
\end{center}
\end{table}


\newpage
\subsection{Visualization of Distribution Shift}
\begin{figure*}[h]
\centering
\begin{tabular}{c|ccc|c}
(a) Source &(b) Feature Shift & (c) Neighborhood Shift  &(d) Label Shift & (e) SNR \\
\includegraphics[width=0.18\textwidth]{icml2025/figures/aggre_src.pdf} &
\includegraphics[width=0.18\textwidth]{icml2025/figures/aggre_feat.pdf} &
\includegraphics[width=0.18\textwidth]{icml2025/figures/aggre_nbr.pdf} &
\includegraphics[width=0.18\textwidth]{icml2025/figures/aggre_lbl.pdf} &
% \includegraphics[width=0.18\textwidth]{icml2025/figures/aggre_ss.pdf} &
% \includegraphics[width=0.18\textwidth]{icml2025/figures/aggre_no_nbr.pdf} &
% \includegraphics[width=0.18\textwidth]{icml2025/figures/aggre_no_shift.pdf} &
\includegraphics[width=0.18\textwidth]{icml2025/figures/aggre_deg.pdf} \\

\includegraphics[width=0.18\textwidth]{icml2025/figures/output_src.pdf} &
\includegraphics[width=0.18\textwidth]{icml2025/figures/output_feat.pdf} &
\includegraphics[width=0.18\textwidth]{icml2025/figures/output_nbr.pdf} &
\includegraphics[width=0.18\textwidth]{icml2025/figures/output_label.pdf} &
\includegraphics[width=0.18\textwidth]{icml2025/figures/output_deg.pdf} \\
\end{tabular}
\caption{The t-SNE visualization of a one-layer GSN under different distribution shifts: (top) the mean-pooled neighborhood hidden representations and (bottom) the node representations before passing through the classifier, positioned along its decision boundary. 
(a) indicates the source domain where the model is pretrained. 
(b), (c), and (d) stand for feature shift, neighborhood shift, and label shift. 
(e) represent the impact of SNR induced by degree shift.
The color of the nodes represents the ground-truth labels.
The legends in the bottom plots show the accuracy and recall scores for each class.
The red contours in the bottom (d) highlight the decision boundary of the minority class.
% A detailed discussion is provided in Sec. \ref{subsec:empirical_invest}.
}
\label{fig:pa_diff_shift}
\end{figure*}


\input{icml2025/sections/dataset}

\input{icml2025/sections/experimental_setup}
