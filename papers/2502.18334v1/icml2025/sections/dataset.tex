\section{Dataset Details}

\label{app:dataset}

\subsection{Dataset Statistics} 
Here we summarize the statistics of the four real-world graph datasets.
The edges are counted twice in the edge list as they are undirected graphs. 

\begin{table}[h!]
\caption{Arxiv and ACM/DBLP dataset statistics}
\vspace{2mm}
\begin{center}
\begin{tabular}{lccccccc}
\toprule
            & ACM          & DBLP           & 1950-2007         &1950-2009  &1950-2011  &1950-2016          &1950-2018 \\
\midrule
Nodes          & $7410$  & $5578$ & $4980$ &  $9410$  &$17401$  & $69499$ & $120740$ \\
Edges        & $11135    $ & $7341$ & $5849$    &$13179$   &    $30486$     & $232419$ & $615415$ \\
Features    & $7537    $ & $7537  $ & $128$   &    $128$  & $128$   &    $128$   &    $128$   \\
Classes        & $6    $ & $6  $ & $40$    &$40$  & $40$    &$40$     &    $40$ \\
\bottomrule
\label{table:arxiv_datastats}
\end{tabular}
\end{center}
\vskip -0.7cm
\end{table}

% \begin{table}[h!]
% \caption{real dataset statistics}
% \vspace{2mm}
% \begin{center}
% % \begin{sc}
% \begin{tabular}{lcccccc}
% \toprule
%             & ACM          & DBLP           & Arxiv-2007          &Arxiv-2009  & Arxiv-2016          &Arxiv-2018\\
% \midrule
% $\#$nodes          & $7410$  & $5578$ & $4980$ &  $9410$ & $69499$ & $120740$\\
% $\#$edges        & $11135    $ & $7341$ & $5849$    &$13179$       & $232419$ & $615415$\\
% Node feature dimension    & $7537    $ & $7537  $ & $128$   &    $128$  & $128$   &    $128$   \\
% $\#$labels        & $6    $ & $6  $ & $40$    &$40$  & $40$    &$40$      \\
% \bottomrule
% \label{table:datastats}
% \end{tabular}
% % \end{sc}
% \end{center}
% \vskip -0.7cm
% \end{table}

\begin{table}[h!]
\caption{MAG dataset statistics}
\vspace{2mm}
\begin{center}
% \begin{sc}
\begin{tabular}{lcccccc}
\toprule
            & US          & CN           & DE          &JP  & RU          &FR\\
\midrule
Nodes          & $132558$  & $101952$ & $43032$     &  $37498$  & $32833$     &  $29262$   \\
Edges        & $697450$ & $285561$ & $126683$    &$90944$    & $67994$     &  $78222$    \\
Features    & $128    $ & $128  $ & $128$   &    $128$  & $128$   &    $128$   \\
Classes        & $20$ & $20  $ & $20$    &$20$  & $20$    &$20$ \\
\bottomrule
\label{table:mag_datastats}
\end{tabular}
% \end{sc}
\end{center}
\vskip -0.7cm
\end{table}

\begin{table}[h!]
\caption{Pileup dataset statistics}
\vspace{2mm}
\begin{center}
% \begin{sc}
\begin{tabular}{lcccccc}
\toprule
            & gg-10          & qq-10           & gg-30          &qq-30  &gg-50  & gg-140          \\
\midrule
Nodes          & $18611$  & $17242$ & $41390$     &  $38929$ & $60054$     &  $154750$     \\
Edges        & $ 53725 $ & $42769$ & $173392$    &$150026$  & $341930$    &$2081229$    \\
Features    & $28    $ & $28  $ & $28$   &    $28$  & $28$   &    $28$   \\
Classes        & $2    $ & $2  $ & $2$    &$2$  & $2$    &$2$      \\
\bottomrule
\label{table:pileup_datastats}
\end{tabular}
% \end{sc}
\end{center}
\vskip -0.7cm
\end{table}



\subsection{Dataset Shift Statistics}
\label{app:shift_stats}
Below we provide two metrics indicating the neighborhood and label shift in real-world dataset.
We measure the neighborhood shift by computing the weighted average of the total variation distance between of the neighborhood distribution:
\begin{align*}
    \text{Nbr. Shift}\coloneqq\frac{1}{2}\sum_{j\in\gY}\sum_{k\in\gY}\probt(Y_u=j)\abs{\probs(Y_v=k|Y_u=j,v\in \neighbor_u) - \probt(Y_v=k|Y_u=j,v\in \neighbor_u)}
\end{align*}

The label shift is measured as the total variation distance between the label distribution, which corresponds to the first term in Theorem \ref{theory:decomposeerror}.

\begin{align*}
    \text{Label. Shift}\coloneqq\frac{1}{2}\sum_{j\in\gY}\abs{\probs(Y_u=j) - \probt(Y_u=j)}
\end{align*}


\begin{table}[h!]
\caption{MAG dataset shift metrics}
\vspace{2mm}
\begin{center}
\begin{adjustbox}{width = 1\textwidth}
\begin{sc}
\begin{tabular}{lcccccccccc}
\toprule
  &   $US \rightarrow CN$ &  $US\rightarrow DE$  &     $US\rightarrow JP$    & $US\rightarrow RU$     & $US\rightarrow FR$ & $CN \rightarrow US$ &  $CN\rightarrow DE$  &     $CN\rightarrow JP$  & $CN\rightarrow RU$     & $CN\rightarrow FR$\\
\midrule
Nbr. Shift        & $0.2137$ & $0.1902$ & $0.1476$    &$0.2855$    & $0.2238$     &  $0.1946$ & $0.2053$ &$0.1361$ &$0.2025$ & $0.2039$    \\
Label Shift        & $0.2734$ & $0.1498$ & $0.1699$    &$0.3856$    & $0.1706$     &  $0.2734$ & $0.2691$ &$0.1522$ &$0.2453$ & $0.2256$    \\

\bottomrule
\label{table:magstats}
\end{tabular}
\end{sc}
\end{adjustbox}
\end{center}
\vskip -0.7cm
\end{table}


\begin{table}[h!]
\caption{Pileup dataset shift metrics}
\vspace{2mm}
\begin{center}
\begin{adjustbox}{width = 0.95\textwidth}
\begin{sc}
\begin{tabular}{lcccccccc}
\toprule
& \multicolumn{6}{c}{Pileup Conditions} & \multicolumn{2}{c}{Physical Processes} \\
 Domains  & $\text{PU}10 \rightarrow 30$    & $\text{PU}30 \rightarrow 10$ & PU$10\rightarrow 50$ & PU$50\rightarrow 10$ & PU$30\rightarrow 140$ & PU$140\rightarrow 30$ &$gg \rightarrow qq$      &     $qq \rightarrow gg$      \\
\midrule
Nbr. Shift        & $0.1493$ & $0.1709$ & $0.2039$    &$0.2595$    & $0.1293$     &  $0.1635$  & $0.0214$     &  $0.0205$   \\
Label Shift       & $0.2425$ & $0.2425$ & $0.2982$    &$0.2982$    & $0.1377$     &  $0.1377$  & $0.0341$     &  $0.0348$  \\

\bottomrule
\label{table:hepstats}
\end{tabular}
\end{sc}
\end{adjustbox}
\end{center}
\vskip -0.7cm
\end{table}


\begin{table}[h!]
\caption{Real dataset shift metrics}
\vspace{2mm}
\begin{center}
\begin{adjustbox}{width = 0.95\textwidth}
\begin{sc}
\begin{tabular}{lcccccccc}
\toprule
 & \multicolumn{2}{c}{1950-2007} & \multicolumn{2}{c}{1950-2009} & \multicolumn{2}{c}{1950-2011} & \multicolumn{2}{c}{DBLP/ACM}\\
 Domains  & $2014-2016$    & $2016-2018$ & $2014-2016$ & $2016-2018$ & $2014-2016$ & $2016-2018$   & $D\rightarrow A$ & $A\rightarrow D$\\
\midrule
Nbr. Shift         
& $0.3005$ & $0.3450$ & $0.2583$    &$0.3120$    & $0.1833$     &  $0.2567$   & $0.1573$     &  $0.2227$   \\
Label Shift        
& $0.2938$ & $0.4396$ & $0.2990$    &$0.4552$    & $0.2853$     &  $0.4438$   & $0.3434$     &  $0.3435$ \\

\bottomrule
\label{table:realstats}
\end{tabular}
\end{sc}
\end{adjustbox}
\end{center}
\vskip -0.7cm
\end{table}
