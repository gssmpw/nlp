\iffalse

\eden{maybe to put somewhere:
\begin{itemize}
    \item Strategy-Proofness: ? \eden{I'm not sure what the difference is. Wiki says that it means that each player has a weakly-dominant strategy (so that no player can gain by "spying" over the other players), but in \url{https://www.cs.cmu.edu/~sandholm/cs15-892F13/algorithmic-game-theory.pdf} page 218: "incentive compatibility also called strategy-proofness or truthfulness".}
    \item 
    \item Truthfulness: 
    \begin{itemize}
        \item No profitable manipulations.
        \item Telling the truth is a weakly-dominant strategy. 
    \end{itemize} 
    \item RAT: 
    \begin{itemize}
        \item No safe-and-profitable manipulations.
        \item No strategy weakly-dominates telling the truth.
    \end{itemize} 
    \item Maximin Strategy-Proofness: 
    \begin{itemize}
        \item No always-profitable manipulations. 
        \item No strategy strictly-dominates telling the truth.
    \end{itemize} 
    \item NOM: No obvious manipulations. 
\end{itemize}
Also:
\begin{itemize}
    \item A safe-and-profitable manipulation: a strategy that weakly-dominates telling the truth.
    \item An always-profitable manipulation: strategy that strictly-dominates telling the truth.
\end{itemize}
}

\newpage
\fi
\section{Preliminaries}\label{sec:preliminaries}


We consider a generic social choice setting, with a set of $n$ \emph{agents} $N = \{a_1, \ldots, a_n\}$, and a set of potential \emph{outcomes} $X$.
%
% EREL: safe-profitable-manipulation: see https://english.stackexchange.com/a/1159/24024
%
% \paragraph{Preferences.} % Types.?
Each agent, $a_i \in N$, has preferences over the set of outcomes $X$, that can be described in one of two ways: (1) a linear ordering of the outcomes, or (2) a utility function from $X$ to $\mathbb{R}$.
%
The set of all possible preferences for agent~$a_i$ is denoted by $\domain_i$, and is referred to as the agent's \emph{domain}. 
We denote the agent's \emph{true} preferences by $T_i \in \domain_i$.
%
Unless otherwise stated, when agent~$a_i$ weakly prefers the outcome $x_1$ over $x_2$, it is denoted by $x_1 \succeq_i x_2$; and when she strictly prefers $x_1$ over $x_2$, it is denoted by $x_1 \succ_i x_2$.

% \paragraph{Profile.} For any subset of the $n$ agents, a profile for this set is a list of types, one for each agent in the set. 

% \paragraph{Aggregation.} 
% Let $\mathbf{R} := (R_1,\ldots,R_n) \in \domain_1\times\cdots \times \domain_n$ be a profile for the $n$ agents.
% For each agent $i$, we denote by $\mathbf{R}_{-i}$ the profile for all the agents except $i$ in which their types are as in $\mathbf{R}$: 
% $$ \mathbf{R}_{-i} := (R_1, 
% \ldots, R_{i-1}, R_{i+1},\ldots,R_n)$$
% Given any type for agent $i$, $R'_i \in \domain_i$, we denote by $(R'_i, \mathbf{R}_{-i})$ the profile for all agents in which agent $i$'s type is $R'_i$ and all other agents' types are as in $\mathbf{R}_{-i}$:
% $$ (R'_i, \mathbf{R}_{-i}) := (R_1, 
% \ldots, R_{i-1}, R'_i, R_{i+1},\ldots,R_n)$$

% \paragraph{Mechanism.}
A \emph{mechanism} or \emph{rule}  is a function $f: \domain_1\times\cdots \times \domain_n \to X$, which takes as input a list of reported preferences $P_1,\ldots,P_n$ (which may differ from the true preferences), and returns the chosen outcome.
In this paper, we focus on deterministic and single-valued mechanisms. 
% \eden{single-valued? deterministic?}

% \paragraph{Preferences Aggregation: Single Agent.}
For any agent $a_i \in N$, we denote by $(P_i, \prefsExcI)$ the preference profile in which agent~$a_i$ reports $P_i$, and the other agents report $\prefsExcI$.

% % ===== more formal too long ======
% % ======================================
% % We denote the set of all possible combinations of preferences, $\domain_1\times\cdots \times \domain_n$, by $\domains_N$.
% For each agent~$i$, let $\domainsExcI := \domain_1 \times \cdots \times D_{i-1} \times D_{i+1} \times \cdots \times D_{n}$ denote the set of all combinations of preferences of all agents except $i$.

% Given preferences for agent~$i$, $P_i \in \domain_i$, and preferences for all agents except $i$, $\prefsExcI \in \domainsExcI$, we use $(P_i, \prefsExcI)$ to denote the preferences profile in which agent~$i$ has the preferences $P_i$ and the preferences of all other agents are as in $\prefsExcI$.
% % ======================================




% \subsection{Truthfulness and Risk-Avoiding Truthfulness (RAT)}
% \eden{new}
% \eden{I think it would be clear if we'll use $P'_i$}

\paragraph{Truthfulness}
A \emph{manipulation} for a mechanism $f$ and agent~$a_i \in N$ is an untruthful report $P_i \in \domain_i \setminus \{T_i\}$.
A manipulation is \emph{profitable} if there exists a set of preferences of the other agents for which it increases the manipulator's utility:
\begin{align}
\label{eq:manipulation}
    &\exists \prefsExcI\in \domainsExcI : \quad f(P_i,\prefsExcI) \succ_i f(T_i,\prefsExcI)
\end{align}
% In words:  agent~$i$ \emph{strictly} prefers the outcome resulting from reporting $P_i$ over the outcome resulting from reporting the truth $T_i$.
%
% In this case, we say that agent~$i$ has a manipulation.
%
% \paragraph{Truthful.}
%
%
% A mechanism $f$ is called \emph{truthful} if it has no profitable manipulations for any agent~$a_i\in N$; and \emph{manipulable} otherwise. 
%
A mechanism $f$ is called \emph{manipulable} if some agent~$a_i$ has a profitable manipulation; otherwise $f$ is called \emph{truthful}. 



% \paragraph{Safe Manipulation.}
\paragraph{RAT}
A manipulation is \emph{safe} if it never harms the manipulator's utility -- it is weakly preferred over telling the truth for any possible preferences of the other agents:
\begin{align}
    &\forall \prefsExcI\in \domainsExcI : \quad f(P_i,\prefsExcI) \succeq_i f(T_i,\prefsExcI)
\end{align}
% \eqref{eq:manipulation} says, as above, that $P_i$ is a profitable manipulation for $a_i$. \eqref{eq:safe-manipulation} says, in words, that for any possible preferences of the other agents, agent~$a_i$ weakly prefers the outcome resulting from reporting $P_i$ over the outcome resulting from reporting the truth $T_i$.
%
% In this case, we say that agent~$i$ has a safe-manipulation.
%
% \paragraph{Risk-Averse Truthful (RAT)}
%
%
% A mechanism $f$ is called \emph{risk-averse truthful (RAT)} if it 
% % is \emph{not} safely manipulable \cite{BU2023Rat}.
% has no profitable-and-safe manipulations for any agent $a_i\in N$; and \emph{safely-manipulable} otherwise. 
%
A mechanism $f$ is called \emph{safely-manipulable} if some agent~$a_i$ has a manipulations that is profitable and safe; otherwise $f$ is called \emph{risk-avoiding truthful (RAT)}. 




\section{The RAT-Degree}\label{sec:RAT-degree}


\newcommand{\prefsOf}[1]{\mathbf{P}_{#1}}
\newcommand{\domainsOf}[1]{\mathbf{D}_{#1}}

% \paragraph{Preferences Aggregation: Multiple Agents.}
% Fix an agent $a_i \in N$. 
Let $k \in \{0,\ldots, n-1\}$, $K \subseteq N \setminus \{a_i\}$ with $|K| = k$ and $\notK := N \setminus (\{a_i\} \cup K)$.
We denote by $(P_i, \prefsOf{K}, \prefsOf{\notK})$ the preference profile in which the preferences of agent $a_i$ are $P_i$, the preferences of the agents in $K$ are $\prefsOf{K}$, and the preferences of the agents in $\notK$ are $\prefsOf{\notK}$.

\eden{not sure about the name.. too many '-'}
\begin{definition}
A manipulation, $P_i$, is \emph{profitable-and-safe-given-$k$-known-agents} if for some subset $K \subseteq N \setminus \{a_i\}$ with $|K| = k$ and some preferences for them $\prefsOf{K} \in \domainsOf{K}$, the following holds:
    \begin{align}
    \label{eq:k-manipulation}
            \quad \exists \prefsOf{\notK} \in \domainsOf{\notK} \colon \quad f(P_i,\prefsOf{K}, \prefsOf{\notK}) \succ_i f(T_i,\prefsOf{K}, \prefsOf{\notK})
            \\
    \label{eq:k-safe-manipulation}
            \text{ and } \quad   \forall \prefsOf{\notK} \in \domainsOf{\notK} \colon \quad f(P_i,\prefsOf{K}, \prefsOf{\notK}) \succeq_i f(T_i,\prefsOf{K}, \prefsOf{\notK})
    \end{align}
\end{definition}
In words: The agents in $K$ are those  whose preferences are \emph{Known} to $a_i$; the agents in $\notK$ are those whose preferences are unknown to $a_i$.
Given that the preferences of the known-agents are $\prefsOf{K}$, \eqref{eq:k-manipulation} says that there exist a preference profile of the unknown-agents that makes the manipulation profitable for agent~$a_i$; while \eqref{eq:k-safe-manipulation} says that the manipulation is safe -- it is weakly preferred over telling the truth for any preference profile of the unknown-agents.

%
% (a) , (b) , (c) ; and (3) ; such that agent~$i$ has a safe manipulation given $\prefsOf{K}$.
% That is, agent~$i$ has an alternative report $P_i \in \domain_i$,  $P_i\neq T_i$, such that:
%


% In this case, we say that agent~$i$ has a safe-manipulation given $\prefsOf{K}$.
%
% In this case, we say that agent~$i$ has $k$-known-agents safe-manipulation.
A profitable-and-safe manipulation (with no known-agents) is a special case in which $K=\emptyset$.

\begin{definition}
A mechanism $f$ is called \emph{$k$-known-agents safely-manipulable} if some agent~$a_i$ has a profitable-and-safe-manipulation-given-$k$-known-agents.
\end{definition}

\begin{propositionrep}
    Let $k \in \{0, \ldots, n-2\}$.
    If a mechanism is $k$-known-agents safely-manipulable, then it is also $(k+1)$-known-agents safely-manipulable.
\end{propositionrep}
\begin{proof}
    By definition, some agent~$a_i$ has a profitable-and-safe-manipulation-given-$k$-known-agents. 
    That is, there exists a subset $K \subseteq N \setminus \{a_i\}$ with $|K| = k$ and some preference profile for them $\prefsOf{K} \in \domainsOf{K}$, such that \eqref{eq:k-manipulation} and \eqref{eq:k-safe-manipulation} hold.
    Let $a_j \in \notK$.
    Consider the preferences $P_j$ that $a_j$ has in some profile satisfying \eqref{eq:k-manipulation} (profitable). 
    Define  $K^+ := K \cup \{a_j\}$ and construct a preference profile where the preferences of the agents in $K$ remain $\prefsOf{K}$, and $a_j$'s preferences are set to $P_j$.
    Since \eqref{eq:k-manipulation} holds for $P_j$, the same manipulation remains profitable given the new set of known-agents.
    Moreover, \eqref{eq:k-safe-manipulation} continues to hold, as the set of unknown agents has only shrunk.
    Thus, the mechanism is also $(k+1)$-known-agents safely manipulable.
\end{proof}


% \paragraph{The RAT-Degree.}
\begin{definition}%[The RAT-Degree]
    The \emph{RAT-degree} of a mechanism $f$ is the minimum $k$ for which the mechanism is $k$-known-agent safely manipulable, or $n$ if there is no such $k$.
\end{definition}


% \paragraph{Hierarchy.}

\begin{observation}
A mechanism is truthful~ if-and-only-if its RAT-degree is $n$.
\end{observation}

\begin{observation}
 A mechanism is RAT~ if-and-only-if its RAT-degree is at least $1$.
\end{observation}

\Cref{fig:hierarchy-RAT-Degree} illustrates the relation between classes of different RAT-degree. 
% \eden{Not sure about the diagram, I added another option.}

% \begin{figure}[h]
%     \centering
%     \includegraphics[width=\linewidth]{images/hierarchy-diagram-RAT-Degree-w.png}
%     \caption{Hierarchy of the Manipulability and RAT-Degree Classes}
%     \label{fig:hierarchy-RAT-Degree}
% \end{figure}
% % \eden{to add somewhere that all the mechanism that have degrees $1, \ldots, n$ are RAT}

\begin{figure}[t]
    \centering
    \includegraphics{images/sub-hierarchy-diagram-RAT-Degree.png}
    \caption{Hierarchy of the Manipulability and RAT-Degree Classes. KA stands for Known-Agents.}
    \label{fig:hierarchy-RAT-Degree}
\end{figure}



\begin{wraptable}{r}{5cm}
    \centering
% \begin{table}[h]
    \begin{tabular}{c|c|c|c|c}
         & $\prefsExcI^1$ & $\prefsExcI^2$ & $\prefsExcI^3$ &... \\
         \hline
         $T_i$ & & &\\
         \hline
         $P_i \neq T_i$ & & &\\
    \label{tab:safe-manip-i}
    \end{tabular}
    \caption{A Safe-And-Profitable Manipulation from an Agent Perspective.}
% \end{table}
\end{wraptable}
\subsection{An Intuitive Point of View}
Consider \Cref{tab:safe-manip-i}. 
When the risk-avoiding agent has no information ($0$-known-agents), a profitable-and-safe manipulation is a row in the table that represents an alternative report $P_i \neq T_i$, that dominates $T_i$ -- this means that for \emph{each} one of the columns, the outcome in the corresponding row is better than the outcome of the first row.
When the risk-avoiding agent has more information ($k$-known-agents, when $k >0$), it is equivalent to considering a strict subset of the columns.
Lastly, when the risk-avoiding agent has a full information ($(n-1)$-known-agents), it is equivalent to consider only one column.

% For clarity, \Cref{apx:not-KNAM} provides the formal definition of \emph{not} $k$-known-agents safely manipulable.

% \eden{for us, maybe to put in the appendix..?}
% \ifdefined\DRAFT 
% For $0 < k < n$, in order to prove that the degree is $k$ we need to show that it is $k$-known-agents safely manipulable, but also that it is \emph{not} $(k-1)$-known-agents safely manipulable.

% For clarity, we provide the direct definition of \emph{not} $k$-known-agents safely manipulable.


% % \eden{$=$ (1) telling the truth is a weak dominant strategy given any strategy profile for $k$-known-agents, or (2) lying is not a weak dominant strategy}
% \fi


% \eden{Equivalent, maybe more intuitive?} NOT TRUE!!!

% \begin{definition}[\textbf{Not} $k$-Known-Agent Safely Manipulable]
%     Let $k \in \{0,\ldots, n-1\}$. A mechanism $f$ is \emph{Not} $k$-known-agent safely manipulable if for each agent $i \in N$ and an alternative report for agent~$i$, $P_i \in \domain_i$,  $P_i\neq T_i$, \emph{at least one of} the following holds:
%     \begin{enumerate}
%         \item For any set of preferences for the other agents $\prefsExcI\in \domainsExcI$: 
%         \begin{align*}
%             f(T_i,\prefsExcI) \succeq_i f(P_i,\prefsExcI)
%         \end{align*} 
%         Agent~$i$ weakly prefers the outcome resulting from reporting the truth $T_i$ over the outcome resulting from reporting $P_i$.

%         \item There exists a set $\notK \subseteq N \setminus \{i\}$ with $|\notK| = (n-k-1)$, and preferences for the agents in $\notK$, $\prefsOf{\notK} \in \domainsOf{\notK}$, such that the following holds for $K:= N \setminus (\{i\} \cup K)$:
%         \begin{align*}
%             \forall \prefsOf{K} \in \domainsOf{K} \colon \quad f(T_i,\prefsOf{K}, \prefsOf{\notK})  \succ_i f(P_i,\prefsOf{K}, \prefsOf{\notK})
%         \end{align*}

%         There exists a set of preferences of the agents in $\notK$, for which agent~$i$ weakly prefers the outcome resulting from reporting the truth $T_i$ over the outcome resulting from reporting $P_i$.
%     \end{enumerate}
% \end{definition}