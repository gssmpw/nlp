% \newpage

\newcommand{\men}{M}
\newcommand{\women}{W}
\newcommand{\man}{m}
\newcommand{\woman}{w}

\section{Stable Matchings}\label{sec:matching}

% \eden{I'm not sure if it would be better to use men and women or students and universities}

In this section, we consider mechanisms for stable matchings. 
Here, the $n$ agents are divided into two disjoint subsets, $\men$ and $\women$, that need to be matched to each other. The most common examples are men and women or students and universities. 
Each agent has a strict preference order over the agents in the other set and being unmatched -- for each $\man \in \men$, an order $\succ_{\man} $ over $\women\cup \{\phi\}$; and for each $\woman \in \women$ an order, $\succ_{\woman}$, over $\men\cup \{\phi\}$.  

A \emph{matching} between $\men$ to $\women$ is a mapping $\mu$ from $\men \cup \women$ to $\men \cup \women \cup \{\phi\}$ such that (1) $\mu(\man) \in \women \cup \{\phi\}$ for each $\man \in \men$, (2) and $\mu(\woman) \in \men \cup \{\phi\}$ for each $\woman \in \women$, and (3) $\mu(\man) = \woman$ if and only if $\mu(\woman) = \man$ for any $(\man, \woman) \in \men \times \women$. 
% \begin{align*} 
%     \forall \man \in \men \colon &\quad \mu(\man) \in \women \cup \{\phi\}\\
%     \forall \woman \in \women \colon &\quad \mu(\woman) \in \men \cup \{\phi\}\\
%     \forall \man, \woman \in \men \cup \women \colon &\quad  \mu(\man) = \woman  \iff \mu(\woman) = \man
% \end{align*}
When $\mu(a) = \phi$ it means that agent $a$ is unmatched under $\mu$. 
%
A matching is said to be \emph{stable} if (1) \emph{no} agent prefers being unmatched over their assigned match, and (2) there is \emph{no} pair $(\man, \woman) \in \men \times \women$ such that $\man$ prefers $\woman$ over his assigned match while $\woman$ prefers $\man$ over her assigned match -- $\woman \succ_{\man} \mu(\man)$ and $\man \succ_{\woman} \mu(\woman)$.


A mechanism in this context gets the preference orders of all agents and returns a stable matching.

\paragraph{Results} Our results for this problem are preliminary, so we provide only a brief overview here, with full descriptions and proofs in the appendix. We believe, however, that this is an important problem and that our new definition opens the door to many further questions.

We first analyze the deferred acceptance mechanism and prove that its RAT-degree is at most $3$, showing that it is $3$-known-agents safely manipulable. The proof relies on \emph{truncation}, where an agent in $\women$ falsely reports preferring to remain unmatched over certain options. We further show that even without truncation, the RAT-degree is at most $5$.

Finally, we examine the Boston mechanism and establish an upper bound of $2$ on its RAT-degree.


\subsection{Deferred Acceptance (Gale-Shapley)}\label{sec:deferred-acceptance}

The \emph{deferred acceptance} algorithm \cite{gale1962college} is one of the most well-known mechanisms for computing a stable matching. 
In this algorithm, one side of the market - here, $\men$ - proposes, while the other side - $\women$ - accepts or rejects offers iteratively. 
%
\begin{toappendix}
\subsection{Deferred Acceptance (Gale-Shapley): descriptions and proofs}
The algorithm proceeds as follows:
\begin{enumerate}
    \item Each $\man \in \men$ proposes to his most preferred alternative according to $\succ_{\man}$ that has not reject him yet and that he prefers over being matched. 

    \item Each $\woman \in W$ tentatively accepts her most preferred proposal according to $\succ_{\woman}$ that she prefers over being matched, and rejects the rest.

    \item The rejected agents propose to their next most preferred choice as in step 1.

    \item The process repeats until no one of the rejected agents wishes to make a new proposal.

    \item The final matching is determined by the last set of accepted proposal.
\end{enumerate}



It is well known that the mechanism is truthful for the proposing side ($\men$) but untruthful for the other side ($\women$).
That is, the agents in $\women$ may have an incentive to misreport their preferences to obtain a better match.
\end{toappendix}
%
We prove that: 
 
\begin{theoremrep}\label{prop-def-acc-trunc}
    The RAT-degree of deferred acceptance is at most $3$.
\end{theoremrep}

\begin{proof}
    To prove that the RAT-degree is at most $3$, we show that it is $3$-known-agents manipulable. 

    Let $\woman_1 \in \women$ and assume without loss of generality that $\man_1 \succ_{\woman_1} \man_2 \succ_{\woman_1} \cdots$  (the preferences between the other alternatives are irrelevant).

    Consider the case where the $3$-known-agents are as follows::
    \begin{itemize}
        \item Let $\woman_2 \in \women$ be an agent whose preferences are $\man_2 \succ_{\woman_2} \man_1 \succ_{\woman_2} \cdots $.

        \item The preferences of $\man_1$ are $\woman_2 \succ_{\man_1} \woman_1 \succ_{\man_1} \cdots$.

        \item The preferences of $\man_2$ are $\woman_1 \succ_{\man_2} \woman_2 \succ_{\man_2} \cdots$.
    \end{itemize}



    In this case, when $\woman_1$ tells the truth, the resulting matching includes the pairs $(\man_1, \woman_2)$ and $(\man_2, \woman_1)$, since in this case it proceeds as follows:
    \begin{itemize}
        \item In the first step, all the agents in $\men$ propose to their most preferred option: $\man_1$ proposes to $\woman_2$ and $\man_2$ proposes to $\woman_1$.

        Then, the agents in $\women$ tentatively accept their most preferred proposal among those received, as long as she prefers it to remaining unmatched: 
        $\woman_1$ tentatively accepts $\man_2$ since she prefers him over being unmatched, and since $\man_2$ must be her most preferred option among the proposers as $\man_1$ (her top choice) did not propose to her.
        Similarly, $\woman_2$ tentatively accepts $\man_1$.

        \item In the following steps, more rejected agents in $\men$ might propose to $\woman_1$ and $\woman_2$, but they will not switch their choices, as they prefer $\man_2$ and $\man_1$, respectively. 
        
        Thus, when the algorithm terminates $\man_1$ is matched to $\woman_2$ and $\man_2$ is matched to $\woman_1$. 
    \end{itemize}
    Which means that $\woman_1$ is matched to her second-best option.


    We shall now see that $\woman_1$ can increase her utility by misreporting that her preference order is: $\man_1 \succ'_{\woman_1} \phi \succ'_{\woman_1} \man_2 \succ'_{\woman_1} \cdots $.
    The following shows that in this case, the resulting matching includes the pairs $(\man_1, \woman_1)$ and $(\man_2, \woman_2)$, meaning that $\woman_1$ is matched to her most preferred option (instead of her second-best).
    \begin{itemize}
        \item In the first step, as before, $\man_1$ proposes to $\woman_2$ and $\man_2$ proposes to $\woman_1$.

        However, here,  $\woman_1$ rejects $\man_2$ because, according to her false report, she prefers being unmatched over being matched to $\man_2$.
        As before, $\woman_2$ tentatively accepts $\man_1$.


        \item In the second step, $\man_2$, having been rejected by $\woman_1$, proposes to his second-best choice $\woman_2$.

        Since $\woman_2$ prefers $\man_2$ over $\man_1$,  she rejects $\man_1$ and tentatively accepts $\man_2$.


        \item In the third step, $\man_1$, having been rejected by  $\woman_2$, proposes to his second-best choice $\woman_1$.

        $\woman_1$ now tentatively accepts $\man_1$ since according to her false report, she prefers him over being unmatched.
        
        
        \item In the following steps, more rejected agents in $\men$ might propose to $\woman_1$ and $\woman_2$, but they will not switch their choices, as they prefer $\man_2$ and $\man_1$, respectively. 
        
        
        In the following steps, more rejected agents in $\men$ can propose to $\woman_1$ and $\woman_2$ but they would reject their proposes as both of them have the alternative of being matched to their best-option. 

        Thus, when the algorithm terminates $\man_1$ will be matched to $\woman_1$ and and $\man_2$ will be matched to $\woman_2$. 
    \end{itemize}
    

    Thus, regardless of the reports of the remaining $(n-4)$ remaining (unknown) agents report, $\woman_1$ strictly prefers to misreport her preferences.
\end{proof}

The proof is based on a key type of manipulation in this setting called \emph{truncation} \cite{roth1999truncation,ehlers2008truncation,coles2014optimal} -- where agents in $\women$ falsely report that they prefer being unmatched rather than being matched with certain agents â€” even though they actually prefer these matches to being unmatched.

However, in some settings, it is reasonable to assume that agents always prefer being matched if possible. In such cases, the mechanism is designed to accept only preferences over agents from the opposite set (or equivalently, orders where being unmatched is always the least preferred option). Clearly, under this restriction, truncation is not a possible manipulation.
We prove that even when truncation is not possible, the RAT-degree is bounded.


\begin{theoremrep}\label{prop-def-acc-no-trunc}
     Without truncation, the RAT-degree of deferred acceptance is at most $5$.
\end{theoremrep}


\begin{proof}
    To prove that the RAT-degree is at most $5$, we show that it is $5$-known-agents manipulable. 

    Let $\woman_1 \in \women$ and assume without loss of generality that $\man_1 \succ_{\woman_1} \man_2 \succ_{\woman_1} \man_3 \succ_{\woman_1} \cdots$  (the preferences between the other alternatives are irrelevant).

    Consider the case where the $5$-known-agents are as follows:
    \begin{itemize}
        \item Let $\woman_2 \in \women$ be an agent whose preferences are $\man_1 \succ_{\woman_2} \man_2 \succ_{\woman_2} \man_3 \succ_{\woman_2} \cdots $.
        
        \item Let $\woman_3 \in \women$ be an agent whose preferences are $\man_2 \succ_{\woman_3} \man_1 \succ_{\woman_3} \man_3 \succ_{\woman_2} \cdots $.

        \item The preferences of $\man_1$ are $\woman_3 \succ_{\man_1} \woman_1 \succ_{\man_1} \woman_2 \succ_{\man_1} \cdots$.

        \item The preferences of $\man_2$ are $\woman_1 \succ_{\man_2} \woman_3 \succ_{\man_2} \woman_2 \succ_{\man_2} \cdots$.

        \item The preferences of $\man_3$ are $\woman_1 \succ_{\man_2} \woman_3 \succ_{\man_2} \woman_2 \succ_{\man_2} \cdots$.
    \end{itemize}



    In this case, when $\woman_1$ tells the truth, the resulting matching includes the pairs $(\man_1, \woman_3)$, $(\man_2, \woman_1)$ and $(\man_3, \woman_2)$, since in this case it proceeds as follows:
    \begin{itemize}
        \item In the first step, all the agents in $\men$ propose to their most preferred option: $\man_1$ proposes to $\woman_3$, while $\man_2$ and $\man_3$ proposes to $\woman_1$.

        Then, the agents in $\women$ tentatively accept their most preferred proposal among those received.
        $\woman_1$ tentatively accepts $\man_2$ since he must be her most preferred option among the proposers -- as he is her second-best and her top choice, $\man_1$, did not propose to her; and rejects $\man_3$.
        Similarly, $\woman_3$ tentatively accepts $\man_1$.
        $\woman_2$ did not get any proposes.  

        \item In the second step, $\man_3$, having been rejected by $\woman_1$, proposes to his second-best choice $\woman_3$.

        Since $\woman_3$ prefers her current match $\man_1$ over $\man_3$,  she rejects $\man_3$.

        \item In the third step, $\man_3$, having been rejected by $\woman_3$, proposes to his third-best choice $\woman_2$.

        Since $\woman_2$ does not have a match, she tentatively accepts $\man_3$.


        \item In the following steps, more rejected agents in $\men$ - that are not $\man_1, \man_2$ and $\man_3$, might propose to $\woman_1, \woman_2$ and $\woman_3$, but they will not switch their choices, as they can only be least preferred than their current match. 
        
        Thus, when the algorithm terminates $\man_1$ is matched to $\woman_3$, $\man_2$ is matched to $\woman_1$, and $\man_3$ is matched to $\woman_2$. 
    \end{itemize}
    Which means that $\woman_1$ is matched to her second-best option.


    However, when $\woman_1$ misreporting that her preference order is: $\man_1 \succ'_{\woman_1} \man_3 \succ'_{\woman_1} \man_2 \succ'_{\woman_1} \cdots$.
    The following shows that in this case, the resulting matching includes the pairs $(\man_1, \woman_1)$, $(\man_2, \woman_3)$ and $(\man_3, \woman_2)$, meaning that $\woman_1$ is matched to her most preferred option (instead of her second-best).
    \begin{itemize}
        \item In the first step, as before, $\man_1$ proposes to $\woman_3$, while $\man_2$ and $\man_3$ proposes to $\woman_1$.

        However, here,  $\woman_1$ tentatively accepts $\man_3$ and rejects $\man_2$.
        As before, $\woman_3$ tentatively accepts $\man_1$ and $\woman_2$ did not get any proposes.


        \item In the second step, $\man_2$, having been rejected by $\woman_1$, proposes to his second-best choice $\woman_3$.

        Since $\woman_3$ prefers $\man_2$ over $\man_1$,  she rejects $\man_1$ and tentatively accepts $\man_2$.


        \item In the third step, $\man_1$, having been rejected by  $\woman_3$, proposes to his second-best choice $\woman_1$.

        $\woman_1$ tentatively accepts $\man_1$ since according to her false report, she prefers him over $\man_3$.

        
        \item In the fourth step, $\man_3$, having been rejected by  $\woman_1$, proposes to his second-best choice $\woman_3$.

        $\woman_3$ prefers her current match $\man_2$, and thus rejects $\man_3$.


        \item In the fifth step, $\man_3$, having been rejected by  $\woman_3$, proposes to his third-best choice $\woman_2$.

        As $\woman_2$ does not have a match, she tentatively accepts $\man_3$.
        
        
        \item In the following steps, more rejected agents in $\men$ - that are not $\man_1, \man_2$ and $\man_3$, might propose to $\woman_1, \woman_2$ and $\woman_3$, but they will not switch their choices, as they can only be least preferred than their current match. 
        
        Thus, when the algorithm terminates $\man_1$ is matched to $\woman_1$, $\man_2$ is matched to $\woman_3$, and $\man_3$ is matched to $\woman_2$. 
    \end{itemize}
    

    Thus, regardless of the reports of the remaining $(n-6)$ remaining (unknown) agents report, $\woman_1$ strictly prefers to misreport her preferences.
\end{proof}




\subsection{Boston Mechanism}
The \emph{Boston} mechanism \cite{abdulkadirouglu2003school} is a widely used mechanism for assigning students or schools. 
% Unlike the Deferred Acceptance algorithm, it  prioritizes higher-ranked choices in a sequential manner.
\begin{toappendix}
\subsection{Boston Mechanism: descriptions and proofs}
The mechanism proceeds in rounds as follows:
\begin{enumerate}
    \item Each $\man \in \men$ proposes to his most preferred alternative according $\succ_{\man}$ that has not yet rejected him and is still available.

    \item Each $\woman \in \women$ (permanently) accepts her most preferred proposal according to $\succ_{\woman}$ and rejects the rest. Those who accept a propose become unavailable. 

    \item The rejected agents propose to their next most preferred choice as in step $1$.

    \item The process repeats until all agents are either assigned or have exhausted their preference lists.
\end{enumerate}

\end{toappendix}
We prove that:

\begin{theoremrep}
    \label{prop-boston}
    The RAT-degree of the Boston mechanism is at most $2$.
\end{theoremrep}

\begin{proof}
    To prove that the RAT-degree is at most $2$, we show that it is $2$-known-agents manipulable.

    Let $\man_1 \in \men$ be an agent with preferences $\woman_1 \succ_{\man_1} \woman_2 \succ_{\man_1} \cdots$.
    Consider the case where the two known-agents are as follows:
    
    \begin{itemize}
        \item Let $\man_2 \in \men$ be an agent whose preferences are similar, $\woman_1 \succ_{\man_2} \woman_2 \succ_{\man_2} \cdots$.
        \item The preferences of $\woman_1$ are $\man_2 \succ_{\woman_1} \man_1 \succ_{\woman_1} \cdots$.
    \end{itemize}

When $\man_1$ reports truthfully, the mechanism proceeds as follows: In the first round, both $\man_1$ and $\man_2$ proposes to $\woman_1$. Since $\woman_1$ prefers $\man_2$, she rejects $\man_1$ and becomes unavailable. Thus, in the second round, $\man_1$ proposes to $\woman_2$.


However, we prove that $\man_1$ has a safe-and-profitable manipulation: misreports his preference as $\woman_2 \succ'_{\man_1} \woman_3 \succ'_{\man_1} \cdots \succ'_{\man_1} \woman_1$.
The manipulation is safe since $\man_1$ never had a chance to be matched with $\woman_1$ (regardless of his report). 
The manipulation is profitable as there exists a case where the manipulation improves $\man_1$â€™s outcome. Consider the case where the top choice of $\woman_2$ is $\man_1$ and there is another agent, $\man_3$, whose top choice is $\woman_2$. 
Notice that $\woman_2$ prefers $\man_1$ over $\man_3$. 
When $\man_1$ reports truthfully, then in the first round, $\man_3$ proposes to $\woman_2$ and gets accepted, making her unavailable by the time $\man_1$ reaches her in the second round.
However, if $\man_1$ misreports and proposes to $\woman_2$ in the first round, she will accept him (as she prefers him over $\man_3$). This guarantees that $\man_1$ is matched to $\woman_2$, improving his outcome compared to truthful reporting.
\end{proof}

% \eden{\url{https://web.stanford.edu/~alroth/papers/bostonMay182006.pdf}}