%!TEX root = ../main.tex
\subsection{Polynomial Dynamics of Robotics Systems}
\label{app:sec:polynomial-dynamics}

\subsubsection{Push Bot}
\label{app:pd:push-bot}
Push bot is essentially cart-pole with soft wall. The configuration is shown in Figure~\ref{fig:exp:illustration} (a). $a$ is cart's position, $\theta$ is pole's angle, $k_1$ and $k_2$ is soft wall's elastic modulus, $\lamone$ and $\lamtwo$ is two contact forces between two walls and pole's tip. The goal is to stabilize the cart-pole to $(a,\theta) = (0, \pi)$.
From Newtonian mechanics:
\begin{align}
    \label{eq:app:pd:push-bot-newton}
    & (\mcar + \mpole) \frac{d^2}{dt^2}\pos + \mpole \len \frac{d^2}{dt^2}(\sin\theta) - (u + \lamone - \lamtwo) = 0 \\
    & \len \frac{d^2}{dt^2}\theta + (\frac{d^2}{dt^2}\pos + \lamtwo - \lamone) \cos\theta + g \sin\theta = 0 \\
    & 0 \le \lamone \perp \frac{\lamone}{k_1} + d_1 + (\pos + \len \sin\theta) \ge 0 \\
    & 0 \le \lamtwo \perp \frac{\lamtwo}{k_2} + d_2 - (\pos + \len \sin\theta) \ge 0 
\end{align}
Use the same techniques introduced in~\cite{teng2023arxiv-geometricmotionplanning-liegroup}, we discretize~\eqref{eq:app:pd:push-bot-newton} on the lie group~\cite{lee2008thesis-computationalgeometricmechanics} to yield polynomial dynamics:
\begin{align}
    \label{eq:app:pd:push-bot-liegroup}
    & (\mcar + \mpole) \cdot \frac{\pos[k+1] - 2\pos[k] + \pos[k-1]}{\dt^2} \nonumber \\ 
    & + (\mpole \len) \cdot \frac{\rs[k+1] - 2 \rs[k] + \rs[k-1]}{\dt^2} - (u_k + \lamone[k] - \lamtwo[k]) = 0 \\
    & \len \cdot \frac{\fs[k] - \fs[k-1]}{\dt^2} \nonumber \\
    & + \left( 
        \frac{\pos[k+1] - 2\pos[k] + \pos[k-1]}{\dt^2} + (\lamtwo[k] - \lamone[k])
     \right) \cdot \rc[k] + g \cdot \rs[k] = 0 \\
    & 0 \le \lamone[k] \perp \left( \frac{\lamone[k]}{k_1} + d_1 + \pos[k] + \len \rs[k] \right) \ge 0 \\
    & 0 \le \lamtwo[k] \perp \left( \frac{\lamtwo[k]}{k_2} + d_2 - \pos[k] - \len \rs[k] \right) \ge 0 \\
    & \rc[k] = \rc[k-1] \fc[k-1] - \rs[k-1] \fs[k-1] \label{eq:app:pd:2d-liegroup-start} \\
    & \rs[k] = \rs[k-1] \fc[k-1] + \rc[k-1] \fs[k-1] \\
    & \rc[k]^2 + \rs[k]^2 = 1 \\
    & \fc[k]^2 + \fs[k]^2 = 1 \label{eq:app:pd:2d-liegroup-end}
\end{align}
The loss function is designed as:
\begin{align}
    \label{eq:app:pd:push-bot-loss}
    & \loss = \sum_{k=0}^{N-1} c_a \cdot a_k^2 + c_{a,f} \cdot a_N^2 \nonumber \\
        & + \sum_{k=0}^{N-1} c_\theta \cdot \left\{ 
            (\rc[k] + 1)^2 + \rs[k]^2 
         \right\} + c_{\theta,f} \cdot \left\{ 
            (\rc[N] + 1)^2 + \rs[N]^2 
          \right\} \nonumber \\
        & + \sum_{k=0}^{N-1} c_{\dot{\theta}} \cdot \left\{ 
            (\fc[k] - 1)^2 + \fs[k]^2
          \right\} + c_{\dot{\theta},f} \cdot \left\{ 
            (\fc[N] - 1)^2 + \fs[N]^2
           \right\}
\end{align}

\subsubsection{Push Box}
\label{app:pd:push-box}
Consider a simple pusher-slider system illustrated in Figure~\ref{fig:exp:illustration} (b). Our goal is to push the box from one configuration ($(\sx, \sy, \theta)$) to another.
From~\cite{graesdal2024arxiv-tightconvexrelax-contactrich}, given (1) the pusher's position $(\px, \py)$ and the contact force $(\Fx, \Fy)$ in the slider frame; (2) the slider's position $(\sx, \sy)$ and angle $\theta$ in the world frame, the quasi-static dynamics of the slider can be written as:
\begin{align}
    \label{eq:app:pd:push-box-quasi-static}
    & \frac{d}{dt} \sx = \frac{1}{\mu_1 mg} \cdot (\cos\theta \Fx - \sin\theta \Fy) \\
    & \frac{d}{dt} \sy = \frac{1}{\mu_1 mg} \cdot (\sin\theta \Fx + \cos\theta \Fy) \\
    & \frac{d}{dt} \theta = \frac{1}{c r \cdot \mu_1 mg} \cdot (-\py \Fx + \px \Fy) 
\end{align}
where $\mu_1$ is the friction coefficient between the slider and table. $c \in (0, 1)$ is the integration constant that depends on the slider geometry. $r$ is a characteristic distance, typically chosen as the max distance between a contact point and origin of slider frame~\cite{mason1986ijrr-mechanics-planning-pushing}. Use the dimensionless trick:
\begin{align}
    \Fx \leftarrow \frac{1}{\mu_1 mg} \cdot \Fx, \ \Fy \leftarrow \frac{1}{\mu_1 mg} \cdot \Fy
\end{align}
Discretize over the lie group:
\begin{align}
    & \sx[k] = \sx[k-1] + \dt \cdot (\rc[k-1] \Fx[k-1] - \rs[k-1] \Fy[k-1]) \\
    & \sy[k] = \sy[k-1] + \dt \cdot (\rs[k-1] \Fx[k-1] + \rc[k-1] \Fy[k-1]) \\
    & \fs[k-1] = \dt \cdot \frac{1}{cr} \cdot (-\py[k-1] \Fx[k-1] + \px[k-1] \Fy[k-1]) 
\end{align}
Here, the lie-group constraints~\eqref{eq:app:pd:2d-liegroup-start} -~\eqref{eq:app:pd:2d-liegroup-end} are omitted for simplicity. 
Since when pusher has no contact with the slider, slider remains still and pusher's planning task is trivial, we only fucus on the time steps when pusher and slider have contact. As illustrated in Figure~\ref{fig:exp:illustration} (b), we assign for modes $\lam{i}$'s ($ i = 1, 2, 3, 4$ for box's four sides):
\begin{align}
    & \lam{i} (1 - \lam{i}) = 0, \ i = 1, 2, 3, 4 \\
    & \sum_{i=1}^4 \lam{i}^2 = 1
\end{align}
In each mode, the relationship between $\Fx, \Fy, \px, \py$ is different. For example, in mode 1:
\begin{align}
    & \lam{1} \cdot (a^2 - \px^2) \ge 0 \\
    & \lam{1} \cdot (\py - b) = 0 \\
    & \lam{1} \cdot (-\Fy) \ge 0 
\end{align}
where for modelling simplicity, we assume the pushing direction will always be normal to the contact surface. Similar contact constraints can be assigned to mode 2 - 4. Simplify them:
\begin{align}
    & (\lam{1} + \lam{3}) \cdot (a^2 - \px^2) + (\lam{2} + \lam{4}) \cdot (b^2 - \py^2) \ge 0 \\
    & \lam{1} \cdot (\py - b) + \lam{2} \cdot (\px - a) + \lam{3} \cdot (\py + b) + \lam{4} \cdot (\px + a) = 0 \\
    & (-\lam{1} + \lam{3}) \cdot \Fy + (-\lam{2} + \lam{4}) \cdot \Fx \ge 0 \\
    & (\lam{1} + \lam{3}) \cdot \Fx + (\lam{2} + \lam{4}) \cdot \Fy = 0 
\end{align}
The loss function is in the same spirit as~\eqref{eq:app:pd:push-bot-loss}. We omit it here.

\subsubsection{Push T-block}
\label{app:pd:push-T-block}

Now we consider a more complicated pushing task: push a T-block, as illustrated in Figure~\ref{fig:exp:illustration} (c). Unlike 4 modes in the box setting, now we have 8 modes to assign. From~\cite{lynch1992iros-manipulation-active-sensing-pushing}, when $\mu_1$ is uniformly distributed between the slider and the table, the friction center coincides with the projection of the center of mass (CM) to the table. Thus, we set the origin of the Slider frame to T-block's CM for convenience. $d_c$ from Figure~\ref{fig:exp:illustration} (c) can be derived as:
\begin{align}
    d_c = \frac{
        3 \times 1.5 + 4 \times 3.5
    }{3 + 4} = \frac{37}{14}
\end{align}
There are eight key points in the T-block:
\begin{align}
    & x_1 = -2l, \ x_2 = -0.5l, \ x_3 = 0.5l, \ x_4 = 2l \\
    & y_1 = -d_c l, \ y_2 = (3 - d_c) l, \ y_3 = (4 - d_c) l 
\end{align}
Connect each mode with geometric and dynamical constraints:
\begin{align}
    & \lam{1} \Longrightarrow \py - y_3 = 0, \px - x_1 \ge 0, x_4 - \px \ge 0, -\Fy \ge 0, \Fx = 0 \\
    & \lam{2} \Longrightarrow \px - x_4 = 0, \py - y_2 \ge 0, y_3 - \py \ge 0, -\Fx \ge 0, \Fy = 0 \\
    & \lam{3} \Longrightarrow \py - y_2 = 0, \px - x_3 \ge 0, x_4 - \px \ge 0, \Fy \ge 0, \Fx = 0 \\
    & \lam{4} \Longrightarrow \px - x_3 = 0, \py - y_1 \ge 0, y_2 - \py \ge 0, -\Fx \ge 0, \Fy = 0 \\
    & \lam{5} \Longrightarrow \py - y_1 = 0, \px - x_2 \ge 0, x_3 - \px \ge 0, \Fy \ge 0, \Fx = 0 \\
    & \lam{6} \Longrightarrow \px - x_2 = 0, \py - y_1 \ge 0, y_2 - \py \ge 0, \Fx \ge 0, \Fy = 0 \\
    & \lam{7} \Longrightarrow \py - y_2 = 0, \px - x_1 \ge 0, x_2 - \px \ge 0, \Fy \ge 0, \Fx = 0 \\
    & \lam{8} \Longrightarrow \px - x_1 = 0, \py - y_2 \ge 0, y_3 - \py \ge 0, \Fx \ge 0, \Fy = 0
\end{align}
Other things are the same as the Push Box case. 

% \input{figures/goodplot/PushT-goodplot.tex}

\subsubsection{Push Box with a Tunnel}
\label{app:pd:push-box-tunnel}

Everything is the same as Push Box setting, except that the box needs to avoid two circle obstacles this time. To model the collision avoidance constraints, we approximate the box as a union of two circles, as shown in Figure~\ref{fig:exp:illustration} (d). For each obstacle-slider circle pair, the non-collision constraint is:
\begin{align}
    (x_o - x_s)^2 + (y_o - y_s)^2 \ge (r_o + r_s)^2
\end{align}
where $(x_o, y_o, r_o)$ (resp. $(x_s, y_s, r_s)$ ) represents center and radius of obstacle's (resp. slider's) center.

% \input{figures/goodplot/PushBoxTunnel2-goodplot.tex}

\subsubsection{Planar Hand}
\label{app:pd:planar-hand}

The geometric and mechanical information of the Planar Hand system is illustrated in Figure~\ref{fig:exp:illustration} (e). The goal is to rotate the circle disk $360^\circ$ with planar hand's two finger tips, while minimize the translation of the disk's center of mass. 

\textbf{Kinematics of the fingers.}
For two fingers, we use position control. For example, for the right finger:
\begin{align}
    & x_r = L_d \cdot \cos\theta_{rd} + L_u \cdot \cos\theta_{ru} + \frac{H}{2} \\
    & y_r = L_d \cdot \sin\theta_{rd} + L_u \cdot \sin\theta_{ru} \\
    & v_{x,r} = -L_d \cdot \sin\theta_{rd} \cdot \dot{\theta}_{rd} - L_u \cdot \sin\theta_{ru} \cdot \dot{\theta}_{ru} \\
    & v_{y,r} = L_d \cdot \cos\theta_{rd} \cdot \dot{\theta}_{rd} + L_u \cdot \cos\theta_{ru} \cdot \dot{\theta}_{ru}
\end{align}
where "r" and "l" represent "right" and "left" finger, while "u" and "d" represent "upper" and "down" link. Since 
\begin{align}
    \fs = \sin(\dot{\theta} \cdot \dt) \Longrightarrow \dot{\theta} \approx \frac{\fs}{\dt}
\end{align}
Then,
\begin{align}
    & \xr[k] = L_d \cdot \rc[rd,k] + L_u \cdot \rc[ru,k] + \frac{H}{2} \\
    & \yr[k] = L_d \cdot \rs[rd,k] + L_u \cdot \rs[ru,k] \\
    & \vxr[k] = -\frac{L_d}{\dt} \cdot \rs[rd,k] \cdot \fs[rd,k] - \frac{L_u}{\dt} \cdot \rs[ru,k] \cdot \fs[ru,k] \\
    & \vyr[k] = \frac{L_d}{\dt} \cdot \rc[rd,k] \cdot \fs[rd,k] + \frac{L_u}{\dt} \cdot \rc[ru,k] \cdot \fs[ru,k] \\
    & \rc[rd,k+1] = \rc[rd,k] \cdot \fc[rd,k] - \rs[rd,k] \cdot \fs[rd,k] \\
    & \rs[rd,k+1] = \rc[rd,k] \cdot \fs[rd,k] + \rs[rd,k] \cdot \fc[rd,k] \\
    & \rc[ru,k+1] = \rc[ru,k] \cdot \fc[ru,k] - \rs[ru,k] \cdot \fs[ru,k] \\
    & \rs[ru,k+1] = \rc[ru,k] \cdot \fs[ru,k] + \rs[ru,k] \cdot \fc[ru,k]
\end{align}

\textbf{Self collision avoidance.}
For each finger, there are two types of self collisions: (1) the first circle with the ground; (2) the second and the third circle. For the first type:
\begin{align}
    & \theta_{ld} \ge \arcsin(\frac{r}{l+r}), \ \pi - \theta_{ld} \ge \arcsin(\frac{r}{l+r}) \\
    & \theta_{rd} \ge \arcsin(\frac{r}{l+r}), \ \pi - \theta_{rd} \ge \arcsin(\frac{r}{l+r})
\end{align}
For the second type:
\begin{align}
    & \pi - \theta_{ld} + \theta_{lu} \ge 2 \cdot \arcsin(\frac{r}{l+r}) \\
    & 2 \pi - (\pi - \theta_{rd} + \theta_{ru}) \ge 2 \cdot \arcsin(\frac{r}{l+r}) 
\end{align}
Also, like a human finger, we assume the upper link won't "turn outward":
\begin{align}
    & \theta_{ld} - \theta_{lu} \ge 0 \\
    & \theta_{ru} - \theta_{rd} \ge 0 
\end{align}

Now denote $\theta_0$ as $\arcsin(\frac{r}{l+r})$. Writing the constraints as polynomials:
\begin{align}
    & \rs[ld,k] \ge \sin\theta_0 \\
    & \rs[rd,k] \ge \sin\theta_0
\end{align}
and 
\begin{align}
    & \sin(\theta_{ld,k} - \theta_{lu,k}) 
    = \rs[ld,k] \cdot \rc[lu,k] - \rc[ld,k] \cdot \rs[lu,k] \ge 0 \\
    & \cos(\theta_{ld,k} - \theta_{lu,k}) 
    = \rc[ld,k] \cdot \rc[lu,k] + \rs[ld,k] \cdot \rs[lu,k] \ge -\cos(2\theta_0) \\
    & \sin(\theta_{ru,k} - \theta_{rd,k}) 
    = \rs[ru,k] \cdot \rc[rd,k] - \rc[ru,k] \cdot \rs[rd,k] \ge 0 \\
    & \cos(\theta_{ru,k} - \theta_{rd,k}) 
    = \rc[ru,k] \cdot \rc[rd,k] + \rs[ru,k] \cdot \rs[rd,k] \ge -\cos(2\theta_0)
\end{align}

\textbf{Contact model.}
Now we deal with the contact between the fingers and the disk. Without loss of generality, we consider the right finger. Denote $d_r$ as:
\begin{align}
    & d_r^2 = (x_r - x)^2 + (y_r - y)^2 \\
    & d_r \ge R+r
\end{align}
where $(x, y)$ is the position of the disk's center. When contact happens, $d_r = R+r$. In this case, denote $(v_x, v_y, w)$ as the translational and angular velocity of the disk, $(\lam{t}[r], \lam{n}[r])$ as the tangential and normal force exerted on the disk by the tip of the finger, and $\vrelr$ as the relative tangential velocity of finger's tip compared to the disk. The physical quantities are illustrated in Figure~\ref{fig:exp:illustration} (e)'s upper right position. Denote the angle $\eta_r$ as:
\begin{align}
    & \cos\eta_r = \frac{x_r - x}{d_r} \\
    & \sin\eta_r = \frac{y_r - y}{d_r} 
\end{align}
Then,
\begin{align}
    \vrelr \approx & -\vxr \cdot \sin\eta_r + \vyr \cdot \cos\eta_r \nonumber \\
    & - (-v_x \cdot \sin\eta_r + v_y \cdot \cos\eta_r + \omega R)
\end{align}
Here we do one approximation for finger tip's tangential velocity, by ignoring the tip's size. One thing we should notice is, $\lam{n}$ will always point inside the disk:
\begin{align}
    -\lam{n,r} \ge 0 
\end{align}
By the Coulomb's law:
\begin{align}
    \lam{t,r} \begin{cases}
        & = \mu \cdot (-\lam{n,r}), \ \vrelr > 0 \\
        & = -\mu \cdot (-\lam{n,r}), \ \vrelr < 0 \\
        & \in [-\mu \cdot (-\lam{n,r}), \mu \cdot (-\lam{n,r})], \ \vrelr = 0
    \end{cases}
\end{align}
Unlike~\cite{posa2014ijrr-traopt-directmethod-contact} who introduced two auxiliary variables to app:pdress the above model as nine quadratic polynomials, we advocate for a more concise representation:
\begin{align}
    & \mu^2 \cdot \lam{n,r}^2 - \lam{t,r}^2 \ge 0 \\
    & \vrelr \cdot (\mu^2 \cdot \lam{n,r}^2 - \lam{t,r}^2) = 0 \\
    & \vrelr \cdot \lam{t,r} \ge 0 
\end{align}
Combine everything together:
\begin{align}
    & \dr[k]^2 = (\xr[k] - \x[k])^2 + (\yr[k] - \y[k])^2 \\
    & \dr[k] \ge R + r \\
    & \vrelr[k] = -(\vxr[k] - \vx[k]) \cdot \frac{\yr[k] - \y[k]}{R+r} \nonumber \\
    & + (\vyr[k] - \vy[k]) \cdot \frac{\xr[k] - \x[k]}{R+r} 
    - R \cdot \frac{\fs[k]}{\dt} \\
    & (\dr[k] - R - r) \cdot \lam{n,r}[k] = 0 \\
    & -\lam{n,r}[k] \ge 0 \\
    & \mu^2 \cdot \lam{n,r}[k]^2 - \lam{t,r}[k]^2 \ge 0 \\
    & \vrelr[k] \cdot (\mu^2 \cdot \lam{n,r}[k]^2 - \lam{t,r}[k]^2) = 0 \\
    & \vrelr[k] \cdot \lam{t,r}[k] \ge 0 
\end{align}

\textbf{Dynamics of disk.}
Consider the quasi-static dynamics similar to~\eqref{eq:app:pd:push-box-quasi-static}:
\begin{align}
    & \frac{d}{dt} \x = \lam{n,r} \cdot \cos\eta_r - \lam{t,r} \cdot \sin\eta_r + \lam{n,l} \cdot \cos\eta_l - \lam{t,r} \cdot \sin\eta_l \\
    & \frac{d}{dt} \y = \lam{n,r} \cdot \sin\eta_r + \lam{t,r} \cdot \cos\eta_r + \lam{n,l} \cdot \sin\eta_l + \lam{t,r} \cdot \cos\eta_l \\
    & \frac{d}{dt} \alpha = \frac{1}{c \cdot R} \cdot (\lam{t,r} + \lam{t,l})
\end{align}
Write them as polynomials:
\begin{align}
    & \frac{1}{\dt} (\x[k+1] - \x[k]) = \lam{n,r}[k] \cdot \frac{\xr[k] - \x[k]}{R+r} - \lam{t,r}[k] \cdot \frac{\yr[k] - \y[k]}{R+r} 
    + \lam{n,l}[k] \cdot \frac{\xl[k] - \x[k]}{R+r} - \lam{t,l}[k] \cdot \frac{\yl[k] - \y[k]}{R+r} \\
    & \frac{1}{\dt} (\y[k+1] - \y[k]) = \lam{n,r}[k] \cdot \frac{\yr[k] - \y[k]}{R+r} + \lam{t,r}[k] \cdot \frac{\xr[k] - \x[k]}{R+r} 
    + \lam{n,l}[k] \cdot \frac{\yl[k] - \y[k]}{R+r} + \lam{t,l}[k] \cdot \frac{\xl[k] - \x[k]}{R+r} \\
    & \fs[k] = \frac{\dt}{c \cdot R} \cdot (\lam{t,r}[k] + \lam{t,l}[k]) \\
    & \rc[k+1] = \rc[k] \cdot \fc[k] - \rs[k] \cdot \fs[k] \\
    & \rs[k+1] = \rc[k] \cdot \fs[k] + \rs[k] \cdot \fc[k] \\
    & \fs[k]^2 + \fc[k]^2 = 1 
\end{align}

\textbf{Collision avoidance.}
Consider the right finger. Since the finger tip has already been considered in the contact model, we only need to consider collision avoidance between the object and the remaining three circles attached to the finger. The three circles' positions are:
\begin{align}
    & \left( 
        (l+r) \cos\theta_{rd} + \frac{H}{2}, (l+r) \sin\theta_{rd}
     \right) \\
    & \left( 
        (2l + 3r) \cos\theta_{rd} + \frac{H}{2}, (2l + 3r) \sin\theta_{rd}
    \right) \\
    & \left( 
        L_d \cos\theta_{rd} + (l+r) \cos\theta_{ru} + \frac{H}{2}, L_d \sin\theta_{rd} + (l+r) \sin\theta_{ru}
     \right)
\end{align}
Therefore, the constraints are:
\begin{align}
    & \left( (l+r) \cdot \rc[rd,k] - \x[k]  + \frac{H}{2} \right)^2 
    + \left( (l+r) \cdot \rs[rd,k] - \y[k] \right)^2 \ge (R+r)^2 \\
    & \left( (2l+3r) \cdot \rc[rd,k] - \x[k]  + \frac{H}{2} \right)^2 
    + \left( (2l+3r) \cdot \rs[rd,k] - \y[k] \right)^2 \ge (R+r)^2 \\
    & \left( L_d \cdot \rc[rd,k] + (l+r) \cdot \rc[ru,k] - \x[k]
    + \frac{H}{2} \right)^2 
    + \left( L_d \cdot \rs[rd,k] + (l+r) \cdot \rs[ru,k] - \y[k] \right)^2 \ge (R+r)^2
\end{align}


