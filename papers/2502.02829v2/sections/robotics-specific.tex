%!TEX root = ../main.tex

\section{Robotics-Specific Sparsity}
\label{sec:robotics-specific}

While automatic correlative and term sparsity (CS-TS) exploitation is powerful, it has two notable limitations. 
(a) It occasionally fails to capture time, spatial, and kino-dynamical sparsity inherent in contact-rich planning problems, such as the Markov property described in~\cite{kang2024wafr-strom}.
(b) The approach introduced in \S\ref{sec:general-sparsity-ksc} heavily depends on approximate minimal chordal extensions. Although theoretically rigorous, chordal extensions can substantially increase the size of variable or term cliques, resulting in scalability challenges.

To address these, we propose several robotics-specific sparsity patterns as auxiliary tools to complement the automatic sparsity. Similarly, we categorize robotics-specific sparsity patterns into two levels, (a) variable level and (b) term level.

\input{figures/robotics-specific/robotics-specific.tex}

\subsection{Variable-level Robotics-Specific Sparsity}
% \input{figures/robotics-specific/variable-level.tex}

\textbf{Kinematic chain.} Numerous robotic systems exhibit chain-like (or tree-like) mechanical structures, commonly found in manipulation and locomotion. These structures lead to a natural separation of kinematic and dynamic variables across different links. For example, consider the following system:
\begin{subequations} \label{eq:rs:kinematic-chain}
    \begin{align}
& x_{1,k+1} = x_{1,k} + u_{1,k}, \\
 &x_{2,k+1} = x_{2,k} + u_{2,k} , \\
 & x_{3,k+1} = x_{3,k} + u_{3,k} ,\\
        & (x_{1,k} - x_{2,k})^2 = r^2 , \quad (x_{2,k} - x_{3,k})^2 = r^2 \label{eq:rs:kinematic-chain:constraint}
    \end{align} 
\end{subequations}
which can be viewed as a 1-D two-link chain, with three states $(x_1, x_2, x_3)$ and two geometric constraints in~\eqref{eq:rs:kinematic-chain:constraint}. If only exploring the Markov property in~\cite{kang2024wafr-strom}, a chain of cliques will be derived, with the $k$'th clique containing 9 variables:
\begin{align}
    \left\{ x_{i,k}, x_{i,k+1}, u_{i,k} \right\}_{i=1}^3.
\end{align}
However, since $(x_1, x_2)$, $(x_2, x_3)$ forms two links, and each $u_i, i \in \left\{ 1,2,3 \right\}$ only has direct effect on $x_i$, we can further decompose the clique as three cliques of size 3:
\begin{align}
    \left\{ 
        x_{i,k}, x_{i,k+1}, u_{i,k}
    \right\}, \ i = 1,2,3
\end{align} 
and four cliques of size 2: 
\begin{align}
    \left\{ 
        x_{i,m}, x_{i+1,m}
     \right\}, \ i = 1,2, \ m = k, k+1,
\end{align}
as illustrated in Fig.~\ref{fig:rs:robotics-specific}(a). 
% If second-order relaxation is used, the former large clique will involve one positive semidefinite (PSD) cone of size $55 \times 55$, while the latter only contains three PSD cones of size $10 \times 10$ and four PSD cone of size $6 \times 6$. 
Note that this clique partition cannot be discovered by the general sparsity pattern introduced in \S\ref{sec:general-sparsity-ksc}, since the graph in Fig.~\ref{fig:rs:robotics-specific}(a) is not chordal. 

\textbf{Separation plane.} Consider a general obstacle avoidance task: both the robot and the obstacles can be decomposed as a union of convex sets. We denote the decomposition of robot as $\left\{ P_i \right\}_{i \in \enum{m}}$ and the decomposition of obstacles as $\left\{ Q_j \right\}_{j \in \enum{n}}$. For each $i$ and $j$, $P_i$ has no collision with $Q_j$ if and only if there exists a plane $H_{i,j}$ separating $P_i$ and $Q_j$. Consider $P_i$ and $Q_j$ being both 2-D polygons:
\begin{align}
    \label{eq:rs:separation-plane}
    \vspace{-10mm} A_{i,j}  v_{r,x} + B_{i,j}  v_{r,y} + C_{i,j} \ge 0, \ \forall v_r \in P_i's \text{ vertices} \\
   \vspace{-10mm} A_{i,j} v_{o,x} + B_{i,j} v_{o,y} + C_{i,j} \le 0, \ \forall v_o \in Q_j's \text{ vertices}
\end{align}
where $(A_{i,j}, B_{i,j}, C_{i,j})$ determines a 2-D separation plane (line) $H_{i,j}$. 
% Note that this formulation can be viewed as a "dual" formulation of GCS~\cite{marcucci2023sr-motion-planning-gcs}, whose decomposition happens in the free space.
For constraints~\eqref{eq:rs:separation-plane}, $(A_{i,j}, B_{i,j}, C_{i,j})$ has no direct relationship between each other. Thus, in each time step, instead of defining a large variable clique:
\begin{align}
    \label{eq:rs:separation-plane-large}
    \left\{ \text{other variables}, \left\{ (A_{i,j}, B_{i,j}, C_{i,j}) \right\}_{i \in \enum{m}, j \in \enum{n}} \right\}
\end{align}
we define $mn$ smaller variable cliques:
\begin{align}
    \label{eq:rs:separation-plane-small}
    \left\{ 
        \text{other variables}, (A_{i,j}, B_{i,j}, C_{i,j})
     \right\}_{i \in \enum{m}, j \in \enum{n}}
\end{align}
The resulting clique size is invariant to $m$ and $n$, as illustrated in Fig.~\ref{fig:rs:robotics-specific}(b). 
% In terms of the PSD cone size in the second order relaxation, the former~\eqref{eq:rs:separation-plane-large} grows $\calO(m^2 n^2)$, while the latter~\eqref{eq:rs:separation-plane-small} only contains $mn$ smaller PSD cone of size $\calO(1)$. 
What's more, one can check that the decomposition~\eqref{eq:rs:separation-plane-small} still satisfies the running intersection property (RIP) required in correlative sparsity pattern~\cite{lasserre2006msc-correlativesparse}.



\subsection{Term-level Robotics-Specific Sparsity}

% \input{figures/robotics-specific/term-level.tex}

\textbf{Separable contact modes.} Frequently in contact-rich planning, we will have to ``select one out of a bunch of modes'' (\cf \S\ref{app:pd:push-box} and\S\ref{app:pd:push-T-block}). It can be modelled as polynomial equalities:
\begin{align}
    \label{eq:rs:separable-contact-modes}
    & h_0 \triangleq \sum_{i \in \enum{n}} \lambda_i^2 - 1 = 0 \\
    & h_i \triangleq \lambda_i \cdot (1 - \lambda_i) = 0, \ \forall i \in \enum{n},
\end{align}
where $\lambda_i$ is a binary variable corresponding to whether the $i$-th contact mode is selected.
In variable level, there is no sparsity in~\eqref{eq:rs:separable-contact-modes}, since $\sum_{i \in \enum{n}} \lambda_i^2 = 1$ groups all $\lambda_i$'s together. However, we show that the sparsity is still rich in the term level. Consider the generation procedure of $\calA$ in term sparsity~\eqref{eq:gs:ts-A}, for the polynomial equality constraint system~\eqref{eq:rs:separable-contact-modes}:
\begin{align}
    \label{eq:rs:separable-contact-A}
    \calA = \left\{ 
        1,
        \left\{ \lambda_i \right\}_{i \in \enum{n}}, 
        \left\{ \lambda_i^2 \right\}_{i \in \enum{n}}
     \right\}.
\end{align}
Consider the special case $n = 3$ in second-order relaxation $d = 2$, and there is only one variable clique (\ie $l = 1$). By definition of the polynomial multiplier $H_2(h_i, I_1), i \in \left\{ 0,1,2,3 \right\}$ for equality constraints~\eqref{eq:gs:H}:
\begin{align}
    \hspace{-4mm} H_2(h_i, I_1)\! =\! \left[ 
        1,\lam{1},\lam{2},\lam{3},\lam{1}^2,\lam{1}\lam{2},\lam{1}\lam{3},\lam{2}^2,\lam{2}\lam{3},\lam{3}^2
     \right]\tran\!\!.\!\!\!\! 
\end{align}
If we proceed with the support extension procedure for equality constraints~\eqref{eq:gs:ts-equality-support-extension}, then we have 
\begin{align}
    B_{2,1,0}^h = & \left[ 1,1,1,1,1,0,0,1,0,1 \right] \\
    B_{2,1,1}^h = & \left[ 1,1,0,0,0,0,0,0,0,0 \right] \\
    B_{2,1,2}^h = & \left[ 1,0,1,0,0,0,0,0,0,0 \right] \\
    B_{2,1,2}^h = & \left[ 1,0,0,1,0,0,0,0,0,0 \right]
\end{align}
In the second-order moment matrix, the unmasked terms are:
\begin{equation}
    \begin{split}
        1, \left\{ \lambda_i \right\}_{i \in \enum{3}}, \left\{ \lambda_i^2 \right\}_{i \in \enum{3}}, \left\{ \lambda_i^3 \right\}_{i \in \enum{3}}, \\ \left\{ \lambda_i^4 \right\}_{i \in \enum{3}}, \left\{ \lambda_i \lambda_j^2 \right\}_{i \in \enum{3}, j \in \enum{3}, i \ne j}
       \end{split}
\end{equation}
leading to the moment matrix generated by a reduced basis:
\begin{align}
    \label{eq:rs:separable-contact-basis}
    \left\{ 1,\lam{1},\lam{2},\lam{3},\lam{1}^2,\lam{2}^2,\lam{3}^2 \right\}
\end{align}
as shown in Fig.~\ref{fig:rs:robotics-specific}(c). The key observation is that there is no $\lam{i}\lam{j} (i \ne j)$ in the new basis (i.e., the contact modes are separated).
For a general $n$, the reduced basis is of size $2n+1$, which is much smaller than the standard monomial basis of size $\frac{(n+1)(n+2)}{2}$. 

\textbf{Separable contact forces.} In contact-implicit formulation, each possible contact is modelled as a set of complementary constraints. Suppose there are $n$ contact points, then a typical dynamics formulation is (\cf \S\ref{app:pd:push-bot} and \S\ref{app:pd:planar-hand}):
\begin{align}
    \label{eq:rs:contact-implicit}
    & 0 \le \lam{i} \perp g_i(x) \ge 0, \ i \in \enum{n} \\
    & \sum_{i \in \enum{n}} f_i(\lambda_i, x, u) = 0
\end{align}
where $x \in \Real{n_x}$ is the system state and $u \in \Real{n_u}$ is the control input. Similar to the contact mode case~\eqref{eq:rs:separable-contact-modes}, $\sum_{i \in \enum{n}} f_i(\lambda_i, x, u)$ groups all $\lambda_i$'s together. Thus, there is no variable-level sparsity pattern. However, inspired by the reduced basis introduced in~\eqref{eq:rs:separable-contact-basis}, we can directly write down an extended reduced basis containing $x$ and $u$. For simplicity, assume $x$ and $u$ are both of one dimension, $f_i$ is of quadratic form and linear in $\lambda_i$, then the reduced basis is
\begin{align}
    \left\{ \substack{
        1, x, u, x^2, xu, u^2, \\ \left\{ \lambda_i \right\}_{i \in \enum{n}}, 
        \left\{ \lambda_i^2 \right\}_{i \in \enum{n}}, \left\{ x \lambda_i \right\}_{i \in \enum{n}}, \left\{ u \lambda_i \right\}_{i \in \enum{n}}}
     \right\}
\end{align}
which grows linearly in $n$.