In this section, we provide a way to formulate the fluid-based optimization problem with a smaller number of decision variables and constraints. The reduction is achieved based on the fact that only vehicles with task remaining time $\timetoarrival \leq \Lp$ can be assigned with new tasks, and therefore we only need to keep track of the statuses of vehicles with task remaining time $\timetoarrival \leq \Lp$ in the optimization.

We define the variables of the simplified fluid-based optimization problem as follows:
\begin{enumerate}
    \item[-] \emph{Fraction of fleet with a vehicle status for trip fulfilling $\lpredtripfulfill{}{} := \left(\lpredtripfulfill{\origin \destination, \battery, \timetoarrival}{\time}\right)_{\origin,\destination \in \Region, \time \in [T], \battery \in [B], \timetoarrival \in[\Lp]}$}, where $\lpredtripfulfill{\origin \destination, \battery, \eta}{\time}$ is the fraction of vehicles with battery level $\battery$ at time $\time$ that pick up trip requests from $\origin$ to $\destination$ with remaining waiting time $\timetoarrival$. We remark two differences of $\lpredtripfulfill{}{}$ from the variable $\lptripfulfill{}{}$ in the original formulation: (i) $\lpredtripfulfill{}{}$ only keeps track of the vehicles with task remaining time $\timetoarrival \leq \Lp$, whereas $\lptripfulfill{}{}$ keeps track of vehicles of all statuses; (ii) $\lpredtripfulfill{}{}$ can be considered as an aggregation of $\lptripfulfill{}{}$ across all trip active times $\tripactivetime$, i.e., $\lpredtripfulfill{\origin \destination, \battery, \timetoarrival}{\time} = \sum_{\tripactivetime \in [\Lc]} \lptripfulfill{(\origin, \timetoarrival, \battery), (\origin, \destination, \tripactivetime)}{\time}$.
    \item[-] \emph{Fraction of fleet fulfilling trip requests with a certain status $\lpredslack{}{} := \left(\lpredslack{\origin \destination, \timetoarrival, \tripactivetime}{\time}\right)_{\origin,\destination \in \Region, \eta \in [\Lp], \tripactivetime \in [\Lc], \time \in [T]}$}, where $\lpredslack{\origin \destination, \timetoarrival, \tripactivetime}{\time}$ is fraction of vehicles assigned at time $t$ to a trip with o-d pair $\origin\destination$ that has been waiting for assignment for $\tripactivetime$ steps and will be pick up after $\timetoarrival$ time steps. We note that $\lpredslack{}{}$ differs from $\lpredtripfulfill{}{}$ in that $\lpredslack{}{}$ aggregates the trip-fulfilling vehicles across battery level $\battery$, while $\lpredtripfulfill{}{}$ aggregates them across trip active time $\tripactivetime$. In particular, $\lpslack{\origin \destination, \timetoarrival, \tripactivetime}{\time} = \sum_{\battery \in [\range]} \lptripfulfill{(\origin, \timetoarrival, \battery), (\origin, \destination, \tripactivetime)}{\time}$.
    \item[-] \emph{Fraction of fleet for repositioning $\lpredreroute{}{} := \left(\lpredreroute{\origin \destination, \battery}{\time}\right)_{\origin,\destination \in \Region, \time \in [T], \battery \in [B]}$}, where $\lpredreroute{\origin \destination, \battery}{\time}$ is the fraction of vehicles with battery level $\battery$ at time $\time$ repositioning from $\origin$ to $\destination$. Here, the variable $\lpredreroute{\origin \destination, \battery}{\time}$ is equivalent to the decision variable $\lpreroute{(\origin, 0, \battery), \destination}{\time}$ in the original formulation.
    \item[-] \emph{Fraction of fleet for charging $\lpredcharge{}{} := \left(\lpredcharge{\region, \type,\battery}{\time}\right)_{\region \in \Region, \type \in \Type, \time \in [T], \battery \in [\range]}$}, where $\lpredcharge{\region, \type, \battery}{\time}$ denotes the fraction of vehicles with battery level $\battery$ charging at region $\region$ with rate $\type$ at time $\time$. Here, the variable $\lpredcharge{\region, \type, \battery}{\time}$ is equivalent to the decision variable $\lpcharge{(\region, 0, \battery), \type}{\time}$ in the original formulation.
    \item[-] \emph{Fraction of fleet for continuing the current action $\lpredpass{}{} := \left(\lpredpass{\region, \battery, \timetoarrival}{\time}\right)_{\region \in \Region, \battery \in[\range], \timetoarrival \in [\Lp], \time \in [\Horizon]}$}, where $\lpredpass{\region, \battery, \timetoarrival}{\time}$ is the fraction of fleet $\timetoarrival$ steps away with destination $\region$ with battery $\battery$ that takes the passing action at time $\time$. Here, the variable $\lpredpass{\region, \battery, \timetoarrival}{\time}$ is equivalent to the decision variable $\lppass{(\region, \timetoarrival, \battery)}{\time}$ in the original formulation. Again, we note that $\lpredpass{}{}$ only keeps track of the vehicles statuses with task remaining time $\timetoarrival \leq \Lp$, while $\lppass{}{}$ in the original formulation keeps track of all vehicle statuses.
\end{enumerate}

The simplified fluid-based linear program is given as follows: 

\allowdisplaybreaks
{\small \begin{subequations} \label{eq:fluid-lp}
\begin{align}
    &\max_{\lpredtripfulfill{}{}, \lpredreroute{}{}, \lpredcharge{}{}, \lpredslack{}{}, \lpredpass{}{}} \  \  \Size \sum_{\time \in [\Horizon]}^{} \left\{ \sum_{\origin \in \Region} \sum_{\destination \in \Region} \left[ \tripfulfillreward{,\origin\destination}{\time} \right. \right. \nonumber \\
    &\qquad \left. \left(\sum_{\tripactivetime \in [\Lc]}^{}\sum_{\timetoarrival \in [\Lp]}^{} \lpredslack{\origin \destination, \timetoarrival, \tripactivetime}{\time} \right) + \reroutingreward{,\origin\destination}{\time} \sum_{\battery \in [\range]}^{} \lpredreroute{\origin \destination, \battery}{\time} \right] \nonumber\\ 
    &\qquad+ \left. \sum_{\type \in \Type} \chargingreward{,\type}{\time} \sum_{\region \in \Region} \sum_{\battery \in [\range]}^{} \lpredcharge{\region, \type, \battery}{\time} \right\}, \notag \\%\label{eq:fluid-obj}\\
    &\text{s.t.} \  \left[ \sum_{\destination \in \Region} \left( \sum_{\timetoarrival' \in [\Lp]}^{} \lpredtripfulfill{\destination \origin, \battery + \batterycost{\destination \origin}, \timetoarrival'}{\phi_{\destination \origin}(t, \timetoarrival')} \nonumber \right. \right.\\ 
    &\qquad+ \left. \left. \lpredreroute{\destination \origin, \battery + \batterycost{\destination \origin}}{\phi_{\destination \origin}(t, 0)} \mathds{1}\{\destination \neq \origin\} \right) \mathds{1}\{\battery + \batterycost{\destination \origin} \leq \range \} \right. \nonumber \\
    &\qquad+ \left. \sum_{\type \in \Type} \lpredcharge{\origin, \type, \battery - \type \chargetime}{(\time + \timetoarrival - \chargetime)} \mathds{1}\{\battery \geq \type \chargetime\} \right. \notag\\ 
    &\qquad+ \left. \sum_{\type \in \Type} \sum_{\battery' > \range - \type \chargetime} \lpredcharge{\origin, \type, \battery'}{(\time + \timetoarrival - \chargetime)} \mathds{1}\{\battery = \range\} \right] \mathds{1}\{\timetoarrival = \Lp\} \nonumber\\ 
    &\qquad+ \lpredreroute{\origin \origin, \battery}{(\time - 1)} \mathds{1}\{\timetoarrival = 0\} + \lpredpass{\origin, \battery, \timetoarrival + 1}{(\time - 1)} \mathds{1}\{\timetoarrival < \Lp\} \notag \\
    &\quad= \sum_{\destination \in \Region} \left(\lpredtripfulfill{\origin \destination, \battery, \timetoarrival}{\time} + \lpredreroute{\origin \destination, \battery}{\time} \right) + \sum_{\type \in \Type} \lpredcharge{\origin, \type, \battery}{\time} + \lpredpass{\origin, \battery, \timetoarrival}{\time} \mathds{1}\{\timetoarrival > 0\},\nonumber\\ 
    &\qquad \forall \origin \in \Region, \   \timetoarrival \in [\Lp], \   \time \in [\Horizon], \  \battery \in [\range], \label{eq:fluid-ev-conservation}\\
    &\ \sum_{\battery \in [\range]}^{} \lpredtripfulfill{\origin \destination, \battery, \timetoarrival}{\time} = \sum_{\tripactivetime \in [\Lc]}^{} \lpredslack{\origin \destination, \timetoarrival, \tripactivetime}{\time}, \nonumber\\
    &\qquad \forall \origin, \destination \in \Region, \  \timetoarrival \in [\Lp], \  \time \in [\Horizon], \label{eq:fluid-passenger-flow-decomp}\\
    &\ \sum_{\tripactivetime \in [\Lc]}^{}\sum_{\timetoarrival \in [\Lp]}^{} \lpredslack{\origin \destination, \timetoarrival, \tripactivetime}{(\time + \tripactivetime)} \leq \frac{1}{\Size} \arrrate{\origin \destination}{\time}, \quad \forall \origin, \destination \in \Region, \ \time \in [\Horizon],\label{eq:fluid-passenger-flow-cap}\\
    &\ \sum_{j \in [\chargetime]} \sum_{\battery \in [\range]}^{} \lpredcharge{\region, \type, \battery}{(\time - j)} \leq \frac{1}{\Size} \n{\region}{\type}, \quad \forall \type \in \Type, \  \region \in \Region, \  \time \in [\Horizon], \label{eq:fluid-charging-cap}\\
    &\ \lpredtripfulfill{\origin \destination, \battery, \timetoarrival}{\time} \mathds{1}\{\battery < \batterycost{\origin \destination}\} = 0,\notag\\ 
    &\quad \forall \battery \in [\range], \  \origin, \destination \in \Region, \  \time \in [\Horizon], \  \timetoarrival \in [\Lp], \label{eq:fluid-passenger-flow-battery-sufficiency}\\
    &\ \lpredreroute{\origin \destination, \battery}{\time} \mathds{1}\{\battery < \batterycost{\origin \destination}\} = 0,\notag\\ 
    &\quad \forall \battery \in [\range], \  \origin, \destination \in \Region, \  \time \in [\Horizon], \label{eq:fluid-rerouting-flow-battery-sufficiency} \\
    &\ \sum_{\battery \in [\range]} \left[ \sum_{\origin, \destination \in \Region} \left(\sum_{\timetoarrival' \in [\Lp]}^{} \sum_{t' \in \psi_{\origin \destination}(t, \eta')}\lpredtripfulfill{\origin \destination, b, \eta'}{t'}  \right. \right. + \nonumber\\ 
    &\qquad \left. \sum_{t' \in \psi_{\origin \destination}(t, 0)} \lpredreroute{\origin \destination, b}{t'}\right) \nonumber\\ 
    &\quad+ \left. \sum_{\region \in \Region} \sum_{\type \in \Type} \sum_{t' = t-\chargetime + \Lp}^t \lpredcharge{\region,\type,\battery}{t'} + \sum_{\region \in \Region} \sum_{\timetoarrival \in [\Lp]}^{} \lpredpass{\region, \battery, \timetoarrival}{\time} \right] = 1, \nonumber\\
    &\qquad \forall \time \in [\Horizon], \label{eq:fluid-total-flow}\\
    &\ \lpredtripfulfill{}{}, \lpredreroute{}{}, \lpredcharge{}{}, \lpredslack{}{}, \lpredpass{}{} \geq 0, \label{eq:fluid-nonneg}
\end{align}    
\end{subequations}
}

where $\phi_{\origin \destination}(t, \timetoarrival')$ is defined as the time at which the vehicle assigned to a trip from region $\origin$ to region $\destination$ will be $\Lp$ time steps away from $v$ at time $t$:
\begin{align}\label{eq:fluid-phi}
    &\phi_{uv}(t, \eta') + \eta' + \tau_{uv}^{\phi_{uv}(t, \eta') + \eta'} - \Lp = t, \nonumber\\
    &\quad \forall u, v \in \Region,\  \forall \eta' \in [\Lp], \  \forall t \in [T],
\end{align}
and $\psi_{\origin \destination}(t, \eta')$ is defined as the set of times at which the vehicle assigned to a trip from $\origin$ to $\destination$ will be {\em at least} $\Lp$ time steps away from $v$ at time $t$:
\begin{align} \label{eq:fluid-psi}
    \psi_{\origin \destination}(t, \eta') =& \left\{t' \in [T] \lvert t' \leq t, \right. \nonumber \\ 
    &\left. t'+ \eta' + \tau_{uv}^{t'+\eta'} - \Lp \geq t \right\}.
\end{align}

The objective function represents the average reward achieved by the vehicle flows for a single day. We argue that this objective function is equivalent to the objective function of the original formulation. For each pair of origin $\origin$ and destination $\destination$ at time $\time$, the term $\sum_{\tripactivetime \in [\Lc]} \sum_{\timetoarrival \in [\Lp]} \lpredslack{\origin \destination, \timetoarrival, \tripactivetime}{\time}$ aggregates all vehicles that are assigned to fulfill trip requests from $\origin$ to $\destination$ at time $\time$, which is equivalent to the term $\sum_{\cartype{} \in \Cartype} \sum_{\tripactivetime \in [\Lc]} \lptripfulfill{\cartype{}, (\origin, \destination, \tripactivetime)}{\time}$ in the objective function of the original formulation. The term $\sum_{\battery \in [\range]} \lpredreroute{\origin \destination, \battery}{\time}$ aggregates all vehicles assigned to reposition from $\origin$ to $\destination$ at time $\time$, which is equivalent to the term $\sum_{\cartype{} \in \Cartype} \lpreroute{\cartype{}, \destination}{\time}$ in the objective function of the original formulation. Finally, the term $\sum_{\battery \in [\range]} \lpredcharge{\region, \type, \battery}{\time}$ aggregates all vehicles assigned to charge at region $\region$ with rate $\type$ at time $\time$, which is equivalent to the term $\sum_{\cartype{} \in \Cartype} \lpcharge{\cartype{}, \type}{\time}$ in the objective function of the original formulation.
%The term $\sum_{\tripactivetime \in [\Lc]} \sum_{\timetoarrival \in [\Lp]} \lpredslack{\origin \destination, \timetoarrival, \tripactivetime}{\time}$ aggregates all trip orders from $\origin$ to $\destination$ that are picked up at time $\time$, each generating the same reward $\tripfulfillreward{,\origin\destination}{\time}$. The term $\sum_{\battery \in [\range]} \lpredreroute{\origin \destination, \battery}{\time}$ aggregates the flows of vehicles repositioning from $\origin$ to $\destination$ at time $\time$, with each unit incurring a cost of $\reroutingreward{,\origin\destination}{\time}$. The term $\sum_{\battery \in [\range]} \min\{\type \chargetime, \range - \battery\} \lpredcharge{\region, \type, \battery}{\time}$ aggregates the total increase in battery levels of all vehicles assigned to charge at time $\time$ across all regions. Specifically, the term $\min\{\type \chargetime, \range - \battery\}$ ensures that the battery levels of vehicles with battery $\battery \leq \range - \type \chargetime$ will increase by $\type \chargetime$ by the end of the charging period, while the battery levels of the remaining vehicles will be increased to full. The unit charging cost $\chargingreward{,\type}{\time}$ at time $\time$ is then multiplied by the total increase in battery levels to obtain the total charging cost.

Constraint \eqref{eq:fluid-ev-conservation} ensures the flow conservation for each vehicle status $(\origin, \timetoarrival, \battery)$ with $\timetoarrival \leq \Lp$ at any time $\time$ of day. We remark that the constraint \eqref{eq:fluid-ev-conservation-red} in the original formulation also includes the flow conservation for vehicles statuses with $\timetoarrival > \Lp$. We can reduce these constraints because passing is the only feasible actions for these vehicles. 
The left-hand side of the equation represents the vehicles being assigned at previous times that reach the status $(\origin, \timetoarrival, \battery)$ at time $\time$ of day, which is equivalent to the left-hand side of \eqref{eq:fluid-ev-conservation-red} in the original formulation and can be obtained by the vehicle state transition equation \eqref{eq:setup-car-state-transition}. In particular, the left-hand side includes the following terms: (i) the term $\lpredtripfulfill{\destination \origin, \battery + \batterycost{\destination \origin}, \timetoarrival'}{\phi_{\destination \origin}(t, \timetoarrival')}$ represents that vehicles of status $(\destination, \battery + \batterycost{\destination \origin}, \timetoarrival')$ at time $\phi_{\destination \origin}(\time, \timetoarrival')$ become vehicles of status $(\origin, \battery, \timetoarrival)$ after being assigned to pick up trip orders from $\destination$ to $\origin$; (ii) the term $\lpredreroute{\destination \origin, \battery + \batterycost{\destination \origin}}{\phi_{\destination \origin}(t, 0)}$ represents that vehicles of status $(\destination, \battery + \batterycost{\destination \origin}, 0)$ at time $\phi_{\destination \origin}(\time, 0)$ become vehicles of status $(\origin, \battery, \timetoarrival)$ after being assigned to reposition from $\destination$ to $\origin$ if $\destination \neq \origin$. On the other hand, when $\timetoarrival = 0$, the term $\lpredreroute{\origin \origin, \battery}{(\time - 1)} \mathds{1}\{\timetoarrival = 0\}$ represents that vehicles of status $(\origin, 0, \battery)$ at time $\time - 1$ remain the same status at time $\time$ after being assigned to idle; (iii) the term $\lpredcharge{\origin, \type, \battery - \type \chargetime}{(\time + \timetoarrival - \chargetime)}$ represents that vehicles of status $(\destination, \battery - \batterycost{\destination \origin}, 0)$ at time $\time + \timetoarrival - \chargetime$ become vehicles of status $(\origin, \battery, \timetoarrival)$ after being assigned to charge in region $\origin$ at rate $\type$. Moreover, the term $\sum_{\battery' > \range - \type \chargetime} \lpredcharge{\origin, \type, \battery'}{(\time + \timetoarrival - \chargetime)}$ represents that if $\battery = \range$, all vehicles of status $(\origin, \battery', 0)$ with battery levels $\battery' > \range - \type \chargetime$ will charge to full and become vehicles of status $(\origin, \range, \timetoarrival)$ after being assigned to charge in region $\origin$ at rate $\type$; (iv) the term $\lpredpass{\origin, \battery, \timetoarrival + 1}{(\time - 1)}$ represents that vehicles of status $(\region, \battery, \timetoarrival + 1)$ assigned a passing action at time $\time - 1$ become vehicles of status $(\region, \battery, \timetoarrival)$ at time $\time$. The right hand side of \eqref{eq:fluid-ev-conservation} represents the outgoing vehicle flows for each vehicle status, which can be obtained by \eqref{eq:setup-cartype-conservation} and is equivalent to the right-hand side of \eqref{eq:fluid-ev-conservation-red}. %The term $\lpredtripfulfill{\origin \destination, \battery, \timetoarrival}{\time}$ (respectively $\lpredreroute{\origin \destination, \battery}{\time}$, $\lpredcharge{\origin, \type, \battery}{\time}$, $\lpredpass{\origin, \battery, \timetoarrival}{\time}$) represents the flows of vehicles of status $(\origin, \battery, \timetoarrival)$ assigned to fulfill trip requests from $\origin$ to $\destination$ (respectively to reposition from $\origin$ to $\destination$, to charge in region $\origin$ at rate $\type$, or to pass).

Constraint \eqref{eq:fluid-passenger-flow-decomp} represents the equivalence of two aggregations of trip-fulfilling vehicle flows, which is reflected by the definition of $\lpredtripfulfill{}{}$ and $\lpredslack{}{}$ at the beginning of this section. %The left-hand side aggregates vehicle flows across different battery levels, while the right-hand side aggregates trip fulfillment across trip active times in the system. Both sides yield the flows of vehicles $\timetoarrival$ away from $\origin$ that are assigned to pick up trip requests from $\origin$ to $\destination$.
Constraint \eqref{eq:fluid-passenger-flow-cap} ensures that the fulfillment of trip orders does not exceed their arrivals, which is equivalent to the constraint \eqref{eq:fluid-passenger-flow-cap-red} in the original formulation. %Recall that trip orders from $\origin$ to $\destination$ arriving into the system at time $\time$ can either be fulfilled immediately at time $\time$, remain active in the system and be fulfilled at time $\time + 1, \dots, \time + \Lc$, or be abandoned. The left-hand side of the inequality aggregates the fulfillment of trip orders at all time steps from $\time$ to $\time + \Lc$, and is capped by the trip arrival rate $\arrrate{\origin \destination}{\time}$ on the right-hand side. Constraint \eqref{eq:fluid-charging-cap} ensures that the charging flow at a specific rate in a given region does not exceed the corresponding charging capacity at any time. Specifically, the term $\sum_{\battery \in [\range]} \lpredcharge{\region, \type, \battery}{\time - j}$ aggregates the flows of vehicles with all battery levels assigned to charge in region $\region$ at time $\time - j$. Additionally, we sum up all such flows from $\time - \chargetime + 1$ to $\time$ as vehicles assigned to charge during those times will still be occupying the charging facility at time $\time$.
Constraints \eqref{eq:fluid-passenger-flow-battery-sufficiency} and \eqref{eq:fluid-rerouting-flow-battery-sufficiency} ensure that vehicles will not travel to some regions if their battery levels are below the battery cost required to complete the trip, which are equivalent to the constraints \eqref{eq:fluid-passenger-flow-battery-sufficiency-red} and \eqref{eq:fluid-rerouting-flow-battery-sufficiency-red} in the original formulation. %In particular, vehicles whose battery levels $\battery$ are less than the battery cost $\batterycost{\origin \destination}$ can neither pickup trip requests nor reposition from $\origin$ to $\destination$.

Constraint \eqref{eq:fluid-total-flow} ensures that the total fraction of vehicles should add up to $1$ at all times and is equivalent to the constraint \eqref{eq:fluid-total-flow-red} in the original formulation. At each time, a vehicle can either be dispatched to pick up trip requests, reposition, charge, pass, continue with ongoing trips, or continue being charged. $\psi_{\origin \destination}(t, \timetoarrival')$ represents the time steps at which vehicles $\timetoarrival'$ away from $\origin$ and assigned to pick up trip requests from $\origin$ to $\destination$ will still be more than $\Lp$ time steps away from reaching $\destination$ at time $\time$. In other words, these vehicles are not feasible for non-passing actions at time $\time$. In particular, the constraint \eqref{eq:fluid-total-flow} includes the following terms: (i) the term $\sum_{\timetoarrival' \in [\Lp]}^{} \sum_{t' \in \psi_{\origin \destination}(t, \eta')}\lpredtripfulfill{\origin \destination, b, \eta'}{t'}$ represents all vehicles assigned to pickup trip requests from $\origin$ to $\destination$ that are still more than $\Lp$ time steps away from reaching $\destination$ at time $\time$; (ii) the term $\sum_{t' \in \psi_{\origin \destination}(t, 0)} \lpredreroute{\origin \destination, b}{t'}$ represents all vehicles assigned to reposition from $\origin$ to $\destination$ that are still more than $\Lp$ time steps away from reaching $\destination$ at time $\time$; (iii) the term $\sum_{t' = t-\chargetime + \Lp}^t \lpredcharge{\region,\type,\battery}{t'}$ represents all vehicles assigned to charge in region $\region$ with rate $\type$ that are still more than $\Lp$ time steps away from completing their charging periods; (iv) the term $\sum_{\region \in \Region} \sum_{\timetoarrival \in [\Lp]}^{} \lpredpass{\region, \battery, \timetoarrival}{\time}$ represents all vehicles assigned to pass at time $\time$. 

The constraint \eqref{eq:fluid-nonneg} requires that all decision variables should be non-negative, which is equivalent to the constraint \eqref{eq:fluid-nonneg-red} in the original formulation.