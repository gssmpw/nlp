We present the proof for the LP with reduced number of variables.

\begin{proof}{Proof of Theorem \ref{thm:fluid-obj-val}}
    By theorem 9.1.8 in page 451 of \cite{PutermanMDP}, it is without loss of optimality to restrict our attention to deterministic stationary policies. We will show that for any arbitrary deterministic stationary policy $\pi$, its long-run average daily reward $R(\pi \vert s)$ is upper bounded by the fluid-based LP optimal objective $\bar{R}(s)$ given any initial state $s$. Denote $(\jointtripfulfillaction{}{}(s^t), \jointreroutingaction{}{}(s^t), \jointchargingaction{}{}(s^t), \jointidlingaction{}{}(s^t), \jointpassaction{}{}(s^t))$ the vehicle flows generated by policy $\pi$ given state $s^t$ for each time step $t \in [\Horizon]$. Since the state space of the MDP is finite, we know that given any initial state $s \in \mathcal{S}$ and any deterministic stationary policy $\pi$, the system has a stationary distribution for states at all time steps, which we denote as $\rho$. Here, the dependence of $\rho$ on the policy $\pi$ and the initial state $s$ is dropped for notation simplicity. Hence, by proposition 8.1.1 in page 333 of \cite{PutermanMDP}, the long-run average daily reward defined in \eqref{eq:long-run-avg-reward} can be written as follows: 
    \begin{align*}
        &R(\pi|s) = \mathbb{E}_{\rho}  \left[\sum_{\time \in [\Horizon]}^{} \sum_{\cartype{} \in \Cartype} \sum_{(\origin, \destination) \in \Region \times \Region}\sum_{\tripactivetime \in [\Lc]}^{} \tripfulfillreward{,\origin\destination}{\time} \jointtripfulfillaction{\cartype{}, (\origin, \destination, \xi)}{}(s^{\time}) \right.\\ 
        &\quad+ \left. \sum_{\cartype{} \in \Cartype} \sum_{(\origin, \destination) \in \Region \times \Region} \reroutingreward{,\origin\destination}{\time} \jointreroutingaction{\cartype{}, \destination}{}(s^t) + \sum_{\triptype{} \in \Triptype}\sum_{\type \in \Type} \chargingreward{,\type}{\time} \jointchargingaction{\cartype{},\type}{}(s^t) \right].
    \end{align*}

    Given $(\jointtripfulfillaction{}{}(s^t), \jointreroutingaction{}{}(s^t), \jointchargingaction{}{}(s^t), \jointidlingaction{}{}(s^t), \jointpassaction{}{}(s^t))$ for each state $s^t$ in each time step $t \in [\Horizon]$, we define the fraction vector $(\lptripfulfill{}{}(s^t), \lpreroute{}{}(s^t), \lpcharge{}{}(s^t), \lpslack{}{}(s^t), \lppass{}{}(s^t))$:
    \begin{enumerate}
        \item[(i)] $\lptripfulfill{\origin\destination, \battery, \timetoarrival}{}(s^t) := \frac{1}{\Size} \sum_{\tripactivetime \in [\Lc]}^{} \mathbb{E}_{\rho}[ \jointtripfulfillaction{(\origin, \timetoarrival, \battery), (\origin, \destination, \tripactivetime)}{}(s^t)]$, $\forall \origin, \destination \in \Region$, $\battery \in [\range]$, $\timetoarrival \in [\Lp]$, $\time \in [\Horizon]$.
        \item[(ii)] $\lpreroute{\origin\destination, \battery}{}(s^t) := \frac{1}{\Size} \mathbb{E}_{\rho}[\jointreroutingaction{(\origin, 0, \battery), \destination}{}(s^t)]$, $\forall \origin, \destination \in \Region$ and $\origin \neq \destination$, $\battery \in [\range]$, $\time \in [\Horizon]$.
        \item[(iii)] $\lpreroute{\region\region, \battery}{}(s^t) := \frac{1}{\Size} \mathbb{E}_{\rho}[\jointidlingaction{(\region, 0, \battery)}{}(s^t)]$, $\forall \region \in \Region$, $\battery \in [\range]$.
        \item[(iv)] $\lpcharge{\region, \type, \battery}{}(s^t) := \frac{1}{\Size} \mathbb{E}_{\rho}[\jointchargingaction{(\region, 0, \battery), \type}{}(s^t)]$, $\forall \region \in \Region$, $\battery \in [\range]$, $\time \in [\Horizon]$.
        \item[(v)] $\lpslack{\origin\destination, \timetoarrival, \tripactivetime}{}(s^t) := \frac{1}{\Size} \sum_{\battery = 0}^{\range} \mathbb{E}_{\rho}[\jointtripfulfillaction{(\origin, \timetoarrival, \battery), (\origin, \destination, \tripactivetime)}{}(s^t)]$, $\forall \origin, \destination \in \Region$, $\timetoarrival \in [\Lp]$, $\tripactivetime \in [\Lc]$, $\time \in [\Horizon]$.
        \item[(vi)] $\lppass{\region, \battery, \timetoarrival}{}(s^t) := \frac{1}{\Size} \mathbb{E}_{\rho}[\jointpassaction{(\region, \timetoarrival, \battery)}{}(s^t)]$, $\forall \region \in \Region$, $\battery \in [\range]$, $\timetoarrival \in [\Lp]$,
    \end{enumerate}
    where the expectations are taken over the states $s^t$ for all time steps $t \in [\Horizon]$. Now we are going to show that $(\lptripfulfill{}{}(s^t), \lpreroute{}{}(s^t), \lpslack{}{}(s^t), \lpcharge{}{}(s^t), \lppass{}{}(s^t))$ satisfies the LP constraints \eqref{eq:fluid-lp} for all $t \in [\Horizon]$.

    To show that \eqref{eq:fluid-ev-conservation} holds, we have:
    \begin{align*}
        &\left[ \sum_{\destination \in \Region} \left( \sum_{\timetoarrival' \in [\Lp]}^{} \lptripfulfill{\destination \origin, \battery + \batterycost{\destination \origin}, \timetoarrival'}{}(s^{\phi_{\destination \origin}(t, \timetoarrival')}) \right.\right.\\ 
        &\quad+ \left.\left. \lpreroute{\destination \origin, \battery + \batterycost{\destination \origin}}{}(s^{\phi_{\destination \origin}(t, 0)}) \mathds{1}\{\destination \neq \origin\} \right) \cdot \mathds{1}\{\battery + \batterycost{\destination\origin} \leq \range\} \right.\\
        &\quad+ \left. \sum_{\type \in \Type} \lpcharge{\origin, \type, \battery - \type \chargetime}{}(s^{\time + \timetoarrival - \chargetime}) \mathds{1}\{\battery \geq \type \chargetime\} \right.\\ 
        &\quad+ \left. \sum_{\type \in \Type} \sum_{\battery' > \range - \type \chargetime} \lpcharge{\origin, \type, \battery'}{}(s^{\time + \timetoarrival - \chargetime}) \mathds{1}\{\battery = \range\} \right] \mathds{1}\{\timetoarrival = \Lp\} \\
        &\quad+ \left[\lpreroute{\origin \origin, \battery}{}(s^{\time - 1}) \mathds{1}\{\timetoarrival = 0\} + \lppass{\origin, \battery, \timetoarrival + 1}{}(s^{\time - 1}) \right] \mathds{1}\{\timetoarrival < \Lp\}\\
        \stackrel{(a)}{=}& \frac{1}{\Size} \left[ \sum_{\destination \in \Region} \left( \sum_{\timetoarrival' \in [\Lp]}^{} \sum_{\tripactivetime \in [\Lc]} \right.\right.\\
        &\quad \left. \left. \mathbb{E}_{\rho}\left[\jointtripfulfillaction{(\destination, \timetoarrival', \battery + \batterycost{\destination \origin}), (\destination, \origin, \tripactivetime)}{}(s^{\phi_{\destination \origin}(t, \timetoarrival')}) \right] \right.\right.\\ 
        &\quad+ \left.\left. \mathbb{E}_{\rho}\left[\jointreroutingaction{(\destination, 0, \battery + \batterycost{\destination \origin}), \origin}{}(s^{\phi_{\destination \origin}(t, 0)}) \right] \mathds{1}\{\destination \neq \origin\} \right) \right. \\
        &\qquad \cdot \mathds{1}\{\battery + \batterycost{\destination\origin} \leq \range\} \\
        &\quad+ \left. \sum_{\type \in \Type} \mathbb{E}_{\rho}\left[\jointchargingaction{(\origin, 0, \battery - \type \chargetime), \type}{}(s^{\time + \timetoarrival - \chargetime}) \right] \mathds{1}\{\battery \geq \type \chargetime\} \right.\\
        &\quad+ \left. \sum_{\type \in \Type} \sum_{\battery' > \range - \type \chargetime} \mathbb{E}_{\rho}\left[\jointchargingaction{(\origin, 0, \battery'), \type}{}(s^{\time + \timetoarrival - \chargetime})\right] \mathds{1}\{\battery = \range\} \right]\\ 
        &\qquad \cdot \mathds{1}\{\timetoarrival = \Lp\} \\
        &\quad+ \frac{1}{\Size} \left[\mathbb{E}_{\rho}\left[\jointidlingaction{(\origin, 0, \battery)}{}(s^{\time - 1}) \right] \mathds{1}\{\timetoarrival = 0\} \right.\\ 
        &\quad+ \left. \mathbb{E}_{\rho}\left[\jointpassaction{(\origin, \timetoarrival + 1, \battery)}{}(s^{\time - 1})\right] \right] \mathds{1}\{\timetoarrival < \Lp\}\\
        \stackrel{(b)}{=}&\frac{1}{\Size} \mathbb{E}_{\rho} \left\{ \left[ \sum_{\destination \in \Region} \left( \sum_{\timetoarrival' \in [\Lp]}^{} \sum_{\tripactivetime \in [\Lc]} \right.\right.\right.\\
        &\quad \left.\left.\left. \jointtripfulfillaction{(\destination, \timetoarrival', \battery + \batterycost{\destination \origin}), (\destination, \origin, \tripactivetime)}{}(s^{\phi_{\destination \origin}(t, \timetoarrival')}) \right.\right.\right.\\ 
        &\quad+ \left. \left.\left. \jointreroutingaction{(\destination, 0, \battery + \batterycost{\destination \origin}), \origin}{}(s^{\phi_{\destination \origin}(t, 0)}) \mathds{1}\{\destination \neq \origin\} \right) \right. \right. \\
        &\qquad \cdot \mathds{1}\{\battery + \batterycost{\destination\origin} \leq \range\}\\
        &\quad+ \left. \sum_{\type \in \Type} \jointchargingaction{(\origin, 0, \battery - \type \chargetime), \type}{}(s^{\time + \timetoarrival - \chargetime}) \mathds{1}\{\battery \geq \type \chargetime\} \right.\\ 
        &\quad+ \left. \sum_{\type \in \Type} \sum_{\battery' > \range - \type \chargetime} \jointchargingaction{(\origin, 0, \battery'), \type}{}(s^{\time + \timetoarrival - \chargetime}) \mathds{1}\{\battery = \range\} \right] \\
        &\qquad \cdot \mathds{1}\{\timetoarrival = \Lp\} \\
        &\quad+ \left. \left[\jointidlingaction{(\origin, 0, \battery)}{}(s^{\time - 1}) \mathds{1}\{\timetoarrival = 0\} + \jointpassaction{(\origin, \timetoarrival + 1, \battery)}{}(s^{\time - 1}) \right] \right.\\
        &\qquad \cdot \left. \mathds{1}\{\timetoarrival < \Lp\} \right\}\\
        \stackrel{(c)}{=}& \frac{1}{\Size} \mathbb{E}_{\rho}\left[s^t_{(\origin, \timetoarrival, \battery)} \right]\\
        \stackrel{(d)}{=}& \frac{1}{\Size} \mathbb{E}_{\rho}\left[\sum_{\triptype{} \in \Triptype} \jointtripfulfillaction{(\origin, \timetoarrival, \battery), \triptype{}}{}(s^t) + \sum_{\destination \in \Region} \jointreroutingaction{(\origin, \timetoarrival, \battery), \destination}{}(s^t) \right.\\ 
        &\quad+ \left. \sum_{\type \in \Type} \jointchargingaction{(\origin, \timetoarrival, \battery), \type}{}(s^t) + \jointidlingaction{(\origin, \timetoarrival, \battery)}{}(s^t) + \jointpassaction{(\origin, \timetoarrival, \battery)}{}(s^t) \right]
        \end{align*}%
        \begin{align*}
        \stackrel{(e)}{=}& \frac{1}{\Size} \left[\sum_{\triptype{} \in \Triptype} \mathbb{E}_{\rho}\left[\jointtripfulfillaction{(\origin, \timetoarrival, \battery), \triptype{}}{}(s^t)\right] + \mathbb{E}_{\rho}\left[\sum_{\destination \in \Region} \jointreroutingaction{(\origin, \timetoarrival, \battery), \destination}{}(s^t)\right] \right.\\ 
        &\quad+ \left. \sum_{\type \in \Type} \mathbb{E}_{\rho}\left[\jointchargingaction{(\origin, \timetoarrival, \battery), \type}{}(s^t) \right] + \mathbb{E}_{\rho}\left[\jointidlingaction{(\origin, \timetoarrival, \battery)}{}(s^t)\right] \right.\\ 
        &\quad+ \left. \mathbb{E}_{\rho}\left[\jointpassaction{(\origin, \timetoarrival, \battery)}{}(s^t)\right] \right]\\
        \stackrel{(f)}{=}& \sum_{\destination \in \Region} \left(\lptripfulfill{\origin \destination, \battery, \timetoarrival}{}(s^t) + \lpreroute{\origin \destination, \battery}{}(s^t) \right)\\ 
        &\quad+ \sum_{\type \in \Type} \lpcharge{\origin, \type, \battery}{}(s^t) + \lppass{\origin, \battery, \timetoarrival}{}(s^t) \mathds{1}\{\timetoarrival > 0\},
    \end{align*}
    where (a) is obtained by plugging in (i)-(vi) above; (b) is obtained by linearity of expectation; (d) is obtained by \eqref{eq:setup-cartype-conservation}; (e) is obtained by linearity of expectation; (f) is obtained by plugging in (i)-(vi) above. To show that (c) holds, we consider two separate cases:
    \begin{enumerate}
        \item[(i)] $\timetoarrival = \Lp$: To compute the number of vehicles with types where $\timetoarrival = \Lp$, we aggregate the vehicle flows from all actions that can reach $(\origin, \timetoarrival, \battery)$ at time $\time$. Recall from \eqref{eq:setup-car-state-transition} that the trip-fulfilling action $\jointtripfulfillaction{(\destination, \timetoarrival', \battery + \batterycost{\destination \origin}), (\destination, \origin, \tripactivetime)}{}(s^{\phi_{\destination \origin}(t, \timetoarrival')})$ (resp. the rerouting action $\jointreroutingaction{(\destination, 0, \battery + \batterycost{\destination \origin}), \origin}{}(s^{\phi_{\destination \origin}(t, 0)})$, the charging action $\jointchargingaction{(\origin, 0, \battery - \type \chargetime), \type}{}(s^{\time + \timetoarrival - \chargetime})$) change vehicles of type $(\destination, \timetoarrival', \battery + \batterycost{\destination \origin})$ at time $\phi_{\destination \origin}(t, \timetoarrival')$ (resp. vehicles of type $(\destination, 0, \battery + \batterycost{\destination \origin})$ at time $\phi_{\destination \origin}(t, 0)$, vehicles of type $(\origin, 0, \battery - \type \chargetime)$ at time $\time + \timetoarrival - \chargetime$) to vehicles of type $(\origin, \timetoarrival' + \timecost{\destination \origin}{\phi_{\destination \origin}(t, \timetoarrival')} - 1, \battery)$ at time $\phi_{\destination \origin}(t, \timetoarrival') + 1$ (resp. vehicles of type $(\origin, \timecost{\destination \origin}{\phi_{\destination \origin}(t, 0)} - 1, \battery)$ at time $\phi_{\destination \origin}(t, 0) + 1$, vehicles of type $(\origin, \chargetime - 1, \battery)$ at time $\time + \timetoarrival - \chargetime + 1$). Vehicles of all these types will become the type $(\origin, \Lp, \battery)$ at time $t$, as passing is the only feasible actions when their time to reach $\origin$ is larger than $\Lp$. Hence, (c) follows for vehicle types with $\timetoarrival = \Lp$.
        \item[(ii)] $\timetoarrival < \Lp$: Given the assumption that both the minimum trip duration and the charging period exceed $\Lp$, vehicles with types satisfying $\timetoarrival < \Lp$ can only be reached by those assigned idling or passing actions in previous time steps. Therefore, (c) follows directly from \eqref{eq:setup-car-state-transition} for vehicles of types with $\timetoarrival < \Lp$.
    \end{enumerate}
    
    \eqref{eq:fluid-passenger-flow-decomp} holds due to (i) and (v) above. Next, we show that \eqref{eq:fluid-passenger-flow-cap} holds. By \eqref{eq:setup-trip-state-transition}, we obtain that for any $\origin, \destination \in \Region$ and any $t \in [\Horizon]$, %\textcolor{red}{why does the flow of time $t-1$, $f^{t-1}$, depend on $s^t$ not on $s^{t-1}$?}
    \begin{align*}
        0 \stackrel{(a)}{\leq}& \state{(\origin, \destination, \Lc)}{\time} - \sum_{\cartype{} \in \Cartype} \jointtripfulfillaction{\cartype{}, (\origin, \destination, \Lc)}{}(s^t)\\
        \stackrel{(b)}{=}& \state{(\origin, \destination, \Lc - 1)}{\time - 1} - \sum_{\cartype{} \in \Cartype} \left(\jointtripfulfillaction{\cartype{}, (\origin, \destination, \Lc)}{}(s^t) + \jointtripfulfillaction{\cartype{}, (\origin, \destination, \Lc - 1)}{}(s^{t-1}) \right)\\
        =& \dots\\
        \stackrel{(c)}{=}& \state{(\origin, \destination, 0)}{\time - \Lc} - \sum_{\cartype{} \in \Cartype} \sum_{\tripactivetime \in [\Lc]} \jointtripfulfillaction{\cartype{}, (\origin, \destination, \Lc - \tripactivetime)}{}(s^{\time - \tripactivetime})\\
        \stackrel{(d)}{\leq}& \arrnum{\origin\destination}{\time - \Lc} - \sum_{\cartype{} \in \Cartype} \sum_{\tripactivetime \in [\Lc]} \jointtripfulfillaction{\cartype{}, (\origin, \destination, \Lc - \tripactivetime)}{}(s^{\time - \tripactivetime}),
    \end{align*}
    where (a) is due to the constraint \eqref{eq:setup-trip-fulfill-cap}; (b) and (c) are obtained by \eqref{eq:setup-trip-state-transition} under the condition that $1 \leq \tripactivetime \leq \Lc$; and (d) is because the trip state $\state{(\origin, \destination, 0)}{\time - \Lc}$ is upper bounded by $\arrnum{\origin\destination}{\time - \Lc}$ as given in \eqref{eq:setup-trip-state-transition} for $\tripactivetime = 0$.
    Thus, we obtain 
    \begin{align*}
        \arrnum{\origin\destination}{\time - \Lc} \geq& \sum_{\cartype{} \in \Cartype} \sum_{\tripactivetime \in [\Lc]} \jointtripfulfillaction{\cartype{}, (\origin, \destination, \Lc - \tripactivetime)}{}(s^{\time - \tripactivetime}) \\
        =& \sum_{\battery \in [\range]} \sum_{\timetoarrival \in [\Lp]} \sum_{\tripactivetime \in [\Lc]} \jointtripfulfillaction{(\origin, \timetoarrival, \battery), (\origin, \destination, \Lc - \tripactivetime)}{}(s^{\time - \tripactivetime}).
    \end{align*}
    This is equivalent to \[
        \frac{1}{\Size} \arrnum{\origin\destination}{\time}(s^t) \geq \sum_{\battery \in [\range]} \sum_{\timetoarrival \in [\Lp]} \sum_{\tripactivetime \in [\Lc]} \jointtripfulfillaction{(\origin, \timetoarrival, \battery), (\origin, \destination, \Lc)}{}(s^{\time + \tripactivetime}).
    \]
    Taking expectation on both sides, we obtain 
    \begin{align*}
        \arrrate{\origin \destination}{\time} =& \mathbb{E}_{\rho}\left[\frac{1}{\Size} \arrnum{\origin\destination}{\time}(s^t) \right]\\
        \geq& \mathbb{E}_{\rho}\left[\sum_{\battery \in [\range]} \sum_{\timetoarrival \in [\Lp]} \sum_{\tripactivetime \in [\Lc]} \jointtripfulfillaction{(\origin, \timetoarrival, \battery), (\origin, \destination, \Lc)}{}(s^{\time + \tripactivetime}) \right]\\
        =& \sum_{\battery \in [\range]} \sum_{\timetoarrival \in [\Lp]} \sum_{\tripactivetime \in [\Lc]} \mathbb{E}_{\rho}\left[\jointtripfulfillaction{(\origin, \timetoarrival, \battery), (\origin, \destination, \Lc)}{}(s^{\time + \tripactivetime})\right]\\
        =& \sum_{\timetoarrival \in [\Lp]} \sum_{\tripactivetime \in [\Lc]} \lpslack{\origin\destination, \timetoarrival, \tripactivetime}{}(s^{\time + \tripactivetime}).
    \end{align*}
    
    \eqref{eq:fluid-charging-cap} holds because:
    \begin{align*}
        &\sum_{\plugremaintime \in [\chargetime]} \sum_{\battery \in [\range]}^{} \lpcharge{\region, \type, \battery}{}(s^{t-\plugremaintime}) \\
        =& \frac{1}{\Size} \mathbb{E}_{\rho} \left[\sum_{\plugremaintime \in [\chargetime]} \sum_{\battery \in [\range]}^{} \jointchargingaction{\region, \type, \battery}{}(s^{t-\plugremaintime})\right] \\
        \stackrel{(a)}{=}& \sum_{\plugremaintime = 0}^{\chargetime - 1} s_{(\origin, \type, \chargetime - 1)}^{t - \plugremaintime}\\
        \stackrel{(b)}{=}& s_{(\origin, \type, 1)}^{t-1} + \sum_{\plugremaintime = 1}^{\chargetime - 1} s_{(\origin, \type, \plugremaintime)}^{t}\\
        \stackrel{(c)}{\leq}& s_{(\origin, \type, 0)}^{t} + \sum_{\plugremaintime = 1}^{\chargetime - 1} s_{(\origin, \type, \plugremaintime)}^{t}\\
        \stackrel{(d)}{=}& \lpchargingcapacity{\region}{\type},
    \end{align*}
    where (a) is obtained by the case of $\plugremaintime = \chargetime - 1$ in \eqref{eq:setup-plug-state-transition}; (b) is obtained by the case of $0 < \plugremaintime < \chargetime - 1$ in \eqref{eq:setup-plug-state-transition}; (c) is obtained by the case of $\plugremaintime = 0$ in \eqref{eq:setup-plug-state-transition} and the constraint in \eqref{eq:setup-charging-cap}; and (d) is obtained by \eqref{eq:setup-charger-total-num}.

    \eqref{eq:fluid-passenger-flow-battery-sufficiency} and \eqref{eq:fluid-rerouting-flow-battery-sufficiency} can be obtained by the constraints in \eqref{eq:setup-passenger-carrying-flow} and \eqref{eq:setup-rerouting-flow}. To show that \eqref{eq:fluid-total-flow} holds,  recall from the definition of $\psi_{\origin \destination}(t, \timetoarrival')$ in \eqref{eq:fluid-psi}, the term $\sum_{\origin \in \Region} \sum_{t' \in \psi_{\origin \destination}(t, \eta')}\lptripfulfill{\origin \destination, \battery, \timetoarrival'}{\time'}$ (resp. $\sum_{\origin \in \Region} \sum_{t' \in \psi_{\origin \destination}(t, 0)} \lpreroute{\origin \destination, \battery}{\time'}$, $\sum_{\type \in \Type} \sum_{t' = t-\chargetime + \Lp}^t \lpcharge{\region,\type,\battery}{t'}$) represents the flows of all trip-fulfilling (resp. rerouting, charging) vehicles that reach the node associated with the vehicle type $(\destination, \timetoarrival, \battery)$, where $\timetoarrival \geq \Lp$, at time $\time$. Additionally, the term $\sum_{\timetoarrival \in [\Lp]}^{} \lppass{\region, \battery, \timetoarrival}{\time}$ represents the flows of all vehicles assigned to pass that reach the node associated with the vehicle type $(\destination, \timetoarrival, \battery)$, where $\timetoarrival < \Lp$, at time $\time$. Thus, \eqref{eq:fluid-total-flow} aggregates the vehicle flows of all actions that can reach each vehicle types at time $\time$. Consequently, by \eqref{eq:setup-car-total-flow}, \eqref{eq:fluid-total-flow} follows. Lastly, \eqref{eq:fluid-nonneg} holds due to the non-negativity of $(\jointtripfulfillaction{}{}(s^t), \jointreroutingaction{}{}(s^t), \jointchargingaction{}{}(s^t), \jointidlingaction{}{}(s^t), \jointpassaction{}{}(s^t))$ as defined in section \ref{sec:model}.
                
    Hence, $(\lptripfulfill{}{}(s^t), \lpreroute{}{}(s^t), \lpslack{}{}(s^t), \lpcharge{}{}(s^t), \lppass{}{}(s^t))$ satisfies all constraints in \eqref{eq:fluid-lp}.
    Therefore, {\small\begin{subequations}
        \begin{align*}
            &R(\pi|s) \\
            =& \mathbb{E}_{\rho}  \left[\sum_{\time \in [\Horizon]}^{} \sum_{\cartype{} \in \Cartype} \sum_{(\origin, \destination) \in \Region \times \Region}\sum_{\tripactivetime \in [\Lc]}^{} \tripfulfillreward{,\origin\destination}{\time} \jointtripfulfillaction{\cartype{}, (\origin, \destination, \xi)}{}(s^{\time}) \right.\\ 
            &\quad+ \left. 
            \sum_{\cartype{} \in \Cartype} \sum_{(\origin, \destination) \in \Region \times \Region} \reroutingreward{,\origin\destination}{\time} \jointreroutingaction{\cartype{}, \destination}{}(s^t) + \sum_{\triptype{} \in \Triptype}\sum_{\type \in \Type} \chargingreward{,\type}{\time} \jointchargingaction{\cartype{},\type}{}(s^t) \right] \notag\\
            \stackrel{(a)}{=}& \sum_{\time \in [\Horizon]}^{} \sum_{\cartype{} \in \Cartype} \sum_{(\origin, \destination) \in \Region \times \Region}\sum_{\tripactivetime \in [\Lc]}^{} \tripfulfillreward{,\origin\destination}{\time} \mathbb{E}_{\rho} \left[\jointtripfulfillaction{\cartype{}, (\origin, \destination, \xi)}{}(s^{\time})\right] \\
            &\quad+ 
            \sum_{\cartype{} \in \Cartype} \sum_{(\origin, \destination) \in \Region \times \Region} \reroutingreward{,\origin\destination}{\time} \mathbb{E}_{\rho} \left[\jointreroutingaction{\cartype{}, \destination}{}(s^t)\right]\\ 
            &\quad+ \sum_{\triptype{} \in \Triptype}\sum_{\type \in \Type} \chargingreward{,\type}{\time} \mathbb{E}_{\rho} \left[\jointchargingaction{\cartype{},\type}{}(s^t)\right]  \notag\\
            \stackrel{(b)}{=}& \sum_{\time \in [\Horizon]}^{} \sum_{(u, v) \in V \times V} \sum_{\timetoarrival \in [\Lp]}^{} \sum_{\tripactivetime \in [\Lc]}^{} \tripfulfillreward{,\origin\destination}{\time} \Size \lpslack{\region \regiontwo, \timetoarrival, \tripactivetime}{}(s^{\time})\\
            &\quad+ \sum_{\cartype{} \in \Cartype} \sum_{(\origin, \destination) \in \Region \times \Region} \reroutingreward{,\origin\destination}{\time} \Size \lpreroute{\cartype{}, \destination}{}(s^t) \\
            &\quad+ \sum_{\triptype{} \in \Triptype}\sum_{\type \in \Type} \chargingreward{,\type}{\time} \Size \lpcharge{\cartype{},\type}{}(s^t) \\
            \stackrel{(c)}{\leq} & \bar{R}(s),
        \end{align*}
    \end{subequations}}
    (a) is obtained by the linearity of expectation. (b) is by plugging in (ii)-(vi) above. (c) is because $(\lptripfulfill{}{}(s^t), \lpreroute{}{}(s^t), \lpslack{}{}(s^t), \lpcharge{}{}(s^t), \lppass{}{}(s^t))$ is a feasible solution to \eqref{eq:fluid-lp}, so it is upper bounded by $\bar{R}$.
    % \begin{subequations}
    %     \begin{align}
    %         &R(\pi|s) = \mathbb{E}_{\rho(\pi|s)}  \left[\sum_{\time \in [\Horizon]}^{} \sum_{\cartype{} \in \Cartype} \sum_{(\origin, \destination) \in \Region \times \Region}\sum_{\tripactivetime \in [\Lc]}^{} \tripfulfillreward{,\origin\destination}{\time} \jointtripfulfillaction{\cartype{}, (\origin, \destination, \xi)}{\time + \tripactivetime} + 
    %         \sum_{\cartype{} \in \Cartype} \sum_{(\origin, \destination) \in \Region \times \Region} \reroutingreward{,\origin\destination}{\time} \jointreroutingaction{\cartype{}, \destination}{\time} + \sum_{\triptype{} \in \Triptype}\sum_{\type \in \Type} \chargingreward{,\type}{\time} \jointchargingaction{\cartype{},\type}{\time}\right] \notag\\
    %         \stackrel{(a)}{=}& \mathbb{E}_{\rho(\pi|s)} \left[\sum_{\time \in [\Horizon]}^{} \sum_{(u, v) \in V \times V} \sum_{\timetoarrival \in [\Lp]}^{} \sum_{\tripactivetime \in [\Lc]}^{} \tripfulfillreward{,\origin\destination}{\time} \Size \lpslack{\region \regiontwo, \timetoarrival, \tripactivetime}{\time + \tripactivetime} + \sum_{\cartype{} \in \Cartype} \sum_{(\origin, \destination) \in \Region \times \Region} \reroutingreward{,\origin\destination}{\time} \Size \lpreroute{\cartype{}, \destination}{\time} + \sum_{\triptype{} \in \Triptype}\sum_{\type \in \Type} \chargingreward{,\type}{\time} \Size \lpcharge{\cartype{},\type}{\time}\right]\\
    %         \stackrel{(b)}{=}& \Size \mathbb{E}_{\rho(\pi|s)} \left[\sum_{\time \in [\Horizon]}^{}  \sum_{(\origin, \destination) \in \Region \times \Region} \tripfulfillreward{,\origin\destination}{\time} \min\left(\sum_{\tripactivetime \in [\Lc]}^{}\sum_{\timetoarrival \in [\Lp]}^{} \Size \lpslack{\origin \destination, \timetoarrival, \tripactivetime}{\time + \tripactivetime}, X_{\origin \destination}^{\time} \right) + \sum_{\battery \in [\range]}^{} \sum_{\timetoarrival \in [\Lp]}^{} \reroutingreward{,\origin\destination}{\time} \Size \lpreroute{\origin \destination, \battery, \timetoarrival}{\time} \right. \notag\\ 
    %         &\qquad+ \left. \sum_{\battery \in [\range]}^{} \sum_{\region \in \Region} \sum_{\type \in \Type} \chargingreward{,\type}{\time} \Size \lpcharge{\region, \type, \battery}{\time} \right] \label{eq:revenue-to-maxmin}\\
    %         \stackrel{(c)}{\leq}& \left[\sum_{\time \in [\Horizon]}^{}  \sum_{(\origin, \destination) \in \Region \times \Region} \tripfulfillreward{,\origin\destination}{\time} \min\left(\sum_{\tripactivetime \in [\Lc]}^{}\sum_{\timetoarrival \in [\Lp]}^{} \Size \mathbb{E}_{\rho(\pi|s)} \left[\lpslack{\origin \destination, \timetoarrival, \tripactivetime}{\time + \tripactivetime}\right], \Size \arrrate{\origin\destination}{\time} \right) \right.\notag\\
    %         &\left.+ \sum_{\battery \in [\range]}^{} \sum_{\timetoarrival \in [\Lp]}^{} \reroutingreward{,\origin\destination}{\time} \Size \mathbb{E}_{\rho(\pi|s)} \left[\lpreroute{\origin \destination, \battery, \timetoarrival}{\time}\right] + \sum_{\battery \in [\range]}^{} \sum_{\region \in \Region} \sum_{\type \in \Type} \chargingreward{,\type}{\time} \Size \mathbb{E}_{\rho(\pi|s)} \left[\lpcharge{\region, \type, \battery}{\time}\right] \right]\\
    %         \stackrel{(d)}{=}& \left[\sum_{\time \in [\Horizon]}^{}  \sum_{(\origin, \destination) \in \Region \times \Region} \tripfulfillreward{,\origin\destination}{\time} \sum_{\tripactivetime \in [\Lc]}^{}\sum_{\timetoarrival \in [\Lp]}^{} \Size \mathbb{E}_{\rho(\pi|s)} \left[\lpslack{\origin \destination, \timetoarrival, \tripactivetime}{\time + \tripactivetime}\right] \right.\notag\\
    %         &\left.+ \sum_{\battery \in [\range]}^{} \sum_{\timetoarrival \in [\Lp]}^{} \reroutingreward{,\origin\destination}{\time} \Size \mathbb{E}_{\rho(\pi|s)} \left[\lpreroute{\origin \destination, \battery, \timetoarrival}{\time}\right] + \sum_{\battery \in [\range]}^{} \sum_{\region \in \Region} \sum_{\type \in \Type} \chargingreward{,\type}{\time} \Size \mathbb{E}_{\rho(\pi|s)} \left[\lpcharge{\region, \type, \battery}{\time}\right] \right]\\
    %         \stackrel{(e)}{\leq} & \bar{R},
    %     \end{align}
    % \end{subequations}
    % (a) is by plugging in (ii)-(vi) above. (b) is because by \eqref{eq:fluid-passenger-flow-cap-random}, we can obtain that for each $\origin, \destination, \time$, we have \[
    %     \tripfulfillreward{,\origin\destination}{\time} \sum_{\tripactivetime \in [\Lc]}^{}\sum_{\timetoarrival \in [\Lp]}^{} \lpslack{\origin \destination, \timetoarrival, \tripactivetime}{\time + \tripactivetime} = \tripfulfillreward{,\origin\destination}{\time} \min\left(\sum_{\tripactivetime \in [\Lc]}^{}\sum_{\timetoarrival \in [\Lp]}^{} \lpslack{\origin \destination, \timetoarrival, \tripactivetime}{\time + \tripactivetime}, X_{\origin \destination}^{\time} \right)
    % \]
    % (c) is obtained by applying Jensen's inequality. (d) is obtained by \eqref{eq:fluid-passenger-flow-cap} in proposition \ref{proposition:expectation-fluid-constraints}. (e) is because by proposition \ref{proposition:expectation-fluid-constraints}, $(\mathbb{E}[\lptripfulfill{}{}], \mathbb{E}[\lpreroute{}{}], \mathbb{E}[\lpslack{}{}], \mathbb{E}[\lpcharge{}{}], \mathbb{E}[\lppass{}{}])$ is a feasible solution to \eqref{eq:fluid-lp}, so it is upper bounded by $\bar{R}$.
    \hfill $\square$
\end{proof}
