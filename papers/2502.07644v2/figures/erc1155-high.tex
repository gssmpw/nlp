 contract MyERC1155Token {
   mapping(uint256 => mapping(address => uint256)) _balances;
   mapping(address => mapping(address => bool)) _approvals;

   function safeTransferFrom(address from, address to, uint256 id, uint256 value, ...) public {
+    require(to != 0, "invalid receiver")
+    require(_approvals[from][msg.sender], "the caller is not approved to manage the tokens");
     _update(from, to, id, value);
+    if (to.isContract()) {
+      try IERC1155Receiver(to).onERC1155Received(...) returns (bytes4 response) {...}
+    }
   }
   function _update(address from, address to, uint256 id, uint256 value) internal {
     if (from != address(0)) {
       _balances[id][from] -= value;
     }
     if (to != address(0)) {
       _balances[id][to] += value;
     }
   }
 }