\section{Introduction}
\label{sec:introduction}

% {\myred
% Comment 1:\\
% This paper, proposes a hybrid control scheme for an
% unmanned ground robot, ensuring global path in-variance
% for path-following tasks. The control framework consists of
%  a locally path-invariant controller for maintaining path
% following as well  by a pure pursuit controller for
% navigation from starting points to the neighborhood of the
% desired path. Simulation and experimental trials are used
% to demonstrate the efficacy of the proposed scheme.

% Please find some comments below:

% - In general, the paper is clearly written and organized.

% - The authors need to elaborate more on the motivation of
% this work: Why global path in-variance is so important	in
% real applications? Please provide examples and consider,
% the vast literature that exists on motion planning. (solved)

% One more sentence about why path invariance is important in real application: Robotics arm magnetic levitating and drones. The performance in those application is good compared to other control method but not global. Although it is a simple system, the general theory can be easily modified and extended to other robotics systems. 
% Add more references from robotics conferences on motion planning. NW
  
% - It is not quite clear why the phrase: “To overcome this
% limitation, we propose a hybrid globally path-invariant
% controller by designing a hybrid feedback law that is
% robust to sensor noise [12]”, closes with a reference to
% one of the authors books. Is the same method described
% there? 

% Put the reference somewhere else.

% - The mathematical analysis is detailed. However, since at
% some point the mathematics are too dense, I would suggest
% to move the detailed elaboration to an appendix to improve
% readability. Also, it seems quite odd that for the proof of
% Theorem 8, which as it is stated by the authors, is the
% main result of their work, the reader is directed to [12,
% Theorem 4.6].

% Include a proof here (AA)

% -  The simulation and experimental results are quite
% limited and simplistic. Despite the fact that the proposed
% scheme should be robust against sensor noises, this is not
% depicted in the simulation runs. For the experiment, the
% authors uses an indoor motion capture system. However,
% these systems provide almost ideal measurements in lab-like
% environments, but they cannot operate properly outdoors. It
% would be better to have a more realistic scenario with
% GPS-IMU aided navigation, as in real applications.

% 1. Put supporting arguments this is one of the future work and for now only tested
% 2. ROS and Gazebol and have a simulation

% Mention in experiment section: estimation problem level has been resolved. Assuming the the sensor has been fused. In the outdoor, 

% - The authors provide a reference [21], which is a
% technical report quite similar to the proposed work that
% provides more details (and results) for the same work
% described in this paper. I do not think that this fair. The
% submitted work should be concise and well structured to fit
% the space requirements of the conference, since a very
% similar version will be published at the proceedings in
% case the paper is accepted.

% igore this first.

% Comment 2:

% The paper presents a path following scheme to have a
% car-like robot follow a designated path. The novelty of the
% paper seems to be the fact that the controller is globally
% attractive, meaning that it converges to the path at
% arbitrary positions in the workspace.

% Emphasze the significance of work in applications.

% To begin with, the paper is well written and technically
% sound. However I find the novelty, and the actual problem
% being tackled, questionable. Control of ground robots is
% a very well studied problem and the theoretical aspects of
% following/tracking tasks have been essentially solved since
% the '90s with the fundamental theoretical work of Samson,
% among many others. As such, the kind of problem discussed
% in the paper is of low interest in my opinion. 

% Compare the path invariance literature with trajectory tracking literature to show the advantages.

% What is claimed, i.e. to break the problem into a local
% controller stable around a neighborhood of the path, and a
% second one which drives the robot inside this region, when
% outside, is rather straightforward and simplistic. Even
% more so when there are a multitude of local path following
% and tracking controllers, as well as the fact that the
% authors deploy a sampled-based method (an RRT) to plan the
% motion from outside to inside, and have a pure pursuit
% controller track that path. 



% In general, even though the theoretical contribution has
% some merit, this work does not handle issues like
% obstacles, sensors, actuator models or even the path
% itself. A basic assumption in the paper is that the
% reference path is feasible. Is this the case in real life?
% Sampled based planners do not, for the most part, adhere to
% this constraint. How about uneven terrain, wheel slippage,
% dynamic obstacles etc. What I mean with all these is that
% the discussion in the car-like robot literature has moved to more
% complex, and close-to-real-life scenarios. Thus, this paper
% does not match the profile of the ICRA conference. If I
% were the authors, I would target a more control-theoretic
% conference and/or journal. 

% The trajectory has global convergence, but the safety is guaranteed. If there are static obstacles, the robots under the the trajectory tracking control may leave the path and collide with the obstacles.

% NW: Although it is straightforward to combine two controllers, however, it is not trivial and need to be done within the uniting control framework, which has not been used for this particular applications, with theoretical guaranteees. 
% }

% {\myred Comments by Professor: 
% \begin{enumerate}
%     \item In Proposition~\ref{prop:relative_degree}, I’m not sure I follow what “vector relative degree of {3,3}” really means.

%     Adeel: Add the definition of vector relative degree for now and then later only pur a reference. (done)

% \item In Lemma~\ref{lemma:invariance}, the notion ``stable in finite time and invariant” is unclear.

% Nan: Add a section related to math preliminaries, and put the definition of set invariance, and finite time stability of a set. (done)

% \item I’m confused at why we change the model in Section~\ref{sec:trajectory_generation}, from~\eqref{eq:car_robot} to~\eqref{eq:simplified_model}.  Why can’t we compute, at least offline, trajectories for~\eqref{eq:car_robot}?

% Nan: Try using the four-state model, given in eq(3), and re-run the simulations. (Partially done, the motion planner works for (\ref{eq:car_robot}) works. Need to incorporate it with Eric's code. Has remove the simplified robot model) 

% \item To be possible to generate a trajectory for~\eqref{eq:simplified_model} that avoids obstacles, we need to put conditions on the location and size of the obstacles.  I don’t see such a condition.

% Nan: We need to provide some explanation about why it is not possible to state conditions explicitly. (done)

% \item Lemma~\ref{lem:kappa1} talks about "pure pursuit algorithm $\kappa_1$” but that algorithm is not defined mathematically before the lemma.  I’m not following what Lemma~\ref{lem:kappa1} is trying to establish.

% Plan: Let's look at this comment in detail and touch base next week. 

% \end{enumerate}

% }

% {\myred AA: I'm adding pointers that would help us write the introductions section.

% Task for Nan:
% 1. (Done) Clean up the notation of hybrid controller and closed loop system.
% 2. (Done) Draw figure, something like the one I shared with you. You can ask Eric for help. Also we need a picture of robot running in the lab. 
% 3. (Done) Maybe remove the old hybrid system discussion. 
% 4. (Done) Update the Algorithm 1 and include the hysteresis discussion. 
% 5. Try adding some references and discussion related to the task in the introduction. 


% We may need to slightly modify the title. Add the Hybrid in the title!!

% \begin{enumerate}
%     \item Why motion control problem in important. Motivation on why robotics community should care about it. (Nan)
%     \item Difference between path following and trajectory tracking. (Adeel)
%     \item Why global invariance in important. (Adeel)
%     \item Literature review of the existing path following or tracking control methods (ideally relatively new ICRA, IROS, or T-RO citations). Limitations of the existing methods, such as not-global, does not guarantee invariance, no-closed form solutions, etc. (Adeel/Nan)
%     \item Literature review of path planning methods, and pure pursuit. (Nan, Eric)
%     \item A few references on hybrid controls. Have people applied hybrid control to achieve global tracking results for car-like robot? Limitations of their work. (Nan) 
%     \item Our contributions. (Adeel)
% \end{enumerate}

% Car-like robots are nonholonomic systems capable of navigating through varying environments without human intervention~\cite{ICRA-2013}. 
%These robots integrate advanced algorithms, sensors, and hardware to perform various tasks.
%Over the past two decades, the field of autonomous robots has experienced significant advancements. 
% In most Car-like Robotics Systems, three fundamental modules are commonly present\cite{yurtsever2020survey}: the perception module, the planning module, and the motion control module. 
% The perception module is responsible for acquiring real-time environmental information through an array of sensors. The planning module, leveraging this information, generates a safe and feasible path or trajectory for the robot to follow. Subsequently, the motion control module employs tracking algorithms to guide the robot along the precomputed path or trajectory. 
% Each of these modules serves an indispensable role in the overarching architecture of Car-like Robotics Systems, collectively ensuring effective navigation. 
% \ak{This paper focuses on the motion control module.}
Desired motion of a nonholonomic system such as a car-like robot can be achieved by tracking a trajectory or following a path~\cite{NieFulMag10}. 
It is crucial to emphasize the fundamental distinction between a path and a trajectory~\cite{AkhNieWas2015}. A path represents a collection of points in the output space, independent of time, whereas a trajectory is a time-parameterized curve in the output space~\cite{AkhNie2011}. Importantly, a single path encompasses all associated trajectories. 
% We want to highlight that path and trajectory are fundamentally different~\cite{AkhNieWas2015}. A path is a set of points in the output space without a notion of time, while a trajectory is a curve in the output space parameterized by time~\cite{AkhNie2011}. Moreover, a path encapsulates the set of all corresponding trajectories. 
As highlighted in~\cite{Aguiar}, in trajectory tracking, \pn{there is a fundamental performance limitation that the smallest achievable tracking error is equal to the least amount of control energy needed to stabilize the error system}. \pn{While trajectory tracking methods may exhibit global convergence, this limitation prevents trajectory tracking methods from establishing the path invariance property, which guarantees that once the robot reaches the path, it remains on that path precisely and indefinitely \cite{LiNie2017}.} \pn{In environments with the presence of static obstacles, robots controlled by trajectory tracking controllers may deviate from their path, leading to collisions with obstacles. Consequently, such controllers are deemed \emph{unsafe} in this paper.} This can be overcome by switching the control objective to force the output to follow a path instead.
\ifbool{conf}{}{In this paper, we aim to formulate and solve a path-following problem for car-like robots.}

One of the advantages of considering a path-following problem is that this problem can be cast into a set stabilization problem, where the given path is treated as a set, and subsequently, the path can be made invariant~\cite{ConMagNie2010,AkhNieWas2015,NieMag2008}. 
% In simple words, if the path is made invariant, once the robot converges to the path, it stays on the path forever~\cite{LiNie2017,ConMagNie2010}. 
% A path-invariant controller performs better in terms of the deviation from the path when compared to a corresponding trajectory tracking controller~\cite{AkhNieWas2015}. 
However, one significant limitation of the existing path following controllers is that these controllers are local in the sense that the basin of attraction is not the entire \mynn{state} space~\cite{AkhNieWas2015}. 
% ~\cite{AkhNie2011,AkhNieWas2015,HlaNieWan11,NieMag04}. 
\begin{figure}[t]
    \centering
    \incfig[0.9]{hybridControlResults_a}
    \caption{\myifconf{Our proposed solution, shown in bold green and blue, guarantees global path invariance and robustness to sensor noise. In contrast, other solutions, shown in red and blue, fail to achieve both. LP-I stands for locally path invariant.}{Our proposed solution shown in bold green and blue guarantees globally path invariance and robustness to sensor noise. Other solutions fail to achieve both, shown in red and blue. LP-I is the abbreviation for locally path invariant.}}
    \vspace{-1.0cm}
    \label{fig:i}
\end{figure}
\myifconf{}{In other words, the existing path-following methods fail to guarantee global path invariance.} This limitation hampers the application of path-invariant control due to its lack of assured convergence, contingent upon the initial state of the car-like robots. Moreover, the path invariant controllers presented in~\cite{AkhNieWas2015,AkhNie2011} are not well defined for singularity points {\akh  where the decoupling matrix is not invertible} in the output space. Finally, since the system \myifconf{}{under study} has no potential energy, it violates Brockett's condition~\cite{BrockettsCondition-1983}, and any smooth time-invariant feedback cannot stabilize an equilibrium point{\akh~\cite{ReySchMcCKol1999,LewisMurray1999,ChenKla2017}}. 

To overcome these limitations, 
% \begin{figure*}[htbp]
%     \centering
%     % \includegraphics[width = \columnwidth]{Figures/NH.eps}
%     \incfig[2]{generaldiagram}
%     \caption{\ak{We need to either remove or significantly polish this figure.} The general framework of the proposed hybrid path-invariant path-tracking controller for self-driving robots.}
%     \label{fig:generalframework}
% \end{figure*}
we propose a hybrid \emph{globally path-invariant} control framework \pn{following the uniting control framework in \cite{San2021}}.
% Moreover, the resulting hybrid controller provides global converges and is robust to sensor noise~\cite{San2021}. 
Our hybrid control framework \nw{switches between} two controllers. The first controller is a local path-following controller that establishes path invariance if the robot is initialized in the neighborhood of the path. \nw{To establish the path invariance of this controller, we first extend the dynamic system by treating the control input as a state so as to add this state and its derivative into the state space. Then, by defining the neighborhood of the path in the extended state space and employing a traverse feedback linearization approach, we develop a locally path-invariant controller, albeit encountering singular points. To avoid reaching those singularity points, \ifbool{conf}{}{which may result in control failure,} we introduce a singularity filter for the local path-invariant controller, integrating a Control Barrier Function (CBF) \cite{ames2016control}.  The second controller can be any proper combination of motion planner and global trajectory tracking controller in the literature such as the sampling-based planning algorithms \cite{ma2015efficient} and pure pursuit tracking controller \cite{nascimento2018nonholonomic}, which is not necessarily path invariant, bringing the robot into the path's neighborhood in finite time.}
% Firstly, a trajectory, which is referred to as \emph{motion plan}  and connects the current position of the robot with the given path, is generated by the onboard planning module. 
% In addition to the classic graph search algorithm\cite{likhachev2005anytime} and those inspired by the artificial potential field \cite{huang2019motion}, 
% In recent years, the sampling-based algorithms \cite{ma2015efficient} have drawn much attention for their rapid exploration in solving high-dimensional planning problems. In this paper, the HyRRT algorithm in \cite{wang2022rapidly} is employed to generate an motion plan for the car-like robot. 
% Secondly, a global trajectory tracking controller is employed to track the motion plan, bringing the robot into the path's neighborhood in finite time. 
\ifbool{conf}{}{Once the robot enters the neighborhood of the given path, using a hybrid switching scheme, the control law {robustly} switches from the global trajectory tracking controller to the local path-invariant controller. While switching between two controllers may seem straightforward, the process \mynn{requires global convergence and robust switching}. }Following the uniting control framework in \cite{San2021}, the proposed hybrid control framework prevents the chattering between the two controllers to ensure global convergence.

To the authors' best knowledge, the proposed hybrid framework is the first control design for car-like robots that establishes global path invariance. In summary, we make the following contributions:
\ifbool{conf}{i) A path-following controller that guarantees local path invariance {and a barrier certificate to avoid singularities}~ (Lemma~\ref{lemma:invariance});
    % \item A pure pursuit controller that guarantees finite-time convergence to the neighborhood of the given path (Remark~\ref{r});
    ii) A hybrid framework that guarantees robust switching between the two controllers such that the resulting closed-loop system makes the given path \textit{globally invariant} (Theorem~\ref{theo:geometric-hybrid-cricle}); 
    % iii) Experiments demonstrate the performance of the proposed hybrid controller on a small-scale car \pn{when operating amidst real-world noise conditions}.
    iii) Despite the simplification of the robot dynamical system addressed in this work, the underlying theory is readily adaptable and extendable to other robotic systems.}{\begin{enumerate}
    \item A path-following controller that guarantees local path invariance {and a barrier certificate to avoid singularities}~ (Lemma~\ref{lemma:invariance});
    % \item A pure pursuit controller that guarantees finite-time convergence to the neighborhood of the given path (Remark~\ref{r});
    \item A hybrid framework that guarantees robust switching between the two controllers such that the resulting closed-loop system makes the given path \textit{globally invariant} (Theorem~\ref{theo:geometric-hybrid-cricle}); 
    \item Experiments demonstrate the performance of the proposed hybrid controller on a small-scale car \pn{when operating amidst real-world noise conditions}.
    \item \pn{Despite the simplification of the robot dynamical system addressed in this work, the underlying theory is readily adaptable and extendable to other robotic systems.}
    % , in a lab environment, 
\end{enumerate}}
% \ifbool{conf}{}{
% The remainder of the paper is organized as follows. 
Section~\ref{section:preliminaries} presents notation and preliminaries. Section~\ref{section:problem} presents the problem statement. Section~\ref{section:localcontrol} presents the local path-invariant controller for car-like robots. Section~\ref{sec:control} presents the hybrid control design. Sections~\ref{section:simulation} \myifconf{includes}{ and \ref{section:experiment}include}  the simulation \myifconf{results. More details are included in the report version \cite{wang2025hybrid}.}{ and experiment results.}
% }




% We will write introduction after sorting out the main sections.
% We need to structure the paper in somewhat the following manner:
% \begin{itemize}
%     \item Pretty much at the start of the paper we need to state informally and perhaps with the help of a picture our problem statement. 
%     \item Later we need to formally state our problem statement. 
%     \item Class of curves for which we're going to propose a global solution and the assumptions these curves satisfy.
%     \item We need to design two controller $\kappa_0$. and $\kappa_1$. 
%     \item We call the first controller $\kappa_0$ which will be a local path invariant controller that, pretty much, comes from my previous paper. So we need to state the main results (in the form of Lemma) from there. Also we need to explicitly characterize a region of attraction for the first controller. 
%     \item If we are outside that region, we use another controller, say $\kappa_1$, which, with the help of path planning brings the robot in the region of attraction. We need to formally write a lemma that guarantees that the system will avoid obstacles and get to the region of attraction in finite time.
%     \item A ``uniting" scheme that seamlessly joins these two controller. This will be stated in the from of a theorem (the main result of our paper) that guarantees global converge to the path and invariance. 
%     \item A short section on how we use path planning to achieve obstacle avoidance and pushing to system in the neighbourhood of the path.
    
% \end{itemize}




\section{Notation and Preliminaries}\label{section:preliminaries}
% \subsection{Notations}\label{sec: math prelim}
% \subsection{Notation and Definition}
% We use a standard notation throughout this paper. Specifically,
\subsection{Notation}
In this paper, $\Real$ denotes the set of real numbers, $\mathbb R_{>0}$ denotes the set of positive real numbers, and $\mathbb R_{\geq0}$ denotes the set of nonnegative real numbers. We use \ak{$\norm{\cdot}_p$} to denote the $p-$norm, and \ak{$\norm{\cdot}$} is used to denote the Euclidean norm. In addition, we write $\partial S$ for the boundary of the set $S$, $\textrm{int}(S)$ for its interior, \ak{and $\norm{x}_S = \inf_{y\in S}\norm{x-y}$ for the distance from the point $x\notin S$ to the set $S$}. The Lie derivative of a function $V:\mathbb R^n\rightarrow \mathbb R$ along a vector field $f:\mathbb R^n\rightarrow\mathbb R^n$ at a point $x\in \mathbb R^n$ is denoted as $L_fV(x) \triangleq \frac{\partial V}{\partial x} f(x)$. The notation $\dom f$ denotes the domain of \pn{the} function $f$. The components of a typical vector $x\in \Real^n$ is represented by $x = (x_1, x_2, \cdots,x_n)$. A parametric curve $\sigma$ is defined as $\sigma: \dom \sigma \to \Real^2$. When the curve is not closed, $\dom \sigma = \Real$. 
%{\myblue (AA: We want to represent the domain of a generic curve as $\mbb{D}$, but when the image of the curve is a close path, such as a circle, the domain would be periodic. Otherwise, we represent the domain with $\mathbb{D}$.)} 
% We denote by $\dot x(t) = \frac{\text{d}x(t)}{\partial t}$ the time derivative of function $x(t)$ and by $y'(s) = \frac{\text{d}y(s)}{\ds}$ the derivative of $y(s)$ with respect to the stretched time $s$.
For closed curves with finite length $L$, this means that
 $\dom \sigma = \mod{\Real}{L}$ and $\sigma$ is $L$-periodic, i.e., for any $\lambda \in \dom \sigma$, $\sigma(\lambda + L) = \sigma(L)$. By an open neighborhood of a set $\mathcal{K} \subset \mathbb{R}^{n}$, we mean an open set in $\mathbb{R}^{n}$ containing $\mathcal{K}$.
\subsection{Hybrid Systems}
\input{tex/preliminary_hybridmodel.tex}
\subsection{Finite-time Stability}
\input{tex/preliminary_stability.tex}