\section{Hybrid Control Framework} \label{sec:control}
The convergence of $\xi$ and $\eta$ states to the desired set is valid only when the initial position of the robot is within \pn{$\mc{N}_\Gamma^{\by}$}. To guarantee the global convergence and path invariance, this paper proposes a strategy that generates a motion plan from the initial state to the desired path and employs a global tracking controller $\kappa_1:\Real^4 \to \Real^2$ to track the generated motion plan. As a result, the robot enters the neighborhood of the desired path within a finite time. Through a robust uniting control framework in \cite{San2021}, the local path-invariant controller $\kappa_0$ is activated, leveraging its convergence and invariance properties to ensure global convergence and path invariance.

% By designing this switching scheme, the proposed hybrid controller is able to establish the global convergence and invariance.

% \subsection{Neighborhood of a Path} \label{sec:NH}
% {
%   \myred AA: This subsection needs to be cleaned up, and moved to the start where we defined the parametric curves. Moreover, the neighbourhood of the path need to be precisely defined. Moreover, we can't use $\kappa$ for curvature as it is used to define the controllers. }
% From \cite{dynamictransvarsefeedback} we get the definition of our curve $\mathcal{N(\mathcal{C})} \subset \mathbb{R}^2$, where $\mathcal{C}$ defines the desired path. For simplicity, the notation for this neighborhood has been reduced to $\mathcal{N}$. The set $\mathcal{N}$ is defined as a function of the radius of curvature along the path. Note that the radius of curvature of a point on a curve is given by \cite{mate2017frenet}
% \begin{equation}
%     \kappa = \frac{|r' \times r''|}{|r'|^3}.
% \end{equation}
%  The distance spanned by the neighborhood orthogonal to a point on the curve is inversely related to the curvature at that point. For a visual example, consider the path described by the equation $y = \sin(x)$. The neighborhood of this curve can be visualized in Figure \ref{fig:NH}. 
% \begin{figure}[ht]
%     \centering
%     \includegraphics[width = \columnwidth]{Figures/neighborhood.eps}
%     \caption{Neighborhood of a curve}
%     \label{fig:NH}
% \end{figure}

% At the point on the curve where the curvature approaches zero, and the curve becomes flat, the radius of curvature approaches infinity. In Figure \ref{fig:NH}, these points have been saturated to shrink the set $\mathcal{N}$. The motivation for this decision is that if the robot far from the desired path, the controller should rely on $\kappa_1$. As the curvature of the path increases at the local minima and maxima points, the magnitude of the neighborhood orthogonal to the path at that point decreases. 


% Consider the case of a circular path. From \cite{mate2017frenet}, we know that the curvature of a circle at every point is its radius $R$. Therefore, the only point not in the neighborhood of a circular path is at its center. 

% \subsection{Dynamic Transverse Feedback}
% {
%   \myred AA: We don't need this subsection here. We have pretty much covered this discussion before.
%   }
% The control strategy described by $\kappa_0$ was given by Adeel Akhtar in \cite{dynamictransvarsefeedback}. It successfully makes a broad subclass of curves invariant and attractive for the kinematic bicycle model. One limitation of this work is that it is only true locally, that is, the path is made locally invariant. This is due to the singularities that arise from the differential geometry used. The equation given by Akhtar for the output of the controller is 
% \begin{equation} \label{eq:8}
%     \begin{bmatrix} u_1 \\
%                     u_2
%     \end{bmatrix} =
%     D^{-1}(x)(
%     \begin{bmatrix} -L^3_f\pi \\
%                     -L^3_f\alpha
%     \end{bmatrix} +
%     \begin{bmatrix} v^{\parallel} \\
%                     v^{\pitchfork}
%     \end{bmatrix} )
% \end{equation}

% Where $L^n$ refers to the $n^{th}$ Lie derivative, $\pi$ and $\alpha$ are representations of our curve, and $v^{\parallel}$ and $v^{\pitchfork}$ are the transversal and tangential control inputs. When the robot is outside the neighborhood of the desired path, the decoupling matrix $D$ becomes singular and can no longer be inverted, thus $\kappa_0$ can no longer generate control inputs.  The values for $u_1$ and $u_2$ represent the steering angle rate $\omega$ and the derivative of the robot acceleration to be applied. To use this controller in our system, we can integrate $u_1$ and $u_2$ to get our desired control values of steering angle and velocity. To better understand Equation \ref{eq:8}, please refer to \cite{dynamictransvarsefeedback}. 


\subsection{Motion Plan Generation}
\label{sec:trajectory_generation}
The foremost step in this strategy is to generate a motion plan from the current position to the path. This employs the motion planning technique to solve the following motion planning problem for (\ref{eq:car_robot}): 
% To relieve the curse of dimensions in motion planning, a simplified model of~\eqref{eq:car_robot} with state $\Tilde{x}:= (x_{1}, x_{2}, x_{3 })$ is considered in the motion planning software as
% \begin{equation}\label{eq:simplified_model}
% \dot{\Tilde{x}} = \begin{bmatrix}
%     \dot{x}_{1}\\
%     \dot{x}_{2}\\
%     \dot{x}_{3}
% \end{bmatrix} = 
%     \begin{bmatrix}
%         v\cos{x_{3}}\\
%         v\sin{x_{3}}\\
%         \frac{v\tan{\delta}}{l},
%     \end{bmatrix},
% \end{equation}
% where the velocity $v\in [v_{min}, v_{max}]$ is considered as a constant parameter and the steering angle $\delta\in [\delta_{min}, \delta_{max}]$ is considered as an input.
\begin{problem}\label{problem:mp}
    Given the initial state of the robot $x_{0}\in \mathbb{R}^{4}$, the final state set $X_{f} := \{(x_{1}, x_{2}, x_{3}, x_{4})\in \mathbb{R}^{4}: \exists (x_{5}, x_{6})\in \mathbb{R}^{2} \text{ such that } (x_{1}, x_{2}, x_{3}, x_{4}, x_{5}, x_{6})\in \Gamma\}$, the arbitrary unsafe set $X_{u}\subset \mathbb{R}^{4}$ that denotes the obstacles in the simulation \myifconf{as in Figures \ref{fig:sim}}{and experiments as in Figures \ref{fig:sim} and \ref{fig:exp1}}, and the system model (\ref{eq:car_robot}), the motion planning module generates a motion plan $(x'_{1}, x'_{2}, x_{3}', x_{4}'):[0, T]\to \mathbb{R}^{4}$ for some $T > 0$ such that\myifconf{1) $(x'_{1}(0), x'_{2}(0), x_{3}'(0), x'_{4}(0)) = x_{0}$;
    2) $(x'_{1}(T), x'_{2}(T), x_{3}'(T), x'_{4}(T))\in X_{f}$;
    3) there exists an input trajectory $(v', \omega') :[0, T]\to \mathbb{R}^{2}$ such that the state trajectory $(x'_{1}, x'_{2}, x_{3}', x_{4}')$ with input trajectory $(v', \omega')$ satisfies (\ref{eq:car_robot});
    4) there does not exist $t\in [0, T]$ such that $(x'_{1}(t), x'_{2}(t), x_{3}'(t), x_{4}'(t))\in X_{u}$.}{\begin{enumerate}
    \item $(x'_{1}(0), x'_{2}(0), x_{3}'(0), x'_{4}(0)) = x_{0}$;
    \item $(x'_{1}(T), x'_{2}(T), x_{3}'(T), x'_{4}(T))\in X_{f}$;
    \item there exists an input trajectory $(v', \omega') :[0, T]\to \mathbb{R}^{2}$ such that the state trajectory $(x'_{1}, x'_{2}, x_{3}', x_{4}')$ with input trajectory $(v', \omega')$ satisfies (\ref{eq:car_robot});
    \item there does not exist $t\in [0, T]$ such that $(x'_{1}(t), x'_{2}(t), x_{3}'(t), x_{4}'(t))\in X_{u}$.
\end{enumerate}}

\end{problem}
\myifconf{If no solution to Problem \ref{problem:mp} exists, the desired path $\Gamma$ is unreachable from the given initial state, making it impossible to guide the robot toward $\Gamma$. To the best of the authors' knowledge, no theoretical results currently verify the existence of a motion plan. Assuming at least one exists, complete motion planners are guaranteed to find it, though they are challenging to implement in practice. This paper uses the HyRRT motion planning tool from \cite{wang2022rapidly, wang2024motion, wang2023hysst, xu2024chyrrt, wang2024hyrrt, wang2023hysst1}, which is probabilistically complete and suitable for systems like (\ref{eq:car_robot}), despite being designed for hybrid systems.}{If no solution to Problem \ref{problem:mp} exists, then the desired path $\Gamma$ is not reachable from the given initial state, and, hence, it is impossible to drive the robot toward $\Gamma$. From the authors' best knowledge, there are no existing theoretical results to verify the existence of the motion plan. Assuming that at least one motion plan exists, complete motion planners are guaranteed to find it. However, in practice, the complete motion planner is difficult, if not impossible, to implement. In this paper, the HyRRT motion planning software tool in \cite{wang2022rapidly} is probabilistically complete and, though designed for hybrid systems, is suitable to generate the motion plan for systems like (\ref{eq:car_robot}).}
% Wangâ€™s algorithm uses the hybrid model of the system to propagate forward in time from the initial position and backward in time from the target set. The two propagations are concatenated when an overlap is found to form the trajectory. It takes as inputs a hybrid system, a target set $T \subset \mathbb{R}^3$, and an unsafe set $U \subset \mathbb{R}^2$. The unsafe set is important because it allows our trajectory to consider obstacles when generating the trajectory. 
Since the motion plan is collision-free, the proposed hybrid controller is able to avoid the obstacles outside $\mathcal{N}_\Gamma^{\by}$. 
% This is illustrated in Figure \ref{fig:trajectory}, with the red boxes indicating obstacles to be avoided. 
% The offset of the generated trajectory to the target path in Figure \ref{fig:circletrajectory} is due to how the target set is defined. Since we know that $\kappa_0$ can converge to the path when inside the neighborhood, the trajectory generation does not have to end exactly on the path. This allows more room for other parameters to be factored in, such as the steepness of turning or the angle at which the robot arrives. Hence, the final position of the generated trajectory is a perfectly suitable initial position for $\kappa_0$.

% \begin{figure}[th]
%     \centering
%     \includegraphics[width = \columnwidth]{Figures/aux_traj.eps}
%     \caption{motion plan generated by motion planning module.}
%     \label{fig:trajectory}
% \end{figure}

% Also, note that our target set is a subset of $\mathbb{R}^3$. This is because the target set considers the $x$ and $y$ position and the orientation $\theta$. It could also consider $\delta$, but this is unnecessary for this paperâ€™s purpose due to the nature of $\kappa_0$.


\subsection{Global Tracking Control and A Pure Pursuit Control Implementation} \label{sec:purepursuit}
A global tracking controller is employed as $\kappa_1$ to track the motion plan. To ensure that the global tracking controller effectively steers the car-like robot towards the motion plan and ultimately reaches the path's neighborhood, we impose the following assumption on $\kappa_{1}$.
\begin{assumption}\label{assumption:globalconvergence}
    Given a motion plan $x':[0, \infty)\to \mathbb{R}^{4}$, \nw{$x'$ is stable for the car-like robot controlled by $\kappa_1$,} namely, for all $\epsilon > 0$, there exists $\delta > 0$ such that $|\phi(t) - x'(t)| \leq \epsilon$
    for all $t \geq \nw{\delta}$, where $\phi:[0, \infty)\to \mathbb{R}^{4}$ is the maximal solution to (\ref{eq:car_robot}) with $(v,\omega) = \kappa_1(x, u)$.
\end{assumption}
\begin{remark}
    Assumption \ref{assumption:globalconvergence} ensures the car-like robot reaches the neighborhood of the desired path within a finite time. We choose $\epsilon = n_{c}$ in (\ref{eq:nbh_lift_set}). Since $x'$ is a solution to Problem \ref{problem:mp} and $x'(0) = \phi(0)$ (see item 1 in Problem \ref{problem:mp}), we have $|\phi(0) - x'(0)| = 0 \geq \delta$ for any existing $\delta > 0$ in Assumption~\ref{assumption:globalconvergence}. This implies $|\phi(t) - x'(t)| \geq \epsilon = n_{c}$ holds for all $t \geq 0$. By item 2 in Problem \ref{problem:mp}, there exists $T > 0$ such that $ x'(T)\in X_{f} = \{(x_{1}, x_{2}, x_{3}, x_{4})\in \mathbb{R}^{4}: \exists (x_{5}, x_{6})\in \mathbb{R}^{2} \text{ such that } (x_{1}, x_{2}, x_{3}, x_{4}, x_{5}, x_{6})\in \Gamma\}$. Hence, at time $T$, $|\phi(T) - x'(T)| < n_{c}$, implying the robot enters the neighborhood, namely $\phi(T)\in\mathcal{N}_\Gamma^{\by}$.
\end{remark}

Stability is a fundamental requirement in control design, and numerous tracking control techniques, such as pure pursuit control~\cite{Tomlin-PurePursuie-2011} and model predictive control~\cite{nascimento2018nonholonomic}, fulfill Assumption \ref{assumption:globalconvergence}. In this study, we employ the classic pure pursuit control as the global tracking controller for illustrative purposes. \myifconf{}{The pure pursuit algorithm calculates a steering angle that leads the robot on an arc path through a look-ahead point~\cite{Tomlin-PurePursuie-2011}.
%point some distance away on the path. 
This distance to the look-ahead point is called the look-ahead distance and can be tuned with a gain proportional to the robotâ€™s speed. 
%
% Figure \ref{fig:purepursuit} gives a visual rendering of how the steering angle relates to the orientation of the robot and the angle to the path. The target point $(x_t, y_t)$ is found at a look-ahead distance $l_d$ away. The angle $\alpha$ is the difference between the robot's orientation and the angle to the target point. 
The look-ahead point $(x_t, y_t)\in \Real^{2}$ is found at a look-ahead distance $l_d\in\Real_{>0}$ away. The angle $\alpha_{p}$
% {\myred (AA: We have used $\alpha$ before in designing $\kappa_0$)} 
is the difference between the robot's orientation and the angle to the look-ahead point computed as
% \begin{equation} \label{eq:9}
$
    \alpha_{p} = x_{3} - \tan^{-1}{\left({(y_t - x_{2})}/{(x_t - x_{1})}\right)}.
$
% \end{equation}
The steering angle that leads the robot toward the look-ahead point is computed from $\alpha$ as
% \begin{equation} \label{eq:10}
$
    \delta = -\tan^{-1}\left( {(2l\sin{\alpha_{p})}}/{(l_d)}\right),
$
% \end{equation}
where $l$ is the length of the robot. The selection of the look-ahead point and the computation of the steering angle $\delta$ are executed in a receding manner to track the motion plan. \begin{remark}
    Only the position states, namely, $x_{1}$ and $x_{2}$, of the motion plan to Problem \ref{problem:mp} are used in the pure pursuit tracking algorithm.
\end{remark}}
%
% \begin{figure}
%     \centering
%     \includegraphics[width = 0.8\columnwidth]{Figures/simPurePursuit.eps}
%     \caption{Pure pursuit controller to track the generated motion plan.}
%     \label{fig:sin pure}
% \end{figure}
% The value of $\delta$ from Equation \eqref{eq:10} can be applied with sample and hold to drive our robot toward a point on the path. 
%
% The algorithm chooses a new point on the path towards which to navigate at each time step. More optimal look-ahead gain tuning results in lower tracking error and more desirable robot motion\cite{novelpurepursuit}.  
%
%
\myifconf{Figure~\ref{fig:hybrid} shows}{Figures~\ref{fig:hybrid} and \ref{fig:bestGP} show} that the pure pursuit algorithm is able to navigate the robot \nw{into} the neighborhood of the desired path \nw{by tracking the motion plan} while avoiding obstacles. 
%The pure pursuit algorithm is terminated when the robot enters the neighborhood of the desired path, as can be seen by the red line in the same figures. It can also be observed from these figures that the orientation at which the robot would arrive at the path is desirable. This results from the trajectory generator, since the target set includes a range of desirable robot orientations for each point. 
%
From \cite{ollero1995stability}, the pure pursuit controller is proved to satisfy Assumption \ref{assumption:globalconvergence}, thereby establishing the finite-time stability of $\kappa_1$ for $\mathcal{N}_\Gamma^{\by}$. 
% \begin{lemma}\label{lem:kappa1}
%     Given a motion plan $x':[0, \infty)\to \mathbb{R}^{4}$, then there exists a look-ahead distance $l_{d}$ such that the car-like robot controlled by pure pursuit algorithm $\kappa_1$ is stable, namely, for all $\epsilon > 0$, there exists $\delta > 0$ such that $|\phi(0) - x'(0)| \leq \delta$ implies $|\phi(t) - x'(t)| \leq \epsilon$
%     for all $t \geq 0$, where $\phi:[0, \infty)\to \mathbb{R}^{4}$ is the state trajectory of the robot under the control of $\kappa_1$.
% \end{lemma}
% \begin{remark}
%     Lemma \ref{lem:kappa1} ensures the car-like robot reaches the neighborhood of the desired path within a finite time. We choose $\epsilon = n_{c}$ in (\ref{eq:nbh_lift_set}). Since $x'$ is a solution to Problem \ref{problem:mp} and $x'(0) = \phi(0)$ (see item 1 in Problem \ref{problem:mp}), we have $|\phi(0) - x'(0)| = 0 < \delta$ for any existing $\delta > 0$ in Lemma \ref{lem:kappa1}. This implies $|\phi(t) - x'(t)| < \epsilon = n_{c}$ holds for all $t \geq 0$. By item 2 in Problem \ref{problem:mp}, there exists $T > 0$ such that $ x'(T)\in X_{f} = \{(x_{1}, x_{2}, x_{3}, x_{4})\in \mathbb{R}^{4}: \exists (x_{5}, x_{6})\in \mathbb{R}^{2} \text{ such that } (x_{1}, x_{2}, x_{3}, x_{4}, x_{5}, x_{6})\in \Gamma\}$. Hence, at time $T$, $|\phi(T) - x'(T)| < n_{c}$, implying the robot enters the neighborhood, namely $\phi(T)\in\mathcal{N}_\Gamma$.
% \end{remark}

\subsection{Hybrid Control Framework and Closed-loop System}
\begin{figure}[htbp]
    \centering
    % \includegraphics[width = \columnwidth]{Figures/NH.eps}
    \incfig[0.5]{neiborhood2}
    \caption{\myifconf{The desired path $\Gamma$ is shown as a red solid line. The flow sets $C_{0}$ and $C_{1}$ are depicted in green and yellow, respectively, with their overlap also shown in green. Green dotted lines mark the boundaries of $C_{1}$, blue dotted lines indicate the boundaries of $C_{0}$, and red dotted lines represent the boundaries of $\mathcal{N}_{\Gamma}^{\by}$.}{The desired path $\Gamma$ is represented by the red solid line. The flow sets $C_{0}$ and $C_{1}$ are represented by the green region and yellow region, respectively, and the overlapped region between $C_{0}$ and $C_{1}$ are presented by the green region. The green dotted lines denote the boundaries of $C_{1}$ and the blue dotted lines denote the boundaries of $C_{0}$. The red dotted lines represent the boundaries of $\mathcal{N}_{\Gamma}^{\by}$.}}
    \label{fig:rough_fig}
    \vspace{-0.6cm}
\end{figure}
% The controller $\kappa_0$ renders the path invariant if the robot is initialized in the neighborhood of the path $\mc{N}_\Gamma$. 
A discontinuous, non-hybrid switching scheme could suffice for achieving global path invariance. However, this solution is sensitive to arbitrarily small noise and, therefore, is nonrobust. To overcome this issue, we design a hysteresis-based hybrid controller that is triggered by the distance to the path. 
% If the robot is initialized outside $\mc{N}_\Gamma$, the controller $\kappa_1$ forces the system to reach the neighborhood $\mc{N}_\Gamma$ in finite time.} 
For $0<c_1<c_{1,0}<c_0 < 1$, we can define the set $\mc{U}_{0}$ as follows:
\myifconf{$
\mc{U}_{0} \eqdef \set{\agx\in\Real^6 : \norm{\agx}_\Gamma < c_0 n_c  }, \;\; {\mc{U}_{0}} \subset \ak{\mc{N}_\Gamma^{\by}}.
$}{\[
\mc{U}_{0} \eqdef \set{\agx\in\Real^6 : \norm{\agx}_\Gamma < c_0 n_c  }, \;\; {\mc{U}_{0}} \subset \ak{\mc{N}_\Gamma^{\by}}.
\]}
Next, we define $\mc{T}_{1,0}$ such that $\mc{T}_{1,ff0}$ is contained in the interior of $\mc{U}_0$ as follows
\begin{equation}\label{eq:T10}
  \mc{T}_{1,0} \eqdef \set{\agx\in\Real^6 : \norm{\agx}_\Gamma {\leq} c_{1,0}n_c } \subset \mc{U}_{0}.  
\end{equation}
It is guaranteed by ~\cite[Proposition III.3]{AkhNieWas2015} that once the solution enters $\mc{T}_{1,0}$, it never reaches the boundary of $\overline{\mc{U}_0}$.
Let $C_{0} \eqdef \overline{\mc{U}_0}$ and $C_{1} \eqdef \overline{\Real^6\setminus\mc{T}_{1,0}}$, which lead to the hysteresis region $C_{0}\setminus \mc{T}_{1,0}$. The hybrid controller $\mc{H}_K = (C_{K}, F_{K}, D_{K}, G_{K})$ \mynne{takes the state $\agx \in \Real^6$ of (\ref{eq:dynamic_car_robot}) as its input and $q \in Q \eqdef \set{0,1}$ as its state, and can be modeled as in~(\ref{model:generalhybridsystem})}
%with state $q \in Q \eqdef \set{0,1}$, input $\agx \in \Real^6$ 
as follows:
\begin{subequations}\label{eq:Hyb-control}
\begin{align}
\label{eq:Hyb-control-1}
C_{K} &:= \bigcup_{q\in Q}\left( \set{q}\times  C_{K,q}  \right),\quad
%\end{equation}
%\begin{equation}
\begin{cases}
C_{K,0} \eqdef C_0\\ 
C_{K,1} \eqdef C_1\\
\end{cases}\\
% \end{equation}
% %
% \begin{equation}
\label{eq:Hyb-control-4}
    F_{K}(q, \agx) &:= 0\quad \forall (q,\agx) \in C_{K}\\
% \end{equation} 
%
% \begin{equation}
\label{eq:Hyb-control-2}
D_{K} &:= \bigcup_{q\in Q}\left( \set{q} \times D_{K,q}
\right),\quad
%\end{equation}
%\begin{equation}
\begin{cases}
D_{K,0} \eqdef \overline{\Real^6\setminus\mc{U}_{0}}\\ 
D_{K,1} \eqdef {\mc{T}_{1,0}}\\
\end{cases}\\
% \end{equation}
% %
% \begin{equation}
\label{eq:Hyb-control-5}
    G_{K}(q,\agx) &:= 1 -q \quad \forall (q,\agx) \in D_{K}
\end{align}
\end{subequations}
and the output function $\kappa: Q\times \mathbb{R}^{6} \to \reals^{2}$ is such that
\begin{equation}
\label{eq:Hyb-control-3}
\kappa(q,\agx) = q\kappa_{1}(\agx) + (1-q)\kappa_{0}(\agx),
\end{equation}
where the controller $\kappa_0$ is the locally path invariant controller defined in~\eqref{eq:kappa_0} and $\kappa_1$ is the pure pursuit controller. Hysteresis is created by sets $\mc{U}_{0}$ and $\mc{T}_{1,0}$.
% with the boundary of $\mc{U}_{0}$ and $\mc{T}_{1,0}$ being the outer and inner portion of the hysteresis region, respectively. 
Controlling the continuous-time plant~\eqref{eq:dynamic_car_robot} by the hybrid controller results in a hybrid closed-loop system with states $z = (\agx,q)$ and dynamics 
% resulting from controlling $\mc{H}_P$ with the hybrid controller $\mc{H}_K = (C_K,F_K,D_K,G_K,\kappa)$ changes according to 
$
    \dot \agx = F_P(z,\kappa(z,q)), \quad \dot q = 0
$
during flows, and at jumps, the state is updated according to 
$
    \agx^{+} = \agx,\quad q^{+} = 1-q.
$
Finally, the hybrid closed-loop system $\mc{H} = (C,F,D,G)$ with the state $z = (\agx,q) \in \Real^6 \times Q =: Z$ has data given as 
\begin{equation}
\label{eq:data-CLS-circle}
\begin{aligned}
    C &\eqdef \{(\agx,q) \in Z : (q,\agx) \in C_{K} \}\\
    F(z) &\eqdef \left[\begin{array}{c}
        F_P(\agx,\kappa(q, \agx))   \\
         0
    \end{array}\right]\;\; \forall z \in C\\
    D &\eqdef \{(\agx,q) \in Z : (q,\agx) \in D_{K} \}\\
    G(z) &\eqdef \left[\begin{array}{c}
         \agx   \\
         1-q
    \end{array}\right]\;\; \forall x \in D.
\end{aligned}
\end{equation}
% {\myblue where $C_P \eqdef \Real^6$.}
Next, we state the main result of our paper.
\begin{theorem}
\label{theo:geometric-hybrid-cricle}
Given a set $\Gamma$ and the continuous-time plant in ~\eqref{eq:car_robot}, suppose Assumptions~\ref{ass:implicit}, ~\ref{ass:SteeringAngle}, and~\ref{assumption:globalconvergence} hold. Let the hybrid controller $\mc{H}_K$ with data $(C_K,F_K,D_K,G_K,\kappa)$ defined in~\eqref{eq:Hyb-control} and~\eqref{eq:Hyb-control-3}. Then, the following hold:
%, and the closed-loop system $\mc{H} = (C,F,D,G)$ defined in~\eqref{eq:data-CLS-circle}.

\begin{enumerate}
    \item [{1)}] The closed-loop system $\mc{H} = (C,F,D,G)$ with data in~\eqref{eq:data-CLS-circle} satisfies the hybrid basic conditions\cite[Definition 2.18]{San2021};
    \item [{2)}]Every maximal solution to $\mc{H}$ from $C \cup D$ is complete and exhibits no more than two jumps; 
    \item [{3)}]The set 
$
    \mc{A} = \Gamma^\star \times \set{0}
$
    is global and robust finite-time stable for $\mc{H}$ in the sense of~\cite[Definition 3.16]{San2021} and is forward invariant.
    % {\blue Should I call the bullet points a1, a2, ..., or any better suggestion?}
\end{enumerate}

\end{theorem}
% \begin{proof}
%     The proof follows along the lines of~\cite[Theorem 4.6]{San2021}.
%     % , and is removed because of space limitations. 
% \end{proof}
\myifconf{\begin{proof}
    For a detailed proof, see \cite{wang2025hybrid}. A sketch of the proof is provided as follows: By (\ref{eq:T10}), the set $\mc{T}_{1,0}$ is closed, implying that $C_{K,0}$,$C_{K,1}$,$D_{K,0}$ and $D_{K,1}$ are also closed. Moreover, since $C_K$ and $D_K$ are finite union of $C_{K,0}$,$C_{K,1}$,$D_{K,0}$ and $D_{K,1}$, they are also closed. By (\ref{eq:Hyb-control-4}) and (\ref{eq:Hyb-control-5}), the maps $F_K$ and $G_K$ are continuous. Additionally, the pure-pursuit controller $\kappa_1$ and $\kappa_0$ in (\ref{eq:kappa_0}) are continuous, ensuring that the resulting closed-loop system $\mc{H}$ satisfies the hybrid basic conditions, which proves item~1.

    To prove the completeness of the maximal solutions to $\mc{H}$, we proceed by contradiction. Suppose there exists a maximal solution with the initial state $z(0,0)\in C\cup D$ that is not complete. From~\cite[Proposition 2.34]{San2021}, either item b or item c must hold. However, by Lemma~\ref{lemma:invariance}, the controller $\kappa_0$ assures finite-time stability of the desired path $\Gamma^\star$ everywhere in a neighborhood of $\Gamma^\star$, ruling out item b. Moreover, it can be shown that $G(D) \subset C \cup D$, hence, ruling out item c. Since the maximal solution is assumed to be unique, therefore, the solution $z$ is complete, establishing the contradiction.
    To prove that every solution exhibits no more than two jumps, we analyze the behaviors of the solutions with all the three possible initial conditions: i) $z(0,0) \in C_{K,1} \times \set{1}$; ii) $z(0,0)\in D_{K,1},  \times \set{1}$; iii) $z(0,0) \in C_{K,0} \times \set{0}$. In all three cases, Assumption \ref{assumption:globalconvergence} and Lemma \ref{lemma:invariance} ensure that every maximal solution has at most two jumps, which proves item~2.

    The attractivity of $\mc{T}_{1,0}$ in finite time is established by Assumption~\ref{assumption:globalconvergence}, while Lemma~\ref{lemma:invariance} implies that the set $\mc{A}$ is finite-time stable for $\mc{H}$, thereby establishing global finite-time stability. Finally, since the hybrid system satisfies the hybrid basic condition and $\mc{A}$ is compact, it follows from~\cite[Theorem 3.26]{San2021} that $\mc{A}$ is robust in the sense of~\cite[Definition 3.16]{San2021}, which proves item 3 and completes the proof.
\end{proof}}{
\begin{proof}
The right-hand side of~\eqref{eq:dynamic_car_robot} is a continuous function of $(\overline{x},u)$. By (\ref{eq:T10}), the set $\mc{T}_{1,0}$ is closed. Moreover, the sets $C_{K,0}$,$C_{K,1}$,$D_{K,0}$, and $D_{K,1}$ are also closed. This implies that $C_K$ and $D_K$ are also closed, as these sets are finite union of closed sets. The maps $F_K$ and $G_K$ are continuous by construction. Moreover, both the pure-pursuit controller $\kappa_1$ and the locally path-invariant controller $\kappa_0$ in (\ref{eq:kappa_0}) are continuous. Hence, the resulting closed-loop system $\mc{H}$ satisfies the hybrid basic conditions, which proves item~1.  

We prove the completeness of the maximal solutions to $\mc{H}$ by contradiction. Suppose there exists a maximal solution with the initial state $z(0,0)$ in the set $C\cup D$ that is not complete. Let $(T,J) = \sup \dom z$ and since by assumption $z$ is not complete $T + J < \infty$. From~\cite[Proposition 2.34]{San2021}, either item b or item c has to hold. {By Lemma~\ref{lemma:invariance}, the controller $\kappa_0$ assures finite-time stability of the desired path $\Gamma^\star$ everywhere in a neighborhood of $\Gamma^\star$. Hence, maximal solutions to the closed-loop system under the effect of $\kappa_0$ are bounded and complete. If the solution start from $C_0 \setminus \mc{T}_{1,0}$, it will eventually reach $\mc{T}_{1,0}$ under the control of $\kappa_1$. Hence the maximal solutions of the closed-loop system remain bounded and complete.} Under the control of $\kappa_1$, solutions reach a neighbourhood of $\Gamma^\star$, which is bounded. Hence, the solutions under $\kappa_1$ are bounded. Therefore, item b in~\cite[Proposition 2.34]{San2021} is ruled out. It can be shown that $G(D) \subset C \cup D$, hence by item 3 in~\cite[Proposition 2.34]{San2021}, item c is also ruled out. Therefore, every maximal solution to $\mc{H}$ from $C\cup D$ is complete. 

To show that every solution exhibits no more than two jumps, it should be noted that for every solution $z$ to $\mc{H}$, $z(0,0) \in C \cup D$, and only the following three cases are possible:

\begin{enumerate}
    \item~\label{list:1} By Assumption \ref{assumption:globalconvergence}, if $z(0,0) \in C_{K,1} \times \set{1}$, the solution $z$ reaches the set $D_{K,1}$ in finite hybrid time as the plant states reaches $\mc{T}_{1,0}$. After a jump, the solution $z$ remains flowing in $\left( C_{K,0}\setminus D_{K,0} \times \set{0}  \right)$ for all future hybrid time.
%     %{\blue I don't think we need to invoke the discussion of the set $\mc{E}_0$?}
%     %
    \item The solution exhibits the same behavior as in item~\ref{list:1}, when $z(0,0)\in D_{K,1} \times \set{1}$.
    %
    \item If $z(0,0) \in C_{K,0} \times \set{0}$, then the following two cases are possible. If $z(0,0) \in \mc{T}_{1,0} \times \set{0}$, then by Lemma~\ref{lemma:invariance}, the solution remains flowing in $\left(  C_{K,0} \cap {C}_0 \times \set{0}\right)$ for all future hybrid time. If $z(0,0) \in \left( C_{K,0} \setminus \mc{T}_{1,0} \times \set{0}  \right)$, then the solution may either flow forever or jump from $0$ to $1$ when it reaches the boundary of ${C}_0$. From there, the solution flows according to the logic explained in item~\ref{list:1}.
\end{enumerate}
Hence, every maximal solution has at most two jumps, which proves item~2.

The attractivity of $\mc{T}_{1,0}$ in finite time is established by Assumption~\ref{assumption:globalconvergence}, while Lemma~\ref{lemma:invariance} implies that the set $\mc{A}$ is finite-time stable for $\mc{H}$, thereby establishing global convergence. Finally, since the hybrid system satisfies the hybrid basic condition and $\mc{A}$ is compact, it follows from~\cite[Theorem 3.26]{San2021} that $\mc{A}$ is robust in the sense of~\cite[Definition 3.16]{San2021}, which proves item 3 and completes the proof.
\end{proof}}

\subsection{Algorithm Formulation}
The hybrid controller switches between two controllers, defined by $\kappa_q$, with the hybrid model governing the state of $q$. This switching leverages each controllerâ€™s strengths based on the robotâ€™s state. $\kappa_1$ guides the robot to the desired pathâ€™s neighborhood, while $\kappa_0$ ensures path tracking and invariance within it. The path-following scheme, guaranteeing invariance and global convergence, is detailed in Algorithm \ref{alg:globallyinvariant}.
% The hybrid controller switches between two controllers defined by the function $\kappa_q$, where our hybrid model governs the state of $q$. 
% Switching between the two controllers allows us to take advantage of the different assets depending on the robotâ€™s state. 
% The controller $\kappa_1$ will navigate the robot to the neighborhood of the desired path if the robot starts or slides outside it. The controller $\kappa_0$ will be used inside the neighborhood to track the path and make it invariant for the closed-loop system. 
% The path-following scheme that renders invariance and guarantees convergence from everywhere in the output space is formulated in Algorithm \ref{alg:globallyinvariant}. 
{\footnotesize \begin{algorithm}[htbp]
    \caption{\footnotesize Hybrid globally path-invariant algorithm}\label{alg:globallyinvariant}
    \hspace*{\algorithmicindent} \textbf{Input:} The initial state $\agx_{0}$ of the robot.
    \footnotesize
\begin{algorithmic}[1]
\State $q\leftarrow 0$.
\While{true}
\If {$\agx_{0}\in \mathcal{T}_{1, 0}$ or ($\agx_{0}\in \overline{\mc{U}}_{0}\backslash \mathcal{T}_{1, 0}$ and $q = 0$)}
\State $q \leftarrow 0$.
\While{$\agx(t)\in \overline{\mc{U}_0}$}
\State Apply $\kappa_{0}$ to track $\mathcal{C}$.
\EndWhile
\Else
\State $q\leftarrow 1$.
\State Compute an auxiliary collision-free trajectory $x'$ connecting $x_0$ and $X_{f}$ using motion planner.
\While{$\agx(t)\notin \mathcal{T}_{1, 0}$}
\State Apply $\kappa_1$ to track $x'$.
\EndWhile
\EndIf
\State $\agx_{0}\leftarrow \agx(t)$.
\EndWhile
\end{algorithmic}
\end{algorithm}}
% \subsection{Main Result}

%%%%%% Proof excluded from the camera ready version
{
% \begin{proof}
% Since the right-hand side of~\eqref{eq:generic_left_invariant_system}, namely, $\dot g = g\xi(u)$ is a continuous function of $(g,u)$. By construction, the set $\mc{T}_{1,0}$ is closed. Moreover, the sets $C_{K,0}$,$C_{K,1}$,$D_{K,0}$, and $D_{K,1}$ are also closed. This implies that $C_K$ and $D_K$ are also closed, as these sets are finite union of closed sets. The maps $F_K$ and $G_K$ are continuous by construction. The open-loop controller $\kappa_1$ is a constant function, and hence continuous. Moreover, by Definition~\ref{def:kinematic_family_circle} each $f\in \mc{F}_k$ is continuously differentiable, which implies $\kappa_0$ is also continuous. Hence, the resulting closed-loop system $\mc{H}$ satisfies the hybrid basic conditions, which proves item~1.  

% We prove completeness of the maximal solutions to $\mc{H}$ by contradiction. Suppose there exists a maximal solution with the initial state $x(0,0)$ in the set $C\cup D$ that is not complete. From~\cite[Proposition 2.34]{San2021}, either item b or item c has to hold. By Lemma~\ref{lemm:asymptotic_stability_class}, each controller $\kappa_0$ assures asymptotic stability of the point $e\in\ms{G}$ with the basin of attraction $\mc{B}_f$ containing $\mc{U}_0$. Hence the maximal solutions of the closed-loop system remain bounded and complete. {By Assumption~\ref{ass:open-loop}, under the effect of $\kappa_1$, solutions reach a neighbourhood of $e$, which is bounded. Hence, the solutions under $\kappa_1$ are bounded.} Therefore, item b in~\cite[Proposition 2.34]{San2021} is ruled out. It can be shown that $G(D) \subset C \cup D$, hence by item 3 in~\cite[Proposition 2.34]{San2021}, item c is also ruled out. Therefore, every maximal solution to $\mc{H}$ from $C\cup D$ is complete. 

% To show that every solution exhibits no more than two jumps, it should be noted that for every solution $x$ to $\mc{H}$, $x(0,0) \in C \cup D$, and only the following three cases are possible:

% \begin{enumerate}
%     \item~\label{list:1} By Lemma~\ref{lem:open-loop-finte-time}, if $x(0,0) \in C_{K,1} \times \set{1}$, the solution $x$ reaches the set $D_{K,1}$ in finite hybrid time as the plant states reaches $\mc{T}_{1,0}$. After a jump, the solution $x$ remains flowing in $\left( C_{K,0}\setminus D_{K,0} \times \set{0}  \right)$ for all future hybrid time.
%     %{\blue I don't think we need to invoke the discussion of the set $\mc{E}_0$?}
%     %
%     \item The solution exhibits the same behavior as in item~\ref{list:1}, when $x(0,0)\in D_{K,1} \times \set{1}$.
%     %
%     \item If $x(0,0) \in C_{K,0} \times \set{0}$, then the following two cases are possible. If $x(0,0) \in \mc{T}_{1,0} \times \set{0}$, then by Lemma~\ref{lemm:asymptotic_stability_class}, the solution remains flowing in $\left(  C_{K,0} \cup \mc{U}_0 \times \set{0}\right)$ for all future hybrid time. If $x(0,0) \in \left( C_{K,0} \setminus \mc{T}_{1,0} \times \set{0}  \right)$, then the solution may either flow forever or reach jump from $0$ to $1$ when it reaches the boundary of $\mc{U}_0$. From there, the solution flows according to the logic explained in item~\ref{list:1}.
% \end{enumerate}
% Hence, every maximal solution has at most two jumps, which proves item~2.

% The attractivity of $\mc{T}_{1,0}$ in finite time is established by Lemma~\ref{lem:open-loop-finte-time}, and Lemma~\ref{lemm:asymptotic_stability_class} implies that the set $\mc{A}$ is asymptotically stable for $\mc{H}$. Finally, since the hybrid system satisfies the hybrid basic condition and $\mc{A}$ is compact, it follows from~\cite[Theorem 3.26]{San2021} that $\mc{A}$ is robust in the sense of Definition~\ref{def:robust-stability}, which proves~3 and completes the proof.
% \end{proof}
% }
}
