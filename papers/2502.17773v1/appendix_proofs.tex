\section{Proofs}

\subsection{Failure of Exact CLT-Based Intervals under Distribution Shift}\label{sec-impossibility-exact-CLT}

Consider a true distribution $N(\mean,1)$ and a synthetic distribution $N(\simmean,1)$. Suppose we draw $k$ i.i.d.~synthetic samples $\{ x_i \}_{i=1}^k \sim N(\simmean,1)$ and construct the standard $(1-\alpha)$ confidence interval for $\mean$:
\[
\simCI(k) = \left[ \bar{x}_k - \frac{\Phi^{-1}(1-\alpha/2)}{\sqrt{k}}, ~ \bar{x}_k + \frac{\Phi^{-1}(1-\alpha/2)}{\sqrt{k}} \right],
\]
where $\bar{x}_k = \frac{1}{k} \sum_{i=1}^k x_i$. Let $\Delta = \mean - \simmean$, which represents the discrepancy between the true distribution and the synthetic distribution. Then
\begin{align*}
\PP\Big( \mean \in \simCI(k) \Big)
&=
\PP\left( | \bar{x}_k - \mean | \le \frac{\Phi^{-1}(1-\alpha/2)}{\sqrt{k}} \right) \\[4pt]
&=
\PP\left( | \sqrt{k} (\bar{x}_k - \simmean) - \sqrt{k} (\mean - \simmean) | \le \Phi^{-1}(1-\alpha/2) \right) \\[4pt]
&=
\PP\left( \sqrt{k} \Delta - \Phi^{-1}(1-\alpha/2) \le \sqrt{k} (\bar{x}_k - \simmean) \le \sqrt{k} \Delta + \Phi^{-1}(1-\alpha/2) \right).
\end{align*}
Note that $\sqrt{k} (\bar{x}_k - \simmean) \sim N(0,1)$. Thus, whenever $\Delta\neq 0$,
\[
\PP\Big( \mean \in \simCI(k) \Big) < 1-\alpha,
\]
failing to attain $(1-\alpha)$ coverage probability, regardless of the sample size $k$.


\subsection{Proof of \Cref{thm-coverage-1D}}\label{sec-thm-coverage-1D-proof}

We will prove the following stronger guarantee.

\begin{lemma}[Conditional coverage]\label{lem-conditional-coverage-1D}
Consider the setting of \Cref{thm-coverage-1D}. Let $\delta\in(0,1)$. With probability at least $1-\delta$,
\begin{equation}\label{eqn-conditional-coverage-1D}
\PP\Big( \mean \in \simCI(\widehat{k}) \Bigm| \widehat{k} \Big) \ge 1 - \alpha - \sqrt{\frac{2\log(1/\delta)}{m}}.
\end{equation}
\end{lemma}

By \Cref{lem-conditional-coverage-1D}, we obtain
\begin{align*}
\PP\Big( \mean \in \simCI(\widehat{k}) \Big)
&=
\EE\left[ \PP \Big( \mean \in \simCI(\widehat{k}) \Bigm| \widehat{k} \Big) \right] \\[4pt]
&=
\int_0^{\infty} \PP \left( \PP \Big( \mean \in \simCI(\widehat{k}) \Bigm| \widehat{k} \Big) > t \right) \,dt \\[4pt]
&\ge 
\int_0^{1-\alpha} \left[ 1 - \exp\left( -\frac{m}{2} (t - (1-\alpha) )^2 \right) \right] \,dt \\[4pt]
&\ge 
1-\alpha - \int_{-\infty}^{1-\alpha} \exp\left( -\frac{m}{2} (t - (1-\alpha) )^2 \right) \,dt \\[4pt]
&\ge 
1-\alpha - \sqrt{\frac{2}{m}}.
\end{align*}

We will now prove \Cref{lem-conditional-coverage-1D}. Define $\varepsilon = \sqrt{2\log(1/\delta) / m}$ and a deterministic oracle sample size
\begin{equation}\label{eqn-oracle-k-1D}
\bar{k} = \inf \left\{ k\in [K] : \PP \Big( \mean \not\in \simCI(k) \Big)  
> \alpha + \varepsilon \right\}.
\end{equation}
If $\bar{k} = \inf\emptyset$ does not exist, then there is nothing to prove. Now suppose that $\bar{k} \in [K]$ exists. We will prove that with probability at least $1-\delta$, it holds that $\coverage(\bar{k}) > \alpha/2$. When this event happens, we have $\widehat{k} < \bar{k}$, which implies $\PP\big( \mean \not\in \simCI(\widehat{k}) \bigm| \widehat{k} \big) \le \alpha+\varepsilon$ and thus \eqref{eqn-conditional-coverage-1D}, thanks to the independence of $\widehat{k}$ and $(\testfunction,\simdataset)$.

By Hoeffding's inequality (e.g., Theorem 2.8 in \cite{BLM13}) and the conditional independence of $(\dataset_1,\simdataset_1),...,(\dataset_m,\simdataset_m)$ given $(\testfunction_1,...,\testfunction_m)$,
\begin{equation}\label{eqn-Hoeffding-1D}
\PP\left( \coverage(\bar{k}) \ge \frac{1}{m} \sum_{j=1}^m \PP\Big( \responsebar_j \not\in \simCI_j(\bar{k}) \Big) -  \sqrt{\frac{\log(1/\delta)}{2m}} \right) \ge 1-\delta.
\end{equation}
We now bound $\PP\big( \responsebar_j \not\in \simCI_j(\bar{k}) \big)$. For each $j\in[m]$ and $k\in[K]$,
\[
\ind \left\{ \responsebar_j \not\in \simCI_j(k) \right\}
\ge 
\ind \left\{ \responsebar_j < \mean_{j} \text{ and } \mean_{j} < \min \simCI_j(k) \right\}
+
\ind \left\{ \responsebar_j \ge \mean_{j} \text{ and } \mean_{j} > \max \simCI_j(k) \right\}.
\]
By the conditional independence of $\dataset_j$ and $\simdataset_j$ given $\testfunction_j$,
\begin{align*}
& \PP \Big( \responsebar_j < \mean_{j} \text{ and } \mean_{j} < \min \simCI_j(k) \Big) \\[4pt]
&=
\EE\Big[ \PP \Big( \responsebar_j < \mean_{j} \Bigm| \testfunction_j \Big) \cdot \PP \Big( \mean_{j} < \min \simCI_j(k)  \Bigm| \testfunction_j \Big) \Big] \\[4pt]
&=
\EE\left[ \frac{1}{2} \cdot \PP \Big( \mean_{j} < \min \simCI_j(k)  \Bigm| \testfunction_j \Big) \right] \\[4pt]
&=
\frac{1}{2} \PP\Big( \mean_{j} < \min \simCI_j(k)  \Big).
\end{align*}
Similarly,
\[
\PP \Big( \responsebar_j \ge \mean_{j} \text{ and } \mean_{j} > \max \simCI_j(k) \Big)
=
\frac{1}{2} \PP\Big( \mean_{j} > \max \simCI_j(k) \Big).
\]
Therefore,
\begin{align}
\PP \Big( \responsebar_j \not\in \simCI_j(k) \Big)
&\ge 
\frac{1}{2} \left[ \PP\Big( \mean_{j} < \min \simCI_j(k) \Big) + \PP\Big( \mean_{j} > \max \simCI_j(k) \Big) \right] \notag \\[4pt]
&=
\frac{1}{2} \PP \Big( \mean_{j} \not\in \simCI_j(k) \Big)
=
\frac{1}{2} \PP \Big( \mean \not\in \simCI(k) \Big), \label{eqn-proxy-to-oracle-precise-1D}
\end{align}
where the last equality is due to Assumption \ref{assumption-iid-test-1D}. When the event in \eqref{eqn-Hoeffding-1D} happens,
\begin{align*}
\coverage(\bar{k}) 
&
\ge \frac{1}{m} \sum_{j=1}^m \PP\Big( \responsebar_j \not\in \simCI_j(\bar{k}) \Big) -  \sqrt{\frac{\log(1/\delta)}{2m}} \\[4pt]
&\ge 
\frac{1}{2} \PP \Big( \mean \not\in \simCI(\bar{k}) \Big) -  \sqrt{\frac{\log(1/\delta)}{2m}} \tag{by \eqref{eqn-proxy-to-oracle-precise-1D}} \\[4pt]
&> 
\frac{\alpha}{2}. \tag{by definition of $\bar{k}$}
\end{align*}
This completes the proof.


\subsection{Proof of \Cref{thm-sharpness-1D}}\label{sec-thm-sharpness-1D-proof}

By Hoeffding's inequality (e.g., Theorem 2.8 in \cite{BLM13}) and a union bound, the following happens with probability at least $1-\delta$:
\begin{equation}\label{eqn-sharpness-proof-1}
\coverage(k) \le \frac{1}{m} \sum_{j=1}^m \PP\Big( \bar{y}_j \not\in \simCI_j(k) \Big)  +  \sqrt{\frac{\log(n/\delta)}{2m}}
,\quad \forall k \le \min \bigg\{ n,K,~ \bigg(\frac{C}{5 \Delta}\bigg)^2 \bigg\}
\end{equation}
We now show that the right hand side of \eqref{eqn-sharpness-proof-1} is at most $\alpha/2$ for $m$ large. For all $j\in[m]$ and $k \in [K]$,
\[
\PP \Big( \simresponse_{j} \not\in \simCI_{j}(k) \Big)
= \PP \left(|\simresponse_j -\simresponsebar_{j, k} | > \frac{C}{\sqrt{k}} \right).
\]
Since $\simresponsebar_{j, k} \sim N( \simmean_{j} , 1/k )$ and $\bar\response_j \sim N( \mean_{j}, 1/n )$, then
\[
\simresponse_j -
\simresponsebar_{j, k} 
\sim N \left( 
\mean_{j} - \simmean_{j}
, ~ \frac{1}{k} + \frac{1}{n} \right).
\]
When $k \leq \min \{ n,K,~ (\frac{C}{5 \Delta})^2 \}$, we have
\begin{align*}
\PP \Big( \bar{\response}_{j} \not\in \simCI_{j}(k) \Big) 
&\le \PP \left(
|
(\bar\response_j - \simresponsebar_{j, k} )
- (\mean_{j} - \simmean_{j})
|
+ \varepsilon > \frac{C}{\sqrt{k}}
\right)
\\[4pt]
& = 2 \Phi\left(
- \frac{C / \sqrt{k} - \varepsilon}{\sqrt{ k^{-1} + n^{-1} }}
\right)
\le 
2  \Phi\bigg(
- \frac{4	C / (5 \sqrt{k} )}{\sqrt{ k^{-1} + k^{-1} }}\bigg) \tag{$\Delta\le C/(5\sqrt{k})$} \\[4pt]
&= 2  \Phi \bigg(
- \frac{
2 \sqrt{2}	C 
}{
5
}
\bigg)
= 2  \Phi \bigg(
- \frac{
	4 \sqrt{2}	\Phi^{-1}(1 - \alpha/4)
}{
	5
}
\bigg)
=
2  \Phi \bigg(
\frac{
	4 \sqrt{2}	\Phi^{-1}(\alpha/4)
}{
	5
}
\bigg) < \frac{\alpha}{2}.
\end{align*}
Let
\[
\xi = \frac{\alpha}{2} - 2  \Phi \bigg(
\frac{
	4 \sqrt{2}	\Phi^{-1}(\alpha/4)
}{
	5
}
\bigg),
\]
then $\xi > 0$ and
\begin{equation}\label{eqn-sharpness-proof-2}
\PP \Big(\bar{\response}_{j} \notin \simCI_{j}(k) \Big) \le  \frac{\alpha}{2} - \xi.
\end{equation}

When $m > \log(n / \delta) / (2\xi^2)$, substituting \eqref{eqn-sharpness-proof-2} into \eqref{eqn-sharpness-proof-1} yields that for all $k \le \min\{ n , K, ~ ( \frac{C}{5\Delta})^2 \}$,
\begin{align*}
\coverage(k) 
&\le 
\frac{1}{m} \sum_{j=1}^m \PP\Big( \bar{y}_j \not\in \simCI_j(k) \Big)  +  \sqrt{\frac{\log(n/\delta)}{2m}} \\[4pt]
&<
\left( \frac{\alpha}{2} - \xi \right) + \xi = \frac{\alpha}{2}.
\end{align*}
When this happens, we have $\widehat{k} \ge \min  \{ n , K,~  (\frac{C}{5 \Delta} )^2  \}$. 


\subsection{Proof of \Cref{thm-coverage}}\label{sec-thm-coverage-proof}

We will prove the following stronger guarantee.

\begin{lemma}[Conditional coverage]\label{lem-conditional-coverage}
Consider the setting of \Cref{thm-coverage}. Let $\delta\in(0,1)$. With probability at least $1-\delta$,
\begin{equation}\label{eqn-conditional-coverage}
\PP\Big( \statistic(\testfunction)  \in \simCIalt(\widehat{k}) \Bigm| \widehat{k} \Big) \ge 1 - \alpha - \gamma^{-1} \sqrt{\frac{\log(1/\delta)}{2m}}.
\end{equation}
\end{lemma}

By \Cref{lem-conditional-coverage-1D}, we obtain
\begin{align*}
\PP\Big( \statistic (\testfunction)  \in \simCIalt(\widehat{k}) \Big)
&=
\EE\left[ \PP \Big( \statistic (\testfunction)  \in \simCIalt(\widehat{k}) \Bigm| \widehat{k} \Big) \right] \\[4pt]
&=
\int_0^{\infty} \PP \left( \PP \Big( \statistic (\testfunction)  \in \simCIalt(\widehat{k}) \Bigm| \widehat{k} \Big) > t \right) \,dt \\[4pt]
&\ge 
\int_0^{1-\alpha} \left[ 1 - \exp\left( -2m\gamma^2 (t - (1-\alpha) )^2 \right) \right] \,dt \\[4pt]
&\ge 
1-\alpha - \int_{-\infty}^{1-\alpha} \exp\left( -2m\gamma^2 (t - (1-\alpha) )^2 \right) \,dt \\[4pt]
&\ge 
1-\alpha - \gamma^{-1} \sqrt{\frac{1}{2m}}.
\end{align*}

We now prove \Cref{lem-conditional-coverage}. Define $\varepsilon = \gamma^{-1} \sqrt{\frac{\log(1/\delta)}{2m}} $ and a deterministic oracle sample size
\begin{equation}\label{eqn-oracle-k}
\bar{k} = \inf \left\{ k\in [K] : \PP \Big( \statistic (\testfunction)  \not\in \simCIalt(k) \Big)  
> \alpha + \varepsilon \right\}.
\end{equation}
If $\bar{k} = \inf \emptyset$ does not exist, then there is nothing to prove. Now suppose $\bar{k} \in [K]$ exists. We will prove that with probability at least $1-\delta$, it holds that $L(\bar{k}) > \gamma\alpha$. When this event happens, we have $\widehat{k} < \bar{k}$, which implies $\PP\big( \statistic (\testfunction)  \not\in \simCIalt(\widehat{k}) \bigm| \widehat{k} \big) \le \alpha+\varepsilon$ and thus \eqref{eqn-conditional-coverage}, thanks to the independence of $\widehat{k}$ and $(\testfunction,\simdataset)$.

By Hoeffding's inequality (e.g., Theorem 2.8 in \cite{BLM13}) and the conditional independence of $(\dataset_1,\simdataset_1),...,(\dataset_m,\simdataset_m)$ given $(\testfunction_1,...,\testfunction_m)$,
\begin{equation}\label{eqn-Hoeffding}
\PP\left( \coveragealt(\bar{k}) \ge \frac{1}{m} \sum_{j=1}^m \PP\Big( \CIalt_j \not\subseteq \simCIalt_j(\bar{k}) \Big) -  \sqrt{\frac{\log(1/\delta)}{2m}} \right) \ge 1-\delta.
\end{equation}
We now bound $\PP\big( \CIalt_j \not\subseteq \simCIalt_j(\bar{k}) \big)$. For each $j\in[m]$ and $j\in[K]$,
\[
\ind \left\{ \CIalt_j \not\subseteq \simCIalt_j(k) \right\}
\ge 
\ind \left\{ \statistic (\testfunction_j) \in \CIalt_j \text{ and } \statistic (\testfunction_j) \not\in \simCIalt_j(k) \right\}.
\]
By the conditional independence of $\dataset_j$ and $\simdataset_j$ given $\testfunction_j$,
\begin{align}
\PP \Big( \CIalt_j \not\subseteq \simCIalt_j(k) \Big)
&\ge
\EE\Big[ \PP \Big( \statistic (\testfunction_j) \in \CIalt_j \text{ and } \statistic (\testfunction_j) \not\in \simCIalt_j(k)  \Bigm| \testfunction_j \Big) \Big] \notag \\[4pt]
&=
\EE\Big[ \PP \Big( \statistic (\testfunction_j) \in \CIalt_j \Bigm| \testfunction_j \Big) \cdot \PP \Big( \statistic (\testfunction_j) \not\in \simCIalt_j(k)  \Bigm| \testfunction_j \Big) \Big] \notag \\[4pt]
&\ge
\EE\Big[ \gamma \cdot \PP \Big( \statistic (\testfunction_j) \not\in \simCIalt_j (k) \Bigm| \testfunction_j \Big) \Big] \notag \\[4pt]
&=
\gamma \cdot \PP\Big( \statistic (\testfunction_j) \not\in \simCIalt_j(k)  \Big) \notag \\[4pt]
&=
\gamma \cdot \PP\Big( \statistic (\testfunction)  \not\in \simCIalt(k)  \Big), \label{eqn-proxy-to-oracle-precise}
\end{align}
where the last equality is due to Assumption \ref{assumption-iid-test-1D}. Therefore, when the event in \eqref{eqn-Hoeffding} happens,
\begin{align*}
\coveragealt(\bar{k}) 
&
\ge \frac{1}{m} \sum_{j=1}^m \PP \Big( \CIalt_j \not\subseteq \simCIalt_j(\bar{k}) \Big) -  \sqrt{\frac{\log(1/\delta)}{2m}} \\[4pt]
&\ge 
\gamma \cdot \PP\Big( \statistic (\testfunction)  \not\in \simCIalt(\bar{k}) \Big) -  \sqrt{\frac{\log(1/\delta)}{2m}} \tag{by \eqref{eqn-proxy-to-oracle-precise}} \\[4pt]
&> 
\gamma\alpha. \tag{by definition of $\bar{k}$}
\end{align*}
This completes the proof.