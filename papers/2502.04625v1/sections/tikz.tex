\definecolor{black}{RGB}{23,44,81} % almost black
\definecolor{dark_blue}{RGB}{143,170,220} % dark blue
\definecolor{light_blue}{RGB}{218,227,243} % light blue
\definecolor{lighter_blue}{RGB}{222,235,247} % lighter
\definecolor{orange_yellow}{RGB}{255,192,0} % orange yellow
\definecolor{darker_blue}{RGB}{68,114,196} % darker
\definecolor{orange_red}{RGB}{255,90,17} % orange red


\begin{figure*}
    \centering
    \begin{tikzpicture}
     \tikzstyle{every node}=[font=\footnotesize]
    % grid reference
     % \draw [step=0.5,help lines] (0,-1) grid (17,7);
    % step 1 
    % step 1 底框
    \draw[rounded corners] (-0.5,0.3) rectangle (6,4.3);
    \node[align=left,anchor=north west] at (-0.5, 4.3){\textbf{\normalsize Step 1: Simulating a consonant}\\\textbf{ \normalsize system}};
    % step 1 左框
    \draw  (-0.3,0.8) rectangle (0.7,2.8);
    \node[align=left,anchor=south west] at (-0.2,1.4) {IPA\\chart};
    
    % step 1 'random sample' arrow
     \draw [black, line width=0.1cm, arrows = {-Stealth[length=3mm]}]  (0.75,1.8) -- (1.9,1.8);
    \node[align=left,anchor=south west] at (0.65,1.8) {{\scriptsize randomly}\\{\scriptsize sample}};

    % step 1 右框
    \draw [rounded corners]  (1.9,0.4) rectangle (5.9,3.6);
    % \fill [rounded corners] [light_blue]  (1.9,0.2) rectangle (5.9,3.3);
    
    \node[align=left,anchor=north west] at (1.9,3.6) {\textbf{Selected}\\ \textbf{Initials}};
    \node[align=left,anchor=north west] at (3.3,3.6) {\textbf{Characters}};

    \node[align=left,anchor=north west] at (1.9,2.8) {$I_1$: dz\textipa{\super{w}}};
    \node[align=left,anchor=north west] at (1.9,2.4) {$I_2$: k\textipa{\super{h}}};
    \node[align=left,anchor=north west] at (1.9,2) {$I_3$: x};
    \node[align=center,anchor=north west] at (1.9,1.5) {$\cdots$};
    \node[align=left,anchor=north west] at (1.9,1.1) {$I_m$:\textipa{\textlambda}};

    \node[align=left,anchor=north west] at (3,2.8) {$C_{1_1}, C_{1_2}\cdots C_{1_{n_1}}$};
    \node[align=left,anchor=north west] at (3,2.4) {$C_{2_1}, C_{2_2}\cdots C_{2_{n_2}}$};
    \node[align=left,anchor=north west] at (3,2) {$C_{3_1}, C_{3_2}\cdots C_{3_{n_3}}$};
    \node[align=center,anchor=north west] at (3.3,1.5) {$\cdots$};
    \node[align=left,anchor=north west] at (3,1.1) {$C_{m_1},C_{m_2} \cdots C_{m_{n_m}}$};

    \draw [orange_yellow, line width=0.04cm]  (1.9,2.3) rectangle (5.7,2.8);

    % arrow connecting step1 & 2/3     
    \draw [black, line width=0.1cm, arrows = {-Latex[length=3mm]}]  (6,2.3) -- (6.5,2.3) -- (6.5,3.75) -- (7,3.75);
    \draw [black, line width=0.1cm, arrows = {-Latex[length=3mm]}] (6.5,2.3) -- (6.5,1.05) -- (7,1.05);

    % step 2 底框
    \draw [rounded corners] (7,2.5) rectangle (15,5);
    % \fill [rounded corners][dark_blue]  (7,2.5) rectangle (15,5);
    \node[align=left,anchor=north west] at (7, 5){\textbf{\normalsize Step 2: Deriving character-speller pairs}};
    % step2 左框
    \draw(7.2,2.6) rectangle (10.8,4.4);
    % \fill[light_blue] (7.2,2.6) rectangle (10.8,4.4);
    \node[align=left,anchor=north west] at (7.2, 4.4){\scriptsize (character, \textcolor{darker_blue}{speller})};
    \node[align=left,anchor=west] at (7.2, 3.4){$I_1$};
    % 花括号
    \draw [decorate, line width=0.04cm,
    decoration = {calligraphic brace, 
        raise=-1pt, % 离path的距离
        aspect=0.5, % 控制尖端的位置
        amplitude=3pt % 尖端的凸起高度
    }] (7.7, 2.9) -- (7.7, 3.9);
    
    % \node[rotate = 270, thin] at (7.7, 3.4){$\underbrace{\hspace{1cm}}$};
    \node[align=left,anchor=west] at (7.7, 3.8){\scriptsize $C_{1_i}$, \textcolor{darker_blue}{$C_{1_{i^{\prime}}}$}};
    \node[align=left,anchor=west] at (9, 3.8){w.p. $1-p_{\text{fq}}$};
    \node[align=left,anchor=west] at (7.7, 3.4){\scriptsize $C_{1_j}$, \textcolor{darker_blue}{$C_{k_{j^{\prime}}}$}};
    \node[align=left,anchor=west] at (9, 3.4){w.p. $p_{\text{fq}}$};
    \node[align=left,anchor=west] at (7.7, 3){\scriptsize $\cdots \quad \cdots$};
    \draw [orange_yellow, line width=0.04cm]  (7.3,2.7) rectangle (10.7,4);
    
    % step2 右框 相比左框所有x+=4
    \draw(11.2,2.6) rectangle (14.8,4.4);
    % \fill[light_blue] (11.2,2.6) rectangle (14.8,4.4);
    \node[align=left,anchor=north west] at (11.2, 4.4){\scriptsize (character, \textcolor{darker_blue}{speller})};
    \node[align=left,anchor=west] at (11.15, 3.4){$I_k$};
    % 花括号
    \draw [ decorate, line width=0.04cm,
    decoration = {calligraphic brace, 
        raise=-1pt, % 离path的距离
        aspect=0.5, % 控制尖端的位置
        amplitude=3pt % 尖端的凸起高度
    }] (11.7,2.9) -- (11.7, 3.9);
    
    \node[align=left,anchor=west] at (11.7, 3.8){\scriptsize $C_{k_i}$, \textcolor{darker_blue}{$C_{k_{i^{\prime}}}\quad $}};
    \node[align=left,anchor=west] at (13.1, 3.8){w.p. $1-p_{\text{fq}}$};
    \node[align=left,anchor=west] at (11.7, 3.4){\scriptsize $C_{k_j}$, \textcolor{darker_blue}{$C_{k_{j^{\prime}}}$}};
    \node[align=left,anchor=west] at (13.1, 3.4){w.p. $1-p_{\text{fq}}$};
    \node[align=left,anchor=west] at (11.7, 3){\scriptsize $\cdots \quad \cdots$};
    
    % between left and right
    \node[align=center,anchor=north] at (11,3.7) {$\mathbf{\cdots}$};
    \draw[black, arrows = {-Latex[scale=1]}, line width=0.04cm] (11.5,3.2) arc (360:182:1.4 and 0.6);

    
    % step 3 底框
    \draw [rounded corners] (7,-0.4) rectangle (15.5,2.5);
    % \fill [rounded corners][dark_blue]  (7,-0.4) rectangle (15.5,2.5);
    \node[align=left,anchor=north west] at (7, 2.5){\textbf{\normalsize Step 3: Generating variations}};
    
    % step3 左框
    \draw(7.2,-0.3) rectangle (12,1.9);
    % \fill[light_blue](7.2,-0.3) rectangle (12,1.9);
    \node[align=left,anchor=north west] at (7.2, 1.9){\textbf{Variety 1:}};
    \node[align=left,anchor=west] at (7.2, 1.2){$I_1\colon$dz\textipa{\super{w}}};
    \draw [orange_yellow, line width=0.04cm]  (7.3, 1) rectangle (8.35,1.4);
    
    % arrow p_dia
    \draw [darker_blue, line width=1pt, double distance=5pt, arrows = {-Latex[length=2mm, scale width =2.5]}] (8.4,1.2) -- (9.2,1.2);
    \node[align=left,anchor=west] at (8.35,1.2){$p_{\text{dia}}$};
    
    % vertical arrow noise
    \draw [black, line width=2.5pt, arrows = {-Latex[length=1mm, scale width=2]}] (8.7,0.7) -- (8.7,1.1);
    \node[align=left,anchor=west] at (8.35,1.2){$p_{\text{dia}}$};
     % 椭圆 + noise
    \draw (8.7,0.5) ellipse (0.37 and 0.2);
    % \fill[dark_blue] (8.7,0.5) ellipse (0.37 and 0.2);
    \node[align=center,anchor=west] at (8.25,0.5){noise};
    
    \node[align=left,anchor=west] at (9.15, 1.2){dz};
    
    % flower parenthsis
    \draw [decorate, line width=0.04cm,
    decoration = {calligraphic brace, 
        raise=-2pt, % 离path的距离
        aspect=0.71, % 控制尖端的位置
        amplitude=3pt % 尖端的凸起高度
    }] (9.7,0) -- (9.7, 1.7);
    
    \node[align=left,anchor=north west] at (9.7,1.9){$C_{1_1}$};
    \node[align=left,anchor=north west] at (9.7,1.5){$C_{1_2}$};
    \node[align=left,anchor=north west] at (9.7,1.1){$C_{1_3}$};
    \node[align=left,anchor=north west] at (9.7,0.7){$\cdots$};
    \node[align=left,anchor=north west] at (9.7,0.4){$C_{1_{n_1}}$};

    % arrow p_dia for C_{1_1}
    \draw [darker_blue, line width=1pt, double distance=5pt, arrows = {-Latex[length=2mm, scale width =2.5]}] (10.5, 1.65) -- (11.4, 1.65);
    \node[align=left,anchor=west] at (10.45, 1.65){$p_{\text{char}}$};
    
    % p_char
    \draw [darker_blue, line width=1pt, double distance=5pt, arrows = {-Latex[length=2mm, scale width =2.5]}] (10.5,0.1) -- (11.4,0.1);
    \node[align=left,anchor=west] at (10.45,0.1){$p_{\text{char}}$};
    
    % % vertical arrow noise
    \draw [black, line width=2.5pt, arrows = {-Latex[length=1mm, scale width=2]}] (11,1.1) -- (11,1.5);
    \draw [black, line width=2.5pt, arrows = {-Latex[length=1mm, scale width=2]}] (11,0.6) -- (11,0.2);
     % 椭圆 + noise
    \draw (11,0.85) ellipse (0.37 and 0.2);
    % \fill[dark_blue] (11,0.85) ellipse (0.37 and 0.2);
    \node[align=center,anchor=west] at (10.55,0.85){noise};

    
    \node[align=left,anchor=north west] at (11.4,1.9){ts};
    \node[align=left,anchor=north west] at (11.4,1.5){dz};
    \node[align=left,anchor=north west] at (11.4,1.1){dz};
    \node[align=left,anchor=north west] at (11.4, 0.7){$\cdots$};
    \node[align=left,anchor=north west] at (11.4, 0.4){dz\textipa{\super{j}}};

    \node[align=left,anchor=north west] at (11.9, 1.1){$\cdots$};
    
    % step3 右框
    \draw(12.5,-0.3) rectangle (15.3,1.9);
    % \fill[light_blue](12.5,-0.3) rectangle (15.3,1.9);
    \node[align=left,anchor=north west] at (12.5, 1.9){\textbf{Variety 20:}};
    \node[align=left,anchor=west] at (12.5, 1.2){$I_1\colon$dz\textipa{\super{w}}};

    % arrow p_char
    \draw [darker_blue, line width=1pt, double distance=5pt, arrows = {-Latex[length=2mm, scale width =2.5]}] (14.4,1.2) -- (15.3,1.2);
    \node[align=left,anchor=west] at (14.35,1.2){$p_{\text{char}}$};

    % arrow p_dia
    \draw [darker_blue, line width=1pt, double distance=5pt, arrows = {-Latex[length=2mm, scale width =2.5]}] (13.65,1.2) -- (14.45,1.2);
    \node[align=left,anchor=west] at (13.6,1.2){$p_{\text{dia}}$};
    
    \draw [orange_yellow, line width=0.04cm]  (12.6, 1) rectangle (13.65,1.4);

    % vertical arrow noise
    \draw [black, line width=2.5pt, arrows = {-Latex[length=1mm, scale width=2]}] (14.05,0.7) -- (14.05,1.1);
    
     % 椭圆 + noise
    \draw (14.05,0.5) ellipse (0.37 and 0.2);
    % \fill[dark_blue] (14.05,0.5) ellipse (0.37 and 0.2);
    \node[align=center,anchor=west] at (13.6,0.5){noise};
    
    % vertical arrow noise
    \draw [black, line width=2.5pt, arrows = {-Latex[length=1mm, scale width=2]}] (14.9,0.7) -- (14.9,1.1);
    \draw (14.9,0.5) ellipse (0.37 and 0.2);
    % \fill[dark_blue] (14.9,0.5) ellipse (0.37 and 0.2);
    \node[align=center,anchor=west] at (14.45,0.5){noise};

    \node[align=left,anchor=north west] at (12.5, 0.4){$I_2\colon$k\textipa{\super{h}} $\quad \cdots $};
    
    \end{tikzpicture}
    \caption{Overview of synthesis data.} \label{fig:synthesis-flow}

\end{figure*}





% \begin{figure*}
%     \centering
% % example
% {\scalefont{1}
% \def \globalscale {1}
% \begin{tikzpicture}[y=0.13cm, x=0.13cm,  
%     yscale=\globalscale,xscale=\globalscale, 
%     every node/.append style={scale=\globalscale}, 
%     inner sep=0pt, outer sep=0pt]

%     \node[shift={(5.4299, -19.7115)},anchor=south west] (text1) at (0.0, 39.1583){\textbf{Step 1: Simulating a consonant system}};
    
%     \end{scope}
%     \end{tikzpicture}
%     }
%     \caption{Caption}
% \end{figure*}