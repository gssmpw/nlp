\appendices
\section{Approximation of Spatial Momentum Primitives (Centroidal Pose)}
\label{sec:appendix}


The primitive of the spatial momentum vector (centroidal pose) in terms of generalized coordinate states $\mathbf q, \dot{\mathbf q}$ can expressed as an indefinite integral of $\bm h$:
\begin{equation}
\label{eq:app1}
    \bm H = \int \bm h\:dt= \int \bm A_G\dot{\mathbf q}\: dt 
\end{equation}

We apply integration by parts, 
\begin{equation}
    \int u\:dv = uv - \int v\: du,
\end{equation}

And set,
\begin{equation}
    u = \bm A_G,\quad dv = \dot{\mathbf q}\: dt.
\end{equation}

Then,
\begin{equation}
    du = \dot{\bm A}_G\:dt,\quad v = \int \dot{\mathbf q}\: dt = \mathbf q.
\end{equation}

Hence, substituting into equation (\ref{eq:app1},
\begin{equation}
\begin{aligned}
        \bm H &
        =\bm A_G\mathbf q - \int \biggl( \int \dot{\mathbf q} dt \biggl)\dot{\bm A}_G\:dt + \text{const.}
\end{aligned}
\end{equation}

We apply the Riemann Sum Approximation over a finite number of discrete time steps $k$ from $t_0$ to $t_k$ with step size $\Delta t$:
\begin{equation}
\begin{aligned}
        \int^{t_k}_{t_0}\bm h\: dt \approx
        \bm A_G\mathbf q - \sum^{k-1}_{i = 0} \dot{\bm A}_G\mathbf q_i\:\Delta t
\end{aligned}
\end{equation}
\vspace{0.5cm}




\section{Analytic IK Solution of 5-DoF Legs with Line-foot}
In this appendix, we present the detailed analytical solution derivation of the 5-DoF leg inverse kinematics (IK) for fast computation. Fig. \ref{fig:leg} shows the kinematic tree. The default zero-joint-angle configuration is when the leg is straight (no knee-bend) with the foot perpendicular to the leg.

\begin{figure}[h!]
    \includegraphics[clip, trim=-5cm 5.2cm 13cm 0.3cm, width=1\columnwidth]{figures/5dof_leg.pdf}
    \caption{Kinematic Definition of 5-DoF Leg with Line-foot.}
    \label{fig:leg}
\end{figure}

To efficiently map end-effector position $\bm p_f \in \mathbb R^3$ to the corresponding feasible joint positions $\bm q \in \mathbb R^5$, we use additional orientation constraints during the computation of the IK, such that the foot pitch and yaw angles are always zeros w.r.t. the body, $R_{f,y} = 0$, and $R_{f,z} = 0$. Due to the kinematic design of this leg, these additional orientation constraints can be mapped directly to yaw joint $q_0$ and ankle pitch joint $q_4$, such that

\begin{equation}
    q_0^\text{des} = 0,
\end{equation}
\begin{equation}
    q_4^\text{des} = - q_2^\text{des}- q_3^\text{des}-\theta.
\end{equation}

The rest of the joint position $\{q_1,\:q_2,\:q_3\}$ can be mapped to $\bm p_f^\text{des}$ with kinematic geometry, where,

\begin{equation}
    q_1^\text{des} = \arcsin({\frac{r^\text{des}_z}{r^\text{des}_{1,yz}}}) + \arcsin({\frac{s_j\:r_{21,y}}{r^\text{des}_{1,yz}}}),
\end{equation}
\begin{equation}
    q_2^\text{des} = \arccos({\frac{r^\text{des}_{1,xz}}{2l}})- s_j \cdot \arccos({\frac{r^\text{des}_{2,yz}}{r^\text{des}_{1,xz}}}),
\end{equation}
\begin{equation}
    q_3^\text{des} = 2\arcsin({\frac{r^\text{des}_{1,xz}}{2l}})- \pi,
\end{equation}
where the kinematic parameter $r_{21,y}$ is the y-direction distance between joint location $\bm p_2$ and $\bm p_1$. 
$\bm r^\text{des}_{1}$ is the leg frame distance vector from the desired foot position to the roll joint,
\begin{equation}
    \bm r^\text{des}_{1} = R^\intercal\bm p_f^\text{des}-\bm p_1,
\end{equation}
where $\bm p_1$ in body frame can be obtained from the CoM position and the distance vector between CoM and joint 1 $\bm r_{c1}$,
\begin{equation}
    \bm p_1 = R^\intercal(\bm p_c - \bm r_{c1}),
\end{equation}

$r^\text{des}_{1,yz}$ is the absolute distance of $\bm r^\text{des}_{1}$ along y-z plane,
\begin{equation}
    r^\text{des}_{1,yz} = \sqrt{(r^\text{des}_{1,y})^2+(r^\text{des}_{1,z})^2}
\end{equation}

$r^\text{des}_{2,yz}$ is the absolute distance from foot to thigh pitch joint,  
\begin{equation}
    r^\text{des}_{2,yz} = \sqrt{(r^\text{des}_{1,yz})^2+r_{21,y}^2}
\end{equation}

$r^\text{des}_{2,xz}$ is the absolute distance from foot to thigh pitch joint along x-z plane,
\begin{equation}
    r^\text{des}_{1,xz} = \sqrt{(r^\text{des}_{1,x})^2+(r^\text{des}_{1,y})^2+(r^\text{des}_{1,z})^2 - r_{21,y}^2}
\end{equation}
\vspace{0.2cm}

\section {Physical and Control Parameters}
In this Appendix, we provide all the physical parameters of the robots and the tuning parameters of the controllers used. 

\begin{table}[H]
	\vspace{-0.1cm}
	\centering
        \caption{2-D Bipedal Robot}
	\begin{tabular}{cccc}
		\hline
		Parameter & Symbol & Value & Units\\
		\hline
		Mass & $m$    & 10.0 & $\unit{kg}$  \\
		  Body MoI  & $\bm I_{yy}$  & 0.15 & $\unit{kg}\cdot \unit{m}^2$ \\
		Leg Lengths & $l_1$    & 0.22 & 
          $\unit{m}$  \\
          & $l_2$    & 0.22 & $\unit{m}$  \\
		\hline 
	\end{tabular}
	\vspace{0.2cm}
\end{table}	
\clearpage

\begin{table}[H]
	\vspace{0.2cm}
	\centering
        \caption{3-D Humanoid Robot}
	\begin{tabular}{cccc}
		\hline
		Parameter & Symbol & Value & Units\\
		\hline
		Mass & $m$    & 16.00 & $\unit{kg}$  \\
		Body MoI  & $\bm I_{xx}$  & 0.069 & $\unit{kg}\cdot \unit{m}^2$ \\
		& $\bm I_{yy}$ & 0.058  & $\unit{kg}\cdot \unit{m}^2$ \\
		& $\bm I_{zz}$ & 0.007  & $\unit{kg}\cdot \unit{m} ^2$ \\
		Leg Lengths & $l_1$    & 0.22 & 
          $\unit{m}$  \\
          & $l_2$    & 0.22 & $\unit{m}$  \\
		 Foot Length & $l_{f}$    & 0.15 & $\unit{m}$  \\
		\hline 
	\end{tabular}
    \vspace{0.2cm}
\end{table}	


\begin{table}[H]
	\vspace{0.2cm}
	\centering
	\caption{2-D Gait-Net-Augmented  Kino-dynamic MPC Control Parameters (Sim)}
	\begin{tabular}{ccc}
	\hline
	Parameter & Symbol & Value \\
	\hline
	Prediction length & $h$  &  10 \\
        Swing phase & $h'$ & 5 \\
        Step size & $dt$  &  0.03 - 0.06 s \\
        Friction coef. & $\mu$  &  0.7 \\
        Max. force & $f_\text{max}$  &  250 N \\
        Min. force & $f_\text{min}$  &  10 N \\
        Max. Torque & $\tau_\text{max}$ & 33.5 Nm / 67 Nm (knee)\\
        Control weights & $\bm L_1^{\bm h}$  &  $[20, 20, 20]$ \\
        & $\bm L_1^{\bm H}$ & $[200, 200, 300]$ \\
        & $\bm L_1^{\bm {p}_f}$ & $[0.01, 0.01]$ \\
        & $\bm L_1^{\bm {p}_c}$ & $[100, 300]$ \\
        & $\bm L_2^{\bm f}$ & $[0.0001, 0.0001]$ \\
	\hline 
	\end{tabular}
	\vspace{0.2cm}
\end{table}	

% \subsubsection{MATLAB/Simulink Simulation 3-D}
% We then summarize the control parameters used in controlling the 3-D humanoid robot in Simulink Simulation. 

\begin{table}[H]
	\vspace{0.2cm}
	\centering
	\caption{3-D Whole-body MPC Control Parameters (Sim)}
	\begin{tabular}{ccc}
	\hline
	Parameter & Symbol & Value \\
	\hline
	Prediction length & $h$  &  10 \\
        Swing phase & $h'$ & 5 \\
        Step size & $dt$  &  0.045 - 0.07 s \\
        Friction coef. & $\mu$  &  0.7 \\
        Max. force & $f_\text{max}$  &  500 N \\
        Min. force & $f_\text{min}$  &  10 N \\
        Max. Torque & $\tau_\text{max}$ & 33.5 Nm / 67 Nm (knee)\\
        Control weights & $\bm Q_1^{\bm q_\text{fb}}$  &  $[100, 100, 100, 150, 150, 250]$ \\
        & $\bm Q_1^{\bm q_{\text{j},i}}$  &  $[50,50,50,50,50]$ \\
        & $\bm Q_2^{i}$ & $[0.001, 0.001, 0.001, 0.001, 0.001]$ \\
        & $\bm Q_3^{\bm f}$ & $[0.0001, 0.0001, 0.0001]$ \\
        & $\bm Q_3^{\bm \tau}$ & $[0.001, 0.001, 0.001]$ \\
        & $\bm Q_4^{\dot{\bm q}_\text{fb}}$  &  $[1, 1, 1, 1, 1, 5]$ \\
        & $\bm Q_4^{\dot{\bm q}_{\text{j},i}}$  &  $[1,1,1,1,1]$ \\
	\hline 
	\end{tabular}
	\vspace{0.2cm}
\end{table}	

\begin{table}[H]
	\vspace{0.2cm}
	\centering
	\caption{3-D Explicit Kino-dynamic MPC Control Parameters (Sim)}
	\begin{tabular}{ccc}
	\hline
	Parameter & Symbol & Value \\
	\hline
	Prediction length & $h$  &  10 \\
        Swing phase & $h'$ & 5 \\
        Step size & $dt$  &  0.045 - 0.07 s \\
        Friction coef. & $\mu$  &  0.7 \\
        Max. force & $f_\text{max}$  &  500 N \\
        Min. force & $f_\text{min}$  &  10 N \\
        Max. Torque & $\tau_\text{max}$ & 33.5 Nm / 67 Nm (knee)\\
        Control weights & $\bm R_1$  &  $[10, 10, 10, 20, 20, 20]$ \\
        & $\bm R_2^{\bm q_\text{fb}}$  &  $[100, 100, 100, 150, 150, 250]$ \\
        & $\bm R_2^{\bm q_{\text{j},i}}$  &  $[50,50,50,50,50]$ \\
        & $\bm R_2^{\dot{\bm q}_\text{fb}}$  &  $[1, 1, 1, 1, 1, 5]$ \\
        & $\bm R_2^{\dot{\bm q}_{\text{j},i}}$  &  $[1,1,1,1,1]$ \\
        & $\bm R_2^{\bm f}$ & $[0.00001, 0.00001, 0.00001]$ \\
        & $\bm R_2^{\bm \tau}$ & $[0.0001, 0.0001, 0.0001]$  \\
	\hline 
	\end{tabular}
	\vspace{0.2cm}
\end{table}	

\begin{table}[H]
	\vspace{0.2cm}
	\centering
	\caption{3-D Gait-Net-Augmented Kino-dynamic MPC Control Parameters (Sim)}
	\begin{tabular}{ccc}
	\hline
	Parameter & Symbol & Value \\
	\hline
	Prediction length & $h$  &  10 \\
        Swing phase & $h'$ & 5 \\
        Step size & $dt$  &  0.045 - 0.07 s \\
        Friction coef. & $\mu$  &  0.7 \\
        Max. force & $f_\text{max}$  &  500 N \\
        Min. force & $f_\text{min}$  &  10 N \\
        Max. Torque & $\tau_\text{max}$ & 33.5 Nm / 67 Nm (knee)\\
        Control weights & $\bm L_1^{\bm h}$  &  $[10, 10, 10, 10, 10, 10]$ \\
        & $\bm L_1^{\bm H}$  &  $[200, 200, 200, 200, 200, 200]$ \\
        & $\bm L_1^{\bm p_{f,i}}$ & $[0.1, 0.1, 0.1]$ \\
        & $\bm L_1^{\bm p_{c}}$ & $[100, 100, 250]$ \\
        & $\bm L_2^{\bm f}$ & $[0.0001, 0.0001, 0.0001]$ \\
        & $\bm L_2^{\bm \tau}$ & $[0.001, 0.001, 0.001]$ \\
	\hline 
	\end{tabular}
	\vspace{0.2cm}
\end{table}	

\begin{table}[H]
	\vspace{0.2cm}
	\centering
	\caption{3-D Gait-Net-Augmented Kino-dynamic MPC Control Parameters (Hardware)}
	\begin{tabular}{ccc}
	\hline
	Parameter & Symbol & Value \\
	\hline
	Prediction length & $h$  &  10 \\
        Swing phase & $h'$ & 5 \\
        Step size & $dt$  &  0.045 - 0.07 s \\
        Friction coef. & $\mu$  &  0.7 \\
        Max. force & $f_\text{max}$  &  500 N \\
        Min. force & $f_\text{min}$  &  10 N \\
        Max. Torque & $\tau_\text{max}$ & 33.5 Nm / 67 Nm (knee)\\
        Control weights & $\bm L_1^{\bm h}$  &  $[5, 5, 5, 1, 1, 1]$ \\
        & $\bm L_1^{\bm H}$  &  $[400, 400, 400, 300, 300, 300]$ \\
        & $\bm L_1^{\bm p_{f,i}}$ & $[0.1, 0.1, 0.1]$ \\
        & $\bm L_1^{\bm p_{c}}$ & $[400, 400, 500]$ \\
        & $\bm L_2^{\bm f}$ & $[0.00001, 0.00001, 0.00001]$ \\
        & $\bm L_2^{\bm \tau}$ & $[0.0001, 0.0001, 0.0001]$ \\
	\hline 
	\end{tabular}
	\vspace{0.2cm}
\end{table}	

\begin{table}[H]
	\vspace{0.2cm}
	\centering
	\caption{Gait-Net-Augmented Sequential CMPC Solver Parameters}
	\begin{tabular}{ccc}
	\hline
	Parameter & Symbol & Value \\
	\hline
	Max. iterations & $j_\text{max}$  &  50 \\
        Position tolerance & $\eta^\text{pos}$ & 0.00001 \\
        Force tolerance & $\eta^{f}$  &  0.01 \\
        Moment tolerance & $\eta^\tau$  &  0.001 \\
	\hline 
	\end{tabular}
	\vspace{0.2cm}
\end{table}	