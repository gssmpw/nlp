\begin{algorithm}
\caption{Dynamic Programming for Join Order Optimization With Cross-Products}
\label{alg:dp-join-order}
\begin{algorithmic}[1]
\Require relations $R = \{r_1, r_2, \dots, r_n\}$, selectivities $S$
\Ensure optimal left-deep join tree in $\text{dp\_table}[R]$
\State initialize $\text{dp\_table}$
\For{$r \in R$}
    \State $\text{dp\_table}[\{r\}] \gets r$ \Comment{Base case: single relation}
\EndFor
\For{$s = 2 \ \mathbf{ to } \ |R|$} \Comment{Size of subsets from 2 to $n$}
    \For{$\text{subset} \subseteq R$ such that $|\text{subset}| = s-1$}
        \If{$\text{subset} \in \text{dp\_table}$}
            \For{$r \in R \setminus \text{subset}$} \Comment{Relations not in subset}
                \State $T_1 \gets \text{dp\_table}[\text{subset}]$
                \State $T_2 \gets \text{dp\_table}[\{r\}]$
                \State $\text{T}, \text{T\_cost} \gets \text{create\_join\_tree}(T_1, T_2, R, S)$
                \State $\text{join\_key} \gets \text{subset} \cup \{r\}$
                \If{$\text{join\_key} \notin \text{dp\_table}$}
                    \State $\text{dp\_table}[\text{join\_key}] \gets T$ \Comment{Update if key not in table}
                \EndIf
                \If{$\text{join\_key} \in \text{dp\_table}$}
                    \State $\text{prev\_cost} \gets \textbf{cost}(\text{dp\_table}[\text{join\_key}], R, S)$
                    \If{$\text{T\_cost} < \text{prev\_cost}$}
                        \State $\text{dp\_table}[\text{join\_key}] \gets T$ \Comment{Update if lower cost}
                    \EndIf
                \EndIf
            \EndFor
        \EndIf
    \EndFor
\EndFor
\end{algorithmic}
\end{algorithm}