\subsection{Evaluating \textrm{Precise 2} formulation}

The key idea behind the Precise 2 formulation is to tackle larger join order optimization cases because the validity constraints are more efficient regarding the number of higher-order terms. We include the exact poly solver results to demonstrate that this formulation encodes precisely the correct plans. For the other solvers, we only show results that optimized larger queries compared to the previous Presice 1 method.

First, the results from the exact poly solver in Fig.~\ref{fig:precise_2_exact_poly_solver} demonstrate that this algorithm follows the bounds of Theorem \ref{thm:dp_bound}. In practice, the returned plans are again very close to the optimal plans. We can also see that compared to the Precise 1 method, the different sets of validity constraints work equally well.

\begin{figure*}[tbh]
    \centering
    \includegraphics[width=\textwidth]{results/precise_2_exact_poly_solver.png}
    \caption{Precise 2 results using the D-Wave's exact poly solver}
    \label{fig:precise_2_exact_poly_solver}
    \Description[Precise 2 results using the D-Wave's exact poly solver]{}
\end{figure*}

% Graph Graph with 3 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0}
% graph type: clique
% Graph Graph with 3 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0}
% graph type: cycle
% Graph Graph with 4 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000000000000002, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0000000000000002}
% graph type: star
% Graph Graph with 5 nodes and 4 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000040588404762, 'Dynamic programming w/o cross-products': 1.000004058840476, 'Greedy w/o cross-products': 1.0000040588404762}
% graph type: star

Second, to evaluate the Gurobi solver, we scaled up the problem sizes remarkably from the Precise 1 method, although the experiments were performed on a standard laptop. The results are presented in Fig.~\ref{fig:precise_2_gurobi_1} and Fig.~\ref{fig:precise_2_gurobi_2}. We can see that finding the point that minimizes both cost and validity constraints becomes harder when the problem sizes increase. %The results remain close to optimal, with cost summed over multiple runs. However, even one suboptimal round can significantly impact the total cost and accuracy, so the results demonstrate solid performance considering the demanding evaluation setup.

\begin{figure*}[tbh]
    \centering
    \includegraphics[width=\textwidth]{results/precise_2_gurobi_1.png}
    \caption{Precise 2 results using Gurobi solver}
    \label{fig:precise_2_gurobi_1}
    \Description[Precise 2 results using Gurobi solver]{}
\end{figure*}

% Graph Graph with 3 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0}
% graph type: clique
% Graph Graph with 3 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0}
% graph type: clique
% Graph Graph with 3 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0}
% graph type: cycle
% Graph Graph with 3 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0}
% graph type: cycle
% Graph Graph with 4 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000000000000002, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0000000000000002}
% graph type: star
% Graph Graph with 5 nodes and 4 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000040588404762, 'Dynamic programming w/o cross-products': 1.000004058840476, 'Greedy w/o cross-products': 1.0000040588404762}
% graph type: star
% Graph Graph with 6 nodes and 5 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000021564508312, 'Dynamic programming w/o cross-products': 1.0000011116483463, 'Greedy w/o cross-products': 1.0000011116483465}
% graph type: star
% Graph Graph with 4 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000000000000002, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0000000000000002}
% graph type: star
% Graph Graph with 5 nodes and 4 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000040588404762, 'Dynamic programming w/o cross-products': 1.000004058840476, 'Greedy w/o cross-products': 1.0000040588404762}
% graph type: star

\begin{figure*}[tbh]
    \centering
    \includegraphics[width=\textwidth]{results/precise_2_gurobi_2.png}
    \caption{Precise 2 results using Gurobi solver}
    \label{fig:precise_2_gurobi_2}
    \Description[Precise 2 results using Gurobi solver]{}
\end{figure*}

Slightly unexpectedly, the Leap Hybrid solver did not perform as well as we expected, as shown in Fig.~\ref{fig:precise_2_dwave_LeapHybridSampler}. The solver does not have tunable hyperparameters, which we would be able to adjust to obtain better results. On the other hand, we used the developer access to the solver, which is limited to only one minute of quantum computing access per month. Finally, we did not include the results from the D-wave quantum solver due to space limitations since the solver did not scale to these cases. %It provided new results only for the Star-6 query graph with $7.07\%$ larger plans over 20 query graphs than the optimal ones.

\begin{figure*}[tbh]
    \centering
    \includegraphics[width=\textwidth]{results/precise_2_dwave_LeapHybridSampler.png}
    \caption{Precise 2 results using D-Wave's Leap Hybrid solver}
    \label{fig:precise_2_dwave_LeapHybridSampler}
    \Description[Precise 2 results using D-Wave's Leap Hybrid solver]{}
\end{figure*}

% Graph Graph with 3 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0}
% graph type: clique
% Graph Graph with 3 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0}
% graph type: clique
% Graph Graph with 3 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0}
% graph type: cycle
% Graph Graph with 3 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0}
% graph type: cycle
% Graph Graph with 4 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000000000000002, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0000000000000002}
% graph type: star
% Graph Graph with 5 nodes and 4 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000141364642996, 'Dynamic programming w/o cross-products': 1.000004058840476, 'Greedy w/o cross-products': 1.0000040588404762}
% graph type: star
% Graph Graph with 6 nodes and 5 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000247692741169, 'Dynamic programming w/o cross-products': 1.0000011116483463, 'Greedy w/o cross-products': 1.0000011116483465}
% graph type: star
% Graph Graph with 4 nodes and 3 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000000000000002, 'Dynamic programming w/o cross-products': 1.0, 'Greedy w/o cross-products': 1.0000000000000002}
% graph type: star
% Graph Graph with 5 nodes and 4 edges is not included in the chart.
% costvalues: {'Q-Join: Presice 2': 1.0000177876393395, 'Dynamic programming w/o cross-products': 1.000004058840476, 'Greedy w/o cross-products': 1.0000040588404762}
% graph type: star