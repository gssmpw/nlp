\section{Problem statement and scope}
\label{sec:problem}

Fig.~\ref{fig:scenario} shows a typical Smart Home setup with a smart lamp that can be controlled by a smartphone application (called \emph{companion app} in the following).
The possible network activities in this setup are highly device specific.
The device might communicate directly with the companion app in the local home network, or do this via a manufacturer or vendor-operated cloud server (the latter making it also possible to control the device from outside the home network and to receive firmware updates). In fact, many of the devices on the market have both local and remote communication capabilities.

\input{figures/tikz/smart-home-example.tex}

In line with existing work on profiling discussed in Section~\ref{sec:related-work}, we assume that the network activity is triggered by an interaction with the Smart Home device. The aim of our work is to obtain a profile, i.e., a description of the network communication patterns associated to that device and interaction. We argue that existing approaches on device profiling, that mostly consist in performing the interaction and recording the resulting network activity, are not sufficient to observe all possible communications patterns.
Indeed, we expect that some of them only appear when the default (or configured) patterns fail or are disturbed. Our goal is to discover such patterns in an automated way.

The solution that we will present in the next sections requires the collection, inspection and filtering of packets sent to and received from the Smart Home device and the device running the companion app. If the traffic is unencrypted, we leverage its payload. We do not analyze or modify the device firmware, the companion app, or the server side software. We also do not try to decrypt network traffic, therefore we do not consider information in encrypted payload. However, numerous research has shown than relying on unencrypted information and packet or flow metadata, can already provide sufficient information to accurately fingerprint IoT devices \cite{homesnitch, ping-pong, wan_iotathena_2022}. 

Similarly to related research works, we only consider IP traffic, either wired or wireless.
Other protocols exist for Smart Home devices, such as Zigbee \cite{zigbee} and Thread \cite{thread}
over IEEE 802.15.4 \cite{802-15-4}, or the proprietary Z-Wave \cite{z-wave}. Such protocols usually rely on a gateway or hub to connect to the local home network. For devices using these protocols, we profile the gateway's IP traffic.
Devices that rely on long-range communication technologies, such as 5G or LoRaWAN \cite{lorawan}, are not in the scope of this paper since their traffic cannot be locally filtered or blocked.

Finally, it should be mentioned that devices also communicate for reasons other than being triggered by interactions. Examples include periodic heartbeat messages or messages to discover the local network \cite{mazhar_characterizing_2020, behaviot}. A possible approach to profile such activities is to passively monitor the device over a longer period and extract the traffic using periodicity models \cite{behaviot}.
Our approach does not pursue such communication activities further, as in this paper we focus on the more complex case of interaction-triggered communication patterns.


% \subsection{Threat model}

% As our work's incentive is to enhance the security of smart home networks,
% we first provide the threat model against which our event profiles are supposed to protect.

% We focus on malicious traffic which deviates from the typical operating behavior of the monitored devices.
% %, either going towards or coming from those.
% The two main scenarios are the following:
% \begin{itemize}
%   \item An attacker, whether inside or outside the local network, who issues traffic towards a device,
% in order to disrupt it (e.g. DoS) or compromise it (e.g. to exfiltrate private user data).
%   \item A compromised device, inside the LAN, issues traffic towards other devices in the LAN (e.g. to compromise other devices by spreading a worm) or towards the Internet (e.g. to communicate with an external server belonging to the attacker).
% \end{itemize}

% In line with related work,
% we assume that, during the "generation" phase of the event profiles,
% our devices are exempt from malicious traffic.
% Once our profiles have been generated and enforced,
% malicious traffic covered by the threat model would be detected and blocked.
