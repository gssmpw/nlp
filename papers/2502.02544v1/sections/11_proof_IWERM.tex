\section{Proof of~\texorpdfstring{\cref{Prop:IW-ERM}}{reference}\label{app:IWERM}}


In the following, we consider four typical scenarios under various distribution shifts described in~\Cref{app:tab:scenario} and formulate their IW-ERM with a focus on minimizing $R_1$.

\subsection{No Intra-node Label Shift} 
\label{No-LS}
For simplicity, we assume that there are only 2 nodes, but our results can be extended to multiple nodes. 
This scenario assumes $p_k^{\text{tr}}(\boldsymbol{y})=p_k^{\text{te}}(\boldsymbol{y})$ for $k=1,2$, but $p_1^{\text{tr}}(\boldsymbol{y}) \neq p_2^{\text{tr}}(\boldsymbol{y})$.
Node 1 aims to learn $h_{\boldsymbol{w}}$ assuming $\frac{p_1^{\text{tr}}(\boldsymbol{y})}{p_2^{\text{tr}}(\boldsymbol{y})}$ is given. We consider the following IW-ERM that is consistent in minimizing $R_1$:

\begin{align}\label{IWERM:nocovar}
\begin{split}
\min_{h_{\boldsymbol{w}} \in \mathcal{H}} &\frac{1}{n_1^{\text{tr}}}\sum_{i=1}^{n_1^{\text{tr}}}\ell(h_{\boldsymbol{w}}(\boldsymbol{x}_{1,i}^{\text{tr}}),\boldsymbol{y}_{1,i}^{\text{tr}}) \\
&+\frac{1}{n_2^{\text{tr}}}\sum_{i=1}^{n_2^{\text{tr}}}\frac{p_1^{\text{tr}}(\boldsymbol{y}_{2,i}^{\text{tr}})}{p_2^{\text{tr}}(\boldsymbol{y}_{2,i}^{\text{tr}})}\ell(h_{\boldsymbol{w}}(\boldsymbol{x}_{2,i}^{\text{tr}}),\boldsymbol{y}_{2,i}^{\text{tr}}).
\end{split}
\end{align}

Here $\mathcal{H}$ is the hypothesis class of $h_{\boldsymbol{w}}$. This scenario is referred to as {\tt No-LS}.

\subsection{Label Shift only for Node 1} 
\label{LSonsingle}
Here we consider label shift only for node 1, i.e., $p_1^{\text{tr}}(\boldsymbol{y})\neq p_1^{\text{te}}(\boldsymbol{y})$ and $p_2^{\text{tr}}(\boldsymbol{y})= p_2^{\text{te}}(\boldsymbol{y})$.
We consider the following IW-ERM:
\begin{align}\label{IWERM:covar1}
\begin{split}
\min_{h_{\boldsymbol{w}} \in \mathcal{H}}&  \frac{1}{n_1^{\text{tr}}}\sum_{i=1}^{n_1^{\text{tr}}} \frac{p_1^{\text{te}}(\boldsymbol{y}_{1,i}^{\text{tr}})}{p_1^{\text{tr}}(\boldsymbol{y}_{1,i}^{\text{tr}})}\ell(h_{\boldsymbol{w}}(\boldsymbol{x}_{1,i}^{\text{tr}}),\boldsymbol{y}_{1,i}^{\text{tr}}) \\
&+\frac{1}{n_2^{\text{tr}}}\sum_{i=1}^{n_2^{\text{tr}}} \frac{p_1^{\text{te}}(\boldsymbol{y}_{2,i}^{\text{tr}})}{p_2^{\text{tr}}(\boldsymbol{y}_{2,i}^{\text{tr}})}\ell(h_{\boldsymbol{w}}(\boldsymbol{x}_{2,i}^{\text{tr}}),\boldsymbol{y}_{2,i}^{\text{tr}}).
\end{split}
\end{align}
This scenario is referred to as {\tt LS on single}.

\subsection{Label shift for both nodes} 
\label{LSonboth}
Here we assume $p_1^{\text{tr}}(\boldsymbol{y})\neq p_1^{\text{te}}(\boldsymbol{y})$ and $p_2^{\text{tr}}(\boldsymbol{y})\neq p_2^{\text{te}}(\boldsymbol{y})$, i.e., label shift for both nodes.
The corresponding IW-ERM is the same as Eq.~\Cref{IWERM:covar1}. This scenario is referred to as {\tt LS on both}.

Without loss of generality and for simplicity, we set $l = 1$. We consider four typical scenarios under various distribution shifts and formulate their IW-ERM with a focus on minimizing $R_1$. The details of these scenarios are summarized in \cref{app:tab:scenario}.

\subsection{Multiple Nodes} 
\label{LSonmulti}
Here we consider a general scenario with $K$ nodes. We assume both intra-node and inter-node label shifts by the following IW-ERM:
\begin{align}\label{IWERM:gen}
\min_{h_{\boldsymbol{w}} \in \mathcal{H}} \sum_{k=1}^K \frac{1}{n_k^{\text{tr}}}\sum_{i=1}^{n_k^{\text{tr}}} \frac{p_1^{\text{te}}(\boldsymbol{y}_{k,i}^{\text{tr}})}{p_k^{\text{tr}}(\boldsymbol{y}_{k,i}^{\text{tr}})}\ell(h_{\boldsymbol{w}}(\boldsymbol{x}_{k,i}^{\text{tr}}),\boldsymbol{y}_{k,i}^{\text{tr}}),
\end{align} 
This scenario is referred to as {\tt LS on multi}. 

For the scenario without intra-node label shift, the IW-ERM in~\cref{IWERM:nocovar} can be expressed as

\begin{align}\label{equ1} 
\begin{split}
\frac{1}{n_2^{\text{tr}}}\sum_{i=1}^{n_2^{\text{tr}}}& \frac{p_1^{\text{tr}}(\boldsymbol{y}_{2,i}^{\text{tr}})}{p_2^{\text{tr}}(\boldsymbol{y}_{2,i}^{\text{tr}})}\ell(h_{\boldsymbol{w}}(\boldsymbol{x}_{2,i}^{\text{tr}}),{\boldsymbol{y}}_{2,i}^{\text{tr}})\\
&\xrightarrow{n_2^{\text{tr}}\rightarrow \infty}
\E_{p_2^{\text{tr}}(\boldsymbol{x},\boldsymbol{y})} \left[\frac{p_1^{\text{tr}}(\boldsymbol{y})}{p_2^{\text{tr}}(\boldsymbol{y})}\ell(h_{\boldsymbol{w}}(\boldsymbol{x}),\boldsymbol{y}) \right] \\
&= \int_{\mathcal{Y}}\frac{p_1^{\text{tr}}(\boldsymbol{y})}{p_2^{\text{tr}}(y)}\E_{p(\boldsymbol{x}|\boldsymbol{y})}[\ell(h_{\boldsymbol{w}}(\boldsymbol{x}),\boldsymbol{y})]p_2^{\text{tr}}(\boldsymbol{y}){d}\boldsymbol{y})  \\
&= \int_{\mathcal{Y}}p_1^{\text{tr}}(\boldsymbol{y})\E_{p(\boldsymbol{x}|\boldsymbol{y})}[\ell(h_{\boldsymbol{w}}(\boldsymbol{x}),\boldsymbol{y})]{d}\boldsymbol{y}\\
&= \int_{\mathcal{Y}}p_1^{\text{te}}(\boldsymbol{y})\E_{p(\boldsymbol{x}|\boldsymbol{y})}[\ell(h_{\boldsymbol{w}}(\boldsymbol{x}),\boldsymbol{y})]{d}\boldsymbol{y}\\
&= \E_{p_1^{\text{te}}(\boldsymbol{x},\boldsymbol{y})} \left[\ell(h_{\boldsymbol{w}}(\boldsymbol{x}),\boldsymbol{y}) \right]\\
&= R_1(h_{\boldsymbol{w}}).
\end{split}
\end{align}

where the second equality holds due to the assumption of the label shift setting and Bayes' theorem: $p(\boldsymbol{x},\boldsymbol{y})=p(\boldsymbol{x}|\boldsymbol{y})\cdot p(\boldsymbol{y})$, and the fourth equality holds by the assumption that $p_1^{\text{tr}}(\boldsymbol{y})=p_1^{\text{te}}(\boldsymbol{y})$ in the No-LS setting.


For the scenario with label shift only for Node 1 or for both nodes, the IW-ERM in~\cref{IWERM:covar1} admits
\begin{align}
\frac{1}{n_2^{\text{tr}}}\sum_{i=1}^{n_2^{\text{tr}}}& \frac{p_1^{\text{te}}(\boldsymbol{y}_{2,i}^{\text{tr}})}{p_2^{\text{tr}}(\boldsymbol{y}_{2,i}^{\text{tr}})}\ell(h_{\boldsymbol{w}}(\boldsymbol{x}_{2,i}^{\text{tr}}),\boldsymbol{y}_{2,i}^{\text{tr}})\\
&\xrightarrow{n_2^{\text{tr}}\rightarrow \infty}
\E_{p_2^{\text{tr}}(\boldsymbol{x},\boldsymbol{y})} \left[\frac{p_1^{\text{te}}(\boldsymbol{y})}{p_2^{\text{tr}}(\boldsymbol{y})}\ell(h_{\boldsymbol{w}}(\boldsymbol{x}),\boldsymbol{y}) \right]\\
&= \int_{\mathcal{Y}}\frac{p_1^{\text{te}}(y)}{p_2^{\text{tr}}(y)}\E_{p(\boldsymbol{x}|\boldsymbol{y})}[\ell(h_{\boldsymbol{w}}(\boldsymbol{x}),\boldsymbol{y})]p_2^{\text{tr}}(\boldsymbol{y}){d}\boldsymbol{y}\\
&= \int_{\mathcal{Y}}p_1^{\text{te}}(y=\boldsymbol{y})\E_{p(\boldsymbol{x}|\boldsymbol{y})}[\ell(h_{\boldsymbol{w}}(\boldsymbol{x}), \boldsymbol{y})]{d}\boldsymbol{y}\\
&= \E_{p_1^{\text{te}}(\boldsymbol{x},\boldsymbol{y})} \left[\ell(h_{\boldsymbol{w}}(\boldsymbol{x}),\boldsymbol{y}) \right]\\
&= R_1(h_{\boldsymbol{w}}). 
\end{align}


For multiple nodes, let $k\in[K]$. Similarly, we have 
\begin{align}
\frac{1}{n_k^{\text{tr}}}\sum_{i=1}^{n_k^{\text{tr}}} \frac{p_1^{\text{te}}(\boldsymbol{y}_{k,i}^{\text{tr}})}{p_k^{\text{tr}}(\boldsymbol{y}_{k,i}^{\text{tr}})}\ell(h_{\boldsymbol{w}}(\boldsymbol{x}_{k,i}^{\text{tr}}),\boldsymbol{y}_{k,i}^{\text{tr}})&\xrightarrow{n_k^{\text{tr}}\rightarrow \infty}
 R_1(h_{\boldsymbol{w}}). 
\end{align}
Then we have 
\begin{align}
    \sum_{k=1}^K \frac{1}{n_k^{\text{tr}}}\sum_{i=1}^{n_k^{\text{tr}}} \frac{p_1^{\text{te}}(\boldsymbol{y}_{k,i}^{\text{tr}})}{p_k^{\text{tr}}(\boldsymbol{y}_{k,i}^{\text{tr}})}\ell(h_{\boldsymbol{w}}(\boldsymbol{x}_{k,i}^{\text{tr}}),\boldsymbol{y}_{k,i}^{\text{tr}})\xrightarrow{n_1^{\text{tr}},\ldots,n_K^{\text{tr}}\rightarrow \infty}
 R_1(h_{\boldsymbol{w}}).
\end{align}
Note that to solve~\cref{IWERM:gen}, node 1 needs to estimate $\frac{p_1^{\text{te}}(\boldsymbol{y})}{p_k^{\text{tr}}(\boldsymbol{y})}$ for all nodes $k$ in~\Cref{IWERM:gen}. 


The consistency of~\cref{IWERM:gen;R}, i.e., convergence in probability, is  followed the standard arguments in e.g.,~\citep{shimodaira2000improving}[Section 3] and~\citep{sugiyama2007covariate}[Section 2.2] using the law of large numbers.
