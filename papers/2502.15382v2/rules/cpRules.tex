\newcommand*{\RuleCpExpr}[1][paper]{
\labelinferrule{CpExpr}{#1}{}{
\Braces{\texttt{(\kwepexpr{} $r$; $E$)}} = \Braces{E}_r
}
}

\newcommand*{\RuleCpExprSkip}[1][paper]{
\labelinferrule{CpExprSkip}{#1}{}{
{\begin{array}{r}
\Braces{\texttt{(\kwepexpr{} $\alpha$; $E$)}}_r = \texttt{true} \\
\textrm{if $\textsf{sort}(\alpha) \neq \textsf{sort}(r)$}
\end{array}}
} 
}

\newcommand*{\RuleCpAssign}[1][paper]{
\labelinferrule{CpAssign}{#1}{}{
\Braces{\texttt{$r$: $H_{loc}$ := $H_v$;}} = \texttt{$\Braces{H_{loc}}_r$ = $\Braces{H_v}_r$;}
}
}

\newcommand*{\RuleCpIf}[1][paper]{
\labelinferrule{CpIf}{#1}{}{
{
\Braces{\texttt{if ($H$) $S_{\kwtrue{}}$ $S_{\kwfalse{}}$}} = \begin{array}{l}
\texttt{\{~assert \textsf{unanimous}$(H)$;} \\
\texttt{~~if ($\Braces{H}$) $\Braces{S_{\kwtrue{}}}$ $\Braces{S_{\kwfalse{}}}$ \}}
\end{array}
}
} 
}

\newcommand*{\RuleCpWhile}[1][paper]{
\labelinferrule{CpWhile}{#1}{}{
{
\begin{array}{l}
\Braces{\texttt{loop\_invariant $R_{inv}$; while ($H_{cond}$) $S$}} = \\
\hspace{0.45cm}\texttt{loop\_invariant $\textsf{unanimous}(R_{inv})$ \&\& $\Braces{R_{inv}}$;} \\
\hspace{0.45cm}\texttt{while ($\Braces{H_{cond}}$) $\Braces{S}$}
\end{array}
}
}
}

\newcommand*{\RuleCpMethodCall}[1][paper]{
\labelinferrule{CpMethodCall}{#1}{}{
{
\begin{array}{l}%
\Braces{
\texttt{endpoint $r$: $H$.$m$();}
} = \chormemprojection[H]{r}.\chormemprojection[m\texttt{()}]{r};
%\\
%\hspace{0.3cm}\texttt{\{ exhale $\Braces{\textsf{pre}(m, r)}_{r}$;} \\
%\hspace{0.3cm}\texttt{~~inhale $\Braces{\textsf{post}(m, r)}_{r}$; \}} \\
\end{array}
}
}
}

\newcommand*{\RuleCpComm}[1][paper]{
\labelinferrule{CpComm}{#1}{}{
{
\begin{array}{l}
\Braces{
\begin{array}{l}
\texttt{channel\_invariant $R_I(\kwmsg{}, \; \kwsender{}, \; \kwreceiver{})$;} \\
\texttt{communicate $r$: $H_{msg}$ -> $p$: $H_{dst}$;}
\end{array}
} = \\[7.5pt]% Little bit of spacing
\hspace{0.6cm}\texttt{\{ $T$ $v$ = $\Braces{H_{msg}}_{r}$;} \\
\hspace{0.6cm}\texttt{~~exhale $\Braces{R_I(v, \; r, \; p)}_{r}$;} \\
\hspace{0.6cm}\texttt{~~inhale $\Braces{R_I(v, \; r, \; p)}_{p}$;} \\
\hspace{0.6cm}\texttt{~~$\Braces{H_{dst}}_p$ = v; \}}
\end{array}
}
}
}

\newcommand*{\RuleCpCommOneLine}[1][paper]{
\labelinferrule{CpComm}{#1}{}{
{
\Braces{
\begin{array}{l}
\texttt{channel\_invariant $R_I(\kwmsg{}, \; \kwsender{}, \; \kwreceiver{})$;} \\
\texttt{communicate $r$: $H_{msg}$ -> $p$: $H_{dst}$;}
\end{array}
} = {\begin{array}{l}
\texttt{\{ $T$ $v$ = $\Braces{H_{msg}}_{r}$; exhale $\Braces{R_I(v, \; r, \; p)}_{r}$;} \\
\texttt{~~inhale $\Braces{R_I(v, \; r, \; p)}_{p}$; $\Braces{H_{dst}}_p$ = v; \}}
\end{array}}
}
}
}

\newcommand*{\RuleCpExprRange}[1][paper]{
\labelinferrule{CpExprRange}{#1}{}{
{
\begin{array}{l}
\Braces{\texttt{(\kwepexpr{} $F$[$i$ := $E_l$ .. $E_h$]; $E$)}} = \\
\hspace{0.3cm}\texttt{(\kwforall{} int $i$ = $E_l$ .. $E_h$; $\Braces{E}_{\kwfi}$)}
\end{array}
}
}
}

\newcommand*{\RuleCpExprIndex}[1][paper]{
\labelinferrule{CpExprIndex}{#1}{}{
{
\begin{array}{l}
\Braces{\texttt{(\kwepexpr{} $F$[$j$ := $E_l$ .. $E_h$]; $E(j)$)}}_\kwfi{} = \\
\hspace{0.6cm}\texttt{$E_l$ <= $i$ \&\& $i$ < $E_h$ ==> $\Braces{E(i)}_\kwfi{}$}
\end{array}
}
}
}

\newcommand*{\RuleCpMethodCallRange}[1][paper]{
\labelinferrule{CpMethodCallRange}{#1}{}{
{
\begin{array}{l}%
\Braces{
\texttt{endpoint $F$[$i$ := $E_l$ .. $E_h$]: $F$[$i$].$m$();}
} = \\
\hspace{0.6cm}\texttt{par (int $i$ = $E_l$ .. $E_h$)} \\
\hspace{0.9cm}\texttt{requires $\Braces{\textsf{pre($m$, \kwfi{})}}_{\kwfi{}}$;} \\
\hspace{0.9cm}\texttt{ensures $\Braces{\textsf{post($m$, \kwfi{})}}_{\kwfi{}}$;} \\
\hspace{0.6cm}\texttt{\{ $\Braces{\texttt{endpoint \kwfi{}: \kwfi{}.$m$();}}$ \}}
\end{array}
}
}
}

\newcommand*{\RuleCpCommRange}[1][paper]{
\labelinferrule{CpCommRange}{#1}{}{
{
\begin{array}{l}
\Braces{
\begin{array}{l}
\texttt{channel\_invariant $R_I(\kwmsg{}, \kwsender{}, \kwreceiver{})$;} \\
\texttt{communicate $F$[$i$ := $E_l$ .. $E_h$]: $F$[$i$].$f$ -> $G$[$d(i)$]: $G$[$d(i)$].$g$;}
\end{array}
} = \\[7.5pt]% Little bit of spacing
\hspace{0.6cm}\texttt{assert (\kwforall{} int i, j = $E_l$ .. $E_h$; $d(\texttt{i})$ == $d(\texttt{j})$ ==> i == j);}\\  
\hspace{0.6cm}\texttt{par (int $i$ = $E_l$ .. $E_h$)}\\
\hspace{0.9cm}\texttt{context $\Braces{\texttt{Perm($F$[$i$].$f$, $\epsilon$)}}_{\famidx{F}{i}}$ ** $\Braces{\texttt{Perm(\famidx{G}{d(i)}.$g$, 1)}}_\famidx{G}{d(i)}$;} \\
\hspace{0.9cm}\texttt{requires $\Braces{R_I(\texttt{$F$[$i$].$f$}, \; \kwfi{}, \; \famidx{G}{d(i)})}_{\famidx{F}{i}}$;} \\
\hspace{0.9cm}\texttt{ensures $\Braces{R_I(\texttt{\famidx{G}{d(i)}.$g$}, \; \kwfi{}, \; \famidx{G}{d(i)})}_\famidx{G}{d(i)}$;} \\
\hspace{0.6cm}\texttt{\{~$T$ $v$ = $\Braces{\texttt{$F$[$i$].$f$}}_\kwfi$;} \\
\hspace{0.6cm}\texttt{~~exhale $\Braces{R_I(v, \; \texttt{$F$[$i$]}, \; \texttt{$G$[$d(i)$]})}_\kwfi$;} \\
\hspace{0.6cm}\texttt{~~inhale $\Braces{R_I(v, \; \kwfi{}, \; \famidx{G}{d(i)})}_\famidx{G}{d(i)}$;} \\
\hspace{0.6cm}\texttt{~~$\Braces{\texttt{$\famidx{G}{d(i)}$.$g$}}_\famidx{G}{d(i)}$ = v; \}}
\end{array}
}
}
}
