\newcommand*{\RuleEpAssign}[1][paper]{
\labelinferrule{EpAssign}{#1}{}{
\denote{\texttt{$e$: $H_{loc}$ := $H_v$;}}_e = \texttt{$H_{loc}$ = $H_v$;}
}
}

\newcommand*{\RuleEpAssignSkip}[1][paper]{
\labelinferrule{EpAssignSkip}{#1}{}{
\denote{\texttt{$e$: $H_{loc}$ := $H_v$;}}_r = \texttt{\braces{}}
}
}

\newcommand*{\RuleEpSend}[1][paper]{
\labelinferrule{EpSend}{#1}{}{
{
\begin{array}{l}
\denote{\texttt{$L$: communicate $a$: $H_{msg}$ -> $b$: $H_{dst}$;}}_a^{send} = \\
\hspace{0.3cm} \texttt{$\denote{L}_a$.writeValue($H_{msg}$) with \{} \\
\hspace{0.6cm} \texttt{sender = $a$; receiver = $b$; \};}
\end{array}
}
}
}

\newcommand*{\RuleEpReceive}[1][paper]{
\labelinferrule{EpReceive}{#1}{}{
{
\begin{array}{l}
\denote{\texttt{$L$: communicate $a$: $H_{msg}$ -> $b$: $H_{dst}$;}}_b^{receive} = \\
\hspace{0.3cm} \texttt{$H_{dst}$ = $\denote{L}_b$.readValue() with \{} \\
\hspace{0.6cm} \texttt{sender = $a$; receiver = $b$; \};}
\end{array}
}
}
}

\newcommand*{\RuleEpComm}[1][paper]{
\labelinferrule{EpComm}{#1}{}{
{\begin{array}{l}
\denote{
\begin{array}{ll}
\texttt{$L$:} & \texttt{channel\_invariant $R_{inv}$;} \\
              & \texttt{communicate $\alpha$: $H_{msg}$ -> $\beta$: $H_{dest}$;} \\
\end{array}
}_r = \\[10pt]
\hspace{0.7cm}\denote{\texttt{$L$: communicate $\alpha$: $H_{msg}$ -> $\beta$: $H_{dst}$;} \;}^{send}_r \texttt{;} \\
\hspace{0.7cm}\denote{\texttt{$L$: communicate $\alpha$: $H_{msg}$ -> $\beta$: $H_{dst}$;} \;}^{receive}_r \texttt{;} 
\end{array}}
}
}

\newcommand*{\RuleEpCommSkip}[1][paper]{
\labelinferrule{EpCommSkip}{#1}{}{
{\begin{array}{r}
\denote{
\texttt{$L$: communicate $\alpha$: $H_{msg}$ -> $\beta$: $H_{dst}$;}
}^-_r = \texttt{\{\}} \\
\textrm{if $\textsf{sort}(\alpha)$, $\textsf{sort}(\beta)$, $\textsf{sort}(r)$ pairwise distinct}
\end{array}}
}
}

\newcommand*{\RuleEpExpr}[1][paper]{
\labelinferrule{EpExpr}{#1}{}{
\denote{\texttt{(\textbackslash{}endpoint $e$; $E$)}}_e = E
}
}

\newcommand*{\RuleEpExprSkip}[1][paper]{
\labelinferrule{EpExprSkip}{#1}{}{
{
\begin{array}{r}
\denote{\texttt{(\textbackslash{}endpoint $\alpha$; $E$)}}_r = \texttt{true} \\
\textrm{if $\textsf{sort}(\alpha) \neq \textsf{sort}(r)$}
\end{array}
}
}
}

\newcommand*{\RuleEpExprIndex}[1][paper]{
\labelinferrule{EpExprIndex}{#1}{}{
{ % Wrap in braces, otherwise array wont work
% See also: https://gist.github.com/lambdageek/075ea17f362bc455467a
\begin{array}{l}
\denote{
\texttt{(\textbackslash{}endpoint \famidx{F}{E_i}; $E$)}
}_\kwfi = \texttt{$i$ == $E_i$ ==> $E$}
\end{array}
}
}
}

\newcommand*{\RuleEpRange}[1][paper]{
\labelinferrule{EpRange}{#1}{}{
{
\denote{
\texttt{(\textbackslash{}endpoint $F$[$j$ := $E_l$ .. $E_h$]; $E$)}
}_\kwfi = \texttt{$E_l$ <= $i$ \&\& $i$ < $E_h$ ==> $E$}
}
}
}

\newcommand*{\RuleEpAnd}[1][paper]{
\labelinferrule{EpAnd}{#1}{}{
\denote{
\texttt{$E_1$ \&\& $E_2$}
}_r = \texttt{$\denote{E_1}_r$ \&\& $\denote{E_2}_r$}
}
}

\newcommand*{\RuleEpChor}[1][paper]{
\labelinferrule{EpChor}{#1}{}{
\denote{
\texttt{(\textbackslash{}chor $E$)}
}_r = \texttt{true}
}
}

\newcommand*{\RuleEpIf}[1][paper]{
\labelinferrule{EpIf}{#1}{}{
\denote{\texttt{if ($H$) $S_{true}$ $S_{false}$}}_r = \texttt{if ($\denote{H}_r$) $\denote{S_{true}}_r$ $\denote{S_{false}}_r$}
}
}

\newcommand*{\RuleEpWhile}[1][paper]{
\labelinferrule{EpWhile}{#1}{}{
{
\begin{array}{l}
\denote{\texttt{loop\_invariant $R_{i}$; while ($H$) $S$}}_r = \\
\hspace{0.3cm}\texttt{loop\_invariant $\denote{R_{i}}_r$; while ($\denote{H}_r$) $\denote{S}_r$}
\end{array}
}
}
}

\newcommand*{\RuleEpIndexSend}[1][paper]{
\labelinferrule{EpIndexSend}{#1}{}{
{\begin{array}{l}
\denote{\texttt{$L$: communicate $F$[$E_j$]: $H_{msg}$ -> $r$: $H_{dst}$;}}_\kwfi^{send} = \\
\hspace{0.3cm} \texttt{if ($i$ == $E_j$) \{}\\
\hspace{0.6cm} \texttt{$\denote{L}_\kwfi$.writeValue($\denote{H_{msg}}_\kwfi$) with \{} \\
\hspace{0.9cm} \texttt{sender = $F$[$i$]; receiver = $r$; \}; \}}
\end{array}}
}
}

\newcommand*{\RuleEpIndexReceive}[1][paper]{
\labelinferrule{EpIndexReceive}{#1}{}{
{\begin{array}{l}
\denote{\texttt{$L$: communicate $r$: $H_{msg}$ -> $F$[$E_j$]: $H_{dst}$}}_\kwfi^{receive} = \\
\hspace{0.3cm} \texttt{if ($i$ == $E_j$) \{}\\
\hspace{0.6cm} \texttt{$\denote{H_{dst}}_\kwfi$ = $\llbracket L \rrbracket_\kwfi$.readValue() with \{} \\
\hspace{0.9cm} \texttt{sender = $r$; receiver = $F$[$i$]; \}; \}}
\end{array}}
}
}

\newcommand*{\RuleEpRangeSend}[1][paper]{
\labelinferrule{EpRangeSend}{#1}{}{
{\begin{array}{l}
\denote{
\texttt{$L$: communicate $F$[$j$: $E_l$ .. $E_h$].$f$ -> $G$[$d(j)$].$g$}
}_\kwfi^{send} = \\
\hspace{0.3cm} \texttt{if ($E_l$ <= $i$ \&\& $i$ < $E_h$) \{}\\
\hspace{0.6cm} \texttt{$\denote{L}_{\famidx{F}{i}}$[$i$].writeValue($F$[$i$].$f$) with \{} \\
\hspace{0.9cm} \texttt{sender = $F$[$i$]; receiver = $G$[$d(i)$]; \}; \}}
\end{array}}
}
}

\newcommand*{\RuleEpRangeReceive}[1][paper]{
\labelinferrule{EpRangeReceive}{#1}{}{
{\begin{array}{l}
\denote{
\texttt{$L$: communicate $F$[$j$: $E_l$ .. $E_h$].$f$ -> $G$[$d(j)$].$g$}
}_{\famidx{G}{i}}^{receive} = \\
\hspace{0.3cm} \texttt{if ($E_l$ <= $d^{-1}(i)$ \&\& $d^{-1}(i)$ < $E_h$) \{}\\
\hspace{0.6cm} \texttt{\famidx{G}{i}.$g$ = $\denote{L}_{\famidx{G}{i}}$[$d^{-1}(i)$].readValue() with \{} \\
\hspace{0.9cm} \texttt{sender = $F$[$d^{-1}(i)$]; receiver = $G$[$i$]; \}; \}}
\end{array}}
}
}