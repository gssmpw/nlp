\chapter{Results and Analysis}{\label{ch:results}}
% \section{Side Investigations}
To test the score follower, we collected a range of recordings of different pieces, varying in style, performer ability and instrument. We have largely avoided pieces with heavy use of \gls{sustain pedal} for the reasons explained in \hyperref[section:stage_2_results]{section \ref*{section:stage_2_results}}. Screen recordings of the first minute of each of these pieces being score-followed are hosted in the \verb|results| folder of the project repository.\footnote{\href{https://github.com/josephinecowley/Score-follower}{https://github.com/josephinecowley/Score-follower}} We have included the terminal window in our recordings, since this displays all input parameters at the beginning of each test, which is useful for repeating results. Furthermore, the terminal continually prints the log probabilities of notes so that results can be numerically analysed.

\subsubsection{\textit{Solfeggietto (H 220, Wq. 117: 2)} by C. P. E. Bach (anonymous performer)}
\textit{Solfeggietto} is a largely \gls{monophonic} piano piece. The performance of the follower was impressive, keeping up with the moderately fast, constant \gls{semiquaver} passages while never deviating more than one semiquaver from the true score location. Despite the performer in the recording not sustaining the left-hand notes in \gls{bars} 16 for their full duration, the score follower was nonetheless able to follow accurately using the other notes.  

\subsubsection{\textit{Minuet in G major, BWV Anh. 114} by J. S. Bach (anonymous performer)}
\textit{Minuet in G} is a simple two-part piano piece. Even after the addition of a second part, the follower succeeded in the first half of the piece. Despite getting lost due to the omission of a left hand note, the score follower was ultimately able to recover by the end of the piece. Furthermore, it was never more than one bar behind, which is roughly sufficient for many applications (including automatic page turningâ€” refer to \hyperref[subsection:APT]{subsection \ref*{subsection:APT}}).  It was necessary to set the \verb|sustain| parameter to \verb|True| since there were locations (such as bar 2) where notes in the left hand were sustained whilst the right hand changed. Without $\verb|sustain|=\verb|True|$, the score follower fails. 

\subsubsection{\textit{O Haupt voll Blut und Wunden} from \textit{St Matthew Passion Mvt. 54 BWV 244} by J. S. Bach, arranged for keyboard (played by author)}
\textit{O Haupt voll Blut und Wunden} is a 4-part German traditional hymn. We have used a Bach keyboard arrangement which preserves its 4-part \gls{homophonic} \gls{texture}. Despite this texture and a moderate amount of pedal, the score follower succeeded without significant error.

\subsubsection{\textit{Syrinx, L. 129} by Claude Debussy (played by Emmanuel Pahud)}
\textit{Syrinx} is a solo flute piece. Although the GP model was designed for the piano, we use this recording to test its performance on a range of instruments. The following of this piece was highly accurate, showing the flexibility of the GP model. For this piece, which has high \gls{rhythm}ic freedom and therefore lots of rubato and many fermatas (i.e. pauses), we disabled the \verb|state_duration| mode, as the false assumption of locally constant tempo caused the follower to `get lost'. We have included this second test as an example of the limitations of our state duration model. In that recording the score follower gets especially lost in bar 4 due to the rapidly fluctuating tempo.

\subsubsection{\textit{Allemande} from \textit{Partita in A minor for solo flute, BWV 1013} by J. S. Bach, arranged for oboe (played by Bernice Lee)}
\textit{Allemande, BWV 1013,} is a solo flute work, though here we use a performance on the oboe for a wider range of test cases. The follower primarily achieves its goal, demonstrating the remarkable ability of the follower to keep to performances which exhibits much \gls{rubato}. In the final bar of the recording, however, the follower becomes `lost' due to the added \gls{ornament}. This demonstrates a limitation of such strict followers.  

\subsubsection{\textit{Allemande} from \textit{Partita in D minor No. 2 for Violin, Allemande, BWV 1004} by J. S. Bach (played by Itzhak Perlman)}
\textit{Allemande, BWV 1004,} is a solo violin piece. The program accurately follows the piece, impressively keeping up with Perlman's heavy use of rubato and fast runs of \gls{demisemiquavers}. Despite the fact that the violin produces pitches which are not perfectly in tune, both intentionally due to vibrato and unintentionally due to mistakes (e.g., the highest note in bar 14, which is flat), the score follower was able to match almost all notes accurately.      


% \subsubsection{TODO: Some kind of brass duet would be nice or maybe a clara schumann lied}

\subsubsection{\textit{Adagio and Allegro, Op. 70} by Robert Schumann (played by Christina Bensi)}{\label{subsubsection:Christina}
\textit{Adagio and Allegro} is a duet for piano and horn in F, but we use a performance of a cello-piano duet. As a multi-instrument duet, with a thick piano accompaniment which utilises generous sustain pedal, this piece truly exposes the limits of our current score follower. The follower rarely positions the marker on exactly the right state/note, though in general, it does succeed in `hanging on', at least for the first 12 bars. This demonstrates that even though the score follower may not be positioned on the correct state, it can recover if using a wide enough window in the Windowed Viterbi algorithm. Note that we turned off \verb|state_duration| for this example to show it was truly the GP model and not just the state duration model causing the follower to proceed at the average pace of the underlying tempo. Additionally, we found increasing the model noise, $\sigma_n$, improved the accuracy, since sustain pedal effectively adds noise (as explained in \hyperref[section:stage_2_results]{section \ref*{section:stage_2_results}}).  \\

Besides the Viterbi algorithm allowing recovery to the correct state within a certain window (see \hyperref[subsection:adjusting_viterbi]{section \ref*{subsection:adjusting_viterbi}}), part of the reason the follower could `hang on' was because the underlying \gls{harmonic progression} of the piece changes slower than the individual note states. These notes states are statistically linked to these `higher level states' (i.e. underlying chords and \gls{key}s) which means that the score follower is usually more likely to go to the correct \textit{area}, even if not precisely the right state. Put in terms of music theory, the score follower is able to follow harmonic changes, even when following exact notes is not possible, which mirrors the human score-following techniques explored in \hyperref[subsection:manual_score_following]{subsection \ref*{subsection:manual_score_following}}. An interesting area for future work could be the use of multi-resolution HMMs to capture the hierarchical structure of music across different time scales \cite{Baggenstoss}.    


\section{Key Findings and Limitations}
 These results show that we have built a largely successful score follower, which is capable of following intermediate monophonic, homophonic and 4-part harmony piano pieces. Additionally, despite being modelled for piano, the follower is arguably better at following instruments including the flute, oboe and violin, yielding excellent results. This not only reflects the simpler task of following these one- or few-line instruments with more uniform temporal envelopes, but also the versatility of GPs. On all instruments, the follower adapted impressively well to heavy rubato and changes in tempo.   \\
 
One difficulty is piano with heavy sustain pedal, since it is impossible to predict note sustain lengths. Additionally, the model fails at distinguishing loud note sources from quiet ones (as explored in \hyperref[subsubsection:amplitude]{subsubsection \ref*{subsubsection:amplitude}}), which means that the relatively quiet notes that continue to sound due to sustain pedal continue to be detected. Another limitation is performer embellishment and other deviations from the score. Finally, passages of repeated notes or phrases shorter than the Viterbi window sometimes present issues, since the follower cannot distinguish between instances of repetitions, in better cases exhibiting small jumps, and at worst becoming `lost'. Outside of these challenges, however, the score follower performs impressively.
