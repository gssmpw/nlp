\chapter{Summary and Conclusion}{\label{ch:conclusion}}

\section{Summary}
In Parts I and II of this paper, we defined the problem of score following and outlined the methodology we would use to develop our novel approach to score following using GPs.
Part III gave the statistical models underlying our solution, and in Part IV, we described our implementation and showed that the solution performed highly promisingly. Overall, we have achieved successful score following using Gaussian Processes (GPs), therefore fulfilling the original project goal set out in \hyperref[section:project_goal]{section \ref*{section:project_goal}}. Since the novel work of this paper occurs in chapters 7 - 9, we proceed with a brief summary of each.\\

In \hyperref[ch:model_selection]{chapter \ref*{ch:model_selection}} (Stage 1: \textit{GP Model Specification}), we developed a GP model for the piano, which was both accurate and flexible. This GP model is novel in its use of a Spectral Mixture kernel, which  allows encoding the spectral envelope of pitched instruments. We used empirical optimisation techniques to determine values for the covariance function's hyperparameters. We then used the GP model to build an efficient and stable log marginal likelihood (LML) function of various notes given an audioframe.\\

% This flexibility brought both benefits and drawbacks. Undesirably, it was difficult to decipher between two very similar chords. However, model flexibility meant it could generalise, meaning we could approximate some hyperparameters as constants. Similarly, it meant our model could be extended to other families of instruments. We then coded an efficient and stable log marginal likelihood (LML) function.    \\

In  \hyperref[ch:alignment]{chapter \ref*{ch:alignment}} (Stage 2: \textit{Real-Time Alignment}), we designed a fairly robust algorithm for online score following. This included a `Windowed' Viterbi algorithm, using the LMLs from Stage 1 for the emission probabilities, and a state duration model for the transition probabilities.  \\

Finally, in \hyperref[ch:implementation]{chapter \ref*{ch:implementation}}, we built a powerful product which uses a score and recording (or live performance) to perform score following. This product proved especially effective for un-pedalled piano pieces, for a wide range of textures, and readily adapted to changes in \gls{tempo} and exaggerated \gls{rubato}.  Indeed, in some ways we have exceeded our project goal, since the product could follow other solo instruments, and even displayed the beginnings of score following for complex multi-instrument pieces. The smooth running of the product, which demonstrated low latency and no buffering, proved significant in light of initial scepticism regarding the computational complexity of GPs. This speaks for the careful choice of system architecture and effective use of multiprocessing.\\

Hence, we have successfully provided a proof of concept that GPs can be harnessed as an effective method for score following. Note that by definition this also means that GPs are capable of score alignment, the off-line counterpart of score following (refer to \hyperref[subsection:score_following_v_alignment]{section \ref*{subsection:score_following_v_alignment}}). 


\section{Areas for Future Research}

\subsubsection{Other Instruments and Ensembles}
%Acknowledging the particularly significant challenge of score following for the piano, as well as our impressive results for the violin, oboe and flute, one simple extension to this project would be to develop specific GP models for other instruments. \\

One simple extension to this project would be to develop specific GP models for other instruments. Given the impressive results of our GP model (which was designed for piano) on other instruments, we conjecture that it would be feasible to create such models by adjusting the overtones as well as accounting for new physical effects (e.g., perhaps inharmonicity effects are different on other types of instruments).\\

Then, we could selectively use the different models to simultaneously follow separate parts in pieces with multiple instruments, making each followerâ€™s job simpler, building in robustness, and shifting the focus from stationary single audioframes to melody lines, moving towards a more `human way' of score following (as outlined in \hyperref[section:score_following_approaches]{section \ref*{section:score_following_approaches}}). This approach would therefore make use of \gls{timbre} information, as well as pitch and duration. Of course, methods of source separation would need to be investigated.
% TODO add inharmonicity to glossary?

\subsubsection{Improving Polyphonic Score Following}
The idea in the previous paragraph could be used to tackle the challenge of \gls{polyphonic}, where there are distinct melodies simultaneously playing (e.g., a fugue).   

\subsubsection{Multi-Resolution Hidden Markov Models (MRHMMs)}
As suggested in \hyperref[ch:results]{chapter \ref*{ch:results}}, MRHMMs could be used to encode the hierchical structure of music. As well as musical notes as a low level latent state, \gls{harmonic progression}s could serve as a coarser resolution for the MRHMM \cite{Baggenstoss}. MRHMM segments could be obtained from the score (e.g., guitar tabs) or could be calculated at run time.

\subsubsection{Adaptive Training}
To avoid the extensive pre-processing and training of the models, one interesting area of research could be incorporating adaptive models which optimise hyperparameters in real-time. 

\subsubsection{Related Applications}
The success of this investigation shows the potential that GPs offer in the wider context of Music Information Retrieval (MIR) tasks and more general practical engineering applications. Some ideas include using GPs for tuning and pitch detection, or instrument identification.

% \subsection{Quantitative Evaluation methods}

\section{Final Reflections and Conclusion}
Automatic score following is no easy task, as demonstrated by the lack of uptake among musicians despite substantial research over the last four decades. By contrast, this project represents only a foray into score following over just eight months. However, our results provide a meaningful contribution to the field by showing that GPs are a viable method for statistical inference that fits into existing Bayesian frameworks for score following. Our successful results have highlighted the power and flexibility of GPs and how they can be used in practical engineering applications. Future work, with particular attention to the few key sources of error as well as user experience, could help better utilise the algorithms developed in this project to produce an application suitable for use by amateur and professional musicians alike, from the practice room to the concert hall. 
% and With more time, a better understanding of this score follower's limitations could be achieved, and thus methods for overcoming the few key sources of error could elevate our product to the quality demanded by professional musicians. 
   


\appendix
\begin{appendices}
\chapter{}
% \small
\vspace{-1.8cm}
\setstretch{0.869}
\section{Risk Assessment Retrospective}

Given that the project was entirely computational, risks outlined in the initial hazard assessment were primarily computer based, covering hazards caused by excessive or improper use of computer based equipment, namely eye strain and repetitive stress on the body caused by bad posture and extended periods of writing or coding. In retrospect, these issues were largely avoided by the investment of a monitor at the beginning of the year, and ensuring suitable supporting computer based equipment. 


\section{Log Book}

Throughout this project, we used \href{https://toggl.com/}{Toggl} to record details of progress and hours spent working. Our Toggl report can be accessed on \href{https://drive.google.com/file/d/1Inj8odZ7XiuMx6RSc6DPxtUZ8Bg0fgdk/view?usp=sharing}{Google Drive}. % Also, our Git commit history is available on \href{https://github.com/josephinecowley/Score-follower/commits/main/}{Github}.   


\section{Final Product}

Source code for the score follower developed in this project is available on \href{https://github.com/josephinecowley/Score-follower}{GitHub}. It is designed for use with the adapted score renderer app available \href{https://github.com/josephinecowley/Score-follower/releases/tag/Release}{here}. %which has been adapted to be compatible with our score follower.


\section{Inverse Fourier Transform of Covariance Function}{\label{appendix:iFT}}

\footnotesize
First, define the Fourier transform as $G(f) = \int_{-\infty}^\infty g(t) e^{-j f \tau} \, d\tau $. Note that we  use this form of the Fourier transform to be consistent with \cite{wilson_2013_gaussian}.
The inverse Fourier transform (iFT) of the Gaussian $\phi(f; 0, \sigma)$ is:
\begin{align*} 
k(\tau) 
&= \medint\int_{-\infty}^{\infty} \phi(f)e^{j 2\pi f\tau} \ df \\
&= \mfrac1 {\sigma \sqrt{2\pi}}\medint\int_{-\infty}^{\infty}e^{-\frac{f^2}{2\sigma^2} + j2\pi f\tau} \ df \\
% &= \frac1 {\sigma \sqrt{2\pi}}\medint\int_{-\infty}^{\infty}e^{-\frac{1}{2\sigma^2}(f^2-j4\pi \sigma^2 ft)}  \ df \\
&= \mfrac1 {\sigma \sqrt{2\pi}}\medint\int_{-\infty}^{\infty}e^{-\frac{1}{2\sigma^2} \big[(f-j2\pi \sigma^2 \tau)^2 + 4\pi^2 \sigma^4 \tau^2 \big]} \ df \\
&= \mfrac1 {\sigma \sqrt{2\pi}}\medint\int_{-\infty}^{\infty}e^{-\frac{1}{2\sigma^2}(f-2\pi \sigma^2 \tau)^2 - 2\pi^2 \sigma^2 \tau^2} \ df 
% &= \frac {e^{- 2\pi^2 \sigma^2 t^2}} {\sigma \sqrt{2\pi}}\medint\int_{-\infty}^{\infty}e^{-\frac{1}{2\sigma^2}(f-2\pi \sigma^2 t)^2} \ df 
\\ & \ \ \ \  \text{Let } p = \mfrac{f-2\pi \sigma^2 \tau}{\sqrt 2 \sigma}. \text{ Then } df = \sqrt2 \sigma \  dp. \\
&= \mfrac {e^{- 2\pi^2 \sigma^2 \tau^2}} {\sigma \sqrt{2\pi}}\medint\int_{-\infty}^{\infty} e^{-p^2} \sqrt 2 \sigma \ dp \\
&= \mfrac {e^{- 2\pi^2 \sigma^2 \tau^2}} {\sqrt{\pi}}\medint\int_{-\infty}^{\infty} e^{-p^2} \ dp \\
&= e^{-2\pi^2 \sigma^2 \tau^2} 
\end{align*}
Hence, using the frequency shift property of Fourier transforms: $iFT(\phi(f; m f_q, \sigma^2_f )) =  e^{-2\pi^2 \sigma_f^2\tau^2} e^{2\pi j m f_q \tau}$. Observing the linearity of the Fourier transform, the fact that $cos(x) = \frac{e^{jx} + e^{-jx}}{2}$, and multiplying $f_q$ by the inharmonicity constants $b_{m,f_q}$, we show that the covariance function of \hyperref[equation:frequency]{equation \ref*{equation:frequency}} is: 
\begin{align*}
k(\tau) = e^{-2\pi^2\sigma_f^2 \tau^2} \sum_{q=1}^Q w_q \sum_{m=1}^M E_m \cos(2\pi m f_{q} b_{m,f_q}  \tau) \qed
\end{align*}
\end{appendices}