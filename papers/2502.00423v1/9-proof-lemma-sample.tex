

\subsection{Proof of Lemma \ref{thm:lemma-sample}} \label{sec:proof-lemma-sample}

%We first introduce two standard lemmas  in \cite{boucheronconcentration} which are useful in establish our concentration inequalities.
%
%\begin{lemma}[Symmetrization Lemma]\label{thm:symmetrization}
%	Let $\ba_1, \dots, \ba_n \in \calA$ be independent random vectors and $f\in\calF$ for some function class $\calF$ defined on $\calA$.  We have
%	\begin{equation*}
%		\EE\brackets{\underset{f\in\calF}{\sup}\abs{\sum_{i=1}^n \big(f(\ba_i) - \EE\brackets{f(\ba_i)}\big)}} \le 2\EE\brackets{\underset{f\in\calF}{\sup}\abs{\sum_{i=1}^n \sigma_i\cdot f(\ba_i)}},
%	\end{equation*}
%	where $\sigma_1, \dots, \sigma_n$ are i.i.d. Rademacher random variables that are independent of $\ba_1, \dots, \ba_n$. 
%\end{lemma}
%
%\begin{lemma}[Talagrand's Lemma]\label{thm:Talagrand}
%	Let $\ba_1, \dots, \ba_n \in \calA$ be random samples and $g\in\calG$ for some function class $\calG$ defined on $\calA$. 
%	Let $l_i(\cdot)$ be a $L$-Lipschitz function that satisfy $l_i(0)=0$ and 
%	\begin{equation}
%		\abs{l_i(x) - l_i(x')} \le L\cdot\abs{x-x'},\quad\text{for all}\quad x, x'\in\RR. 
%	\end{equation}
%We have
%	\begin{equation*}
%		\EE_{\bsigma}\brackets{\underset{f\in\calF}{\sup}\abs{\sum_{i=1}^n \sigma_i\cdot [ l_i\circ g(\ba_i)]}} \le 2L\EE_{\bsigma}\brackets{\underset{f\in\calF}{\sup}\abs{\sum_{i=1}^n \sigma_i\cdot g(\ba_i)}} 
%	\end{equation*}
%	where $\sigma_1, \dots, \sigma_n$ are i.i.d. Rademacher random variables that are independent of $\ba_1, \dots, \ba_n$, and $\EE_{\bsigma}$ denotes the expectation taken over $(\sigma_1,\dots, \sigma_n)$. 
%\end{lemma}
	We first prove the first concentration inequality: For some constants $c$ and $C$, with probability at least $1-\frac{c}{\max\{n, d\}^2}$,
	\begin{equation*}
		 \norm{ \frac{1}{n}\sum_{i=1}^n \omega_i(\bgamma^{(t)}) \bx_i ( \bx_i^\top \bbeta_1^* - y_i) 
			- \EE[ \omega_i(\bgamma^{(t)}) \bx_i ( \bx_i^\top \bbeta_1^* - y_i) ] }_\infty \le  C \sqrt{ \frac{\log \max\{n, d\}}{n}},
	\end{equation*}
	which is equivalent to 
	\begin{equation*}
		\max_{j \in [d]} \abs{ \frac{1}{n}\sum_{i=1}^n \omega_i(\bgamma^{(t)}) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i) 
			- \EE[ \omega_i(\bgamma^{(t)}) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i) ] } \le  C \sqrt{ \frac{\log \max\{n, d\}}{n} } .
	\end{equation*}
	Let $\ba_{i} = (\bx_i, y_i, \bz_i)$ and $f(\ba_{i})=\omega(\bgamma^{(t)};\bx_i, y_i, \bz_i) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i)$. 
	Note that $\bgamma^{(t)}$ is independent of $(\bx_i, y_I, \bz_i)$, and thus, given $\bgamma^{(t)}$, the $\{f(\ba_{i})\}$ are i.i.d. sequence $\omega_i(\bgamma)=\omega(\bgamma;\bx_i, y_i, \bz_i)$. Furthermore, since $\abs{f(\ba_i)} \leq \abs{x_{ij}(\bx_i^\top \bbeta_1^* - y_i)}$, we have
	\[\norm{f(\ba_i)-\EE[f(\ba_i)]}_{\psi_{1}} \lesssim \norm{x_{ij}}_{\psi_2}\norm{\bx_i^\top \bbeta_1^* - y_i}_{\psi_{2}} \lesssim \sigma_x^2\norm{\bbeta_1^*-\bbeta_2^*}_2+\sigma_x\sigma < \infty.\]
	By Proposition 5.16 of \cite{vershynin2010introduction}, we have
	\[\Pr\paren{\abs{\sum_{i=1}^n \left(f(\ba_i)-\EE[f(\ba_i)]\right)} > t} \leq 2\exp\brackets{-c'\min\left\{\frac{t^2}{n(C')^2}, \frac{t}{C'}\right\}},\]
	for some constant $c'$ and $C'$. Letting $t = \sqrt{3(C')^2n \log \max\{n, d\}/c'}$ yields that 
	\[\Pr\paren{\abs{\sum_{i=1}^n \left(f(\ba_i)-\EE[f(\ba_i)]\right)} > \sqrt{3(C')^2n \log \max\{n, d\}/c'}} \leq \frac{2}{\max\{n, d\}^3}.\]
	
%By applying Lemmas \ref{thm:symmetrization} and \ref{thm:Talagrand} with $\ba_{i} = (\bx_i, y_i, \bz_i)$, $f(\ba_{i})=\omega(\bgamma^{(t)};\bx_i, y_i, \bz_i) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i)$, $\calF=\{f\}$, $l_i(u)=\omega(\gamma^{(t)}; \bx_i, y_i, \bz_i)u$, $g(\ba_i)=x_{ij}(\bx_i^{\top}\bbeta_1^*-y_i)$, and $\calG=\{g\}$, we obtain
%	\begin{equation*}
%		\begin{aligned}
% \EE\brackets{\abs{\sum_{i=1}^n \left(f(\ba_i)-\EE[f(\ba_i)]\right)} } & \lesssim \EE \brackets{\abs{\sum_{i=1}^n \sigma_if(\ba_i)}}\\
%			& = \EE_{\bx, y, \bz}\EE_{\bsigma}\brackets{\abs{\sum_{i=1}^n \sigma_il_i \circ g(\ba_i)}} \\
%			& \lesssim \EE_{\bx, y, \bz}\EE_{\bsigma} \brackets{\abs{\sum_{i=1}^n \sigma_i g(\ba_i)}}\\
%			&=\EE \brackets{\abs{\sum_{i=1}^n \sigma_i g(\ba_i)}}.
%		\end{aligned}
%	\end{equation*}

%Then we introduce the concentration inequality for suprema of unbounded functions established in \cite{adamczak2008tail}.
%
%\begin{lemma}\label{thm:lemma-tail}
%		Let $\ba_1, \dots, \ba_n \in \calA$ be independent random vectors and let $\mathcal{F}$ be a set of countable real-value functions such that all functions $f \in \mathcal{F}$ are measurable, square-integrable and satisfy $\EE f\left(\ba_i\right)=0$. Moreover, for some $\alpha \in (0, 1]$ and all $i$, $\norm{\sup_{f \in \calF}\abs{f(\ba_i)}}_{\psi_{\alpha}}  < \infty$. Define 
%		\[\Upsilon:=\sup_{f \in \mathcal{F}}\abs{\sum_{i=1}^n f\left(\ba_i\right)},\]
%		and $\sigma_{s}^2=\sum_{i=1}^n \sup_{f \in \mathcal{F}} \EE f^2\left(\ba_i\right)$. Then for all $\eta \in (0, 1)$ and $\delta>0$, there exists a constant $C'=C(\alpha, \eta, \sigma_s)$, such that for all $t>0$, we have
%		\[\mathbb{P}\paren{\Upsilon>(1+\eta)\E \Upsilon +t}< \exp\paren{-\frac{t^2}{2(1+\delta)\sigma_{s}^2}}+3\exp\paren{-\paren{\frac{t}{C'\norm{\max_i\sup_{f\in \calF}\abs{f(\ba_i)}}_{\psi_{\alpha}}}}^{\alpha}}.\]
%\end{lemma}

%\begin{lemma}[\cite{bousquet2003concentration}]	\label{lem:Bousquet}
%	Let $\ba_1, \dots, \ba_n \in \calA$ be independent random vectors. Let $\mathcal{F}$ be a set of countable real-value functions such that all functions $f \in \mathcal{F}$ are measurable, square-integrable and satisfy $\E f\left(\bz_i\right)=0$. Assume $\sup_{f,\bz} f\left(\bz\right) \leq 1$. Define 
%	\[\Upsilon:=\sup_{f \in \mathcal{F}}\sum_{i=1}^n f\left(\bz_i\right).\]
%	If $\sum_{i=1}^n \sup_{f \in \mathcal{F}} \E f^2\left(\bz_i\right) \leq n\sigma^2$, then for all $x>0$, we have
%	\[\mathbb{P}\paren{\Upsilon>\E \Upsilon + \sqrt{2x\paren{n\sigma^2+2\E \Upsilon}}+\frac{x}{3}}< e^{-x}.\]
%\end{lemma}

%\begin{lemma}[Symmetrization Lemma]\label{thm:symmetrization}
%Let $z_1, \cdots, z_n$ be the $n$ independent realization of the random vector $Z\in\calZ$ for some Borel space $\calZ$, and $f\in\calF$ for some function class $\calF$ defined on $\calZ$. 
%For any increasing convex function $h(\cdot)$, we have
%\begin{equation*}
%\EE\brackets{h\paren{\underset{f\in\calF}{\sup}\abs{\sum_{i=1}^n \big(f(z_i) - \EE\brackets{f(Z)}\big)}}} \le \EE\brackets{h\paren{2\underset{f\in\calF}{\sup}\abs{\sum_{i=1}^n b_i\cdot f(z_i)}}},
%\end{equation*}
%where $b_1, \cdots, b_n$ are i.i.d.~Rademacher random variables that are independent of $z_1, \cdots, z_n$. 
%\end{lemma}
%
%\begin{lemma}[Talagrand's Lemma]\label{thm:Talagrand}
%Let $z_1, \cdots, z_n$ be the $n$ independent realization of the random vector $Z\in\calZ$ for some Borel space $\calZ$, and $f\in\calF$ for some function class $\calF$ defined on $\calZ$. 
%Let $l_i(\cdot)$ be a $L$-Lipschitz function that satisfy $l_i(0)=0$ and 
%\begin{equation}
%\abs{l_i(x) - l_i(x')} \le L\cdot\abs{x-x'},\quad\text{for all}\quad x, x'\in\RR. 
%\end{equation}
%For any increasing convex function $h(\cdot)$, we have
%\begin{equation*}
%\EE\brackets{h\paren{\underset{f\in\calF}{\sup}\abs{\sum_{i=1}^n b_i\cdot l_i\circ f(z_i)}}} \le \EE\brackets{h\paren{2L\cdot\underset{f\in\calF}{\sup}\abs{\sum_{i=1}^n b_i\cdot f(z_i)}}} 
%\end{equation*}
%where $b_1, \cdots, b_n$ are i.i.d.~Rademacher random variables that are independent of $z_1, \cdots, z_n$. 
%\end{lemma}
%
%\begin{lemma}[Panchenko's Lemma]\label{thm:Panchenko}
%Suppose that $Z_1$ and $Z_2$ are two random variables that satisfy $\EE\brackets{(Z_1-a)_{+}}\le\EE\brackets{(Z_2-a)_{+}}$ for any $a \in \RR$. 
%Assuming that $ \PP(Z_2 \ge t) \le \Gamma e^{-\gamma t}$ for all $t\ge0$, we have
%\begin{equation*}
%\PP\paren{Z_1\ge t} \le \Gamma e^{1-\gamma t}. 
%\end{equation*}
%\end{lemma}

%\begin{proof}[Proof of Lemma \ref{thm:lemma-sample}]
%We first prove the first concentration inequality: For some constants $c$ and $C$, with probability at least $1-\frac{c^2\log \max\{n, d\}}{\max\{n, d\}^2}$,
%\begin{equation*}
%\sup_{\bgamma} \norm{ \frac{1}{n}\sum_{i=1}^n \omega_i(\bgamma) \bx_i ( \bx_i^\top \bbeta_1^* - y_i) 
%- \EE[ \omega_i(\bgamma) \bx_i ( \bx_i^\top \bbeta_1^* - y_i) ] }_\infty \le  C \sqrt{ \frac{\log \max\{n, d\}}{n}},
%\end{equation*}
%which is equivalent to 
%\begin{equation*}
%\max_{j \in [d]} \sup_{\bgamma}  \abs{ \frac{1}{n}\sum_{i=1}^n \omega_i(\bgamma) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i) 
%- \EE[ \omega_i(\bgamma) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i) ] } \le  C \sqrt{ \frac{\log \max\{n, d\}}{n} } .
%\end{equation*}
%Note that $\omega_i(\bgamma)=\omega(\bgamma;\bx_i, y_i, \bz_i)$. Let $\ba_{i} = (\bx_i, y_i, \bz_i)$,  \[f_{\bgamma}(\ba_{i})=\omega(\bgamma;\bx_i, y_i, \bz_i) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i)-\EE[\omega(\bgamma;\bx_i, y_i, \bz_i) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i)],\] and $\calF=\big\{f_{\bgamma}; \bgamma \in \QQ^{3d}\big\}$. Here we remark that $\bgamma=(\btheta^{\top}, \bbeta_1^{\top}, \bbeta_2^{\top})^{\top} \in \RR^{3d}$, and we first consider $\bgamma \in \QQ^{3d}$, i.e., those $\bgamma$ with rational entries, due to the requirement in Lemma \ref{thm:lemma-tail} that $\calF$ is countable. Note that 
%\[\norm{\sup_{f \in \calF}\abs{f(\ba_i)}}_{\psi_{1}} \lesssim \norm{x_{ij}}_{\psi_2}\norm{\bx_i^\top \bbeta_1^* - y_i}_{\psi_{2}} \lesssim \sigma_x^2\norm{\bbeta_1^*-\bbeta_2^*}_2+\sigma_x\sigma < \infty,\]
%and by the proof of Lemma \ref{thm:lemma-expectation},
%\[\sigma_s^2 = \sum_{i=1}^n \sup_{f \in \mathcal{F}} \EE f^2\left(\ba_i\right) \lesssim n\sigma_x^2\left(\sigma_x^2\norm{\bbeta^*_2-\bbeta^*_1}_2^2+\sigma^2\right).\]
%Furthermore, by Lemma 8.2 in \cite{kosorok2008introduction}, 
%\[\norm{\max_i\sup_{f\in \calF}\abs{f(\ba_i)}}_{\psi_{1}} \lesssim \sqrt{\log (n+1)}\norm{\sup_{f \in \calF}\abs{f(\ba_i)}}_{\psi_{1}}. \]
%Therefore, applying Lemma \ref{thm:lemma-tail} with $t=C\sqrt{n\log \max\{n, d\}}$ for sufficiently large $C$ leads to
%		\[\mathbb{P}\paren{\Upsilon < (1+\eta)\E \Upsilon + C\sqrt{n\log \max\{n, d\}}}>1-\frac{c}{\max\{n, d\}^3},\]
%for some constant $c$.
%
%Then we focus on bounding $\EE[\Upsilon]$. Let $\sigma_1, \cdots, \sigma_n$ be i.i.d.  Rademacher random variables that are independent of $\ba_{i}$, and define $g_i(\bgamma)=\omega(\bgamma;\bx_i, y_i, \bz_i) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i)$. By Lemma \ref{thm:symmetrization},
%\begin{equation*}
%	\begin{aligned}
%		\EE\brackets{\Upsilon}
%		&\lesssim \EE\brackets{\underset{\bgamma}{\sup}\abs{\sum_{i=1}^n \sigma_i\omega(\bgamma;\bx_i, y_i, \bz_i) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i)}}\\
%		& = \EE_{\bx, y, \bz}\EE_{\sigma_1,\dots,\sigma_{n-1}}\EE_{\sigma_n}\brackets{\underset{\bgamma}{\sup}\abs{\sum_{i=1}^n \sigma_i\omega(\bgamma;\bx_i, y_i, \bz_i) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i)}}\\
%		& = \EE_{\bx, y, \bz}\EE_{\sigma_1,\dots,\sigma_{n-1}} \brackets{\frac{1}{2}\underset{\bgamma}{\sup}\abs{u_{n-1}(\bgamma)+g_i(\bgamma)}+\frac{1}{2}\underset{\bgamma}{\sup}\abs{u_{n-1}(\bgamma)- g_i(\bgamma)}}
%	\end{aligned}
%\end{equation*}
%For any $\eps>0$, there exists $\bgamma_1$, $\bgamma_2$ such that $(1-\eps)\underset{\bgamma}{\sup}\abs{u_{n-1}(\bgamma)+g_i(\bgamma)} \leq \abs{u_{n-1}(\bgamma_1)+g_i(\bgamma_1)}$
%where the last inequality follows from applying Lemma \ref{thm:Talagrand} with $l_i(u)=\omega(\bgamma_0;\bx_i, y_i, \bz_i) \cdot u$ where $\bgamma_0=\argmax_{\bgamma} \abs{\sum_{i=1}^n \sigma_i\omega(\bgamma;\bx_i, y_i, \bz_i) x_{ij} ( \bx_i^\top \bbeta_1^* - y_i)}$.

which yields that 
\begin{equation*}
\PP\paren{\max_j\abs{ \frac{1}{n}\sum_{i=1}^n \omega_i^{(t)} x_{ij} ( \bx_i^\top \bbeta_1^* - y_i) 
- \EE[ \omega_i^{(t)} x_{ij} ( \bx_i^\top \bbeta_1^* - y_i) ] } > C\sqrt{\frac{ \log \max\{n, d\}}{n}} } \le \frac{2}{\max\{n, d\}^2}. 
\end{equation*}
where $C=C'\sqrt{3/c'}$.
Similary, the second concentration inequality
\begin{equation*}
\norm{  \frac{1}{n}\sum_{i=1}^n ( \omega_i^{(t)} - p(\bz_i^\top\btheta^{*}) ) \bz_i 
- \EE[ (\omega_i^{(t)} - p(\bz_i^\top\btheta^{*}) ) \bz_i ] }_\infty \le C \sqrt{ \frac{\log \max\{n, d\}}{n} }
\end{equation*}
is equivalent to 
\begin{equation*}
\max_j \abs{  \frac{1}{n}\sum_{i=1}^n ( \omega_i^{(t)} - p(\bz_i^\top\btheta^{*}) ) \bz_i 
- \EE[ (\omega_i^{(t)} - p(\bz_i^\top\btheta^{*}) ) \bz_i ] } \le C \sqrt{ \frac{\log \max\{n, d\}}{n} }.
\end{equation*}
Since 
\begin{equation*}
\norm{( \omega_i^{(t)} - p(\bz_i^\top\btheta^{*}) ) \bz_i }_{\psi_1} \lesssim \norm{ \omega_i^{(t)} - p(\bz_i^\top\btheta^{*})}_{\psi_2} \norm{\bz_i }_{\psi_2}  < \infty,
\end{equation*}
we can similarly establish the desired result. 



