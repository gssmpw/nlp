\section{Upper Bound on the Price of Anarchy}\label{sec:poa}
In this section, we will show that the $\PoA$ for the class of linear multigraphs is bounded above by 2.
We first focus on subgraphs consisting of only two consecutive nodes. This approach allows us to derive certain structural properties that will be instrumental in our proof. Furthermore, we extend the model by allowing a distinct at $s$ that differs from the zero vector, i.e., not all players may be present at $s$ at the beginning. Instead, they arrive according to the schedule dictated by the starting pattern. Formally, players will enter the queue of the first edge of their path at their respective starting times.

In linear multigraphs, the sequence of nodes from $s$ to $d$ is uniquely defined. The strategy of a player in an equilibrium always consists of edges with the shortest latency to the next nodes in the sequence, given the strategy of all players of lower index. The only difference between different equilibria is the choice of the edge to use when multiple edges have the same latency for that player. A policy $\phi(\Gamma,a_s)$ is a mapping that maps a game $\Gamma$ and a starting pattern $a_s$ of the players set at node $s$ to a state of the game that is an equilibrium. 

Our attention will be centered on a specific policy, referred to as the \emph{greedy queue policy} $\hat{\phi}(\Gamma,a_s)$. Under this policy, the players sequentially choose their edges and the current player always opts for an edge with smallest latency. In case of a tie, each player decides for one of these edges with the longest queue. If there are still multiple edges with these properties, we break ties in favor of the edge with the lowest index among these options. We denote the unique strategy vector arising from the greedy queue policy by $\badNash=\hat{\phi}(\Gamma,a_s)$ for any given packet routing game $\Gamma$ and starting pattern $a_s$. 

In the subsequent discussion, we aim to demonstrate that $\badNash$ simultaneously maximizes the arrival times of all players at $d$ and we will bound the difference to an optimal state. To achieve this goal, we start by showing that the greedy queue policy $\badNash=\hat{\phi}(\Gamma,0^n)$ produces the worst completion time in any linear multigraph setting, i.e., $C(\badNash) = \sup_{S \in \Nash} C(S)$ for every $\Gamma$ (Proposition \ref{prop_together}). Afterwards, we will observe that removing edges from a network only enlarges the completion time, when players choose $s-d$ paths according to the greedy queue policy (Lemma \ref{lemma_adding edges}).
This will allow us to bound the $\PoA$ by first fixing an optimal state and, second, deleting all edges from $G$ that are not used in the optimum. The equilibrium in the resulting graph will utilize, at most, the edges that are employed in the optimal state, thereby enabling us to establish an upper bound for the arrival times (Theorem~\ref{satz_PoA2}).

We start by providing three fundamental properties of $\badNash$.
The first one states that the workload on parallel used edges differs by at most one. This can be used to show the second property that the greedy queue policy maximizes the individual arrival times in a single-layer network. The third lemma guarantees that a pointwise smaller starting pattern will never worsen the completion time of any player with the greedy queue policy.

\begin{restatable}{lemma}{lemmaAli}\label{lemma_ali}
Let $\Gamma$ be a packet routing game where $G(\Gamma)=(V=\{s,d\},E)$ represents a linear multigraph with a single layer and let $a_s\in \N_{\geq 0}^n$ be a starting pattern at $s$. Furthermore, we require the players to adhere to the strategy profile \mbox{$\badNash=\phi(\Gamma,a_s)$}. 
If two players leave the queues on edges $e^1_i$ and $e^1_j$, $i<j$, at the same time $t$, then for the workload it holds that $l_{e^1_j}(\badNash,t) \leq l_{e^1_i}(\badNash,t) \leq l_{e^1_j}(\badNash,t)+1$.
\end{restatable}

% \begin{proof}
% As defined in the network loading, we refer to an edge as \emph{used (at time $t$)} when a player leaves the queue of this edge at time $t$.
% If, at any time $t$, there is a used edge $e^1_j$ that has a strictly higher %latency
% \textcolor{red}{workload}\reviewer{from Lemma 3 onward, it is often referred to the latency of an edge, which is never defined in the paper; rather, the authors define (and meant to refer to) the workload of an edge. }\torben{ Ich bin mir nicht sicher ob ich alle STellen erwischt habe. Bitte checken.} than another used edge $e^1_i$ with $i<j$, then the player with the largest index queuing on edge $e^1_j$ could have chosen edge $e^1_i$ without worsening her latency since the queue lengths on all used edges decrease at the same rate. This contradicts the assumption that the player behaves according to \badNash.

% Conversely, suppose at some time $t$, there is a used edge $e^1_j$ and another used edge $e^1_i$ with $i<j$ and $l_{e^1_j}(\badNash,t)+1<l_{e^1_i}(\badNash,t)$.
% Then the player with the largest index to queue on edge $e_i$ could have chosen edge $e_j$ instead. This contradicts the assumption that we are in an equilibrium.
% Together this yields $l_{e^1_j}(\badNash,t) \leq l_{e^1_i}(\badNash,t) \leq l_{e^1_j}(\badNash,t)+1$.\qed
% \end{proof}

\begin{restatable}{lemma}{lemmaOneLayerNew}\label{lemma_onelayernew}
Let $\Gamma$ be a packet routing game with $G(\Gamma)=(V=\{s,d\},E)$ being a linear multigraph with only one layer and $a_s\in \N_{\geq 0}^n$ be a starting pattern at $s$. If players adhere to the strategy profile $\badNash=\phi(\Gamma, a_s)$, then $C_i(\badNash)\geq C_i(S)$ for all $S \in \Nash$ and all $i\in N$.
\end{restatable}
% \begin{proof}
% In the network loading at time $t$, we first add every player entering an edge to the queue and then remove the first player from each queue. For any $S \in \Nash$, we denote the sum of queue lengths in the network at time $t$ after the removal by $Q(S,t)$. When comparing $Q(S,t)$ to $Q(S,t-1)$ observe that we can obtain $Q(S,t)$ from $Q(S,t-1)$ as follows. We denote the number of players starting at time $t$ with $Q^+(S,t)$. For every player with starting time $t$, we increase the sum of queue lengths by one. Afterwards, the total queue length decreases by the number of used edges at time $t$, i.e., edges with a non-empty queue, denoted by $Q^-(S,t)$. Thus, we have $Q(S,t)= Q(S,t-1)+Q^+(S,t)-Q^-(S,t)$.
% \paragraph{Claim:} $Q(\badNash,t) \geq Q(S,t)$ for all $S\in \Nash$ and for all $t\in \N$.

% \begin{proof}[of claim]
% Suppose there exists a state $S\in \Nash$ and a time $t\in \N$ such that $Q(\badNash,t) < Q(S,t)$. 
% Consider the earliest point in time $t'$ at which this happens. Thus, we know that $Q(\badNash,t'-1) \geq Q(S,t'-1)$ and $Q^+(S,t')= Q^+(\badNash,t')$.
% We conclude that $Q^-(\badNash,t') > Q^-(S,t')$, i.e., $\badNash$ uses strictly more edges at $t'$ than $S$ does.
% We call an edge $e$ \emph{new} (at time $t'$) if the queue $q_e$ at time $t$ is empty, i.e., the first player entering the edge experiences no queuing time on this edge. Conversely, we call an edge \emph{old} (at time $t$) if it is not new at time $t$. Furthermore, the first player on a new edge does not contribute to $Q(S,t')$, since this player is counted in $Q^+(S,t')$ as well as in $Q^-(S,t')$. 

% Hence, $\badNash$ uses more new edges than $S$. Let $e'$ be a new edge exclusively used by $\badNash$ at $t'$. By Lemma \ref{lemma_ali}, \badNash\ also uses all edges with transit time smaller than $\tau(e')$ at time $t'$. Furthermore, $S$ cannot use an edge with a larger transit time than $\tau(e')$ without contradicting the equilibrium property. Since $S$ has more players in queues, there has to be an edge $e''$ which has more players in its queue under $S$ than under $\badNash$ at time $t'$.


% Due \reviewer{The second part of the proof of the Claim in Lemma 4 is a bit obscure and hard to follow.}to Lemma \ref{lemma_ali}, we know that in $\badNash$ new edges are only used if each edge with a smaller index has a strictly higher %latency
% \textcolor{red}{workload}. Additionally, in $S$, the queue on $e''$ is even longer than in \badNash. Summarizing, $l_{e''}(S,t')\ge l_{e'}(S,t')+2 = \tau(e')+2$.
% Consequently, the last player on $e''$ in $S$, which experiences a latency of at least $\tau(e')+1$, can improve her latency by changing her strategy to $e'$. This contradicts the assumption that $S$ is an equilibrium.\reviewer{The squares to finish proofs are sometimes black and other times are white.}\torben{Hier ist anscheinend jemand durch unterclaim verwirrt. Sollen wir das auslagern um diese Situation einen Beweis in einem Beweis zu haben zu vermeiden oder so lassen?} \hfill $\blacksquare$
% \end{proof}

% Furthermore, we observe that the completion time of any player $i$ starting at $t+1$ is uniquely defined given the total queue length $Q(S,t)$ at time $t$ for any $S\in \Nash$, since the $Q(S,t)$-many players in queues level out the latencies on the shortest edges. This suffices to determine the latencies of the subsequent players. Additionally, the completion time of player $i$ is monotonically increasing in $Q(S,t)$. This yields $C_i(\badNash)\geq C_i(S)$ for all $S \in \Nash$ and all $i\in N$.\qed
% \end{proof}

\begin{restatable}{lemma}{lemmaMnKStartpattern}\label{lemma_mnK_startpattern}
Let $\Gamma$ be a packet routing game with $G(\Gamma)=(V=\{s,d\},E)$ and $a, b\in \N_{\geq 0}^n$ be starting patterns at $s$ with $a\leq b$ pointwise. Let $\badNash^a = \phi(\Gamma, a)$ and $\badNash^b = \phi(\Gamma, b)$ denote the equilibria arising from the policy greedy queue for $a$ and $b$, respectively. For every $i \in N$ denote by $C_i(\badNash^a)$ and $C_i(\badNash^b)$ the corresponding completion times of player $i$. Then, $C_i(\badNash^a)\leq C_i(\badNash^b)$ for all $i\in N$.
\end{restatable}
\gotoAppendix{\noindent
Although the statement of Lemma \ref{lemma_mnK_startpattern} appears very natural, the proof is rather technical. 
% Due to the space limitations, we present the full proof in Appendix \ref{app:sec4}.
The main idea of the proof is to restrict on patterns, which only differ in one position by one. Then, we introduce a dummy player and carefully swap this dummy player with consecutive players to transform one pattern into the other, while keeping track of the changes in the arrival patterns.}{
\input{proofLemmaStartpattern}}

Now we are ready to show that the greedy queue policy constructs an equilibrium simultaneously maximizing the arrival times of all players under all equilibria.
\begin{proposition}\label{prop_together}
Let $\Gamma$ be a packet routing game with $G(\Gamma)\in\mathcal{G}$ (and starting pattern $0^n$). The greedy queue policy constructs an equilibrium maximizing the arrival times of all players at $d$ under all equilibria $S \in \Nash$. Specifically, for $\badNash=\phi(\Gamma,0^n)$, it holds that $C(S) \leq C(\badNash)$.
\end{proposition}
\begin{proof}
Fix an arbitrary equilibrium $S \in \Nash$.
We will show this statement by carefully transforming $S$ to $\badNash$ in $m$ steps.
In the $j$-th iteration of the transformation, the players follow the strategy of $S$ until node $v_{m-j}$ and then follow the greedy queue policy. Denote this strategy as $S^j$.
Observe that $S=S^0$ and $\badNash=S^m$.
For any fixed $j\in \{0,\ldots,m-1\}$ the strategies $S^j$ and $S^{j+1}$ are identical until node $v_{m-j-1}$ and therefore also the arrival patterns at $v_{m-j-1}$. With Lemma $\ref{lemma_onelayernew}$, we know that the arrival pattern of $S^{j+1}$ at node $v_{m-j}$ is pointwise at least as big as the arrival pattern of $S^{j}$ at this node. Using Lemma $\ref{lemma_mnK_startpattern}$ iteratively yields $C_i(S^j)\leq C_i(S^{j+1})$ for all $j\in \{0,\ldots,m-1\}$ and all $i\in N$. Iterating this argument yields $C_i(S^0) \leq C_i(S^m)$ for all $i\in N$, and in particular $C(S) = C_n(S) = C_n(S^0) \leq C_n(S^m)= C(S^m) = C(\badNash)$. 
\end{proof}
%

\noindent To effectively compare the social optimum with any greedy Nash Equilibrium two additional properties are required. The following technical lemma demonstrates that, under the greedy queue policy, deleting edges is never beneficial for any player.
%
\begin{restatable}{lemma}{lemmaAddingEdges}\label{lemma_adding edges}
Let $\Gamma_1$ and $\Gamma_2$ be packet routing games that differ only in the underlying graphs with $G(\Gamma_1)=(V,E_1)\in \mathcal{G}$ and $G(\Gamma_2)=(V,E_1\cup E_2)\in \mathcal{G}$ with $\badNash_{G_1}=\phi(\Gamma_1,0^n)$ and $\badNash_{G_2}=\phi(\Gamma_2,0^n)$. It holds that $C(\badNash_{G_1}) \geq C(\badNash_{G_2})$.
\end{restatable}
%
\gotoAppendix{
%\noindent Again, we refer for the details of this rather technical lemma to Appendix \ref{app:sec4}.
}{\begin{proof}
It is sufficient to show that the property holds for $|E_2\backslash E_1|=1$. Let $e=(v_j,v_{j+1})$ be the edge where the two graphs differ. Up to node $v_j$ the arrival patterns $a_{v_j}(\badNash_{G_1})$ and $a_{v_j}(\badNash_{G_2})$ trivially coincide.
Suppose that there is a player $i$ such that $a^i_{v_{j+1}}(\badNash_{G_2}) > a^i_{v_{j+1}}(\badNash_{G_1})$ and $a^{i'}_{v_{j+1}}(\badNash_{G_2}) \leq a^{i'}_{v_{j+1}}(\badNash_{G_1})$ for all $i'<i$. In particular, there are at most $|\{e\in E_1^{j+1}: \tau(e) \leq a^i_{v_{j+1}}(\badNash_{G_1}) - a^i_{v_{j}}(\badNash_{G_1})\}| -1$ players with index less than $i$ that arrive at $v_{j+1}$ at time $a^i_{v_{j+1}}(\badNash_{G_1})$. Here $E_1^{j+1}$ denotes the edges in $E_1$ that are in the $(j+1)$-th layer of $G_1$. Since $i$ arrives at $v_{j+1}$ strictly later in $G_2$ than in $G_1$, among all edges of $\{e\in E_1^{j+1}: \tau(e) \leq a^i_{v_{j+1}}(\badNash_{G_1}) - a^i_{v_{j}}(\badNash_{G_1})\}$ players arrive at $v_{j+1}$ at time $a^i_{v_{j+1}}(\badNash_{G_1})$ in $\badNash_{G_2}$. Note, that is one more player. By Lemma \ref{lemma_order} the additional player $i'$ has $i'<i$, since no overtaking is possible at any intermediate node in any equilibrium. But then we have $a^{i'}_{v_{j+1}}(\badNash_{G_2}) > a^{i'}_{v_{j+1}}(\badNash_{G_1})$, which contradicts that player $i$ was the player with the smallest index that was delayed. Therefore, $a^i_{v_{j+1}}(\badNash_{G_1}) \geq a^i_{v_{j+1}}(\badNash_{G_2})$ holds for all $i\in N$. 
In the later layers, the graphs are indistinguishable. Therefore, by iterating node by node to the destination node $d$, we obtain the statement by applying Lemma $\ref{lemma_mnK_startpattern}$ at each step.
\end{proof}}
%
%
\noindent Finally, we present our last lemma which asserts that the transit time of any player in any equilibrium in any layer with inflow at most $k$ is bounded by the $k$-th shortest transit time in that layer.
\begin{lemma}\label{lemma_inflowk}
Let $j$ be a layer with at least $k$ edges $e_1^j, e_2^j, \dots$ in a linear multigraph. Let $S \in \Nash$ be an equilibrium for a packet routing game on this graph. If the maximum inflow into $v_{j-1}$ under $S$ is at most $k$ at any point in time, the latency of a player never exceeds the $k$-th shortest transit time $\tau(e_k^j)$ in that layer.
\end{lemma}
%
\begin{proof}
Consider the first time $t$ in an equilibrium where a player $i$ uses an edge with a latency exceeding $\tau(e_k^j)$. Because $t$ was the earliest time with this property, we know that at time $t-1$ no player experiences a latency that exceeds $\tau(e_k^j)$. As at most $k$ players enter the queues at time $t$ and we remove one player from the queue of each used edge afterwards, either there are $k$ used edges and the latencies do not increase, or there are at most $k-1$ used edges, i.e., one of the edges $e_1^j, e_2^j, \dots, e_k^j$ is unused. In the latter case, the latency is trivially bounded by $\tau(e_k^j)$. Thus, there is still an edge with latency $\tau(e_k^j)$, which finishes the proof.
\end{proof}
\noindent With Proposition~\ref{prop_together} and all the lemmata at hand, we are now able to prove an upper bound of 2 on the $\PoA$ for the class of linear multigraphs.

\begin{theorem}\label{satz_PoA2} For the family $\mathcal{G}$ of linear multigraphs, we have
$\PoA(\mathcal{G})\leq 2$.
\end{theorem}
\begin{proof}
For a fixed packet routing game $\Gamma$, there is a $k$ such that there exists an optimal flow $S^*$ that is essentially temporally repeated and uses $k$ disjoint paths due to Theorem $\ref{thm:opt}$. Consider the subgraph \mbox{$G'=(V,E')$} of $G=(V,E)$, which consists only of all edges used by this optimal flow. Consider the induced packet routing game $\Gamma'$ from $\Gamma$ that differs only on the underlying graph, i.e., \mbox{$G(\Gamma')=G'$} and $G(\Gamma)=G$. Clearly it holds that $C^{\Gamma}(S^*)= C^{\Gamma'}(S^*)$. \mbox{Proposition \ref{prop_together}} and Lemma \ref{lemma_adding edges} show that for the worst equilibria $\badNash_{G}=\phi(\Gamma,0^n)$ and $\badNash_{G'}=\phi(\Gamma',0^n)$ in the two graphs we have $C^{\Gamma}(\badNash_{G}) \leq C^{\Gamma'}(\badNash_{G'})$ and, hence, $\PoA(\Gamma)\leq \PoA(\Gamma')$. Thus, it suffices to show the claim for the subgraph $G'$.

If $G'$ has only one layer, the definitions of the equilbria and the social optimum coincide as there are no intermediate nodes. Thus, $S^*$ has the same arrival pattern at $d$ as the equilibrium $\badNash_{G'}$ and hence $\PoA(\Gamma')=1$. 

If $G'$ consists of more than one layer, we will separately discuss the latency of the last player from $s$ to $v_1$ and from $v_1$ to $d$, respectively. In any UFR equilibrium $S$, every player aims to be as fast as possible at node $v_1$. Thus, for each time $t$, a player arrives at $v_1$ via all edges $e^1$ with $\tau(e^1) \leq t$. It is immediate that for each $t$, the equilibrium $S$ maximizes the number of players arriving at $v_1$ by $t$. Additionally, the players arrive at $v_1$ in the order of their indices due to Lemma~\ref{lemma_order}. Thus, the $n$-th player reaches $v_1$ in $S$ not later than the last player reaches $v_1$ in $S^*$, and thus we have in particular $a^n_{v_1}(S)\leq \max_{i\in N}a^i_{v_1}(S^*) \leq C^{\Gamma'}(S^*)$. 
% \reviewer{page 14: the second and third last paragraphs appear to be a repetition of the same concepts. }\torben{ Sehe ich iwie nicht so. Ich denke das sind schon zwei verschiedene Dinge.}
For the second part from $v_1$ to $d$, note that the inflow in each layer except the first is at most $k$, since $G'$ is constructed by $k$ edge-disjoint $s-d$ paths.
Therefore, by Lemma \ref{lemma_inflowk}, a player in an equilibrium has a maximum latency of $\tau(e_k^j)$ in any layer $j>1$. We conclude that for each player in an equilibrium, we can bound the total latency from $v_1$ to $d$ from above by $\sum_{j=2}^m \tau(e_k^j)$. 
As seen in Theorem $\ref{thm:opt}$, we have $\sum_{j=1}^m \tau(e_k^j)\leq C^{\Gamma'}(S^*)$. Therefore, we can further bound the total latency from $v_1$ to $d$ from above by $\sum\limits_{j=2}^m \tau(e_k^j)\leq C^{\Gamma'}(S^*)-\tau(e_k^1)$.\\
Adding both parts, we obtain
\begin{align*}
    C^{\Gamma'}(\badNash_{G'})&\leq a^n_{v_1}(S) + \left(C^{\Gamma'}(S^*) -\tau(e_k^1)\right) \leq 2 \cdot C^{\Gamma'}(S^*).
\end{align*}
Thus, for all $\Gamma$ with $G(\Gamma) \in \mathcal{G}$ it follows \[\PoA(\Gamma)\leq \PoA(\Gamma')=\frac{C^{\Gamma'}(\badNash_{G'})}{C^{\Gamma'}(S^*)} \leq \frac{2 \cdot C^{\Gamma'}(S^*)}{C^{\Gamma'}(S^*)} \leq 2\;.\]
This yields $\PoA(\mathcal{G}) = \sup\limits_{\Gamma: G(\Gamma) \in \mathcal{G}} \PoA(\Gamma) \leq 2\;.$
\end{proof}
% \begin{remark}
%     For linear multigraphs with only two layers, one can prove that there is a worst-case network where all transit times in the first layer are equal to 1. By optimizing over the remaining network and the number of players a $\PoA$ of $\frac{4}{3}$ can be shown. Interestingly this matches the tight $\PoA$ result for parallel-path networks by Correa et al. in~\cite{DBLP:journals/mor/CorreaCO22} for non-atomic flows. A minimal example that achieves this value has three players, $V=\{s,v_1,d\}$, $E=\{e_1^1,e_2^1,e_1^2,e_2^2\}$ and $\tau(e^1_1)=\tau(e^1_2)=\tau(e^2_1)=1$ and $\tau(e_2^2)=2$. As one can easily verify $S=((e_1^1,e_1^2),(e^1_2,e_1^2),(e^1_1,e_1^2))$ is an equilibrium with $C(S)=4$, while the optimal state $S^*=((e^1_1,e_1^2),(e^1_2,e_2^2),(e^1_1,e_1^2))$ has $C(S^*)=3$.
% \end{remark}