\section{Lower Bound on the Price of Stability}\label{sec:pos}

\subsection{Constructing Bad Instances}\label{sec:posBadInst}
In this section, we will establish a lower bound on the $\PoS$ and therefore also on the $\PoA$. We will construct a sequence of packet routing games $(\Gamma_i)_{i \in \N}$ with $\PoA(\Gamma_i) = \PoS(\Gamma_i)$ and $\lim\limits_{i \rightarrow \infty} \PoS(\Gamma_i) \geq \frac{e}{e-1}$, where each $G(\Gamma_i)\in \mathcal{G}$, i.e., each underlying graph is a linear multigraph. This lower bound is slightly above 1.582.

We introduce a subclass $\mathcal{G}_{k,\ell}\subseteq \mathcal{G}$ for $0\leq\ell<k$, $\ell \in \N_{\geq 0}$ and $k\in \N_{>0}$. A graph $G\in\mathcal{G}_{k,\ell}$ is a linear multigraph that consists of nodes $V=\{s=v_0,$ $v_1,\ldots,v_{k-\ell}=d\}$ and $k$ edges in every layer. In layer $j$ from $v_{j-1}$ to $v_j$, these $k$ edges consist of $j-1$ edges with a layer specific transit time of $\tau_j$ (called \emph{special edges}) and $k-(j-1)$ edges with a transit time of $1$ (called \emph{standard edges}). In Figure \ref{klayersl1}, the graphs are visualized for different values of $\ell$. 

An informal interpretation of the graph class $\mathcal{G}_{k,\ell}$ is at hand. The value $k$ clearly represents the number of edges in each layer of the graph. Furthermore, it also determines the maximum number of nodes in the graph, which is $k+1$. 
On the other hand, $\ell$ signifies the number of layers that are truncated from the graph. Thus, a graph in $\mathcal{G}_{k,\ell}$ has $k-\ell+1$ nodes.
Additionally, the amount of special edges incrementally increases by one as we move from one layer to the next, starting with zero special edges in the first layer.

\begin{figure}[H]
    \resizebox{\linewidth}{!}{\input{kllayersl1}} 
    \caption{Visualization of graphs in $\mathcal{G}_{k,\ell}$. For a given $\ell$, the graph $G$ consists of all layers left of the red curved line and the last node before the line serves as destination node $d$.}
    \label{klayersl1}
\end{figure}

\begin{restatable}{theorem}{satzPoAgeqee}\label{satz_PoAgeqee1}
There exists a sequence of packet routing games $(\Gamma_i)_{i \in \N_{>0}}$ on linear multigraphs with
$\lim\limits_{i \rightarrow \infty} \PoS(\Gamma_i) \geq \frac{e}{e-1}$ where each $G(\Gamma_i)\in \mathcal{G}$. Thus, we obtain $\PoS(\mathcal{G})\geq \frac{e}{e-1}\geq 1.582$.
\end{restatable}
\begin{proof}
    For each $i\in \N_{>0}$, we choose $\Gamma_i$ to be the game characterized by $G(\Gamma_i)\in \mathcal{G}_{k,\ell}$ with $\ell = i$ and $k=\lceil ei\rceil$. The player set is $N(\Gamma_i)=[n_i]$ with $n_i= k!= \lceil ei\rceil!$ and the transit time of the special edges in layer $j\geq 2$ is set to
\begin{align*}
    \tau_j = \frac{n_i}{k-j+1} - \frac{n_i}{k-j+2} +2.
\end{align*}
The underlying concept of this construction can be explained as follows. The transit times on the special edges are deliberately set high to ensure that no equilibrium flow uses them. As a result, the network progressively narrows with each layer, leading to inevitable queuing on all standard edges. Note that the transit times of the special edges increase for higher layers. Thus, we additionally truncate the construction at a certain point to prevent the narrow layers from significantly enlarging the social optimum too much.
We begin by showing by induction on the arrival times of players at intermediate nodes that no special edges are used in any equilibrium. Specifically, we show that for $j\geq 1$ at each time step $j \leq t \leq \frac{n_i}{k-j+1}+j-1$ exactly $k-j+1$ players arrive at $v_j$. 
Consider a fixed game $\Gamma_i$ and an arbitrary equilibrium $S_i\in \Nash^{\Gamma_i}$.
First, as the first layer is solely composed of $k$ standard edges, trivially no player uses a special edge and it is immediate that $k$ players arrive at $v_1$ at each time $1\leq t \leq \frac{n_i}{k}$. 
Suppose by induction hypothesis that this holds up to layer $j$, i.e., $k-j+1$ players arrive at time steps $j \leq t \leq \frac{n_i}{k-j+1}+j-1$ at $v_j$. We have $k-j$ standard edges in layer $j+1$, hence, the throughput on standard edges is one smaller than the inflow. Therefore, in each time step, the number of players in queues in this layer increases by 1. After $\frac{n_i}{k-j+1}$ time steps, all $n_i$ players arrived at $v_j$. At this point in time, there are $\frac{n_i}{k-j+1}$ queued players in $k-j$ many queues, that is, each queue has length exactly $\frac{n_i}{(k-j+1)(k-j)}=\frac{n_i}{k-j}-\frac{n_i}{k-j+1}$. Since $\tau_{j+1}$ is strictly larger than this value, the special edges in layer $j+1$ are indeed never used. Furthermore, $k-j=k-(j+1)+1$ players arrive at each time step $j+1 \leq t \leq \frac{n_i}{k-j+2}+j$ at $v_{j+1}$.

As no special edges are used by any equilibrium $S_i\in\Nash$, this implies that every equilibrium has the same completion time. The $n_i$-th player arrives at node $v_j$ at time $\frac{n_i}{k-j+1}+ j-1$ and thus we have
\begin{align}
    C^{\Gamma_i}(S_i) &= (k-\ell) + \frac{n_i}{k- (k-\ell)+1} -1 = (k-\ell -1) + n_i\cdot \left(\frac{1}{\ell+1}\right).\label{eq:nash}
\end{align}
%
It remains to compute the completion time for the social optimum. 
\input{proofTheoremLowerBoundOPT}
\end{proof}

\subsection{Implications for Flows over Time}\label{sec:FlowOverTime}
Flows over time can essentially be seen as the continuous variant of packet routings. For a comprehensive introduction to the topic, we refer to the survey article of Skutella~\cite{Skutella2009survey}. 
We will follow its lines and recall the most basic definitions in Appendix \ref{app:FlowOverTime}.

% old version
% here. For a given graph $G$ with transit times $\tau(e)$ for the edges $e \in E$, a designated source $s$, destination $d$ and a fixed time horizon $T$, a flow over time is formally defined as follows.

% \begin{definition}
% A flow over time $f$ with time horizon $T$ consists of a Lebesgue-
% integrable function $f_e : [0, T) \rightarrow \mathbb{R}_{\geq 0}$ for each arc $e \in E$. For all $\theta \geq T - \tau(e)$ it must hold that $fe(\theta) = 0$ for all $e \in E$.
% \end{definition}

% \begin{definition}
%     A flow over time $f$ is called feasible if the following properties hold.
%     \begin{enumerate}
%     \item The flow over time $f$ fulfills the capacity constraints if $f_e(\theta) \leq \nu_e$ for
% each $e \in E$ and almost all $\theta \in [0, T )$.
%     \item The flow over time $f$ fulfills the weak flow conservation constraints if the amount of flow that has left a node $v \in V\setminus \{s,d\}$ is always upper bounded by the amount of flow that has entered the same node for all $\theta \in [0,T)$. Formally,
%     \[\sum_{e \in \delta^-(v)}\int_0^{\theta - \tau(e)}f_e(\xi)\,d\xi \geq \sum_{e \in \delta^+(v)}\int_0^{\theta}f_e(\xi)\,d\xi\;,\]
%     where $\delta^-(v)$ and $\delta^+(v)$ denote the set incoming and outgoing of edges of $v$, respectively.
%     \end{enumerate}
% \end{definition}
% We say that the amount of flow that has entered $d$ up to time $T$ is the value of the flow $f$. Formally, $|f| = \sum_{e \in \delta^-(d)}\int_0^{T - \tau(e)}f_e(\xi)\,d\xi$. If the weak flow conservation constraint is fulfilled with equality for all $\theta$ and all $v \in V\setminus\{s,d\}$, we say the flow fulfills strong flow conservation. A very special and important class of flows over time are temporally repeated flows. For a feasible static flow $x$ on the same graph, let $(x_P)_{P\in \mathcal{P}}$ be a path decomposition of $x$. The temporally repeated flow $f$ sends flow at rate $x_P$ into $P$ from $s$ during the time interval $[0,T-\tau(P))$. Here, $\tau(P)\coloneqq \sum_{e \in P}{\tau(e)}$ denotes the length of the path $P$. Formally,

% \begin{definition}
% For a static flow $x$ with flow decomposition $(x_P)_{P \in \mathcal{P}}$ the corresponding temporally repeated flow $f$ with time horizon $T$ is defined by
% \[f_e(\theta) \coloneqq \sum_{P \in P_e(\theta)} x_p \qquad \text{for }e=(v,w) \in E, \theta \in [0,T),\]
% where $P_e(\theta) \coloneqq \left\{P \in \mathcal{P} : e \in P \wedge \tau(P_{s,v}) \leq \theta \wedge \tau(P_{v,t}) < T-\theta \right\}$. Here, $\tau(P_{u,v})$ denotes the length of $P$ from $u$ to $v$.
% \end{definition}
% It is easy to see that temporally repeated flows are feasible and fulfill strong flow conservation, see~\cite{Skutella2009survey}.

% A dynamic Nash equilibrium, also called a Nash flow over time, is a special flow over time. It is assumed, that flow appears with a fixed inflow rate at the source node. Similar to the discrete model, the flow is interpreted as an infinite amount of flow particles each deciding at the time of appearance at the source node on a shortest $s-d$ path in a dynamic Nash equilibrium. More formally, for any point in time $\theta \in \mathbb{R}_{\geq 0}$ a positive flow entering an edge $e \in E$ implies that $e$ lies on a currently fastest path to $d$. The makespan-$\PoA$ and makespan-$\PoS$ are defined analogously to the packet routing game, i.e., we compare the latest arrival time of any particle in a Nash flow over time to the arrival time in an optimal flow. Note that for Nash flows over time we even have $\PoA(\mathcal{G})=\PoS(\mathcal{G})$ since the arrival times of dynamic Nash flows over time are unique as recently shown by Olver et al.~\cite{DBLP:conf/focs/OlverSK21}. For the remainder of the section, we only consider the makespan-$\PoA$. For a formal introduction to Nash flows over time, we refer to the PhD theses of Lara Vargas Koch~\cite{PhDLaura} and Leon Sering~\cite{PhDLeon}.

Correa et al.\ proved an upper bound on the makespan-$\PoA$ of Nash flows over time of $\frac{e}{e-1}$ if a \emph{monotonicity conjecture} holds~\cite{DBLP:journals/mor/CorreaCO22}. In essence, the monotonicity conjecture states that the completion time of a Nash flow over time does not decrease as the inflow rate increases while the total amount of flow and the underlying network remains the same.
\begin{proposition}[Correa et al.~\cite{DBLP:journals/mor/CorreaCO22}]
    The makespan-$\PoA$ is upper bounded by $\frac{e}{e-1}$ if the monotonicity conjecture holds.
\end{proposition}

\noindent Correa et al.~\cite{DBLP:journals/mor/CorreaCO22} proved the monotonicity conjecture for linear multigraphs. Interestingly, the same authors also provided a lower bound on the $\PoA$ of $\frac{e}{e-1}$, by a sequence of instances for which the monotonicity conjecture could not been proven. We tighten the $\PoA$ bound on linear multigraphs by observing that the instance used in the proof of Theorem \ref{satz_PoAgeqee1} can be extended to Nash flows over time. The proof exploits the fact that the instance is constructed with evenly loaded edges, such that interpreting integral flow values continuously does not allow for any improvement in the travel time for any flow particle.



% \begin{proposition}
%         The makespan-$\PoA$ is lower bounded by $\frac{e}{e-1}$ even in linear multigraphs.
% \end{proposition}
\begin{restatable}{proposition}{propositionFlowOverTimeLowerBound}\label{prop_propositionFlowOverTimeLowerBound}
    The makespan-$\PoA$ is lower bounded by $\frac{e}{e-1}$ even in linear multigraphs.
\end{restatable}
% \begin{proof}
% We adapt the graphs used in the proof of Theorem \ref{satz_PoAgeqee1} by omitting the first layer and introducing a constant inflow of $k$ at $s$. We interpret the $n$ players as a flow mass of $n$ similar to the interpretation used by Fleischer and Tardos~\cite{DBLP:journals/orl/FleischerT98}. It remains to argue that the obtained flow over time is indeed feasible and a Nash flow.

% Starting with an arbitrary equilibrium $S_i\in \Nash$ of $\Gamma_i$, we construct the Nash flow over time as follows. We set $f_e(\theta)=1$ in the interval \mbox{$[t-1,t)$} whenever a packet leaves the queue $q_e$ of an edge $e=(u,v)$ at time $t$. The constructed flow over time is feasible as we only forward packets if they have already arrived at the corresponding node, thus we immediately respect weak flow conservation in the flow over time. Additionally, as there is at most one packet leaving any queue at a given time, thus we respect the capacity constraints. Regarding the Nash condition observe that at each discrete point in time, a standard edge of some layer is used if and only if all other standard edges are also used as the total number of packets is divisible by any \mbox{$j\in \{1,\ldots, k\}$}. Thus, the standard edges of a layer are used equally, and it is immediate that no standard edge has strictly lower latency than some other standard edge of the same layer. Additionally, the special edges have strictly larger latencies and are never part of the shortest path network. Since the first omitted layer consists exclusively of standard edges with a transit time of one, we respect the inflow into the network. The completion time of the dynamic Nash equilibrium is by definition $C(S_i)$.

% It remains to bound the completion time of an optimal flow over time in this instances. In series-parallel graphs, there is a temporally repeated flow over time that is also an earliest arrival flow, i.e., a flow that maximizes the flow that arrived at $d$ at any point in time, see~\cite{Skutella2009survey}. In particular, this flow is optimal for minimizing the completion time. By Proposition~\ref{thm:opt} the completion time of this earliest arrival flow and the optimal packet routing coincide up to one and we conclude in the limit $\PoA(\mathcal{G})\geq \frac{e}{e-1}$.
% \qed
% \end{proof}