\paragraph{Understanding an Optimal State $S^*$:}
\label{sec:understandingopt}
The first step in bounding the $\PoA$ and the $\PoS$ is understanding an optimal state. The optimal state for a packet routing problem sends all packets as fast as possible to the destination $d$. A very related problem is the discrete maximum dynamic flow problem, where as many packets as possible are being sent to $d$ in a given time horizon. Ford and Fulkerson introduced this problem in~\cite{ford1958constructing} and showed how to solve it by a single static flow computation. This static flow is then repeated over time to obtain a flow maximizing the number of packets arriving at $d$ within a given time horizon $T$. We will revisit these classical results to provide the following structure of an optimal state. 

\begin{restatable}{proposition}{satzOptStructure}\label{thm:opt}
For a packet routing game $\Gamma$ on $G\in\mathcal{G}$ let $P^1$ be a shortest $s-d$ path in $G$, and let $P^j$, $j>1$ be a shortest $s-d$ path in $G$ after the deletion of $P^1$, \dots, $P^{j-1}$. Let $k$ be such that $\tau(P^{k}) \coloneqq \sum_{e\in P^k} \tau(e)\leq C(S^*)$ and $\tau(P^{k+1})> C(S^*)$ if $P^{k+1}$ exists. There is an optimal state $S^*\in\mathcal{S}$ with the following properties.
    \begin{enumerate}
        \item There are no queues in any layer $\ell\geq 2$.
        \item $C(S^*)+1-\tau(P^1)$ packets use $P^1$ and $C(S^*)+\delta_j -\tau(P^j)$ packets use $P^j$ with $\delta_j\in\{0,1\}$ for $2\leq j \leq k$ and $\sum_{j=2}^k \delta_j = n-k\cdot C(S^*) -1 +\sum_{j=1}^k \tau(P^j)$.
    \end{enumerate}
\end{restatable}
















\iffalse
We will base our proof on a strong connection of optimal packet routings in linear multigraphs to optimal continuous flows over time. This relationship has already been observed and used by Fleischer and Tardos~\cite{DBLP:journals/orl/FleischerT98}. By using the theory on optimal flows over time, mainly based on the classical work of Ford and Fulkerson~\cite{ford1958constructing}, we obtain an optimal packet routing of a very special form. Note that the original model by Ford and Fulkerson was defined in a discrete way with a time expanded network. To simplify notation and to stay closer to recent related work, we present these results in the well established notation for continuous flows over time. We will show that there exists an optimal state $S^*$ for the packet routing game that is essentially a temporally repeated flow along $k$ edge-disjoint paths in the graph.




Before showing the theorem, we will introduce network flows over time to improve readability. Network flows over time can essentially be seen as the continuous variant of packet routings. We will mainly follow the lines of Skutella's survey article~\cite{Skutella2009survey}. For a given graph $G$ with transit times $\tau(e)$ for the edges $e \in E$, a designated source $s$, destination $d$ and a fixed time horizon $T$, a flow over time is formally defined as follows.

\begin{definition}
A flow over time $f$ with time horizon $T$ consists of a Lebesgue-
integrable function $f_e : [0, T) \rightarrow \mathbb{R}_{\geq 0}$ for each arc $e \in E$. For all $\theta \geq T - \tau(e)$ it must hold that $fe(\theta) = 0$.
\end{definition}

\begin{definition}
    A flow over time $f$ is called feasible if the following properties hold.
    \begin{enumerate}
    \item The flow over time $f$ fulfills the capacity constraints if $f_e(\theta) \leq 1$ for
each $e \in E$ and almost all $\theta \in [0, T )$.
    \item The flow over time $f$ fulfills the weak flow conservation constraints if the amount of flow that has left a node $v \in V\setminus \{s,d\}$ is always upper bounded by the amount of flow that has entered the same node for all $\theta \in [0,T)$. Formally,
    \[\sum_{e \in \delta^-(v)}\int_0^{\theta - \tau(e)}f_e(\xi)\,d\xi \geq \sum_{e \in \delta^+(v)}\int_0^{\theta}f_e(\xi)\,d\xi\;,\]
    where $\delta^-(v)$ and $\delta^+(v)$ denote the set incoming and outgoing of edges of $v$, respectively.
    \end{enumerate}
\end{definition}

We say that the amount of flow that has entered $d$ \todo{Liest sich komisch, weil du im n채chsten Satz das f체r jeden Knoten v und nicht nur f체r d machst.}\daniel{klar, war ein Tippfehler im n채chsten Satz. Da steht jetzt $d$ (statt $v$). Ok so?}up to time $T$ is the value of the flow $f$. Formally, $|f| = \sum_{e \in \delta^-(d)}\int_0^{T - \tau(e)}f_e(\xi)\,d\xi$. If weak the flow conservation constraint is fulfilled with equality for all $\theta$ and all $v \in V\setminus\{s,d\}$, we say the flow fulfills strong flow conservation. A very special and important class of flows over time are temporally repeated flows. Informally, for a feasible static flow $x$ on the same graph with edge capacities 1, let $(x_P)_{P\in \mathcal{P}}$ be a path decomposition of $x$. The temporally repeated flow $f$ sends flow at rate $x_P$ into $P$ from $s$ during the time interval $[0,T-\tau(P))$. Here, $\tau(P)\coloneqq \sum_{e \in P}{\tau(e)}$ denotes the length of the path $P$. Formally,

\begin{definition}
For a static flow $x$ with flow decomposition $(x_P)_{P \in \mathcal{P}}$ the corresponding temporally repeated flow $f$ with time horizon $T$ is defined by
\[f_e(\theta) \coloneqq \sum_{P \in P_e(\theta)} x_p \qquad \text{for }e=(v,w) \in E, \theta \in [0,T),\]
where $P_e(\theta) \coloneqq \left\{P \in \mathcal{P} : e \in P \wedge \tau(P_{s,v}) \leq \theta \wedge \tau(P_{v,t}) < T-\theta \right\}$. Here, $\tau(P_{u,v})$ denotes the length of $P$ from $u$ to $v$.
\end{definition}

It is easy to see that temporally repeated flows are feasible and fulfill strong flow conservation, see~\cite{Skutella2009survey}.
A classic result of Ford and Fulkerson~\cite{ford1958constructing} 

\daniel[inline]{todo Daniel: Ford Fulkerson Algo, max s-d flow}



\begin{proof}
    To demonstrate the existence of an optimal state exhibiting the specified properties, it is first necessary to recognize that every state can be interpreted as a continuous dynamic flow (flow over time) within the same network and edge capacities of one in which all particles arrive at $d$ before $C(S^*)$:
    
    Let $S=(P_{(1)}, \ldots, P_{(n)})$ be a state. We start with $f_e(\theta)=0$ for all $\theta$ and $e\in E$. If a packet uses an edge $e=(u,v)$ at time $\theta$ we set $f_e(\theta)=1$ in the interval $[\theta,\theta +1)$. Packets have to wait at the start of edges since only one packet is allowed to start traversing the edges at any time.
    Notice that the capacity restrictions are hereby complied with, i.e., $0\leq f_e(\theta)\leq 1$ for all $\theta$.
    Let $\theta \in \N_{\geq 0}$. Then $\int_{0}^{\theta-\tau(e)} f_e(\xi) d\xi$ is the amount of packets, that started traversing $e$ in the time from 0 to $\theta-\tau(e) -1$. Hence, $\sum_{e\in \delta^-(v)} \int_0^{\theta -\tau(e)} f_e(\xi) d\xi - \sum_{e\in \delta^+(v)} \int_0^{\theta} f_e(\xi) d\xi$ is the amount of packets that arrived at $v$ until $\theta -1$ minus the amount of packets that left $v$ until the time $\theta -1$. Obviously, this is positive and hence the weak flow conservation is fulfilled and it is a feasible flow. Clearly all flow particles arrive at $d$ in the time period $[\min_{i\in N} C_i(S), (\max_{i\in N} C_i(S)) +1)$. Therefore we have, that every state can be interpreted as a dynamic flow in the same network where every particle arrives at $d$ before $C(S)$.

    As explained for instance in~\cite{DBLP:conf/bonnco/Skutella08}\todo{komische Formulierung}, an earliest arrival flow, i.e., a flow that maximizes simultaneously for every time the number of packets that have arrived at $d$ until then, can be constructed as follows:
    \begin{enumerate}
        \item Let $x_p=0$ for all $P\in \overset{\leftrightarrow}{P}$, where $\overset{\leftrightarrow}{P}$ are paths in the bidirectional network, where we introduce for every edge $e=(u,v)$ a backward edge $e=(v,u)$. $x$ is therefore a static $s-d$ flow with generalized path decomposition $(x_P)_{P\in \overset{\leftrightarrow}{P}}$.
        \item WHILE $dist_x(s,d)<T$:\\
        $\qquad$ Search for a shortest $s-d$ path $P$ in the residual graph $G_x$ of $x$ and increase $x_P$ by the residual capacity of $P$.
        \item Return generalized temporally repeated flow $f$ for $(x_P)_{P\in \overset{\leftrightarrow}{P}}.$
    \end{enumerate}
    
    Fix an arbitrary optimal state $\Tilde{S}^*$. By construction, there is a flow over time that sends flow of mass $n$ from $s$ to $d$ until time $C(\Tilde{S}^*)+1$. In particular, the earliest arrival flow $f$ from above does this. As $G(\Gamma)$ is a linear multigraph and thus in particular a serial-parallel graph, only forward edges will be used in the algorithm. Hence, the resulting flow of the algorithm is a temporally repeated flow, i.e., it sends over edge-disjoint paths $P^1,\ldots, P^k$ a flow with static flow value of 1 in the time interval $[0, C(S)-\tau(P^j))$ for any $j\leq k$. Since all $\tau(e)$ and $C(\Tilde{S}^*)$ are integers, the flow $f$ is piecewise constant with a jump at an integer value at $C(\Tilde{S}^*)-\tau(P^j)-1$ on the from $s$ outgoing edge $e$ with $e\in P^j$.
    We construct an optimum state $S^*$ by sending a packet over an edge $e$ at time $t$ with a flow value of 1 in the interval $[t,t+1)$. Since $f$ is temporally repeated, it fulfills the strong flow conservation and, hence, no packet is ever waiting at any intermediate node. Since the last flow particle in $f$ arrives at time $C(\Tilde{S}^*)+1$ at $d$, the last packet in $S^*$ arrives at $d$ at $C(\Tilde{S}^*)$, i.e., $C(S^*) = C(\Tilde{S}^*)$. Let $n'$ be the number of packets we have sent in $S^*$ so far. If $n'> n$, we have $n' = j + n$ for some $j\leq k-1$, since otherwise $\Tilde{S}^*$ would not be optimal. To send the right amount of packets, we delete from each of the paths $P^k,P^{k-1},\ldots, P^{k-j+1}$ the last packet. Since $f$ is feasible also $S^*$ is feasible. We have now constructed an optimal state with $S^*$ that fulfills all the aforementioned properties.
\end{proof} 
\fi


















% The first step in calculating the PoA and the PoS is understanding an optimal strategy profile. To do this, we consider an IP that allows us to compute the flow-maximal integer flow for a given time horizon $T$ in a given graph. The idea of the IP is to restrict the flows on the edges with the edge capacities. As a result, there are no queues. The following Theorem states that there is an integer solution of such a form that maximizes the flow.

% \begin{theorem}\label{satz_IP1}
% The following LP has an integer solution $OPT$ for a given time horizon $T$.%, which is a flow-maximal integer flow.
% \begin{align*}
%     &\max &&T|f| - \sum_{e\in E} \tau_e f_e\\
%     &s.t. && 0\leq f_e \leq 1 &&\forall e\in E\\
%     &&& \text{Flow conservation conditions}
% \end{align*}
% \end{theorem}
% \begin{proof}
% \begin{enumerate}
%     \item Integer flow $\leq$ Continuous flow
%     \item Continuous flow over time can be calculated using the LP above (Ford and Fulkerson 58).
%     \item This LP has an integer solution because TuM.
%     \item Integer solution corresponds to integer flow.
% \end{enumerate}
% \end{proof}
% In the following, we will always consider such a flow pattern when we talk about an optimal state $S^*$. Note, that there might be other optimal states.
% \todo[inline]{We can construct OPT in whatever manner we like. We need a citation for that or proof it. 
% We want to use it in this fashion: "This is because we know that the $OPT$ has the structure of a temporally repeated flow where we can arrange the paths in any way we like. If we construct the $j$-th path as the concatenation of the $j$-th smallest edges in each layer, at least one player will use the longest path and therefore take $\sum\limits_{i=1}^k \tau_i^{m}$ time. The last player arriving at $t$ in $OPT$ will take at least that long." }


