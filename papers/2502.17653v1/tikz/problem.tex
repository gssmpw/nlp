\begin{tikzpicture}[
%	code/.style={draw,align=center,minimum height=3.5cm, minimum width=3cm},
	cond/.style={rounded corners,draw,align=left,minimum height=1.1cm},
	contrib/.style={rounded corners,draw,align=center,minimum height=2.7cm},
	node distance=0.3cm,
	font=\footnotesize,
	]
	%%%%%%%% Attestation %%%%%%%%%%%%%%%%%
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% Code
	\node[text width = 6cm] (code) at (0,0) {
		\begin{minipage}{\textwidth}
			\begin{minted}[breaklines,autogobble]{C++}
				return SignAttestInfo(
				          signObject,
				          &in->inScheme,
				          &quoted,
				          &in->qualifyingData,
				          &out->quoted,
				          &out->signature)
			\end{minted}
		\end{minipage}
	 };

	% Pre
	\node[] (pre0) [above right = 1.1cm and -6.5cm of code] {
    \textbf{Signature Scheme Assumptions}
	};
	\node[] (pre1) [below right = -0.05cm and 0cm of pre0.south west] {
    - $\forall sig\;:sig:= Sign(sk,m)\;\rightarrow (Ver(sig,pk,msg)=true)$
	};
	\node[] (pre2) [below right = -0.1cm and 0cm of pre1.south west] {
		- $\forall sig\;:Ver(sig,pk)=true\;\rightarrow (sig\leftarrow Sign(sk,m))$
	};
  \draw[draw=SomeRed, rounded corners]
  ([xshift=-0.01cm,yshift=0.01cm]pre0.north west) -|
  ([xshift=0.01cm,yshift=0.1cm]pre1.east);
  \draw[draw=SomeRed, rounded corners]
  ([xshift=0.01cm,yshift=-0.1cm]pre1.east) --
  ([xshift=0.01cm,yshift=-0.3cm]pre1.east);
  \draw[draw=SomeRed, rounded corners]
  ([xshift=0.01cm,yshift=-0.5cm]pre1.east) |-
  ([xshift=-0.01cm,yshift=-0.01cm]pre2.south west) --
  ([xshift=-0.01cm,yshift=0.01cm]pre0.north west);

	% Post
	\node[] (post0) [below right = 1.1cm and -6.5cm of code] {
    \textbf{Remote Attestation Implications}
	};
	\node[] (post1) [above right = -0.05cm and 0cm of post0.north west] {
    - $\forall att\;:att:= Attest(sk,m)\;\rightarrow (Ver^a(att,pk,m)=true)$
  };
	\node[] (post2) [above right = -0.1cm and 0cm of post1.north west] {
    - $\forall att\;:Ver^a(att,pk,m)=true\;\rightarrow (att\leftarrow Attest(sk,m))$
	};
  \draw[draw=SomeRed, rounded corners]
  ([xshift=-0.01cm,yshift=-0.01cm]post0.south west) -|
  ([xshift=0.01cm,yshift=-0.1cm]post1.east);
  \draw[draw=SomeRed, rounded corners]
  ([xshift=0.01cm,yshift=0.1cm]post1.east) --
  ([xshift=0.01cm,yshift=0.3cm]post1.east);
  \draw[draw=SomeRed, rounded corners]
  ([xshift=0.01cm,yshift=0.5cm]post1.east) |-
  ([xshift=-0.01cm,yshift=0.01cm]post2.north west) --
  ([xshift=-0.01cm,yshift=-0.01cm]post0.south west);

	% Contributions
	\node[] (contrib0) [above right = -1cm and -1.7cm of code] {
		\textbf{Our Contributions}
  };
 	\node[] (contrib1) [below right = -0.05cm and 0cm of contrib0.south west] {
		Functional Correctness (\textcolor{SomeGreen}{\checkmark})
	};
 	\node[] (contrib2) [below right = -0.1cm and 0cm of contrib1.south west] {
		Indistinguishability (\textcolor{SomeGreen}{\indist})
	};

  \node[] (coq) [above right = -0.4cm and 0.05cm of contrib0] {
    \includegraphics[width=0.063\columnwidth]{figures/coq.png}
  };

  \draw[draw=SomeGreen, rounded corners]
  ([xshift=-0.01cm,yshift=0.01cm]contrib0.north west) --
  (coq.west);
  \draw[draw=SomeGreen, rounded corners]
  (coq.east) -|
  ([xshift=0.01cm,yshift=0.1cm]contrib1.east);
  \draw[draw=SomeGreen, rounded corners]
  ([xshift=0.01cm,yshift=-0.1cm]contrib1.east) |-
  ([xshift=-0.01cm,yshift=-0.01cm]contrib2.south west) --
  ([xshift=-0.01cm,yshift=-0.1cm]contrib2.west);
  \draw[draw=SomeGreen, rounded corners]
  ([xshift=-0.01cm,yshift=0.1cm]contrib2.west) --
  ([xshift=-0.01cm,yshift=0.01cm]contrib0.north west);


  %% Connections
  % Correctness
  \draw[dashed,SomeGreen] ([xshift=0.02cm]contrib1.east) --
  ([xshift=0.1cm]contrib1.east) |-
  ([xshift=0.02cm]pre1.east);
  \draw[dashed,draw=SomeGreen]
  ([xshift=0.1cm]contrib1.east) |-
  ([xshift=0.02cm]post1.east);

  % Indistinguishability
  \draw[dashed,SomeGreen]
  ([xshift=-0.02cm]contrib2.west) -|
  ([xshift=-0.2cm,yshift=0.2cm]contrib0.north west) --
  ([xshift=0.2cm,yshift=0.2cm]contrib0.north east) |-
  ([xshift=0.02cm]pre2.east);
  \draw[dashed,SomeGreen]
  ([xshift=-0.2cm]contrib2.west) |-
  ([xshift=0.1cm,yshift=-0.2cm]contrib2.south east) |-
  ([xshift=0.02cm]post2.east);

  % Assumptions
  \draw[dashed,SomeRed]
  ([xshift=0.2cm,yshift=-0.01cm]pre2.south west) |-
  ([xshift=1.2cm,yshift=-1.1cm]pre2.south west);

  % Implications
  \draw[dashed,SomeRed]
  ([xshift=0.2cm,yshift=0.01cm]post2.north west) |-
  ([xshift=1.2cm,yshift=0.5cm]post2.north west);
\end{tikzpicture}


