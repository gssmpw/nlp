\section{From Theory to Framework: A Discussion on Indistinguishability for Libraries}
\label{sec:imply}
%
%\begin{minipage}[b]{.67\textwidth}\centering
%\begin{table}[p]
  %\centering
 % \begin{tabular}{ |p{1in}|p{1in}|p{1in}|p{1in}|p{1in}|p{1in}|}
 %   \hline
 %   \rowcolor{lightgray} \textbf{} & \textbf{ElGamal} & \textbf{PRF} & \textbf{KEMDEM} & \textbf{\Sigma protocol} & \textbf{Our Proofs} \\
%    \hline
 %   \textit{No. Lib Procedures} & xxx & aaa & bb & cc & dd \\
 %   \hline
 %   \textit{Ideal Model State} & None & Local & Distribution & Distribution & None \\
 %   \hline
 %   \textit{Construction} & Asymmetric encryption & Symmetric encryption 
 %   & Public key encryption 
 %   & \Sigma-protocol zero-knowledge 
%    & Semantic security \\
 %   \hline 
%    \textit{Main Security Theorem} 
 %   & Reduces \emph{one-time}-CPA security of ElGamal to DDH problem 
 %   & Indist (IND-CPA) by bounding $\mathcal{A}$'s advantage  
 %   & Indist by reducing $\mathcal{A}$'s advantage to the security of underlying primitives. KEM and DEM are secure against chosen ciphertext (IND-CCA). 
 %   & Indist in the context of zero-knowledge proof. Convert the class of \Sigma protocol into a commitment scheme  
 %   & Reduces the security of \ra to the security of digital signatures \\ 
 %   \hline
 % \end{tabular}
 % \caption{IND formalization examples in \ssprove}\label{tab:ind-lib}
%\end{table}
%\end{minipage}
%In this paper, we formally specified digital signatures as the foundation of remote attestation in the theorem prover \coq.
%To the best of our knowledge, we are the first to do so in the context of game-based proofs that rely on
%the security notion of indistinguishability.
%
During our formal development, we noticed a difference between the traditional definitions in the textbook~\cite{joy}
on indistinguishable signatures and SSProve, a framework 
that followed such a textbook to implement formal indistinguishability reasoning. 
%
There exist two perspectives: one of the textbook authors, 
i.e., leading cryptographers, and one of the authors of
\ssprove, i.e., leading experts in the design of formal
reasoning tools and programming languages.
%
We present the views and then discuss their implications.
%

\subsection{Indistinguishable Signatures in Textbooks}
%
The textbook definitions of indistinguishability for digital signatures lack precision. 
%
The definition of the \emph{game pair} for digital signatures
in Figure~\ref{fig:problem:ind} of Section~\ref{sec:TheoryFound}
follows the textbook ``The Joy of Cryptography'' (\joc)~\cite{joy} and
``Companion to Cryptographic Primitives, Protocols and Proofs'' (\companion)~\cite{companion}.
%
\joc defines the advantage of an adversary exactly as \ssprove does, 
and the \companion follows a comparable approach. 
%
%\begin{minted}[escapeinside=@@]{Coq}
%Definition Adv A G@$_1$@ G@$_2$@ := @$|$@ A @$\circ$@ G@$_1$@ - A @$\circ$@ G@$_2$@ @$|$@.
%\end{minted}
%
%The definition in the \companion is similar.
%
\joc acknowledges that packages are essentially an
abstraction for libraries, as in languages such as Java, 
which may have more than one procedure (see Definition~2.3).
%
The \companion explicitly refers to these procedures as oracles (see Section~2.3).
%
However, neither \joc nor \companion formally defines what it means for a package 
with multiple procedures to be indistinguishable, leading to a gap in the literature. 
%
To address this, we propose that indistinguishability in such settings should be 
defined based on the behavior of the adversary interacting with a real and an ideal package. 
%
Specifically, a signature scheme's real and ideal packages consist of three procedures: \egetpk, \esign, and \eversig. 
%
The adversary interacts with these procedures as a black-box access point within the library—yet existing 
literature abstracts over this interaction without providing formal proof of indistinguishability. 
%
Establishing such a definition ensures a rigorous foundation for reasoning about multi-procedure cryptographic games. 

\subsection{Indistinguishable Signatures in \ssprove}
\begin{figure}
	\centering
  \begin{subfigure}[0]{\columnwidth}
    \centering
    \input{tikz/versig-game}
    \caption{Game}
    \label{fig:versig:game}
  \end{subfigure}
\\[0.3cm]
	\begin{subfigure}[0]{0.7\columnwidth}
    \centering
%    \input{tikz/sig-prop}
		\begin{minted}[fontsize=\footnotesize,escapeinside=@@,autogobble]{coq}
      @$\forall$@ pk m S s, VerSig pk s m = ((m, s) @$\in$@ S)
		\end{minted}

    \caption{Property}
    \label{fig:versig:prop}
  \end{subfigure}

	\caption{
    %
    The game for the \eversig procedure requires a
    property that cannot be instantiated.
    %
  }
	\label{fig:versig}
\end{figure}

%
The \ssprove authors followed the \joc textbook, adapting its indistinguishability
definifions for implementation~\cite{ssprove}\footnote{\url{https://github.com/SSProve/ssprove/tree/main/theories/Crypt/examples}}.
%
%and implemented various examples from the book~\cite{ssprove2021}\footnote{\url{https://github.com/SSProve/ssprove/tree/main/theories/Crypt/examples}}.
%
Of course, for the implementation of \ssprove, the authors
had to be specific about what it means for a library to be a 
indistinguishable.
%
They chose the most natural definition:
two libraries are indistinguishable when each of their
procedures are indistinguishable.
%
Hence, an adversary package's advantage is essentially
accumulating the advantages for the individual procedures.
%
However, that has severe implications for the definition
of indistinguishability for digital signatures.
%

%
Recall the definition of \eversig from the game in Figure~\ref{fig:sigprim:packages}, 
now shown in Figure~\ref{fig:versig:game}, with a better view for readers. 
%
The indistinguishability proof requires the property in Figure~\ref{fig:versig:prop} to hold.
%According to the indistinguishability proof, the property must eventually be in Figure~\ref{fig:versig:prop}.
%
However, this property can never be established—only 
the right-hand side of the property talks about
the set of already generated signatures \mintinline{Coq}{S}.
%
The property misses the assumption that
the signature ($s$) was generated by
a call to \esign.
%
Consequently, existing textbook definitions cannot prove the 
indistinguishability of signature primitives in isolation. 
%As a result, the definition as presented in the textbooks cannot be proven.
%That is, the primitives of a signature scheme cannot be proven individually. \todo{Jannik: unclear sentence (from the property misses..)}
%Only the protocol, as stated in Figure~\ref{fig:problem:eu-ind} of Section~\ref{sec:TheoryFound} can be proven indistinguishable.
%
Instead, only complete protocols—such as the one in Figure~\ref{fig:problem:eu-ind} 
of Section~\ref{sec:TheoryFound}—can be rigorously proven indistinguishable.

\subsection{Discussion}
%
Two options exist to resolve this inconsistency.
%
On the one hand, it may be that the cryptographers
intuitively meant that signatures can only ever be
generated by \esign.
%
If that is the case, frameworks such as \ssprove
would have to change and add such an assumption
into the context for the proof of \eversig.
%
Indeed, the Diffie-Hellman Key Exchange and ElGamal 
definition has the protocol stated explicitly
(see Chapters~14 and 15).
%
On the other hand, at least for signature schemes,
the according proof would be very much the same
as stated in our protocol definition.
%
As such, adjusting them according to textbook sections might be justified.
%
We do not take a side at this point and leave it
as a discussion to the community.
%

However, this discussion of discrepancy is an important issue for future research. 
%
We all know that traditional cryptographic textbooks generally present abstract definitions 
and omit some implementation steps for simplification. 
%
However, these definitions are becoming very difficult to build our 
intuition upon, and they deviate from the rigorous demands 
of the proof framework, which requires detailed and precise formalization of these definitions. 
%
Furthermore, our formal development also shows the proof phase related to indistinguishability that, 
to our knowledge, has not been previously addressed by SSProve experts in their existing examples. 
%
This highlights a gap, and we try our best to bridge it through our proof engineering. 
%

During our formal development, we successfully proved the 
indistinguishability of \real and \ideal games for most routines. 
%
However, one invariant \texttt{sig\_inv} fails in the initial state. 
%
This structural mismatch appears because the invariant assumes an operational 
state with initialized keys and mappings for signed operations. 
%
Nevertheless, the empty state lacks these structures, which leads to a 
semantic gap that prevents the invariant from being proven. 
%
This structural mismatch does not affect our security guarantees.
%
In practical systems, when the protocol starts, the controlled initialization ensures the invariant holds, 
which makes the empty state irrelevant to operational security. 
%
%
%\begin{table}%[p] \centering
 % \begin{tabular}{ | p{0.58in} | p{1.4in} | p{1.2in} |}
 %   \hline
 %   \textbf{Aspects} & \textbf{Our proof development} & \textbf{\ssprove examples} \\[0.5ex] 
 %   \hline
 %    \textit{Packages} & Tend to focus on multi-purpose packages 
 %                       to integrate multi procedures to attain 
 %                       complex functionalities.
 %                      & Tend to focus on single-purpose packages, 
 %                      dedicated to specific cryptographic primitives. \\
 %                      %\hline
 %     \textit{Challenges} & Specific case (\ra) and introduced protocol-specific 
  %                          invariants which is difficult with reasonings.
 %                         & Proofs are based on game-hopping with simpler transitions. \\
 %     \textit{Focus}   &  Manual and customized lemmas for libraries, 
 %                         the indistinguishability spans across multiple 
 %                        exported procedures and adversary's cases.
 %                      & Generic cryptographic primitives and limited 
%                         to reason about isolated procedures calls. \\              
%     \hline
%  \end{tabular}
%\end{table}



%


%\todo{go to elgamal, see if they do the indistinguishability: would they have the same problem as we (protcol thing / definition insufficien)}
%\todo{look at ref. 15, see if they have encountered the same protocol-primitive problems (same as above in elgamal)}


