
\newlength{\modelwidth}
\setlength{\modelwidth}{0.16\textwidth}
\newlength{\valuewidth}
\setlength{\valuewidth}{0.07\textwidth}
\renewcommand{\arraystretch}{1.2}
\newcommand{\tab}{\phantom{ }\phantom{ }\phantom{ }\phantom{ }}




\newif\ifshowtodos
\showtodostrue  %




\newcommand{\tablecaptionappendix}{We run 100 trials per difficulty setting and model. We require a 70\% success rate to pass a variant.}



\newcommand{\fullcircle}{\ensuremath{{\bullet}}}
\newcommand{\halfcircle}{%
  \tikz[baseline=-0.5ex]\fill[draw,circle,radius=0.4ex] (0,0) -- (0,-0.4ex) arc [start angle=270, end angle=90, radius=0.4ex] -- cycle;%
}
\newcommand{\emptycircle}{\ensuremath{\circ}}

\newcommand{\levelzero}{\emptycircle \emptycircle \emptycircle\xspace}
\newcommand{\levelone}{\fullcircle \emptycircle \emptycircle\xspace}
\newcommand{\leveltwo}{\fullcircle \fullcircle \emptycircle\xspace}
\newcommand{\levelthree}{\fullcircle \fullcircle \fullcircle\xspace}



\newcommand{\canscheme}{{\color{apolloblue}$\checkmark$\xspace}}
\newcommand{\cannotscheme}{{\color{darkgray1}$\times$\xspace}}


\definecolor{lightgray1}{gray}{0.9}
\definecolor{lightgray2}{gray}{0.85}
\definecolor{lightgray3}{gray}{0.8}
\definecolor{lightgray4}{gray}{0.75}
\definecolor{lightgray5}{gray}{0.7}
\newcommand{\tablezero}{\textcolor{lightgray3}{0}}

\definecolor{usergreen}{RGB}{65, 125, 100}
\definecolor{assistantblue}{RGB}{77, 166, 255}
\definecolor{systemgray}{named}{lightgray5}
\definecolor{toolcallblue}{RGB}{0, 76, 153}
\definecolor{toolresponsegreen}{RGB}{55, 100, 80}
\definecolor{developergray}{named}{lightgray5}
\definecolor{elicitedsummaryblue}{RGB}{30, 100, 150}
\definecolor{darkgray1}{gray}{0.1}
\definecolor{passingcolor}{RGB}{204, 229, 255} %
\definecolor{nonpassingcolor}{named}{lightgray1}

\definecolor{sentinalblue}{RGB}{56, 87, 35}
\definecolor{sentinalbluelight}{RGB}{240, 247, 236}
\definecolor{systemred}{RGB}{94, 10, 72}
\definecolor{systemredlight}{RGB}{245, 234, 239}
\definecolor{stateupdateblue}{RGB}{46, 117, 182}
\definecolor{stateupdatebluelight}{RGB}{238, 245, 251}


\tcbset{toolcallstyle/.style={
  breakable,
  enhanced,
  colframe=toolcallblue,
  colback=toolcallblue!20,
  attach boxed title to top right={yshift=-0.15cm},
  boxed title style={
    colback=toolcallblue,
    sharp corners,
    top=3pt, bottom=3pt, left=3pt, right=3pt,
  },
  fonttitle=\sffamily\footnotesize\bfseries,
  title=AssistantToolCall,
  before upper={\vspace{0.3cm}},
  width=0.9\textwidth,
  enlarge left by=0.1\textwidth,
  halign=left,
  left=2mm, right=2mm, top=1mm, bottom=1mm,
  boxrule=0.4mm,
  coltext=black,
  fontupper=\normalfont
  }
}

\newtcolorbox{toolcallbox}[1][]{toolcallstyle,#1}

\tcbset{toolresponsestyle/.style={
  breakable,
  enhanced,
  colframe=toolresponsegreen,
  colback=toolresponsegreen!20,
  attach boxed title to top left={yshift=-0.15cm},
  boxed title style={
    colback=toolresponsegreen,
    sharp corners,
    top=3pt, bottom=3pt, left=3pt, right=3pt,
  },
  fonttitle=\sffamily\footnotesize\bfseries,
  title=ToolResponse,
  before upper={\vspace{0.3cm}},
  width=0.9\textwidth,
  halign=left,
  left=2mm, right=2mm, top=1mm, bottom=1mm,
  boxrule=0.4mm,
  coltext=black,
  fontupper=\normalfont
  }
}

\newtcolorbox{toolresponsebox}[1][]{toolresponsestyle,#1}





\tcbset{userstyle/.style={
  breakable,
  enhanced,
  colframe=usergreen,
  colback=usergreen!20,
  attach boxed title to top left={yshift=-0.15cm},
  boxed title style={
    colback=usergreen,
    sharp corners,
    top=3pt,
    bottom=3pt,
    left=3pt,
    right=3pt,
    },
  fonttitle=\sffamily\footnotesize\bfseries,
  title=User,
  before upper={\vspace{0.3cm}},
  width=0.9\textwidth,
  halign=left,
  left=2mm,
  right=2mm,
  top=1mm,
  bottom=1mm,
  boxrule=0.4mm,
  coltext=black,
  fontupper=\normalfont
  }
}

\newtcolorbox{userbox}[1][]{userstyle,#1}

\tcbset{assistantstyle/.style={
  breakable,
  enhanced,
  colframe=assistantblue,
  colback=assistantblue!20,
  attach boxed title to top right={yshift=-0.15cm},
  boxed title style={
    colback=assistantblue,
    sharp corners,
    top=3pt,
    bottom=3pt,
    left=3pt,
    right=3pt,
    },
  fonttitle=\sffamily\footnotesize\bfseries,
  title=Assistant,
  before upper={\vspace{0.3cm}},
  width=0.9\textwidth,
  enlarge left by=0.1\textwidth,
  halign=left,
  left=2mm,
  right=2mm,
  top=1mm,
  bottom=1mm,
  boxrule=0.4mm,
  coltext=black,
  fontupper=\normalfont
  }
}

\newtcolorbox{assistantbox}[1][]{assistantstyle,#1}

\tcbset{systemstyle/.style={
  breakable,
  enhanced,
  colframe=systemgray,
  colback=systemgray!20,
  attach boxed title to top left={yshift=-0.15cm},
  boxed title style={
    colback=systemgray,
    sharp corners,
    top=3pt,
    bottom=3pt,
    left=3pt,
    right=3pt,
    },
  fonttitle=\sffamily\footnotesize\bfseries,
  title=System,
  before upper={\vspace{0.3cm}},
  width=0.9\textwidth,
  halign=left,
  left=2mm,
  right=2mm,
  top=1mm,
  bottom=1mm,
  boxrule=0.4mm,
  coltext=black,
  fontupper=\normalfont
  }
}

\newtcolorbox{systembox}[1][]{systemstyle,#1}








\tcbset{developerstyle/.style={
  breakable,
  enhanced,
  colframe=developergray,
  colback=developergray!20,
  attach boxed title to top left={yshift=-0.15cm},
  boxed title style={
    colback=developergray,
    sharp corners,
    top=3pt, bottom=3pt, left=3pt, right=3pt,
  },
  fonttitle=\sffamily\footnotesize\bfseries,
  title=Developer,
  before upper={\vspace{0.3cm}},
  width=0.9\textwidth,
  halign=left,
  left=2mm, right=2mm, top=1mm, bottom=1mm,
  boxrule=0.4mm,
  coltext=black,
  fontupper=\normalfont
  }
}

\newtcolorbox{developerbox}[1][]{developerstyle,#1}



\tcbset{elicitedsummarystyle/.style={
  breakable,
  enhanced,
  colframe=elicitedsummaryblue,
  colback=elicitedsummaryblue!20,
  attach boxed title to top right={yshift=-0.15cm},
  boxed title style={
    colback=elicitedsummaryblue,
    sharp corners,
    top=3pt, bottom=3pt, left=3pt, right=3pt,
  },
  fonttitle=\sffamily\footnotesize\bfseries,
  title=Elicited Summary of CoT,
  before upper={\vspace{0.3cm}},
  width=0.9\textwidth,
  enlarge left by=0.1\textwidth,
  halign=left,
  left=2mm, right=2mm, top=1mm, bottom=1mm,
  boxrule=0.4mm,
  coltext=black,
  fontupper=\normalfont
  }
}

\newtcolorbox{elicitedsummarybox}[1][]{elicitedsummarystyle,#1}






\newlength{\boxwidthratio}
\setlength{\boxwidthratio}{0.95\textwidth}  %

\newlength{\boxenlargement}
\setlength{\boxenlargement}{0.05\textwidth}  %

\newcommand{\setboxwidth}[1]{%
  \setlength{\boxwidthratio}{#1\textwidth}%
  \setlength{\boxenlargement}{\dimexpr1\textwidth-#1\textwidth\relax}%
}


\newlength{\smallboxpaddingtop}
\setlength{\smallboxpaddingtop}{0.9mm}  %
\newlength{\smallboxpaddingbottom}
\setlength{\smallboxpaddingbottom}{0.5mm}
\newlength{\smallboxmargintop}
\setlength{\smallboxmargintop}{0.1mm}  %
\newlength{\smallboxmarginbottom}
\setlength{\smallboxmarginbottom}{0.1mm}

\newtcolorbox{smallresultbox}[1][]{
  breakable,
  enhanced,
  colframe=darkgray1!85,
  colback=developergray!40,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  width=\textwidth,
  attach boxed title to top left={yshift=-0.08cm},
  title=Result,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=darkgray1!85,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{smallsentinalbox}[1][]{
  breakable,
  enhanced,
  colframe=sentinalblue,
  colback=sentinalbluelight,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  width=\textwidth,
  attach boxed title to top right={yshift=-0.08cm},
  title=Agent,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=sentinalblue,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{smallsystembox}[1][]{
  breakable,
  enhanced,
  colframe=systemred!80,
  colback=systemredlight,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  width=\textwidth,
  attach boxed title to top left={yshift=-0.08cm},
  title=System,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=systemred!80,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{smalldeveloperbox}[1][]{
  breakable,
  enhanced,
  colframe=developergray,
  colback=developergray!20,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  width=\boxwidthratio,
  attach boxed title to top left={yshift=-0.08cm},
  title=Developer,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=developergray,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{smalltoolcallbox}[1][]{
  breakable,
  enhanced,
  colframe=toolcallblue,
  colback=toolcallblue!20,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  width=\boxwidthratio,
  attach boxed title to top right={yshift=-0.08cm},
  title=AssistantToolCall,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=toolcallblue,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{smallstateupdatebox}[1][]{
  breakable,
  enhanced,
  colframe=stateupdateblue,
  colback=stateupdatebluelight,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  width=\textwidth,
  attach boxed title to top left={yshift=-0.08cm},
  title=State Update,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=stateupdateblue,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

  \newtcolorbox{smallinitialstatebox}[1][]{
  breakable,
  enhanced,
  colframe=stateupdateblue,
  colback=stateupdatebluelight,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  width=\textwidth,
  attach boxed title to top left={yshift=-0.08cm},
  title=Initial State,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=stateupdateblue,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{smallelicitedsummarybox}[1][]{
  breakable,
  enhanced,
  colframe=elicitedsummaryblue,
  colback=elicitedsummaryblue!20,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  width=\boxwidthratio,
  enlarge left by=\boxenlargement,
  attach boxed title to top right={yshift=-0.08cm},
  title=Elicited Summary of CoT,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=elicitedsummaryblue,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}




\newtcolorbox{promptbox}[1][]{%
  colback=gray!10,
  colframe=gray!10,
  rounded corners,
  arc=10pt,
  boxrule=0pt,
  width=\textwidth,
  enhanced jigsaw,
  breakable,
  fontupper=\ttfamily\color{black}\small, 
  before upper={\ttfamily\color{black}\small}, 
  parbox=false,
  use color stack,
  #1
}

\lstset{
    language=Python,
    basicstyle=\ttfamily\small,
    commentstyle=\color{gray}\itshape,
    keywordstyle=\color{blue},
    stringstyle=\color{red},
    numbers=left,
    numberstyle=\tiny\color{gray},
    stepnumber=1,
    numbersep=5pt,
    showstringspaces=false,
    breaklines=true,
    frame=single
}





\newcounter{transcript}
\newenvironment{transcript}[1][]{%
    \refstepcounter{transcript}%
    \ifx\\#1\\%
        \label{transcript:\thetranscript}%
    \else%
        \label{#1}%
    \fi%
    \par\medskip\noindent%
    \textbf{Transcript \thetranscript}\par\nopagebreak%
}{%
    \par\medskip%
}

\def\transcriptautorefname{Transcript}

\newcounter{transcriptrownumber}

\renewcommand{\thetranscriptrownumber}{\arabic{transcriptrownumber}}

\newcommand{\transcriptrownumberautorefname}{Transcript No.}



\newtcolorbox{figureuserbox}[1][]{
  enhanced,
  colframe=usergreen,
  colback=usergreen!20,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  attach boxed title to top left={yshift=-0.08cm},
  title=User,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=usergreen,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{figureassistantbox}[1][]{
  enhanced,
  colframe=assistantblue,
  colback=assistantblue!20,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  attach boxed title to top right={yshift=-0.08cm},
  title=Assistant,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=assistantblue,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{figuresystembox}[1][]{
  enhanced,
  colframe=systemgray,
  colback=systemgray!20,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  attach boxed title to top left={yshift=-0.08cm},
  title=System,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=systemgray,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{figuredeveloperbox}[1][]{
  enhanced,
  colframe=developergray,
  colback=developergray!20,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  attach boxed title to top left={yshift=-0.08cm},
  title=Developer,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=developergray,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{figuretoolcallbox}[1][]{
  enhanced,
  colframe=toolcallblue,
  colback=toolcallblue!20,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  attach boxed title to top right={yshift=-0.08cm},
  title=AssistantToolCall,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=toolcallblue,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{figuretoolresponsebox}[1][]{
  enhanced,
  colframe=toolresponsegreen,
  colback=toolresponsegreen!20,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  attach boxed title to top left={yshift=-0.08cm},
  title=ToolResponse,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=toolresponsegreen,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}

\newtcolorbox{figureelicitedsummarybox}[1][]{
  enhanced,
  colframe=elicitedsummaryblue,
  colback=elicitedsummaryblue!20,
  coltext=black,
  boxrule=0.4mm,
  left=1mm, right=1mm, 
  top=\smallboxpaddingtop, bottom=\smallboxpaddingbottom,
  fontupper=\scriptsize,
  before upper={\strut},
  after upper={},
  before={\vspace{\smallboxmargintop}},
  after={\vspace{\smallboxmarginbottom}},
  boxsep=0pt,
  attach boxed title to top right={yshift=-0.08cm},
  title=Elicited Summary of CoT,
  fonttitle=\sffamily\scriptsize\bfseries,
  boxed title style={
    colback=elicitedsummaryblue,
    sharp corners,
    top=1pt, bottom=1pt, left=1pt, right=1pt,
  },
  #1}


