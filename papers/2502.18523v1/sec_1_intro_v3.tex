%\vspace{-6pt}
\section{Introduction}
\label{sec:intro}
\input{fig_problem}
\textbf{Background.} 
Brain imaging analysis, particularly in using structural neuroimaging, has become a widely adopted paradigm in neuroscience, supporting applications such as anatomical studies~\cite{zhang2024brant,yin2023multi,papalexakis2014good},
multi-modality fusion~\cite{cai2018deep}, brain signal reconstruction~\cite{luo2024brain,scotti2024reconstructing}, diagnostic assistance~\cite{sun2009mining,huang2011brain}, and clinical interpretation~\cite{li2021braingnn}.
This analysis typically involves multiple processing tasks, including brain extraction (\emph{a.k.a.} skull stripping), registration, segmentation, parcellation, network generation, and classification. 
Brain extraction removes non-brain tissues (\eg skull and dura) from an imaging scan, while registration aligns the extracted brain with a standard template. Segmentation focuses on tissue classification, dividing the brain into broad tissue types such as gray matter, white matter, and cerebrospinal fluid (CSF). Parcellation further subdivides the brain into smaller, anatomically distinct regions, such as the frontal, temporal and occipital lobes. Network generation constructs a brain network based on the connectivity among these parcellated regions, and classification is used for clinical prediction. These tasks serve as fundamental steps in many structural neuroimaging studies.

% labels brain tissue types (\eg gray matter, white matter) in the raw imaging scan, and parcellation further subdivides the brain into smaller, more specific regions (\eg frontal lobe, temporal lobe) based on functional, structural, or connectivity patterns; network generation constructs a brain network based on the connectivity among parcellated regions; finally, the classification focuses making clinical predictions. These tasks are preliminary but essential in many neuroimaging studies. 
For example, in brain anatomical analysis, extraction and registration assist in eliminating interference from non-cerebral tissues, imaging modalities, and differing viewpoints. Segmentation and parcellation enable the measurement and analysis of anatomical variations observed in specific brain tissues and regions.
Network generation and classification facilitate graph theory for interpretation and prediction. 
In disease diagnosis, the brain must first be extracted from raw imaging scans and aligned with a standard template (\eg MNI152) to eliminate inter-individual variations. Next, intra-individual structural abnormalities (\eg brain atrophy) across different pathological stages should be monitored through anatomical analysis (\eg identify the corresponding brain tissue and measure volumetric changes). At the group level, functional impairments (\eg frontal lobe decline) can be detected and interpreted by analyzing regional connectivity through brain network analysis. These comprehensive assessments play a crucial role in assisting physicians in making accurate and reliable diagnoses.

% \noindent\textbf{Problem Definition.} 

This paper aims to revolutionize current methodologies by establishing an integrated, end-to-end deep learning architecture, \textbf{UniBrain}, that streamlines and optimizes the entire brain image processing pipeline. 

In this paper, we study the problem of end-to-end learning for brain imaging tasks, as shown in Figure~\ref{fig:intro}. 
The objective is to explore how tasks like brain extraction, registration, segmentation, parcellation, network generation, and classification interrelate, aiming to mutually boost their efficacy with minimal labeled data. Specifically, we utilize low-cost labels (\ie extraction mask, classification label) and only one labeled template (\emph{a.k.a.} atlas) to perform all tasks simultaneously. Notably, our goal is to avoid using any of the instance-level ground-truth labels of registration, segmentation, parcellation, and network connectivity in model training.

\noindent\textbf{Related Works.} 
In the literature, related tasks in brain imaging analysis have been extensively studied. Conventional methods primarily focus on designing methods for brain extraction~\cite{kleesiek2016deep,lucena2019convolutional}, registration~\cite{sokooti2017nonrigid, su2022abn}, segmentation~\cite{akkus2017deep, kamnitsas2017efficient, chen2018voxresnet}, parcellation~\cite{thyreau2020learning,lim2022deepparcellation}, network generation~\cite{zhou2020toolbox,vskoch2022human} and classification~\cite{li2021braingnn,kawahara2017brainnetcnn, kan2022brain} separately under supervised settings. However, in brain imaging studies, the collection of voxel-level annotations, transformations between images, and task-specific brain networks often prove to be expensive, as it demands extensive expertise, effort, and time to produce accurate labels, especially for high-dimensional neuroimaging data, \eg 3D MRI. To reduce this high demand for annotations, recent works have utilized automatic extraction tools~\cite{smith2002fast,cox1996afni,shattuck2002brainsuite, segonne2004hybrid}, unsupervised registration models~\cite{balakrishnan2018unsupervised,su2022abn}, inverse warping~\cite{jaderberg2015spatial}, and correlation-based metrics~\cite{liang2012effects} for performing extraction, registration, segmentation, parcellation and network generation. Nevertheless, these pipeline-based approaches frequently rely on manual quality control to correct intermediate results before performing subsequent tasks. Conducting such visual inspections is not only time-consuming and labor-intensive but also suffers from intra- and inter-rater variability, thereby impeding the overall efficiency and performance. More recently, joint extraction-registration~\cite{su2022ernet}, joint registration-segmentation~\cite{xu2019deepatlas}, joint extraction-registration-segmentation~\cite{su2023one}, and joint network generation-classification~\cite{kan2022fbnetgen} have been developed for collective learning. However, partial joint learning overlooks the potential interrelationships among all tasks, which can adversely affect overall performance. 
%Related works are demonstrated in Table~\ref{tab: family}.

%\noindent\textbf{Challenges.} Three main challenges arise in the problem of end-to-end learning for brain imaging tasks.

%Despite its value and significance, the problem of end-to-end brain image analysis has not been studied before and is very challenging due to its unique characteristics listed below:

%\textbullet  \  
%\textit{Limited labeled information:} Conventional learning-based methods typically require a substantial collection of ground-truth labels for these tasks. However, acquiring detailed voxel-level labels (\eg tissue type, region location) and transformation labels in high-dimensional neuroimaging data is notably expensive and time-consuming. We minimize reliance on extensive labeling, using only the necessary label (\ie classification label) and a relatively low-cost label (\ie brain extraction masks). Although we provide a template image with its segmentation and parcellation masks (in template image space), the segmentation and parcellation masks (in raw image space) for the raw image are not available. Furthermore, the ground-truth brain network connectivity is also not provided.

%\textbullet  \  
%\textit{Dependencies among all tasks:} Conventional research often treats brain extraction, registration, segmentation, parcellation, network generation, and classification tasks separately. However, these tasks exhibit significant interdependencies: 1) effective extraction (\ie successful removal of non-brain tissue) allows the brain to precisely align to template image, thereby enhancing registration accuracy; 2) precise registration can accurately guide segmentation and parcellation through inverse transformation (\ie inversely warping template masks to the raw image space); 3) accurate parcellation contributes to consistent region divisions across subjects, crucial for generating robust brain networks; 4) networks that precisely capture brain connectivity can substantially improve classification and diagnosis outcomes. Therefore, a holistic approach is essential to manage these interdependencies effectively in an end-to-end framework.

%\textbullet  \  
%\textit{Heterogeneous inputs and outputs across tasks:} Developing a unified model for brain imaging analysis is markedly challenging since all tasks have incredibly diverse input and output representation. For example, extraction results in a binary mask that outlines the brain, while registration yields a transformation matrix for image coordinate mapping. Segmentation and parcellation generate multi-class masks to delineate brain tissues and regions. Network generation produces an adjacency matrix to capture brain region connectivity, and classification outputs categorical labels.
%This heterogeneity makes it very challenging to architect a single end-to-end model for all these tasks.

\noindent\textbf{Proposed Method.} To achieve the goal, we introduce a unified framework, UniBrain, the first model for end-to-end learning of brain imaging analysis tasks. UniBrain comprises a group of modules for extraction, registration, segmentation, parcellation, network generation, and classification. The extraction module removes non-brain tissue from the raw image, yielding an extracted image. The registration module aligns the extracted image with a template. 
The segmentation and parcellation modules generate the segmentation and parcellation masks on the raw image.
Concurrently, the network generation module learns representations of brain regions and constructs a brain network. 
Finally, the classification module makes the final predictions.
By integrating these modules in an end-to-end fashion, UniBrain enables mutual boosting across tasks, achieving joint optimization with limited labeled data.
Extensive experiments on multiple public brain MRI datasets show that our method significantly surpasses existing state-of-the-art approaches in all six tasks.
