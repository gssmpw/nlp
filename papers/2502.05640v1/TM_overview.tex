\definecolor{new_red}{rgb}{0.95,0.47,0.47}
\definecolor{new_green}{rgb}{0.85,0.98,0.77}

\definecolor{dark_red}{rgb}{0.78,0.28,0.34}
\definecolor{dark_green}{rgb}{0.09,0.30,0.28}

\tikzset{
	node distance = 0pt,
	BB/.style args={#1/#2/#3}{% Building Box, options
		draw, semithick, 
		font=\small\linespread{0.84}\selectfont, align=center, 
		minimum width=#1, minimum height=#2, text depth=0.25ex, 
		fill=#3, outer sep=0pt}
} % end of tikzset

\tikzset{
	sectors/.style n args={6}{minimum width=#1, minimum height=#2, 
		text depth=0.25ex, outer sep=0pt,
		append after command={\pgfextra{\let\LN\tikzlastnode
				\draw[fill=#3]  (\LN.west)  -| (\LN.north)
				{[rounded corners=3mm] -- (\LN.north west)}
				{[rounded corners=3mm] -- cycle}
				;
				
    			\draw[fill=#5]  (\LN.east)  -| (\LN.north)
				{[rounded corners=3mm] -- (\LN.north east)}
				[rounded corners=3mm] -- cycle;
				;
	} } }
}

\begin{figure}[!htb]
\vspace{-0.2cm}
\centering
\begin{tikzpicture}
[        GateCfg/.style={
	logic gate inputs={normal,normal},
	draw,
	thick,
	scale=1
	},
	cross/.style={path picture={ 
			\draw[black]
			(path picture bounding box.south east) -- (path picture bounding box.north west) (path picture bounding box.south west) -- (path picture bounding box.north east);
	}},
	scale=0.5, every node/.style={scale=0.5}
]
% clause M
\begin{scope}[xshift=1.45cm,yshift=2.5cm]
\draw[draw=black,fill=white] (-1.2,-7) rectangle ++(10.3,9);
\draw[draw=black,fill=black!30!white] (-1.2,1.5) rectangle ++(10.3,0.5) node[pos=.5] {\large{\textbf{Clause M}}};

\node[rotate=45] at (3.5,1.15) {\large{\textbf{...}}};

\draw[thick,arrows={-Triangle[]}] (9.1,-1.7) -- (9.6,-1.7);
\node[trapezium, draw, thick, minimum width=1cm, trapezium left angle=45, trapezium right angle=135, trapezium stretches=true, minimum height=0.8cm, fill=white] at (9.83,-1.9) {};
\node[rotate=45] at (9.83,-1.9) {$C_{M}$};

\draw[thick,arrows={-Triangle[]}] (10.23,-1.7) -- (11.4,-1.7);
\node [draw,thick,circle,cross,minimum width=0.4 cm,fill=white]() at (11.6,-1.7){};
\draw[arrows={-Triangle[]}] (11.6,-2.3) -- (11.6,-1.9);
\node[fill=blue!50!white] at (11.6,-2.4) {-1};

\draw[thick] (11.8,-1.7) -- (12.8,-1.7);
\draw[thick,arrows={-Triangle[]}] (12.8,-1.7) -- (12.1,-3.65);
\end{scope}

% clause M-1
\begin{scope}[xshift=1.15cm,yshift=1.8cm]
\draw[draw=black,fill=white] (-1.2,-7) rectangle ++(10.3,9);
\draw[draw=black,fill=black!30!white] (-1.2,1.5) rectangle ++(10.3,0.5) node[pos=.5] {\large{\textbf{Clause M-1}}};

\node[rotate=45] at (3.5,1.15) {\large{\textbf{...}}};

\draw[thick,arrows={-Triangle[]}] (9.1,-2) -- (9.5,-2);
\node[trapezium, draw, thick, minimum width=1cm, trapezium left angle=45, trapezium right angle=135, trapezium stretches=true, minimum height=0.8cm, fill=white] at (9.8,-2) {};
\node[rotate=45] at (9.8,-2) {\footnotesize{$C_{M-1}$}};
\node[rotate=70] at (9.5,-2.8) {\large{\textbf{...}}};

\draw[thick,arrows={-Triangle[]}] (10.1,-2) -- (11.1,-2);
\node [draw,thick,circle,cross,minimum width=0.4 cm,fill=white]() at (11.3,-2){};
\draw[arrows={-Triangle[]}] (11.3,-2.6) -- (11.3,-2.2);
\node[fill=yellow!50!white] at (11.3,-2.7) {+1};

\draw[thick] (11.5,-2) -- (11.8,-2);
\draw[thick,arrows={-Triangle[]}] (11.8,-2) -- (12,-3);
\end{scope}

% clause 2
\begin{scope}[xshift=0.3cm,yshift=0.7cm]
\draw[draw=black,fill=white] (-1.2,-7) rectangle ++(10.3,9);
\draw[draw=black,fill=black!30!white] (-1.2,1.5) rectangle ++(10.3,0.5) node[pos=.5] {\large{\textbf{Clause 2}}};

\draw[thick,arrows={-Triangle[]}] (9.1,-2.2) -- (9.9,-2.2);
\node[trapezium, draw, thick, minimum width=1cm, trapezium left angle=45, trapezium right angle=135, trapezium stretches=true, minimum height=0.8cm, fill=white] at (10.13,-2.4) {};
\node[rotate=45] at (10.13,-2.4) {$C_2$};

\draw[thick,arrows={-Triangle[]}] (10.55,-2.2) -- (11.4,-2.2);
\node [draw,thick,circle,cross,minimum width=0.4 cm,fill=white]() at (11.6,-2.2){};
\draw[arrows={-Triangle[]}] (11.6,-2.8) -- (11.6,-2.4);
\node[fill=blue!50!white] at (11.6,-2.9) {-1};

\draw[thick,fill=white] (13.1,-2.2) circle [radius=0.4] node () {\large{$\sum$}};
\draw[thick,arrows={-Triangle[]}] (11.8,-2.2) -- (12.7,-2.2);

% class sum
\node[trapezium, draw, thick, minimum width=1cm, trapezium left angle=45, trapezium right angle=135, trapezium stretches=true, minimum height=0.8cm, fill=white] at (14.3,-2.4) {};
\draw[thick,arrows={-Triangle[]}] (13.5,-2.2) -- (14.05,-2.2);
\node[] at (14.6,-1.7) {\large{\textbf{Class Sum}}};

\end{scope}

% TA states 1
\begin{scope}[xshift=0cm,yshift=0cm]
\draw[draw=black,fill=white] (-1.2,-7) rectangle ++(10.3,9);
\draw[draw=black,fill=black!30!white] (-1.2,1.5) rectangle ++(10.3,0.5) node[pos=.5] {\large{\textbf{Clause 1}}};
\node[] at (2.75,1.05) {\large{\textbf{Tsetlin Automata Team}}};

\node at (2.75,-0.7) [sectors= {72mm}{28mm}
{new_red}{}
{new_green}{}] {};

\draw[thick,fill=white] (0,0) circle [radius=0.3] node (s1) {1};
\draw[thick, arrows={-Stealth[reversed,reversed]},dashed] (-0.3,-0.2) to [out=230,in=160,looseness=4] (-0.3,0.2);
\draw[thick,fill=white] (1,0) circle [radius=0.3] node (s2) {2};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (0,0.3) to [bend left=45] (1,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (0,-0.3) to [bend right=45] (1,-0.3);
\draw[thick,fill=white] (2.2,0) circle [radius=0.3] node (sn) {N};
\node[] at (1.6,0) {...};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (1,0.3) to [bend left=35] (2.2,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (1,-0.3) to [bend right=35] (2.2,-0.3);

\draw[thick, arrows={-Stealth[reversed,reversed]}] (2.2,0.3) to [bend left=35] (3.3,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (2.2,-0.3) to [bend right=35] (3.3,-0.3);

\draw[thick,fill=white] (3.3,0) circle [radius=0.3] node (sn1) {\footnotesize{N+1}};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (3.3,0.3) to [bend left=45] (4.3,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (3.3,-0.3) to [bend right=45] (4.3,-0.3);
\draw[thick,fill=white] (4.3,0) circle [radius=0.3] node (sn2) {};
\draw[draw=none,fill=black!25!white] (4.3,0) circle [radius=0.24] node () {\footnotesize{N+2}};
\node[] at (4.9,0) {...};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (4.3,0.3) to [bend left=35] (5.5,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (4.3,-0.3) to [bend right=35] (5.5,-0.3);
\draw[thick,fill=white] (5.5,0) circle [radius=0.3] node (s2n) {2N};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (5.8,0.2) to [out=30,in=330,looseness=4] (5.8,-0.2);

\draw[ultra thick, arrows={-Triangle[]}] (6.5,0) to (7.1,0);
\node[] at (7.4,0) {\large{$x_0$}};

\draw[ultra thick, arrows={-Triangle[]}] (-1.6,0) to (-1,0);
\node[] at (-2.2,0) {\large{$x_0$}};
\end{scope}

% TA states 2
\begin{scope}[xshift=0cm,yshift=-1.6cm]
\node at (2.75,-0.7) [sectors= {72mm}{28mm}
{new_red}{}
{new_green}{}] {};

\draw[thick,fill=white] (0,0) circle [radius=0.3] node (s1) {1};
\draw[thick, arrows={-Stealth[reversed,reversed]},dashed] (-0.3,-0.2) to [out=230,in=160,looseness=4] (-0.3,0.2);
\draw[thick,fill=white] (1,0) circle [radius=0.3] node (s2) {2};
\draw[draw=none,fill=black!25!white] (1,0) circle [radius=0.24] node () {2};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (0,0.3) to [bend left=45] (1,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (0,-0.3) to [bend right=45] (1,-0.3);
\draw[thick,fill=white] (2.2,0) circle [radius=0.3] node (sn) {N};
\node[] at (1.6,0) {...};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (1,0.3) to [bend left=35] (2.2,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (1,-0.3) to [bend right=35] (2.2,-0.3);

\draw[thick, arrows={-Stealth[reversed,reversed]}] (2.2,0.3) to [bend left=35] (3.3,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (2.2,-0.3) to [bend right=35] (3.3,-0.3);

\draw[thick,fill=white] (3.3,0) circle [radius=0.3] node (sn1) {\footnotesize{N+1}};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (3.3,0.3) to [bend left=45] (4.3,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (3.3,-0.3) to [bend right=45] (4.3,-0.3);
\draw[thick,fill=white] (4.3,0) circle [radius=0.3] node (sn2) {\footnotesize{N+2}};
\node[] at (4.9,0) {...};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (4.3,0.3) to [bend left=35] (5.5,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (4.3,-0.3) to [bend right=35] (5.5,-0.3);
\draw[thick,fill=white] (5.5,0) circle [radius=0.3] node (s2n) {2N};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (5.8,0.2) to [out=30,in=330,looseness=4] (5.8,-0.2);

\draw[ultra thick, arrows={-Triangle[]}] (-1.6,0) to (-1,0);
\node[] at (-2.2,0) {\large{$\overline{x_0}$}};
\end{scope}

% TA states 3
\begin{scope}[xshift=0cm,yshift=-3.2cm]
\node at (2.75,-0.7) [sectors= {72mm}{28mm}
{new_red}{}
{new_green}{}] {};

\draw[thick,fill=white] (0,0) circle [radius=0.3] node (s1) {1};
\draw[thick, arrows={-Stealth[reversed,reversed]},dashed] (-0.3,-0.2) to [out=230,in=160,looseness=4] (-0.3,0.2);
\draw[thick, arrows={-Stealth[reversed,reversed]}] (0,0.3) to [bend left=45] (1,0.3);
\draw[thick,fill=white] (1,0) circle [radius=0.3] node (s2) {2};
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (0,-0.3) to [bend right=45] (1,-0.3);
\draw[thick,fill=white] (2.2,0) circle [radius=0.3] node (sn) {};
\draw[draw=none,fill=black!25!white] (2.2,0) circle [radius=0.24] node () {N};
\node[] at (1.6,0) {...};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (1,0.3) to [bend left=35] (2.2,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (1,-0.3) to [bend right=35] (2.2,-0.3);

\draw[thick, arrows={-Stealth[reversed,reversed]}] (2.2,0.3) to [bend left=35] (3.3,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (2.2,-0.3) to [bend right=35] (3.3,-0.3);

\draw[thick,fill=white] (3.3,0) circle [radius=0.3] node (sn1) {\footnotesize{N+1}};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (3.3,0.3) to [bend left=45] (4.3,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (3.3,-0.3) to [bend right=45] (4.3,-0.3);
\draw[thick,fill=white] (4.3,0) circle [radius=0.3] node (sn2) {\footnotesize{N+2}};
\node[] at (4.9,0) {...};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (4.3,0.3) to [bend left=35] (5.5,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (4.3,-0.3) to [bend right=35] (5.5,-0.3);
\draw[thick,fill=white] (5.5,0) circle [radius=0.3] node (s2n) {2N};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (5.8,0.2) to [out=30,in=330,looseness=4] (5.8,-0.2);

\draw[ultra thick, arrows={-Triangle[]}] (-1.6,0) to (-1,0);
\node[] at (-2.2,0) {\large{$x_1$}};
\end{scope}

% TA states 4
\begin{scope}[xshift=0cm,yshift=-4.8cm]
\node at (2.75,-0.7) [sectors= {72mm}{28mm}
{new_red}{}
{new_green}{}] {};

\draw[thick,fill=white] (0,0) circle [radius=0.3] node (s1) {1};
\draw[thick, arrows={-Stealth[reversed,reversed]},dashed] (-0.3,-0.2) to [out=230,in=160,looseness=4] (-0.3,0.2);
\draw[thick,fill=white] (1,0) circle [radius=0.3] node (s2) {2};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (0,0.3) to [bend left=45] (1,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (0,-0.3) to [bend right=45] (1,-0.3);
\draw[thick,fill=white] (2.2,0) circle [radius=0.3] node (sn) {N};
\node[] at (1.6,0) {...};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (1,0.3) to [bend left=35] (2.2,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (1,-0.3) to [bend right=35] (2.2,-0.3);

\draw[thick, arrows={-Stealth[reversed,reversed]}] (2.2,0.3) to [bend left=35] (3.3,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (2.2,-0.3) to [bend right=35] (3.3,-0.3);

\draw[thick,fill=white] (3.3,0) circle [radius=0.3] node (sn1) {\footnotesize{N+1}};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (3.3,0.3) to [bend left=45] (4.3,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (3.3,-0.3) to [bend right=45] (4.3,-0.3);
\draw[thick,fill=white] (4.3,0) circle [radius=0.3] node (sn2) {\footnotesize{N+2}};
\node[] at (4.9,0) {...};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (4.3,0.3) to [bend left=35] (5.5,0.3);
\draw[thick, arrows={Stealth[reversed,reversed]-},dashed] (4.3,-0.3) to [bend right=35] (5.5,-0.3);
\draw[thick,fill=white] (5.5,0) circle [radius=0.3] node (s2n) {};
\draw[draw=none,fill=black!25!white] (5.5,0) circle [radius=0.24] node () {2N};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (5.8,0.2) to [out=30,in=330,looseness=4] (5.8,-0.2);

\draw[ultra thick, arrows={-Triangle[]}] (6.5,0) to (7.1,0);
\node[] at (7.4,0) {\large{$\overline{x_1}$}};

\draw[ultra thick, arrows={-Triangle[]}] (-1.6,0) to (-1,0);
\node[] at (-2.2,0) {\large{$\overline{x_1}$}};

\node[] at (1.2,-1.05) {\textcolor{dark_red}{\large{\textbf{Exclude}}}};
\node[] at (4.5,-1.05) {\textcolor{dark_green}{\large{\textbf{Include}}}};

\begin{scope}[xshift=0.9cm,yshift=0cm]
\draw[thick,fill=white] (-0.8,-1.8) circle [radius=0.22] node () {};
\node[] at (-0.12,-1.8) {State};
\draw[thick,fill=white] (0.8,-1.8) circle [radius=0.22] node () {};
\draw[draw=none,fill=black!25!white] (0.8,-1.8) circle [radius=0.17] node () {};
\node[] at (1.95,-1.8) {Active state};
\draw[thick, arrows={-Stealth[reversed,reversed]}] (3.05,-1.8) to (3.55,-1.8);
\node[] at (4.3,-1.8) {Increment};
\draw[thick, arrows={-Stealth[reversed,reversed]},dashed] (5.3,-1.8) to (5.8,-1.8);
\node[] at (6.65,-1.8) {Decrement};
\end{scope}

\end{scope}

% clause output
\node[] at (-2.2,0.6) {\large{\textbf{Literal}}};
\draw[] (-2,0.2) -- ++(0.1,0) |- (-2,-5);
\draw[] (-2.45,0.2) -- ++(-0.1,0) |- (-2.45,-5);
\path (8.5,-2.5) node[and gate US,GateCfg] (AND1) {};
\draw[thick] (7.7,0) -- ++(0.1,0) |- (AND1.input 1); 
\draw[thick] (7.7,-4.8) -- ++(0.1,0) |- (AND1.input 2);
\node [draw,thick,circle,cross,minimum width=0.4 cm,fill=white]() at (11.3,-2.5){};
\draw[thick,arrows={-Triangle[]}] (AND1.output) -- (9.75,-2.5);

\node[trapezium, draw, thick, minimum width=1cm, trapezium left angle=45, trapezium right angle=135, trapezium stretches=true, minimum height=0.8cm, fill=white] at (10.1,-2.5) {};
\node[rotate=45] at (10.1,-2.5) {$C_1$};

\draw[thick,arrows={-Triangle[]}] (10.4,-2.5) -- (11.1,-2.5);
\draw[arrows={-Triangle[]}] (11.3,-3) -- (11.3,-2.7);
\node[fill=yellow!50!white] at (11.3,-3.2) {+1}; 

\node[] at (11.3,1.3) {\large{\textbf{Clause Output}}};

\draw[thick] (11.5,-2.5) -- (12.8,-2.5);
\draw[thick,arrows={-Triangle[]}] (12.8,-2.5) -- (13.2,-1.8);

\node[fill=yellow!50!white] at (11.3,-5) {+1};
\node[] at (12.9,-5) {Positive polarity};
\node[fill=blue!50!white] at (11.3,-5.6) {-1};
\node[] at (12.9,-5.6) {Negative polarity};
\end{tikzpicture}

\caption{The TM structure.}
\label{fig:tm_structure}
\Description[overall TM structure]

\vspace{-0.2cm}

\end{figure}
