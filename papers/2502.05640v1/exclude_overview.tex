\definecolor{new_red}{rgb}{0.95,0.47,0.47}
\definecolor{new_green}{rgb}{0.85,0.98,0.77}

\definecolor{dark_red}{rgb}{0.78,0.28,0.34}
\definecolor{dark_green}{rgb}{0.09,0.30,0.28}

\definecolor{mypink}{rgb}{0.858, 0.188, 0.478}
\definecolor{babyblue}{rgb}{0.54,0.81,0.94}

\tikzset{
	node distance = 0pt,
	BB/.style args={#1/#2/#3}{% Building Box, options
		draw, semithick, 
		font=\small\linespread{0.84}\selectfont, align=center, 
		minimum width=#1, minimum height=#2, text depth=0.25ex, 
		fill=#3, outer sep=0pt}
} % end of tikzset

\begin{figure}[htp!]
\centering
\begin{tikzpicture}
[        GateCfg/.style={
	logic gate inputs={normal,normal},
	draw,
	thick,
	scale=1
	},
	cross/.style={path picture={ 
			\draw[black]
			(path picture bounding box.south east) -- (path picture bounding box.north west) (path picture bounding box.south west) -- (path picture bounding box.north east);
	}},
	scale=0.75, every node/.style={scale=0.75}
]
%\node [draw, thick, shape=rectangle, minimum width=0.8cm, rounded corners, minimum height=1cm] at (0,3.6) {\Large{Standard training epoch}};

%\node [draw, thick, shape=rectangle, minimum width=0.8cm, rounded corners, minimum height=1cm, fill=babyblue!70!white] at (6,3.6) {\Large{Excluding process}};

%\draw[thick, arrows={-Stealth[reversed,reversed]},thick] (2.65,4.1) to [out=30,in=150,looseness=0.7] (4,4.1);

%\draw[thick, arrows={-Stealth[reversed,reversed]},thick] (4,3.1) to [out=210,in=330,looseness=0.7] (2.65,3.1);

%\draw[densely dashed] (5,3) -- (-2.5,1.7);
%\draw[densely dashed] (7,3) -- (9,1.7);  

% TA states 1
\begin{scope}[xshift=0cm,yshift=0cm]
\node[fill=babyblue!70!white,rounded corners] at (4.1,1.8) {\large{\textbf{For any literal $l_i$ included in both positive and negative clauses:}}};

%-4.9
\draw[draw=black,fill=white] (-1.7,-3.5) rectangle ++(11.6,5);

\node[] at (2.75,1.05) {\large{\textbf{TA states of $l_i$ in all clauses}}};

\draw[draw=black,fill=white,rounded corners] (-0.5,-0.5) rectangle ++(6.5,1);

\draw[thick,fill=white] (0,0) circle [radius=0.3] node (s1) {1};

\draw[thick,fill=white] (1,0) circle [radius=0.3] node (s2) {};
\draw[draw=none,fill=red!25!white] (1,0) circle [radius=0.24] node () {2};

\draw[thick,fill=white] (2.2,0) circle [radius=0.3] node (sn) {N};
\node[] at (1.6,0) {...};

\draw[thick,fill=white] (3.3,0) circle [radius=0.3] node (sn1) {\footnotesize{N+1}};

\draw[thick,fill=white] (4.3,0) circle [radius=0.3] node (sn2) {};
\draw[draw=none,fill=black!25!white] (4.3,0) circle [radius=0.24] node () {\footnotesize{N+2}};
\node[] at (4.9,0) {...};

\draw[thick,fill=white] (5.5,0) circle [radius=0.3] node (s2n) {2N};

\draw[thick, arrows={-Stealth[reversed,reversed]},thick,densely dotted,red] (4.3,0.3) to [out=150,in=30,looseness=0.7] (1,0.3);

\node[] at (7.9,0) {\large{State reduced by N}};

\end{scope}

% TA states 2
\begin{scope}[xshift=0cm,yshift=-1.3cm]

\draw[draw=black,fill=white,rounded corners] (-0.5,-0.5) rectangle ++(6.5,1);

\draw[thick,fill=white] (0,0) circle [radius=0.3] node (s1) {1};

\draw[thick,fill=white] (1,0) circle [radius=0.3] node (s2) {};
\draw[draw=none,fill=black!25!white] (1,0) circle [radius=0.24] node () {};

\draw[fill=red!25!white,draw=none] (1,0.235) arc (90:270:0.235) -- cycle;
\node[] at (1,0) {2};

\draw[thick,fill=white] (2.2,0) circle [radius=0.3] node (sn) {N};
\node[] at (1.6,0) {...};

\draw[thick,fill=white] (3.3,0) circle [radius=0.3] node (sn1) {\footnotesize{N+1}};

\draw[thick,fill=white] (4.3,0) circle [radius=0.3] node (sn2) {\footnotesize{N+2}};
\node[] at (4.9,0) {...};

\draw[thick,fill=white] (5.5,0) circle [radius=0.3] node (s2n) {2N};

\node[] at (7,0) {\large{Inaction}};

\node[] at (1.2,-1.05) {\textcolor{dark_red}{\large{\textbf{Exclude}}}};
\node[] at (4.5,-1.05) {\textcolor{dark_green}{\large{\textbf{Include}}}};
\draw[thick,dashed,green!50!black] (2.75,-1.2) -- (2.75,1.8);

\begin{scope}[xshift=-0.5cm,yshift=0cm]
\draw[thick,fill=white] (-0.8,-1.8) circle [radius=0.22] node () {};
\node[] at (-0.12,-1.8) {State};
\draw[thick,fill=white] (0.8,-1.8) circle [radius=0.22] node () {};
\draw[draw=none,fill=black!25!white] (0.8,-1.8) circle [radius=0.17] node () {};
\node[] at (3.25,-1.8) {Active state before exclusion};
\draw[thick,fill=white] (5.9,-1.8) circle [radius=0.22] node () {};
\draw[draw=none,fill=red!25!white] (5.9,-1.8) circle [radius=0.17] node () {};
\node[] at (8.2,-1.8) {Active state after exclusion};
\end{scope}

\end{scope}

\begin{scope}[xshift=0.2cm,yshift=0cm]
\node[rotate=90] at (-1.55,-0.6) {\large{Clause}};
\draw[] (-1.2,-0.6) to [bend left] (-1.1,-0.8);
\draw[] (-1.2,-0.6) to [bend right] (-1.1,-0.4);
\draw[] (-1.1,-0.4) -- (-1.1,0.2);
\draw[] (-1.1,0.2) to [bend left] (-1,0.4);
\draw[] (-1.1,-0.8) -- (-1.1,-1.5);
\draw[] (-1.1,-1.5) to [bend right] (-1,-1.7);
\end{scope}

\end{tikzpicture}

\caption{ETHEREAL exclusion process.}
\label{fig:exclude_overview}

\Description[overall ETHEREAL process]

\end{figure}
