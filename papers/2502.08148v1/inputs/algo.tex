\begin{algorithm}
\caption{Clustering Algorithm}
\label{algo}
\begin{algorithmic}[1]
\Require{Dataset $\mathcal{D}$ of $N$ events.} 
% \Ensure{$Sum$ (sum of values in the array)}
\State{Construct similarity matrix $\boldsymbol{M}$ size $(N, N)$ where each element $\boldsymbol{M}_{xy} = S_{xy}$}.\\
\Comment{\textcolor{blue}{Run base clustering}}
\State {Set of clusters $\mathbb{C}$ $\gets$ $\textrm{PIVOT}(\boldsymbol{M})$} \\
\Comment{\textcolor{blue}{Remove inter-cluster causal relations}}
    \State {Set $\widehat{\mathbb{C}} \gets \{\emptyset\}$}
    \For{cluster $C \in \mathbb{C}$}
        \State {Set $\mathbb{V} \gets \{\emptyset\}$}
        \State {Pick random pivot $x$}
        \For{every element $y \in C \setminus \{x\}$ }
            \If{$ x \leftrightarrow y $} 
                \State {Remove $y$ from $C$}
                \If{$\mathbb{V} = \{\emptyset\}$ or $\max_{V \in \mathbb{V}} \mathcal{S}_{yV}=0$  } 
                    % \State {$\{y\} \gets$ singleton cluster}
                    \State {Add $\{y\}$ to $\mathbb{V}$}
                \Else
                    \State {$V \gets \textrm{argmax}_{V \in \mathbb{V}} \ \mathcal{S}_{yV}$ } 
                    \State {Assign $y$ to cluster $V$}
                
                \EndIf
            \EndIf 
    \EndFor
    \State {Add $C$ to $\mathbb{V}$}
    \State {Update $\widehat{\mathbb{C}} \gets \widehat{\mathbb{C}} \cup \mathbb{V}$}
\EndFor 
\State {Update $\mathbb{C} \gets \widehat{\mathbb{C}}$} \\ 

\Comment{\textcolor{blue}{Remove intra-cluster causal relations}}
\State {Sort $\mathbb{C}$ by cluster sizes in the descending order}
\State {Denote $C_i$ be the $i$th cluster of set $\mathbb{C}$}
\State {Set $\widehat{\mathbb{C}} \gets \{\emptyset\}$}
\For{ $i \gets 1$ to $|\mathbb{C}|$}
    \State {Set $\mathbb{A} \gets \{C_i\}$ }
    \For{$j \gets i$ to $|\mathbb{C}| $}
        \State {Set $\mathbb{V} \gets \{\emptyset\}$}
        \For {every cluster $A \in \mathbb{A}$}
            \State{$U \gets \{x \in A \mid \exists y \in C_j : x \rightarrow y \}$}
            \State{$E \gets \{x \in A \mid \exists y \in C_j : x \leftarrow y \}$ }
            \If{$|U| > |E|$}
                \State{Add $A \setminus U$ to $\mathbb{V}$}
                \State{Add $U$ to $\mathbb{V}$}
            \Else 
                \State{Add $A \setminus E$ to $\mathbb{V}$}
                \State{Add $E$ to $\mathbb{V}$}
            
            \EndIf
        \EndFor
        \State {Update $\mathbb{A} \gets \mathbb{V}$}
    \EndFor
    \State{Update $\widehat{\mathbb{C}} \gets \widehat{\mathbb{C}} \cup \mathbb{A} $}
\EndFor
\State {Update $\mathbb{C} \gets \{ C \in \widehat{\mathbb{C}} \mid |C| > 0\} $}
\State \Return {$\mathbb{C}$}
\end{algorithmic}
\end{algorithm}
