\section{Large Cuts}
\label{sec:large_cuts}

Now we discuss the \GRC{} with $w(\call) \ge 4$. Interestingly, we get a dichotomy and can no longer solve \GRC{} within polynomial time unless $\classP=\classNP$. Our hardness result holds even if \texttt{d} is a sequence of ones. Additionally, we explore restrictions over the possibility graph $\calg$ and show that \GRC{} is \classNPC{} for $w(\call) = 6$ even if $\calg$ is bipartite and subcubic. In contrast, if $\calg$ is a tree, we argue how the problem can be efficiently solved.


\subsection{Cuts of Size Four}

Regarding the size of cuts, one might initially think that the approach of \cref{thm:size3}, which reduces an instance with $w(\call) = 3$ to one with $w(\call) = 2$, could be extended to larger cuts.
However, this extension is not feasible. For cuts $(S, \ell)$ of size three, the number of edges within $S$ uniquely determines how much the degrees of each vertex are affected. In contrast, when $\size{S} = 4$, this property already does not hold.
%
Consider, for instance, a cut $(S, \ell)$ where $S = \set{u, v, w, x}$ and $\ell = d(S) - 4$. In any realization, there must be exactly two edges within $S$.
If, in a realization $G$, these edges are disjoint (e.g., $uv, wx \in E(G)$), then each vertex in $S$ has its degree decreased by $1$.
%
On the other hand, the edges might not be disjoint (e.g., $uv, uw \in E(G)$). In this case, one vertex has its degree decreased~by~$2$, two vertices have a reduction of $1$, and one vertex remains unchanged.
%
Since it is impossible to determine beforehand which of these configurations applies, the reduction strategy used in Theorem~\ref{thm:size3} cannot be generalized.

In fact, we show that when $w(\call) = 4$, the \GRC{} problem cannot be solved in polynomial time unless $\classP{} = \classNP{}$.
%
We use a restricted variant of the {$1$-in-$3$-SAT} problem \cite{Ga79} in our proof.
%
% If the length of each clause is restricted to $t$ literals, then the problem is also known as X$t$SAT or $1$-in-$t$-SAT.
%
%We will denote by X$t$SAT the particular case of XSAT in which every clause has at most $t$ literals.
%
In our case, we consider propositional formulas in conjunctive normal form where every variable appears exactly three times, two times as a positive literal (i.e., not negated) and one time as a negative literal (i.e., negated). We ask if it is possible to find a satisfying assignment such that each clause has exactly one literal that evaluates to true while the rest are false.
% ; we call this variant $(2, 1)$-XSAT.
Additionally, we require that each clause has two or three literals (it is trivial to handle clauses with only one literal, so we assume they are preprocessed away).
We call this variant \rXthreeSAT{}, and although pretty restricted, this problem remains \classNPC{}.

% \begin{problem}[$(2,1)$-\textsc{Exact $3$-Satisfiability} -- \rXthreeSAT{}]
%     Given a set of variables $X$ and a formula~$\phi$ in conjunctive normal form over $X$ such that
%     \begin{itemize}
%         \item each variable of $X$ occurs twice as a positive literal and once as a negative literal;
%         \item each clause of $\phi$ has two or three literals;
%     \end{itemize}
%     %
%     \noindent
%     is there a truth assignment of $X$ such that exactly one literal in every clause of $\phi$ is true?
% \end{problem}

\defproblema{%$(2,1)$-\textsc{Exact $3$-Satisfiability} -- 
\rXthreeSAT{}}
{
A set of variables $X$ and a formula~$\phi$ in conjunctive normal form over $X$ such that:
\begin{itemize}
    \item each variable of $X$ occurs twice as a positive literal and once as a negative literal;
    \item each clause of $\phi$ has two or three literals.
\end{itemize}
}
{
Is there a truth assignment of $X$ such that exactly one literal in every clause of $\phi$ is true?
}

\begin{lemma}
\label{thm:2-1-xsat}
    \rXthreeSAT{} is \classNPC{}.
    % The \rXSAT{} problem is \classNPC{} even restricted to the case where each clause has two or three literals.
\end{lemma}

\begin{proof}
    Notice that the problem is in \classNP{}. To prove that it is \classNPH{}, we show a reduction from Positive $1$-in-$3$-SAT, the monotone version of $1$-in-$3$-SAT in which all literals are positive. This problem is known as \classNPC{}~\cite{Ga79}.

    Let~($X$, $\phi$) be an input of the Positive $1$-in-$3$-SAT problem.
    % ; call $X$ the set of variables of $\phi$. 
    We will show how to add clauses and variables to $(X, \phi)$ to obtain an equivalent instance $(X', \phi')$ of \rXthreeSAT{}. We start with $X' = X$ and $\phi' = \phi$.
    %
    Let $x \in X$. First, consider that $x$ only occurs once in $\phi$ (we know it appears as a positive literal). Then we add to $\phi'$ the redundant clause $(x + \neg{x})$. Now $x$ occurs in $\phi'$ twice as a positive literal and once as a negative one, and $\phi'$ is equivalent to $\phi$.

    Now suppose $x$ has two appearances in $\phi$. Then we create a new variable $a$; we add the clause $(x + \neg{a})$ to set a logical equivalence between $x$ and $a$ (since exactly one of $x$ and $\neg{a}$ must be true in a satisfying truth assignment, $x \equiv a$ in any feasible assignment).
    %
    This allows us to replace the second occurrence of $x$ with its equivalent variable~$a$. The resulting $\phi'$ is equivalent to $\phi$, and by also adding the redundant clause $(a + \neg{x})$ to $\phi$, both $x$ and the new variable $a$ occur twice as a positive literal and once as a negative one.

    Finally, we generalize this last idea. Lets say that $x$ occurs $t$ times, $t \geq 2$. We create $t-1$ variables, $a_1, a_2, \ldots, a_{t-1}$, which will be all equivalent to $x$. To this end, we add $t$ clauses to $\phi'$: $(x + \neg{a}_1), (a_1 + \neg{a}_2), \ldots, (a_{t-2} + \neg{a}_{t-1}), (a_{t-1} + \neg{x})$. Now $x$ and the new variables $a_1, \ldots, a_{t-1}$ are all equivalent, i.e., they must have the same truth value in any assignment that satisfies exactly one literal of every clause. In $\phi'$, we maintain the first appearance of $x$, but the second one is replaced by $a_1$, the third is replaced by $a_2$, and so forth. The resulting $\phi'$ is still equivalent to the original $\phi$, and if we do this for every variable in $X$, we obtain an instance $(X', \phi')$ that is an instance of \rXthreeSAT{}. Furthermore, we remark that in $\phi'$, every clause that comes from~$\phi$ has three literals, and every clause that we created for the reduction has two literals; thus, $\phi'$ only has clauses of sizes two and three.
    \qed
\end{proof}

To argue the hardness of \GRC{} with $w(\call) = 4$, it will be useful to know beforehand how many variables in a \rXthreeSAT{} instance must be set to true.
To this end, we consider a more restricted problem, which remains hard.

% \begin{problem}[$k$-True $(2,1)$-\textsc{Exact $3$ Satisfiability} -- \kXthreeSAT{}] \\
%     Given a tuple $(X, \phi, k)$, where $(X, \phi)$ is an instance of \rXthreeSAT{} and $k$ is a nonnegative integer,
%     %
%     is there a feasible solution to $(X, \phi)$ in which exactly $k$ variables are assigned to true?
%     % Is there a truth assignment of the variables of $\phi$ where exactly $k$ variables are assigned as true, and which satisfies exactly one literal of every clause of $\phi$?
% \end{problem}

\defproblema{%$k$-True $(2,1)$-\textsc{Exact $3$ Satisfiability} -- 
\kXthreeSAT{}}
{
A tuple $(X, \phi, k)$, where $(X, \phi)$ is an instance of \rXthreeSAT{} and $k$ is a nonnegative integer.
}
{
Is there a feasible solution to $(X, \phi)$ in which exactly $k$ variables are assigned to true?
}

\begin{lemma}
\label{thm:k-true-xsat}
    \kXthreeSAT{} cannot be solved in polynomial time unless $\classP{} = \classNP{}$.
\end{lemma}

\begin{proof}
    Follows directly from Lemma~\ref{thm:2-1-xsat}. Suppose that $\cala$ is an algorithm that decides \kXthreeSAT{} in polynomial time. Given an instance $(X, \phi)$ of \rXthreeSAT{} with $n$ variables, we run $\cala$ on inputs $(X, \phi, 0), \ldots, (X, \phi, n)$. If $\cala$ accepts any of these, we determine that the answer to $\phi$ is YES; otherwise, it is NO. Therefore, we can solve \rXthreeSAT{} in polynomial time, implying that $\classP{} = \classNP{}$.
    \qed
\end{proof}
\medskip

%\textcolor{red}{k-True 1-in-3-SAT problem},
% Now, we may discuss our hardness result for \GRC{}.
% As an example, consider $(\phi,k)$ as an instance of \kXSAT{}, where
% \[\phi = (\bar{x}_1 \oper x_3)(x_1 \oper x_2 \oper x_4)(x_1 \oper \bar{x}_4)(\bar{x}_2 \oper \bar{x}_3)(x_2 \oper x_3 \oper x_4) \]
% and $k=1$. Figure \ref{fig:proof_w=4} illustrates the corresponding graph $G$, with the cuts specified as $d(s)=3$, $d({x_i})=1$ for all $i = 1, \ldots, 4$, and $d({C_j})=1$ for all $j = 1, \ldots, 5$.  A feasible realization for ... instance is also colored.
% \medskip

Equipped with the \kXthreeSAT{} problem and by knowing that it cannot be solved in polynomial time unless $\classP{} = \classNP{}$,
we can proceed to show the hardness of the \GRC{} problem when $w(\call) = 4$.

\begin{figure}[!ht]
    \centering
    \input{fig/proof_w=4}
    \caption{
    Illustration of the possibility graph $\calg$ built from an instance $(X, \phi, k)$ of \kXthreeSAT{}{} with
    $X = \set{x_1, x_2, x_3, x_4}$, 
    $\phi = (\bar{x}_1 \oper x_3)(x_1 \oper x_2 \oper x_4)(x_1 \oper \bar{x}_4)(\bar{x}_2 \oper \bar{x}_3)(x_2 \oper x_3 \oper x_4)$
    and $k = 1$.
    Gray vertices represent artificial vertices created for clauses with only two literals.
    The highlighted edges show an example of a feasible realization for such an instance.
    }
    \label{fig:proof_w=4}
    \vspace{-.5cm}
\end{figure}

\begin{theorem}
    The \GRC{} problem cannot be solved in polynomial time unless $\classP = \classNP$ even when $w(\call) = 4$ and all degrees in the degree sequence $\texttt{d}$ are 1.%equal to 1.
\end{theorem}
\begin{proof}
    % Suppose that given an instance $I=(\texttt{d}, \call)$ of the \GRC{} problem, where $w(\call) = 4$ and all degrees in the degree sequence $\texttt{d}$ are equal to 1, we can solve it in polynomial time.

    %% (acho que não precisa disso não, não basta uma redução da versão k-true pra o GRC?)
    % Now, suppose we are given an instance $(x, \phi)$ of the $(2, 1)$-XSAT with $n$ variables, where each clause has two or three literals.
    % %
    % We will construct $n+1$ instances, $I_0=(\texttt{d}_0, \call_0), \cdots, I_{n}=(\texttt{d}_n, \call_n)$, of the \GRC{} problem, where $w(\call_k) = 4$ and all degrees in $\texttt{d}_k$ are equal to 1 for all $0 \le k \le n$, such that there is one realizable instance $I_k$ if and only if there is a satisfying assignment to our $(2, 1)$-XSAT input instance.

    We present a reduction from the $k$-True \rXthreeSAT{} to the \GRC{} problem with the desired properties.
    To this end, let $(X, \phi, k)$ be an instance of the $k$-True \rXthreeSAT{}.
    We now describe the building of the instance $I = (\texttt{d}, \call)$ of \GRC{}.
    Refer to \cref{fig:proof_w=4} for an illustrative example.
    We start with $\texttt{d}$ and $\call$ empty, and we let $V$ be the corresponding set of vertices and $\calg$ be its possibility graph.
    %
    First, for each variable $x_i$ in $X$, we build a \textit{variable gadget} as follows.
    Let $X_i$ be a set of four vertices, namely $X_i = \set{ x^i_{T_1}, x^i_{T_2}, x^i_{F_1}, x^i_{F_2}}$.
    We add $X_i$ to $V$ and set $d_u = 1$ for each $u \in X_i$, we add the edges $x^i_{T_1} x^i_{T_2}$ and $x^i_{F_1} x^i_{F_2}$ to $\calg$, and we add the cut $( X_i, 2)$ to $\call$.
    %
    Moreover, for each clause $C_j$ of $\phi$, we define its \textit{clause gadget}.
    We create a new vertex for each literal that occurs in $C_j$. If $C_j$ has only two literals, we create another artificial one. Let $Y_j$ be this set of three vertices.
    We add $Y_j$ to $V$ and set $d_v = 1$ for each $v \in Y_j$, we add all the edges between vertices of $Y_j$ to $\calg$, and we add the cut $(Y_j, 1)$ to $\call$.

    To conclude the definition of the vertices $V$,
    we create a vertex $s$ and set $d_s = n - k$.
    The set $V$ of our instance is thus composed of $s$ and the vertices of each variable and clause gadget.
    %
    To finish $\calg$'s construction, we join the vertex and clause gadgets as follows.
    For each variable $x_i$, let $C_{i_1}$ and $C_{i_2}$ be the two clauses where $x_i$ appears as a positive literal, and $C_{i_3}$ the clause in which it appears as a negative literal.
    We connect $x^i_{T_1}$, $x^i_{T_2}$ and $x^i_{F_1}$ to the vertex that corresponds to its literal in $C_{i_1}$, $C_{i_2}$ and $C_{i_3}$, respectively, while $x^i_{F_2}$ is connected to $s$.
    The final cut list $\call$ is given by the aforementioned cuts in the vertex and clause gadgets, plus the ones defining $\calg$.
    %
    Now we show that there is a realization for such $(\texttt{d}, \call)$ if and only if $(X, \phi)$ is satisfiable using exactly $k$ variables as true.

    Let $\hat{x}$ be a feasible solution to $(X, \phi)$ using exactly $k$ variables as true.
    Let $G$ be a spanning subgraph of $\calg$, initially with no edges.
    For each $\hat{x}_i$ from $\hat{x}$, if $\hat{x}_i = T$, we add to $G$ the edge $x^i_{F_1}x^i_{F_2}$ along with the edges from $x^i_{T_1}$ and~$x^i_{T_2}$ to their corresponding positive literals in the clause gadgets.
    Similarly, if $\hat{x}_i = F$, then we add to $G$ the edge $x^i_{T_1}x^i_{T_2}$ along with the edges from $x^i_{F_1}$ to its corresponding negative literal in the clause gadget and from $x^i_{F_2}$ to $s$.
    At last, for each clause $C_j$ in $\phi$, let $\hat{x}_{j_1}$ and $\hat{x}_{j_2}$ be the corresponding vertices of the two literals in $C_j$ that were evaluated as false in $\hat{x}$ in case $C_j$ has three literals, or the literal evaluated to false and the artificial vertex added in the clause gadget of $C_j$, otherwise. We~then add the edge $\hat{x}_{j_1}\hat{x}_{j_2}$ to $G$ for each clause $C_j$.
    %
    In both cases, in $G$ we have that $\partial(X_i) = 2$. 
    Since $\hat{x}_i$ is a feasible solution, in each clause $C_j$, exactly one variable is evaluated to true, which implies that $\partial(Y_j) = 1$ in $G$.
    Furthermore, the degree of all vertices except for $s$ is $1$, and since there are exactly $k$ variables in $\hat{x}$ assigned to true, there are $n-k$ edges in $G$ from vertices $x^i_{F_2}$ to $s$, thus respecting $d_s$. Therefore, $G$ is a realization of~$(\texttt{d}, \call)$.

    Conversely, let $G$ be a realization of $(\texttt{d}, \call)$.
    Since $(X_i,2)\in \call$ for each variable $x_i$, $d_u = 1$ for each $u \in X_i$, and $E(\calg[X_i])=\{ x^i_{T_1} x^i_{T_2}, x^i_{F_1} x^i_{F_2}\}$. It holds that either $x^i_{T_1}, x^i_{T_2}$ or $x^i_{F_1},x^i_{F_2}$ have neighbors outside $X_i$ in $G$. Therefore, we define an assignment $\hat{x}$ to $(X,\phi)$ as follows: $x_i=T$ if $x^i_{T_1}, x^i_{T_2}$ have neighbors outside $X_i$ in $G$, otherwise $x_i=F$. As $(Y_j, 1)\in \call$ for each clause $C_j$, it follows that each clause of $\phi$ has exactly one literal assigned to true in $\hat{x}$. Given that $d(s)=n-k$, the vertex $s$ has $n-k$ neighbors in $G$. By construction, each neighbor of $s$ in $G$ is a $x^i_{F_2}$ vertex for some $i$. Thus, $\hat{x}$ has exactly $n-k$ negative literals evaluating true, and therefore $\hat{x}$ is a feasible solution to $(X, \phi)$ in which exactly $k$ variables are assigned to true.
    
    To have all degrees in the degree sequence $\texttt{d}$ equal 1 is enough to modify the construction, replacing $s$ by $n-k$ copies each with desired degree equals one in $\texttt{d}$.  
    %
    Thus, from this reduction, we conclude that if the \GRC{} problem is solvable in polynomial time, then we can also solve the $k$-True \rXthreeSAT{} problem in polynomial time, which would imply that $\classP{} = \classNP{}$ due to \cref{thm:k-true-xsat}. \qed
\end{proof}


\subsection{Restricted Possibility Graph}

We now move our attention to particular instances $(\texttt{d}, \call)$ of \GRC{} in which $w(\call)$ is not bounded, but the possibility graph $\calg$ belongs to a restricted graph class.
%
If $\calg$ is a tree, we can solve the \GRC{} in polynomial time.
%
For instance, we can construct a candidate realizing graph $G$ by processing $\calg$'s leaves iteratively, ensuring at each step that the degree constraints are met. If a violation occurs or the final vertex has a nonzero degree, we return NO; otherwise, we can verify whether $G$ realizes $\call$ in polynomial time.

\begin{proposition}
    \label{prep:tree_graph}
    Given an instance $(\texttt{d}, \call)$ of \GRC{} with a tree possibility graph $\calg$, we can decide if there is a solution in polynomial time.
\end{proposition}

\mycomment{
\begin{proof}
We begin with an empty graph $G = (V, \emptyset)$. If $\calg$ has at least two vertices, we select a leaf $v_i$. Let $v_j$ be the father of $v_i$. If the degree $d_i$ of $v_i$ is greater than one, no valid solution exists as there are not enough allowed edges, and we immediately return no. Otherwise, if $d_i = 1$, we decrease $d_j$ by one and add an edge between $v_i$ and $v_j$ in $G$. Then, we remove $v_i$ from $\calg$ along with its degree $d_i$ from the sequence \texttt{d}. These removals also happen if $d_i=0$.

We repeat this process, treating one leaf at a time until only a single vertex $v_i$ remains in $\calg$. At this final step, we return no if the remaining degree $d_i$ is not zero.
%
This approach guarantees that if the algorithm returns no at any point, the instance indeed has no solution. Otherwise, once the graph $G$ is constructed, we verify if $G$ realizes $\call$, outputting yes if it does and no otherwise, which can be done in polynomial time. \qed
\end{proof}
}

As it turns out, if we relax the restrictions on $\calg$ and allow a bipartite graph, we get a \classNPC{} problem.
To show this, we will make use of the 3-Dimensional Matching problem, which is defined next.

% \begin{problem}[\textsc{3-Dimensional Matching} -- \TDM{}]
%     Given 3 disjoint sets $X$, $Y$, and $Z$ with $|X| = |Y| = |Z| = n$, and a set of triples $T \subseteq X \times Y \times Z$,
%     %
%     is there a subset $M \subseteq T$ such that $\size{M}=n$ and no two triples of $M$ intersect?
% \end{problem}

\defproblema{3-Dimensional Matching -- \TDM{}}
{
3 disjoint sets $X$, $Y$, and $Z$ with $|X| = |Y| = |Z| = n$, and a set of triples $T \subseteq X \times Y \times Z$.
}
{
Is there a subset $M \subseteq T$ such that $\size{M}=n$ and no two triples of $M$ intersect?
}

This problem remains \classNPC{} if no element occurs in more than three triples \cite{Ga79}. We refer to this particular case as \TDMT{}.

\begin{theorem}
    The \GRC{} problem is \classNPC{} when the possibility graph $\calg$ is subcubic and bipartite, even when $w(\call) = 6$ and \texttt{d} is a sequence of ones.
    % even when $w(\call) = 6$, \texttt{d} is a sequence of ones, and the possibility graph $\calg$ is subcubic and bipartite.
\end{theorem}
\begin{proof}
The \GRC{} is clearly in \classNP{}. We show a reduction from \TDMT{} to prove its hardness.
%
Consider an instance $(X, Y, Z, T)$ of \TDMT{} where $|X| = |Y| = |Z| = n$. Without loss of generality, assume that every element in $X$, $Y$, and $Z$ appears in at least one triple in $T$ (see Figure \ref{fig:3dm3red} for an illustration of the reduction).

% Vertices
%set X
To construct the vertex set $V$ for our \GRC{} instance, we proceed as follows: for each element $x_i \in X$, we create a corresponding vertex $x_i$ in $V$.
%set Y
For each element $y_j \in Y$, we construct a group of vertices $V_j$, determined by the number of triples in $T$ containing $y_j$. If $y_j$ appears in $l$ triples, where $1 \leq l \leq 3$, we create $2l$ vertices labeled $y^j_{1,a}, \ldots, y^j_{l,a}$ and $y^j_{1,b}, \ldots, y^j_{l,b}$, and group these into two sets, $Y^j_a = \{y^j_{1,a}, \ldots, y^j_{l,a}\}$ and $Y^j_b = \{y^j_{1,b}, \ldots, y^j_{l,b}\}$. Define $Y_a = \bigcup_j Y^j_a$ and $Y_b = \bigcup_j Y^j_b$.
%set Z
Lastly, for each element $z_k \in Z$, we create a vertex $z_k$ in $V$. In total, this construction yields $2(|T| + n)$ vertices, where $V = X \cup Y_a \cup Y_b \cup Z$.

% Degree sequence d
We define the degree sequence \texttt{d} such that each vertex in $V$ has a degree exactly one. This degree constraint ensures that each vertex is matched with only one other vertex, guaranteeing that any feasible solution forms a matching.
%
% Cut set L
Next, we construct the cut list $\call$. For each group $V_j$, we add the pair $(V_j, 2)$ to $\call$. This is the largest cut with a size of at most six, enforcing exactly two edges connecting vertices in $V_j$ to vertices outside of $V_j$. We will later argue that they specifically connect to a vertex of $X$ and a vertex of $Z$.

We then add cuts of size two, as per Remark \ref{thm:fixed_forbidden_edges}, to $\call$ to prohibit all edges except those allowed by the following rules. For each $y_j \in Y$, let $(x_{i_1}, y_j, z_{k_1}), \ldots,$ $(x_{i_l}, y_j, z_{k_l})$ denote the $l$ triples of $T$ in which $y_j$ appears. We only allow edges from $x_{i_u}$ to $y^j_{u,a}$, from $y^j_{u,a}$ to $y^j_{u,b}$, and from $y^j_{u,b}$ to $z_{k_u}$, for each $1 \leq u \leq l$.
%
The construction encodes the selection of a triple $(x_{i_v}, y_j, z_{k_v})$ by including the edges $x_{i_v} y^j_{v,a}$ and $y^j_{v,b} z_{k_v}$ in the realization, while the remaining vertices in $V_j$ forms a matching.
%
Observe that this instance's possibility graph $\calg$ is bipartite and subcubic. Each vertex of $Y_a\cup Y_b$ has degree two, while the vertices in $X \cup Z$ have a degree at most three, as no element occurs in more than three triples.

\begin{figure}[htb!]
    \centering
    \input{fig/proof_w=6}
    \caption{
    A \TDMT{} instance example where $T=\{(x_1, y_1, z_1), (x_1, y_2, z_2),\\ (x_2, y_1, z_1), (x_2, y_2, z_1), (x_3, y_2, z_2), (x_3, y_3, z_3)\}$. Distinct edge types are assigned to each triple, with a solution highlighted.
    The right image depicts the possibility graph of the reduced \GRC{} instance, with a feasible realization highlighted.
    }
    \label{fig:3dm3red}
    \vspace{-.5cm}
\end{figure}

% =>
If a feasible matching $M \subseteq T$ exists in the \TDMT{} instance, we can map it directly to the edges of a valid realization $G$ for the constructed \GRC{} instance.
%
For each $(x_{i_u}, y_j, z_{k_u}) \in M$, using the $u$th occurrence of $y_j$, we add the edges $x_{i_u} y^j_{u,a}$ and $y^j_{u,b} z_{k_u}$ to $G$. For each $(x_{i_v}, y_j, z_{k_v}) \in T \setminus M$, we add the edge $y^j_{v,a} y^j_{v,b}$.
%
Since $M$ is a solution, each vertex in $X \cup Z$ has degree one, satisfying the degree constraints.
%
Additionally, within each group $V_j$, exactly two vertices—$y^j_{u,a}$ and $y^j_{u,b}$ from a triple in $M$—connect to vertices in $X$ and $Z$, respectively. All other vertices within $V_j$ correspond to triples not included in $M$, forming a matching within $V_j$.
%
Therefore, $G$ fulfills both the degree sequence \texttt{d} by assigning degree one to every vertex and the cut list $\mathcal{L}$, meeting all the required constraints for a valid realization.

% <=
Conversely, if a graph $G$ exists that realizes both the degree sequence \texttt{d} and the cut list $\call$, we can construct a feasible matching $M \subseteq T$ for the \TDMT{} instance.
%
Since \texttt{d} specifies a degree of one for each vertex, the edges of $G$ form a matching.
%
Additionally, exactly two vertices within each group $V_j$ are matched to vertices of $X\cup Z$, meaning the remaining vertices within each $V_j$ form an internal matching.
%
These two externally matched vertices must correspond to the same triple in $T$; otherwise, the remaining vertices in $V_j$ could not be paired and meet the type $(V_j, 2)$ cut constraint.
%
Let $M$ consist of the triples in $T$ for which the associated $y^j_{u,a}$ and $y^j_{u,b}$ vertices in $V_j$ are connected to vertices in $X$ and $Z$, respectively.
%
Thus, by construction, vertex $x_i$ connects to $y^j_{u,a}$ and $y^j_{u,b}$ to $z_k$ if and only if the triple $(x_i, y_j, z_k)$ of $T$ belongs to $M$.
%
So $M$ contains exactly one triple per $V_j$, covering each element of $Y$ exactly once, thus $|M| = n$.
%
Since $G$ realizes $\call$, no edges exist between vertices in $X$ and $Z$. Hence, given that $G$ is a matching, each vertex in $X$ connects to exactly one vertex in $Y_a$, and each vertex in $Z$ connects to exactly one vertex in $Y_b$.
%
Consequently, $M$ constitutes a valid matching for the \TDMT{} instance.
\qed
\end{proof}

