\section{Problem Formulation}
\label{sec:problem_statement}

%\input{figures/symbols}

\noindent \textbf{Charger and Time Intervals}: Consider the building has $N$ heterogeneous chargers $\mathcal{C} = \{C_1, C_2, \dots,C_N\}$. Each charger $C_i$ has limits on the charging rate, minimum $C_i^{min}$ and maximum $C_i^{max}$; $C_i^{min} < 0$ implies the charger $C_i$ is bi-directional and can discharge and $C_i^{min} = 0$ represents a unidirectional charger with no discharging. We assume that all chargers are designed to be able to charge at maximum rates simultaneously, i.e., $\sum_{i=1}^{i=N} C_i^{max} < \text{maximum rated capacity of the building} $.  
The planning horizon is one billing period, usually a month, which we divide into equal-sized fixed time intervals $\mathcal{T} = \{T_1, T_2, \dots\, T_{end}\}$, where $T_{j}-T_{j-1}=\delta$ (we use  $\delta$ = 0.25 hours). The choice of $\delta$ is user-specific and provides a stable decision epoch, preventing rapid changes in the charging rate.

\noindent \textbf{Charging Power}: Let us assume that the function $\mathcal{P}:  \mathcal{C} \times \mathcal{T}  \rightarrow \Re$ specifies the power consumed by the charger $C_i$ at time $T_j$. If the power is zero, the charger is not active, and if the power is negative, the charger discharges, acting as an energy source. Note that by construction $P(C_i,T_j) \in [C_i^{min},C_i^{max}]$. Let us also assume that function $\mathcal{B}: \mathcal{T}  \rightarrow \Re^{+} $ specifies the average building power consumed in $\delta$ time interval. 
Given the charger and the building power consumption, we can calculate the total cost for the billing period. The parts of the total cost are based on the property type, time of day, and state of the power grid and are based upon the rules and regulations set by the local transmission system operator (TSO) and distribution system operator (DSO). These parts include energy expenses for building power and charging, which vary with peak and off-peak hours, as well as demand charges based on the peak power draw over a longer-term period. 

Let the price of the energy consumed is given by $\theta_E : \mathcal{T}  \rightarrow \Re^{+}$ (in \$/kWh). In practice, the Time-of-Use (TOU) electricity rates do not vary continuously and are rather divided into two parts each day, i.e., a peak and a non-peak period. 
Then, the total cost of the energy consumed is  $\Theta_E(\mathcal{P})= \sum_{j=1}^{j=end} \left(\sum_{i=1}^{i=N} (P(C_i,T_j)) + \Building (T_j)\right) \times \theta_E  (T_j) \times \delta$. Effectively, $\Theta_E$ is a function of charging power  $\mathcal{P}=\{P(C_i, T_j)| C_i\in \mathcal{C}, T_j\in \mathcal{T}\}$.  
 
\noindent \textbf{Demand Charge}: The demand charge is calculated using the maximum (peak) power consumed during any time interval in the billing period, with the demand price denoted as $\theta_D$ (in \$/kW).
Let $P^{max} = \max_{j=1}^{j=end} (\sum_{i=1}^{i=N}$ $P(C_i,T_j)) + \Building(T_j)$ denote the maximum power consumed. The demand charge is given by $\Theta_D(\mathcal{P})= \theta_D \times P^{max} \times \delta$, which is a function of charging power  $\mathcal{P}$. Hence, the total cost of energy bought from the power grid is  $\Theta_E(\mathcal{P})+\Theta_D(\mathcal{P})$. To minimize the cost, we must reduce the net power usage when the cost $\theta_E$ is high and manage the power peaks to ensure $P^{max}$ remains as low as possible. Often, the demand charge is levied to ensure that the industrial buildings do not put excess burden on the power grid. In our problem, we use estimates of peak power and denote it by $\hat{P}^{max}$. It is important to note that the demand charge is typically applied during peak hours of the TOU electricity rate, as reflected in our formulation.
%The challenge with being able to lower the demand charge is the coupled temporal complexity. Assume if along a billing period of one month, it is not possible to reduce $P^{max}$, which will occur in the last week of the month, we may as well utilize high charging powers in early part of the month. 

%Let us now describe the decision problem given the structure above. 
\noindent \textbf{Electric Vehicle Sessions}: Assume that during the billing period $\mathcal{T}$, a set of electric vehicles, denoted as $\mathcal{V}$, are serviced at the building. Each EV $V$ is characterized by its arrival time $\mathcal{A}: \mathcal{V} \rightarrow  \mathcal{T}$ and departure time $\mathcal{D}: \mathcal{V} \rightarrow  \mathcal{T}$. Note that if the same vehicle arrives more than once, we will treat it as a separate session. If the EV arrives between time slots $[T_{i-1}, T_{i}]$, we consider its effective arrival time as $\mathcal{A}(V) = T_i$. Similarly, if the vehicle departs between $[T_{j}, T_{j+1}]$, we consider its effective departure time as $\mathcal{D}(V) = T_j$. EV sessions are contiguous, i.e., EV is expected to remain at the site between $\mathcal{A}(V)$ and $\mathcal{D}(V)$, for $\forall V \in \mathcal{V}$. 
%Additionally, it is important to emphasize that we may know the estimated arrival time $\hat{\mathcal{A}}(V)$ and departure time $\hat{\mathcal{D}}(V)$ for each session, but true arrival and departure times are unknown ahead of time and can only be observed once they happen. 
For each  $V$, we know the initial state of charge   $\SOCI: \mathcal{V} \rightarrow \Re^+$ and the required final state of charge (measured as a percentage of the battery capacity)   $\SOCR: \mathcal{V} \rightarrow \Re^+$ upon arrival. $\SOCMIN: \mathcal{V} \rightarrow \Re^+$ is the minimum allowed SoC for the car i.e., the car cannot be discharged below this value, and $\SOCMAX: \mathcal{V} \rightarrow \Re^+$  is the maximum allowed SoC for the car. The minimum and maximum bounds are specified by the EV manufacturer, considering the impact of charging and discharging on battery health. ${\it CAP}:\mathcal{V} \rightarrow \Re^+$ denotes the vehicle's battery capacity in kWh. We track the current SoC of the EV using ${\it SOC}$, where ${\it SOC}: \mathcal{V} \times \mathcal{T} \rightarrow \Re^+$ and it is defined later.



% For each vehicle session, we record 



% and are assigned to available chargers in $\mathcal{C}$, with each EV represented by $V$.   
% Each EV $V$ is characterized by its arrival time $\mathcal{A}(V)$, its scheduled departure time $\mathcal{D}(V)$, and its energy capacity $C(V)$. Additionally, each EV has a required state of charge, $\SOCR(V)$, and an initial state of charge, $\SOCI(V)$.
% We assume that EVs arrive at continuous time. If an EV arrives between time slots $[T_{j-1}, T_{j}]$, we consider its effective arrival time as $\mathcal{A}(V) = T_j$. Similarly, if an EV departs between $[T_{j}, T_{j+1}]$, we consider its effective departure time as $\mathcal{D}(V) = T_j$.



%lowering the demand charge though is that if we know in future there is no possibility of reducing demand charge then we can 


%We describe the problem as a series of problems starting from the basic V2B problem and expanding to the more complex problem of optimizing charging policy across a month. ~\Cref{table:notations} summarizes the key symbols utilized in the paper.
%
%These costs vary based on the property type, time of day, state of grid, and are based upon the rules and regulations set by the local transmission system operator (TSO) and distribution system operator (DSO). These costs include energy expenses for building power and charging, which vary with peak and off-peak hours, as well as demand charges based on the peak power draw over a longer-term period (e.g., one month). 


%To formalize this problem, we first provide~\Cref{table:notations} summarizing all notations used in this paper. 

% \subsection{Basic Vehicle-to-Building Problem} 
% % For any V2B problem we suppose that there are a set of mixed-mode chargers denoted as $\mathcal{C} = \{C^1, C^2, \dots\}$. Each charger $C_i$ is characterized by available charging powers within the range $[P^i_{\text{min}}, P^i_{\text{max}}]$, where $P^i_{\text{min}} < 0$ if charger $C_i$ is bi-directional. 
% %
% % Simple V2B 
% \textbf{Basic V2B Problem}: The objective of the Vehicle-to-Building (V2B) problem is to optimally schedule Electric Vehicle (EV) charging and discharging throughout a billing period to minimize the total electricity bill, while ensuring that each EV reaches its required state of charge (SoC) (\% of its capacity) by the time of departure. This required SoC represents the portion of the EV's total energy capacity that must be met before it leaves.
 
% %We focus on controlling the charging powers of EV-connected chargers online during the billing period $\mathcal{T}$. We adjust the charging power $P^i_t$ (in kilowatts) of each charger $C_i$ at each time slot $t$, indexed by $\{0, 1, \dots, t_{\text{end}}\}$, corresponding to a fixed time interval $\Delta t$ (in hours). The values $0$ and $t_{\text{end}}$ denote the start and end of the billing period, respectively. 

% % EVs arriving during the billing period $\mathcal{T}$ are assigned available chargers. We let $v$ represent an EV arriving during $\mathcal{T}$, which would be assigned to a charger in $ \mathcal{C}$. 
% %${\it V2C}(v)\in \mathcal{C}$. 
% % Inthe problem, each EV $v$ is specified by its arrival time $T_\mathcal{A}(V)$, predefined departure time $T_\mathcal{D}(V)$, and a power capacity ${\it Cap}(v)$. Additionally, each EV has a required State of Charge (SoC) ${\it SOC}^{req}(v)$ that indicates the desired energy ratio of its power capacity that must be reached before departure, and an initial SoC ${\it SoC^{in}}(v)$. 
% % Here we use $v_t^i$ to indicate the EV connected to charger $C_i$ at time slot $t$. 
% Assume that during the billing period $\mathcal{T}$, a set of EVs, denoted as $\mathcal{V}$, arrive and are assigned to available chargers in $\mathcal{C}$, with each EV represented by $V$.   
% Each EV $V$ is characterized by its arrival time $\mathcal{A}(V)$, its scheduled departure time $\mathcal{D}(V)$, and its energy capacity $C(V)$. Additionally, each EV has a required state of charge, $\SOCR(V)$, and an initial state of charge, $\SOCI(V)$.
% We assume that EVs arrive at continuous time. If an EV arrives between time slots $[T_{j-1}, T_{j}]$, we consider its effective arrival time as $\mathcal{A}(V) = T_j$. Similarly, if an EV departs between $[T_{j}, T_{j+1}]$, we consider its effective departure time as $\mathcal{D}(V) = T_j$.

%which indicates the target energy level (as a percentage of its capacity) that must be reached before its departure, 
%We use $v_t^i$ to represent the EV connected to charger $C_i$ at time slot $t$. The SoC of each charger-connected EV is tracked at each time slot, ${\it SOC}_t(v^i_t)$, based on the charging power of its connected charger, and initialized by ${\it SoC^{in}}(v)$. It is updated according to the following equation: 
\noindent \textbf{Charger Assignment}: 
{
Our approach employs a two-layer decision-making process for EV charging optimization. First, a heuristic assigns EVs to chargers upon arrival. Second, an RL-based policy optimizes charging rates at fixed intervals. 
}
We define an EV assignment function $\eta: \mathcal{V} \rightarrow \mathcal{C}$, where ($V \in \mathcal{V}$) $\eta(V) = C_i$ indicates the charger assigned to EV $V$. Correspondingly, we also maintain a charger-EV occupancy function $\phi: \mathcal{C} \times \mathcal{T} \rightarrow \mathcal{V}$, where $\phi(C_i, T_j) = V$, representing the connection of charger $C_i$ with EV $V$ at time $T_j$.  
The correlation of these two functions can be expressed as $\phi(\eta(V), T_j) = V, \ \text{s.t.}\ \mathcal{A}(V) \leq T_j \leq \mathcal{D}(V) $
indicating that if EV $V$ is assigned to charger $C_i$ through the function $\eta$, then at any time slot within its stay duration, it is confirmed that EV $V$ is connected to charger $C_i$. If no EV is connected to the charger at time $T_j$, the function may return a $\emptyset$ denoting an inactive state, expressed as $\phi(C_i, T_j) = \emptyset$. 
% This highlights the dynamic nature of charger assignments, ensuring that no two EVs share a charger simultaneously. Our FIFO policy prioritizes bidirectional chargers as the optimal strategy (see Table 5 in the Appendix), assigning EVs accordingly to optimize charging efficiency.  
This underscores the dynamic nature of charger assignments, which ensures that no two electric vehicles share a charger simultaneously. Our FIFO policy prioritizes bidirectional chargers as the optimal strategy (see ~\Cref{table:charger_assignment_policies} in the appendix\footnote{The full paper, including the appendix, is available on arXiv.}), enhancing charging efficiency. 
% emphasizing the dynamic nature of the connection function. Note that two vehicles cannot be connected to a charger simultaneously. We consider a first-in, first-out policy that assigns EVs to bidirectional chargers first. 
% , breaking ties assigning to later departing cars, 
% It is also important to emphasize that if the chargers are homogeneous and their count is greater than the number of vehicles, then the assignment problem will be trivial. Otherwise, the assignment problem is part of the decision process, as is our case. 
We also maintain the connection between the assigned charger and the EV until departure. For EV charging, we approximate a linear charging profile, following prior work~\cite{sundstrom2010optimization}. The SoC is updated at each time slot  $T_j$  using the following equation: 
\begin{equation}
{\it SOC}(V, T_{j+1}) = {\it SOC}(V, T_j) + \textstyle\frac{P(\eta(V), T_j)\times \delta} {{\it CAP}(V)}
\label{eq: soc}
\end{equation} 


\iffalse
For the EV assignment approach, we utilize a FIFO (First In, First Out) procedure that prioritizes bi-directional charging and charger ID. This ensures that the earliest arriving EVs are charged or discharged first while maximizing the use of bi-directional chargers, which offers the potential for peak shaving and demand charge reduction. Here, we use the function $\text{ID}(C_i)$ to indicate the charger ID of $C_i$, prioritizing EV assignment to bi-directional chargers by using smaller ID numbers. To enable this FIFO procedure, we set constraints to ensure the FIFO procedure: 
\begin{equation}
    \mathcal{A}(V) < A(V_{k+1}) \implies \text{ID}(\eta(V)) < \text{ID}(\eta(V_{k+1}))
\end{equation} 
This constraint indicates that if the arrival time of EV $V$ is earlier than that of EV $V_{k+1}$, then the ID of the charger assigned to $V$ must also be smaller than the ID of the charger assigned to $V_{k+1}$.  


We then track the state of charge (SoC) of EVs after they connect to chargers based on the charging power of the chargers. We define the function $SoC: \mathcal{V} \times \mathcal{T} \rightarrow [0, 1]$. The SoC update function is given by  
\begin{equation}
SoC(V, T_{I+1}) = SoC(V, T_j) + \frac{P(\eta(V), T_j) \times\delta }{C(V)},
\end{equation} 
with time slot $T_j \geq \mathcal{A}(V)$ and $T_{j+1} \leq \mathcal{D}(V)$, and $P(\eta(V), T_j)$ represents the charging power of the charger assigned to EV $V$ at time $T_j$, and $\Delta $ is the time interval.  
% We track the SoC of each charger-connected EV at each time slot, ${\it SOC}_t(v^i_t)$, based on its connected charger's charging power, initialized by ${\it SoC^{in}}(v)$. It is updated according to: 
% \begin{equation}
%     % {\it SOC}_{t+1}(v) = {\it SOC}_t(v) + P^{{\it V2C}(v)}_{t}\delta t / {\it Cap}(v), 
%     {\it SOC}_{t+1}(v_{t+1}^i) = {\it SOC}_{t}(v_t^i) + (P^i_t \times\delta t)/{\it Cap}(v_t^i)
% \label{eq: SoC}
% \end{equation}
% Here we use $v_t^i$ to indicate the EV connected to charger $C_i$ at time slot $t$.  
\fi 



\noindent \textbf{Feasibility}:
The set \textit{Feasible} indicates the feasible solutions that satisfy the following constraints:
\begin{align}
    & \forall C_i \in \mathcal{C}, \forall T_j \in \mathcal{T}: C_i^{min} \leq P(C_i, T_j) \leq C_i^{max} \label{eq:charging_rate} \\
    & \forall C_i \in \mathcal{C}, \forall T_j \in \mathcal{T}, \forall V \in \mathcal{V}: {\it SOC}(V, T_j) \geq \SOCMIN(V)\label{eq:soc_min} \\
    & \forall C_i \in \mathcal{C}, \forall T_j \in \mathcal{T}, \forall V \in \mathcal{V}: {\it SOC}(V, T_j)\leq \SOCMAX(V)\label{eq:soc_max} \\
    & \forall T_j \in \mathcal{T}: \textstyle\sum_{C_i \in \mathcal{C}} P(C_i, T_j) + \mathcal{B}(T_j) \geq 0  \label{eq:building_power}     
\end{align} 
Here, Constraint~(\ref{eq:charging_rate}) guarantees a valid charging action range, Constraints~(\ref{eq:soc_min} and \ref{eq:soc_max}) ensures that each EV's SoC remains within an acceptable range, and Constraint~(\ref{eq:building_power}) ensures that discharging power does not exceed building power. 




\noindent \textbf{Objectives}: 
% \SOCMIN(V) \geq \text{SoC}(V, T_j) \leq \SOCMAX(V), \forall C_i \in \mathcal{C}, \forall T_j \in \mathcal{T} \label{eq:soc_range} \\ 
% & \mathcal{B}(T_j) + \sum_{C_i \in \mathcal{C}} P(C_i, T_j) \geq 0, \quad \forall T_j \in \mathcal{T} \label{eq:building_power} 
% One of the primary objectives is to ensure the vehicles are charged to the requirement by the time they leave. The decision variable is the charger assignment and charging power per interval. % Thus, if $\eta$ is the charger assignment and $\mathcal{P}$ is the charging power decision per charger per interval, then % The objective of the energy trading problem is to maximize the amount of energy traded.
% Formally, an optimal solution to the energy trading problem is
% To fulfill charging requirements, one objective of this V2B problem is to decide the charger charging powers across all time slots, denoted as $\mathcal{P} = \{P(C_i, T_j)$| $C_i \in \mathcal{C}$ and $T_j \in \mathcal{T}\}$. The goal is to minimize the discrepancy between each EV's SoC at departure and its required SoC, denoted as $\Delta_{{\it SOC}}(\mathcal{P})$, computed by:
% \begin{equation}
% \arg\min_{\mathcal{P}}\delta_{{\it SOC}}(\mathcal{P}) = \sum_{V \in \mathcal{V}} \max\left( {\it SOC}^R(V) - {\it SOC}(V, \mathcal{D}(V)), 0 \right)
% \label{eq: soc}
% \end{equation}  
One of our objectives for the V2B problem is to minimize the total cost over the billing period, incorporating the Time-Of-Use (TOU) electricity rates and demand charges. This objective is expressed as:
% $\min_{(\eta,\mathcal{P}) \in \textit{Feasible}}$
% %(\mathcal{B}, \theta_E, \theta_D, \mathcal{V}, \SOCR, \SOCI, \SOCMIN,\SOCMAX, \mathcal{C})} \\  
% $\left( \Theta_E (\mathcal{P}) + \Theta_D(\mathcal{P}) \right)$
\begin{align}
\label{eq: billing}
\begin{split}
\min_{(\eta,\mathcal{P}) \, \in \textit{Feasible}}%(\mathcal{B}, \theta_E, \theta_D, \mathcal{V}, \SOCR, \SOCI, \SOCMIN,\SOCMAX, \mathcal{C})} \\  
\left( \Theta_E (\mathcal{P}) + \Theta_D(\mathcal{P}) \right)
\end{split}
\end{align}

The second objective ensures that vehicles are charged to their requirement, $\SOCR$, by the time they leave.
\begin{align}
\label{eq: soc_penalty}
\begin{split}
\min_{(\eta,\mathcal{P}) \in \textit{Feasible}} \textstyle\sum_{V \in \mathcal{V}} \max(\SOCR(V) - {\it SOC}(V,\mathcal{D}(V)), 0)
\end{split}
\end{align}
% The inner \texttt{max} function guarantees that all EV users' energy requirements are satisfied, even if this leads to overcharging the vehicle, as dictated by the problem's conditions.
The inner \texttt{max} function ensures EV users' energy requirements are met, even if overcharging occurs.
However, in practical scenarios, short stays may make meeting the SoC requirement impossible. To address this, we reformulate the objectives into a multi-weighted framework.
The optimal charger assignment and actions are then determined by optimizing these combined objectives.




% \begin{equation}
% \arg\min_{\mathcal{P}} \left( \Theta_E (\mathcal{P}) + \Theta_D(\mathcal{P}) \right)
% \label{eq: billing}
% \end{equation} 



% We consider two approaches to address the multi-objective aspect of this problem. First, we can set the SoC objective (as shown in Equation~(\ref{eq: soc})) as a constraint, ensuring that the SoC discrepancy is zero at the time of EV departure by requiring $\Delta_{{\it SoC}}(\mathcal{P}) = 0$. However, in practical scenarios, meeting the SoC requirement may be impossible due to short stay durations and high demand. Therefore, we opt for the second approach, which involves using a weighted sum of both objective functions:
% \begin{equation}
% \arg\min_{\mathcal{P}} \alpha \times \left( \Theta_E (\mathcal{P}) + \Theta_D(\mathcal{P}) \right) + \beta \times\delta_{{\it SoC}}(\mathcal{P}) 
% \label{eq: billing} 
% \end{equation} 
% In this method, we assign a high penalty coefficient $\beta$ for missing SoC to prioritize the SoC charging requirements.


% Moreover, we impose the following constraints on  $\mathcal{P}$:  \begin{subequations}

% Here, the set \(\{v_t^i \mid t \in \mathcal{T}, C_i \in \mathcal{C}\}\) represents all arriving EVs connected to chargers during the billing period \(\mathcal{T}\).


% V2B for Industrial Profiles
%Commercial and industrial complexes are often billed differently that residential houses. Their electricity rates often vary across a single day based on a rate structure used by electric utilities. 
% Our V2B scenario for commercial and industrial complexes
% work under Time-of-use (TOU) rates policies electricity bill. TOU rates incentives customers to use electricity during off-peak hours and reduce usage during peak hours. This pricing model reflects the varying cost of generating and delivering electricity at different times of the day, which is influenced by the overall demand on the electrical grid. 
%By adjusting their energy consumption patterns—such as running heavy machinery or charging electric vehicles during off-peak hours—industrial and commercial businesses can take advantage of lower rates and significantly reduce their overall electricity costs.

\iffalse
% \textbf{V2B for Commercial Buildings}: 
% This work is specifically designed for commercial and industrial smart buildings with EV chargers. By optimally controlling the charger charging power $\mathcal{P}$, the secondary objective of the V2B problem is to minimize the total electricity bill, considering both building power consumption and EV charging, {\color{black} which is governed by Time-of-Use (TOU) rate and demand charge policies.}
% TOU rates encourage customers to shift electricity usage to off-peak hours and reduce consumption during peak periods, reflecting the fluctuating costs of electricity generation and delivery based on grid demand.
% We denote the peak hour time slots during the billing period $\mathcal{T}$ as $\mathcal{T}_P$. 


% In addition to kilowatt-hour (kWh) consumption charges, businesses incur {\it demand charge} based on their peak power demand (measured in kilowatts, kW) during the billing period. %These charges ensure utilities maintain the capacity to meet maximum electricity needs. 
% For industrial businesses, managing demand charges is crucial for controlling energy costs. the V2B problem focuses on reducing peak demand by shifting loads, such as discharging EVs to supply building energy needs, thereby lowering overall grid power consumption. Here, we denote the demand price as  ${\it Pr}^{D}$ (in \$/kW).  

% Above all, we design the second objective of the V2B problem to optimize the charging power sequence $\mathcal{P}$ to minimize the total bill over the billing period, incorporating TOU rates and demand charges. This total cost, denoted as $\hat{Cost}(\mathcal{P})$, is computed by: 
% \begin{equation}
% \displaystyle
% \arg\min \hat{\Theta}(\mathcal{P}) = \Theta_E(\mathcal{P}) + \Theta^{D}(\mathcal{P})
% \label{eq:objective_1}
% \end{equation}

% where ${\it B}(T_j)$ denotes the building power at time slot $t$.  %and ${\it Pr}^E_t$ represents the electricity price, which varies over time and is typically higher during peak hours and lower during off-peak hours.  
% and ${\it Cost}^{DC}(\mathcal{P})$ denotes the demand charge, is determined based on the peak power consumption from both building power and charging. This charge can be calculated by: 
% \begin{equation}
%     \Theta_D(\mathcal{P}) =\max_{T_j\in\mathcal{T}_{P}} (\mathcal{B}(T_j)+\sum_{C_i\in\mathcal{C}}{\it P}(C_i, T_j))\times \theta_D 
% \end{equation}. 

% % V2B under uncertainty
% \textbf{V2B Under Uncertainty}: Uncertainty in the V2B problem arises from various factors. User behavior, such as the actual arrival and departure times of EVs, can deviate from the planned schedule due to traffic conditions or individual preferences, complicating predictions. The SoC required by EV users also varies among individuals under different circumstances. Additionally, building power demand can fluctuate significantly across seasons and may experience sudden changes, prompting Transmission System Operators (TSOs) to activate emergency load reduction programs to alleviate grid stress. Each of these uncertainties impact the overall objective, making their consideration essential in the V2B problem. 

%  \subsection{\nissan{} Use Case} 
% Our work aims to collaborate with our industry partner, \nissan{}, an EV manufacturer with a smart building equipped with both unidirectional and bidirectional chargers, as shown in ~\Cref{fig: EV chargers}. We are developing an online EV charging system to minimize the total electricity bill over a billing period of one month under a Time-of-Use (TOU) rate policy for their headquarters. 

% \noindent \textbf{Charger and EV availability}: Currently, {\color{black} Nissan Advanced Technology Center - Silicon Valley (NATCSV), is a smart building that offers 8 unidirectional and 5 bidirectional chargers for employees. Additionally, they manufacture EVs with bidirectional capabilities such as the Nissan Leaf.} These vehicles have battery sizes ranging from 42 kWh to 60 kWh. Thus, several of them are capable of providing substantial power back to the building when needed.

% \noindent \textbf{Service Classification:} Their headquarters fall within the bounds of Silicon Valley Power (SVP), a not-for-profit municipal electric utility owned and operated by the City of Santa Clara, California, United States. Due to their size and energy consumption, NATCSV is classified as a small industrial service under SVP.
% % For commercial and industrial customers whose energy use exceeds 8,000 kWh per month, but whose maximum electric demand does not exceed 4,000 (kW),
% This means that aside from the monthly electricity bills, they are also subject to time-of-use (TOU) rates and demand charges. The presence of these factors make NATCSV a candidate for V2B optimization. TOU introduces variations in the electricity rates, billing them higher during peak hours (6:00AM to 10:00PM) compared to off-peak hours. While demand charge adds a flat rate multiplier to their total bill based on the highest average kW delivery of the 15-minutes interval in which
% such delivery is greater than in any other 15-minute interval in the month.
% %
% The goal is to leverage the combination of bidirectional chargers, EVs, and a smart charging policy to potentially reduce electricity costs and demand charges. 

% \noindent \textbf{Data}:To leverage this opportunity, \nissan{} has collected building demand and EV telemetry data related to vehicle arrival/departure schedules and SoC needs from their headquarters and EVs. They have amassed data from May 2023 to January 2024 (detailed in Section~\ref{ssec:data}), which will be utilized in this paper to ensure the authenticity of the results. 

\fi