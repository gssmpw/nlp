\pgfplotstableread[col sep=comma]{results/all_months_total_bill_mean_std.csv}{\alltotalbilltable}
\pgfplotstableread[col sep=comma]{results/test_set_car_arrival_metadata.csv}\testmetadatacar
\pgfplotstableread[col sep=comma]{results/test_set_building_metadata.csv}\testmetadatabldg
 \pgfplotstableread[col sep=comma]{results/all_demand_charge_mean_std_peak_shave.csv}{\peakshavetable}



\newcommand{\plotwidth}{0.9}
\newcommand{\plotheight}{4.5cm} % 5cm
 
\begin{figure*}[htbp]
\centering
\begin{tikzpicture}
\begin{groupplot}[
    width=\plotwidth\linewidth,
    height=\plotheight,
    group style={
        group size=1 by 3, % 3 column, 2 rows
        vertical sep=0.0cm, % Separation between plots
        horizontal sep=0.2cm, % Separation between plots
    },
]
\nextgroupplot[
    % ymin=0, 
    % ymax=100, 
    % ylabel=SoC(\%), 
    % ytick align=outside,
    % ytick pos=left,
    % axis y line=left
    ybar,
    grid=both,
    major grid style={dashed},            
    minor grid style={dashed},     
    tick pos=left,
    bar width=0.09,
    ylabel={Total Bill (\$)},
    xtick=data,
    % xticklabels = {MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC,JAN},
    xticklabels = {},
    major x tick style = {opacity=0},
    minor x tick num = 1,
    minor y tick num=3,
    minor tick length=0ex,
    legend style={
        nodes={scale=0.8, transform shape}, 
        legend columns=7,
        at={(0.47, 1.18)},
    },
]
  \addplot+[error bars/.cd,y dir=both,y explicit,] 
  table[x={month},y={MILP}, y error={MILP STD}] \alltotalbilltable; 
  \legend{MILP}
  
  \addplot+[error bars/.cd,y dir=both,y explicit,] 
  table[x={month},y={RL}, y error={RL STD}] \alltotalbilltable; 
  \addlegendentry{RL}
  
  \addplot+[error bars/.cd,y dir=both,y explicit,]
  table[x={month},y={Trickle LLF}, y error={Trickle LLF STD}] \alltotalbilltable; 
  \addlegendentry{Trickle LLF}
  
  \addplot+[error bars/.cd,y dir=both,y explicit,] 
  table[x={month},y={Charge First EDF}, y error={Charge First EDF STD}] \alltotalbilltable; 
  \addlegendentry{Charge EDF}
  
  \addplot+[error bars/.cd,y dir=both,y explicit,] 
  table[x={month},y={Trickle}, y error={Trickle STD}] \alltotalbilltable; 
  \addlegendentry{Trickle}
  
  \addplot+[error bars/.cd,y dir=both,y explicit,
  ] table[x={month},y={Fast Charge}, y error={Fast Charge STD}] \alltotalbilltable; 
  \addlegendentry{Fast Charge}


%%%%%%%%%%%%%%%%%%%%%% 2nd PLOT PEAK SHAVING %%%%%%%%%%%%%%%%%%%%%%
\nextgroupplot[
    % ymin=0, 
    % ymax=100, 
    % ylabel=SoC(\%), 
    % ytick align=outside,
    % ytick pos=left,
    % axis y line=left
    ybar,
    grid=both,
    major grid style={dashed},            
    minor grid style={dashed},     
    tick pos=left,
    bar width=0.09,
    ylabel={Peak Shaving (\$)},
    xtick=data,
    xticklabels = {MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC,JAN},
    major x tick style = {opacity=0},
    minor x tick num = 1,
    minor y tick num=3,
    minor tick length=0ex,
]
  \addplot+[error bars/.cd,y dir=both,y explicit,] 
  table[x={month},y={MILP}, y error={MILP STD}] \peakshavetable; 
  % \legend{ILP}
  
  \addplot+[error bars/.cd,y dir=both,y explicit,] 
  table[x={month},y={RL}, y error={RL STD}] \peakshavetable; 
  % \addlegendentry{RL}
  
  \addplot+[error bars/.cd,y dir=both,y explicit,] 
  table[x={month},y={Trickle LLF}, y error={Trickle LLF STD}] \peakshavetable; 
  % \addlegendentry{Trickle LLF}
  
  \addplot+[error bars/.cd,y dir=both,y explicit,] 
  table[x={month},y={Charge First EDF}, y error={Charge First EDF STD}] \peakshavetable; 
  % \addlegendentry{Charge EDF}
  
  \addplot+[error bars/.cd,y dir=both,y explicit,] 
  table[x={month},y={Trickle}, y error={Trickle STD}] \peakshavetable; 
  % \addlegendentry{Trickle}
  
  \addplot+[error bars/.cd,y dir=both,y explicit,] 
  table[x={month},y={Fast Charge}, y error={Fast Charge STD}] \peakshavetable; 
  % \addlegendentry{Fast Charge}


  

%%%%%%%%%%%%%%%%%%%%%% 3rd PLOT Input Distributions? %%%%%%%%%%%%%%%%%%%%%%
% \nextgroupplot[
%     ybar,
%     grid=both,
%     major grid style={dashed},            
%     minor grid style={dashed},     
%     tick pos=left,
%     bar width=0.09,
%     ylabel={Peak Shaving (\$)},
%     xtick=data,
%     xticklabels = {MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC,JAN},
%     major x tick style = {opacity=0},
%     minor x tick num = 1,
%     minor y tick num=3,
%     minor tick length=0ex,
% ]

\end{groupplot}

%%%%%%%%%%%%%%%%%%%%%% Secondary Y Axis plots %%%%%%%%%%%%%%%%%%%%%%

\begin{groupplot}[
        width=\plotwidth\linewidth,
        height=\plotheight,
        group style={
            group size=1 by 3, % 3 column, 2 rows
            vertical sep=0.0cm, % Separation between plots
            horizontal sep=0.2cm, % Separation between plots
        },
        % scale only axis,
        ytick align=outside,
        ytick pos=right,
        axis y line=right,
        axis x line=none,
        % ticks=none,
        legend style={nodes={scale=0.8, transform shape}, 
                      legend columns=2,
                      at={(1, 2.08)},
                      anchor=east,
        },
    ]

%%%%% Secondary Y for Top Plot %%%%%
\nextgroupplot[
    xtick=data,
    xticklabels = {},
    ylabel={Daily Arrival\\Count},
    ylabel style={align=center}
]
    \addplot [blue, mark=square,
              error bars/.cd,y dir=both, y explicit,
              error bar style={line width=1pt},] 
    table [
        x={x}, 
        y={mean},
        y error={std}
    ] {\testmetadatacar};
    % \addlegendentry{Daily Cars}
    \label{plot:daily_cars}

%%%%% Secondary Y for Middle Plot %%%%%
\nextgroupplot[
    xtick=data,
    xticklabels = {},
    ylabel={Peak Building\\Power Draw (kW)},
    ylabel style={align=center}
]
    \addlegendimage{/pgfplots/refstyle={plot:daily_cars}}\addlegendentry{Daily Cars}
    \addplot [red, mark=triangle,
              error bars/.cd,y dir=both, y explicit,
              error bar style={line width=1pt},]
    table [
        x={x}, 
        y={mean},
        y error={std}
    ] {\testmetadatabldg};
    \addlegendentry{Peak Building Power}
    
\end{groupplot}



 \end{tikzpicture}
 
 \caption{(Top) Average total bill per month for each policy. For the majority of the months, RL outperforms all heuristics. Lower is better. Secondary Y-axis shows the average number of cars arriving per month. (Bottom) Average peak shaving done by policy. Again, RL outperforms almost all heuristics. Higher is better. Secondary Y-axis shows peak building power draw per month. The performance of the policies reflect the input data. Example, August experiences the highest total bill due to having high peak demand with minimal number of cars to offset the load.}
 \label{fig:all_total_bills}
 \Description[<short description>]{<long description>}
 \end{figure*}
