\pgfplotstableread[col sep=comma]{results/training_data_arrival_distribution.csv}{\arrdata}
\pgfplotstableread[col sep=comma]{results/training_data_departure_distribution.csv}{\depdata}
\pgfplotstableread[col sep=comma]{results/weekday_building_hour_peaks_distribution.csv}{\bldgdata}
\pgfplotstableread[col sep=comma]{results/grid_prices.csv}{\griddata}


\begin{figure}[H]
\begin{tikzpicture}

\begin{groupplot}[
            group style={
        group size=1 by 2,
        xlabels at=edge bottom,
        xticklabels at=edge bottom,
        vertical sep=0pt,
        },
        width=0.9\linewidth,
        height=3.5cm,
        xlabel=Hour of day,
        xmin=0, xmax=24,
        xtick align=outside,xtick pos=left,
        % scale only axis,
        ytick align=outside,
        ytick pos=left,
        axis y line=left,
        legend style={nodes={scale=0.8, transform shape}, 
                      legend columns=2,
                      at={(0.48, 0.85)},
                      anchor=east,
        },
        ]

\nextgroupplot[ymin=0, ymax=100, ylabel=SoC(\%), ytick align=outside,ytick pos=left,axis y line=left]

   \addplot[only marks,mark=triangle*,blue!80,
   % fill opacity=0.5, draw opacity=0,
   mark size=3pt,
   ] table[x=ahour,y=soc] {\arrdata};
   \addlegendentry{Arrivals}

   \addplot[only marks,mark=*, red!80,
   fill opacity=0.5, draw opacity=0,
   mark size=2pt,
   ] table[x=dhour,y=required_soc_at_depart] {\depdata};
   \addlegendentry{Departures}
   
\nextgroupplot[ylabel={Peak power (kW)}, yticklabel={},
% height=4cm,
        xtick style={
            /pgfplots/major tick length=0pt,
        },
        legend style={nodes={scale=1.0, transform shape}, 
                      legend columns=2,
                      at={(0.35, 0.85)},
                      anchor=east,
        },
]  
   \addplot[only marks,mark=square*,blue!40] table[x=hour,y=power] {\bldgdata};
   \label{plot:peakdemand}
   % \addlegendentry{Peak Demand}


\end{groupplot}

\begin{groupplot}[
        group style={
             group name=plots,
             group size=1 by 2,
             xlabels at=edge bottom,
             xticklabels at=edge bottom,
             vertical sep=0pt,
        },
        width=0.9\linewidth,
        height=3.5cm,
        xmin=0, xmax=24,
        % scale only axis,
        ytick align=outside,
        ytick pos=right,
        axis y line=right,
        axis x line=none,
        % ticks=none,
        legend style={nodes={scale=0.8, transform shape}, 
                      legend columns=1,
                      at={(0.4, 0.8)},
                      anchor=east,
        },
        ]

\nextgroupplot[ymin=0,ymax=500,
               ylabel={},
               yticklabels={},
]

\nextgroupplot[
ymin=0.11271,ymax=0.2,
               ylabel={Rate (\$/kWh)},
               % yticklabels={},
               % ytick={0.112, 0.146}
               ]  
\addlegendimage{/pgfplots/refstyle={plot:peakdemand}}\addlegendentry{Peak Demand}
\addplot[thick, mark=*, mark options={solid, color=red!40}, color=red!40] table[col sep=comma, x=hour, y=price] {\griddata};
   \addlegendentry{Rate}

\end{groupplot}
\end{tikzpicture}

\caption{(Top) Distribution of EV hours and SoC for both arrivals and departures across 8 months. (Bottom) Distribution of peak building power draw against the hours of day it was drawn and the TOU rates across the day. The majority of the car arrivals and departure occur within high peak pricing times and all of the peak power draw happens during peak pricing time.}
\Description[<short description>]{<long description>}
\label{fig:car_distributions}
\end{figure}