\begin{proof}[Proof of Lemma~\ref{lem:VstarVplan}]

The lemma is proven by induction over $h$, starting from $V^{\star}_{H+1} = V_{H+1}=\bm{0}$. We have
\begin{align*}
    &Q^{\star}_h(s,a) - Q_{h}(s,a) - \sum_{h'=h}^H\left(\beta(\delta)(\sigma_{h,N}(s_h,a_h)+\frac{2}{\sqrt{N}})+\frac{2}{N}\right)\\
    &= r(s,a)+ [P_hV^{\star}_{h+1}](s,a)- r(s,a) - \hat{g}_{h}(s,a)- \sum_{h'=h}^H\left(\beta(\delta)(\sigma_{h,N}(s,a)+\frac{2}{\sqrt{N}})+\frac{2}{N}\right)\\
    &\le [P_hV^{\star}_{h+1}](s,a) -[P_hV_{h+1}](s,a)- \sum_{h'=h+1}^H\left(\beta(\delta)(\sigma_{h,N}(s,a)+\frac{2}{\sqrt{N}})+\frac{2}{N}\right)\\
    &=[P_h(V^{\star}_{h+1}-V_{h+1})](s,a)+\beta(\delta)(\sigma_{h,N}(s,a)(s,a)+\frac{2}{\sqrt{n}})+\frac{2}{n}.\\
\end{align*}
The inequality holds by $\Ec$.
Then, we have
\begin{align*}
    V^{\star}_h(s_h) - V_h(s_h) &=
    \max_{a\in\Ac} Q^{\star}_h(s,a) - \max_{a\in\Ac}Q_{h}(s,a)\\
    &\le \max_{a\in\Ac} \{Q^{\star}_h(s,a) - Q_{h}(s,a)\}\\
    &\le 0
\end{align*}
That proves the lemma. 

\end{proof}




\begin{proof}[Proof of Lemma~\ref{VHVpisum}]
Note that $V_{H+1}=V^{\pi}_{H+1}=\bm{0}$. We next obtain a recursive relationship for the difference $V_h(s)-V^{\pi}_h(s)$. 
\begin{align*}
    V_h(s_h)-V^{\pi}_h(s_h) &= Q_h\left(s_h, \pi(s_h)\right) -  Q^{\pi}_h\left(s_h, \pi(s_h)\right) \\
    &=r\left(s_h, \pi(s_h)\right) + \hat{g}_h\left(s_h, \pi(s_h)\right) + \beta\sigma^N_h\left(s_h, \pi(s_h)\right) - r\left(s_h, \pi(s_h)\right) - [P_hV^{\pi}_{h+1}]\left(s_h, \pi(s_h)\right)\\
    &\le [P_hV_{h+1}]\left(s_h, \pi(s_h)\right) +2\beta\sigma^N_h\left(s_h, \pi(s_h)\right) - [P_hV^{\pi}_{h+1}]\left(s_h, \pi(s_h)\right),\\
\end{align*}
where the inequality is due to $\Ec_1$. 

Recursive application of the above inequality over $h=H, H-1, \cdots, 1$, we obtain
\begin{align*}
    V_1(s_1) - V_1^{\pi}(s_1)& \le \E_{s_{h+1}\sim P(\cdot|s_h,\pi(s_h)), h \le H}\left[\sum_{h=1}^H2\beta\sigma^N_h\left(s_h, \pi(s_h)\right)\right]\\
    &=2HV_1^{\pi}(s_1; \alpha/H )
\end{align*}


\end{proof}


\begin{proof}[Proof of Lemma~\ref{lem:vnstar_vn}]

    
    The lemma is proven by induction, starting from $V^{\star}_{h_0+1}(\cdot; \tilde{\sigma}^{h_0}_{ n})=V_{h_0+1,n}=\bm{0}$. We have, for $h\le h_0$
    \begin{align}\nn
        V^{\star}_{h}(s; \tilde{\sigma}^{h_0}_{ n})-V_{h,n}(s) &= \max_{a\in\Ac} Q^{\star}_{h}(s,a; \tilde{\sigma}^{h_0}_{ n})-\max_{a\in\Ac}Q_{h,n}(s,a)\\\nn
        &\le \max_{a\in\Ac} \left\{Q^{\star}_{h}(s,a; \tilde{\sigma}^{h_0}_{ n})-Q_{h,n}(s,a)\right\}\\\nn
        & =\max_{a\in\Ac} \left\{[P_hV^{\star}_{h+1}](s,a; \tilde{\sigma}^{h_0}_{ n})-[P_hV_{h+1,n}](s,a)\right\}\\\nn
        &\le 0. 
    \end{align}
    The fist inequality is due to rearrangement of $\max$ and the second inequality is by the base of induction. We thus prove the lemma. 
\end{proof}


\begin{proof}[Proof of Lemma~\ref{lem:v_minus_vpi}]
We have
\begin{align}
    V_{h,n}(s_h)- V^{\pi_n}_h(s_h; \tilde{\sigma}^{h_0}_n)
    &=
    Q_{h,n}(s_h, a_h)- Q^{\pi_n}_h(s_h, a_h; \tilde{\sigma}^{h_0}_n)\\\nn &\le r(s_h, a_h) + [P_hV_{h+1,n}](s_h, a_h) + 2\beta(\delta)\sigma_{n,h}(s_h, a_h)- r(s_h, a_h) - [P_hV^{\pi_n}_{h+1}](s_h, a_h; \tilde{\sigma}^{h_0}_n)\\\nn
    &= V_{h+1, n}(s_{h+1}) - V^{\pi_n}_{h+1}(s_{h+1}; \tilde{\sigma}^{h_0}_n)+ 2\beta(\delta)\sigma_{n,h}(s_h, a_h) \\\nn
    &+ ([P_hV_{h+1,n}](s_h, a_h) - V_{h+1, n}(s_{h+1})) \\\nn
    & + (V^{\pi_n}_{h+1}(s_{h+1}; \tilde{\sigma}^{h_0}_n) - [P_hV^{\pi_n}_{h+1}](s_h, a_h; \tilde{\sigma}^{h_0}_n))
\end{align}

Applying this recursively, we obtain

\begin{align}
    V_{1,n}(s_1)- V^{\pi_n}_1(s_1; \tilde{\sigma}^{h_0}_n) \le \sum_{h=1}^H 2\beta(\delta)\sigma_{n,h}(s_h, a_h) + ...
\end{align}
    
\end{proof}
