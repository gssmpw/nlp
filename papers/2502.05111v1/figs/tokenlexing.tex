\begin{figure}
\centering
{\footnotesize
\begin{tikzpicture}[
    shorten >=1pt,
    node distance=2.5cm and 2.7cm,
    on grid,
    auto,
    scale=1.0,
    every state/.style={minimum size=0.8cm}
] 
   \node[state,initial,accepting,initial text={}] (q_0)   {$q_0$}; 
   \node[state] (q_1) [right=of q_0] {$q_1$}; 
   \node[state] (q_2) [right=of q_1, yshift=40pt] {$q^{\texttt{B}}_2$}; 
   \node[state] (q_3) [right=of q_1, yshift=-40pt] {$q^{\texttt{C}}_3$};
   % \node[state] (q_4) [below=of q_3] {$q^{(}_4$};
   % \node[state] (q_5) [below=of q_4] {$q^{)}_5$};
    \path[->] 
    (q_0) edge node {\texttt{a}:$\epsilon$, \texttt{aba}:\texttt{B}} (q_1)
          edge [bend left=40]  node[pos=0.4, swap] {\texttt{ab}:$\epsilon$} (q_2)
          edge [bend right=40]  node[pos=0.4] {\texttt{ac}:$\epsilon$} (q_3)
          % edge [bend right=60]  node[pos=0.3, right=-5pt] {
          %   \begin{tabular}{c} \texttt{+}/$\epsilon$, \\ \texttt{\{0+,00+\}}\\/\texttt{NUM} \end{tabular}
          % } (q_3)
          % edge [bend right=30]  node[pos=0.78] {( / $\epsilon$} (q_4)
          % edge [bend right=30]  node[pos=0.81] {) / $\epsilon$} (q_5)
    (q_1) edge [bend right=10] node[swap, pos=0.3] {\texttt{b}:$\epsilon$} (q_2) 
          edge [bend left=10] node[pos=0.3] {\texttt{c}:$\epsilon$} (q_3) 
    %       edge [loop above] node[pos=0.8, right] {\texttt{\{a,0,a0\}}/$\epsilon$} ()
    %       edge [bend left=80] node[swap, pos=0.65, left=-8pt] {
    %         \begin{tabular}{c} \texttt{\{0+,00+\}}\\/\texttt{NAME} \end{tabular}
    %       } (q_3)
    (q_2) edge [loop right] node[pos=0.15, above] {
            \begin{tabular}{c} \texttt{b}:$\epsilon$, \\ \texttt{ab}:\texttt{B} \end{tabular}
            } ()
          edge[bend right=10] node[swap, above=2pt] {
            \begin{tabular}{c} \texttt{a}:\texttt{B}, \\ \texttt{aba}:\texttt{BB} \end{tabular}
          } (q_1)
          edge [bend right=10] node[swap, pos=0.4] {\texttt{ac}:\texttt{B}} (q_3)
    %       edge [bend left=40] node[pos=0.2, below=2pt] {\texttt{EOS}/\texttt{NUM};$\$$} (q_0)
    (q_3) edge [loop right] node[pos=0.15, above] {
            \begin{tabular}{c} \texttt{c}:$\epsilon$, \\ \texttt{ac}:\texttt{C} \end{tabular}
            } ()
          edge [bend right=10] node[swap, pos=0.6] {\texttt{ab}:\texttt{C}} (q_2)
          edge[bend left=10] node[swap, below=2pt] {
            \begin{tabular}{c} \texttt{a}:\texttt{C}, \\ \texttt{aba}:\texttt{CB} \end{tabular}
          } (q_1)
    %       edge [bend right=10] node[swap, pos=0.3] {\texttt{0}/\texttt{+}} (q_2)
    %       edge [bend right=90] node[swap] {\texttt{a0}/\texttt{+}} (q_1)
    %       edge [loop below] node {
    %         \begin{tabular}{c} \texttt{+}/\texttt{+}, \{\texttt{0+},\texttt{00+}\}/\texttt{+};\texttt{NUM} \end{tabular}
    %       } ()
;
\end{tikzpicture}
}
\caption{A determinized token-level lexing transducer $\transducer_{\automaton \circ \vocab}$, which is formed by composing $\transducer_\vocab$ from \autoref{fig:detokenizing} and $\transducer_\automaton$ from \autoref{fig:char-transducer}.}
\label{fig:token-transducer}
\end{figure}
