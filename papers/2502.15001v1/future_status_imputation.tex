The simulations in this paper use historic candidate information from the Eurotransplant registry for the simulation of ETKAS and ESP allocation. A challenge in using historic candidate information is that transplantation of a waiting list candidate prevents Eurotransplant from observing what would have happened to this waiting list candidate in case they had remained on the waiting list. To realistically complete the waiting list spells for candidates whom were transplanted with status updates until they would have experienced a waiting list death or waiting list removal, we implemented a procedure to impute future statuses for transplant recipients. This appendix details this procedure.

\bibliographystyleAC{myama}



\paragraph*{Overview of the \textit{counterfactual} future status imputation procedure}
The ETKidney simulator requires a complete stream of status updates for all patient registrations, i.e. all registrations must end with a removal (status code: R) status or a waiting list death (status code: D) status. In registry data from Eurotransplant, most waiting list spells end in a transplantation (status code: FU). For this, transplant recipients are matched to candidates who remain on the waiting list based on their expected  \textit{counterfactual} mortality risk as well as on other characteristics. In predicting this counterfactual mortality, we correct for dependent censoring by transplantation with inverse probability censoring weighting by modifying a procedure proposed by Tayob and Murray \citeAC{tayobstatistical2017} to impute future survival times from pre-determined landmark times for lung waiting list transplantation candidates.
\par
Specifically, Tayob and Murray are interested in modelling the 12-month restricted survival time $T^* = \min(T, \tau)$ of transplant candidates, where $T$ is a random variable for the remaining survival time measured from the landmark times, and $\tau$ is the time horizon of interest (12 months in their case). Tayob and Murray work with regularly spaced landmark times $j$, and define $T^*_{ij}$ as the $\tau$-restricted remaining survival time of subject $i$ from landmark time $j$. With these, Tayob and Murray aim to model the expected mean survival time directly, i.e. model
$$\mathbb{E}[\log(T^*) | Z] = \beta^\intercal Z.$$ There are three challenges in estmiating $\beta$: (i) $T^*_{ij}$ is unobserved for most candidates due to censoring, (ii) transplantation represents an informative censoring mechanism, and (iii) that the $T^*_{ij}$ exhibit correlations over the landmark times $j$.
\par
The paper by Tayob and Murray proposes a procedure to handle these three issues. Specifically, Tayob and Murray's imputation procedure consists of:
\begin{enumerate}
	\item Estimating the counterfactual waiting list survival function $S^{\text{IPCW}}_T(t)$, with correction for informative censoring by transplantation with inverse probability censoring weighting (IPCW). With this curve, they can construct $j$-specific pseudo-observations $PO_{ij}$ for $\log(T^*_{ij})$. 
	\item Estimating $\hat{\beta}^{\text{PO}}$ on pairs $(PO_{ij}, Z_{ij})$ with Generalized  Estimating Equations (GEE) with an unstructured working correlation matrix. This correlation matrix permits arbitrary correlation between the $T_{ij}$s over $j$.
	\item For each patient $i$ with unobserved $T^*_{ij}$ constructing a risk set $R_i$
	\begin{itemize}
		\item of patients who remain at risk after patient $i$ is censored, i.e. with $T_{kj} > C_{ij}$, $k\neq i$, where $C_{ij}$ is patient $i$'s censoring time measured from landmark time $j$,
		\item who are similar in terms of predicted expected log survival, i.e. require $$|\hat{\beta}^{\text{PO}}\ ^\intercal Z_k(C_{i}) - \hat{\beta}^{\text{PO}}\ ^\intercal Z_i(C_{i})| < \epsilon$$ for some $\epsilon$, where $Z_k(C_{i})$ are covariates of patient $k$ at $i$'s censoring time $C_i$,
		\item Optionally, further restrict matches based on $Z_i(C_{i})$, e.g. require matching disease groups.
	\end{itemize}
	\item Within risk set $R_i$, re-estimate the counterfactual survival function $S_T^{\text{IPCW}}(t|R_i)$. Use inverse transform sampling from this risk-set specific survival curve to sample a valid $T^*_{ij}.$
\end{enumerate}
\par 
Our aim is to use Tayob and Murray's procedure to match transplant recipients to comparable, not-yet-transplanted waiting list candidates. Because priority is based on dialysis time in Eurotransplant, we want to match candidates based on accrued dialysis time. This requires three main modifications to the imputation procedure:
\begin{itemize}
	\item We define the remaining time-to-event variables based on accrued dialysis time instead of waiting time,
	\item We have to match transplanted patients at any continuous time $t$ to comparable, at-risk waiting list candidates (and not only at pre-determined landmark times $j$). For this, we define $T^*_{it}$ to be the $\tau$-restricted remaining survival time from time $t$ forward, with $t$ the number of days elapsed since listing. For each observed status update we construct a $t$-specific pseudo-observation $PO_{it}$, with $t$ the time-after-listing at which the status was reported.
	\item We cannot estimate ${\beta}^{\text{PO}}$ with GEE with an unstructured correlation matrix, as the $PO_{it}$ is indexed by continuous time $t$. Instead, we propose to estimate $\beta^{PO}$ with Quasi-Least Squares (QLS) with a Markov correlation structure \citeAC{xieqls2010}. This structure assumes that the correlation between $PO_{it}$ decays with spacing in $t$. 
\end{itemize} 
Construction of the risk set $R_i$ for patients with unknown $T^*_{it}$ is then similar; we consider patients $k$ with $T^*_{kt} > C^*_{it}$, similar $\hat{\beta}^{\text{PO}}\ ^\intercal Z_\cdot(C_{ik})$, and require matches on characteristics $Z_{ik}(C_i)$. For each risk set, we can estimate $S^{\text{IPCW}}_T(t | R_i)$. Inverse transform sampling from $S^{\text{IPCW}}_T(t)$ is then used to match candidate $i$ to a specific candidate $k \in R_i$. We can then impute patient $i$'s future status updates by copying over status updates from patient $k$. This procedure is repeated, until all candidates have a set of status updates ending with a waiting list removal (R) or death (D). 

\subsection{Modeling the expected remaining survival time for candidates}
\label{app:exp_rem_surv}
Here, we discuss the procedure used to estimate counterfactual survival curves, and how pseudo-outcomes are constructed for the log expected survival times. \\[0.2cm]
\subsubsection{IPCW survival curve estimate \& construction of pseudo-outcomes}
\noindent
\textbf{Propensity score model}\\
We are interested estimation of counterfactual waiting list survival, i.e. the probability that a patient is not yet delisted / has not yet died on the waiting list if transplantation were not available.  To correct for informative censoring by transplantation, we use a Cox model to predict the probability that a patient is censored over time, and estimate the counterfactual waiting list survival curve weighing observations by the inverse probability of being transplanted. Adjustment variables included in the Cox model for prediction of the transplant probability are candidate sex, candidate blood group, spline terms of candidate age, the disease group (congenital, polycystic, neoplasms, diabetes, glomerular disease, renovascular / vascular disease, tubular and interstitial disease, or other), the HLA-ABDR mismatch frequency (see section \ref{subsection:mmp}), the vPRA, the last reported PRA, and the candidate country of listing.\\[.3cm]
\par
\FloatBarrier
\noindent
\textbf{Construction of pseudo-outcomes}\\
As in \citeAC{tayobstatistical2017}, we are interested in directly modeling residual remaining survival time $T^{*}$, i.e. modelling
$$\mathbb{E}[\log(T^*)|Z] = \beta^\intercal Z.$$ A problem encountered in estimating such a model is that transplantation and censoring prevents Eurotransplant from observing the remaining survival times $T^*_{it}$ for most candidates. Tayob and Murray \citeAC{tayobstatistical2017} address this issue by constructing pseudo-observations for $\log(T_{ij}*)$ can be constructed, based on estimated counterfactual survival curve $\hat{S}^{IPCW}(t)$. We used this procedure to construct pseudo-observations for $\log(T_{it}*)$. Armed with pairs $(PO_{it}, Z_i)$, we can in principle estimate $\beta^{PO}$.

\subsubsection{Modelling the mean restricted survival time with Quasi-Least Squares}
With pairs $(PO_{it}, Z_i)$ we can model the expected log remaining survival time as
\begin{equation}
	\mathbb{E}[\log(T^*) | Z] = \beta^\intercal Z
	\label{eqn:model_tayob}
\end{equation}
However, in estimation of $\beta$ requires that we deal with correlations in $PO_{it}$ over $t$. Tayob and Murray faced a similar issue, where there is correlation between $T^*_{ij}$ for the different landmark times $j$, and addressed this by estimating $\beta$ with Generalized Estimating Equations (GEE) with an unstructured correlation matrix correlation over the landmark times $j$ (which requires $j(j+1)/2$ parameters). Unfortunately, this strategy is infeasible to us as potential outcomes $PO_{it}$ are indexed by continuous time $t$, i.e. all observed censoring times. Instead, we assume a Markov correlation structure for the potential outcomes, i.e. we assume that the correlation between measurements $PO_{is}$ and $PO_{it}$ decays with their separation in time: $$\texttt{Corr}(PO_{is}, PO_{it}) = \alpha^{|s-t|}.$$
Parameters $\alpha$ and $\beta$ to this model may be estimated with the \texttt{qlspack} R package, with Quasi-Least Squares \citeAC{Shults2014-di, xieqls2010}[p.94].
\par
For this model, we adjust for candidate age, candidate sex, whether the candidate has previously received a kidney transplantation, and the time the candidate has waited on dialysis at the moment of reporting the status update.

\subsection{The construction of risk sets of comparable candidates}
In the previous subsection, we discussed how the expected remaining survival time was modelled for candidates waiting on the Eurotransplant kidney waitling list. This information is used to construct, for each transplant recipient, a set of candidates who remain on the kidney waiting list who have comparable remaining survival times. Specifically, we required that $|\hat{\beta}^{\text{PO}}\ ^\intercal Z_k(C_{i}) - \hat{\beta}^{\text{PO}}\ ^\intercal Z_i(C_{i})| < 0.50$ to match transplant recipients to not-yet-transplanted waiting list candidates based on expected log 1-year-truncated waiting list survival.
\par 
Additional constraints were used to ensure that candidates contained within a risk set were comparable. For this, an adaptive procedure was implemented. This procedure always matched candidates on whether they were a re-transplantation candidate, and whether their last reported waiting list status was an active waiting list status. The procedure also tried to match candidates based on disease group, reason why they were non-transplantable, and candidate country of listing. However, these constraints were relaxed in case fewer than 50 candidates could be included in the risk set. Finally, the procedure also imposed constraints on the differences in accrued dialysis time and age at listing using pre-determined caliper widths.
\par 
In case matching according to all criteria fails to result in a risk set of sufficient size (that is, fewer than 50 candidates), we drop a discrete match criterion (first country, then reason non-transplantable, then disease group). In case dropping all discrete match criteria does not result in adequately sized risk set, we increase caliper widths for continuous variables.\\[.5cm]
\par
\noindent
\textbf{Example of a risk set}\\
In Table \ref{tab:example_match_table} we show an example of a constructed risk set for a female candidate who was transplanted after waiting for 4.5 years for a kidney transplantation with 6 years of accrued dialysis time. The first row of Table \ref{tab:example_match_table} shows that the transplanted patient is listed in 2014 in Germany for polycystic kidney disease. Remaining rows of Table \ref{tab:example_match_table} show 10 (out of 50) waiting list candidates in patient $i$'s risk set $R_i$. These patients remain at risk having waited 2162 days on dialysis for transplantation. They are also similar to the patient based on match characteristics: all matched candidates are patients with polycystic kidney disease waiting in Germany, and around age 60.
\begin{table}[h]
	\centering
	\caption{Example of the matched risk set for a selected recipient.}
	%\hspace*{-.15\textwidth}
	\resizebox{1\textwidth}{!}{
		
		\input{tables/match_table}
	}
	
	
	\label{tab:example_match_table}
\end{table}
\FloatBarrier
With risk set $R_i$ and constructed IPCW weights, we can obtain a personalized estimate of the conditional probability of remaining waiting listed $t$ time units after $i$'s censoring time (i.e. $\hat{S}^{\text{IPCW}}_T(t|R_i, T > C_i)$). 

\subsection{Matching the patient to a particular patient in $R_i$}
We match the censored patient $i$ to a patient who remains at risk in the risk set $R_i$ with inverse transform sampling. This means that we (i) draw a random number $u$ from the uniform(0,1) distribution, and (ii) find the smallest matching $t$ such that $\hat{S}^{\text{IPCW}}_T(t|R_i, T > C_i) \leq u$). If such a $t$ exists, it corresponds to an event time for a patient $k \in R_i$. We can impute future status updates for patient $i$ by copying over the future status updates from patient $k$. 
\par
In case such a $t$ does not exist, the patient remains alive at least $\tau$ time units after the status update. We therefore need to match to a patient from the set of patients who remain alive $\tau$ days after $C_i$, i.e. $\{k \in R_i : T_{k} > C_i + \tau\}$. For this, we sampled patients with probability proportional to their inverse probability censoring weight, i.e. proportional to $\mathbb{P}[T_{k\tau} \leq C_{it} + 365 | T_{k\tau} > C_{it}].$

\FloatBarrier

\bibliographyAC{refs}