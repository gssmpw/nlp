\subsection{Structured Communication System}\label{sec:communication}
\begin{figure}[h]
  \centering
  \includegraphics[width=0.8\linewidth]{AnonymousSubmission/LaTeX/figures/communication.pdf}
  \caption{Communication Protocol. Agents collaborate by exchanging messages to coordinate tasks and share resources. An arrow from agent $i$ to agent $j$ indicates that agent $i$ is helping agent $j$; communication then flows in the opposite direction.}%\carlee{An arrow from agent $i$ to agent $j$ indicates that agent $i$ is helping agent $j$; communication then flows in the opposite direction.}}
  \label{fig:communication_protocol}
  %\Description{Communication protocol.}
    \vspace{-0.1in}
\end{figure}

%In a multi-agent environment, communication between agents is crucial for achieving efficient cooperation and collaboration. Our communication framework allows agents to share their current status, resource availability, crafting progress, and requests for assistance, with a hierarchical focusâ€”each agent prioritizes helping its preceding agent.

In a multi-agent environment, communication is key for effective cooperation. Our communication framework, consisting of message generation modules $g=\{g_1,\dots,g_n\}$ for all agents, where $m_i = g_i (o_i,rs_i,c_i,rq_i)$, enables agents to share their current observations $o_i$, includes status $s_i$, resource availability $rs_i$, short-term goal %\carlee{this should be more generic, maybe call it ``current short-term goal''} 
$c_i$, and assistance requests $rq_i$. This follows a hierarchical structure, where each agent $i$ prioritizes helping the preceding agent $i-1$.

We propose a novel \textbf{Collaboration} schema $\boldsymbol{C_i}=\Phi(h_i, I_i, \Delta p_i)$ for each agent $i$ and add this to the structured outputs, which is based on the target agents $h_i$ who needs help from agent $i$, intentions $I_i$ to assist target agents from agent $i$, and how the collaboration impacts agent $i$'s current plan, denoted by $\Delta p_i$. In our multi-agent system, the message generation function $g_i$ can be augmented by incorporating the collaboration schema $\boldsymbol{C_i}$ to refine and guide the message generation process, then the message generation process is enhanced by the information encoded in $\boldsymbol{C_i}$, i.e., $m_i = g_i (o_i,rs_i,c_i,rq_i, C_i)$. Therefore, the Collaboration schema enables agents to interpret and generate actions $a_i=\pi_i(o_i,\boldsymbol{m}_{-i})$, where $\boldsymbol{m_{-i}}=\{m_{j}=g(o_j), \forall j \neq i\}$ to denote the collection of messages agent $i$ receives from all other agents $j \neq i$. This structure ensures that our collaborative agents act in a goal-oriented manner with collaboration as a key consideration. 

%A new schema, \textbf{Collaboration}, has been added to the structured output. This schema enables agents to focus on interpreting and generating actions based on who needs help, how to help, and how the collaboration affects their current plan. This ensures that agents act in a goal-oriented manner, considering collaboration.

%\textcolor{orange}{As illustrated in Figure~\ref{fig:communication_protocol}, agents collaborate by communicating and sharing resources, using message generation modules $g={g_1, \dots, g_n}$ to coordinate actions such as task allocation and resource sharing. Agents are ordered from 1 to $n$, with each agent $i$ responsible for assisting the preceding agent $i-1$ and the leader agent $1$ with communication module $g_1$. The first agent's communication module, $g_1$, acts as the leader, tasked with crafting essential tools and distributing them to other agents as needed. The second agent's communication module, $g_2$, focuses on gathering materials and aiding $g_1$ with crafting tasks. The last agent's communication module, $g_n$, is responsible for supporting $g_{n-1}$ and eventually shifting its focus to finding a diamond, deciding when to switch from assisting other agents to locating the diamond based on the collaboration schema $\boldsymbol{C}_n=\Phi(h_n, I_n, \Delta p_n)$. This protocol is simple yet effective in a hierarchical environment, parallelizing tasks and encouraging cooperation among agents while maintaining low communication costs. Since the environment is hierarchical, this collaborative approach effectively speeds up the crafting process and naturally scales with any arbitrary number of agents $n$.}

\textbf{An Illustrative Example.} As illustrated in Figure~\ref{fig:communication_protocol}, agents collaborate by communicating and sharing resources through message generation modules $g={g_1, \dots, g_n}$ to coordinate tasks like allocation and resource sharing. Agents are ordered from 1 to $n$, with each agent $i$ assisting the preceding agent $i-1$ and the leader agent $1$. The first agent, acts as the leader, crafting essential tools and distributing them to others. The second agent gathers materials and assists the agent $1$ with crafting. The last agent $n$, supports agent $n-1$ and eventually shifts its focus to finding a diamond, deciding when to switch goals using the collaboration schema $\boldsymbol{C}_n=\Phi(h_n, I_n, \Delta p_n)$. This simple yet effective protocol works in hierarchical environments by parallelizing tasks, fostering cooperation, and keeping communication costs low. It naturally scales with any number of agents $n$, speeding up the crafting process.

%As illustrated in Figure~\ref{fig:communication_protocol}, agents collaborate by communicating and sharing resources. They exchange messages to coordinate actions such as task allocation and resource sharing. Agents are ordered from 1 to $N$, with each agent designated to assist the preceding agent and the leader agent. The first agent is the leader agent, responsible for crafting tools and sharing them with other agents in need. \textcolor{blue}{[personal take: can be even more specific, on what tasks the first and second agent does]} The last agent is tasked with helping its previous agent and finding a diamond, determining when to switch its goal from assisting agents to locating the diamond. This protocol is simple yet effective in a hierarchical environment, parallelizing tasks and encouraging cooperation among agents while maintaining low communication costs. Since the environment is hierarchical, this collaborative approach effectively speeds up the crafting process and naturally scales with any arbitrary number of agents.
%\textcolor{blue}{[personal take: can be even more specific, on what tasks the first and second agent does]} 
%\textcolor{blue}{[it may not scale at times right, depending on the task. sometimes less is better]}

% \subsection{Libraries and Packages}
% Our implementation leverages several key libraries and packages to build the decentralized cooperative generative agents framework. We use Python 3.10.14, along with Pydantic 2.9.2 for structured output, OpenAI 1.44.1, and Torch 2.3.1. Additionally, we use GPT-4o (2024-08-06 version) as the backbone language model. \carlee{I'd move this to the experiments section or appendix. Also say here that we will release this code publicly}

% \textcolor{orange}{Jingdi: could move this to appendix}

% \mycodebox[green!20]{%
% class ResponseEvent(BaseModel):\\
% \hspace*{5mm}episode\_number: int\\
% \hspace*{5mm}timestep: int\\
% \hspace*{5mm}past\_events: str\\
% \hspace*{5mm}current\_inventory: list[InventoryItemsCount]\\
% \hspace*{5mm}collaboration: Collaboration\\
% \hspace*{5mm}reflection: Reflection\\
% \hspace*{5mm}goal: Goal\\
% \hspace*{5mm}action: NextAction\\
% \hspace*{5mm}summary: str\\
% }