\tikzset{
    pics/ann/.style={
        code={
            \tikzstyle{every pin edge}=[<-,shorten <=1pt]
            \tikzstyle{neuron}=[circle,fill=black!25,minimum size=#1*10pt,inner sep=0pt]
            \tikzstyle{input neuron}=[neuron, fill=gray!30, pin=left:];
            \tikzstyle{output neuron}=[neuron, fill=gray!50, pin={[pin edge={->}]right:}];
            \tikzstyle{hidden neuron}=[neuron, fill=gray!70];
            
            \node[input neuron] (I1) at (-1.0*#1, -1.5*#1) {};
            \node[input neuron] (I2) at (-1.0*#1, -0.5*#1) {};
            \node[input neuron] (I3) at (-1.0*#1, +0.5*#1) {};
            \node[input neuron] (I4) at (-1.0*#1, +1.5*#1) {};

            \node[hidden neuron] (H1) at (0.0*#1, -2.0*#1) {};
            \node[hidden neuron] (H2) at (0.0*#1, -1.0*#1) {};
            \node[hidden neuron] (H3) at (0.0*#1, +0.0*#1) {};
            \node[hidden neuron] (H4) at (0.0*#1, +1.0*#1) {};
            \node[hidden neuron] (H5) at (0.0*#1, +2.0*#1) {};

            \node[output neuron] (O1) at (1.0*#1, -1.0*#1) {};
            \node[output neuron] (O2) at (1.0*#1, +0.0*#1) {};
            \node[output neuron] (O3) at (1.0*#1, +1.0*#1) {};

            \foreach \source in {1,...,4}
                \foreach \dest in {1,...,5}
                    \path (I\source) edge (H\dest);
            
            \foreach \source in {1,...,5}
                \foreach \dest in {1,...,3}
                    \path (H\source) edge (O\dest);
        }
    }
}

\tikzstyle{block} = [rectangle, draw, 
    text width=8em, text centered, rounded corners, minimum height=4em]

% \begin{tikzpicture}[shorten >=1pt,->,draw=black!50]

%     % % grid
%     % \newcommand*{\xMin}{0}%
%     % \newcommand*{\xMax}{8}%
%     % \newcommand*{\yMin}{0}%
%     % \newcommand*{\yMax}{8}%
%     % \foreach \i in {\xMin,...,\xMax} {
%     %     \draw [very thin,black!20!white] (\i,\yMin) -- (\i,\yMax);
%     % }
%     % \foreach \i in {\yMin,...,\yMax} {
%     %     \draw [very thin,black!20!white] (\xMin,\i) -- (\xMax,\i);
%     % }
    
%     \draw[rounded corners,line width=1pt] (1.0,2) rectangle (3.2,6);
%     \pic at (2.5,4.0) {ann=0.85};
%     \node[rotate=90] (input) at (0.5,4) {RF signature and SINR};
%     \node[text width=2cm] (initial) at (2.25,1.50) {Initial feature extractor};
    
%     \draw[rounded corners,line width=1pt] (5.5,0) rectangle (7.0,2.4);
%     \pic at (6.25,1.25) {ann=0.40};
%     \node[rotate=90] (ue1_out) at (7.5,1.25) {$\left(\bm{a}_{bs}^{(N)}, \bm{a}_{\Theta}^{(N)}\right)$};
%     \node[text width=2cm] (initial) at (6.50,-0.50) {\small Actor network for $UE_N$};
    
%     \draw[rounded corners,line width=1pt] (5.5,5.5) rectangle (7.0,8.0);
%     \pic at (6.25,6.75) {ann=0.40};   
%     \node[rotate=90] (ueN_out) at (7.5,6.75) {$\left(\bm{a}_{bs}^{(1)}, \bm{a}_{\Theta}^{(1)}\right)$};
%     \node[text width=2cm] (initial) at (6.50,5.00) {\small Actor network for $UE_1$};
    
%     \draw[line width=1pt,-implies,double, double distance=1mm] (3.6,2.5) -- (5.2,1.25);
%     \draw[line width=1pt,-implies,double, double distance=1mm] (3.6,5.5) -- (5.2,6.75);

%     \node[draw,shape=circle,fill=gray,minimum size=1mm,inner sep=0pt] (d1) at (6.25,4.00) {};
%     \node[draw,shape=circle,fill=gray,minimum size=1mm,inner sep=0pt] (d2) at (6.25,3.50) {};
%     \node[draw,shape=circle,fill=gray,minimum size=1mm,inner sep=0pt] (d3) at (6.25,3.00) {};
% \end{tikzpicture}


\begin{tikzpicture}[shorten >=1pt,->,draw=black!50]

    % % grid
    % \newcommand*{\xMin}{0}%
    % \newcommand*{\xMax}{9}%
    % \newcommand*{\yMin}{0}%
    % \newcommand*{\yMax}{12}%
    % \foreach \i in {\xMin,...,\xMax} {
    %     \draw [very thin,black!20!white] (\i,\yMin) -- (\i,\yMax);
    % }
    % \foreach \i in {\yMin,...,\yMax} {
    %     \draw [very thin,black!20!white] (\xMin,\i) -- (\xMax,\i);
    % }
    
    \draw[rounded corners,line width=1pt] (1.4,2.3) rectangle (2.8,4.7);
    \pic at (2.2,3.5) {ann=0.45};
    \node[rotate=90] (input) at (1.05,3.3) {RF signature and SINR};
    \node[text width=2cm] (initial) at (2.5,1.70) {Feature \\ extractor};
    
    \draw[rounded corners,line width=1pt] (3.5,0) rectangle (7.0,2.4);
    \pic at (4.10,0.75) {ann=0.25};
    \pic at (6.50,1.50) {ann=0.25};
    \node[rotate=90] (ue1_out) at (7.6,1.00) {\small $\left(\bm{a}_{bs}^{(N_{UE})}, \bm{a}_{\Theta}^{(N_{UE})}\right)$};
    \node[text width=4cm] (initial) at (5.80,-0.30) {\small Sub-net for $N_{UE}^{th}$ UE};
    
    \draw[rounded corners,line width=1pt] (3.5,4.7) rectangle (7.0,7.0);
    \pic at (4.10,6.25) {ann=0.25};
    \pic at (6.50,5.50) {ann=0.25};
    \node[rotate=90] (ueN_out) at (7.6,5.95) {\small $\left(\bm{a}_{bs}^{(1)}, \bm{a}_{\Theta}^{(1)}\right)$};
    \node[text width=4cm] (initial) at (5.80,4.40) {\small Sub-net for $1^{st}$ UE};

    \node[rotate=90] (ueN_out) at (7.6,3.5) {\small $,\dots,\left(\bm{a}_{bs}^{(i)}, \bm{a}_{\Theta}^{(i)}\right), \dots,$};
    
    \draw[line width=1pt,-implies,double, double distance=1mm] (2.9,2.0) -- (3.2,0.9);
    \draw[line width=1pt,-implies,double, double distance=1mm] (3.0,1.75) -- (5.6,1.75);
    \draw[line width=1pt,-implies,double, double distance=1mm] (5.00,0.75) -- (5.6,1.40);
    \draw[line width=0.75pt, gray!70] (5.00,0.45) -- (7.33,0.45);
    
    
    \draw[line width=1pt,-implies,double, double distance=1mm] (2.9,5.0) -- (3.2,6.25);
    \draw[line width=1pt,-implies,double, double distance=1mm] (3.0,5.25) -- (5.6,5.25);
    \draw[line width=1pt,-implies,double, double distance=1mm] (5.00,6.25) -- (5.6,5.60);
    \draw[line width=0.75pt, gray!70] (5.0,6.5) -- (7.33,6.55);

    \node[draw,shape=circle,fill=gray,minimum size=1mm,inner sep=0pt] (d1) at (6.25,4.0) {};
    \node[draw,shape=circle,fill=gray,minimum size=1mm,inner sep=0pt] (d2) at (6.25,3.5) {};
    \node[draw,shape=circle,fill=gray,minimum size=1mm,inner sep=0pt] (d3) at (6.25,3.0) {};

    % \draw[line width=1pt,-implies,double, double distance=1mm] (7.8,5.5) -- (7.9,4.25);
    % \draw[line width=1pt,-implies,double, double distance=1mm] (7.8,1.6) -- (7.9,3.2);

    \draw[rounded corners,line width=1pt] (8.1,2.4) rectangle (9.0,4.4);
    \pic at (8.6,3.4) {ann=0.240};
    \node[rotate=90] (ue1_out) at (9.7,4.05) {\small $\left([\bm{a}_{r}^{(j)}]_{i\in N_{BS}}, [\bm{a}_{bs}^{(i)}, \bm{a}_{\Theta}^{(i)}]_{i\in N_{UE}}\right)$};
    \node[text width=2.5cm] (initial) at (9.4,1.8) {\small Sub-net \\ for $\bm{r}$};
    \draw[line width=0.75pt, gray!70] (8.0,4.75) -- (9.4,4.75);

    
\end{tikzpicture}

