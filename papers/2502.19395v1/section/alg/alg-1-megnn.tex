\begin{algorithm}[t]
\caption{Multi-channel Equivariant Graph Neural Network (MEGNN)}\label{alg:megnn}
\begin{algorithmic}
    \STATE {\bfseries Input:} Antibody CDR Structure $G=(V,E)$, initial features $\vect{h}_i^{(0)}$ and coordinates $\vect{X}_i^{(0)}$ for each node $v_i \in V$
    \STATE {\bfseries Output:} Antibody CDR representation $\vect{h}_{G}$
    \STATE Initialize coordinates $\hat{\vect{X}}_i \leftarrow \vect{X}_i + \mathcal{N}(0, \sigma)$
    \FOR{layer $l=1$ {\bfseries to} $L$}
        \FOR{$v_i \in V$}
            \FOR{$v_j \in \mathcal{N}_i$}
                \STATE Calculate the coordinate differences: $\vect{X}_{ij}^{(l-1)} \leftarrow \vect{X}_i^{(l-1)} - \vect{X}_j^{(l-1)}$
                \STATE Calculate the square distance: $\vect{z}_{ij}^{(l-1)} \leftarrow (\vect{X}_{ij}^{(l-1)})^{\top} \vect{X}_{ij}^{(l-1)}$        
                \STATE Update the edge feature: $\vect{h}_{e_{ij}}^{(l)} \leftarrow \phi_e \left( \text{CONCAT}\left(\vect{h}_i^{(l-1)}, \vect{h}_j^{(l-1)}, \vect{z}_{ij}^{(l-1)} \right) \right)$
                \STATE Derive the propagated information: $\vect{m}_{j \leftarrow i} \leftarrow \text{MLP}\left( \vect{h}_{e_{ij}}^{(l)} \right) \cdot \vect{X}_{ij}^{(l-1)}$ 
            \ENDFOR
            \STATE Update the coordinate: $\vect{X}_i^{(l)} \leftarrow \vect{X}_i^{(l-1)} + \frac{1}{|\mathcal{N}_i|} \sum_{v_j \in \mathcal{N}_i} \vect{m}_{j \rightarrow i}$
            \STATE Derive the aggregated edge feature: $\vect{h}_{agg_i}^{(l)} \leftarrow \sum_{j \in \mathcal{N}_i} { \vect{h}^{(l)}_{e_{ij}}}$ 
            \STATE Update the node representation: $\vect{h}_{i}^{(l)} \leftarrow  \vect{h}_i^{(l-1)} + \text{MLP}\left( \text{CONCAT}(\vect{h}_i^{(l-1)}, \vect{h}_{agg_i}^{(l)}) \right)$
        \ENDFOR
    \ENDFOR
    \STATE Generate the representation of the input CDR structure: $\vect{h}_G \leftarrow \text{READOUT}(\{\vect{h}_i^{(L)}\}_{i=1}^{n})$ 
    \STATE {\bfseries Return:} CDR representation $\vect{h}_{G}$
\end{algorithmic}
\end{algorithm}